(function(e){function t(t){for(var r,o,n=t[0],l=t[1],u=t[2],c=0,h=[];c<n.length;c++)o=n[c],Object.prototype.hasOwnProperty.call(i,o)&&i[o]&&h.push(i[o][0]),i[o]=0;for(r in l)Object.prototype.hasOwnProperty.call(l,r)&&(e[r]=l[r]);d&&d(t);while(h.length)h.shift()();return a.push.apply(a,u||[]),s()}function s(){for(var e,t=0;t<a.length;t++){for(var s=a[t],r=!0,n=1;n<s.length;n++){var l=s[n];0!==i[l]&&(r=!1)}r&&(a.splice(t--,1),e=o(o.s=s[0]))}return e}var r={},i={app:0},a=[];function o(t){if(r[t])return r[t].exports;var s=r[t]={i:t,l:!1,exports:{}};return e[t].call(s.exports,s,s.exports,o),s.l=!0,s.exports}o.m=e,o.c=r,o.d=function(e,t,s){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},o.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(o.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)o.d(s,r,function(t){return e[t]}.bind(null,r));return s},o.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="/";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],l=n.push.bind(n);n.push=t,n=n.slice();for(var u=0;u<n.length;u++)t(n[u]);var d=l;a.push([0,"chunk-vendors"]),s()})({0:function(e,t,s){e.exports=s("56d7")},"0f77":function(e,t,s){"use strict";s("5d13")},"56d7":function(e,t,s){"use strict";s.r(t);var r=s("2b0e"),i=function(){var e=this,t=e._self._c;return t("router-view")},a=[],o=s("2877"),n={},l=Object(o["a"])(n,i,a,!1,null,null,null),u=l.exports,d=s("8c4f"),c=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"login-underlay",attrs:{id:"login-underlay"}},[t("Header"),t("Footer")],1),t("div",{staticClass:"login"},[t("div",{staticClass:"login-box-bg hidden",attrs:{id:"login-box-bg"}}),t("div",{staticClass:"login-box-wrapper"},[t("div",{staticClass:"login-box smaller",attrs:{id:"login-box"}},[t("div",{staticClass:"box-title"},[e._v("Login")]),t("div",{staticClass:"box-body"},[t("div",{staticClass:"errormsg",domProps:{innerHTML:e._s(this.error)}}),t("form",{on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("fieldset",[t("div",{staticClass:"errormsg hidden"},[e._v("We could not log you in")]),t("div",{staticClass:"login-box-row label"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"}],attrs:{type:"text",id:"username",name:"username",autocomplete:"off",placeholder:"Username or email"},domProps:{value:e.userName},on:{change:e.checkEmail,input:function(t){t.target.composing||(e.userName=t.target.value)}}}),t("div",{directives:[{name:"tooltip",rawName:"v-tooltip",value:e.usernameHelp,expression:"usernameHelp"}],staticClass:"username-question"},[t("span",{staticClass:"icon-help-round"})])]),e.showEmailUsers?t("div",{staticClass:"login-box-row label"},[t("div",{staticClass:"select"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.emailUser,expression:"emailUser"}],attrs:{id:"emailuser",name:"emailuser"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.emailUser=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:"null",disabled:"",selected:""}},[e._v("Username and company")]),e._l(e.availableEmailUsers,(function(s){return t("option",{key:s.UserName,domProps:{value:s.UserName}},[e._v(e._s(s.UserName)+", "+e._s(s.CompanyName)+" ("+e._s(s.CompanyNumber)+")")])}))],2)])]):e._e(),t("div",{staticClass:"login-box-row label"},[t("input",{ref:"password",attrs:{type:"password",id:"password",name:"password",autocomplete:"off",placeholder:"Password"}})]),t("div",{staticClass:"login-box-row buttons"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"loader"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button green",attrs:{type:"submit",value:"Login",id:"loginButton"}})]),t("div",{staticClass:"login-box-row buttons"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.rememberMe,expression:"rememberMe"}],attrs:{type:"checkbox",id:"rememberMe",name:"rememberMe"},domProps:{checked:Array.isArray(e.rememberMe)?e._i(e.rememberMe,null)>-1:e.rememberMe},on:{change:function(t){var s=e.rememberMe,r=t.target,i=!!r.checked;if(Array.isArray(s)){var a=null,o=e._i(s,a);r.checked?o<0&&(e.rememberMe=s.concat([a])):o>-1&&(e.rememberMe=s.slice(0,o).concat(s.slice(o+1)))}else e.rememberMe=i}}}),t("label",{attrs:{for:"rememberMe"}},[e._v("Remember my username")])]),t("div",{staticClass:"login-box-row buttons stacked"},[t("router-link",{attrs:{to:{path:"/Recover",query:{redirectUrl:e.redirectUrl}}}},[e._v(" I have forgotten my password ")])],1)])])])])]),t("CitrixLogin")],1)])},h=[],m=(s("14d9"),function(){var e=this;e._self._c;return e._m(0)}),p=[function(){var e=this,t=e._self._c;return t("div",{attrs:{id:"citrixlogin"}},[t("a",{attrs:{href:"https://citrix.affinitylogon.com/"}},[e._v("Affinity Desktop User Login")])])}],v={name:"CitrixLogin"},f=v,g=Object(o["a"])(f,m,p,!1,null,null,null),w=g.exports,y=function(){var e=this;e._self._c;return e._m(0)},b=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-underlay-header"},[t("div",{staticClass:"companylogo"},[t("img",{attrs:{alt:"",src:"https://cdn.jsdelivr.net/gh/affinityteam/www-assets/v1/images/logo/affinity1_300_90.png"}})]),t("div",{staticClass:"heading"},[e._v("Affinity Self Service")]),t("div",{staticClass:"heading mobile"},[e._v("Self Service")])])}],A={name:"Header"},C=A,P=Object(o["a"])(C,y,b,!1,null,null,null),U=P.exports,E=function(){var e=this;e._self._c;return e._m(0)},S=[function(){var e=this,t=e._self._c;return t("div",{staticClass:"login-underlay-footer"},[t("img",{attrs:{alt:"",src:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADgAAAAWCAMAAACi/q9qAAADAFBMVEXA1tbIz9DI3d2ClpaQenv4AACwOzigoKD////KAAB6goKlISOsAAC0s7OSmpnFxcW0AACMjIyJiYmLi4uUlJR4eHjyGhHsAATqAATyDw/mBAnp9/ff4+ONkpJTZWVYWFiUkpFoa2vqFhAAAADjFRXI//+c19yleXuABQWCBweQpqaolJSGGxvVPDyYx8jOzs7JKCujc3ZePT2DPz9wGxvLdXdvb2/mhYepFBLLeHorAADgGxqMFxdPJCafeXndAAHnAADMoKNnAACXRkjaFRrwAAXllJSILi7fSUnSsbHaVVXo9PSZJyjN7O/vMTN2h4nCOTzKCQuOYGHCCw7mdHO1urqzNznNeXzx7Oy75ujLaGrQ7O20AAC+ERTOhYXb8/WSNDbjtrfQ///ZHiLZgILdw8TE7+6yFhnH1NTr6+vo1tfE6elyTU3CICLe39/Pi42pEBXRDA7Yi43MX2HNpqc3AADIvb1jAADYAADxAAbdMjO/JSnC+/7D19iwCg/WbXDKs7Ow6e69AADHPkG4Gx3k7u/CZmfEQ0azLjHPUVPEmpyjDA98AAC4QkW4PD7Gxsfs0dLdu7zIEBLv2NnXmZrmxsXPfH6bAANIAABRAAB5AABxAAKpuLm7yszAPkGzsLDKGx6ux8ifAgWqpqe3wcP4AAChHB3BTE/1+fn89/agCQzGVFe0JSfWj5Lx29z37O3HyspbAADg5ufNAADEAAXR8vPn///4//+zAgfhoKDQMzS+NTfJYWPR4uPbJymAAADdmJrHAQW6AAC+REewHyGzAAPx1db18vLFAQbU2dr8///sv8DCWVu5LC7HAADdCAymAADuzc68AAXx///qAADeqqytAADTAgX05eXgAADt//+xAADG5eaKAAD04OCjAgWeAADaDRCqAQWYAADg///TAACqAACrAACGAADmAwnDAADEAAawAQXdAQScAgWSAADeAACPAAChAACoAACVAACTAADyAAbpAASaAADqAACXAADyAAXEAQbnAwn////6AAXsvBa+AAAAJHRSTlPO9Ljmtb2ZwTxygebOZlnj4CfdQfGPntzAHTxZHKUiOv4KwgBSaHnXAAAD/ElEQVR42pWSZVQcZxiFp+6eagTo1t29TTVGXJvQeNI0RjyhuLtbAsHdncWlaJYVdgMrLGuwygJZdnYG5gz0a95hz8nv9DnnvXPnnnn+DcYCnJZz+l0fWsH6PzCigys6/mEN0j34wKt3yQsvM6JTFXrWwWnF/UP1W4b/tTMBZy8TcHfaYrc/XgHxebSEBTyyVf6x+QawMDm5sDBZB7HInReYGerqmLwJ4pLjzzHi07hLHm0cn5IIbcZRo9BoM/QaDb2NRtuoxGY0GHolNptQ0jsqNMLS2NgIYibHiREf16R7RZI0XcaNrTgWKOqrCNEc6cRxfp9xnNunuoC3iETcFlzYVKE6L5RMTYGYG8Na9sSjTz5m2ZFefT3ShDp7yjRITJUjiwj1aBCiVSpNKcJDS7/qREQnUvegbnx8HETHzKeKOGnZCt/ctGvV1QcQQRNnkVpZiKyyvsqEBBmJopVnEaESd4Qisvi8kkDdlFoN4hdFAzu2nvpk0wZnx29SUn5BGi3VgyJMsTIlihYlJ6qsKKqjHJnQPhMXsrwjCpVQOTkY65mahk/J083NJZ9Vsb+/VP1znEyVaD0oE1UWaFEBoUw6YyqvTCreqVTJYitDlbzipOI91qu3bmGsvIbILdubxE3b2zs4+y+lXEnVUARhvVpitWhpQkvAWakI0qIlCdpKUlaihAAPRAf2e7VH2vz8/Hbv+7ZDfuradZOWpCxawkKSBHwMlSJoLa3VWkiLlaJIi4Wkchhx+bvCdfL6Pe7tYbtbu37IA7G7f+CEZmf/7w0VdFQRiqN5RRFUQll0v6w/keTBHKvB1eoc7L7V+rW6jfk+n4crcse+87qSSg4kCg8e60YZLRm2ATEffc1D3ngDvxB5ZyB+60BLS7dwHMDeeXuMsyHfx3N/Gyc7i2hLNeEn2Gf4whB5cLBx85A3XsjnyRsNzh4Z8rJCeWCpnBc8JZkCsLS3pvPSR8TsoaCg7HiCraRH/ZNd2SEeOvHRvQG6bV1df7Tq/LtqPDbr4nS7oIuPnu66CWD3HnB703Nb7Zr3uUOO0vVBhCH+pwVz266P6s1mQfyhUkFbcsChLEF9VoCL+aKvudXFbL4h+AfAlq71z8pG3KbOmg96asPDbWb9RUVMlbT5z78UMfoLJxVV5/SXFQpffdhJfbPnuTCYL+v1UqkUY6F1tYFputff2FTg1qzbK5COzPzaPjMyPTg4ODYzMwZ1ZOXhwzAwb9MrYR2bmQYw1sNojV5QsHq92c19yKd2em5ubnh4GA6Aag9Ie7HPDPCvLnVe5f7axGD7qoYvR378bX5+fvbvWYhZCKjzwGK1b8zM8BKIrGVYemZuptc9G/Pz/7tLXmTdBlo1OE6PvWbFAAAAAElFTkSuQmCC"}})])}],x={name:"Footer"},_=x,N=Object(o["a"])(_,E,S,!1,null,null,null),k=N.exports,O={name:"Login",props:["errorMsg"],components:{CitrixLogin:w,Header:U,Footer:k},data(){return{usernameHelp:"This can be your username, email, or membership number (but not your surname).",error:this.errorMsg||"",loading:!1,userName:"",availableEmailUsers:null,rememberMe:!1,redirectUrl:"",emailUser:null,title:""}},computed:{showEmailUsers(){return this.availableEmailUsers&&this.availableEmailUsers.length>1}},methods:{populatePage(){this.loading=!0,"undefined"!=typeof this.$route.query&&"undefined"!=typeof this.$route.query.redirectUrl&&(this.redirectUrl=this.$route.query.redirectUrl),this.$ajax.post("/auth/PopulatePage",{RedirectUrl:this.$validUrl(this.redirectUrl)?this.redirectUrl:""}).then(async e=>{if("undefined"!=typeof e.data){const{Error:s,ClientRedirect:r,RedirectUrl:i,RedirectPage:a,UserName:o,RememberMe:n,EmailUsers:l}=e.data;if(s)this.error=e.data.Error;else if(r&&RedirectUrl)window.location.href=i;else if(null!=a){var t={};"SetupQuestions"==a&&Questions.length&&(t={questions:Questions}),this.$router.push({name:a,params:t,query:{redirectUrl:i}})}n&&o&&(this.userName=o,this.rememberMe=!0),null!=l&&null!=l.Users&&(this.availableEmailUsers=l.Users)}}).catch(()=>{}).then(()=>{this.loading=!1})},checkEmail(){let e=this.userName;e&&this.$validateEmail(e)&&(this.loading=!0,this.$ajax.get("/auth/CheckEmail",{params:{email:e}}).then(e=>{this.userName==e.data.EmailAddress&&(this.availableEmailUsers=e.data.Users)}).catch().then(()=>{this.loading=!1}))},handleFormSubmit(){let e={redirectUrl:this.$validUrl(this.redirectUrl)?this.redirectUrl:"",userName:this.userName,password:this.$refs.password.value,rememberMe:this.rememberMe,emailUser:this.emailUser};this.error="",""==e.userName&&""==e.password?this.error="Username and Password cannot be blank.":""==e.userName?this.error="Username cannot be blank.":""==e.password&&(this.error="Password cannot be blank."),""==this.error&&(this.loading=!0,this.$ajax.post("/auth/login",e).then(async e=>{if("undefined"!=typeof e.data){const{Error:t,ClientRedirect:s,RedirectUrl:r,RedirectPage:i}=e.data;if(null!=t)this.error=e.data.Error;else{const{authenticated:t,mfaRequired:a,otpChannels:o}=await this.$checkMFACookie(),n=a&&!t;if(s&&r.length)n?this.$router.push({name:"MFA",params:{redirectUrl:r,otpChannels:o}}):(await this.$ajax.post("/legacy/success",null,{withCredentials:!0}),window.location.href=r);else if(i){let t={questions:void 0,otpChannels:o||void 0,mfaNotSet:n||void 0};"SetupQuestions"==i&&Questions.length&&(t.questions=e.data.Questions),this.$router.push({name:i,params:t,query:{redirectUrl:r}})}}}}).catch(()=>{}).then(()=>{this.loading=!1}))}},async mounted(){this.title=this.$router.history.current.meta.title,this.populatePage()}},T=O,q=Object(o["a"])(T,c,h,!1,null,null,null),R=q.exports,$=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Setup Your Email",error:e.error}},[t("form",{staticClass:"card-body",attrs:{method:"post"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"left",margin:"auto"}},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.WorkEmail,expression:"WorkEmail"}],staticClass:"long",attrs:{type:"text",placeholder:"Enter Work Email"+(e.homeEmailRequired?"*":" (Optional)")},domProps:{value:e.WorkEmail},on:{input:function(t){t.target.composing||(e.WorkEmail=t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.HomeEmail,expression:"HomeEmail"}],staticClass:"long",attrs:{type:"text",placeholder:"Enter Personal Email (Optional)"},domProps:{value:e.HomeEmail},on:{input:function(t){t.target.composing||(e.HomeEmail=t.target.value)}}})]),t("div",{staticClass:"form-row",staticStyle:{"text-align":"center"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button large blue",attrs:{type:"submit",value:"Continue"}})])])])])},D=[],L=function(){var e=this,t=e._self._c;return t("div",[t("div",{staticClass:"login-underlay",attrs:{id:"login-underlay"}},[t("Header"),t("Footer")],1),t("div",{staticClass:"absolut-full content errorpage"},[t("div",{staticClass:"section setup-body"},[t("div",{staticClass:"section-body"},[t("div",{staticClass:"setup-content"},[t("h1",{directives:[{name:"show",rawName:"v-show",value:!e.hidePageTitle,expression:"!hidePageTitle"}]},[e._v(" "+e._s(e.title)+" ")]),e.success?t("div",{},[t("p",{staticStyle:{color:"#44ec72"}},[e._v(e._s(e.success))])]):e._e(),e.error?t("div",{},[t("p",{staticStyle:{color:"red"},domProps:{innerHTML:e._s(e.error)}})]):e._e(),t("div",{},[e._t("default")],2)])])])])])},I=[],j={name:"Setup",components:{Header:U,Footer:k},props:["title","error","hidePageTitle","success"],mounted(){}},F=j,M=Object(o["a"])(F,L,I,!1,null,null,null),H=M.exports,V={name:"Emails",components:{Setup:H},data(){return{error:"",loading:!1,redirectUrl:"",WorkEmail:"",HomeEmail:"",requiresMfa:void 0,homeEmailRequired:!1}},methods:{async checkCompanyMfa(){const{requiresMfa:e,contactDetailsAvailable:t}=await this.$ajax.get(this.$apiUrl+"/api/Setup/company-check",{withCredentials:!0});this.requiresMfa=e,this.homeEmailRequired=t},handleFormSubmit(){let e={redirectUrl:this.redirectUrl,HomeEmail:this.HomeEmail,WorkEmail:this.WorkEmail};this.error="",this.homeEmailRequired&&!e.WorkEmail?this.error="Work email is required.":"undefined"!=typeof e.WorkEmail&&e.WorkEmail.length&&!this.$validateEmail(e.WorkEmail)?this.error="Work email is not valid.":"undefined"!=typeof e.HomeEmail&&e.HomeEmail.length&&!this.$validateEmail(e.HomeEmail)&&(this.error="Personal email is not valid."),""==this.error&&(this.loading=!0,this.$ajax.post("/Setup/Emails",e).then(async e=>{if("undefined"!=typeof e.data){const{Error:t,ClientRedirect:s,RedirectUrl:r,RedirectPage:i}=e.data;if(null!=t)this.error=e.data.Error;else if(s&&r.length){const{authenticated:e,mfaRequired:t,otpChannels:s}=await this.$checkMFACookie(),i=t&&!e;i?this.$router.push({name:"MFA",params:{redirectUrl:r,otpChannels:s}}):window.location.href=r}else if(null!=i){const e=null!=r?{redirectUrl:r}:{};this.$router.push({name:i,query:e})}}}).catch(()=>{}).then(()=>{this.loading=!1}))}},mounted(){"undefined"!=typeof this.$route.query&&"undefined"!=typeof this.$route.query.redirectUrl&&(this.redirectUrl=this.$route.query.redirectUrl),console.log("Emails Page mount"),this.checkCompanyMfa()}},Q=V,z=Object(o["a"])(Q,$,D,!1,null,null,null),W=z.exports,Y=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Reset Your Password",error:e.error,hidePageTitle:e.hidePageTitle}},[t("form",{staticClass:"card-body",attrs:{method:"post"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"center",margin:"auto"}},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.userName,expression:"userName"},{name:"show",rawName:"v-show",value:!e.hideInput,expression:"!hideInput"}],staticClass:"long",attrs:{type:"text",autocomplete:"off",placeholder:"Username or email"},domProps:{value:e.userName},on:{input:[function(t){t.target.composing||(e.userName=t.target.value)},e.checkEmail]}})]),e.showEmailUsers?t("div",{staticClass:"form-row label"},[t("select",{directives:[{name:"model",rawName:"v-model",value:e.emailUser,expression:"emailUser"}],staticStyle:{width:"500px","box-sizing":"content-box"},attrs:{id:"emailuser",name:"emailuser"},on:{change:function(t){var s=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.emailUser=t.target.multiple?s:s[0]}}},[t("option",{attrs:{value:"null",disabled:"",selected:""}},[e._v("Username and company")]),e._l(e.availableEmailUsers,(function(s){return t("option",{key:s.EmployeeNumber,domProps:{value:s.UserName}},[e._v(e._s(s.UserName)+", "+e._s(s.CompanyName)+" ("+e._s(s.CompanyNumber)+")")])}))],2)]):e._e(),t("div",{staticClass:"mt-4",staticStyle:{"text-align":"center"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button large blue",attrs:{type:"submit",value:"Continue"}})])])])])},B=[],G={name:"Recover",data(){return{error:"",loading:!1,userName:"",redirectUrl:"",availableEmailUsers:null,instructionsMessage:"",hideInput:!1,emailUser:null,hidePageTitle:!1}},components:{Setup:H},computed:{showEmailUsers(){return this.availableEmailUsers&&this.availableEmailUsers.length>1}},methods:{handleFormSubmit(){let e={redirectUrl:this.redirectUrl,userName:this.userName,emailUser:this.emailUser,targetPath:this.$route.path};this.error="",""==e.userName&&(this.error="Username cannot be blank."),""==this.error&&(this.loading=!0,this.$ajax.post("/Password/Recover",e).then(e=>{if(e.data)if(e.data.Error)this.error=e.data.Error;else{const t=!!e.data.email||!e.data.mobileNumber&&null;if(e.data.hasCompleteAnswers||null!==t){const s={sentToEmail:t,email:e.data.email,mobileNumber:e.data.mobileNumber,token:e.data.token};this.$router.push({name:null==t?"VerifyAnswer":"OTP",params:s})}else this.$router.push({name:"Login",params:{errorMsg:"Your email, phone number and security questions are not set up. Please contact your admin to reset your password."},query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})}}).finally(()=>{this.loading=!1}))},validateEmail(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(String(e).toLowerCase())},checkEmail(){let e=this.userName;e&&this.validateEmail(e)&&(this.loading=!0,this.$ajax.get("/auth/CheckEmail",{params:{email:e}}).then(e=>{this.userName==e.data.EmailAddress&&(this.availableEmailUsers=e.data.Users),this.error=""}).catch().then(()=>{this.loading=!1}))},verifyToken(e,t){this.hideInput=!0,this.loading=!0,this.hidePageTitle=!0;let s={token:e,userId:t,redirectUrl:this.redirectUrl};this.$ajax.post("/Password/VerifyToken",s).then(e=>{"undefined"!=typeof e.data&&(null!=e.data.Error?this.error=e.data.Error:null!=e.data.RedirectPage&&(this.instructionsMessage=e.data.InstructionsMessage,this.$router.push({name:e.data.RedirectPage,query:{redirectUrl:this.redirectUrl}})))}).catch(()=>{}).then(()=>{this.loading=!1})}},mounted(){this.$route.query,this.redirectUrl=this.$route.query.redirectUrl||"","undefined"!=typeof this.$route.query.token&&"undefined"!=typeof this.$route.query.userId&&this.verifyToken(this.$route.query.token,this.$route.query.userId)}},X=G,Z=Object(o["a"])(X,Y,B,!1,null,null,null),K=Z.exports,J=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Setup Password",error:e.error}},[t("form",{staticClass:"card-body",attrs:{method:"post"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("passwordPage",{attrs:{loading:e.loading},model:{value:e.output,callback:function(t){e.output=t},expression:"output"}})],1)])},ee=[],te={name:"SetupPassword",props:["mfaNotSet","otpChannels"],data(){return{error:"",loading:!1,redirectUrl:"",output:{password:"",confirmPassword:""}}},components:{Setup:H},methods:{handleFormSubmit(){let e={redirectUrl:this.redirectUrl,password:this.output.password,confirmPassword:this.output.confirmPassword};this.error="",""==e.password&&""==e.confirmPassword?this.error="Password fields cannot be blank.":""==e.confirmPassword?this.error="Confirm Password field cannot be blank.":""==e.password?this.error="Password field cannot be blank.":e.password!=e.confirmPassword&&(this.error="Password fields do not match."),""==this.error&&(this.loading=!0,this.$ajax.post("/Setup/Password",e).then(async e=>{if("undefined"!=typeof e.data){const{Error:t,ClientRedirect:s,RedirectUrl:r,RedirectPage:i}=e.data;if(null!=t)this.error=t;else{let e=this.otpChannels;if(void 0==this.mfaNotSet){const{authenticated:t,mfaRequired:s,otpChannels:r}=await this.$checkMFACookie();this.mfaNotSet=s&&!t,e=r}if(s&&r.length)this.mfaNotSet?this.$router.push({name:"MFA",params:{redirectUrl:r,otpChannels:e||void 0}}):window.location.href=r;else if(null!=i){const t={redirectUrl:r||void 0};let s={mfaNotSet:this.mfaNotSet||void 0,otpChannels:e};this.$router.push({name:i,params:s,query:t})}}}}).catch(()=>{}).then(()=>{this.loading=!1}))}},mounted(){"undefined"!=typeof this.$route.query&&"undefined"!=typeof this.$route.query.redirectUrl&&(this.redirectUrl=this.$route.query.redirectUrl)}},se=te,re=Object(o["a"])(se,J,ee,!1,null,null,null),ie=re.exports,ae=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Setup Security Questions",error:e.error}},[t("form",{staticClass:"card-body",attrs:{method:"post",id:"form-questions-setup"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"left",margin:"auto"}},[e._l(e.answers,(function(s){return t("div",{key:s,staticStyle:{display:"inline-block"}},[t("div",{staticClass:"title-row section-title"},[e._v("Question "+e._s(s.count))]),t("div",{staticClass:"form-row"},[t("select",{directives:[{name:"model",rawName:"v-model",value:s.questionId,expression:"answer.questionId"}],staticClass:"long",on:{change:function(t){var r=Array.prototype.filter.call(t.target.options,(function(e){return e.selected})).map((function(e){var t="_value"in e?e._value:e.value;return t}));e.$set(s,"questionId",t.target.multiple?r:r[0])}}},e._l(e.questionList,(function(s){return t("option",{key:s,domProps:{value:s.Value}},[e._v(" "+e._s(s.Text)+" ")])})),0)]),t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:s.value,expression:"answer.value"}],staticClass:"long",attrs:{type:"text"},domProps:{value:s.value},on:{input:function(t){t.target.composing||e.$set(s,"value",t.target.value)}}})])])})),t("div",{staticClass:"form-row",staticStyle:{"text-align":"center"}},[t("div",{staticClass:"mt-4"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button large blue",attrs:{type:"submit",value:"Continue"}})])])],2)])])},oe=[],ne={name:"SetupQuestions",props:["questions","mfaNotSet","otpChannels"],components:{Setup:H},data(){return{error:"",loading:!1,questionList:this.questions,redirectUrl:"",data:{},answers:{answer1:{count:"1",questionId:1,value:""},answer2:{count:"2",questionId:1,value:""},answer3:{count:"3",questionId:1,value:""}}}},methods:{handleFormSubmit(){let e=Object.assign({},this.answers);e.redirectUrl=this.redirectUrl,this.error="";let t=[];for(var s in this.answers)if(this.answers.hasOwnProperty(s)){if(""==this.answers[s].value){this.error="All answers must be filled out.";break}if(t.includes(this.answers[s].questionId)){this.error="You need to select and answer three different questions.";break}t.push(this.answers[s].questionId)}""==this.error&&(this.loading=!0,this.$ajax.post("/Setup/Questions",e).then(async e=>{const{Error:t,ClientRedirect:s,RedirectUrl:r,RedirectPage:i}=e.data;if("undefined"!=typeof e.data)if(null!=t)this.error=t;else{let e=this.otpChannels;if(void 0==this.mfaNotSet){const{authenticated:t,mfaRequired:s,otpChannels:r}=await this.$checkMFACookie();this.mfaNotSet=s&&!t,e=r}if(s&&r)this.mfaNotSet?this.$router.push({name:"MFA",params:{redirectUrl:r,otpChannels:e||void 0}}):window.location.href=r;else if(i){const t={redirectUrl:r||void 0};let s={mfaNotSet:this.mfaNotSet||void 0,otpChannels:e};this.$router.push({name:i,params:s,query:t})}}}).catch(()=>{}).then(()=>{this.loading=!1}))},populatePage(){this.loading=!0,this.$ajax.get("/Setup/Questions").then(e=>{"undefined"!=typeof e.data&&(null!=e.data.Error?this.error=e.data.Error:null!=e.data.Questions&&(this.questionList=e.data.Questions))}).catch(()=>{}).then(()=>{this.loading=!1})}},mounted(){null==this.questionList&&this.populatePage(),"undefined"!=typeof this.$route.query&&"undefined"!=typeof this.$route.query.redirectUrl&&(this.redirectUrl=this.$route.query.redirectUrl)}},le=ne,ue=Object(o["a"])(le,ae,oe,!1,null,null,null),de=ue.exports,ce=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Answer Security Questions",error:e.error}},[t("form",{staticClass:"card-body",attrs:{method:"post",id:"form-questions-setup"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{margin:"0 auto","text-align":"left"}},[t("div",{staticClass:"title-row section-title",staticStyle:{"text-align":"center"}},[e._v(" "+e._s(e.userInfo)+" ")]),e._l(e.questionList,(function(s,r){return t("div",{key:s.id,staticClass:"form-row security-question"},[t("span",[e._v(" "+e._s(s.Text)+" ")]),t("input",{directives:[{name:"model",rawName:"v-model",value:e.questionList[r].Id,expression:"questionList[index].Id"}],attrs:{type:"hidden"},domProps:{value:e.questionList[r].Id},on:{input:function(t){t.target.composing||e.$set(e.questionList[r],"Id",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.questionList[r].Text,expression:"questionList[index].Text"}],attrs:{type:"hidden"},domProps:{value:e.questionList[r].Text},on:{input:function(t){t.target.composing||e.$set(e.questionList[r],"Text",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.questionList[r].AnswerId,expression:"questionList[index].AnswerId"}],attrs:{type:"hidden"},domProps:{value:e.questionList[r].AnswerId},on:{input:function(t){t.target.composing||e.$set(e.questionList[r],"AnswerId",t.target.value)}}}),t("input",{directives:[{name:"model",rawName:"v-model",value:e.questionList[r].AnswerText,expression:"questionList[index].AnswerText"}],staticClass:"long",attrs:{type:"text"},domProps:{value:e.questionList[r].AnswerText},on:{input:function(t){t.target.composing||e.$set(e.questionList[r],"AnswerText",t.target.value)}}})])})),t("div",{staticClass:"form-row",staticStyle:{"text-align":"center"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button large blue",attrs:{type:"submit",value:"Continue"}})]),t("div",{directives:[{name:"show",rawName:"v-show",value:null!==e.sentToEmail,expression:"sentToEmail !== null"}],staticClass:"form-row",staticStyle:{"text-align":"center"}},[t("button",{staticClass:"button large green",on:{click:e.handleGoToOTP}},[e._v(" Back to OTP ")])])],2)])])},he=[],me=s("bc3a"),pe=s.n(me),ve={install(e,t){pe.a.defaults.headers.common["X-Requested-With"]="XMLHttpRequest",t&&t.handleUnautorized&&(pe.a.interceptors.request.use(e=>e),pe.a.interceptors.response.use(e=>e,e=>Promise.reject(e.response.data))),e.prototype.$ajax=pe.a,e.ajax=pe.a}};const fe={SUCCESS:"SUCCESS",FAILED:"FAILED",TOKEN_EXPIRED:"TOKEN_EXPIRED",EXPIRED:"EXPIRED",UNKNOWN_USER:"UNKNOWN_USER",BAD_REQUEST:"BAD_REQUEST",NOT_FOUND:"NOT_FOUND",SERVER_ERROR:"SERVER_ERROR"},ge=(e,t)=>{switch(e){case fe.FAILED:if("QUESTIONS"===t)return"You need to answer all three security questions correctly before your password can be reset.";if("PASSWORD"===t)return"Please complete all fields.";if("SEND_OTP"===t)return"Sending of OTP confirmation code has failed. Please try again later.";if("VERIFY_OTP"===t)return"You entered the wrong code. Please try again.";case fe.TOKEN_EXPIRED:return"You are away for several minutes.";case fe.EXPIRED:return"Confirmation code is already expired.";case fe.UNKNOWN_USER:return"You need to enter a valid username or email address.";case fe.BAD_REQUEST:return"Something went wrong. Please try again after 5 minutes.";case fe.SERVER_ERROR:return"Something went wrong. Please try again after 5 minutes.";default:return""}};var we={name:"VerifyAnswer",props:["redirectUrl","sentToEmail","email","mobileNumber","token","questions"],components:{Setup:H},data(){return{error:"",loading:!1,questionList:[],data:{},userInfo:""}},methods:{handleFormSubmit(){if(this.error="",this.questionList.forEach(e=>{""===e.AnswerText&&(this.error="All answers must be filled out.")}),""!=this.error)return;this.loading=!0;const e={Questions:this.questionList};this.$ajax.post("/Password/VerifyAnswers",e,{headers:{Authorization:this.token}}).then(e=>{const t=ge(e.data.result,"QUESTIONS");t?(this.error=t,this.loading=!1):e.data.verified&&this.$router.push({name:"SetNew",params:{redirectUrl:this.redirectUrl},query:{token:e.data.token}})}).then(e=>{const t=this;"UNATHORIZED"==e.result&&(this.error="Your session has expired! Redirecting you back to Forgot Password page.",setTimeout(()=>{t.$router.push({name:"Recover",query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})},5e3)),this.loading=!1})},handleGoToOTP(){const e={sentToEmail:this.sentToEmail,email:this.email,mobileNumber:this.mobileNumber,token:this.token};this.$router.push({name:"OTP",params:e})},populatePage(){this.loading=!0,this.$ajax.get("/Password/GetSecurityQuestions",{headers:{Authorization:this.token}}).then(e=>{"undefined"!=typeof e.data&&(e.data.error?this.error=e.data.errorMsg:e.data.Questions.length&&(this.questionList=e.data.Questions,this.userInfo=`${e.data.companyname} / ${e.data.firstname} ${e.data.lastname}`))}).catch(()=>{}).then(()=>{this.loading=!1})}},mounted(){this.token?this.populatePage():this.$router.push({name:"Recover",query:this.$route.query.redirectUrl?{redirectUrl:this.$route.query.redirectUrl}:void 0})}},ye=we,be=Object(o["a"])(ye,ce,he,!1,null,null,null),Ae=be.exports,Ce=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Reset Password",error:e.error,success:e.success}},[t("form",{staticClass:"card-body",attrs:{method:"post"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("h3",[e._v(e._s(e.pageSubtitle))]),t("passwordPage",{attrs:{loading:e.loading},model:{value:e.output,callback:function(t){e.output=t},expression:"output"}})],1)])},Pe=[],Ue=function(){var e=this,t=e._self._c;e._self._setupProxy;return t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"left",margin:"auto"}},[t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.output.password,expression:"output.password"}],staticClass:"long",attrs:{type:"password",placeholder:"Enter your new password"},domProps:{value:e.output.password},on:{input:function(t){t.target.composing||e.$set(e.output,"password",t.target.value)}}})]),t("div",{staticClass:"form-row"},[t("input",{directives:[{name:"model",rawName:"v-model",value:e.output.confirmPassword,expression:"output.confirmPassword"}],staticClass:"long",attrs:{type:"password",placeholder:"Re-enter your new password"},domProps:{value:e.output.confirmPassword},on:{input:function(t){t.target.composing||e.$set(e.output,"confirmPassword",t.target.value)}}})]),t("div",{staticClass:"form-row",staticStyle:{"text-align":"center"}},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.loading,expression:"loading"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.loading,expression:"!loading"}],staticClass:"button large blue",attrs:{type:"submit",value:"Continue"}})])])},Ee=[];let Se=r["a"].extend({name:"PasswordPage",props:["passwordVal","confirmPasswordVal","loading"],data(){return{output:{password:"",confirmPassword:""}}},watch:{"output.password":function(){this.$emit("input",this.output)},"output.confirmPassword":function(){this.$emit("input",this.output)}}});r["a"].component("passwordPage",Se);var xe=Se,_e=xe,Ne=Object(o["a"])(_e,Ue,Ee,!1,null,null,null),ke=Ne.exports,Oe={name:"SetNew",props:["pageSubtitle","userId","redirectUrl"],components:{PasswordPage:ke},data(){return{error:"",loading:!1,token:"",success:"",output:{password:"",confirmPassword:""}}},components:{Setup:H},methods:{handleFormSubmit(){let e={Password:this.output.password,ConfirmPassword:this.output.confirmPassword,UserId:this.userId};if(this.error="",""==e.Password&&""==e.ConfirmPassword?this.error="Password fields cannot be blank.":""==e.ConfirmPassword?this.error="Confirm Password field cannot be blank.":""==e.Password?this.error="Password field cannot be blank.":e.Password!=e.ConfirmPassword&&(this.error="Password fields do not match."),""!=this.error)return;this.loading=!0;const t=this;this.$ajax.post("/Password/SetNew",e,{headers:{Authorization:this.token}}).then(e=>{"undefined"!=typeof e.data&&("FAILED"===e.data.result?(this.error=e.data.message,this.loading=!1):(this.success="You have successfully reset your password. You will be redirected to Login page in 5 seconds.",setTimeout(()=>{t.$router.push({name:"Login",query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})},5e3)))}).catch(e=>{"UNAUTHORIZED"===e.result?(this.error="Your session has expired! Redirecting you back to Forgot Password page.",setTimeout(()=>{t.$router.push({name:"Recover",query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})},5e3)):(this.loading=!1,this.error="This password reset has timed out. Go back to the login page and click I have forgotten my password.")})},verifyToken(e){this.$ajax.get("/Token/Validate",{headers:{Authorization:this.token}}).catch(e=>{const{Valid:t}=e;if(!t){this.error="Your session has expired! Redirecting you back to Forgot Password page.";const e=this.$router;setTimeout(()=>{e.push({name:"Recover",query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})},5e3)}})}},mounted(){this.token=this.$route.query.token||"",this.token&&!this.pageLoaded&&this.verifyToken(this.token)}},Te=Oe,qe=Object(o["a"])(Te,Ce,Pe,!1,null,null,null),Re=qe.exports,$e=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Reset Your Password",error:e.error,hidePageTitle:e.hidePageTitle}},[e.sendingOtp?t("div",{staticClass:"otp-sending-progress"},[t("div",[t("span",[e._v("Sending your code")])])]):e._e(),e.verifyingOtp?t("div",{staticClass:"otp-sending-progress"},[t("div",[e._v("Verifying confirmation code..."),t("span",{staticStyle:{"white-space":"nowrap"}},[e._v("Please wait")])])]):e._e(),t("form",{staticClass:"card-body",attrs:{method:"post"},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"center",margin:"auto"}},[t("p",{staticClass:"p-activation-note"},[t("strong",[e._v("To confirm your identity, ")]),e._v(" enter the code sent to"),t("br"),t("span",[e._v(e._s(e.otpToEmail?e.email:e.mobileNumber))])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"otp-control"},[t("v-otp-input",{ref:"otpInput",attrs:{"input-classes":"otp-input",separator:"","num-inputs":6,"should-auto-focus":!0,"is-input-num":!1},on:{"on-change":e.handleOtpChange,"on-complete":e.handleOtpComplete}})],1)]),t("div",{staticClass:"form-row"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.verifyingOtp,expression:"verifyingOtp"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.verifyingOtp,expression:"!verifyingOtp"}],ref:"submitBtn",staticClass:"button large blue",attrs:{type:"submit",value:"Verify Code"}})]),t("div",{staticClass:"form-row",staticStyle:{"line-height":"2em"}},[t("a",{staticStyle:{cursor:"pointer"},on:{click:e.sendOtp}},[e._v("Resend the code")]),t("br"),e.email&&!e.otpToEmail?t("span",{},[t("a",{staticStyle:{cursor:"pointer"},on:{click:e.handleSwitchOtpReceiver}},[e._v("Send the code ("+e._s(e.email)+")")]),e._v(" "),t("br")]):e._e(),e.mobileNumber&&e.otpToEmail?t("span",{},[t("a",{staticStyle:{cursor:"pointer"},on:{click:e.handleSwitchOtpReceiver}},[e._v("Send the code ("+e._s(e.mobileNumber)+")")]),e._v(" "),t("br")]):e._e(),t("a",{staticStyle:{cursor:"pointer"},on:{click:e.handleGoToQuestions}},[e._v("Take me to my secret questions")])])])])])},De=[],Le={name:"OTP",props:["sentToEmail","email","mobileNumber","redirectUrl","token"],data(){return{otpToEmail:this.$props.sentToEmail,sendingOtp:!1,verifyingOtp:!1,code:"",error:"",hidePageTitle:!1}},methods:{handleFormSubmit(){if(!this.code||this.code.length<6)return this.error="Insert the confirmation code that was sent to your\n\t\t\t\t\t\t"+(this.otpToEmail?"email address ("+this.email+")":"contact number ("+this.mobileNumber+")"),!1;this.error="";const e=this.otpToEmail?"/Password/VerifyEmailOTP":"/Password/VerifySMSOTP";this.verifyingOtp=!0,this.$ajax.post(e,{verificationCode:this.code},{headers:{Authorization:this.token}}).then(e=>{this.verifyingOtp=!1;const t=ge(e.data.result,"VERIFY_OTP");""===t?this.$router.push({name:"SetNew",params:{redirectUrl:this.redirectUrl},query:{token:e.data.token}}):(this.error=t,this.$refs.otpInput.clearInput())}).finally(()=>this.verifyingOtp=!1)},handleOtpChange(e){this.code=e},handleOtpComplete(e){this.code=e,setTimeout(()=>{this.$refs.submitBtn.focus()},10)},sendOtp(){const e=this.otpToEmail?"/Password/SendOTPToEmail":"/Password/SendOTPToSMS";this.sendingOtp=!0,this.$ajax.get(e,{headers:{Authorization:this.token}}).then(e=>{const t=ge(e.result,"SEND_OTP");t&&(this.error=t)}).catch(e=>{const t=this;"UNAUTHORIZED"===e.result?(this.error="Your session has expired! Redirecting you back to Forgot Password page.",setTimeout(()=>{t.$router.push({name:"Recover",query:this.redirectUrl?{redirectUrl:this.redirectUrl}:void 0})},5e3)):"SERVER_ERROR"===e.result&&(this.error=ge(e.result))}).finally(()=>{this.sendingOtp=!1})},handleSwitchOtpReceiver(){this.otpToEmail=!this.otpToEmail,this.sendOtp()},handleGoToQuestions(){this.$router.push({name:"VerifyAnswer",params:{redirectUrl:this.redirectUrl,email:this.email,sentToEmail:this.sentToEmail,mobileNumber:this.mobileNumber,token:this.token}})}},components:{Setup:H},mounted(){this.token?this.sendOtp():this.$router.push({name:"Recover",query:{redirectUrl:this.$route.query.redirectUrl}})}},Ie=Le,je=Object(o["a"])(Ie,$e,De,!1,null,null,null),Fe=je.exports,Me=function(){var e=this,t=e._self._c;return t("setup",{attrs:{title:"Set your Multi-Factor Authentication (MFA)",error:e.error,hidePageTitle:e.hidePageTitle}},[e.sendingOtp?t("div",{staticClass:"otp-sending-progress"},[t("div",[t("span",[e._v("Sending your code")])])]):e._e(),e.verifyingOtp?t("div",{staticClass:"otp-sending-progress"},[t("div",[e._v("Verifying confirmation code..."),t("span",{staticStyle:{"white-space":"nowrap"}},[e._v("Please wait")])])]):e._e(),e.verifyingStatus?t("div",[e._v("Verifying token..."),t("span",{staticStyle:{"white-space":"nowrap"}},[e._v("Please wait")])]):e._e(),e.verifyingStatus?e._e():t("form",{staticClass:"card-body",attrs:{method:"post",novalidate:""},on:{submit:function(t){return t.preventDefault(),e.handleFormSubmit.apply(null,arguments)}}},[t("div",{staticClass:"default-form w-border",staticStyle:{"text-align":"center",margin:"auto"}},[t("p",{staticClass:"p-activation-note"},[t("strong",[e._v("To confirm your identity, ")])]),t("p",[e._v("Please select the contact in which do you want to receive the OTP."),t("br")]),t("div",{staticClass:"otp-block"},[t("select",{ref:"otpChannel",staticClass:"long"},e._l(e.otpChannels,(function(s){return t("option",{key:s.channel,domProps:{value:s.channel}},[e._v(" "+e._s(`${e.getOptionLabel(s.channel)} (${s.value})`)+" ")])})),0),t("button",{ref:"btnSendOTP",staticClass:"button small green",attrs:{type:"button"},on:{click:e.sendOtp}},[e._v(e._s(e.selectedChannel?"RESEND":"SEND"))])]),e.selectedChannel?t("div",[t("p",[t("strong",[e._v("Enter the code sent to your "+e._s(e.getOptionLabel(e.selectedChannel)))])]),t("div",{staticClass:"form-row"},[t("div",{staticClass:"otp-control"},[t("v-otp-input",{ref:"otpInput",attrs:{"input-classes":"otp-input",separator:"","num-inputs":6,"should-auto-focus":!0,"is-input-num":!1},on:{"on-change":e.handleOtpChange,"on-complete":e.handleOtpComplete}})],1)]),t("div",{staticClass:"form-row"},[t("div",{directives:[{name:"show",rawName:"v-show",value:e.verifyingOtp,expression:"verifyingOtp"}],staticClass:"spinner small light"}),t("input",{directives:[{name:"show",rawName:"v-show",value:!e.verifyingOtp,expression:"!verifyingOtp"}],ref:"submitBtn",staticClass:"button large blue",attrs:{type:"submit",value:"Verify Code"}})])]):e._e()])])])},He=[],Ve={name:"MFA",props:["redirectUrl","otpChannels"],data(){return{sendingOtp:!1,verifyingOtp:!1,verifyingStatus:!1,selectedChannel:"",code:"",token:"",error:"",hidePageTitle:!1}},methods:{getOptionLabel(e){switch(e){case"sms":return"Contact #";case"work-email":return"Work e-mail";case"home-email":return"Home e-mail"}},async checkOtpStatus(e,t,s){const{otpChannel:r}=this.$refs;this.verifyingStatus=!0;const i=await this.$ajax.get(this.$apiUrl+"/api/Otp/status",{params:{token:e},withCredentials:!0}),{otpChannels:a}=await this.$checkMFACookie();this.otpChannels=a,this.verifyingStatus=!1,this.redirectUrl=s,"invalid-token"!==i.data.status?(this.selectedChannel=t,this.token=e,r.value=t):this.error="OTP code is already invalid. Please request a new one"},async sendOtp(){const{otpChannel:e}=this.$refs,t={channel:e.value,token:this.token||void 0},s=await this.$ajax.post(this.$apiUrl+"/api/Otp",t,{withCredentials:!0}),{isSuccess:r,token:i}=s.data;r&&(this.selectedChannel=e.value,this.token=i,this.$router.push({name:"MFA",params:{redirectUrl:this.redirectUrl,otpChannels:this.otpChannels},query:{token:i,channel:e.value,redirectUrl:this.redirectUrl}}))},handleFormSubmit(){const{otpChannel:e}=this.$refs;if(!this.code||this.code.length<6)return this.error="Insert the confirmation code that was sent to your "+this.getOptionLabel(e),!1;this.error="",this.verifyingOtp=!0,this.$ajax.post(this.$apiUrl+"/api/Otp/verify",{code:this.code,token:this.token},{withCredentials:!0}).then(async e=>{this.verifyingOtp=!1;const t=ge(e.data.result,"VERIFY_OTP");""===t?(await this.$ajax.post("/legacy/success",null,{withCredentials:!0}),window.location.href=this.redirectUrl):(this.error=t,this.$refs.otpInput.clearInput()),this.verifyingOtp=!1})},handleOtpChange(e){this.code=e},handleOtpComplete(e){this.code=e,setTimeout(()=>{this.$refs.submitBtn.focus()},10)}},components:{Setup:H},mounted(){const{redirectUrl:e,token:t,channel:s}=this.$route.query;this.otpChannels||t?t&&this.checkOtpStatus(t,s,e):this.$router.push({name:"Login",query:{redirectUrl:this.redirectUrl||void 0}})}},Qe=Ve,ze=(s("0f77"),Object(o["a"])(Qe,Me,He,!1,null,"046d9a1e",null)),We=ze.exports;r["a"].use(d["a"]);const Ye=[{path:"/",name:"Login",component:R,props:!0,meta:{title:"Login"}},{path:"/Emails",name:"Emails",component:W,meta:{title:"Emails"}},{path:"/Recover",name:"Recover",component:K,meta:{title:"Forgot Password"}},{path:"/SetupPassword",name:"SetupPassword",component:ie,meta:{title:"Reset Password"}},{path:"/SetupQuestions",name:"SetupQuestions",component:de,props:!0,meta:{title:"Answer Security Password"}},{path:"/VerifyAnswer",name:"VerifyAnswer",component:Ae,props:!0,meta:{title:"Answer Security Password"}},{path:"/SetNew",name:"SetNew",component:Re,props:!0,meta:{title:"Reset Password"}},{path:"/Otp",name:"OTP",component:Fe,props:!0,meta:{title:"One Time Password"}},{path:"/mfa",name:"MFA",component:We,props:!0,meta:{title:"Multi-Function Authentucation"}}],Be=new d["a"]({mode:"history",base:"/",routes:Ye});var Ge=Be,Xe=s("e37d"),Ze=s("cc46"),Ke=s.n(Ze);s("a1a3");r["a"].component("v-otp-input",Ke.a),r["a"].use(ve,{handleUnautorized:!0}),r["a"].use(Xe["a"]),r["a"].prototype.$validateEmail=function(e){var t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return t.test(String(e).toLowerCase())},r["a"].prototype.$validUrl=function(e){if("function"==typeof URL){let t;try{t=new URL(e)}catch(s){return!1}return"http:"===t.protocol||"https:"===t.protocol}var t=new RegExp("^(https?:\\/\\/)?((([a-z\\d]([a-z\\d-]*[a-z\\d])*)\\.)+[a-z]{2,}|((\\d{1,3}\\.){3}\\d{1,3}))(\\:\\d+)?(\\/[-a-z\\d%_.~+]*)*(\\?[;&a-z\\d%_.~+=-]*)?(\\#[-a-z\\d_]*)?$","i");return!!t.test(e)},r["a"].prototype.$checkMFACookie=async function(){const e=await r["a"].prototype.$ajax.post(this.$apiUrl+"/api/Auth",null,{withCredentials:!0,params:{redirectUrl:this.redirectUrl}});return 200==e.status?e.data:e},Ge.afterEach((e,t)=>{r["a"].nextTick(()=>{document.title=e.meta.title||"Login"})}),caches,r["a"].prototype.$apiUrl="https://mfa.testaffinitylogon.com",r["a"].config.productionTip=!1,new r["a"]({router:Ge,render:e=>e(u)}).$mount("#app")},"5d13":function(e,t,s){},a1a3:function(e,t,s){}});
//# sourceMappingURL=app.js.map
