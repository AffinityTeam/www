function cleanDisplay(e){return"string"==typeof e&&""!==e.trim()?e.trim().replace(/&amp;/gi,"&"):e}function stripTags(e){return"string"==typeof e&&""!==e.trim()?e.replace(/<(?:.|\n)*?>/gm,""):e}function contains(e,t){return e.indexOf(t)>-1&&e.indexOf(t)}function soundex(e,t,s){var n,o,a,r,l,h="";for(e=e.toUpperCase(),h=e,h=h.replace(/[^A-Z]/gi," "),h=h.replace(/^\s*/g,""),h=h.replace(/\s*$/g,""),h=h.replace(/^GH/g,"G"),h=h.replace(/DG/g,"G"),h=h.replace(/GH/g,"H"),h=h.replace(/GN/g,"N"),h=h.replace(/KN/g,"N"),h=h.replace(/PH/g,"F"),h=h.replace(/MP([STZ])/g,"M$1"),h=h.replace(/^PS/g,"S"),h=h.replace(/^PF/g,"F"),h=h.replace(/MB/g,"M"),h=h.replace(/TCH/g,"CH"),l=h.substr(0,1),"H"!=l&&"W"!=l||(h="-"+h.substr(1)),h=h.replace(/[AEIOUYHW]/g,"0"),h=h.replace(/[BPFV]/g,"1"),h=h.replace(/[CSGJKQXZ]/g,"2"),h=h.replace(/[DT]/g,"3"),h=h.replace(/[L]/g,"4"),h=h.replace(/[MN]/g,"5"),h=h.replace(/[R]/g,"6"),r=h.length,a="",n="",i=0;i<r;i++)o=h.charAt(i),o==a?n+=" ":(n+=o,a=o);return h=n,h=h.substr(1),h=h.replace(/\s/g,""),h=h.replace(/0/g,""),h+="0000000000",h=l+h,h=h.substr(0,5)}function distance(e,t){var i=e.toLowerCase(),s=t.toLowerCase();if(0===i.length)return s.length;if(0===s.length)return i.length;var n,o=[];for(n=0;n<=s.length;n++)o[n]=[n];var a;for(a=0;a<=i.length;a++)o[0][a]=a;for(n=1;n<=s.length;n++)for(a=1;a<=i.length;a++)s.charAt(n-1)==i.charAt(a-1)?o[n][a]=o[n-1][a-1]:o[n][a]=Math.min(o[n-1][a-1]+1,Math.min(o[n][a-1]+1,o[n-1][a]+1));return o[s.length][i.length]}function returnSelectOptions(e,t,i){var s,n,o,a="";for(s=0;s<e.length;s++)n=e[s],(n.Value.toLowerCase().indexOf(t.toLowerCase())>-1||i)&&(o='<option value="'+n.Key+'">'+cleanDisplay(n.Value)+"</option>",n.Value===t&&(o='<option value="'+n.Key+'" selected>'+cleanDisplay(n.Value)+"</option>"),a+=o);postMessage({job:"getOptions",html:a})}function returnListItem(e){var t="<li";return t+=' id="'+e.uuid+"-li-"+e.originalIndex+'"',t+=' class="'+e.klass+'"',t+=' data-index="'+e.originalIndex+'"',t+=' data-value="'+e.value+'"',t+=">",t+=e.html,t+="</li>"}function returnList(e,t,i,e){for(var s,t,n,o,a,r,l,h,u=t.split("</option>"),c={defaultID:!1,items:[],html:"",total:0},d="",p=0,m=0;p<u.length;p++)if(t=u[p],0===p||""!==t.trim()){for(n=t.substring(t.indexOf(">")+1),o=cleanDisplay(n.replace(/\,/g," - ")),a=new RegExp('value="',"gi").test(t)?t.substring(t.indexOf('value="')+7,t.indexOf('"',t.indexOf('value="')+7)):"",s="visible",(new RegExp("selected","gi").test(t)||a===i)&&(s+=" selected",c.defaultID=e+"-li-"+p,initialSelected=e+"-li-"+p),r=returnListItem({uuid:e,klass:s,originalIndex:p,value:a,html:o}),c.html+=r,d+=r,c.items.push({id:e+"-li-"+p,html:r,klass:s,searchstr:n,value:a}),c.total++,l=n.trim().toLowerCase().replace(new RegExp(/ /g)," ").split(" "),h=[],m=0;m<l.length;m++)h.push(soundex(l[m]));fuzzySearchData.push({id:e+"-li-"+p,html:r,oghtml:r,klass:s,searchstr:n,value:a,words:l,wordCount:l.length,soundex:h,originalIndex:p})}originalListHTML=d,postMessage({job:"getList",data:c,html:d})}function returnResetList(){postMessage({job:"resetList",data:fuzzySearchData,html:originalListHTML,select:initialSelected})}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function fuzzySearch(e,t,i,s){if(!fuzzyRunning){fuzzyRunning=!0;var n,o,a,r,l,h,u,c,d,p,m,f,g,v,y,b,A,w,E,m,r,x=[],C=[],k=!1,S=!1;if(i=i.toLowerCase(),isNaN(i))for(y=0;y<e.length;y++){if(w=y,E=fuzzySearchData[w],o=0,[],r=E[t].toLowerCase().trim(),l=i===r,h=r.indexOf(i)>-1,d=i.split(" "),u=d.length,l)c=u,a=99999,o=99999,E.klass="visible",E.html=s?cleanDisplay(stripTags(E.html)):"<strong>"+cleanDisplay(stripTags(E.html))+"</strong>";else if(!l&&h)c=r.split(i).length-1||0,a=c,o=a+100,E.klass="visible",E.html=s<101?cleanDisplay(stripTags(E.html)).replace(new RegExp("("+escapeRegExp(i)+")","gi"),"<strong>$1</strong>"):cleanDisplay(stripTags(E.html));else if(s<1001){for(p=E.words,c=0,b=0;b<d.length;b++)for(m=d[b],A=0;A<p.length;A++)(f=p[A])&&m&&"string"==typeof f&&"string"==typeof m&&""!==f.trim()&&""!==m.trim()&&(g=soundex(m),v=E.soundex[E.words.indexOf(f)],0==distance(g,v)&&(c+=1));o=c,a=Math.round(c/u*100)/100||0,o>=0&&(E.klass="visible",E.html=s<101?cleanDisplay(stripTags(E.html)).replace(new RegExp("("+escapeRegExp(i)+")","gi"),"<strong>$1</strong>"):cleanDisplay(stripTags(E.html)))}n={uuid:E.uuid,originalIndex:w,html:E.html,value:E.value,klass:E.klass,score:o,wordScore:a},C.push(n)}else for(y=0;y<fuzzySearchData.length;y++)w=y,E=fuzzySearchData[w],-1!==E[t].indexOf(i)?(a=E[t].split(i).length-1||0,p=E.words,n={uuid:E.uuid,originalIndex:w,html:E.html,value:E.value,klass:E.klass,score:a,wordScore:a/p},n.html=s<101?cleanDisplay(stripTags(E.html)).replace(new RegExp("("+escapeRegExp(i)+")","gi"),"<strong>$1</strong>"):cleanDisplay(stripTags(E.html)),C.push(n),E.klass="visible"):E.klass="hidden";C.sort(function(e,t){return parseFloat(e.score)===parseFloat(t.score)?parseFloat(e.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(e.score)<parseFloat(t.score)?1:-1});var I="";for(y=0;y<C.length;y++)result=C[y],n=fuzzySearchData[result.originalIndex],n.score=result.score,n.wordScore=result.wordScore,n.originalIndex=result.originalIndex,n.html=result.html,n.klass=result.klass,x.push(n),result.score>0?(k=!0,n.klass="visible"):n.klass="hidden",n.html&&(I+=returnListItem(n));!k&&C.length>0&&C[0].originalIndex&&e[C[0].originalIndex]&&e[C[0].originalIndex].element&&(S=e[C[0].originalIndex].id),fuzzyRunning=!1,postMessage({job:"doSearch",data:x,gotone:k,bestguess:S,html:I})}}!function(){function e(e,t,n){if(s)for(var o=s.length;o--;){var a=s[o];i.call(e,a)&&t.call(n,a,e[a])}}this.MooTools={version:"1.6.0",build:"529422872adfff401b901b8b6c7ca5114ee95e2b"};var t=this.typeOf=function(e){if(null==e)return"null";if(null!=e.$family)return e.$family();if(e.nodeName){if(1==e.nodeType)return"element";if(3==e.nodeType)return/\S/.test(e.nodeValue)?"textnode":"whitespace"}else if("number"==typeof e.length){if("callee"in e)return"arguments";if("item"in e)return"collection"}return typeof e},i=(this.instanceOf=function(e,t){if(null==e)return!1;for(var i=e.$constructor||e.constructor;i;){if(i===t)return!0;i=i.parent}return!!e.hasOwnProperty&&e instanceof t},Object.prototype.hasOwnProperty),s=!0;for(var n in{toString:1})s=null;s&&(s=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]);var o=this.Function;o.prototype.overloadSetter=function(t){var i=this;return function(s,n){if(null==s)return this;if(t||"string"!=typeof s){for(var o in s)i.call(this,o,s[o]);e(s,i,this)}else i.call(this,s,n);return this}},o.prototype.overloadGetter=function(e){var t=this;return function(i){var s,n;if("string"!=typeof i?s=i:arguments.length>1?s=arguments:e&&(s=[i]),s){n={};for(var o=0;o<s.length;o++)n[s[o]]=t.call(this,s[o])}else n=t.call(this,i);return n}},o.prototype.extend=function(e,t){this[e]=t}.overloadSetter(),o.prototype.implement=function(e,t){this.prototype[e]=t}.overloadSetter();var a=Array.prototype.slice;Array.convert=function(e){return null==e?[]:r.isEnumerable(e)&&"string"!=typeof e?"array"==t(e)?e:a.call(e):[e]},o.convert=function(e){return"function"==t(e)?e:function(){return e}},Number.convert=function(e){var t=parseFloat(e);return isFinite(t)?t:null},String.convert=function(e){return e+""},o.from=o.convert,Number.from=Number.convert,String.from=String.convert,o.implement({hide:function(){return this.$hidden=!0,this},protect:function(){return this.$protected=!0,this}});var r=this.Type=function(e,i){if(e){var s=e.toLowerCase(),n=function(e){return t(e)==s};r["is"+e]=n,null!=i&&(i.prototype.$family=function(){return s}.hide())}return null==i?null:(i.extend(this),i.$constructor=r,i.prototype.$constructor=i,i)},l=Object.prototype.toString;r.isEnumerable=function(e){return null!=e&&"number"==typeof e.length&&"[object Function]"!=l.call(e)};var h={},u=function(e){var i=t(e.prototype);return h[i]||(h[i]=[])},c=function(e,i){if(!i||!i.$hidden){for(var s=u(this),n=0;n<s.length;n++){var o=s[n];"type"==t(o)?c.call(o,e,i):o.call(this,e,i)}var r=this.prototype[e];null!=r&&r.$protected||(this.prototype[e]=i),null==this[e]&&"function"==t(i)&&d.call(this,e,function(e){return i.apply(e,a.call(arguments,1))})}},d=function(e,t){if(!t||!t.$hidden){var i=this[e];null!=i&&i.$protected||(this[e]=t)}};r.implement({implement:c.overloadSetter(),extend:d.overloadSetter(),alias:function(e,t){c.call(this,e,this.prototype[t])}.overloadSetter(),mirror:function(e){return u(this).push(e),this}}),new r("Type",r);var p=function(e,t,i){var s=t!=Object,n=t.prototype;s&&(t=new r(e,t));for(var o=0,a=i.length;a>o;o++){var l=i[o],h=t[l],u=n[l];h&&h.protect(),s&&u&&t.implement(l,u.protect())}if(s){var c=n.propertyIsEnumerable(i[0]);t.forEachMethod=function(e){if(!c)for(var t=0,s=i.length;s>t;t++)e.call(n,n[i[t]],i[t]);for(var o in n)e.call(n,n[o],o)}}return p};p("String",String,["charAt","charCodeAt","concat","contains","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","contains"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",o,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]),Object.extend=d.overloadSetter(),Date.extend("now",function(){return+new Date}),new r("Boolean",Boolean),Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide(),Number.extend("random",function(e,t){return Math.floor(Math.random()*(t-e+1)+e)}),Array.implement({forEach:function(e,t){for(var i=0,s=this.length;s>i;i++)i in this&&e.call(t,this[i],i,this)},each:function(e,t){return Array.forEach(this,e,t),this}}),Object.extend({keys:function(t){var s=[];for(var n in t)i.call(t,n)&&s.push(n);return e(t,function(e){s.push(e)}),s},forEach:function(e,t,i){Object.keys(e).forEach(function(s){t.call(i,e[s],s,e)})}}),Object.each=Object.forEach;var m=function(e){switch(t(e)){case"array":return e.clone();case"object":return Object.clone(e);default:return e}};Array.implement("clone",function(){for(var e=this.length,t=new Array(e);e--;)t[e]=m(this[e]);return t});var f=function(e,i,s){switch(t(s)){case"object":"object"==t(e[i])?Object.merge(e[i],s):e[i]=Object.clone(s);break;case"array":e[i]=s.clone();break;default:e[i]=s}return e};Object.extend({merge:function(e,i,s){if("string"==t(i))return f(e,i,s);for(var n=1,o=arguments.length;o>n;n++){var a=arguments[n];for(var r in a)f(e,r,a[r])}return e},clone:function(e){var t={};for(var i in e)t[i]=m(e[i]);return t},append:function(e){for(var t=1,i=arguments.length;i>t;t++){var s=arguments[t]||{};for(var n in s)e[n]=s[n]}return e}}),["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(e){new r(e)});var g=Date.now();String.extend("uniqueID",function(){return(g++).toString(36)})}(),Array.implement({every:function(e,t){for(var i=0,s=this.length>>>0;s>i;i++)if(i in this&&!e.call(t,this[i],i,this))return!1;return!0},filter:function(e,t){for(var i,s=[],n=0,o=this.length>>>0;o>n;n++)n in this&&(i=this[n],e.call(t,i,n,this)&&s.push(i));return s},indexOf:function(e,t){for(var i=this.length>>>0,s=0>t?Math.max(0,i+t):t||0;i>s;s++)if(this[s]===e)return s;return-1},map:function(e,t){for(var i=this.length>>>0,s=Array(i),n=0;i>n;n++)n in this&&(s[n]=e.call(t,this[n],n,this));return s},some:function(e,t){for(var i=0,s=this.length>>>0;s>i;i++)if(i in this&&e.call(t,this[i],i,this))return!0;return!1},clean:function(){return this.filter(function(e){return null!=e})},invoke:function(e){var t=Array.slice(arguments,1);return this.map(function(i){return i[e].apply(i,t)})},associate:function(e){for(var t={},i=Math.min(this.length,e.length),s=0;i>s;s++)t[e[s]]=this[s];return t},link:function(e){for(var t={},i=0,s=this.length;s>i;i++)for(var n in e)if(e[n](this[i])){t[n]=this[i],delete e[n];break}return t},contains:function(e,t){return-1!=this.indexOf(e,t)},append:function(e){return this.push.apply(this,e),this},getLast:function(){return this.length?this[this.length-1]:null},getRandom:function(){return this.length?this[Number.random(0,this.length-1)]:null},include:function(e){return this.contains(e)||this.push(e),this},combine:function(e){for(var t=0,i=e.length;i>t;t++)this.include(e[t]);return this},erase:function(e){for(var t=this.length;t--;)this[t]===e&&this.splice(t,1);return this},empty:function(){return this.length=0,this},flatten:function(){for(var e=[],t=0,i=this.length;i>t;t++){var s=typeOf(this[t]);"null"!=s&&(e=e.concat("array"==s||"collection"==s||"arguments"==s||instanceOf(this[t],Array)?Array.flatten(this[t]):this[t]))}return e},pick:function(){for(var e=0,t=this.length;t>e;e++)if(null!=this[e])return this[e];return null},hexToRgb:function(e){if(3!=this.length)return null;var t=this.map(function(e){return 1==e.length&&(e+=e),parseInt(e,16)});return e?t:"rgb("+t+")"},rgbToHex:function(e){if(this.length<3)return null;if(4==this.length&&0==this[3]&&!e)return"transparent";for(var t=[],i=0;3>i;i++){var s=(this[i]-0).toString(16);t.push(1==s.length?"0"+s:s)}return e?t:"#"+t.join("")}}),Function.extend({attempt:function(){for(var e=0,t=arguments.length;t>e;e++)try{return arguments[e]()}catch(e){}return null}}),Function.implement({attempt:function(e,t){try{return this.apply(t,Array.convert(e))}catch(e){}return null},bind:function(e){var t=this,i=arguments.length>1?Array.slice(arguments,1):null,s=function(){},n=function(){var o=e,a=arguments.length;this instanceof n&&(s.prototype=t.prototype,o=new s);var r=i||a?t.apply(o,i&&a?i.concat(Array.slice(arguments)):i||arguments):t.call(o);return o==e?r:o};return n},pass:function(e,t){var i=this;return null!=e&&(e=Array.convert(e)),function(){return i.apply(t,e||arguments)}},delay:function(e,t,i){return setTimeout(this.pass(null==i?[]:i,t),e)},periodical:function(e,t,i){return setInterval(this.pass(null==i?[]:i,t),e)}}),Number.implement({limit:function(e,t){return Math.min(t,Math.max(e,this))},round:function(e){return e=Math.pow(10,e||0).toFixed(0>e?-e:0),Math.round(this*e)/e},times:function(e,t){for(var i=0;this>i;i++)e.call(t,i,this)},toFloat:function(){return parseFloat(this)},toInt:function(e){return parseInt(this,e||10)}}),Number.alias("each","times"),function(e){var t={};e.each(function(e){Number[e]||(t[e]=function(){return Math[e].apply(null,[this].concat(Array.convert(arguments)))})}),Number.implement(t)}(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]),String.implement({contains:function(e,t){return(t?String(this).slice(t):String(this)).indexOf(e)>-1},test:function(e,t){return("regexp"==typeOf(e)?e:new RegExp(""+e,t)).test(this)},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,function(e){return e.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(e){return"-"+e.charAt(0).toLowerCase()})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(e){return e.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(e){return parseInt(this,e||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(e){var t=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return t?t.slice(1).hexToRgb(e):null},rgbToHex:function(e){var t=String(this).match(/\d{1,3}/g);return t?t.rgbToHex(e):null},substitute:function(e,t){return String(this).replace(t||/\\?\{([^{}]+)\}/g,function(t,i){return"\\"==t.charAt(0)?t.slice(1):null!=e[i]?e[i]:""})}}),function(){var e=this.document,t=e.window=this,i=function(e,t){e=e.toLowerCase(),t=t?t.toLowerCase():"";var i=e.match(/(edge)[\s\/:]([\w\d\.]+)/);return i||(i=e.match(/(opera|ie|firefox|chrome|trident|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|(?:rv[\s\/:]|version[\s\/:])([\w\d\.]+)|$)/)||[null,"unknown",0]),"trident"==i[1]?(i[1]="ie",i[4]&&(i[2]=i[4])):"crios"==i[1]&&(i[1]="chrome"),t=e.match(/ip(?:ad|od|hone)/)?"ios":(e.match(/(?:webos|android)/)||e.match(/mac|win|linux/)||["other"])[0],"win"==t&&(t="windows"),{extend:Function.prototype.extend,name:"version"==i[1]?i[3]:i[1],version:parseFloat("opera"==i[1]&&i[4]?i[4]:i[2]),platform:t}},s=this.Browser=i(navigator.userAgent,navigator.platform);if("ie"==s.name&&e.documentMode&&(s.version=e.documentMode),s.extend({Features:{xpath:!!e.evaluate,air:!!t.runtime,query:!!e.querySelector,json:!!t.JSON},parseUA:i}),s.Request=function(){var e=function(){return new XMLHttpRequest},t=function(){return new ActiveXObject("MSXML2.XMLHTTP")},i=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){return e(),e},function(){return t(),t},function(){return i(),i})}(),s.Features.xhr=!!s.Request,s.exec=function(i){if(!i)return i;if(t.execScript)t.execScript(i);else{var s=e.createElement("script");s.setAttribute("type","text/javascript"),s.text=i,e.head.appendChild(s),e.head.removeChild(s)}return i},String.implement("stripScripts",function(e){var t="",i=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(e,i){return t+=i+"\n",""});return!0===e?s.exec(t):"function"==typeOf(e)&&e(t,i),i}),s.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event}),this.Window=this.$constructor=new Type("Window",function(){}),this.$family=Function.convert("window").hide(),Window.mirror(function(e,i){t[e]=i}),this.Document=e.$constructor=new Type("Document",function(){}),e.$family=Function.convert("document").hide(),Document.mirror(function(t,i){e[t]=i}),e.html=e.documentElement,e.head||(e.head=e.getElementsByTagName("head")[0]),e.execCommand)try{e.execCommand("BackgroundImageCache",!1,!0)}catch(e){}if(this.attachEvent&&!this.addEventListener){var n=function(){this.detachEvent("onunload",n),e.head=e.html=e.window=null,t=this.Window=e=null};this.attachEvent("onunload",n)}var o=Array.convert;try{o(e.html.childNodes)}catch(e){Array.convert=function(e){if("string"!=typeof e&&Type.isEnumerable(e)&&"array"!=typeOf(e)){for(var t=e.length,i=new Array(t);t--;)i[t]=e[t];return i}return o(e)};var a=Array.prototype,r=a.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(e){var t=a[e];Array[e]=function(e){return t.apply(Array.convert(e),r.call(arguments,1))}})}}(),function(){var e=this.Class=new Type("Class",function(s){instanceOf(s,Function)&&(s={initialize:s});var n=function(){if(i(this),n.$prototyping)return this;this.$caller=null,this.$family=null;var e=this.initialize?this.initialize.apply(this,arguments):this;return this.$caller=this.caller=null,e}.extend(this).implement(s);return n.$constructor=e,n.prototype.$constructor=n,n.prototype.parent=t,n}),t=function(){if(!this.$caller)throw new Error('The method "parent" cannot be called.');var e=this.$caller.$name,t=this.$caller.$owner.parent,i=t?t.prototype[e]:null;if(!i)throw new Error('The method "'+e+'" has no parent.');return i.apply(this,arguments)},i=function(e){for(var t in e){var s=e[t];switch(typeOf(s)){case"object":var n=function(){};n.prototype=s,e[t]=i(new n);break;case"array":e[t]=s.clone()}}return e},s=function(e,t,i){i.$origin&&(i=i.$origin);var s=function(){if(i.$protected&&null==this.$caller)throw new Error('The method "'+t+'" cannot be called.');var e=this.caller,n=this.$caller;this.caller=n,this.$caller=s;var o=i.apply(this,arguments);return this.$caller=n,this.caller=e,o}.extend({$owner:e,$origin:i,$name:t});return s},n=function(t,i,n){if(e.Mutators.hasOwnProperty(t)&&null==(i=e.Mutators[t].call(this,i)))return this;if("function"==typeOf(i)){if(i.$hidden)return this;this.prototype[t]=n?i:s(this,t,i)}else Object.merge(this.prototype,t,i);return this},o=function(e){e.$prototyping=!0;var t=new e;return delete e.$prototyping,t};e.implement("implement",n.overloadSetter()),e.Mutators={Extends:function(e){this.parent=e,this.prototype=o(e)},Implements:function(e){Array.convert(e).each(function(e){var t=new e;for(var i in t)n.call(this,i,t[i],!0)},this)}}}(),function(){this.Chain=new Class({$chain:[],chain:function(){return this.$chain.append(Array.flatten(arguments)),this},callChain:function(){return!!this.$chain.length&&this.$chain.shift().apply(this,arguments)},clearChain:function(){return this.$chain.empty(),this}});var e=function(e){return e.replace(/^on([A-Z])/,function(e,t){return t.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(t,i,s){return t=e(t),this.$events[t]=(this.$events[t]||[]).include(i),s&&(i.internal=!0),this},addEvents:function(e){for(var t in e)this.addEvent(t,e[t]);return this},fireEvent:function(t,i,s){t=e(t);var n=this.$events[t];return n?(i=Array.convert(i),n.each(function(e){s?e.delay(s,this,i):e.apply(this,i)},this),this):this},removeEvent:function(t,i){t=e(t);var s=this.$events[t];if(s&&!i.internal){var n=s.indexOf(i);-1!=n&&delete s[n]}return this},removeEvents:function(t){var i;if("object"==typeOf(t)){for(i in t)this.removeEvent(i,t[i]);return this}t&&(t=e(t));for(i in this.$events)if(!t||t==i)for(var s=this.$events[i],n=s.length;n--;)n in s&&this.removeEvent(i,s[n]);return this}}),this.Options=new Class({setOptions:function(){var e=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent)for(var t in e)"function"==typeOf(e[t])&&/^on[A-Z]/.test(t)&&(this.addEvent(t,e[t]),delete e[t]);return this}})}(),function(){function e(s,n){if(s.$thenableState===a)if(s===n)i(s,new TypeError("Tried to resolve a thenable with itself."));else if(!n||"object"!=typeof n&&"function"!=typeof n)t(s,n);else{var o;try{o=n.then}catch(e){i(s,e)}if("function"==typeof o){var r=!1;u(function(){try{o.call(n,function(t){r||(r=!0,e(s,t))},function(e){r||(r=!0,i(s,e))})}catch(e){r||(r=!0,i(s,e))}})}else t(s,n)}}function t(e,t){e.$thenableState===a&&(e.$thenableResult=t,e.$thenableState=r,n(e))}function i(e,t){e.$thenableState===a&&(e.$thenableResult=t,e.$thenableState=l,n(e))}function s(e){e.$thenableState!==a&&(e.$thenableResult=null,e.$thenableState=a)}function n(e){var t,i=e.$thenableState,s=e.$thenableResult,n=e.$thenableReactions;i===r?(e.$thenableReactions=[],t="fulfillHandler"):i==l&&(e.$thenableReactions=[],t="rejectHandler"),t&&u(o.pass([s,n,t]))}function o(t,s,n){for(var o=0,a=s.length;a>o;++o){var r=s[o],l=r[n];if("Identity"===l)e(r.thenable,t);else if("Thrower"===l)i(r.thenable,t);else try{e(r.thenable,l(t))}catch(e){i(r.thenable,e)}}}var a=0,r=1,l=2,h=Class.Thenable=new Class({$thenableState:a,$thenableResult:null,$thenableReactions:[],resolve:function(t){return e(this,t),this},reject:function(e){return i(this,e),this},getThenableState:function(){switch(this.$thenableState){case a:return"pending";case r:return"fulfilled";case l:return"rejected"}},resetThenable:function(e){return i(this,e),s(this),this},then:function(e,t){"function"!=typeof e&&(e="Identity"),"function"!=typeof t&&(t="Thrower");var i=new h;return this.$thenableReactions.push({thenable:i,fulfillHandler:e,rejectHandler:t}),this.$thenableState!==a&&n(this),i},catch:function(e){return this.then(null,e)}});h.extend({resolve:function(t){var i;return t instanceof h?i=t:(i=new h,e(i,t)),i},reject:function(e){var t=new h;return i(t,e),t}});var u;u="undefined"!=typeof process&&"function"==typeof process.nextTick?process.nextTick:"undefined"!=typeof setImmediate?setImmediate:function(e){setTimeout(e,0)}}(),function(){Object.extend({subset:function(e,t){for(var i={},s=0,n=t.length;n>s;s++){var o=t[s];o in e&&(i[o]=e[o])}return i},map:function(e,t,i){for(var s={},n=Object.keys(e),o=0;o<n.length;o++){var a=n[o];s[a]=t.call(i,e[a],a,e)}return s},filter:function(e,t,i){for(var s={},n=Object.keys(e),o=0;o<n.length;o++){var a=n[o],r=e[a];t.call(i,r,a,e)&&(s[a]=r)}return s},every:function(e,t,i){for(var s=Object.keys(e),n=0;n<s.length;n++){var o=s[n];if(!t.call(i,e[o],o))return!1}return!0},some:function(e,t,i){for(var s=Object.keys(e),n=0;n<s.length;n++){var o=s[n];if(t.call(i,e[o],o))return!0}return!1},values:function(e){for(var t=[],i=Object.keys(e),s=0;s<i.length;s++){var n=i[s];t.push(e[n])}return t},getLength:function(e){return Object.keys(e).length},keyOf:function(e,t){for(var i=Object.keys(e),s=0;s<i.length;s++){var n=i[s];if(e[n]===t)return n}return null},contains:function(e,t){return null!=Object.keyOf(e,t)},toQueryString:function(e,t){var i=[];return Object.each(e,function(e,s){t&&(s=t+"["+s+"]");var n;switch(typeOf(e)){case"object":n=Object.toQueryString(e,s);break;case"array":var o={};e.each(function(e,t){o[t]=e}),n=Object.toQueryString(o,s);break;default:n=s+"="+encodeURIComponent(e)}null!=e&&i.push(n)}),i.join("&")}})}(),function(){function e(e,o,a,l,u,d,p,m,f,g,v,y,b,A,w,E){if((o||-1===i)&&(t.expressions[++i]=[],s=-1,o))return"";if(a||l||-1===s){a=a||" ";var x=t.expressions[i];n&&x[s]&&(x[s].reverseCombinator=h(a)),x[++s]={combinator:a,tag:"*"}}var C=t.expressions[i][s];if(u)C.tag=u.replace(r,"");else if(d)C.id=d.replace(r,"");else if(p)p=p.replace(r,""),C.classList||(C.classList=[]),C.classes||(C.classes=[]),C.classList.push(p),C.classes.push({value:p,regexp:new RegExp("(^|\\s)"+c(p)+"(\\s|$)")});else if(b)E=E||w,E=E?E.replace(r,""):null,C.pseudos||(C.pseudos=[]),C.pseudos.push({key:b.replace(r,""),value:E,type:1==y.length?"class":"element"});else if(m){m=m.replace(r,""),v=(v||"").replace(r,"");var k,S;switch(f){case"^=":S=new RegExp("^"+c(v));break;case"$=":S=new RegExp(c(v)+"$");break;case"~=":S=new RegExp("(^|\\s)"+c(v)+"(\\s|$)");break;case"|=":S=new RegExp("^"+c(v)+"(-|$)");break;case"=":k=function(e){return v==e};break;case"*=":k=function(e){return e&&e.indexOf(v)>-1};break;case"!=":k=function(e){return v!=e};break;default:k=function(e){return!!e}}""==v&&/^[*$^]=$/.test(f)&&(k=function(){return!1}),k||(k=function(e){return e&&S.test(e)}),C.attributes||(C.attributes=[]),C.attributes.push({key:m,operator:f,value:v,test:k})}return""}var t,i,s,n,o={},a={},r=/\\/g,l=function(s,r){if(null==s)return null;if(!0===s.Slick)return s;s=(""+s).replace(/^\s+|\s+$/g,""),n=!!r;var h=n?a:o;if(h[s])return h[s];for(t={Slick:!0,expressions:[],raw:s,reverse:function(){return l(this.raw,!0)}},i=-1;s!=(s=s.replace(d,e)););return t.length=t.expressions.length,h[t.raw]=n?u(t):t},h=function(e){return"!"===e?" ":" "===e?"!":/^!/.test(e)?e.replace(/^!/,""):"!"+e},u=function(e){for(var t=e.expressions,i=0;i<t.length;i++){for(var s=t[i],n={parts:[],tag:"*",combinator:h(s[0].combinator)},o=0;o<s.length;o++){var a=s[o];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}s.reverse().push(n)}return e},c=function(e){return e.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(e){return"\\"+e})},d=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+c(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),p=this.Slick||{};p.parse=function(e){return l(e)},p.escapeRegExp=c,this.Slick||(this.Slick=p)}.apply("undefined"!=typeof exports?exports:this),function(){var e={},t={},i=Object.prototype.toString;e.isNativeCode=function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},e.isXML=function(e){return!!e.xmlVersion||!!e.xml||"[object XMLDocument]"==i.call(e)||9==e.nodeType&&"HTML"!=e.documentElement.nodeName},e.setDocument=function(e){var i=e.nodeType;if(9==i);else if(i)e=e.ownerDocument;else{if(!e.navigator)return;e=e.document}if(this.document!==e){this.document=e;var s,n=e.documentElement,o=this.getUIDXML(n),a=t[o];if(a)for(s in a)this[s]=a[s];else{a=t[o]={},a.root=n,a.isXMLDocument=this.isXML(e),a.brokenStarGEBTN=a.starSelectsClosedQSA=a.idGetsName=a.brokenMixedCaseQSA=a.brokenGEBCN=a.brokenCheckedQSA=a.brokenEmptyAttributeQSA=a.isHTMLDocument=a.nativeMatchesSelector=!1;var r,l,h,u,c,d,p="slick_uniqueid",m=e.createElement("div"),f=e.body||e.getElementsByTagName("body")[0]||n;f.appendChild(m);try{m.innerHTML='<a id="'+p+'"></a>',a.isHTMLDocument=!!e.getElementById(p)}catch(e){}if(a.isHTMLDocument){m.style.display="none",m.appendChild(e.createComment("")),l=m.getElementsByTagName("*").length>1;try{m.innerHTML="foo</foo>",d=m.getElementsByTagName("*"),r=d&&!!d.length&&"/"==d[0].nodeName.charAt(0)}catch(e){}a.brokenStarGEBTN=l||r;try{m.innerHTML='<a name="'+p+'"></a><b id="'+p+'"></b>',a.idGetsName=e.getElementById(p)===m.firstChild}catch(e){}if(m.getElementsByClassName){try{m.innerHTML='<a class="f"></a><a class="b"></a>',m.getElementsByClassName("b").length,m.firstChild.className="b",u=2!=m.getElementsByClassName("b").length}catch(e){}try{m.innerHTML='<a class="a"></a><a class="f b a"></a>',h=2!=m.getElementsByClassName("a").length}catch(e){}a.brokenGEBCN=u||h}if(m.querySelectorAll){try{m.innerHTML="foo</foo>",d=m.querySelectorAll("*"),a.starSelectsClosedQSA=d&&!!d.length&&"/"==d[0].nodeName.charAt(0)}catch(e){}try{m.innerHTML='<a class="MiX"></a>',a.brokenMixedCaseQSA=!m.querySelectorAll(".MiX").length}catch(e){}try{m.innerHTML='<select><option selected="selected">a</option></select>',a.brokenCheckedQSA=0==m.querySelectorAll(":checked").length}catch(e){}try{m.innerHTML='<a class=""></a>',a.brokenEmptyAttributeQSA=0!=m.querySelectorAll('[class*=""]').length}catch(e){}}try{m.innerHTML='<form action="s"><input id="action"/></form>',c="s"!=m.firstChild.getAttribute("action")}catch(e){}if(a.nativeMatchesSelector=n.matches||n.mozMatchesSelector||n.webkitMatchesSelector,a.nativeMatchesSelector)try{a.nativeMatchesSelector.call(n,":slick"),a.nativeMatchesSelector=null}catch(e){}}try{n.slick_expando=1,delete n.slick_expando,a.getUID=this.getUIDHTML}catch(e){a.getUID=this.getUIDXML}f.removeChild(m),m=d=f=null,a.getAttribute=a.isHTMLDocument&&c?function(e,t){var i=this.attributeGetters[t];if(i)return i.call(e);var s=e.getAttributeNode(t);return s?s.nodeValue:null}:function(e,t){var i=this.attributeGetters[t];return i?i.call(e):e.getAttribute(t)},a.hasAttribute=n&&this.isNativeCode(n.hasAttribute)?function(e,t){return e.hasAttribute(t)}:function(e,t){return!(!(e=e.getAttributeNode(t))||!e.specified&&!e.nodeValue)};var g=n&&this.isNativeCode(n.contains),v=e&&this.isNativeCode(e.contains);a.contains=g&&v?function(e,t){return e.contains(t)}:g&&!v?function(t,i){return t===i||(t===e?e.documentElement:t).contains(i)}:n&&n.compareDocumentPosition?function(e,t){return e===t||!!(16&e.compareDocumentPosition(t))}:function(e,t){if(t)do{if(t===e)return!0}while(t=t.parentNode);return!1},a.documentSorter=n.compareDocumentPosition?function(e,t){return e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:e===t?0:1:0}:"sourceIndex"in n?function(e,t){return e.sourceIndex&&t.sourceIndex?e.sourceIndex-t.sourceIndex:0}:e.createRange?function(e,t){if(!e.ownerDocument||!t.ownerDocument)return 0;var i=e.ownerDocument.createRange(),s=t.ownerDocument.createRange();return i.setStart(e,0),i.setEnd(e,0),s.setStart(t,0),s.setEnd(t,0),i.compareBoundaryPoints(Range.START_TO_END,s)}:null,n=null;for(s in a)this[s]=a[s]}}};var s=/^([#.]?)((?:[\w-]+|\*))$/,n=/\[.+[*$^]=(?:""|'')?\]/,o={};e.search=function(e,t,i,a){var r=this.found=a?null:i||[];if(!e)return r;if(e.navigator)e=e.document;else if(!e.nodeType)return r;var l,h,u,d,p=this.uniques={},m=!(!i||!i.length),f=9==e.nodeType;if(this.document!==(f?e:e.ownerDocument)&&this.setDocument(e),m)for(h=r.length;h--;)p[this.getUID(r[h])]=!0;if("string"==typeof t){var g=t.match(s);e:if(g){var v=g[1],y=g[2]
;if(v){if("#"==v){if(!this.isHTMLDocument||!f)break e;if(!(u=e.getElementById(y)))return r;if(this.idGetsName&&u.getAttributeNode("id").nodeValue!=y)break e;if(a)return u||null;m&&p[this.getUID(u)]||r.push(u)}else if("."==v){if(!this.isHTMLDocument||(!e.getElementsByClassName||this.brokenGEBCN)&&e.querySelectorAll)break e;if(e.getElementsByClassName&&!this.brokenGEBCN){if(d=e.getElementsByClassName(y),a)return d[0]||null;for(h=0;u=d[h++];)m&&p[this.getUID(u)]||r.push(u)}else{var b=new RegExp("(^|\\s)"+c.escapeRegExp(y)+"(\\s|$)");for(d=e.getElementsByTagName("*"),h=0;u=d[h++];)if(className=u.className,className&&b.test(className)){if(a)return u;m&&p[this.getUID(u)]||r.push(u)}}}}else{if("*"==y&&this.brokenStarGEBTN)break e;if(d=e.getElementsByTagName(y),a)return d[0]||null;for(h=0;u=d[h++];)m&&p[this.getUID(u)]||r.push(u)}return m&&this.sort(r),a?null:r}e:if(e.querySelectorAll){if(!this.isHTMLDocument||o[t]||this.brokenMixedCaseQSA||this.brokenCheckedQSA&&t.indexOf(":checked")>-1||this.brokenEmptyAttributeQSA&&n.test(t)||!f&&t.indexOf(",")>-1||c.disableQSA)break e;var A,w=t,E=e;f||(A=E.getAttribute("id"),slickid="slickid__",E.setAttribute("id",slickid),w="#"+slickid+" "+w,e=E.parentNode);try{if(a)return e.querySelector(w)||null;d=e.querySelectorAll(w)}catch(e){o[t]=1;break e}finally{f||(A?E.setAttribute("id",A):E.removeAttribute("id"),e=E)}if(this.starSelectsClosedQSA)for(h=0;u=d[h++];)!(u.nodeName>"@")||m&&p[this.getUID(u)]||r.push(u);else for(h=0;u=d[h++];)m&&p[this.getUID(u)]||r.push(u);return m&&this.sort(r),r}if(l=this.Slick.parse(t),!l.length)return r}else{if(null==t)return r;if(!t.Slick)return this.contains(e.documentElement||e,t)?(r?r.push(t):r=t,r):r;l=t}this.posNTH={},this.posNTHLast={},this.posNTHType={},this.posNTHTypeLast={},this.push=!m&&(a||1==l.length&&1==l.expressions[0].length)?this.pushArray:this.pushUID,null==r&&(r=[]);var x,C,k,S,I,O,D,T,B,P,M,N,F,U,L=l.expressions;e:for(h=0;N=L[h];h++)for(x=0;F=N[x];x++){if(S="combinator:"+F.combinator,!this[S])continue e;if(I=this.isXMLDocument?F.tag:F.tag.toUpperCase(),O=F.id,D=F.classList,T=F.classes,B=F.attributes,P=F.pseudos,U=x===N.length-1,this.bitUniques={},U?(this.uniques=p,this.found=r):(this.uniques={},this.found=[]),0===x){if(this[S](e,I,O,T,B,P,D),a&&U&&r.length)break e}else if(a&&U){for(C=0,k=M.length;k>C;C++)if(this[S](M[C],I,O,T,B,P,D),r.length)break e}else for(C=0,k=M.length;k>C;C++)this[S](M[C],I,O,T,B,P,D);M=this.found}return(m||l.expressions.length>1)&&this.sort(r),a?r[0]||null:r},e.uidx=1,e.uidk="slick-uniqueid",e.getUIDXML=function(e){var t=e.getAttribute(this.uidk);return t||(t=this.uidx++,e.setAttribute(this.uidk,t)),t},e.getUIDHTML=function(e){return e.uniqueNumber||(e.uniqueNumber=this.uidx++)},e.sort=function(e){return this.documentSorter?(e.sort(this.documentSorter),e):e},e.cacheNTH={},e.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/,e.parseNTHArgument=function(e){var t=e.match(this.matchNTH);if(!t)return!1;var i=t[2]||!1,s=t[1]||1;"-"==s&&(s=-1);var n=+t[3]||0;return t="n"==i?{a:s,b:n}:"odd"==i?{a:2,b:1}:"even"==i?{a:2,b:0}:{a:0,b:s},this.cacheNTH[e]=t},e.createNTHPseudo=function(e,t,i,s){return function(n,o){var a=this.getUID(n);if(!this[i][a]){var r=n.parentNode;if(!r)return!1;var l=r[e],h=1;if(s){var u=n.nodeName;do{l.nodeName==u&&(this[i][this.getUID(l)]=h++)}while(l=l[t])}else do{1==l.nodeType&&(this[i][this.getUID(l)]=h++)}while(l=l[t])}o=o||"n";var c=this.cacheNTH[o]||this.parseNTHArgument(o);if(!c)return!1;var d=c.a,p=c.b,m=this[i][a];if(0==d)return p==m;if(d>0){if(p>m)return!1}else if(m>p)return!1;return(m-p)%d==0}},e.pushArray=function(e,t,i,s,n,o){this.matchSelector(e,t,i,s,n,o)&&this.found.push(e)},e.pushUID=function(e,t,i,s,n,o){var a=this.getUID(e);!this.uniques[a]&&this.matchSelector(e,t,i,s,n,o)&&(this.uniques[a]=!0,this.found.push(e))},e.matchNode=function(e,t){if(this.isHTMLDocument&&this.nativeMatchesSelector)try{return this.nativeMatchesSelector.call(e,t.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(e){}var i=this.Slick.parse(t);if(!i)return!0;var s,n,o=i.expressions,a=0;for(s=0;n=o[s];s++)if(1==n.length){var r=n[0];if(this.matchSelector(e,this.isXMLDocument?r.tag:r.tag.toUpperCase(),r.id,r.classes,r.attributes,r.pseudos))return!0;a++}if(a==i.length)return!1;var l,h=this.search(this.document,i);for(s=0;l=h[s++];)if(l===e)return!0;return!1},e.matchPseudo=function(e,t,i){var s="pseudo:"+t;if(this[s])return this[s](e,i);var n=this.getAttribute(e,t);return i?i==n:!!n},e.matchSelector=function(e,t,i,s,n,o){if(t){var a=this.isXMLDocument?e.nodeName:e.nodeName.toUpperCase();if("*"==t){if("@">a)return!1}else if(a!=t)return!1}if(i&&e.getAttribute("id")!=i)return!1;var r,l,h;if(s)for(r=s.length;r--;)if(!(h=this.getAttribute(e,"class"))||!s[r].regexp.test(h))return!1;if(n)for(r=n.length;r--;)if(l=n[r],l.operator?!l.test(this.getAttribute(e,l.key)):!this.hasAttribute(e,l.key))return!1;if(o)for(r=o.length;r--;)if(l=o[r],!this.matchPseudo(e,l.key,l.value))return!1;return!0};var a={" ":function(e,t,i,s,n,o,a){var r,l,h;if(this.isHTMLDocument){e:if(i){if(!(l=this.document.getElementById(i))&&e.all||this.idGetsName&&l&&l.getAttributeNode("id").nodeValue!=i){if(!(h=e.all[i]))return;for(h[0]||(h=[h]),r=0;l=h[r++];){var u=l.getAttributeNode("id");if(u&&u.nodeValue==i){this.push(l,t,null,s,n,o);break}}return}if(!l){if(this.contains(this.root,e))return;break e}if(this.document!==e&&!this.contains(e,l))return;return void this.push(l,t,null,s,n,o)}e:if(s&&e.getElementsByClassName&&!this.brokenGEBCN){if(!(h=e.getElementsByClassName(a.join(" ")))||!h.length)break e;for(r=0;l=h[r++];)this.push(l,t,i,null,n,o);return}}if((h=e.getElementsByTagName(t))&&h.length)for(this.brokenStarGEBTN||(t=null),r=0;l=h[r++];)this.push(l,t,i,s,n,o)},">":function(e,t,i,s,n,o){if(e=e.firstChild)do{1==e.nodeType&&this.push(e,t,i,s,n,o)}while(e=e.nextSibling)},"+":function(e,t,i,s,n,o){for(;e=e.nextSibling;)if(1==e.nodeType){this.push(e,t,i,s,n,o);break}},"^":function(e,t,i,s,n,o){(e=e.firstChild)&&(1==e.nodeType?this.push(e,t,i,s,n,o):this["combinator:+"](e,t,i,s,n,o))},"~":function(e,t,i,s,n,o){for(;e=e.nextSibling;)if(1==e.nodeType){var a=this.getUID(e);if(this.bitUniques[a])break;this.bitUniques[a]=!0,this.push(e,t,i,s,n,o)}},"++":function(e,t,i,s,n,o){this["combinator:+"](e,t,i,s,n,o),this["combinator:!+"](e,t,i,s,n,o)},"~~":function(e,t,i,s,n,o){this["combinator:~"](e,t,i,s,n,o),this["combinator:!~"](e,t,i,s,n,o)},"!":function(e,t,i,s,n,o){for(;e=e.parentNode;)e!==this.document&&this.push(e,t,i,s,n,o)},"!>":function(e,t,i,s,n,o){(e=e.parentNode)!==this.document&&this.push(e,t,i,s,n,o)},"!+":function(e,t,i,s,n,o){for(;e=e.previousSibling;)if(1==e.nodeType){this.push(e,t,i,s,n,o);break}},"!^":function(e,t,i,s,n,o){(e=e.lastChild)&&(1==e.nodeType?this.push(e,t,i,s,n,o):this["combinator:!+"](e,t,i,s,n,o))},"!~":function(e,t,i,s,n,o){for(;e=e.previousSibling;)if(1==e.nodeType){var a=this.getUID(e);if(this.bitUniques[a])break;this.bitUniques[a]=!0,this.push(e,t,i,s,n,o)}}};for(var r in a)e["combinator:"+r]=a[r];var l={empty:function(e){var t=e.firstChild;return!(t&&1==t.nodeType||(e.innerText||e.textContent||"").length)},not:function(e,t){return!this.matchNode(e,t)},contains:function(e,t){return(e.innerText||e.textContent||"").indexOf(t)>-1},"first-child":function(e){for(;e=e.previousSibling;)if(1==e.nodeType)return!1;return!0},"last-child":function(e){for(;e=e.nextSibling;)if(1==e.nodeType)return!1;return!0},"only-child":function(e){for(var t=e;t=t.previousSibling;)if(1==t.nodeType)return!1;for(var i=e;i=i.nextSibling;)if(1==i.nodeType)return!1;return!0},"nth-child":e.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":e.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":e.createNTHPseudo("firstChild","nextSibling","posNTHType",!0),"nth-last-of-type":e.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",!0),index:function(e,t){return this["pseudo:nth-child"](e,""+(t+1))},even:function(e){return this["pseudo:nth-child"](e,"2n")},odd:function(e){return this["pseudo:nth-child"](e,"2n+1")},"first-of-type":function(e){for(var t=e.nodeName;e=e.previousSibling;)if(e.nodeName==t)return!1;return!0},"last-of-type":function(e){for(var t=e.nodeName;e=e.nextSibling;)if(e.nodeName==t)return!1;return!0},"only-of-type":function(e){for(var t=e,i=e.nodeName;t=t.previousSibling;)if(t.nodeName==i)return!1;for(var s=e;s=s.nextSibling;)if(s.nodeName==i)return!1;return!0},enabled:function(e){return!e.disabled},disabled:function(e){return e.disabled},checked:function(e){return e.checked||e.selected},focus:function(e){return this.isHTMLDocument&&this.document.activeElement===e&&(e.href||e.type||this.hasAttribute(e,"tabindex"))},root:function(e){return e===this.root},selected:function(e){return e.selected}};for(var h in l)e["pseudo:"+h]=l[h];var u=e.attributeGetters={for:function(){return"htmlFor"in this?this.htmlFor:this.getAttribute("for")},href:function(){return"href"in this?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return this.style?this.style.cssText:this.getAttribute("style")},tabindex:function(){var e=this.getAttributeNode("tabindex");return e&&e.specified?e.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var e=this.getAttributeNode("maxLength");return e&&e.specified?e.nodeValue:null}};u.MAXLENGTH=u.maxLength=u.maxlength;var c=e.Slick=this.Slick||{};c.version="1.1.7",c.search=function(t,i,s){return e.search(t,i,s)},c.find=function(t,i){return e.search(t,i,null,!0)},c.contains=function(t,i){return e.setDocument(t),e.contains(t,i)},c.getAttribute=function(t,i){return e.setDocument(t),e.getAttribute(t,i)},c.hasAttribute=function(t,i){return e.setDocument(t),e.hasAttribute(t,i)},c.match=function(t,i){return!(!t||!i)&&(!i||i===t||(e.setDocument(t),e.matchNode(t,i)))},c.defineAttributeGetter=function(t,i){return e.attributeGetters[t]=i,this},c.lookupAttributeGetter=function(t){return e.attributeGetters[t]},c.definePseudo=function(t,i){return e["pseudo:"+t]=function(e,t){return i.call(e,t)},this},c.lookupPseudo=function(t){var i=e["pseudo:"+t];return i?function(e){return i.call(this,e)}:null},c.override=function(t,i){return e.override(t,i),this},c.isXML=e.isXML,c.uidOf=function(t){return e.getUIDHTML(t)},this.Slick||(this.Slick=c)}.apply("undefined"!=typeof exports?exports:this);var Element=this.Element=function(e,t){var i=Element.Constructors[e];if(i)return i(t);if("string"!=typeof e)return document.id(e).set(t);if(t||(t={}),!/^[\w-]+$/.test(e)){var s=Slick.parse(e).expressions[0][0];e="*"==s.tag?"div":s.tag,s.id&&null==t.id&&(t.id=s.id);var n=s.attributes;if(n)for(var o,a=0,r=n.length;r>a;a++)o=n[a],null==t[o.key]&&(null!=o.value&&"="==o.operator?t[o.key]=o.value:o.value||o.operator||(t[o.key]=!0));s.classList&&null==t.class&&(t.class=s.classList.join(" "))}return document.newElement(e,t)};Browser.Element&&(Element.prototype=Browser.Element.prototype,Element.prototype._fireEvent=function(e){return function(t,i){return e.call(this,t,i)}}(Element.prototype.fireEvent)),new Type("Element",Element).mirror(function(e){if(!Array.prototype[e]){var t={};t[e]=function(){for(var t=[],i=arguments,s=!0,n=0,o=this.length;o>n;n++){var a=this[n],r=t[n]=a[e].apply(a,i);s=s&&"element"==typeOf(r)}return s?new Elements(t):t},Elements.implement(t)}}),Browser.Element||(Element.parent=Object,Element.Prototype={$constructor:Element,$family:Function.convert("element").hide()},Element.mirror(function(e,t){Element.Prototype[e]=t})),Element.Constructors={};var IFrame=new Type("IFrame",function(){var e,t=Array.link(arguments,{properties:Type.isObject,iframe:function(e){return null!=e}}),i=t.properties||{};t.iframe&&(e=document.id(t.iframe));var s=i.onload||function(){};delete i.onload,i.id=i.name=[i.id,i.name,e?e.id||e.name:"IFrame_"+String.uniqueID()].pick(),e=new Element(e||"iframe",i);var n=function(){s.call(e.contentWindow)};return window.frames[i.id]?n():e.addListener("load",n),e}),Elements=this.Elements=function(e){if(e&&e.length)for(var t,i={},s=0;t=e[s++];){var n=Slick.uidOf(t);i[n]||(i[n]=!0,this.push(t))}};Elements.prototype={length:0},Elements.parent=Array,new Type("Elements",Elements).implement({filter:function(e,t){return e?new Elements(Array.filter(this,"string"==typeOf(e)?function(t){return t.match(e)}:e,t)):this}.protect(),push:function(){for(var e=this.length,t=0,i=arguments.length;i>t;t++){var s=document.id(arguments[t]);s&&(this[e++]=s)}return this.length=e}.protect(),unshift:function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var s=document.id(arguments[t]);s&&e.push(s)}return Array.prototype.unshift.apply(this,e)}.protect(),concat:function(){for(var e=new Elements(this),t=0,i=arguments.length;i>t;t++){var s=arguments[t];Type.isEnumerable(s)?e.append(s):e.push(s)}return e}.protect(),append:function(e){for(var t=0,i=e.length;i>t;t++)this.push(e[t]);return this}.protect(),empty:function(){for(;this.length;)delete this[--this.length];return this}.protect()}),function(){var e=Array.prototype.splice,t={0:0,1:1,length:2};e.call(t,1,1),1==t[1]&&Elements.implement("splice",function(){for(var t=this.length,i=e.apply(this,arguments);t>=this.length;)delete this[t--];return i}.protect()),Array.forEachMethod(function(e,t){Elements.implement(t,e)}),Array.mirror(Elements);var i;try{i="x"==document.createElement("<input name=x>").name}catch(e){}var s=function(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;")},n=function(){var e=document.createElement("style"),t=!1;try{e.innerHTML="#justTesing{margin: 0px;}",t=!!e.innerHTML}catch(e){}return t}();Document.implement({newElement:function(e,t){if(t){if(null!=t.checked&&(t.defaultChecked=t.checked),"checkbox"!=t.type&&"radio"!=t.type||null!=t.value||(t.value="on"),!n&&"style"==e){var o=document.createElement("style");return o.setAttribute("type","text/css"),t.type&&delete t.type,this.id(o).set(t)}i&&(e="<"+e,t.name&&(e+=' name="'+s(t.name)+'"'),t.type&&(e+=' type="'+s(t.type)+'"'),e+=">",delete t.name,delete t.type)}return this.id(this.createElement(e)).set(t)}})}(),function(){Slick.uidOf(window),Slick.uidOf(document),Document.implement({newTextNode:function(e){return this.createTextNode(e)},getDocument:function(){return this},getWindow:function(){return this.window},id:function(){var e={string:function(t,i,s){return t=Slick.find(s,"#"+t.replace(/(\W)/g,"\\$1")),t?e.element(t,i):null},element:function(e,t){if(Slick.uidOf(e),!t&&!e.$family&&!/^(?:object|embed)$/i.test(e.tagName)){var i=e.fireEvent;e._fireEvent=function(e,t){return i(e,t)},Object.append(e,Element.Prototype)}return e},object:function(t,i,s){return t.toElement?e.element(t.toElement(s),i):null}};return e.textnode=e.whitespace=e.window=e.document=function(e){return e},function(t,i,s){if(t&&t.$family&&t.uniqueNumber)return t;var n=typeOf(t);return e[n]?e[n](t,i,s||document):null}}()}),null==window.$&&Window.implement("$",function(e,t){return document.id(e,t,this.document)}),Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}}),[Document,Element].invoke("implement",{getElements:function(e){return Slick.search(this,e,new Elements)},getElement:function(e){return document.id(Slick.find(this,e))}});var e={contains:function(e){return Slick.contains(this,e)}};document.contains||Document.implement(e),document.createElement("div").contains||Element.implement(e);var t=function(e,t){if(!e)return t;e=Object.clone(Slick.parse(e));for(var i=e.expressions,s=i.length;s--;)i[s][0].combinator=t;return e};Object.forEach({getNext:"~",getPrevious:"!~",getParent:"!"},function(e,i){Element.implement(i,function(i){return this.getElement(t(i,e))})}),Object.forEach({getAllNext:"~",getAllPrevious:"!~",getSiblings:"~~",getChildren:">",getParents:"!"},function(e,i){Element.implement(i,function(i){return this.getElements(t(i,e))})}),Element.implement({getFirst:function(e){return document.id(Slick.search(this,t(e,">"))[0])},getLast:function(e){return document.id(Slick.search(this,t(e,">")).getLast())},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(e){return document.id(Slick.find(this,"#"+(""+e).replace(/(\W)/g,"\\$1")))},match:function(e){return!e||Slick.match(this,e)}}),null==window.$$&&Window.implement("$$",function(e){if(1==arguments.length){if("string"==typeof e)return Slick.search(this.document,e,new Elements);if(Type.isEnumerable(e))return new Elements(e)}return new Elements(arguments)});var i={before:function(e,t){var i=t.parentNode;i&&i.insertBefore(e,t)},after:function(e,t){var i=t.parentNode;i&&i.insertBefore(e,t.nextSibling)},bottom:function(e,t){t.appendChild(e)},top:function(e,t){t.insertBefore(e,t.firstChild)}};i.inside=i.bottom;var s={},n={},o={};Array.forEach(["type","value","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","rowSpan","tabIndex","useMap"],function(e){o[e.toLowerCase()]=e}),o.html="innerHTML",o.text=null==document.createElement("div").textContent?"innerText":"textContent",Object.forEach(o,function(e,t){n[t]=function(t,i){t[e]=i},s[t]=function(t){return t[e]}}),n.text=function(){return function(e,t){"style"==e.get("tag")?e.set("html",t):e[o.text]=t}}(n.text),s.text=function(e){return function(t){return"style"==t.get("tag")?t.innerHTML:e(t)}}(s.text);var a=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked","autofocus","controls","autoplay","loop"],r={};Array.forEach(a,function(e){var t=e.toLowerCase();r[t]=e,n[t]=function(t,i){t[e]=!!i},s[t]=function(t){return!!t[e]}}),Object.append(n,{class:function(e,t){"className"in e?e.className=t||"":e.setAttribute("class",t)},for:function(e,t){"htmlFor"in e?e.htmlFor=t:e.setAttribute("for",t)},style:function(e,t){e.style?e.style.cssText=t:e.setAttribute("style",t)},value:function(e,t){e.value=null!=t?t:""}}),s.class=function(e){return"className"in e?e.className||null:e.getAttribute("class")};var h=document.createElement("button");try{h.type="button"}catch(e){}"button"!=h.type&&(n.type=function(e,t){e.setAttribute("type",t)}),h=null;var u,c,d=function(){var e=document.createElement("style"),t=!1;try{e.innerHTML="#justTesing{margin: 0px;}",t=!!e.innerHTML}catch(e){}return t}(),p=document.createElement("input");p.value="t",p.type="submit",u="t"!=p.value;try{p.value="",p.type="email",c="email"==p.type}catch(e){}p=null,(u||!c)&&(n.type=function(e,t){try{var i=e.value;e.type=t,e.value=i}catch(e){}});var m=function(e){return e.random="attribute","attribute"==e.getAttribute("random")}(document.createElement("div")),f=function(e){return e.innerHTML='<object><param name="should_fix" value="the unknown" /></object>',1!=e.cloneNode(!0).firstChild.childNodes.length}(document.createElement("div")),g=!!document.createElement("div").classList,v=function(e){var t=(e||"").clean().split(" "),i={};return t.filter(function(e){return""===e||i[e]?void 0:i[e]=e})},y=function(e){this.classList.add(e)},b=function(e){this.classList.remove(e)};Element.implement({setProperty:function(e,t){var i=n[e.toLowerCase()];if(i)i(this,t);else{var s;m&&(s=this.retrieve("$attributeWhiteList",{})),null==t?(this.removeAttribute(e),m&&delete s[e]):(this.setAttribute(e,""+t),m&&(s[e]=!0))}return this},setProperties:function(e){for(var t in e)this.setProperty(t,e[t]);return this},getProperty:function(e){var t=s[e.toLowerCase()];if(t)return t(this);if(m){var i=this.getAttributeNode(e),n=this.retrieve("$attributeWhiteList",{});if(!i)return null;if(i.expando&&!n[e]){var o=this.outerHTML;if(o.substr(0,o.search(/\/?['"]?>(?![^<]*<['"])/)).indexOf(e)<0)return null;n[e]=!0}}var a=Slick.getAttribute(this,e);return a||Slick.hasAttribute(this,e)?a:null},getProperties:function(){var e=Array.convert(arguments);return e.map(this.getProperty,this).associate(e)},removeProperty:function(e){return this.setProperty(e,null)},removeProperties:function(){return Array.each(arguments,this.removeProperty,this),this},set:function(e,t){var i=Element.Properties[e];i&&i.set?i.set.call(this,t):this.setProperty(e,t)}.overloadSetter(),get:function(e){var t=Element.Properties[e];return t&&t.get?t.get.apply(this):this.getProperty(e)}.overloadGetter(),erase:function(e){var t=Element.Properties[e];return t&&t.erase?t.erase.apply(this):this.removeProperty(e),this},hasClass:g?function(e){return this.classList.contains(e)}:function(e){return v(this.className).contains(e)},addClass:g?function(e){return v(e).forEach(y,this),this}:function(e){return this.className=v(e+" "+this.className).join(" "),this},removeClass:g?function(e){return v(e).forEach(b,this),this}:function(e){var t=v(this.className);return v(e).forEach(t.erase,t),this.className=t.join(" "),this},toggleClass:function(e,t){return null==t&&(t=!this.hasClass(e)),t?this.addClass(e):this.removeClass(e)},adopt:function(){var e,t=this,i=Array.flatten(arguments),s=i.length;s>1&&(t=e=document.createDocumentFragment());for(var n=0;s>n;n++){var o=document.id(i[n],!0);o&&t.appendChild(o)}return e&&this.appendChild(e),this},appendText:function(e,t){return this.grab(this.getDocument().newTextNode(e),t)},grab:function(e,t){return i[t||"bottom"](document.id(e,!0),this),this},inject:function(e,t){return i[t||"bottom"](this,document.id(e,!0)),this},replaces:function(e){return e=document.id(e,!0),e.parentNode.replaceChild(this,e),this},wraps:function(e,t){return e=document.id(e,!0),this.replaces(e).grab(e,t)},getSelected:function(){return this.selectedIndex,new Elements(Array.convert(this.options).filter(function(e){return e.selected}))},toQueryString:function(){var e=[];return this.getElements("input, select, textarea").each(function(t){var i=t.type;if(t.name&&!t.disabled&&"submit"!=i&&"reset"!=i&&"file"!=i&&"image"!=i){var s="select"==t.get("tag")?t.getSelected().map(function(e){return document.id(e).get("value")}):"radio"!=i&&"checkbox"!=i||t.checked?t.get("value"):null;Array.convert(s).each(function(i){void 0!==i&&e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(i))})}}),e.join("&")}});var A={before:"beforeBegin",after:"afterEnd",bottom:"beforeEnd",top:"afterBegin",inside:"beforeEnd"};Element.implement("appendHTML","insertAdjacentHTML"in document.createElement("div")?function(e,t){return this.insertAdjacentHTML(A[t||"bottom"],e),this}:function(e,t){var s=new Element("div",{html:e}),n=s.childNodes,o=s.firstChild;if(!o)return this;if(n.length>1){o=document.createDocumentFragment();for(var a=0,r=n.length;r>a;a++)o.appendChild(n[a])}return i[t||"bottom"](o,this),this});var w={},E={},x=function(e){return E[e]||(E[e]={})},C=function(e){var t=e.uniqueNumber;return e.removeEvents&&e.removeEvents(),e.clearAttributes&&e.clearAttributes(),null!=t&&(delete w[t],delete E[t]),e},k={input:"checked",option:"selected",textarea:"value"};if(Element.implement({destroy:function(){var e=C(this).getElementsByTagName("*");return Array.each(e,C),Element.dispose(this),null},empty:function(){return Array.convert(this.childNodes).each(Element.dispose),this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},clone:function(e,t){e=!1!==e;var i,s=this.cloneNode(e),n=[s],o=[this];for(e&&(n.append(Array.convert(s.getElementsByTagName("*"))),o.append(Array.convert(this.getElementsByTagName("*")))),i=n.length;i--;){var a=n[i],r=o[i];if(t||a.removeAttribute("id"),a.clearAttributes&&(a.clearAttributes(),a.mergeAttributes(r),a.removeAttribute("uniqueNumber"),a.options))for(var l=a.options,h=r.options,u=l.length;u--;)l[u].selected=h[u].selected;var c=k[r.tagName.toLowerCase()];c&&r[c]&&(a[c]=r[c])}if(f){var d=s.getElementsByTagName("object"),p=this.getElementsByTagName("object");for(i=d.length;i--;)d[i].outerHTML=p[i].outerHTML}return document.id(s)}}),[Element,Window,Document].invoke("implement",{addListener:function(e,t){return window.attachEvent&&!window.addEventListener&&(w[Slick.uidOf(this)]=this),this.addEventListener?this.addEventListener(e,t,!!arguments[2]):this.attachEvent("on"+e,t),this},removeListener:function(e,t){return this.removeEventListener?this.removeEventListener(e,t,!!arguments[2]):this.detachEvent("on"+e,t),this},retrieve:function(e,t){var i=x(Slick.uidOf(this)),s=i[e];return null!=t&&null==s&&(s=i[e]=t),null!=s?s:null},store:function(e,t){return x(Slick.uidOf(this))[e]=t,this},eliminate:function(e){return delete x(Slick.uidOf(this))[e],this}}),window.attachEvent&&!window.addEventListener){var S=function(){Object.each(w,C),window.CollectGarbage&&CollectGarbage(),window.removeListener("unload",S)};window.addListener("unload",S)}Element.Properties={},Element.Properties.style={set:function(e){this.style.cssText=e},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}},Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}},Element.Properties.html={set:function(e){null==e?e="":"array"==typeOf(e)&&(e=e.join("")),this.styleSheet&&!d?this.styleSheet.cssText=e:this.innerHTML=e},erase:function(){this.set("html","")}};var I,O=!0,D=!0,T=!0,B=document.createElement("div");if(B.innerHTML="<nav></nav>",!(O=1==B.childNodes.length)){var P="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" ");for(I=document.createDocumentFragment(),l=P.length;l--;)I.createElement(P[l])}B=null,D=Function.attempt(function(){return document.createElement("table").innerHTML="<tr><td></td></tr>",!0});var M=document.createElement("tr"),N="<td></td>";M.innerHTML=N,T=M.innerHTML==N,M=null,D&&T&&O||(Element.Properties.html.set=function(e){var t={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};return t.thead=t.tfoot=t.tbody,function(i){if(this.styleSheet)return e.call(this,i);var s=t[this.get("tag")];if(s||O||(s=[0,"",""]),!s)return e.call(this,i);var n=s[0],o=document.createElement("div"),a=o;for(O||I.appendChild(o),o.innerHTML=[s[1],i,s[2]].flatten().join("");n--;)a=a.firstChild;this.empty().adopt(a.childNodes),O||I.removeChild(o),o=null}}(Element.Properties.html.set));var F=document.createElement("form");F.innerHTML="<select><option>s</option></select>","s"!=F.firstChild.value&&(Element.Properties.value={set:function(e){if("select"!=this.get("tag"))return this.setProperty("value",e);var t=this.getElements("option");e=String(e);for(var i=0;i<t.length;i++){var s=t[i],n=s.getAttributeNode("value");if((n&&n.specified?s.value:s.get("text"))===e)return s.selected=!0}},get:function(){var e=this,t=e.get("tag");if("select"!=t&&"option"!=t)return this.getProperty("value");if("select"==t&&!(e=e.getSelected()[0]))return"";var i=e.getAttributeNode("value");return i&&i.specified?e.value:e.get("text")}}),F=null,document.createElement("div").getAttributeNode("id")&&(Element.Properties.id={set:function(e){this.id=this.getAttributeNode("id").value=e},get:function(){return this.id||null},erase:function(){this.id=this.getAttributeNode("id").value=""}})}(),function(){var e={},t=function(e){var t;if(e.wheelDelta)t=e.wheelDelta%120==0?e.wheelDelta/120:e.wheelDelta/12;else{var i=e.deltaY||e.detail||0;t=-(i%3==0?i/3:10*i)}return t},i=this.DOMEvent=new Type("DOMEvent",function(i,s){if(s||(s=window),i=i||s.event,i.$extended)return i;this.event=i,this.$extended=!0,this.shift=i.shiftKey,this.control=i.ctrlKey,this.alt=i.altKey,this.meta=i.metaKey;for(var n=this.type=i.type,o=i.target||i.srcElement;o&&3==o.nodeType;)o=o.parentNode;if(this.target=document.id(o),0==n.indexOf("key")){var a=this.code=i.which||i.keyCode;this.shift&&"keypress"==n||(this.key=e[a]),("keydown"==n||"keyup"==n)&&(a>111&&124>a?this.key="f"+(a-111):a>95&&106>a&&(this.key=a-96)),null==this.key&&(this.key=String.fromCharCode(a).toLowerCase())}else if("click"==n||"dblclick"==n||"contextmenu"==n||"wheel"==n||"DOMMouseScroll"==n||0==n.indexOf("mouse")){var r=s.document;if(r=r.compatMode&&"CSS1Compat"!=r.compatMode?r.body:r.html,this.page={x:null!=i.pageX?i.pageX:i.clientX+r.scrollLeft,y:null!=i.pageY?i.pageY:i.clientY+r.scrollTop},this.client={x:null!=i.pageX?i.pageX-s.pageXOffset:i.clientX,y:null!=i.pageY?i.pageY-s.pageYOffset:i.clientY},("DOMMouseScroll"==n||"wheel"==n||"mousewheel"==n)&&(this.wheel=t(i)),this.rightClick=3==i.which||2==i.button,"mouseover"==n||"mouseout"==n||"mouseenter"==n||"mouseleave"==n){for(var l="mouseover"==n||"mouseenter"==n,h=i.relatedTarget||i[(l?"from":"to")+"Element"];h&&3==h.nodeType;)h=h.parentNode;this.relatedTarget=document.id(h)}}else if(0==n.indexOf("touch")||0==n.indexOf("gesture")){this.rotation=i.rotation,this.scale=i.scale,this.targetTouches=i.targetTouches,this.changedTouches=i.changedTouches;var u=this.touches=i.touches;if(u&&u[0]){var c=u[0];this.page={x:c.pageX,y:c.pageY},this.client={x:c.clientX,y:c.clientY}}}this.client||(this.client={}),this.page||(this.page={})});i.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){return this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0,this},preventDefault:function(){return this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1,this}}),i.defineKey=function(t,i){return e[t]=i,this},i.defineKeys=i.defineKey.overloadSetter(!0),i.defineKeys({38:"up",40:"down",37:"left",39:"right",27:"esc",32:"space",8:"backspace",9:"tab",46:"delete",13:"enter"})}(),function(){Element.Properties.events={set:function(e){this.addEvents(e)}},[Element,Window,Document].invoke("implement",{addEvent:function(e,t){var i=this.retrieve("events",{});if(i[e]||(i[e]={keys:[],values:[]}),i[e].keys.contains(t))return this;i[e].keys.push(t);var s=e,n=Element.Events[e],o=t,a=this;n&&(n.onAdd&&n.onAdd.call(this,t,e),n.condition&&(o=function(i){return!n.condition.call(this,i,e)||t.call(this,i)}),n.base&&(s=Function.convert(n.base).call(this,e)));var r=function(){return t.call(a)},l=Element.NativeEvents[s];return l&&(2==l&&(r=function(e){e=new DOMEvent(e,a.getWindow()),!1===o.call(a,e)&&e.stop()}),this.addListener(s,r,arguments[2])),i[e].values.push(r),this},removeEvent:function(e,t){var i=this.retrieve("events");if(!i||!i[e])return this;var s=i[e],n=s.keys.indexOf(t);if(-1==n)return this;var o=s.values[n];delete s.keys[n],delete s.values[n];var a=Element.Events[e];return a&&(a.onRemove&&a.onRemove.call(this,t,e),a.base&&(e=Function.convert(a.base).call(this,e))),Element.NativeEvents[e]?this.removeListener(e,o,arguments[2]):this},addEvents:function(e){for(var t in e)this.addEvent(t,e[t]);return this},removeEvents:function(e){var t;if("object"==typeOf(e)){for(t in e)this.removeEvent(t,e[t]);return this}var i=this.retrieve("events");if(!i)return this;if(e)i[e]&&(i[e].keys.each(function(t){this.removeEvent(e,t)},this),delete i[e]);else{for(t in i)this.removeEvents(t);this.eliminate("events")}return this},fireEvent:function(e,t,i){var s=this.retrieve("events");return s&&s[e]?(t=Array.convert(t),s[e].keys.each(function(e){i?e.delay(i,this,t):e.apply(this,t)},this),this):this},cloneEvents:function(e,t){e=document.id(e);var i=e.retrieve("events");if(!i)return this;if(t)i[t]&&i[t].keys.each(function(e){this.addEvent(t,e)},this);else for(var s in i)this.cloneEvents(e,s);return this}}),Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,wheel:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,hashchange:1,popstate:2,pageshow:2,pagehide:2,error:1,abort:1,scroll:1,message:2},Element.Events={mousewheel:{base:"onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll"}};var e=function(e){var t=e.relatedTarget
;return null==t||!!t&&(t!=this&&"xul"!=t.prefix&&"document"!=typeOf(this)&&!this.contains(t))};"onmouseenter"in document.documentElement?(Element.NativeEvents.mouseenter=Element.NativeEvents.mouseleave=2,Element.MouseenterCheck=e):(Element.Events.mouseenter={base:"mouseover",condition:e},Element.Events.mouseleave={base:"mouseout",condition:e}),window.addEventListener||(Element.NativeEvents.propertychange=2,Element.Events.change={base:function(){var e=this.type;return"input"!=this.get("tag")||"radio"!=e&&"checkbox"!=e?"change":"propertychange"},condition:function(e){return"propertychange"!=e.type||"checked"==e.event.propertyName}})}(),function(){var e=!!window.addEventListener;Element.NativeEvents.focusin=Element.NativeEvents.focusout=2;var t=function(e,t,i,s,n){for(;n&&n!=e;){if(t(n,s))return i.call(n,s,n);n=document.id(n.parentNode)}},i={mouseenter:{base:"mouseover",condition:Element.MouseenterCheck},mouseleave:{base:"mouseout",condition:Element.MouseenterCheck},focus:{base:"focus"+(e?"":"in"),capture:!0},blur:{base:e?"blur":"focusout",capture:!0}},s="$delegation:",n=function(e){return{base:"focusin",remove:function(t,i){var n=t.retrieve(s+e+"listeners",{})[i];if(n&&n.forms)for(var o=n.forms.length;o--;)n.forms[o].removeEvent&&n.forms[o].removeEvent(e,n.fns[o])},listen:function(i,n,o,a,r,l){var h="form"==r.get("tag")?r:a.target.getParent("form");if(h){var u=i.retrieve(s+e+"listeners",{}),c=u[l]||{forms:[],fns:[]},d=c.forms,p=c.fns;if(-1==d.indexOf(h)){d.push(h);var m=function(e){t(i,n,o,e,r)};h.addEvent(e,m),p.push(m),u[l]=c,i.store(s+e+"listeners",u)}}}}},o=function(e){return{base:"focusin",listen:function(i,s,n,o,a){var r={blur:function(){this.removeEvents(r)}};r[e]=function(e){t(i,s,n,e,a)},o.target.addEvents(r)}}};e||Object.append(i,{submit:n("submit"),reset:n("reset"),change:o("change"),select:o("select")});var a=Element.prototype,r=a.addEvent,l=a.removeEvent,h=function(e,t){return function(i,s,n){if(-1==i.indexOf(":relay"))return e.call(this,i,s,n);var o=Slick.parse(i).expressions[0][0];if("relay"!=o.pseudos[0].key)return e.call(this,i,s,n);var a=o.tag;return o.pseudos.slice(1).each(function(e){a+=":"+e.key+(e.value?"("+e.value+")":"")}),e.call(this,i,s),t.call(this,a,o.pseudos[0].value,s)}},u={addEvent:function(e,s,n){var o=this.retrieve("$delegates",{}),a=o[e];if(a)for(var l in a)if(a[l].fn==n&&a[l].match==s)return this;var h=e,u=s,c=n,d=i[e]||{};e=d.base||h,s=function(e){return Slick.match(e,u)};var p=Element.Events[h];if(d.condition||p&&p.condition){var m=s,f=d.condition||p.condition;s=function(t,i){return m(t,i)&&f.call(t,i,e)}}var g=this,v=String.uniqueID(),y=d.listen?function(e,t){!t&&e&&e.target&&(t=e.target),t&&d.listen(g,s,n,e,t,v)}:function(e,i){!i&&e&&e.target&&(i=e.target),i&&t(g,s,n,e,i)};return a||(a={}),a[v]={match:u,fn:c,delegator:y},o[h]=a,r.call(this,e,y,d.capture)},removeEvent:function(e,t,s,n){var o=this.retrieve("$delegates",{}),a=o[e];if(!a)return this;if(n){var r=e,h=a[n].delegator,c=i[e]||{};return e=c.base||r,c.remove&&c.remove(this,n),delete a[n],o[r]=a,l.call(this,e,h,c.capture)}var d,p;if(s){for(d in a)if(p=a[d],p.match==t&&p.fn==s)return u.removeEvent.call(this,e,t,s,d)}else for(d in a)p=a[d],p.match==t&&u.removeEvent.call(this,e,t,p.fn,d);return this}};[Element,Window,Document].invoke("implement",{addEvent:h(r,u.addEvent),removeEvent:h(l,u.removeEvent)})}(),function(){var e,t=document.html;e=document.createElement("div"),e.style.color="red",e.style.color=null;var i="red"==e.style.color,s="1px solid #123abc";e.style.border=s;var n=e.style.border!=s;e=null;var o=!!window.getComputedStyle,a=null!=document.createElement("div").style.borderRadius;Element.Properties.styles={set:function(e){this.setStyles(e)}};var r=null!=t.style.opacity,l=null!=t.style.filter,h=/alpha\(opacity=([\d.]+)\)/i,u=function(e,t){e.store("$opacity",t),e.style.visibility=t>0||null==t?"visible":"hidden"},c=function(e,t,i){var s=e.style,n=s.filter||e.getComputedStyle("filter")||"";s.filter=(t.test(n)?n.replace(t,i):n+" "+i).trim(),s.filter||s.removeAttribute("filter")},d=r?function(e,t){e.style.opacity=t}:l?function(e,t){e.currentStyle&&e.currentStyle.hasLayout||(e.style.zoom=1),null==t||1==t?(c(e,h,""),1==t&&1!=p(e)&&c(e,h,"alpha(opacity=100)")):c(e,h,"alpha(opacity="+(100*t).limit(0,100).round()+")")}:u,p=r?function(e){var t=e.style.opacity||e.getComputedStyle("opacity");return""==t?1:t.toFloat()}:l?function(e){var t,i=e.style.filter||e.getComputedStyle("filter");return i&&(t=i.match(h)),null==t||null==i?1:t[1]/100}:function(e){var t=e.retrieve("$opacity");return null==t&&(t="hidden"==e.style.visibility?0:1),t},m=null==t.style.cssFloat?"styleFloat":"cssFloat",f={left:"0%",top:"0%",center:"50%",right:"100%",bottom:"100%"},g=null!=t.style.backgroundPositionX,v=/^-(ms)-/,y=function(e){return e.replace(v,"$1-").camelCase()},b=function(e,t){"backgroundPosition"==t&&(e.removeAttribute(t+"X"),t+="Y"),e.removeAttribute(t)};Element.implement({getComputedStyle:function(e){if(!o&&this.currentStyle)return this.currentStyle[y(e)];var t=Element.getDocument(this).defaultView,i=t?t.getComputedStyle(this,null):null;return i?i.getPropertyValue(e==m?"float":e.hyphenate()):""},setStyle:function(e,t){if("opacity"==e)return null!=t&&(t=parseFloat(t)),d(this,t),this;if(e=y("float"==e?m:e),"string"!=typeOf(t)){var s=(Element.Styles[e]||"@").split(" ");t=Array.convert(t).map(function(e,t){return s[t]?"number"==typeOf(e)?s[t].replace("@",Math.round(e)):e:""}).join(" ")}else t==String(Number(t))&&(t=Math.round(t));return this.style[e]=t,(""==t||null==t)&&i&&this.style.removeAttribute&&b(this.style,e),this},getStyle:function(e){if("opacity"==e)return p(this);if(e=y("float"==e?m:e),a&&-1!=e.indexOf("borderRadius"))return["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"].map(function(e){return this.style[e]||"0px"},this).join(" ");var t=this.style[e];if(!t||"zIndex"==e){if(Element.ShortStyles.hasOwnProperty(e)){t=[];for(var i in Element.ShortStyles[e])t.push(this.getStyle(i));return t.join(" ")}t=this.getComputedStyle(e)}if(g&&/^backgroundPosition[XY]?$/.test(e))return t.replace(/(top|right|bottom|left)/g,function(e){return f[e]})||"0px";if(!t&&"backgroundPosition"==e)return"0px 0px";if(t){t=String(t);var s=t.match(/rgba?\([\d\s,]+\)/);s&&(t=t.replace(s[0],s[0].rgbToHex()))}if(!o&&!this.style[e]){if(/^(height|width)$/.test(e)&&!/px$/.test(t)){var r="width"==e?["left","right"]:["top","bottom"],l=0;return r.each(function(e){l+=this.getStyle("border-"+e+"-width").toInt()+this.getStyle("padding-"+e).toInt()},this),this["offset"+e.capitalize()]-l+"px"}if(/^border(.+)Width|margin|padding/.test(e)&&isNaN(parseFloat(t)))return"0px"}return n&&/^border(Top|Right|Bottom|Left)?$/.test(e)&&/^#/.test(t)?t.replace(/^(.+)\s(.+)\s(.+)$/,"$2 $3 $1"):t},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},getStyles:function(){var e={};return Array.flatten(arguments).each(function(t){e[t]=this.getStyle(t)},this),e}}),Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundSize:"@px",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@",borderRadius:"@px @px @px @px"},Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}},["Top","Right","Bottom","Left"].each(function(e){var t=Element.ShortStyles,i=Element.Styles;["margin","padding"].each(function(s){var n=s+e;t[s][n]=i[n]="@px"});var s="border"+e;t.border[s]=i[s]="@px @ rgb(@, @, @)";var n=s+"Width",o=s+"Style",a=s+"Color";t[s]={},t.borderWidth[n]=t[s][n]=i[n]="@px",t.borderStyle[o]=t[s][o]=i[o]="@",t.borderColor[a]=t[s][a]=i[a]="rgb(@, @, @)"}),g&&(Element.ShortStyles.backgroundPosition={backgroundPositionX:"@",backgroundPositionY:"@"})}(),function(){function e(e,t){return p(e,t).toInt()||0}function t(t){return e(t,"border-top-width")}function i(t){return e(t,"border-left-width")}function s(e){return/^(?:body|html)$/i.test(e.tagName)}function n(e){var t=e.getDocument();return t.compatMode&&"CSS1Compat"!=t.compatMode?t.body:t.html}var o=document.createElement("div"),a=document.createElement("div");o.style.height="0",o.appendChild(a);var r=a.offsetParent===o;o=a=null;var l=["height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"],h=["width","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],u=function(e){var t=window.getComputedStyle(e),i={x:0,y:0};return l.each(function(e){i.y+=parseFloat(t[e])}),h.each(function(e){i.x+=parseFloat(t[e])}),i},c=function(e){return"static"!=p(e,"position")||s(e)},d=function(e){return c(e)||/^(?:table|td|th)$/i.test(e.tagName)};Element.implement({scrollTo:function(e,t){return s(this)?this.getWindow().scrollTo(e,t):(this.scrollLeft=e,this.scrollTop=t),this},getSize:function(){if(s(this))return this.getWindow().getSize();if(!window.getComputedStyle)return{x:this.offsetWidth,y:this.offsetHeight};if("svg"==this.get("tag"))return u(this);try{var e=this.getBoundingClientRect();return{x:e.width,y:e.height}}catch(e){return{x:0,y:0}}},getScrollSize:function(){return s(this)?this.getWindow().getScrollSize():{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){return s(this)?this.getWindow().getScroll():{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){for(var e=this.parentNode,t={x:0,y:0};e&&!s(e);)t.x+=e.scrollLeft,t.y+=e.scrollTop,e=e.parentNode;return t},getOffsetParent:r?function(){var e=this;if(s(e)||"fixed"==p(e,"position"))return null;for(var t="static"==p(e,"position")?d:c;e=e.parentNode;)if(t(e))return e;return null}:function(){var e=this;if(s(e)||"fixed"==p(e,"position"))return null;try{return e.offsetParent}catch(e){}return null},getOffsets:function(){if(this.getBoundingClientRect){var e=this.getBoundingClientRect(),t=document.id(this.getDocument().documentElement),i=t.getScroll(),n=this.getScrolls(),o="fixed"==p(this,"position");return{x:e.left.toFloat()+n.x+(o?0:i.x)-t.clientLeft,y:e.top.toFloat()+n.y+(o?0:i.y)-t.clientTop}}var a=this,r={x:0,y:0};if(s(this))return r;for(;a&&!s(a);)r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;return r},getPosition:function(e){var s=this.getOffsets(),n=this.getScrolls(),o={x:s.x-n.x,y:s.y-n.y};if(e&&(e=document.id(e))){var a=e.getPosition();return{x:o.x-a.x-i(e),y:o.y-a.y-t(e)}}return o},getCoordinates:function(e){if(s(this))return this.getWindow().getCoordinates();var t=this.getPosition(e),i=this.getSize(),n={left:t.x,top:t.y,width:i.x,height:i.y};return n.right=n.left+n.width,n.bottom=n.top+n.height,n},computePosition:function(t){return{left:t.x-e(this,"margin-left"),top:t.y-e(this,"margin-top")}},setPosition:function(e){return this.setStyles(this.computePosition(e))}}),[Document,Window].invoke("implement",{getSize:function(){var e=n(this);return{x:e.clientWidth,y:e.clientHeight}},getScroll:function(){var e=this.getWindow(),t=n(this);return{x:e.pageXOffset||t.scrollLeft,y:e.pageYOffset||t.scrollTop}},getScrollSize:function(){var e=n(this),t=this.getSize(),i=this.getDocument().body;return{x:Math.max(e.scrollWidth,i.scrollWidth,t.x),y:Math.max(e.scrollHeight,i.scrollHeight,t.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var e=this.getSize();return{top:0,left:0,bottom:e.y,right:e.x,height:e.y,width:e.x}}});var p=Element.getComputedStyle}(),Element.alias({position:"setPosition"}),[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}}),function(){var e=this.Fx=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{fps:60,unit:!1,duration:500,frames:null,frameSkip:!0,link:"ignore"},initialize:function(e){this.subject=this.subject||this,this.setOptions(e)},getTransition:function(){return function(e){return-(Math.cos(Math.PI*e)-1)/2}},step:function(e){if(this.options.frameSkip){var t=null!=this.time?e-this.time:0,i=t/this.frameInterval;this.time=e,this.frame+=i}else this.frame++;if(this.frame<this.frames){var s=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,s))}else this.frame=this.frames,this.set(this.compute(this.from,this.to,1)),this.stop()},set:function(e){return e},compute:function(t,i,s){return e.compute(t,i,s)},check:function(){if(!this.isRunning())return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},start:function(t,i){if(!this.check(t,i))return this;this.from=t,this.to=i,this.frame=this.options.frameSkip?0:-1,this.time=null,this.transition=this.getTransition();var s=this.options.frames,o=this.options.fps,a=this.options.duration;return this.duration=e.Durations[a]||a.toInt(),this.frameInterval=1e3/o,this.frames=s||Math.round(this.duration/this.frameInterval),"pending"!==this.getThenableState()&&this.resetThenable(this.subject),this.fireEvent("start",this.subject),n.call(this,o),this},stop:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps),this.frames==this.frame?(this.fireEvent("complete",this.subject),this.callChain()||this.fireEvent("chainComplete",this.subject)):this.fireEvent("stop",this.subject),this.resolve(this.subject===this?null:this.subject)),this},cancel:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps),this.frame=this.frames,this.fireEvent("cancel",this.subject).clearChain(),this.reject(this.subject)),this},pause:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps)),this},resume:function(){return this.isPaused()&&n.call(this,this.options.fps),this},isRunning:function(){var e=t[this.options.fps];return e&&e.contains(this)},isPaused:function(){return this.frame<this.frames&&!this.isRunning()}});e.compute=function(e,t,i){return(t-e)*i+e},e.Durations={short:250,normal:500,long:1e3};var t={},i={},s=function(){for(var e=Date.now(),t=this.length;t--;){var i=this[t];i&&i.step(e)}},n=function(e){var n=t[e]||(t[e]=[]);n.push(this),i[e]||(i[e]=s.periodical(Math.round(1e3/e),n))},o=function(e){var s=t[e];s&&(s.erase(this),!s.length&&i[e]&&(delete t[e],i[e]=clearInterval(i[e])))}}(),Fx.CSS=new Class({Extends:Fx,prepare:function(e,t,i){i=Array.convert(i);var s=i[0],n=i[1];if(null==n){n=s,s=e.getStyle(t);var o=this.options.unit;if(o&&s&&"string"==typeof s&&s.slice(-o.length)!=o&&0!=parseFloat(s)){e.setStyle(t,n+o);var a=e.getComputedStyle(t);if(!/px$/.test(a)&&null==(a=e.style[("pixel-"+t).camelCase()])){var r=e.style.left;e.style.left=n+o,a=e.style.pixelLeft,e.style.left=r}s=(n||1)/(parseFloat(a)||1)*(parseFloat(s)||0),e.setStyle(t,s+o)}}return{from:this.parse(s),to:this.parse(n)}},parse:function(e){return e=Function.convert(e)(),e="string"==typeof e?e.split(" "):Array.convert(e),e.map(function(e){e=String(e);var t=!1;return Object.each(Fx.CSS.Parsers,function(i){if(!t){var s=i.parse(e);(s||0===s)&&(t={value:s,parser:i})}}),t=t||{value:e,parser:Fx.CSS.Parsers.String}})},compute:function(e,t,i){var s=[];return Math.min(e.length,t.length).times(function(n){s.push({value:e[n].parser.compute(e[n].value,t[n].value,i),parser:e[n].parser})}),s.$family=Function.convert("fx:css:value"),s},serve:function(e,t){"fx:css:value"!=typeOf(e)&&(e=this.parse(e));var i=[];return e.each(function(e){i=i.concat(e.parser.serve(e.value,t))}),i},render:function(e,t,i,s){e.setStyle(t,this.serve(i,s))},search:function(e){if(Fx.CSS.Cache[e])return Fx.CSS.Cache[e];var t={},i=new RegExp("^"+e.escapeRegExp()+"$"),s=function(e){Array.each(e,function(e){if(e.media)return void s(e.rules||e.cssRules);if(e.style){var n=e.selectorText?e.selectorText.replace(/^\w+/,function(e){return e.toLowerCase()}):null;n&&i.test(n)&&Object.each(Element.Styles,function(i,s){e.style[s]&&!Element.ShortStyles[s]&&(i=String(e.style[s]),t[s]=/^rgb/.test(i)?i.rgbToHex():i)})}})};return Array.each(document.styleSheets,function(e){var t=e.href;if(!(t&&t.indexOf("://")>-1&&-1==t.indexOf(document.domain))){var i=e.rules||e.cssRules;s(i)}}),Fx.CSS.Cache[e]=t}}),Fx.CSS.Cache={},Fx.CSS.Parsers={Color:{parse:function(e){return e.match(/^#[0-9a-f]{3,6}$/i)?e.hexToRgb(!0):!!(e=e.match(/(\d+),\s*(\d+),\s*(\d+)/))&&[e[1],e[2],e[3]]},compute:function(e,t,i){return e.map(function(s,n){return Math.round(Fx.compute(e[n],t[n],i))})},serve:function(e){return e.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(e,t){return t?e+t:e}},String:{parse:Function.convert(!1),compute:function(e,t){return t},serve:function(e){return e}}},Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(e,t){this.element=this.subject=document.id(e),this.parent(t)},set:function(e){"string"==typeof e&&(e=this.search(e));for(var t in e)this.render(this.element,t,e[t],this.options.unit);return this},compute:function(e,t,i){var s={};for(var n in e)s[n]=this.parent(e[n],t[n],i);return s},start:function(e){if(!this.check(e))return this;"string"==typeof e&&(e=this.search(e));var t={},i={};for(var s in e){var n=this.prepare(this.element,s,e[s]);t[s]=n.from,i[s]=n.to}return this.parent(t,i)}}),Element.Properties.morph={set:function(e){return this.get("morph").cancel().setOptions(e),this},get:function(){var e=this.retrieve("morph");return e||(e=new Fx.Morph(this,{link:"cancel"}),this.store("morph",e)),e}},Element.implement({morph:function(e){return this.get("morph").start(e),this}}),Fx.implement({getTransition:function(){var e=this.options.transition||Fx.Transitions.Sine.easeInOut;if("string"==typeof e){var t=e.split(":");e=Fx.Transitions,e=e[t[0]]||e[t[0].capitalize()],t[1]&&(e=e["ease"+t[1].capitalize()+(t[2]?t[2].capitalize():"")])}return e}}),Fx.Transition=function(e,t){t=Array.convert(t);var i=function(i){return e(i,t)};return Object.append(i,{easeIn:i,easeOut:function(i){return 1-e(1-i,t)},easeInOut:function(i){return(.5>=i?e(2*i,t):2-e(2*(1-i),t))/2}})},Fx.Transitions={linear:function(e){return e}},Fx.Transitions.extend=function(e){for(var t in e)Fx.Transitions[t]=new Fx.Transition(e[t])},Fx.Transitions.extend({Pow:function(e,t){return Math.pow(e,t&&t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Back:function(e,t){return t=t&&t[0]||1.618,Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){for(var t,i=0,s=1;1;i+=s,s/=2)if(e>=(7-4*i)/11){t=s*s-Math.pow((11-6*i-11*e)/4,2);break}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t&&t[0]||1)/3)}}),["Quad","Cubic","Quart","Quint"].each(function(e,t){Fx.Transitions[e]=new Fx.Transition(function(e){return Math.pow(e,t+2)})}),Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(e,t){this.element=this.subject=document.id(e),this.parent(t)},set:function(e,t){return 1==arguments.length&&(t=e,e=this.property||this.options.property),this.render(this.element,e,t,this.options.unit),this},start:function(e,t,i){if(!this.check(e,t,i))return this;var s=Array.flatten(arguments);this.property=this.options.property||s.shift();var n=this.prepare(this.element,this.property,s);return this.parent(n.from,n.to)}}),Element.Properties.tween={set:function(e){return this.get("tween").cancel().setOptions(e),this},get:function(){var e=this.retrieve("tween");return e||(e=new Fx.Tween(this,{link:"cancel"}),this.store("tween",e)),e}},Element.implement({tween:function(e,t,i){return this.get("tween").start(e,t,i),this},fade:function(){var e,t,i=this.get("tween"),s=["opacity"].append(arguments);switch(null==s[1]&&(s[1]="toggle"),s[1]){case"in":e="start",s[1]=1;break;case"out":e="start",s[1]=0;break;case"show":e="set",s[1]=1;break;case"hide":e="set",s[1]=0;break;case"toggle":var n=this.retrieve("fade:flag",1==this.getStyle("opacity"));e="start",s[1]=n?0:1,this.store("fade:flag",!n),t=!0;break;default:e="start"}t||this.eliminate("fade:flag"),i[e].apply(i,s);var o=s[s.length-1];return"set"==e?this.setStyle("visibility",0==o?"hidden":"visible"):0!=o?i.$chain.length?i.chain(function(){this.element.setStyle("visibility","visible"),this.callChain()}):this.setStyle("visibility","visible"):i.chain(function(){this.element.getStyle("opacity")||(this.element.setStyle("visibility","hidden"),this.callChain())}),this},highlight:function(e,t){t||(t=this.retrieve("highlight:original",this.getStyle("background-color")),t="transparent"==t?"#fff":t);var i=this.get("tween");return i.start("background-color",e||"#ffff88",t).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original")),i.callChain()}.bind(this)),this}}),function(){var e=function(){},t="onprogress"in new Browser.Request,i=this.Request=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:!0,format:!1,method:"post",link:"ignore",isSuccess:null,emulation:!0,urlEncoded:!0,encoding:"utf-8",evalScripts:!1,evalResponse:!1,timeout:0,noCache:!1},initialize:function(e){this.xhr=new Browser.Request,this.setOptions(e),this.headers=this.options.headers},onStateChange:function(){var i=this.xhr;4==i.readyState&&this.running&&(this.running=!1,this.status=0,Function.attempt(function(){var e=i.status;this.status=1223==e?204:e}.bind(this)),i.onreadystatechange=e,t&&(i.onprogress=i.onloadstart=e),this.timer&&(clearTimeout(this.timer),delete this.timer),this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML},this.options.isSuccess.call(this,this.status)?this.success(this.response.text,this.response.xml):this.failure())},isSuccess:function(){var e=this.status;return e>=200&&300>e},isRunning:function(){return!!this.running},processScripts:function(e){return this.options.evalResponse||/(ecma|java)script/.test(this.getHeader("Content-type"))?Browser.exec(e):e.stripScripts(this.options.evalScripts)},success:function(e,t){this.onSuccess(this.processScripts(e),t),this.resolve({text:e,xml:t})},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure(),this.reject({reason:"failure",xhr:this.xhr})},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(e){this.fireEvent("loadstart",[e,this.xhr])},progress:function(e){this.fireEvent("progress",[e,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr),this.reject({reason:"timeout",xhr:this.xhr})},setHeader:function(e,t){return this.headers[e]=t,this},getHeader:function(e){return Function.attempt(function(){return this.xhr.getResponseHeader(e)}.bind(this))},check:function(){if(!this.running)return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},send:function(e){if(!this.check(e))return this;this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0;var i=typeOf(e);("string"==i||"element"==i)&&(e={data:e});var s=this.options;e=Object.append({data:s.data,url:s.url,method:s.method},e);var n=e.data,o=String(e.url),a=e.method.toLowerCase();switch(typeOf(n)){case"element":n=document.id(n).toQueryString();break;case"object":case"hash":n=Object.toQueryString(n)}if(this.options.format){var r="format="+this.options.format;n=n?r+"&"+n:r}if(this.options.emulation&&!["get","post"].contains(a)){var l="_method="+a;n=n?l+"&"+n:l,a="post"}if(this.options.urlEncoded&&["post","put"].contains(a)){var h=this.options.encoding?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+h}o||(o=document.location.pathname);var u=o.lastIndexOf("/");u>-1&&(u=o.indexOf("#"))>-1&&(o=o.substr(0,u)),this.options.noCache&&(o+=(o.indexOf("?")>-1?"&":"?")+String.uniqueID()),!n||"get"!=a&&"delete"!=a||(o+=(o.indexOf("?")>-1?"&":"?")+n,n=null);var c=this.xhr;return t&&(c.onloadstart=this.loadstart.bind(this),c.onprogress=this.progress.bind(this)),c.open(a.toUpperCase(),o,this.options.async,this.options.user,this.options.password),this.options.withCredentials&&"withCredentials"in c&&(c.withCredentials=!0),c.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,function(e,t){try{c.setRequestHeader(t,e)}catch(i){this.fireEvent("exception",[t,e]),this.reject({reason:"exception",xhr:c,exception:i})}},this),"pending"!==this.getThenableState()&&this.resetThenable({reason:"send"}),this.fireEvent("request"),c.send(n),this.options.async?this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)):this.onStateChange(),this},cancel:function(){if(!this.running)return this;this.running=!1;var i=this.xhr;return i.abort(),this.timer&&(clearTimeout(this.timer),delete this.timer),i.onreadystatechange=e,t&&(i.onprogress=i.onloadstart=e),this.xhr=new Browser.Request,this.fireEvent("cancel"),this.reject({reason:"cancel",xhr:i}),this}}),s={};["get","post","put","delete","patch","head","GET","POST","PUT","DELETE","PATCH","HEAD"].each(function(e){s[e]=function(t){var i={method:e};return null!=t&&(i.data=t),this.send(i)}}),i.implement(s),Element.Properties.send={set:function(e){return this.get("send").cancel().setOptions(e),this},get:function(){var e=this.retrieve("send");return e||(e=new i({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")}),this.store("send",e)),e}},Element.implement({send:function(e){var t=this.get("send");return t.send({data:this,url:e||t.options.url}),this}})}(),Request.HTML=new Class({Extends:Request,options:{update:!1,append:!1,evalScripts:!0,filter:!1,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(e){var t=this.options,i=this.response;i.html=e.stripScripts(function(e){i.javascript=e});var s=i.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);s&&(i.html=s[1]);var n=new Element("div").set("html",i.html);if(i.tree=n.childNodes,i.elements=n.getElements(t.filter||"*"),t.filter&&(i.tree=i.elements),t.update){var o=document.id(t.update).empty();t.filter?o.adopt(i.elements):o.set("html",i.html)}else if(t.append){var a=document.id(t.append);t.filter?i.elements.reverse().inject(a):a.adopt(n.getChildren())}t.evalScripts&&Browser.exec(i.javascript),this.onSuccess(i.tree,i.elements,i.html,i.javascript),this.resolve({tree:i.tree,elements:i.elements,html:i.html,javascript:i.javascript})}}),Element.Properties.load={set:function(e){return this.get("load").cancel().setOptions(e),this},get:function(){var e=this.retrieve("load");return e||(e=new Request.HTML({data:this,link:"cancel",update:this,method:"get"}),this.store("load",e)),e}},Element.implement({load:function(){return this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString})),this}}),"undefined"==typeof JSON&&(this.JSON={}),function(){var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},escape=function(e){return special[e]||"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(e){return e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e)},JSON.encode=JSON.stringify?function(e){return JSON.stringify(e)}:function(e){switch(e&&e.toJSON&&(e=e.toJSON()),typeOf(e)){case"string":return'"'+e.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+e.map(JSON.encode).clean()+"]";case"object":case"hash":var t=[];return Object.each(e,function(e,i){var s=JSON.encode(e);s&&t.push(JSON.encode(i)+":"+s)}),"{"+t+"}";case"number":case"boolean":return""+e;case"null":return"null"}return null},JSON.secure=!0,JSON.decode=function(string,secure){if(!string||"string"!=typeOf(string))return null;if(null==secure&&(secure=JSON.secure),secure){if(JSON.parse)return JSON.parse(string);if(!JSON.validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.")}return eval("("+string+")")}}(),Request.JSON=new Class({Extends:Request,options:{secure:!0},initialize:function(e){this.parent(e),Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(e){var t;try{t=this.response.json=JSON.decode(e,this.options.secure)}catch(t){return void this.fireEvent("error",[e,t])}null==t?this.failure():(this.onSuccess(t,e),this.resolve({json:t,text:e}))}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:!1,duration:!1,secure:!1,document:document,encode:!0,httpOnly:!1},initialize:function(e,t){this.key=e,this.setOptions(t)},write:function(e){if(this.options.encode&&(e=encodeURIComponent(e)),this.options.domain&&(e+="; domain="+this.options.domain),this.options.path&&(e+="; path="+this.options.path),this.options.duration){var t=new Date;t.setTime(t.getTime()+24*this.options.duration*60*60*1e3),e+="; expires="+t.toGMTString()}return this.options.secure&&(e+="; secure"),this.options.httpOnly&&(e+="; HttpOnly"),this.options.document.cookie=this.key+"="+e,this},read:function(){var e=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return e?decodeURIComponent(e[1]):null},dispose:function(){return new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write(""),this}});Cookie.write=function(e,t,i){return new Cookie(e,i).write(t)},Cookie.read=function(e){return new Cookie(e).read()},Cookie.dispose=function(e,t){return new Cookie(e,t).dispose()},function(e,t){var i,s,n,o,a=[],r=t.createElement("div"),l=function(){clearTimeout(o),i||(Browser.loaded=i=!0,t.removeListener("DOMContentLoaded",l).removeListener("readystatechange",h),t.fireEvent("domready"),e.fireEvent("domready")),t=e=r=null},h=function(){for(var e=a.length;e--;)if(a[e]())return l(),!0;return!1},u=function(){clearTimeout(o),h()||(o=setTimeout(u,10))};t.addListener("DOMContentLoaded",l);var c=function(){try{return r.doScroll(),!0}catch(e){}return!1};r.doScroll&&!c()&&(a.push(c),n=!0),t.readyState&&a.push(function(){var e=t.readyState;return"loaded"==e||"complete"==e}),"onreadystatechange"in t?t.addListener("readystatechange",h):n=!0,n&&u(),Element.Events.domready={onAdd:function(e){i&&e.call(this)}},Element.Events.load={base:"load",onAdd:function(t){s&&this==e&&t.call(this)},condition:function(){return this==e&&(l(),delete Element.Events.load),!0}},e.addEvent("load",function(){s=!0})}(window,document),MooTools.More={version:"1.6.0",build:"45b71db70f879781a7e0b0d3fb3bb1307c2521eb"},function(){var e={wait:function(e){return this.chain(function(){return this.callChain.delay(null==e?500:e,this),this}.bind(this))}};Chain.implement(e),this.Fx&&Fx.implement(e),this.Element&&Element.implement&&this.Fx&&Element.implement({chains:function(e){return Array.convert(e||["tween","morph","reveal"]).each(function(e){(e=this.get(e))&&e.setOptions({link:"chain"})},this),this},pauseFx:function(e,t){return this.chains(t).get(t||"tween").wait(e),this}})}(),Class.Mutators.Binds=function(e){return this.prototype.initialize||this.implement("initialize",function(){}),Array.convert(e).concat(this.prototype.Binds||[])},Class.Mutators.initialize=function(e){return function(){return Array.convert(this.Binds).each(function(e){var t=this[e];t&&(this[e]=t.bind(this))},this),e.apply(this,arguments)}},Class.Occlude=new Class({occlude:function(e,t){t=document.id(t||this.element);var i=t.retrieve(e||this.property)
;return i&&!this.occluded?this.occluded=i:(this.occluded=!1,t.store(e||this.property,this),this.occluded)}}),Class.refactor=function(e,t){return Object.each(t,function(t,i){var s=e.prototype[i];s=s&&s.$origin||s||function(){},e.implement(i,"function"==typeof t?function(){var e=this.previous;this.previous=s;var i=t.apply(this,arguments);return this.previous=e,i}:t)}),e},Class.Singleton=new Class({initialize:function(e){var t,i=new Class(e);return function(){if(t)return t;t=Object.append({},i.prototype),t.constructor=i;var e=i.apply(t,arguments);return t="object"==typeof e?e:t}}}),function(){Events.Pseudos=function(e,t,i){var s="_monitorEvents:",n=function(e){return{store:e.store?function(t,i){e.store(s+t,i)}:function(t,i){(e._monitorEvents||(e._monitorEvents={}))[t]=i},retrieve:e.retrieve?function(t,i){return e.retrieve(s+t,i)}:function(t,i){return e._monitorEvents?e._monitorEvents[t]||i:i}}},o=function(t){if(-1==t.indexOf(":")||!e)return null;for(var i=Slick.parse(t).expressions[0][0],s=i.pseudos,n=s.length,o=[];n--;){var a=s[n].key,r=e[a];null!=r&&o.push({event:i.tag,value:s[n].value,pseudo:a,original:t,listener:r})}return o.length?o:null};return{addEvent:function(e,i,s){var a=o(e);if(!a)return t.call(this,e,i,s);var r=n(this),l=r.retrieve(e,[]),h=a[0].event,u=Array.slice(arguments,2),c=i,d=this;return a.each(function(e){var t=e.listener,i=c;0==t?h+=":"+e.pseudo+"("+e.value+")":c=function(){t.call(d,e,i,arguments,c)}}),l.include({type:h,event:i,monitor:c}),r.store(e,l),e!=h&&t.apply(this,[e,i].concat(u)),t.apply(this,[h,c].concat(u))},removeEvent:function(e,t){if(!o(e))return i.call(this,e,t);var s=n(this),a=s.retrieve(e);if(!a)return this;var r=Array.slice(arguments,2);return i.apply(this,[e,t].concat(r)),a.each(function(e,s){t&&e.event!=t||i.apply(this,[e.type,e.monitor].concat(r)),delete a[s]},this),s.store(e,a),this}}};var e={once:function(e,t,i,s){t.apply(this,i),this.removeEvent(e.event,s).removeEvent(e.original,t)},throttle:function(e,t,i){t._throttled||(t.apply(this,i),t._throttled=setTimeout(function(){t._throttled=!1},e.value||250))},pause:function(e,t,i){clearTimeout(t._pause),t._pause=t.delay(e.value||250,this,i)}};Events.definePseudo=function(t,i){return e[t]=i,this},Events.lookupPseudo=function(t){return e[t]};var t=Events.prototype;Events.implement(Events.Pseudos(e,t.addEvent,t.removeEvent)),["Request","Fx"].each(function(e){this[e]&&this[e].implement(Events.prototype)})}(),function(){var e=this.Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,unDraggableTags:["button","input","a","textarea","select","option"],preventDefault:!1,stopPropagation:!1,compensateScroll:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var t=Array.link(arguments,{options:Type.isObject,element:function(e){return null!=e}});this.element=document.id(t.element),this.document=this.element.getDocument(),this.setOptions(t.options||{});var i=typeOf(this.options.handle);this.handles=("array"==i||"collection"==i?$$(this.options.handle):document.id(this.options.handle))||this.element,this.mouse={now:{},pos:{}},this.value={start:{},now:{}},this.offsetParent=function(e){var t=e.getOffsetParent();return!t||/^(?:body|html)$/i.test(t.tagName)?window:document.id(t)}(this.element),this.selection="selectstart"in document?"selectstart":"mousedown",this.compensateScroll={start:{},diff:{},last:{}},!("ondragstart"in document)||"FileReader"in window||e.ondragstartFixed||(document.ondragstart=Function.convert(!1),e.ondragstartFixed=!0),this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.convert(!1),scrollListener:this.scrollListener.bind(this)},this.attach()},attach:function(){return this.handles.addEvent("mousedown",this.bound.start),this.handles.addEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.addEvent("scroll",this.bound.scrollListener),this},detach:function(){return this.handles.removeEvent("mousedown",this.bound.start),this.handles.removeEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.removeEvent("scroll",this.bound.scrollListener),this},scrollListener:function(){if(this.mouse.start){var e=this.offsetParent.getScroll();if("absolute"==this.element.getStyle("position")){var t=this.sumValues(e,this.compensateScroll.last,-1);this.mouse.now=this.sumValues(this.mouse.now,t,1)}else this.compensateScroll.diff=this.sumValues(e,this.compensateScroll.start,-1);this.offsetParent!=window&&(this.compensateScroll.diff=this.sumValues(this.compensateScroll.start,e,-1)),this.compensateScroll.last=e,this.render(this.options)}},sumValues:function(e,t,i){var s={},n=this.options;for(var o in n.modifiers)n.modifiers[o]&&(s[o]=e[o]+t[o]*i);return s},start:function(e){if(!this.options.unDraggableTags.contains(e.target.get("tag"))){var t=this.options;if(!e.rightClick){t.preventDefault&&e.preventDefault(),t.stopPropagation&&e.stopPropagation(),this.compensateScroll.start=this.compensateScroll.last=this.offsetParent.getScroll(),this.compensateScroll.diff={x:0,y:0},this.mouse.start=e.page,this.fireEvent("beforeStart",this.element);var i=t.limit;this.limit={x:[],y:[]};var s,n,o=this.offsetParent==window?null:this.offsetParent;for(s in t.modifiers)if(t.modifiers[s]){var a=this.element.getStyle(t.modifiers[s]);if(a&&!a.match(/px$/)&&(n||(n=this.element.getCoordinates(o)),a=n[t.modifiers[s]]),t.style?this.value.now[s]=(a||0).toInt():this.value.now[s]=this.element[t.modifiers[s]],t.invert&&(this.value.now[s]*=-1),this.mouse.pos[s]=e.page[s]-this.value.now[s],i&&i[s])for(var r=2;r--;){var l=i[s][r];(l||0===l)&&(this.limit[s][r]="function"==typeof l?l():l)}}"number"==typeOf(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});var h={mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel};h[this.selection]=this.bound.eventStop,this.document.addEvents(h)}}},check:function(e){this.options.preventDefault&&e.preventDefault(),Math.round(Math.sqrt(Math.pow(e.page.x-this.mouse.start.x,2)+Math.pow(e.page.y-this.mouse.start.y,2)))>this.options.snap&&(this.cancel(),this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop}),this.fireEvent("start",[this.element,e]).fireEvent("snap",this.element))},drag:function(e){var t=this.options;t.preventDefault&&e.preventDefault(),this.mouse.now=this.sumValues(e.page,this.compensateScroll.diff,-1),this.render(t),this.fireEvent("drag",[this.element,e])},render:function(e){for(var t in e.modifiers)e.modifiers[t]&&(this.value.now[t]=this.mouse.now[t]-this.mouse.pos[t],e.invert&&(this.value.now[t]*=-1),e.limit&&this.limit[t]&&((this.limit[t][1]||0===this.limit[t][1])&&this.value.now[t]>this.limit[t][1]?this.value.now[t]=this.limit[t][1]:(this.limit[t][0]||0===this.limit[t][0])&&this.value.now[t]<this.limit[t][0]&&(this.value.now[t]=this.limit[t][0])),e.grid[t]&&(this.value.now[t]-=(this.value.now[t]-(this.limit[t][0]||0))%e.grid[t]),e.style?this.element.setStyle(e.modifiers[t],this.value.now[t]+e.unit):this.element[e.modifiers[t]]=this.value.now[t])},cancel:function(e){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel}),e&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(e){var t={mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop};t[this.selection]=this.bound.eventStop,this.document.removeEvents(t),this.mouse.start=null,e&&this.fireEvent("complete",[this.element,e])}})}(),Element.implement({makeResizable:function(e){var t=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},e));return this.store("resizer",t),t.addEvent("drag",function(){this.fireEvent("resize",t)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(e,t){if(this.parent(e,t),e=this.element,this.droppables=$$(this.options.droppables),this.setContainer(this.options.container),this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var i=e.getOffsetParent(),s=e.getStyles("left","top");!i||"auto"!=s.left&&"auto"!=s.top||e.setPosition(e.getPosition(i))}"static"==e.getStyle("position")&&e.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0),this.overed=null},setContainer:function(e){this.container=document.id(e),this.container&&"element"!=typeOf(this.container)&&(this.container=document.id(this.container.getDocument().body))},start:function(e){this.container&&(this.options.limit=this.calculateLimit()),this.options.precalculate&&(this.positions=this.droppables.map(function(e){return e.getCoordinates()})),this.parent(e)},calculateLimit:function(){var e=this.element,t=this.container,i=document.id(e.getOffsetParent())||document.body,s=t.getCoordinates(i),n={},o={},a={},r={},l={},h=i.getScroll();["top","right","bottom","left"].each(function(s){n[s]=e.getStyle("margin-"+s).toInt(),o[s]=e.getStyle("border-"+s).toInt(),a[s]=t.getStyle("margin-"+s).toInt(),r[s]=t.getStyle("border-"+s).toInt(),l[s]=i.getStyle("padding-"+s).toInt()},this);var u=e.offsetWidth+n.left+n.right,c=e.offsetHeight+n.top+n.bottom,d=0+h.x,p=0+h.y,m=s.right-r.right-u+h.x,f=s.bottom-r.bottom-c+h.y;if(this.options.includeMargins?(d+=n.left,p+=n.top):(m+=n.right,f+=n.bottom),"relative"==e.getStyle("position")){var g=e.getCoordinates(i);g.left-=e.getStyle("left").toInt(),g.top-=e.getStyle("top").toInt(),d-=g.left,p-=g.top,"relative"!=t.getStyle("position")&&(d+=r.left,p+=r.top),m+=n.left-g.left,f+=n.top-g.top,t!=i&&(d+=a.left+l.left,!l.left&&0>d&&(d=0),p+=i==document.body?0:a.top+l.top,!l.top&&0>p&&(p=0))}else d-=n.left,p-=n.top,t!=i&&(d+=s.left+r.left,p+=s.top+r.top);return{x:[d,m],y:[p,f]}},getDroppableCoordinates:function(e){var t=e.getCoordinates();if("fixed"==e.getStyle("position")){var i=window.getScroll();t.left+=i.x,t.right+=i.x,t.top+=i.y,t.bottom+=i.y}return t},checkDroppables:function(){var e=this.droppables.filter(function(e,t){e=this.positions?this.positions[t]:this.getDroppableCoordinates(e);var i=this.mouse.now;return i.x>e.left&&i.x<e.right&&i.y<e.bottom&&i.y>e.top},this).getLast();this.overed!=e&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),e&&this.fireEvent("enter",[this.element,e]),this.overed=e)},drag:function(e){this.parent(e),this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(e){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,e]),this.overed=null,this.parent(e)}}),Element.implement({makeDraggable:function(e){var t=new Drag.Move(this,e);return this.store("dragger",t),t}}),function(){var e=function(e,t){var i=[];return Object.each(t,function(t){Object.each(t,function(t){e.each(function(e){i.push(e+"-"+t+("border"==e?"-width":""))})})}),i},t=function(e,t){var i=0;return Object.each(t,function(t,s){s.test(e)&&(i+=t.toInt())}),i},i=function(e){return!(e&&!e.offsetHeight&&!e.offsetWidth)};Element.implement({measure:function(e){if(i(this))return e.call(this);for(var t=this.getParent(),s=[];!i(t)&&t!=document.body;)s.push(t.expose()),t=t.getParent();var n=this.expose(),o=e.call(this);return n(),s.each(function(e){e()}),o},expose:function(){if("none"!=this.getStyle("display"))return function(){};var e=this.style.cssText;return this.setStyles({display:"block",position:"absolute",visibility:"hidden"}),function(){this.style.cssText=e}.bind(this)},getDimensions:function(e){e=Object.merge({computeSize:!1},e);var t={x:0,y:0},i=function(e,t){return t.computeSize?e.getComputedSize(t):e.getSize()},s=this.getParent("body");if(s&&"none"==this.getStyle("display"))t=this.measure(function(){return i(this,e)});else if(s)try{t=i(this,e)}catch(e){}return Object.append(t,t.x||0===t.x?{width:t.x,height:t.y}:{x:t.width,y:t.height})},getComputedSize:function(i){i=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},i);var s,n={},o={width:0,height:0};return"vertical"==i.mode?(delete o.width,delete i.planes.width):"horizontal"==i.mode&&(delete o.height,delete i.planes.height),e(i.styles,i.planes).each(function(e){n[e]=this.getStyle(e).toInt()},this),Object.each(i.planes,function(e,i){var a=i.capitalize(),r=this.getStyle(i);"auto"!=r||s||(s=this.getDimensions()),r=n[i]="auto"==r?s[i]:r.toInt(),o["total"+a]=r,e.each(function(e){var i=t(e,n);o["computed"+e.capitalize()]=i,o["total"+a]+=i})},this),Object.append(o,n)}})}(),function(){this.Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(e){this.setKnobPosition(e)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(e,t,i){this.setOptions(i),i=this.options,this.element=document.id(e),t=this.knob=document.id(t),this.previousChange=this.previousEnd=this.step=i.initialStep?i.initialStep:i.range?i.range[0]:0;var s={},n={x:!1,y:!1};switch(i.mode){case"vertical":this.axis="y",this.property="top",this.offset="offsetHeight";break;case"horizontal":this.axis="x",this.property="left",this.offset="offsetWidth"}this.setSliderDimensions(),this.setRange(i.range,null,!0),"static"==t.getStyle("position")&&t.setStyle("position","relative"),t.setStyle(this.property,-i.offset),n[this.axis]=this.property,s[this.axis]=[-i.offset,this.full-i.offset];var o={snap:0,limit:s,modifiers:n,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1,this.draggedKnob(),this.end()}.bind(this)};i.snap&&this.setSnap(o),this.drag=new Drag(t,o),null!=i.initialStep&&this.set(i.initialStep,!0),this.attach()},attach:function(){return this.element.addEvent("mousedown",this.clickedElement),this.options.wheel&&this.element.addEvent("mousewheel",this.scrolledElement),this.drag.attach(),this},detach:function(){return this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement),this.drag.detach(),this},autosize:function(){return this.setSliderDimensions().setKnobPosition(this.toPosition(this.step)),this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset],this.options.snap&&this.setSnap(),this},setSnap:function(e){return e||(e=this.drag.options),e.grid=Math.ceil(this.stepWidth),e.limit[this.axis][1]=this.element[this.offset],this},setKnobPosition:function(e){return this.options.snap&&(e=this.toPosition(this.step)),this.knob.setStyle(this.property,e),this},setSliderDimensions:function(){return this.full=this.element.measure(function(){return this.half=this.knob[this.offset]/2,this.element[this.offset]-this.knob[this.offset]+2*this.options.offset}.bind(this)),this},set:function(e,t){return this.range>0^e<this.min||(e=this.min),this.range>0^e>this.max||(e=this.max),this.step=e.round(this.modulus.decimalLength),t?this.checkStep().setKnobPosition(this.toPosition(this.step)):this.checkStep().fireEvent("tick",this.toPosition(this.step)).fireEvent("move").end(),this},setRange:function(e,t,i){return this.min=Array.pick([e[0],0]),this.max=Array.pick([e[1],this.options.steps]),this.range=this.max-this.min,this.steps=this.options.steps||this.full,this.stepSize=Math.abs(this.range)/this.steps,this.stepWidth=this.stepSize*this.full/Math.abs(this.range),this.setModulus(),e&&this.set(Array.pick([t,this.step]).limit(this.min,this.max),i),this},setModulus:function(){for(var e=((this.stepSize+"").split(".")[1]||[]).length,t="1";e--;)t+="0";this.modulus={multiplier:t.toInt(10),decimalLength:t.length-1}},clickedElement:function(e){if(!this.isDragging&&e.target!=this.knob){var t=this.range<0?-1:1,i=e.page[this.axis]-this.element.getPosition()[this.axis]-this.half;i=i.limit(-this.options.offset,this.full-this.options.offset),this.step=(this.min+t*this.toStep(i)).round(this.modulus.decimalLength),this.checkStep().fireEvent("tick",i).fireEvent("move").end()}},scrolledElement:function(e){var t="horizontal"==this.options.mode?e.wheel<0:e.wheel>0;this.set(this.step+(t?-1:1)*this.stepSize),e.stop()},draggedKnob:function(){var e=this.range<0?-1:1,t=this.drag.value.now[this.axis];t=t.limit(-this.options.offset,this.full-this.options.offset),this.step=(this.min+e*this.toStep(t)).round(this.modulus.decimalLength),this.checkStep(),this.fireEvent("move")},checkStep:function(){var e=this.step;return this.previousChange!=e&&(this.previousChange=e,this.fireEvent("change",e)),this},end:function(){var e=this.step;return this.previousEnd!==e&&(this.previousEnd=e,this.fireEvent("complete",e+"")),this},toStep:function(e){var t=(e+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?(t-t*this.modulus.multiplier%(this.stepSize*this.modulus.multiplier)/this.modulus.multiplier).round(this.modulus.decimalLength):t},toPosition:function(e){return this.full*Math.abs(this.min-e)/(this.steps*this.stepSize)-this.options.offset||0}})}(),function(){this.Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{},unDraggableTags:["button","input","a","textarea","select","option"]},initialize:function(e,t){this.setOptions(t),this.elements=[],this.lists=[],this.idle=!0,this.addLists($$(document.id(e)||e)),this.options.clone||(this.options.revert=!1),this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each(function(e){this.elements.push(e);var t=e.retrieve("sortables:start",function(t){this.start.call(this,t,e)}.bind(this));(this.options.handle?e.getElement(this.options.handle)||e:e).addEvent("mousedown",t)},this),this},addLists:function(){return Array.flatten(arguments).each(function(e){this.lists.include(e),this.addItems(e.getChildren())},this),this},removeItems:function(){return $$(Array.flatten(arguments).map(function(e){this.elements.erase(e);var t=e.retrieve("sortables:start");return(this.options.handle?e.getElement(this.options.handle)||e:e).removeEvent("mousedown",t),e},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(e){return this.lists.erase(e),this.removeItems(e.getChildren()),e},this))},getDroppableCoordinates:function(e){var t=e.getOffsetParent(),i=e.getPosition(t),s={w:window.getScroll(),offsetParent:t.getScroll()};return i.x+=s.offsetParent.x,i.y+=s.offsetParent.y,"fixed"==t.getStyle("position")&&(i.x-=s.w.x,i.y-=s.w.y),i},getClone:function(e,t){if(!this.options.clone)return new Element(t.tagName).inject(document.body);if("function"==typeOf(this.options.clone))return this.options.clone.call(this,e,t,this.list);var i=t.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:t.getStyle("width")}).addEvent("mousedown",function(e){t.fireEvent("mousedown",e)});return i.get("html").test("radio")&&i.getElements("input[type=radio]").each(function(e,i){e.set("name","clone_"+i),e.get("checked")&&t.getElements("input[type=radio]")[i].set("checked",!0)}),i.inject(this.list).setPosition(this.getDroppableCoordinates(this.element))},getDroppables:function(){var e=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||e.append(this.lists).erase(this.list),e},insert:function(e,t){var i="inside";this.lists.contains(t)?(this.list=t,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(t)?"before":"after",this.element.inject(t,i),this.fireEvent("sort",[this.element,this.clone])},start:function(e,t){!this.idle||e.rightClick||!this.options.handle&&this.options.unDraggableTags.contains(e.target.get("tag"))||(this.idle=!1,this.element=t,this.opacity=t.getStyle("opacity"),this.list=t.getParent(),this.clone=this.getClone(e,t),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){e.stop(),this.clone.setStyle("visibility","visible"),this.element.setStyle("opacity",this.options.opacity||0),this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(e))},end:function(){this.drag.detach(),this.element.setStyle("opacity",this.opacity);var e=this;if(this.effect){var t=this.element.getStyles("width","height"),i=this.clone,s=i.computePosition(this.getDroppableCoordinates(i)),n=function(){this.removeEvent("cancel",n),i.destroy(),e.reset()};this.effect.element=i,this.effect.start({top:s.top,left:s.left,width:t.width,height:t.height,opacity:.25}).addEvent("cancel",n).chain(n)}else this.clone.destroy(),e.reset()},reset:function(){this.idle=!0,this.fireEvent("complete",this.element)},serialize:function(){var e=Array.link(arguments,{modifier:Type.isFunction,index:function(e){return null!=e}}),t=this.lists.map(function(t){return t.getChildren().map(e.modifier||function(e){return e.get("id")},this)},this),i=e.index;return 1==this.lists.length&&(i=0),(i||0===i)&&i>=0&&i<this.lists.length?t[i]:t}})}(),function(){for(var e={relay:!1},t=["once","throttle","pause"],i=t.length;i--;)e[t[i]]=Events.lookupPseudo(t[i]);DOMEvent.definePseudo=function(t,i){return e[t]=i,this};var s=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(e,s.addEvent,s.removeEvent))}(),function(){var e="$moo:keys-pressed",t="$moo:keys-keyup";DOMEvent.definePseudo("keys",function(i,s,n){var o=n[0],a=[],r=this.retrieve(e,[]),l=i.value;if("+"!=l?a.append(l.replace("++",function(){return a.push("+"),""}).split("+")):a=["+"],r.include(o.key),a.every(function(e){return r.contains(e)})&&s.apply(this,n),this.store(e,r),!this.retrieve(t)){var h=function(t){(function(){r=this.retrieve(e,[]).erase(t.key),this.store(e,r)}).delay(0,this)};this.store(t,h).addEvent("keyup",h)}}),DOMEvent.defineKeys({16:"shift",17:"control",18:"alt",20:"capslock",33:"pageup",34:"pagedown",35:"end",36:"home",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",107:"+",109:"-",189:"-"})}(),function(){var e={a:/[]/g,A:/[]/g,c:/[]/g,C:/[]/g,d:/[]/g,D:/[]/g,e:/[]/g,E:/[]/g,g:/[]/g,G:/[]/g,i:/[]/g,I:/[]/g,l:/[]/g,L:/[]/g,n:/[]/g,N:/[]/g,o:/[]/g,O:/[]/g,r:/[]/g,R:/[]/g,s:/[]/g,S:/[]/g,t:/[]/g,T:/[]/g,u:/[]/g,U:/[]/g,y:/[]/g,Y:/[]/g,z:/[]/g,Z:/[]/g,th:/[]/g,TH:/[]/g,dh:/[]/g,DH:/[]/g,ss:/[]/g,oe:/[]/g,OE:/[]/g,ae:/[]/g,AE:/[]/g},t={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g},i={ms:1,s:1e3,m:6e4,h:36e5},s=/(\d*.?\d+)([msh]+)/,n=function(e,t){var i,s=e;for(i in t)s=s.replace(t[i],i);return s},o=function(e,t){e=e||(t?"":"\\w+");var i=t?"<"+e+"(?!\\w)[^>]*>([\\s\\S]*?)</"+e+"(?!\\w)>":"</?"+e+"/?>|<"+e+"[\\s|/][^>]*>";return new RegExp(i,"gi")};String.implement({standardize:function(){return n(this,e)},repeat:function(e){return new Array(e+1).join(this)},pad:function(e,t,i){if(this.length>=e)return this;var s=(null==t?" ":""+t).repeat(e-this.length).substr(0,e-this.length);return i&&"right"!=i?"left"==i?s+this:s.substr(0,(s.length/2).floor())+this+s.substr(0,(s.length/2).ceil()):this+s},getTags:function(e,t){return this.match(o(e,t))||[]},stripTags:function(e,t){return this.replace(o(e,t),"")},tidy:function(){return n(this,t)},truncate:function(e,t,i){var s=this;if(null==t&&1==arguments.length&&(t=""),s.length>e){if(s=s.substring(0,e),i){var n=s.lastIndexOf(i);-1!=n&&(s=s.substr(0,n))}t&&(s+=t)}return s},ms:function(){var e=s.exec(this);return null==e?Number(this):Number(e[1])*i[e[2]]}})}(),Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(e,t){return this.get("value").substring(e,t)},getSelectedText:function(){return this.setSelectionRange?this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd()):document.selection.createRange().text},getSelectedRange:function(){if(null!=this.selectionStart)return{start:this.selectionStart,end:this.selectionEnd};var e={start:0,end:0},t=this.getDocument().selection.createRange();if(!t||t.parentElement()!=this)return e;var i=t.duplicate();if("text"==this.type)e.start=0-i.moveStart("character",-1e5),e.end=e.start+t.text.length;else{var s=this.get("value"),n=s.length;i.moveToElementText(this),i.setEndPoint("StartToEnd",t),i.text.length&&(n-=s.match(/[\n\r]*$/)[0].length),e.end=n-i.text.length,i.setEndPoint("StartToStart",t),e.start=n-i.text.length}return e},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(e){return"end"==e&&(e=this.get("value").length),this.selectRange(e,e),this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(e,t){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else{var i=this.get("value"),s=i.substr(e,t-e).replace(/\r/g,"").length;e=i.substr(0,e).replace(/\r/g,"").length;var n=this.createTextRange();n.collapse(!0),n.moveEnd("character",e+s),n.moveStart("character",e),n.select()}return this},insertAtCursor:function(e,t){var i=this.getSelectedRange(),s=this.get("value");return this.set("value",s.substring(0,i.start)+e+s.substring(i.end,s.length)),!1!==t?this.selectRange(i.start,i.start+e.length):this.setCaretPosition(i.start+e.length),this},insertAroundCursor:function(e,t){e=Object.append({before:"",defaultMiddle:"",after:""},e);var i=this.getSelectedText()||e.defaultMiddle,s=this.getSelectedRange(),n=this.get("value");if(s.start==s.end)this.set("value",n.substring(0,s.start)+e.before+i+e.after+n.substring(s.end,n.length)),this.selectRange(s.start+e.before.length,s.end+e.before.length+i.length);else{var o=n.substring(s.start,s.end);this.set("value",n.substring(0,s.start)+e.before+o+e.after+n.substring(s.end,n.length));var a=s.start+e.before.length;!1!==t?this.selectRange(a,a+o.length):this.setCaretPosition(a+n.length)}return this}}),function(){var e=!1,t=!1,i=function(){var i=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);e=0===i.offsetTop,i.dispose(),t=!0};Element.implement({pin:function(s,n){if(t||i(),"none"==this.getStyle("display"))return this;var o,a,r,l=window.getScroll();if(!1!==s){if(o=this.getPosition(),!this.retrieve("pin:_pinned")){var h={top:o.y-l.y,left:o.x-l.x,margin:"0px",padding:"0px"};if(e&&!n)this.setStyle("position","fixed").setStyles(h);else{a=this.getOffsetParent();var u=this.getPosition(a),c=this.getStyles("left","top");(a&&"auto"==c.left||"auto"==c.top)&&this.setPosition(u),"static"==this.getStyle("position")&&this.setStyle("position","absolute"),u={x:c.left.toInt()-l.x,y:c.top.toInt()-l.y},r=function(){if(this.retrieve("pin:_pinned")){var e=window.getScroll();this.setStyles({left:u.x+e.x,top:u.y+e.y})}}.bind(this),this.store("pin:_scrollFixer",r),window.addEvent("scroll",r)}this.store("pin:_pinned",!0)}}else{if(!this.retrieve("pin:_pinned"))return this;a=this.getParent(),"static"!=a.getComputedStyle("position")||a.getOffsetParent(),o=this.getPosition(),this.store("pin:_pinned",!1),r=this.retrieve("pin:_scrollFixer"),r?(this.store("pin:_scrollFixer",null),window.removeEvent("scroll",r)):this.setStyles({position:"absolute",top:o.y+l.y,left:o.x+l.x}),this.removeClass("isPinned")}return this},unpin:function(){return this.pin(!1)},togglePin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})}(),function(e){var t=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(e,i){return i=Object.merge({},t.options,i),t.setPositionOption(i),t.setEdgeOption(i),t.setOffsetOption(e,i),t.setDimensionsOption(e,i),i},setPositionOption:function(e){e.position=t.getCoordinateFromValue(e.position)},setEdgeOption:function(e){var i=t.getCoordinateFromValue(e.edge);e.edge=i||("center"==e.position.x&&"center"==e.position.y?{x:"center",y:"center"}:{x:"left",y:"top"})},setOffsetOption:function(e,t){var i={x:0,y:0},s={x:0,y:0},n=e.measure(function(){return document.id(this.getOffsetParent())});n&&n!=e.getDocument().body&&(s=n.getScroll(),i=n.measure(function(){var e=this.getPosition();if("fixed"==this.getStyle("position")){var t=window.getScroll();e.x+=t.x,e.y+=t.y}return e}),t.offset={parentPositioned:n!=document.id(t.relativeTo),x:t.offset.x-i.x+s.x,y:t.offset.y-i.y+s.y})},setDimensionsOption:function(e,t){t.dimensions=e.getDimensions({computeSize:!0,styles:["padding","border","margin"]})},getPosition:function(e,i){var s={};i=t.getOptions(e,i);var n=document.id(i.relativeTo)||document.body;t.setPositionCoordinates(i,s,n),i.edge&&t.toEdge(s,i);var o=i.offset;return s.left=(s.x>=0||o.parentPositioned||i.allowNegative?s.x:0).toInt(),s.top=(s.y>=0||o.parentPositioned||i.allowNegative?s.y:0).toInt(),t.toMinMax(s,i),(i.relFixedPosition||"fixed"==n.getStyle("position"))&&t.toRelFixedPosition(n,s),i.ignoreScroll&&t.toIgnoreScroll(n,s),i.ignoreMargins&&t.toIgnoreMargins(s,i),s.left=Math.ceil(s.left),s.top=Math.ceil(s.top),delete s.x,delete s.y,s},setPositionCoordinates:function(e,t,i){var s=e.offset.y,n=e.offset.x,o=i==document.body?window.getScroll():i.getPosition(),a=o.y,r=o.x,l=window.getSize();switch(e.position.x){case"left":t.x=r+n;break;case"right":t.x=r+n+i.offsetWidth;break;default:t.x=r+(i==document.body?l.x:i.offsetWidth)/2+n}switch(e.position.y){case"top":t.y=a+s;break;case"bottom":t.y=a+s+i.offsetHeight;break;default:t.y=a+(i==document.body?l.y:i.offsetHeight)/2+s}},toMinMax:function(e,t){var i,s={left:"x",top:"y"};["minimum","maximum"].each(function(n){["left","top"].each(function(o){null!=(i=t[n]?t[n][s[o]]:null)&&("minimum"==n?e[o]<i:e[o]>i)&&(e[o]=i)})})},toRelFixedPosition:function(e,t){var i=window.getScroll();t.top+=i.y,t.left+=i.x},toIgnoreScroll:function(e,t){var i=e.getScroll();t.top-=i.y,t.left-=i.x},toIgnoreMargins:function(e,t){e.left+="right"==t.edge.x?t.dimensions["margin-right"]:"center"!=t.edge.x?-t.dimensions["margin-left"]:-t.dimensions["margin-left"]+(t.dimensions["margin-right"]+t.dimensions["margin-left"])/2,e.top+="bottom"==t.edge.y?t.dimensions["margin-bottom"]:"center"!=t.edge.y?-t.dimensions["margin-top"]:-t.dimensions["margin-top"]+(t.dimensions["margin-bottom"]+t.dimensions["margin-top"])/2},toEdge:function(e,t){var i={},s=t.dimensions,n=t.edge;switch(n.x){case"left":i.x=0;break;case"right":i.x=-s.x-s.computedRight-s.computedLeft;break;default:i.x=-Math.round(s.totalWidth/2)}switch(n.y){case"top":i.y=0;break;case"bottom":i.y=-s.y-s.computedTop-s.computedBottom;break;default:i.y=-Math.round(s.totalHeight/2)}e.x+=i.x,e.y+=i.y},getCoordinateFromValue:function(e){return"string"!=typeOf(e)?e:(e=e.toLowerCase(),{x:e.test("left")?"left":e.test("right")?"right":"center",y:e.test(/upper|top/)?"top":e.test("bottom")?"bottom":"center"})}};Element.implement({position:function(t){if(t&&(null!=t.x||null!=t.y))return e?e.apply(this,arguments):this;var i=this.setStyle("position","absolute").calculatePosition(t);return t&&t.returnPos?i:this.setStyles(i)},calculatePosition:function(e){return t.getPosition(this,e)}})}(Element.prototype.position),Elements.from=function(e,t){(t||null==t)&&(e=e.stripScripts());var i,s=e.match(/^\s*(?:<!--.*?-->\s*)*<(t[dhr]|tbody|tfoot|thead)/i);if(s){i=new Element("table");var n=s[1].toLowerCase();["td","th","tr"].contains(n)&&(i=new Element("tbody").inject(i),"tr"!=n&&(i=new Element("tr").inject(i)))}
return(i||new Element("div")).set("html",e).getChildren()},function(){var e=this.IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:!1,zIndex:null,margin:0,offset:{x:0,y:0},browsers:!1},property:"IframeShim",initialize:function(e,t){return this.element=document.id(e),this.occlude()?this.occluded:(this.setOptions(t),this.makeShim(),this)},makeShim:function(){if(this.options.browsers){var t=this.element.getStyle("zIndex").toInt();if(!t){t=1;var i=this.element.getStyle("position");"static"!=i&&i||this.element.setStyle("position","relative"),this.element.setStyle("zIndex",t)}t=(null!=this.options.zIndex||0===this.options.zIndex)&&t>this.options.zIndex?this.options.zIndex:t-1,0>t&&(t=1),this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:t,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},class:this.options.className}).store("IframeShim",this);var s=function(){this.shim.inject(this.element,"after"),this[this.options.display?"show":"hide"](),this.fireEvent("inject")}.bind(this);e.ready?s():window.addEvent("load",s)}else this.position=this.hide=this.show=this.dispose=Function.convert(this)},position:function(){if(!e.ready||!this.shim)return this;var t=this.element.measure(function(){return this.getSize()});return void 0!=this.options.margin&&(t.x=t.x-2*this.options.margin,t.y=t.y-2*this.options.margin,this.options.offset.x+=this.options.margin,this.options.offset.y+=this.options.margin),this.shim.set({width:t.x,height:t.y}).position({relativeTo:this.element,offset:this.options.offset}),this},hide:function(){return this.shim&&this.shim.setStyle("display","none"),this},show:function(){return this.shim&&this.shim.setStyle("display","block"),this.position()},dispose:function(){return this.shim&&this.shim.dispose(),this},destroy:function(){return this.shim&&this.shim.destroy(),this}})}(),window.addEvent("load",function(){IframeShim.ready=!0}),function(){this.Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},class:"mask",maskMargins:!1,useIframeShim:!0,iframeShimOptions:{}},initialize:function(e,t){this.target=document.id(e)||document.id(document.body),this.target.store("mask",this),this.setOptions(t),this.render(),this.inject()},render:function(){this.element=new Element("div",{class:this.options.class,id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(e){this.fireEvent("click",e),this.options.hideOnClick&&this.hide()}.bind(this)}}),this.hidden=!0},toElement:function(){return this.element},inject:function(e,t){t=t||(this.options.inject?this.options.inject.where:"")||(this.target==document.body?"inside":"after"),e=e||this.options.inject&&this.options.inject.target||this.target,this.element.inject(e,t),this.options.useIframeShim&&(this.shim=new IframeShim(this.element,this.options.iframeShimOptions),this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)}))},position:function(){return this.resize(this.options.width,this.options.height),this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body}),this},resize:function(e,t){var i={styles:["padding","border"]};this.options.maskMargins&&i.styles.push("margin");var s=this.target.getComputedSize(i);if(this.target==document.body){this.element.setStyles({width:0,height:0});var n=window.getScrollSize();s.totalHeight<n.y&&(s.totalHeight=n.y),s.totalWidth<n.x&&(s.totalWidth=n.x)}return this.element.setStyles({width:Array.pick([e,s.totalWidth,s.x]),height:Array.pick([t,s.totalHeight,s.y])}),this},show:function(){return this.hidden?(window.addEvent("resize",this.position),this.position(),this.showMask.apply(this,arguments),this):this},showMask:function(){this.element.setStyle("display","block"),this.hidden=!1,this.fireEvent("show")},hide:function(){return this.hidden?this:(window.removeEvent("resize",this.position),this.hideMask.apply(this,arguments),this.options.destroyOnHide?this.destroy():this)},hideMask:function(){this.element.setStyle("display","none"),this.hidden=!0,this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide(),this.element.destroy(),this.fireEvent("destroy"),this.target.eliminate("mask")}})}(),Element.Properties.mask={set:function(e){var t=this.retrieve("mask");return t&&t.destroy(),this.eliminate("mask").store("mask:options",e)},get:function(){var e=this.retrieve("mask");return e||(e=new Mask(this,this.retrieve("mask:options")),this.store("mask",e)),e}},Element.implement({mask:function(e){return e&&this.set("mask",e),this.get("mask").show(),this},unmask:function(){return this.get("mask").hide(),this}}),function(){this.Spinner=new Class({Extends:this.Mask,Implements:Chain,options:{class:"spinner",containerPosition:{},content:{class:"spinner-content"},messageContainer:{class:"spinner-msg"},img:{class:"spinner-img"},fxOptions:{link:"chain"}},initialize:function(e,t){this.target=document.id(e)||document.id(document.body),this.target.store("spinner",this),this.setOptions(t),this.render(),this.inject();var i=function(){this.active=!1}.bind(this);this.addEvents({hide:i,show:i})},render:function(){this.parent(),this.element.set("id",this.options.id||"spinner-"+String.uniqueID()),this.content=document.id(this.options.content)||new Element("div",this.options.content),this.content.inject(this.element),this.options.message&&(this.msg=document.id(this.options.message)||new Element("p",this.options.messageContainer).appendText(this.options.message),this.msg.inject(this.content)),this.options.img&&(this.img=document.id(this.options.img)||new Element("div",this.options.img),this.img.inject(this.content)),this.element.set("tween",this.options.fxOptions)},show:function(e){return this.active?this.chain(this.show.bind(this)):this.hidden?(this.target.set("aria-busy","true"),this.active=!0,this.parent(e)):(this.callChain.delay(20,this),this)},showMask:function(e){var t=function(){this.content.position(Object.merge({relativeTo:this.element},this.options.containerPosition))}.bind(this);e?(this.parent(),t()):(this.options.style.opacity||(this.options.style.opacity=this.element.getStyle("opacity").toFloat()),this.element.setStyles({display:"block",opacity:0}).tween("opacity",this.options.style.opacity),t(),this.hidden=!1,this.fireEvent("show"),this.callChain())},hide:function(e){return this.active?this.chain(this.hide.bind(this)):this.hidden?(this.callChain.delay(20,this),this):(this.target.set("aria-busy","false"),this.active=!0,this.parent(e))},hideMask:function(e){return e?this.parent():void this.element.tween("opacity",0).get("tween").chain(function(){this.element.setStyle("display","none"),this.hidden=!0,this.fireEvent("hide"),this.callChain()}.bind(this))},destroy:function(){this.content.destroy(),this.parent(),this.target.eliminate("spinner")}})}(),Request=Class.refactor(Request,{options:{useSpinner:!1,spinnerOptions:{},spinnerTarget:!1},initialize:function(e){this._send=this.send,this.send=function(e){var t=this.getSpinner();return t?t.chain(this._send.pass(e,this)).show():this._send(e),this},this.previous(e)},getSpinner:function(){if(!this.spinner){var e=document.id(this.options.spinnerTarget)||document.id(this.options.update);if(this.options.useSpinner&&e){e.set("spinner",this.options.spinnerOptions);var t=this.spinner=e.get("spinner");["complete","exception","cancel"].each(function(e){this.addEvent(e,t.hide.bind(t))},this)}}return this.spinner}}),Element.Properties.spinner={set:function(e){var t=this.retrieve("spinner");return t&&t.destroy(),this.eliminate("spinner").store("spinner:options",e)},get:function(){var e=this.retrieve("spinner");return e||(e=new Spinner(this,this.retrieve("spinner:options")),this.store("spinner",e)),e}},Element.implement({spin:function(e){return e&&this.set("spinner",e),this.get("spinner").show(),this},unspin:function(){return this.get("spinner").hide(),this}}),function(){var e=function(e){return decodeURIComponent(e.replace(/\+/g," "))};String.implement({parseQueryString:function(t,i){null==t&&(t=!0),null==i&&(i=!0);var s=this.split(/[&;]/),n={};return s.length?(s.each(function(s){var o=s.indexOf("=")+1,a=o?s.substr(o):"",r=o?s.substr(0,o-1).match(/([^\]\[]+|(\B)(?=\]))/g):[s],l=n;r&&(i&&(a=e(a)),r.each(function(i,s){t&&(i=e(i));var n=l[i];s<r.length-1?l=l[i]=n||{}:"array"==typeOf(n)?n.push(a):l[i]=null!=n?[n,a]:a}))}),n):n},cleanQueryString:function(e){return this.split("&").filter(function(t){var i=t.indexOf("="),s=0>i?"":t.substr(0,i),n=t.substr(i+1);return e?e.call(null,s,n):n||0===n}).join("&")}})}(),window.Form||(window.Form={}),function(){Form.Request=new Class({Binds:["onSubmit","onFormValidate"],Implements:[Options,Events,Class.Occlude],options:{requestOptions:{evalScripts:!0,useSpinner:!0,emulation:!1,link:"ignore"},sendButtonClicked:!0,extraData:{},resetForm:!0},property:"form.request",initialize:function(e,t,i){return this.element=document.id(e),this.occlude()?this.occluded:void this.setOptions(i).setTarget(t).attach()},setTarget:function(e){return this.target=document.id(e),this.request?this.request.setOptions({update:this.target}):this.makeRequest(),this},toElement:function(){return this.element},makeRequest:function(){var e=this;return this.request=new Request.HTML(Object.merge({update:this.target,emulation:!1,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(t,i,s,n){["complete","success"].each(function(o){e.fireEvent(o,[e.target,t,i,s,n])})},failure:function(){e.fireEvent("complete",arguments).fireEvent("failure",arguments)},exception:function(){e.fireEvent("failure",arguments)}}),this.attachReset()},attachReset:function(){return this.options.resetForm?(this.request.addEvent("success",function(){Function.attempt(function(){this.element.reset()}.bind(this)),window.OverText&&OverText.update()}.bind(this)),this):this},attach:function(e){var t=0!=e?"addEvent":"removeEvent";this.element[t]("click:relay(button, input[type=submit])",this.saveClickedButton.bind(this));var i=this.element.retrieve("validator");return i?i[t]("onFormValidate",this.onFormValidate):this.element[t]("submit",this.onSubmit),this},detach:function(){return this.attach(!1)},enable:function(){return this.attach()},disable:function(){return this.detach()},onFormValidate:function(e,t,i){if(i){var s=this.element.retrieve("validator");(e||s&&!s.options.stopOnFailure)&&(i.stop(),this.send())}},onSubmit:function(e){var t=this.element.retrieve("validator");return t?(this.element.removeEvent("submit",this.onSubmit),t.addEvent("onFormValidate",this.onFormValidate),void t.validate(e)):(e&&e.stop(),void this.send())},saveClickedButton:function(e,t){var i=t.get("name");i&&this.options.sendButtonClicked&&(this.options.extraData[i]=t.get("value")||!0,this.clickedCleaner=function(){delete this.options.extraData[i],this.clickedCleaner=function(){}}.bind(this))},clickedCleaner:function(){},send:function(){var e=this.element.toQueryString().trim(),t=Object.toQueryString(this.options.extraData);return e?e+="&"+t:e=t,this.fireEvent("send",[this.element,e.parseQueryString()]),this.request.send({data:e,url:this.options.requestOptions.url||this.element.get("action")}),this.clickedCleaner(),this}}),Element.implement("formUpdate",function(e,t){var i=this.retrieve("form.request");return i?(e&&i.setTarget(e),t&&i.setOptions(t).makeRequest()):i=new Form.Request(this,e,t),i.send(),this})}(),Element.implement({isDisplayed:function(){return"none"!=this.getStyle("display")},isVisible:function(){var e=this.offsetWidth,t=this.offsetHeight;return(0!=e||0!=t)&&(e>0&&t>0||"none"!=this.style.display)},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var e;try{e=this.getStyle("display")}catch(e){}return"none"==e?this:this.store("element:_originalDisplay",e||"").setStyle("display","none")},show:function(e){return!e&&this.isDisplayed()?this:(e=e||this.retrieve("element:_originalDisplay")||"block",this.setStyle("display","none"==e?"block":e))},swapClass:function(e,t){return this.removeClass(e).addClass(t)}}),Document.implement({clearSelection:function(){if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}}}),function(){var e=function(e){var t=e.options.hideInputs;if(window.OverText){var i=[null];OverText.each(function(e){i.include("."+e.options.labelClass)}),i&&(t+=i.join(", "))}return t?e.element.getElements(t):null};Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:"opacity"in document.documentElement,mode:"vertical",display:function(){return"tr"!=this.element.get("tag")?"block":"table-row"},opacity:1,hideInputs:"opacity"in document.documentElement?null:"select, input, textarea, object, embed"},dissolve:function(){if(this.hiding||this.showing)"chain"==this.options.link?this.chain(this.dissolve.bind(this)):"cancel"!=this.options.link||this.hiding||(this.cancel(),this.dissolve());else if("none"!=this.element.getStyle("display")){this.hiding=!0,this.showing=!1,this.hidden=!0,this.cssText=this.element.style.cssText;var t=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});this.options.transitionOpacity&&(t.opacity=this.options.opacity);var i={};Object.each(t,function(e,t){i[t]=[e,0]}),this.element.setStyles({display:Function.convert(this.options.display).call(this),overflow:"hidden"});var s=e(this);s&&s.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.hidden&&(this.hiding=!1,this.element.style.cssText=this.cssText,this.element.setStyle("display","none"),s&&s.setStyle("visibility","visible")),this.fireEvent("hide",this.element),this.callChain()}.bind(this)),this.start(i)}else this.callChain.delay(10,this),this.fireEvent("complete",this.element),this.fireEvent("hide",this.element);return this},reveal:function(){if(this.showing||this.hiding)"chain"==this.options.link?this.chain(this.reveal.bind(this)):"cancel"!=this.options.link||this.showing||(this.cancel(),this.reveal());else if("none"==this.element.getStyle("display")){this.hiding=!1,this.showing=!0,this.hidden=!1,this.cssText=this.element.style.cssText;var t;this.element.measure(function(){t=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode})}.bind(this)),null!=this.options.heightOverride&&(t.height=this.options.heightOverride.toInt()),null!=this.options.widthOverride&&(t.width=this.options.widthOverride.toInt()),this.options.transitionOpacity&&(this.element.setStyle("opacity",0),t.opacity=this.options.opacity);var i={height:0,display:Function.convert(this.options.display).call(this)};Object.each(t,function(e,t){i[t]=0}),i.overflow="hidden",this.element.setStyles(i);var s=e(this);s&&s.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.element.style.cssText=this.cssText,this.element.setStyle("display",Function.convert(this.options.display).call(this)),this.hidden||(this.showing=!1),s&&s.setStyle("visibility","visible"),this.callChain(),this.fireEvent("show",this.element)}.bind(this)),this.start(t)}else this.callChain(),this.fireEvent("complete",this.element),this.fireEvent("show",this.element);return this},toggle:function(){return"none"==this.element.getStyle("display")?this.reveal():this.dissolve(),this},cancel:function(){return this.parent.apply(this,arguments),null!=this.cssText&&(this.element.style.cssText=this.cssText),this.hiding=!1,this.showing=!1,this}}),Element.Properties.reveal={set:function(e){return this.get("reveal").cancel().setOptions(e),this},get:function(){var e=this.retrieve("reveal");return e||(e=new Fx.Reveal(this),this.store("reveal",e)),e}},Element.Properties.dissolve=Element.Properties.reveal,Element.implement({reveal:function(e){return this.get("reveal").setOptions(e).reveal(),this},dissolve:function(e){return this.get("reveal").setOptions(e).dissolve(),this},nix:function(e){var t=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});return this.get("reveal").setOptions(e).dissolve().chain(function(){this[t.destroy?"destroy":"dispose"]()}.bind(this)),this},wink:function(){var e=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject}),t=this.get("reveal").setOptions(e.options);t.reveal().chain(function(){(function(){t.dissolve()}).delay(e.duration||2e3)})}})}(),Form.Request.Append=new Class({Extends:Form.Request,options:{useReveal:!0,revealOptions:{},inject:"bottom"},makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:!1})).addEvents({success:function(e,t,i,s){var n,o=Elements.from(i);n=1==o.length?o[0]:new Element("div",{styles:{display:"none"}}).adopt(o),n.inject(this.target,this.options.inject),this.options.requestOptions.evalScripts&&Browser.exec(s),this.fireEvent("beforeEffect",n);var a=function(){this.fireEvent("success",[n,this.target,e,t,i,s])}.bind(this);this.options.useReveal?(n.set("reveal",this.options.revealOptions).get("reveal").chain(a),n.reveal()):a()}.bind(this),failure:function(e){this.fireEvent("failure",e)}.bind(this)}),this.attachReset()}}),function(){var e=function(e){return null!=e},t=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(e,i){"string"==typeof i&&(i=i.split("."));for(var s=0,n=i.length;n>s;s++){if(!t.call(e,i[s]))return null;e=e[i[s]]}return e},cleanValues:function(t,i){i=i||e;for(var s in t)i(t[s])||delete t[s];return t},erase:function(e,i){return t.call(e,i)&&delete e[i],e},run:function(e){var t=Array.slice(arguments,1);for(var i in e)e[i].apply&&e[i].apply(e,t);return e}})}(),function(){var e=null,t={},i=function(e){return instanceOf(e,s.Set)?e:t[e]},s=this.Locale={define:function(i,n,o,a){var r;return instanceOf(i,s.Set)?(r=i.name)&&(t[r]=i):(r=i,t[r]||(t[r]=new s.Set(r)),i=t[r]),n&&i.define(n,o,a),e||(e=i),i},use:function(t){return t=i(t),t&&(e=t,this.fireEvent("change",t)),this},getCurrent:function(){return e},get:function(t,i){return e?e.get(t,i):""},inherit:function(e,t,s){return e=i(e),e&&e.inherit(t,s),this},list:function(){return Object.keys(t)}};Object.append(s,new Events),s.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(e){this.name=e||""},define:function(e,t,i){var s=this.sets[e];return s||(s={}),t&&("object"==typeOf(t)?s=Object.merge(s,t):s[t]=i),this.sets[e]=s,this},get:function(e,i,s){var n=Object.getFromPath(this.sets,e);if(null!=n){var o=typeOf(n);return"function"==o?n=n.apply(null,Array.convert(i)):"object"==o&&(n=Object.clone(n)),n}var a=e.indexOf("."),r=0>a?e:e.substr(0,a),l=(this.inherits.sets[r]||[]).combine(this.inherits.locales).include("en-US");s||(s=[]);for(var h=0,u=l.length;u>h;h++)if(!s.contains(l[h])){s.include(l[h]);var c=t[l[h]];if(c&&null!=(n=c.get(e,i,s)))return n}return""},inherit:function(e,t){e=Array.convert(e),t&&!this.inherits.sets[t]&&(this.inherits.sets[t]=[]);for(var i=e.length;i--;)(t?this.inherits.sets[t]:this.inherits.locales).unshift(e[i]);return this}})}(),Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(e){return e>3&&21>e?"th":["th","st","nd","rd","th"][Math.min(e%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"}),function(){var e=this.Date,t=e.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(t){e.Methods[t.toLowerCase()]=t});var i=function(e,t,s){return 1==t?e:e<Math.pow(10,t-1)?(s||"0")+i(e,t-1,s):e};e.implement({set:function(e,i){e=e.toLowerCase();var s=t[e]&&"set"+t[e];return s&&this[s]&&this[s](i),this}.overloadSetter(),get:function(e){e=e.toLowerCase();var i=t[e]&&"get"+t[e];return i&&this[i]?this[i]():null}.overloadGetter(),clone:function(){return new e(this.get("time"))},increment:function(t,i){switch(t=t||"day",i=null!=i?i:1,t){case"year":return this.increment("month",12*i);case"month":var s=this.get("date");return this.set("date",1).set("mo",this.get("mo")+i),this.set("date",s.min(this.get("lastdayofmonth")));case"week":return this.increment("day",7*i);case"day":return this.set("date",this.get("date")+i)}if(!e.units[t])throw new Error(t+" is not a supported interval");return this.set("time",this.get("time")+i*e.units[t]())},decrement:function(e,t){return this.increment(e,-1*(null!=t?t:1))},isLeapYear:function(){return e.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(t,i){return"string"==typeOf(t)&&(t=e.parse(t)),((t-this)/e.units[i||"day"](3,3)).round()},getLastDayOfMonth:function(){return e.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(e.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-e.UTC(this.get("year"),0,1))/e.units.day()},setDay:function(t,i){null==i&&""===(i=e.getMsg("firstDayOfWeek"))&&(i=1),t=(7+e.parseDay(t,!0)-i)%7;var s=(7+this.get("day")-i)%7;return this.increment("day",t-s)},getWeek:function(t){null==t&&""===(t=e.getMsg("firstDayOfWeek"))&&(t=1);var i,s=this,n=(7+s.get("day")-t)%7,o=0;if(1==t){var a=s.get("month"),r=s.get("date")-n;if(11==a&&r>28)return 1;0==a&&-2>r&&(s=new e(s).decrement("day",n),n=0),(i=new e(s.get("year"),0,1).get("day")||7)>4&&(o=-7)}else i=new e(s.get("year"),0,1).get("day");return o+=s.get("dayofyear"),o+=6-n,(o+=(7+i-t)%7)/7},getOrdinal:function(t){return e.getMsg("ordinal",t||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var e=this.get("timezoneOffset");return(e>0?"-":"+")+i((e.abs()/60).floor(),2)+i(e%60,2)},setAMPM:function(e){e=e.toUpperCase();var t=this.get("hr");return t>11&&"AM"==e?this.decrement("hour",12):12>t&&"PM"==e?this.increment("hour",12):this},getAMPM:function(){return this.get("hr")<12?"AM":"PM"},parse:function(t){return this.set("time",e.parse(t)),this},isValid:function(e){return e||(e=this),"date"==typeOf(e)&&!isNaN(e.valueOf())},format:function(t){if(!this.isValid())return"invalid date";if(t||(t="%x %X"),"string"==typeof t&&(t=o[t.toLowerCase()]||t),"function"==typeof t)return t(this);var s=this;return t.replace(/%([a-z%])/gi,function(t,n){switch(n){case"a":return e.getMsg("days_abbr")[s.get("day")];case"A":return e.getMsg("days")[s.get("day")];case"b":return e.getMsg("months_abbr")[s.get("month")];case"B":return e.getMsg("months")[s.get("month")];case"c":return s.format("%a %b %d %H:%M:%S %Y");case"d":return i(s.get("date"),2);case"e":return i(s.get("date"),2," ");case"H":return i(s.get("hr"),2);case"I":return i(s.get("hr")%12||12,2);case"j":return i(s.get("dayofyear"),3);case"k":return i(s.get("hr"),2," ");case"l":return i(s.get("hr")%12||12,2," ");case"L":return i(s.get("ms"),3);case"m":return i(s.get("mo")+1,2);case"M":return i(s.get("min"),2);case"o":return s.get("ordinal");case"p":return e.getMsg(s.get("ampm"));case"s":return Math.round(s/1e3);case"S":return i(s.get("seconds"),2);case"T":return s.format("%H:%M:%S");case"U":return i(s.get("week"),2);case"w":return s.get("day");case"x":return s.format(e.getMsg("shortDate"));case"X":return s.format(e.getMsg("shortTime"));case"y":return s.get("year").toString().substr(2);case"Y":return s.get("year");case"z":return s.get("GMTOffset");case"Z":return s.get("Timezone")}return n})},toISOString:function(){return this.format("iso8601")}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});var s=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],n=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",short:"%d %b %H:%M",long:"%B %d, %Y %H:%M",rfc822:function(e){return s[e.get("day")]+e.format(", %d ")+n[e.get("month")]+e.format(" %Y %H:%M:%S %Z")},rfc2822:function(e){return s[e.get("day")]+e.format(", %d ")+n[e.get("month")]+e.format(" %Y %H:%M:%S %z")},iso8601:function(e){return e.getUTCFullYear()+"-"+i(e.getUTCMonth()+1,2)+"-"+i(e.getUTCDate(),2)+"T"+i(e.getUTCHours(),2)+":"+i(e.getUTCMinutes(),2)+":"+i(e.getUTCSeconds(),2)+"."+i(e.getUTCMilliseconds(),3)+"Z"}},a=[],r=e.parse,l=function(t,i,s){var n=-1,o=e.getMsg(t+"s");switch(typeOf(i)){case"object":n=o[i.get(t)];break;case"number":if(!(n=o[i]))throw new Error("Invalid "+t+" index: "+i);break;case"string":var a=o.filter(function(e){return this.test(e)},new RegExp("^"+i,"i"));if(!a.length)throw new Error("Invalid "+t+" string");if(a.length>1)throw new Error("Ambiguous "+t);n=a[0]}return s?o.indexOf(n):n},h=1900,u=70;e.extend({getMsg:function(e,t){return Locale.get("Date."+e,t)},units:{ms:Function.convert(1),second:Function.convert(1e3),minute:Function.convert(6e4),hour:Function.convert(36e5),day:Function.convert(864e5),week:Function.convert(6084e5),month:function(t,i){var s=new e;return 864e5*e.daysInMonth(null!=t?t:s.get("mo"),null!=i?i:s.get("year"))},year:function(t){return t=t||(new e).get("year"),e.isLeapYear(t)?316224e5:31536e6}},daysInMonth:function(t,i){return[31,e.isLeapYear(i)?29:28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},parse:function(t){var i=typeOf(t);if("number"==i)return new e(t);if("string"!=i)return t;if(t=t.clean(),!t.length)return null;var s;return a.some(function(e){var i=e.re.exec(t);return!!i&&(s=e.handler(i))}),s&&s.isValid()||(s=new e(r(t)))&&s.isValid()||(s=new e(t.toInt())),s},parseDay:function(e,t){return l("day",e,t)},parseMonth:function(e,t){return l("month",e,t)},parseUTC:function(t){var i=new e(t),s=e.UTC(i.get("year"),i.get("mo"),i.get("date"),i.get("hr"),i.get("min"),i.get("sec"),i.get("ms"));return new e(s)},orderIndex:function(t){return e.getMsg("dateOrder").indexOf(t)+1},defineFormat:function(e,t){return o[e]=t,this},defineParser:function(e){return a.push(e.re&&e.handler?e:g(e)),this},defineParsers:function(){return Array.flatten(arguments).each(e.defineParser),this},define2DigitYearStart:function(e){return u=e%100,h=e-u,this}}).extend({defineFormats:e.defineFormat.overloadSetter()});var c=function(t){return new RegExp("(?:"+e.getMsg(t).map(function(e){return e.substr(0,3)}).join("|")+")[a-z]*")},d=function(t){switch(t){case"T":return"%H:%M:%S";case"x":return(1==e.orderIndex("month")?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null},p={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};p.m=p.I,p.S=p.M;var m,f=function(e){m=e,p.a=p.A=c("days"),p.b=p.B=c("months"),a.each(function(e,t){e.format&&(a[t]=g(e.format))})},g=function(t){if(!m)return{format:t};var i=[],s=(t.source||t).replace(/%([a-z])/gi,function(e,t){return d(t)||e}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(e,t){var s=p[t];return s?(i.push(t),"("+s.source+")"):t}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:t,re:new RegExp("^"+s+"$","i"),handler:function(t){t=t.slice(1).associate(i);var s=(new e).clearTime(),n=t.y||t.Y;null!=n&&v.call(s,"y",n),"d"in t&&v.call(s,"d",1),("m"in t||t.b||t.B)&&v.call(s,"m",1);for(var o in t)v.call(s,o,t[o]);return s}}},v=function(t,i){if(!i)return this;switch(t){case"a":case"A":return this.set("day",e.parseDay(i,!0));case"b":case"B":return this.set("mo",e.parseMonth(i,!0));case"d":return this.set("date",i);case"H":case"I":return this.set("hr",i);case"m":return this.set("mo",i-1);case"M":return this.set("min",i);case"p":return this.set("ampm",i.replace(/\./g,""));case"S":return this.set("sec",i);case"s":return this.set("ms",1e3*("0."+i));case"w":return this.set("day",i);case"Y":return this.set("year",i);case"y":return i=+i,100>i&&(i+=h+(u>i?100:0)),this.set("year",i);case"z":"Z"==i&&(i="+00");var s=i.match(/([+-])(\d{2}):?(\d{2})?/);return s=(s[1]+"1")*(60*s[2]+(+s[3]||0))+this.getTimezoneOffset(),this.set("time",this-6e4*s)}return this};e.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?"),Locale.addEvent("change",function(e){Locale.get("Date")&&f(e)}).fireEvent("change",Locale.getCurrent())}(),Locale.define("en-US","FormValidator",{required:"This field is required.",length:"Please enter {length} characters (you entered {elLength} characters)",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use only letters (a-z) within this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.example.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currentDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",
creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."}),window.Form||(window.Form={});var InputValidator=this.InputValidator=new Class({Implements:[Options],options:{errorMsg:"Validation failed.",test:Function.convert(!0)},initialize:function(e,t){this.setOptions(t),this.className=e},test:function(e,t){return!!(e=document.id(e))&&this.options.test(e,t||this.getProps(e))},getError:function(e,t){e=document.id(e);var i=this.options.errorMsg;return"function"==typeOf(i)&&(i=i(e,t||this.getProps(e))),i},getProps:function(e){return e=document.id(e),e?e.get("validatorProps"):{}}});if(Element.Properties.validators={get:function(){return(this.get("data-validators")||this.className).clean().replace(/'(\\.|[^'])*'|"(\\.|[^"])*"/g,function(e){return e.replace(" ","\\x20")}).split(" ")}},Element.Properties.validatorProps={set:function(e){return this.eliminate("$moo:validatorProps").store("$moo:validatorProps",e)},get:function(e){if(e&&this.set(e),this.retrieve("$moo:validatorProps"))return this.retrieve("$moo:validatorProps");if(this.getProperty("data-validator-properties")||this.getProperty("validatorProps"))try{this.store("$moo:validatorProps",JSON.decode(this.getProperty("validatorProps")||this.getProperty("data-validator-properties"),!1))}catch(e){return{}}else{var t=this.get("validators").filter(function(e){return e.test(":")});t.length?(e={},t.each(function(t){var i=t.split(":");if(i[1])try{e[i[0]]=JSON.decode(i[1],!1)}catch(e){}}),this.store("$moo:validatorProps",e)):this.store("$moo:validatorProps",{})}return this.retrieve("$moo:validatorProps")}},Form.Validator=new Class({Implements:[Options,Events],options:{fieldSelectors:"input, select, textarea",ignoreHidden:!0,ignoreDisabled:!0,useTitles:!1,evaluateOnSubmit:!0,evaluateFieldsOnBlur:!0,evaluateFieldsOnChange:!0,serial:!0,stopOnFailure:!0,warningPrefix:function(){return Form.Validator.getMsg("warningPrefix")||"Warning: "},errorPrefix:function(){return Form.Validator.getMsg("errorPrefix")||"Error: "}},initialize:function(e,t){this.setOptions(t),this.element=document.id(e),this.warningPrefix=Function.convert(this.options.warningPrefix)(),this.errorPrefix=Function.convert(this.options.errorPrefix)(),this._bound={onSubmit:this.onSubmit.bind(this),blurOrChange:function(e,t){this.validationMonitor(t,!0)}.bind(this)},this.enable()},toElement:function(){return this.element},getFields:function(){return this.fields=this.element.getElements(this.options.fieldSelectors)},enable:function(){this.element.store("validator",this),this.options.evaluateOnSubmit&&this.element.addEvent("submit",this._bound.onSubmit),this.options.evaluateFieldsOnBlur&&this.element.addEvent("blur:relay(input,select,textarea)",this._bound.blurOrChange),this.options.evaluateFieldsOnChange&&this.element.addEvent("change:relay(input,select,textarea)",this._bound.blurOrChange)},disable:function(){this.element.eliminate("validator"),this.element.removeEvents({submit:this._bound.onSubmit,"blur:relay(input,select,textarea)":this._bound.blurOrChange,"change:relay(input,select,textarea)":this._bound.blurOrChange})},validationMonitor:function(){clearTimeout(this.timer),this.timer=this.validateField.delay(50,this,arguments)},onSubmit:function(e){this.validate(e)&&this.reset()},reset:function(){return this.getFields().each(this.resetField,this),this},validate:function(e){var t=this.getFields().map(function(e){return this.validateField(e,!0)},this).every(function(e){return e});return this.fireEvent("formValidate",[t,this.element,e]),this.options.stopOnFailure&&!t&&e&&e.preventDefault(),t},validateField:function(e,t){if(this.paused)return!0;e=document.id(e);var i,s,n=!e.hasClass("validation-failed");if(this.options.serial&&!t&&(i=this.element.getElement(".validation-failed"),s=this.element.getElement(".warning")),e&&(!i||t||e.hasClass("validation-failed")||i&&!this.options.serial)){var o=e.get("validators"),a=o.some(function(e){return this.getValidator(e)},this),r=[];o.each(function(t){t&&!this.test(t,e)&&r.include(t)},this),n=0===r.length,a&&!this.hasValidator(e,"warnOnly")&&(n?(e.addClass("validation-passed").removeClass("validation-failed"),this.fireEvent("elementPass",[e])):(e.addClass("validation-failed").removeClass("validation-passed"),this.fireEvent("elementFail",[e,r]))),s||(o.some(function(e){return e.test("^warn")?this.getValidator(e.replace(/^warn-/,"")):null},this),e.removeClass("warning"),o.map(function(t){return t.test("^warn")?this.test(t.replace(/^warn-/,""),e,!0):null},this))}return n},test:function(e,t,i){if(t=document.id(t),this.options.ignoreHidden&&!t.isVisible()||this.options.ignoreDisabled&&t.get("disabled"))return!0;var s=this.getValidator(e);null!=i&&(i=!1),this.hasValidator(t,"warnOnly")&&(i=!0);var n=t.hasClass("ignoreValidation")||!s||s.test(t);return s&&this.fireEvent("elementValidate",[n,t,e,i]),!!i||n},hasValidator:function(e,t){return e.get("validators").contains(t)},resetField:function(e){return e=document.id(e),e&&e.get("validators").each(function(t){t.test("^warn-")&&(t=t.replace(/^warn-/,"")),e.removeClass("validation-failed"),e.removeClass("warning"),e.removeClass("validation-passed")},this),this},stop:function(){return this.paused=!0,this},start:function(){return this.paused=!1,this},ignoreField:function(e,t){return e=document.id(e),e&&(this.enforceField(e),t?e.addClass("warnOnly"):e.addClass("ignoreValidation")),this},enforceField:function(e){return e=document.id(e),e&&e.removeClass("warnOnly").removeClass("ignoreValidation"),this}}),Form.Validator.getMsg=function(e){return Locale.get("FormValidator."+e)},Form.Validator.adders={validators:{},add:function(e,t){this.validators[e]=new InputValidator(e,t),this.initialize||this.implement({validators:this.validators})},addAllThese:function(e){Array.convert(e).each(function(e){this.add(e[0],e[1])},this)},getValidator:function(e){return this.validators[e.split(":")[0]]}},Object.append(Form.Validator,Form.Validator.adders),Form.Validator.implement(Form.Validator.adders),Form.Validator.add("IsEmpty",{errorMsg:!1,test:function(e){return"select-one"==e.type||"select"==e.type?!(e.selectedIndex>=0&&""!=e.options[e.selectedIndex].value):null==e.get("value")||0==e.get("value").length}}),Form.Validator.addAllThese([["required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(e){return!Form.Validator.getValidator("IsEmpty").test(e)}}],["length",{errorMsg:function(e,t){return"null"!=typeOf(t.length)?Form.Validator.getMsg("length").substitute({length:t.length,elLength:e.get("value").length}):""},test:function(e,t){return"null"==typeOf(t.length)||(e.get("value").length==t.length||0==e.get("value").length)}}],["minLength",{errorMsg:function(e,t){return"null"!=typeOf(t.minLength)?Form.Validator.getMsg("minLength").substitute({minLength:t.minLength,length:e.get("value").length}):""},test:function(e,t){return"null"==typeOf(t.minLength)||e.get("value").length>=(t.minLength||0)}}],["maxLength",{errorMsg:function(e,t){return"null"!=typeOf(t.maxLength)?Form.Validator.getMsg("maxLength").substitute({maxLength:t.maxLength,length:e.get("value").length}):""},test:function(e,t){return e.get("value").length<=(t.maxLength||1e4)}}],["validate-integer",{errorMsg:Form.Validator.getMsg.pass("integer"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(-?[1-9]\d*|0)$/.test(e.get("value"))}}],["validate-numeric",{errorMsg:Form.Validator.getMsg.pass("numeric"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(e.get("value"))}}],["validate-digits",{errorMsg:Form.Validator.getMsg.pass("digits"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^[\d() .:\-\+#]+$/.test(e.get("value"))}}],["validate-alpha",{errorMsg:Form.Validator.getMsg.pass("alpha"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^[a-zA-Z]+$/.test(e.get("value"))}}],["validate-alphanum",{errorMsg:Form.Validator.getMsg.pass("alphanum"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||!/\W/.test(e.get("value"))}}],["validate-date",{errorMsg:function(e,t){if(Date.parse){var i=t.dateFormat||"%x";return Form.Validator.getMsg("dateSuchAs").substitute({date:(new Date).format(i)})}return Form.Validator.getMsg("dateInFormatMDY")},test:function(e,t){if(Form.Validator.getValidator("IsEmpty").test(e))return!0;var i=Locale.get("Date"),s=new RegExp([i.days,i.days_abbr,i.months,i.months_abbr,i.AM,i.PM].flatten().join("|"),"i"),n=e.get("value"),o=n.match(/[a-z]+/gi);if(o&&!o.every(s.exec,s))return!1;var a=Date.parse(n);if(!a)return!1;var r=t.dateFormat||"%x",l=a.format(r);return"invalid date"!=l&&e.set("value",l),a.isValid()}}],["validate-email",{errorMsg:Form.Validator.getMsg.pass("email"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i.test(e.get("value"))}}],["validate-url",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(e.get("value"))}}],["validate-currency-dollar",{errorMsg:Form.Validator.getMsg.pass("currencyDollar"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(e.get("value"))}}],["validate-one-required",{errorMsg:Form.Validator.getMsg.pass("oneRequired"),test:function(e,t){return(document.id(t["validate-one-required"])||e.getParent(t["validate-one-required"])).getElements("input").some(function(e){return["checkbox","radio"].contains(e.get("type"))?e.get("checked"):e.get("value")})}}]]),Element.Properties.validator={set:function(e){this.get("validator").setOptions(e)},get:function(){var e=this.retrieve("validator");return e||(e=new Form.Validator(this),this.store("validator",e)),e}},Element.implement({validate:function(e){return e&&this.set("validator",e),this.get("validator").validate()}}),function(){function e(e,t,i,s){if(t&&e[t])return e[t];var n=document.id(e[i]);return n?n.getElements(s):[]}Form.Validator.addAllThese([["validate-enforce-oncheck",{test:function(t,i){var s=t.getParent("form").retrieve("validator");return!s||(e(i,"toEnforce","enforceChildrenOf","input, select, textarea").each(function(e){t.checked?s.enforceField(e):(s.ignoreField(e),s.resetField(e))}),!0)}}],["validate-ignore-oncheck",{test:function(t,i){var s=t.getParent("form").retrieve("validator");return!s||(e(i,"toIgnore","ignoreChildrenOf","input, select, textarea").each(function(e){t.checked?(s.ignoreField(e),s.resetField(e)):s.enforceField(e)}),!0)}}],["validate-enforce-onselect-value",{test:function(t,i){if(!i.value)return!0;var s=t.getParent("form").retrieve("validator");return!s||(e(i,"toEnforce","enforceChildrenOf","input, select, textarea").each(function(e){i.value==t.value?s.enforceField(e):(s.ignoreField(e),s.resetField(e))}),!0)}}],["validate-nospace",{errorMsg:function(){return Form.Validator.getMsg("noSpace")},test:function(e,t){return!e.get("value").test(/\s/)}}],["validate-toggle-oncheck",{test:function(t,i){var s=t.getParent("form").retrieve("validator");if(!s)return!0;var n=e(i,"toToggle","toToggleChildrenOf","input, select, textarea");return t.checked?n.each(function(e){s.enforceField(e)}):n.each(function(e){s.ignoreField(e),s.resetField(e)}),!0}}],["validate-reqchk-bynode",{errorMsg:function(){return Form.Validator.getMsg("reqChkByNode")},test:function(t,i){return e(i,!1,"nodeId",i.selector||"input[type=checkbox], input[type=radio]").some(function(e){return e.checked})}}],["validate-required-check",{errorMsg:function(e,t){return t.useTitle?e.get("title"):Form.Validator.getMsg("requiredChk")},test:function(e,t){return!!e.checked}}],["validate-reqchk-byname",{errorMsg:function(e,t){return Form.Validator.getMsg("reqChkByName").substitute({label:t.label||e.get("type")})},test:function(e,t){var i=t.groupName||e.get("name"),s=$$("[name="+i+"]"),n=s.some(function(e,t){return e.checked}),o=e.getParent("form").retrieve("validator");return n&&o&&s.each(function(e,t){o.resetField(e)}),n}}],["validate-match",{errorMsg:function(e,t){return Form.Validator.getMsg("match").substitute({matchName:decodeURIComponent((t.matchName+"").replace(/\+/g,"%20"))||document.id(t.matchInput).get("name")})},test:function(e,t){var i=e.get("value"),s=document.id(t.matchInput)&&document.id(t.matchInput).get("value");return!i||!s||i==s}}],["validate-after-date",{errorMsg:function(e,t){return Form.Validator.getMsg("afterDate").substitute({label:t.afterLabel||(t.afterElement?Form.Validator.getMsg("startDate"):Form.Validator.getMsg("currentDate"))})},test:function(e,t){var i=document.id(t.afterElement)?Date.parse(document.id(t.afterElement).get("value")):new Date,s=Date.parse(e.get("value"));return!s||!i||s>=i}}],["validate-before-date",{errorMsg:function(e,t){return Form.Validator.getMsg("beforeDate").substitute({label:t.beforeLabel||(t.beforeElement?Form.Validator.getMsg("endDate"):Form.Validator.getMsg("currentDate"))})},test:function(e,t){var i=Date.parse(e.get("value")),s=document.id(t.beforeElement)?Date.parse(document.id(t.beforeElement).get("value")):new Date;return!s||!i||s>=i}}],["validate-custom-required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(e,t){return e.get("value")!=t.emptyValue}}],["validate-same-month",{errorMsg:function(e,t){var i=document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value");return""!=e.get("value")?Form.Validator.getMsg(i?"sameMonth":"startMonth"):void 0},test:function(e,t){var i=Date.parse(e.get("value")),s=Date.parse(document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value"));return!i||!s||i.format("%B")==s.format("%B")}}],["validate-cc-num",{errorMsg:function(e){var t=e.get("value").replace(/[^0-9]/g,"");return Form.Validator.getMsg("creditcard").substitute({length:t.length})},test:function(e){if(Form.Validator.getValidator("IsEmpty").test(e))return!0;var t=e.get("value");t=t.replace(/[^0-9]/g,"");var i=!1;if(t.test(/^4[0-9]{12}([0-9]{3})?$/)?i="Visa":t.test(/^5[1-5]([0-9]{14})$/)?i="Master Card":t.test(/^3[47][0-9]{13}$/)?i="American Express":t.test(/^6(?:011|5[0-9]{2})[0-9]{12}$/)?i="Discover":t.test(/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/)&&(i="Diners Club"),i){for(var s=0,n=0,o=t.length-1;o>=0;--o)0!=(n=t.charAt(o).toInt())&&((t.length-o)%2==0&&(n+=n),n>9&&(n=n.toString().charAt(0).toInt()+n.toString().charAt(1).toInt()),s+=n);if(s%10==0)return!0}for(var a="";""!=t;)a+=" "+t.substr(0,4),t=t.substr(4);return e.getParent("form").retrieve("validator").ignoreField(e),e.set("value",a.clean()),e.getParent("form").retrieve("validator").enforceField(e),!1}}]])}(),Form.Validator.Inline=new Class({Extends:Form.Validator,options:{showError:function(e){e.reveal?e.reveal():e.setStyle("display","block")},hideError:function(e){e.dissolve?e.dissolve():e.setStyle("display","none")},scrollToErrorsOnSubmit:!0,scrollToErrorsOnBlur:!1,scrollToErrorsOnChange:!1,scrollFxOptions:{transition:"quad:out",offset:{y:-20}}},initialize:function(e,t){this.parent(e,t),this.addEvent("onElementValidate",function(e,t,i,s){var n=this.getValidator(i);if(!e&&n.getError(t)){s&&t.addClass("warning");var o=this.makeAdvice(i,t,n.getError(t),s);this.insertAdvice(o,t),this.showAdvice(i,t)}else this.hideAdvice(i,t)})},makeAdvice:function(e,t,i,s){var n=s?this.warningPrefix:this.errorPrefix;n+=this.options.useTitles?t.title||i:i;var o=s?"warning-advice":"validation-advice",a=this.getAdvice(e,t);return a=a?a.set("html",n):new Element("div",{html:n,styles:{display:"none"},id:"advice-"+e.split(":")[0]+"-"+this.getFieldId(t)}).addClass(o),t.store("$moo:advice-"+e,a),a},getFieldId:function(e){return e.id?e.id:e.id="input_"+e.name},showAdvice:function(e,t){var i=this.getAdvice(e,t);!i||t.retrieve("$moo:"+this.getPropName(e))||"none"!=i.getStyle("display")&&"hidden"!=i.getStyle("visibility")&&0!=i.getStyle("opacity")||(t.store("$moo:"+this.getPropName(e),!0),this.options.showError(i),this.fireEvent("showAdvice",[t,i,e]))},hideAdvice:function(e,t){var i=this.getAdvice(e,t);i&&t.retrieve("$moo:"+this.getPropName(e))&&(t.store("$moo:"+this.getPropName(e),!1),this.options.hideError(i),this.fireEvent("hideAdvice",[t,i,e]))},getPropName:function(e){return"advice"+e},resetField:function(e){return(e=document.id(e))?(this.parent(e),e.get("validators").each(function(t){this.hideAdvice(t,e)},this),this):this},getAllAdviceMessages:function(e,t){var i=[];return e.hasClass("ignoreValidation")&&!t?i:(e.get("validators").some(function(t){var s=t.test("^warn-")||e.hasClass("warnOnly");s&&(t=t.replace(/^warn-/,""));var n=this.getValidator(t);n&&i.push({message:n.getError(e),warnOnly:s,passed:n.test(),validator:n})},this),i)},getAdvice:function(e,t){return t.retrieve("$moo:advice-"+e)},insertAdvice:function(e,t){var i=t.get("validatorProps");i.msgPos&&document.id(i.msgPos)?document.id(i.msgPos).grab(e):t.type&&"radio"==t.type.toLowerCase()?t.getParent().adopt(e):e.inject(document.id(t),"after")},validateField:function(e,t,i){var s=this.parent(e,t);if((this.options.scrollToErrorsOnSubmit&&null==i||i)&&!s){for(var n=document.id(this).getElement(".validation-failed"),o=document.id(this).getParent();o!=document.body&&o.getScrollSize().y==o.getSize().y;)o=o.getParent();var a=o.retrieve("$moo:fvScroller");!a&&window.Fx&&Fx.Scroll&&(a=new Fx.Scroll(o,this.options.scrollFxOptions),o.store("$moo:fvScroller",a)),n&&(a?a.toElement(n):o.scrollTo(o.getScroll().x,n.getPosition(o).y-20))}return s},watchFields:function(e){e.each(function(e){this.options.evaluateFieldsOnBlur&&e.addEvent("blur",this.validationMonitor.pass([e,!1,this.options.scrollToErrorsOnBlur],this)),this.options.evaluateFieldsOnChange&&e.addEvent("change",this.validationMonitor.pass([e,!0,this.options.scrollToErrorsOnChange],this))},this)}}),Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(e,t){this.elements=this.subject=$$(e),this.parent(t)},compute:function(e,t,i){var s={};for(var n in e){var o=e[n],a=t[n],r=s[n]={};for(var l in o)r[l]=this.parent(o[l],a[l],i)}return s},set:function(e){for(var t in e)if(this.elements[t]){var i=e[t];for(var s in i)this.render(this.elements[t],s,i[s],this.options.unit)}return this},start:function(e){if(!this.check(e))return this;var t={},i={};for(var s in e)if(this.elements[s]){var n=e[s],o=t[s]={},a=i[s]={};for(var r in n){var l=this.prepare(this.elements[s],r,n[r]);o[r]=l.from,a[r]=l.to}}return this.parent(t,i)}}),Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:!1,fixedWidth:!1,display:0,show:!1,height:!0,width:!1,opacity:!0,alwaysHide:!1,trigger:"click",initialDisplayFx:!0,resetHeight:!0,keepOpen:!1},initialize:function(){var e=function(e){return null!=e},t=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:e,elements:e});this.parent(t.elements,t.options);var i=this.options,s=this.togglers=$$(t.togglers);this.previous=-1,this.internalChain=new Chain,i.alwaysHide&&(this.options.link="chain"),(i.show||0===this.options.show)&&(i.display=!1,this.previous=i.show),i.start&&(i.display=!1,i.show=!1);var n=this.effects={};i.opacity&&(n.opacity="fullOpacity"),i.width&&(n.width=i.fixedWidth?"fullWidth":"offsetWidth"),i.height&&(n.height=i.fixedHeight?"fullHeight":"scrollHeight");for(var o=0,a=s.length;a>o;o++)this.addSection(s[o],this.elements[o]);this.elements.each(function(e,t){if(i.show===t)this.fireEvent("active",[s[t],e]);else for(var o in n)e.setStyle(o,0)},this),(i.display||0===i.display||!1===i.initialDisplayFx)&&this.display(i.display,i.initialDisplayFx),!1!==i.fixedHeight&&(i.resetHeight=!1),this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(e,t){e=document.id(e),t=document.id(t),this.togglers.include(e),this.elements.include(t);var i=this.togglers,s=this.options,n=i.contains(e),o=i.indexOf(e),a=this.display.pass(o,this);if(e.store("accordion:display",a).addEvent(s.trigger,a),s.height&&t.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"}),s.width&&t.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"}),t.fullOpacity=1,s.fixedWidth&&(t.fullWidth=s.fixedWidth),s.fixedHeight&&(t.fullHeight=s.fixedHeight),t.setStyle("overflow","hidden"),!n)for(var r in this.effects)t.setStyle(r,0);return this},removeSection:function(e,t){var i=this.togglers,s=i.indexOf(e),n=this.elements[s],o=function(){i.erase(e),this.elements.erase(n),this.detach(e)}.bind(this);return this.now==s||null!=t?this.display(null!=t?t:s-1>=0?s-1:0).chain(o):o(),this},detach:function(e){var t=function(e){e.removeEvent(this.options.trigger,e.retrieve("accordion:display"))}.bind(this);return e?t(e):this.togglers.each(t),this},display:function(e,t){if(!this.check(e,t))return this;var i={},s=this.elements,n=this.options,o=this.effects,a=n.keepOpen,r=n.alwaysHide;if(null==t&&(t=!0),"element"==typeOf(e)&&(e=s.indexOf(e)),e==this.current&&!r&&!a)return this;if(n.resetHeight){var l=s[this.current];if(l&&!this.selfHidden)for(var h in o)l.setStyle(h,l[o[h]])}return this.timer&&"chain"==n.link?this:(null!=this.current&&(this.previous=this.current),this.current=e,this.selfHidden=!1,s.each(function(s,l){i[l]={};var h,u;if(!a||l==e){l==e&&(u=s.offsetHeight>0&&n.height||s.offsetWidth>0&&n.width),l!=e?h=!0:(r||a)&&u&&(h=!0,this.selfHidden=!0),this.fireEvent(h?"background":"active",[this.togglers[l],s]);for(var c in o)i[l][c]=h?0:s[o[c]];t||h||!n.resetHeight||(i[l].height="auto")}},this),this.internalChain.clearChain(),this.internalChain.chain(function(){if(n.resetHeight&&!this.selfHidden){var t=s[e];t&&t.setStyle("height","auto")}}.bind(this)),t?this.start(i):this.set(i).internalChain.callChain())}}),Fx.Move=new Class({Extends:Fx.Morph,options:{relativeTo:document.body,position:"center",edge:!1,offset:{x:0,y:0}},start:function(e){var t=this.element,i=t.getStyles("top","left");return("auto"==i.top||"auto"==i.left)&&t.setPosition(t.getPosition(t.getOffsetParent())),this.parent(t.position(Object.merge({},this.options,e,{returnPos:!0})))}}),Element.Properties.move={set:function(e){return this.get("move").cancel().setOptions(e),this},get:function(){var e=this.retrieve("move");return e||(e=new Fx.Move(this,{link:"cancel"}),this.store("move",e)),e}},Element.implement({move:function(e){return this.get("move").start(e),this}}),function(){function e(e){return/^(?:body|html)$/i.test(e.tagName)}Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:!0},initialize:function(e,t){if(this.element=this.subject=document.id(e),this.parent(t),"element"!=typeOf(this.element)&&(this.element=document.id(this.element.getDocument().body)),this.options.wheelStops){var i=this.element,s=this.cancel.pass(!1,this);this.addEvent("start",function(){i.addEvent("mousewheel",s)},!0),this.addEvent("complete",function(){i.removeEvent("mousewheel",s)},!0)}},set:function(){var e=Array.flatten(arguments);return this.element.scrollTo(e[0],e[1]),this},compute:function(e,t,i){return[0,1].map(function(s){return Fx.compute(e[s],t[s],i)})},start:function(e,t){if(!this.check(e,t))return this;var i=this.element.getScroll();return this.parent([i.x,i.y],[e,t])},calculateScroll:function(e,t){var i=this.element,s=i.getScrollSize(),n=i.getScroll(),o=i.getSize(),a=this.options.offset,r={x:e,y:t};for(var l in r)r[l]||0===r[l]||(r[l]=n[l]),"number"!=typeOf(r[l])&&(r[l]=s[l]-o[l]),r[l]+=a[l];return[r.x,r.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(!1,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,!1))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",!1))},toBottom:function(){return this.start.apply(this,this.calculateScroll(!1,"bottom"))},toElement:function(t,i){i=i?Array.convert(i):["x","y"];var s=e(this.element)?{x:0,y:0}:this.element.getScroll(),n=Object.map(document.id(t).getPosition(this.element),function(e,t){return!!i.contains(t)&&e+s[t]});return this.start.apply(this,this.calculateScroll(n.x,n.y))},toElementEdge:function(e,t,i){t=t?Array.convert(t):["x","y"],e=document.id(e);var s={},n=e.getPosition(this.element),o=e.getSize(),a=this.element.getScroll(),r=this.element.getSize(),l={x:n.x+o.x,y:n.y+o.y};return["x","y"].each(function(e){t.contains(e)&&(l[e]>a[e]+r[e]&&(s[e]=l[e]-r[e]),n[e]<a[e]&&(s[e]=n[e])),null==s[e]&&(s[e]=a[e]),i&&i[e]&&(s[e]=s[e]+i[e])},this),(s.x!=a.x||s.y!=a.y)&&this.start(s.x,s.y),this},toElementCenter:function(e,t,i){t=t?Array.convert(t):["x","y"],e=document.id(e);var s={},n=e.getPosition(this.element),o=e.getSize(),a=this.element.getScroll(),r=this.element.getSize();return["x","y"].each(function(e){t.contains(e)&&(s[e]=n[e]-(r[e]-o[e])/2),null==s[e]&&(s[e]=a[e]),i&&i[e]&&(s[e]=s[e]+i[e])},this),(s.x!=a.x||s.y!=a.y)&&this.start(s.x,s.y),this}})}(),Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:!1,hideOverflow:!0,resetHeight:!1},initialize:function(e,t){e=this.element=this.subject=document.id(e),this.parent(t),t=this.options;var i=e.retrieve("wrapper"),s=e.getStyles("margin","position","overflow");t.hideOverflow&&(s=Object.append(s,{overflow:"hidden"})),t.wrapper&&(i=document.id(t.wrapper).setStyles(s)),i||(i=new Element("div",{styles:s}).wraps(e)),e.store("wrapper",i).setStyle("margin",0),"visible"==e.getStyle("overflow")&&e.setStyle("overflow","hidden"),this.now=[],this.open=!0,this.wrapper=i,this.addEvent("complete",function(){this.open=0!=i["offset"+this.layout.capitalize()],this.open&&this.options.resetHeight&&i.setStyle("height","")},!0)},vertical:function(){this.margin="margin-top",this.layout="height",this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left",this.layout="width",this.offset=this.element.offsetWidth},set:function(e){return this.element.setStyle(this.margin,e[0]),this.wrapper.setStyle(this.layout,e[1]),this},compute:function(e,t,i){return[0,1].map(function(s){return Fx.compute(e[s],t[s],i)})},start:function(e,t){if(!this.check(e,t))return this;this[t||this.options.mode]();var i,s=this.element.getStyle(this.margin).toInt(),n=this.wrapper.getStyle(this.layout).toInt(),o=[[s,n],[0,this.offset]],a=[[s,n],[-this.offset,0]];switch(e){case"in":i=o;break;case"out":i=a;break;case"toggle":i=0==n?o:a}return this.parent(i[0],i[1])},slideIn:function(e){return this.start("in",e)},slideOut:function(e){return this.start("out",e)},hide:function(e){return this[e||this.options.mode](),this.open=!1,this.set([-this.offset,0])},show:function(e){return this[e||this.options.mode](),this.open=!0,this.set([0,this.offset])},toggle:function(e){return this.start("toggle",e)}}),Element.Properties.slide={set:function(e){return this.get("slide").cancel().setOptions(e),this},get:function(){var e=this.retrieve("slide");return e||(e=new Fx.Slide(this,{link:"cancel"}),this.store("slide",e)),e}},Element.implement({slide:function(e,t){e=e||"toggle";var i,s=this.get("slide");switch(e){case"hide":s.hide(t);break;case"show":s.show(t);break;case"toggle":var n=this.retrieve("slide:flag",s.open);s[n?"slideOut":"slideIn"](t),this.store("slide:flag",!n),i=!0;break;default:s.start(e,t)}return i||this.eliminate("slide:flag"),this}}),Fx.SmoothScroll=new Class({Extends:Fx.Scroll,options:{axes:["x","y"]},initialize:function(e,t){t=t||document,this.doc=t.getDocument(),this.parent(this.doc,e);var i=t.getWindow(),s=i.location.href.match(/^[^#]*/)[0]+"#";$$(this.options.links||this.doc.links).each(function(e){if(0==e.href.indexOf(s)){var t=e.href.substr(s.length);t&&this.useLink(e,t)}},this),this.addEvent("complete",function(){i.location.hash=this.anchor,this.element.scrollTo(this.to[0],this.to[1])},!0)},useLink:function(e,t){return e.addEvent("click",function(i){var s=document.id(t)||this.doc.getElement("a[name="+t+"]");s&&(i.preventDefault(),this.toElement(s,this.options.axes).chain(function(){this.fireEvent("scrolledTo",[e,s])}.bind(this)),this.anchor=t)}.bind(this)),this}}),Fx.Sort=new Class({Extends:Fx.Elements,options:{mode:"vertical"},initialize:function(e,t){this.parent(e,t),this.elements.each(function(e){"static"==e.getStyle("position")&&e.setStyle("position","relative")}),this.setDefaultOrder()},setDefaultOrder:function(){this.currentOrder=this.elements.map(function(e,t){return t})},sort:function(){if(!this.check(arguments))return this;var e=Array.flatten(arguments),t=0,i=0,s={},n={},o="vertical"==this.options.mode,a=this.elements.map(function(e,s){var a,r=e.getComputedSize({styles:["border","padding","margin"]});o?(a={top:t,margin:r["margin-top"],height:r.totalHeight},t+=a.height-r["margin-top"]):(a={left:i,margin:r["margin-left"],width:r.totalWidth},i+=a.width);var l=o?"top":"left";n[s]={};var h=e.getStyle(l).toInt();return n[s][l]=h||0,a},this);this.set(n),e=e.map(function(e){return e.toInt()}),e.length!=this.elements.length&&(this.currentOrder.each(function(t){e.contains(t)||e.push(t)}),e.length>this.elements.length&&e.splice(this.elements.length-1,e.length-this.elements.length));var r=0;t=i=0,e.each(function(e){var n={};o?(n.top=t-a[e].top-r,t+=a[e].height):(n.left=i-a[e].left,i+=a[e].width),r+=a[e].margin,s[e]=n},this);var l={};return Array.clone(e).sort().each(function(e){l[e]=s[e]}),this.start(l),this.currentOrder=e,this},rearrangeDOM:function(e){e=e||this.currentOrder;var t=this.elements[0].getParent(),i=[];return this.elements.setStyle("opacity",0),e.each(function(e){i.push(this.elements[e].inject(t).setStyles({top:0,left:0}))},this),this.elements.setStyle("opacity",1),this.elements=$$(i),this.setDefaultOrder(),this},getDefaultOrder:function(){return this.elements.map(function(e,t){return t})},getCurrentOrder:function(){return this.currentOrder},forward:function(){return this.sort(this.getDefaultOrder())},backward:function(){return this.sort(this.getDefaultOrder().reverse())},reverse:function(){return this.sort(this.currentOrder.reverse())},sortByElements:function(e){return this.sort(e.map(function(e){return this.elements.indexOf(e)},this))},swap:function(e,t){"element"==typeOf(e)&&(e=this.elements.indexOf(e)),"element"==typeOf(t)&&(t=this.elements.indexOf(t));var i=Array.clone(this.currentOrder);return i[this.currentOrder.indexOf(e)]=t,i[this.currentOrder.indexOf(t)]=e,this.sort(i)}}),function(){var e=this.Keyboard=new Class({Extends:Events,Implements:[Options],options:{defaultEventType:"keydown",active:!1,manager:null,events:{},nonParsedEvents:["activate","deactivate","onactivate","ondeactivate","changed","onchanged"]},initialize:function(e){e&&e.manager&&(this._manager=e.manager,delete e.manager),this.setOptions(e),this._setup()},addEvent:function(t,i,s){return this.parent(e.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i,s)},removeEvent:function(t,i){return this.parent(e.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i)},toggleActive:function(){return this[this.isActive()?"deactivate":"activate"]()},activate:function(t){if(t){if(t.isActive())return this;this._activeKB&&t!=this._activeKB&&(this.previous=this._activeKB,this.previous.fireEvent("deactivate")),this._activeKB=t.fireEvent("activate"),e.manager.fireEvent("changed")}else this._manager&&this._manager.activate(this);return this},isActive:function(){return this._manager?this._manager._activeKB==this:e.manager==this},deactivate:function(t){return t?t===this._activeKB&&(this._activeKB=null,t.fireEvent("deactivate"),e.manager.fireEvent("changed")):this._manager&&this._manager.deactivate(this),this},relinquish:function(){return this.isActive()&&this._manager&&this._manager.previous?this._manager.activate(this._manager.previous):this.deactivate(),this},manage:function(e){return e._manager&&e._manager.drop(e),this._instances.push(e),e._manager=this,
this._activeKB||this.activate(e),this},drop:function(e){return e.relinquish(),this._instances.erase(e),this._activeKB==e&&(this.previous&&this._instances.contains(this.previous)?this.activate(this.previous):this._activeKB=this._instances[0]),this},trace:function(){e.trace(this)},each:function(t){e.each(this,t)},_instances:[],_disable:function(e){this._activeKB==e&&(this._activeKB=null)},_setup:function(){this.addEvents(this.options.events),e.manager&&!this._manager&&e.manager.manage(this),this.options.active?this.activate():this.relinquish()},_handle:function(e,t){if(!e.preventKeyboardPropagation){var i=!!this._manager;i&&this._activeKB&&(this._activeKB._handle(e,t),e.preventKeyboardPropagation)||(this.fireEvent(t,e),!i&&this._activeKB&&this._activeKB._handle(e,t))}}}),t={},i=["shift","control","alt","meta"],s=/^(?:shift|control|ctrl|alt|meta)$/;e.parse=function(e,n,o){if(o&&o.contains(e.toLowerCase()))return e;if(e=e.toLowerCase().replace(/^(keyup|keydown):/,function(e,t){return n=t,""}),!t[e])if("+"!=e){var a,r={};e.split("+").each(function(e){s.test(e)?r[e]=!0:a=e}),r.control=r.control||r.ctrl;var l=[];i.each(function(e){r[e]&&l.push(e)}),a&&l.push(a),t[e]=l.join("+")}else t[e]=e;return n+":keys("+t[e]+")"},e.each=function(t,i){for(var s=t||e.manager;s;)i(s),s=s._activeKB},e.stop=function(e){e.preventKeyboardPropagation=!0},e.manager=new e({active:!0}),e.trace=function(t){t=t||e.manager;var i=window.console&&console.log;i&&console.log("the following items have focus: "),e.each(t,function(e){i&&console.log(document.id(e.widget)||e.wiget||e)})};var n=function(t){var n=[];i.each(function(e){t[e]&&n.push(e)}),s.test(t.key)||n.push(t.key),e.manager._handle(t,t.type+":keys("+n.join("+")+")")};document.addEvents({keyup:n,keydown:n})}(),Keyboard.prototype.options.nonParsedEvents.combine(["rebound","onrebound"]),Keyboard.implement({addShortcut:function(e,t){return this._shortcuts=this._shortcuts||[],this._shortcutIndex=this._shortcutIndex||{},t.getKeyboard=Function.convert(this),t.name=e,this._shortcutIndex[e]=t,this._shortcuts.push(t),t.keys&&this.addEvent(t.keys,t.handler),this},addShortcuts:function(e){for(var t in e)this.addShortcut(t,e[t]);return this},removeShortcut:function(e){var t=this.getShortcut(e);return t&&t.keys&&(this.removeEvent(t.keys,t.handler),delete this._shortcutIndex[e],this._shortcuts.erase(t)),this},removeShortcuts:function(e){return e.each(this.removeShortcut,this),this},getShortcuts:function(){return this._shortcuts||[]},getShortcut:function(e){return(this._shortcutIndex||{})[e]}}),Keyboard.rebind=function(e,t){Array.convert(t).each(function(t){t.getKeyboard().removeEvent(t.keys,t.handler),t.getKeyboard().addEvent(e,t.handler),t.keys=e,t.getKeyboard().fireEvent("rebound")})},Keyboard.getActiveShortcuts=function(e){var t=[],i=[];return Keyboard.each(e,[].push.bind(t)),t.each(function(e){i.extend(e.getShortcuts())}),i},Keyboard.getShortcut=function(e,t,i){i=i||{};var s=i.many?[]:null,n=i.many?function(t){var i=t.getShortcut(e);i&&s.push(i)}:function(t){s||(s=t.getShortcut(e))};return Keyboard.each(t,n),s},Keyboard.getShortcuts=function(e,t){return Keyboard.getShortcut(e,t,{many:!0})},function(){this.HtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"HtmlTable",initialize:function(){var e=Array.link(arguments,{options:Type.isObject,table:Type.isElement,id:Type.isString});return this.setOptions(e.options),!e.table&&e.id&&(e.table=document.id(e.id)),this.element=e.table||new Element("table",this.options.properties),this.occlude()?this.occluded:void this.build()},build:function(){this.element.store("HtmlTable",this),this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element),$$(this.body.rows),this.options.headers.length?this.setHeaders(this.options.headers):this.thead=document.id(this.element.tHead),this.thead&&(this.head=this.getHead()),this.options.footers.length&&this.setFooters(this.options.footers),this.tfoot=document.id(this.element.tFoot),this.tfoot&&(this.foot=document.id(this.tfoot.rows[0])),this.options.rows.each(function(e){this.push(e)},this)},toElement:function(){return this.element},empty:function(){return this.body.empty(),this},set:function(e,t){var i="headers"==e?"tHead":"tFoot",s=i.toLowerCase();this[s]=(document.id(this.element[i])||new Element(s).inject(this.element,"top")).empty();var n=this.push(t,{},this[s],"headers"==e?"th":"td");return"headers"==e?this.head=this.getHead():this.foot=this.getHead(),n},getHead:function(){var e=this.thead.rows;return e.length>1?$$(e):!!e.length&&document.id(e[0])},setHeaders:function(e){return this.set("headers",e),this},setFooters:function(e){return this.set("footers",e),this},update:function(e,t,i){var s=e.getChildren(i||"td"),n=s.length-1;return t.each(function(t,o){var a=s[o]||new Element(i||"td").inject(e),r=(t&&Object.prototype.hasOwnProperty.call(t,"content")?t.content:"")||t,l=typeOf(r);t&&Object.prototype.hasOwnProperty.call(t,"properties")&&a.set(t.properties),/(element(s?)|array|collection)/.test(l)?a.empty().adopt(r):a.set("html",r),o>n?s.push(a):s[o]=a}),{tr:e,tds:s}},push:function(e,t,i,s,n){return"element"==typeOf(e)&&"tr"==e.get("tag")?(e.inject(i||this.body,n),{tr:e,tds:e.getChildren("td")}):this.update(new Element("tr",t).inject(i||this.body,n),e,s)},pushMany:function(e,t,i,s,n){return e.map(function(e){return this.push(e,t,i,s,n)},this)}})}(),["adopt","inject","wraps","grab","replaces","dispose"].each(function(e){HtmlTable.implement(e,function(){return this.element[e].apply(this.element,arguments),this})}),HtmlTable=Class.refactor(HtmlTable,{options:{useKeyboard:!0,classRowSelected:"table-tr-selected",classRowHovered:"table-tr-hovered",classSelectable:"table-selectable",shiftForMultiSelect:!0,allowMultiSelect:!0,selectable:!1,selectHiddenRows:!1},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.selectedRows=new Elements,this.bound||(this.bound={}),this.bound.mouseleave=this.mouseleave.bind(this),this.bound.clickRow=this.clickRow.bind(this),this.bound.activateKeyboard=function(){this.keyboard&&this.selectEnabled&&this.keyboard.activate()}.bind(this),void(this.options.selectable&&this.enableSelect()))},empty:function(){return this.body.rows.length&&this.selectNone(),this.previous()},enableSelect:function(){return this.selectEnabled=!0,this.attachSelects(),this.element.addClass(this.options.classSelectable),this},disableSelect:function(){return this.selectEnabled=!1,this.attachSelects(!1),this.element.removeClass(this.options.classSelectable),this},push:function(){var e=this.previous.apply(this,arguments);return this.updateSelects(),e},toggleRow:function(e){return this[(this.isSelected(e)?"de":"")+"selectRow"](e)},selectRow:function(e,t){return this.isSelected(e)||!t&&!this.body.getChildren().contains(e)?void 0:(this.options.allowMultiSelect||this.selectNone(),this.isSelected(e)||(this.selectedRows.push(e),e.addClass(this.options.classRowSelected),this.fireEvent("rowFocus",[e,this.selectedRows]),this.fireEvent("stateChanged")),this.focused=e,document.clearSelection(),this)},isSelected:function(e){return this.selectedRows.contains(e)},getSelected:function(){return this.selectedRows},serialize:function(){var e=this.previous.apply(this,arguments)||{};return this.options.selectable&&(e.selectedRows=this.selectedRows.map(function(e){return Array.indexOf(this.body.rows,e)}.bind(this))),e},restore:function(e){this.options.selectable&&e.selectedRows&&e.selectedRows.each(function(e){this.selectRow(this.body.rows[e])}.bind(this)),this.previous.apply(this,arguments)},deselectRow:function(e,t){return this.isSelected(e)&&(t||this.body.getChildren().contains(e))?(this.selectedRows=new Elements(Array.convert(this.selectedRows).erase(e)),e.removeClass(this.options.classRowSelected),this.fireEvent("rowUnfocus",[e,this.selectedRows]),this.fireEvent("stateChanged"),this):void 0},selectAll:function(e){return e||this.options.allowMultiSelect?(this.selectRange(0,this.body.rows.length,e),this):void 0},selectNone:function(){return this.selectAll(!0)},selectRange:function(e,t,i){if(this.options.allowMultiSelect||i){var s=i?"deselectRow":"selectRow",n=Array.clone(this.body.rows);if("element"==typeOf(e)&&(e=n.indexOf(e)),"element"==typeOf(t)&&(t=n.indexOf(t)),t=t<n.length-1?t:n.length-1,e>t){var o=e;e=t,t=o}for(var a=e;t>=a;a++)(this.options.selectHiddenRows||n[a].isDisplayed())&&this[s](n[a],!0);return this}},deselectRange:function(e,t){this.selectRange(e,t,!0)},enterRow:function(e){this.hovered&&(this.hovered=this.leaveRow(this.hovered)),this.hovered=e.addClass(this.options.classRowHovered)},leaveRow:function(e){e.removeClass(this.options.classRowHovered)},updateSelects:function(){Array.each(this.body.rows,function(e){var t=e.retrieve("binders");(t||this.selectEnabled)&&(t||(t={mouseenter:this.enterRow.pass([e],this),mouseleave:this.leaveRow.pass([e],this)},e.store("binders",t)),this.selectEnabled?e.addEvents(t):e.removeEvents(t))},this)},shiftFocus:function(e,t){if(!this.focused)return this.selectRow(this.body.rows[0],t);var i=this.getRowByOffset(e,this.options.selectHiddenRows);return null===i||this.focused==this.body.rows[i]?this:void this.toggleRow(this.body.rows[i],t)},clickRow:function(e,t){(e.shift||e.meta||e.control)&&this.options.shiftForMultiSelect||e.rightClick&&this.isSelected(t)&&this.options.allowMultiSelect||this.selectNone(),e.rightClick?this.selectRow(t):this.toggleRow(t),e.shift&&(this.selectRange(this.rangeStart||this.body.rows[0],t,!this.rangeStart||!this.isSelected(t)),this.focused=t),this.rangeStart=t},getRowByOffset:function(e,t){if(!this.focused)return 0;var i=Array.indexOf(this.body.rows,this.focused);if(0==i&&0>e||i==this.body.rows.length-1&&e>0)return null;if(t)i+=e;else{var s=0;if(e>0)for(;e>s&&i<this.body.rows.length-1;)this.body.rows[++i].isDisplayed()&&s++;else for(;s>e&&i>0;)this.body.rows[--i].isDisplayed()&&s--}return i},attachSelects:function(e){e=null==e||e;var t=e?"addEvents":"removeEvents";if(this.element[t]({mouseleave:this.bound.mouseleave,click:this.bound.activateKeyboard}),this.body[t]({"click:relay(tr)":this.bound.clickRow,"contextmenu:relay(tr)":this.bound.clickRow}),this.options.useKeyboard||this.keyboard){if(this.keyboard||(this.keyboard=new Keyboard),!this.selectKeysDefined){this.selectKeysDefined=!0;var i,s,n=function(e){var t=function(n){clearTimeout(i),n.preventDefault();var o=this.body.rows[this.getRowByOffset(e,this.options.selectHiddenRows)];n.shift&&o&&this.isSelected(o)?(this.deselectRow(this.focused),this.focused=o):(!o||this.options.allowMultiSelect&&n.shift||this.selectNone(),this.shiftFocus(e,n)),i=s?t.delay(100,this,n):function(){s=!0,t(n)}.delay(400)}.bind(this);return t}.bind(this),o=function(){clearTimeout(i),s=!1};this.keyboard.addEvents({"keydown:shift+up":n(-1),"keydown:shift+down":n(1),"keyup:shift+up":o,"keyup:shift+down":o,"keyup:up":o,"keyup:down":o});var a="";this.options.allowMultiSelect&&this.options.shiftForMultiSelect&&this.options.useKeyboard&&(a=" (Shift multi-selects)."),this.keyboard.addShortcuts({"Select Previous Row":{keys:"up",shortcut:"up arrow",handler:n(-1),description:"Select the previous row in the table."+a},"Select Next Row":{keys:"down",shortcut:"down arrow",handler:n(1),description:"Select the next row in the table."+a}})}this.keyboard[e?"activate":"deactivate"]()}this.updateSelects()},mouseleave:function(){this.hovered&&this.leaveRow(this.hovered)}}),function(){var e=document.createElement("table");try{e.innerHTML="<tr><td></td></tr>",e=0===e.childNodes.length}catch(t){e=!0}HtmlTable=Class.refactor(HtmlTable,{options:{sortIndex:0,sortReverse:!1,parsers:[],defaultParser:"string",classSortable:"table-sortable",classHeadSort:"table-th-sort",classHeadSortRev:"table-th-sort-rev",classNoSort:"table-th-nosort",classGroupHead:"table-tr-group-head",classGroup:"table-tr-group",classCellSort:"table-td-sort",classSortSpan:"table-th-sort-span",sortable:!1,thSelector:"th"},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.sorted={index:null,dir:1},this.bound||(this.bound={}),this.bound.headClick=this.headClick.bind(this),this.sortSpans=new Elements,void(this.options.sortable&&(this.enableSort(),null!=this.options.sortIndex&&this.sort(this.options.sortIndex,this.options.sortReverse))))},attachSorts:function(e){this.detachSorts(),!1!==e&&this.element.addEvent("click:relay("+this.options.thSelector+")",this.bound.headClick)},detachSorts:function(){this.element.removeEvents("click:relay("+this.options.thSelector+")")},setHeaders:function(){this.previous.apply(this,arguments),this.sortable&&this.setParsers()},setParsers:function(){this.parsers=this.detectParsers()},detectParsers:function(){return this.head&&this.head.getElements(this.options.thSelector).flatten().map(this.detectParser,this)},detectParser:function(e,t){if(e.hasClass(this.options.classNoSort)||e.retrieve("htmltable-parser"))return e.retrieve("htmltable-parser");var i=new Element("div");i.adopt(e.childNodes).inject(e);var s=new Element("span",{class:this.options.classSortSpan}).inject(i,"top");this.sortSpans.push(s);var n,o=this.options.parsers[t],a=this.body.rows;switch(typeOf(o)){case"function":o={convert:o},n=!0;break;case"string":o=o,n=!0}return n||HtmlTable.ParserPriority.some(function(e){var i=HtmlTable.Parsers[e],s=i.match;if(!s)return!1;for(var n=0,r=a.length;r>n;n++){var l=document.id(a[n].cells[t]),h=l?l.get("html").clean():"";if(h&&s.test(h))return o=i,!0}}),o||(o=this.options.defaultParser),e.store("htmltable-parser",o),o},headClick:function(e,t){return this.head&&!t.hasClass(this.options.classNoSort)?this.sort(Array.indexOf(this.head.getElements(this.options.thSelector).flatten(),t)%this.body.rows[0].cells.length):void 0},serialize:function(){var e=this.previous.apply(this,arguments)||{};return this.options.sortable&&(e.sortIndex=this.sorted.index,e.sortReverse=this.sorted.reverse),e},restore:function(e){this.options.sortable&&e.sortIndex&&this.sort(e.sortIndex,e.sortReverse),this.previous.apply(this,arguments)},setSortedState:function(e,t){null!=t?this.sorted.reverse=t:this.sorted.index==e?this.sorted.reverse=!this.sorted.reverse:this.sorted.reverse=null==this.sorted.index,null!=e&&(this.sorted.index=e)},setHeadSort:function(e){var t=$$(this.head.length?this.head.map(function(e){return e.getElements(this.options.thSelector)[this.sorted.index]},this).clean():this.head.cells[this.sorted.index]);t.length&&(e?(t.addClass(this.options.classHeadSort),this.sorted.reverse?t.addClass(this.options.classHeadSortRev):t.removeClass(this.options.classHeadSortRev)):t.removeClass(this.options.classHeadSort).removeClass(this.options.classHeadSortRev))},setRowSort:function(e,t){for(var i,s,n=e.length,o=this.body;n;){var a=e[--n],r=a.position,l=o.rows[r];if(!l.disabled)for(t||(i=this.setGroupSort(i,l,a),this.setRowStyle(l,n)),o.appendChild(l),s=0;n>s;s++)e[s].position>r&&e[s].position--}},setRowStyle:function(e,t){this.previous(e,t),e.cells[this.sorted.index].addClass(this.options.classCellSort)},setGroupSort:function(e,t,i){return e==i.value?t.removeClass(this.options.classGroupHead).addClass(this.options.classGroup):t.removeClass(this.options.classGroup).addClass(this.options.classGroupHead),i.value},getParser:function(){var e=this.parsers[this.sorted.index];return"string"==typeOf(e)?HtmlTable.Parsers[e]:e},sort:function(t,i,s,n){if(this.head){s||(this.clearSort(),this.setSortedState(t,i),this.setHeadSort(!0));var o=this.getParser();if(o){var a;e||(a=this.body.getParent(),this.body.dispose());var r=this.parseData(o).sort(n||function(e,t){return e.value===t.value?0:e.value>t.value?1:-1}),l=this.sorted.reverse==(o==HtmlTable.Parsers["input-checked"]);return l&&r.reverse(!0),this.setRowSort(r,s),a&&a.grab(this.body),this.fireEvent("stateChanged"),this.fireEvent("sort",[this.body,this.sorted.index,l?"asc":"desc"])}}},parseData:function(e){return Array.map(this.body.rows,function(t,i){return{position:i,value:e.convert.call(document.id(t.cells[this.sorted.index]))}},this)},clearSort:function(){this.setHeadSort(!1),this.body.getElements("td").removeClass(this.options.classCellSort)},reSort:function(){return this.sortable&&this.sort.call(this,this.sorted.index,this.sorted.reverse),this},enableSort:function(){return this.element.addClass(this.options.classSortable),this.attachSorts(!0),this.setParsers(),this.sortable=!0,this},disableSort:function(){return this.element.removeClass(this.options.classSortable),this.attachSorts(!1),this.sortSpans.each(function(e){e.destroy()}),this.sortSpans.empty(),this.sortable=!1,this}}),HtmlTable.ParserPriority=["date","input-checked","input-value","float","number"],HtmlTable.Parsers={date:{match:/^\d{2}[-\/ ]\d{2}[-\/ ]\d{2,4}$/,convert:function(){var e=Date.parse(this.get("text").stripTags());return"date"==typeOf(e)?e.format("db"):""},type:"date"},"input-checked":{match:/ type="(radio|checkbox)"/,convert:function(){return this.getElement("input").checked}},"input-value":{match:/<input/,convert:function(){return this.getElement("input").value}},number:{match:/^\d+[^\d.,]*$/,convert:function(){return this.get("text").stripTags().toInt()},number:!0},numberLax:{match:/^[^\d]+\d+$/,convert:function(){return this.get("text").replace(/[^-?^0-9]/,"").stripTags().toInt()},number:!0},float:{match:/^[\d]+\.[\d]+/,convert:function(){return this.get("text").replace(/[^-?^\d.e]/,"").stripTags().toFloat()},number:!0},floatLax:{match:/^[^\d]+[\d]+\.[\d]+$/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags().toFloat()},number:!0},string:{match:null,convert:function(){return this.get("text").stripTags().toLowerCase()}},title:{match:null,convert:function(){return this.title}}},HtmlTable.defineParsers=function(e){HtmlTable.Parsers=Object.append(HtmlTable.Parsers,e);for(var t in e)HtmlTable.ParserPriority.unshift(t)}}(),HtmlTable=Class.refactor(HtmlTable,{options:{classZebra:"table-tr-odd",zebra:!0,zebraOnlyVisibleRows:!0},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:void(this.options.zebra&&this.updateZebras())},updateZebras:function(){var e=0;Array.each(this.body.rows,function(t){(!this.options.zebraOnlyVisibleRows||t.isDisplayed())&&this.zebra(t,e++)},this)},setRowStyle:function(e,t){this.previous&&this.previous(e,t),this.zebra(e,t)},zebra:function(e,t){return e[(t%2?"remove":"add")+"Class"](this.options.classZebra)},push:function(){var e=this.previous.apply(this,arguments);return this.options.zebra&&this.updateZebras(),e}}),function(){this.Scroller=new Class({Implements:[Events,Options],options:{area:20,velocity:1,onChange:function(e,t){this.element.scrollTo(e,t)},fps:50},initialize:function(e,t){this.setOptions(t),this.element=document.id(e),this.docBody=document.id(this.element.getDocument().body),this.listener="element"!=typeOf(this.element)?this.docBody:this.element,this.timer=null,this.bound={attach:this.attach.bind(this),detach:this.detach.bind(this),getCoords:this.getCoords.bind(this)}},start:function(){return this.listener.addEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this},stop:function(){return this.listener.removeEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this.detach(),this.timer=clearInterval(this.timer),this},attach:function(){this.listener.addEvent("mousemove",this.bound.getCoords)},detach:function(){this.listener.removeEvent("mousemove",this.bound.getCoords),this.timer=clearInterval(this.timer)},getCoords:function(e){this.page="body"==this.listener.get("tag")?e.client:e.page,this.timer||(this.timer=this.scroll.periodical(Math.round(1e3/this.options.fps),this))},scroll:function(){var e=this.element.getSize(),t=this.element.getScroll(),i=this.element!=this.docBody&&this.element!=window?this.element.getOffsets():{x:0,y:0},s=this.element.getScrollSize(),n={x:0,y:0},o=this.options.area.top||this.options.area,a=this.options.area.bottom||this.options.area;for(var r in this.page)this.page[r]<o+i[r]&&0!=t[r]?n[r]=(this.page[r]-o-i[r])*this.options.velocity:this.page[r]+a>e[r]+i[r]&&t[r]+e[r]!=s[r]&&(n[r]=(this.page[r]-e[r]+a-i[r])*this.options.velocity),n[r]=n[r].round();(n.y||n.x)&&this.fireEvent("change",[t.x+n.x,t.y+n.y])}})}(),Locale.define("en-GB","Date",{dateOrder:["date","month","year"],shortDate:"%d/%m/%Y",shortTime:"%H:%M"}).inherit("en-US","Date"),Locale.define("en-US","Number",{decimal:".",group:",",currency:{prefix:"$ "}}),Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(e){this.options.log&&window.console&&console.log&&console.log("JSONP retrieving script with url:"+e)},onError:function(e){this.options.log&&window.console&&console.warn&&console.warn("JSONP "+e+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:!1},initialize:function(e){this.setOptions(e)},send:function(e){if(!Request.prototype.check.call(this,e))return this;this.running=!0;var t=typeOf(e);("string"==t||"element"==t)&&(e={data:e}),e=Object.merge(this.options,e||{});var i=e.data;switch(typeOf(i)){case"element":i=document.id(i).toQueryString();break;case"object":case"hash":i=Object.toQueryString(i)}var s=this.index=Request.JSONP.counter++,n="request_"+s,o=e.url+(e.url.test("\\?")?"&":"?")+e.callbackKey+"=Request.JSONP.request_map.request_"+s+(i?"&"+i:"");o.length>2083&&this.fireEvent("error",o),Request.JSONP.request_map[n]=function(){delete Request.JSONP.request_map[n],this.success(arguments,s)}.bind(this);var a=this.getScript(o).inject(e.injectScript);return this.fireEvent("request",[o,a]),e.timeout&&this.timeout.delay(e.timeout,this),this},getScript:function(e){return this.script||(this.script=new Element("script",{type:"text/javascript",async:!0,src:e})),this.script},success:function(e){this.running&&this.clear().fireEvent("complete",e).fireEvent("success",e).callChain()},cancel:function(){return this.running&&this.clear().fireEvent("cancel"),this},isRunning:function(){return!!this.running},clear:function(){return this.running=!1,this.script&&(this.script.destroy(),this.script=null),this},timeout:function(){return this.running&&(this.running=!1,this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()),this}}),Request.JSONP.counter=0,Request.JSONP.request_map={},Request.implement({options:{initialDelay:5e3,delay:5e3,limit:6e4},startTimer:function(e){var t=function(){this.running||this.send({data:e})};return this.lastDelay=this.options.initialDelay,this.timer=t.delay(this.lastDelay,this),this.completeCheck=function(e){clearTimeout(this.timer),this.lastDelay=e?this.options.delay:(this.lastDelay+this.options.delay).min(this.options.limit),this.timer=t.delay(this.lastDelay,this)},this.addEvent("complete",this.completeCheck)},stopTimer:function(){return clearTimeout(this.timer),this.removeEvent("complete",this.completeCheck)}}),Request.Queue=new Class({Implements:[Options,Events],Binds:["attach","request","complete","cancel","success","failure","exception"],options:{stopOnFailure:!0,autoAdvance:!0,concurrent:1,requests:{}},initialize:function(e){var t;e&&(t=e.requests,delete e.requests),this.setOptions(e),this.requests={},this.queue=[],this.reqBinders={},t&&this.addRequests(t)},addRequest:function(e,t){return this.requests[e]=t,this.attach(e,t),this},addRequests:function(e){return Object.each(e,function(e,t){this.addRequest(t,e)},this),this},getName:function(e){return Object.keyOf(this.requests,e)},attach:function(e,t){return t._groupSend?this:(["request","complete","cancel","success","failure","exception"].each(function(i){this.reqBinders[e]||(this.reqBinders[e]={}),this.reqBinders[e][i]=function(){this["on"+i.capitalize()].apply(this,[e,t].append(arguments))}.bind(this),t.addEvent(i,this.reqBinders[e][i])},this),t._groupSend=t.send,t.send=function(i){return this.send(e,i),t}.bind(this),this)},removeRequest:function(e){var t="object"==typeOf(e)?this.getName(e):e;return(t||"string"==typeOf(t))&&(e=this.requests[t])?(["request","complete","cancel","success","failure","exception"].each(function(i){e.removeEvent(i,this.reqBinders[t][i])},this),e.send=e._groupSend,delete e._groupSend,this):this},getRunning:function(){return Object.filter(this.requests,function(e){return e.running})},isRunning:function(){return!!Object.keys(this.getRunning()).length},send:function(e,t){var i=function(){this.requests[e]._groupSend(t),this.queue.erase(i)}.bind(this);return i.name=e,Object.keys(this.getRunning()).length>=this.options.concurrent||this.error&&this.options.stopOnFailure?this.queue.push(i):i(),this},hasNext:function(e){return e?!!this.queue.filter(function(t){return t.name==e}).length:!!this.queue.length},resume:function(){return this.error=!1,(this.options.concurrent-Object.keys(this.getRunning()).length).times(this.runNext,this),this},runNext:function(e){if(!this.queue.length)return this;if(e){var t;this.queue.each(function(i){t||i.name!=e||(t=!0,i())})}else this.queue[0]();return this},runAll:function(){return this.queue.each(function(e){e()}),this},clear:function(e){return e?this.queue=this.queue.map(function(t){return t.name!=e&&t}).filter(function(e){return e}):this.queue.empty(),this},cancel:function(e){return this.requests[e].cancel(),this},onRequest:function(){this.fireEvent("request",arguments)},onComplete:function(){this.fireEvent("complete",arguments),this.queue.length||this.fireEvent("end")},onCancel:function(){this.options.autoAdvance&&!this.error&&this.runNext(),this.fireEvent("cancel",arguments)},onSuccess:function(){this.options.autoAdvance&&!this.error&&this.runNext(),this.fireEvent("success",arguments)},onFailure:function(){this.error=!0,!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext(),this.fireEvent("failure",arguments)},onException:function(){this.error=!0,!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext(),this.fireEvent("exception",arguments)}}),function(e){Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var e=0,t=this.length;if(t)for(;t--;)null!=this[t]&&(e+=parseFloat(this[t]));return e},unique:function(){return[].combine(this)},shuffle:function(){for(var e=this.length;e&&--e;){var t=this[e],i=Math.floor(Math.random()*(e+1));this[e]=this[i],this[i]=t}return this},reduce:function(t,i){for(var s=0,n=this.length;n>s;s++)s in this&&(i=i===e?this[s]:t.call(null,i,this[s],s,this));return i},reduceRight:function(t,i){for(var s=this.length;s--;)s in this&&(i=i===e?this[s]:t.call(null,i,this[s],s,this));return i},pluck:function(e){return this.map(function(t){return t[e]})}})}(),Date.implement({timeDiffInWords:function(e){return Date.distanceOfTimeInWords(this,e||new Date)},timeDiff:function(e,t){null==e&&(e=new Date);for(var i,s,n=((e-this)/1e3).floor().abs(),o=[],a=[60,60,24,365,0],r=["s","m","h","d","y"],l=0;l<a.length&&(!l||n);l++)i=n,(s=a[l])&&(i=n%s,n=(n/s).floor()),o.unshift(i+(r[l]||""));return o.join(t||":")}}).extend({distanceOfTimeInWords:function(e,t){return Date.getTimePhrase(((t-e)/1e3).toInt())},getTimePhrase:function(e){var t=0>e?"Until":"Ago";0>e&&(e*=-1);var i={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:1/0},s="lessThanMinute";for(var n in i){var o=i[n];if(1.5*o>e){e>.75*o&&(s=n);break}e/=o,s=n+"s"}return e=e.round(),Date.getMsg(s+t,e).substitute({delta:e})}}).defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(e){var t=(new Date).clearTime();switch(e[0]){case"tom":return t.increment();case"yes":return t.decrement();default:return t}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(e){var t=(new Date).clearTime(),i=t.getDay(),s=Date.parseDay(e[2],!0),n=s-i;return i>=s&&(n+=7),"last"==e[1]&&(n-=7),t.set("date",t.getDate()+n)}}).alias("timeAgoInWords","timeDiffInWords"),function(){if(!this.Hash){var e=this.Hash=new Type("Hash",function(e){"hash"==typeOf(e)&&(e=Object.clone(e.getClean()));for(var t in e)this[t]=e[t];return this});this.$H=function(t){return new e(t)},e.implement({forEach:function(e,t){Object.forEach(this,e,t)},getClean:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getLength:function(){var e=0;for(var t in this)this.hasOwnProperty(t)&&e++;return e}}),e.alias("each","forEach"),e.implement({has:Object.prototype.hasOwnProperty,keyOf:function(e){return Object.keyOf(this,e)},hasValue:function(e){return Object.contains(this,e)},extend:function(t){return e.each(t||{},function(t,i){e.set(this,i,t)},this),this},combine:function(t){return e.each(t||{},function(t,i){e.include(this,i,t)},this),this},erase:function(e){return this.hasOwnProperty(e)&&delete this[e],this},get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){return(!this[e]||this.hasOwnProperty(e))&&(this[e]=t),this},empty:function(){return e.each(this,function(e,t){delete this[t]},this),this},include:function(e,t){return void 0==this[e]&&(this[e]=t),this},map:function(t,i){return new e(Object.map(this,t,i))},filter:function(t,i){return new e(Object.filter(this,t,i))},every:function(e,t){return Object.every(this,e,t)},some:function(e,t){return Object.some(this,e,t)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(e){return Object.toQueryString(this,e)}}),e.alias({indexOf:"keyOf",contains:"hasValue"})}}(),Hash.implement({getFromPath:function(e){return Object.getFromPath(this,e)},cleanValues:function(e){return new Hash(Object.cleanValues(this,e))},run:function(){Object.run(arguments)}}),Number.implement({format:function(e){var t=this;e=e?Object.clone(e):{};var i=function(t){return null!=e[t]?e[t]:Locale.get("Number."+t)},s=0>t,n=i("decimal"),o=i("precision"),a=i("group"),r=i("decimals");if(s){var l=i("negative")||{};null==l.prefix&&null==l.suffix&&(l.prefix="-"),["prefix","suffix"].each(function(t){l[t]&&(e[t]=i(t)+l[t])}),t=-t}var h=i("prefix"),u=i("suffix");""!==r&&r>=0&&20>=r&&(t=t.toFixed(r)),o>=1&&21>=o&&(t=(+t).toPrecision(o)),t+="";var c;if(!1===i("scientific")&&t.indexOf("e")>-1){var d=t.split("e"),p=+d[1];if(t=d[0].replace(".",""),0>p){for(p=-p-1,(c=d[0].indexOf("."))>-1&&(p-=c-1);p--;)t="0"+t;t="0."+t}else for((c=d[0].lastIndexOf("."))>-1&&(p-=d[0].length-c-1);p--;)t+="0"}if("."!=n&&(t=t.replace(".",n)),a){c=t.lastIndexOf(n),c=c>-1?c:t.length;for(var m=t.substring(c),f=c;f--;)(c-f-1)%3==0&&f!=c-1&&(m=a+m),m=t.charAt(f)+m;t=m}return h&&(t=h+t),u&&(t+=u),t},formatCurrency:function(e){var t=Locale.get("Number.currency")||{};return null==t.scientific&&(t.scientific=!1),t.decimals=null!=e?e:null==t.decimals?2:t.decimals,this.format(t)},formatPercentage:function(e){var t=Locale.get("Number.percentage")||{};return null==t.suffix&&(t.suffix="%"),t.decimals=null!=e?e:null==t.decimals?2:t.decimals,this.format(t)}}),function(){var e=function(){return this.get("value")},t=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[A-Fa-f0-9:]+\]|[^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(e,i){this.setOptions(i);var s=this.options.base||t.base;e||(e=s),e&&e.parsed?this.parsed=Object.clone(e.parsed):this.set("value",e.href||e.toString(),!!s&&new t(s))},parse:function(e,t){var i=e.match(this.regex);return!!i&&(i.shift(),this.merge(i.associate(this.parts),t))},merge:function(e,t){return!!(e&&e.scheme||t&&t.scheme)&&(t&&this.parts.every(function(i){return!e[i]&&(e[i]=t[i]||"",!0)}),e.port=e.port||this.schemes[e.scheme.toLowerCase()],e.directory=e.directory?this.parseDirectory(e.directory,t?t.directory:""):"/",e)},parseDirectory:function(e,i){if(e=("/"==e.substr(0,1)?"":i||"/")+e,
!e.test(t.regs.directoryDot))return e;var s=[];return e.replace(t.regs.endSlash,"").split("/").each(function(e){".."==e&&s.length>0?s.pop():"."!=e&&s.push(e)}),s.join("/")+"/"},combine:function(e){return e.value||e.scheme+"://"+(e.user?e.user+(e.password?":"+e.password:"")+"@":"")+(e.host||"")+(e.port&&e.port!=this.schemes[e.scheme]?":"+e.port:"")+(e.directory||"/")+(e.file||"")+(e.query?"?"+e.query:"")+(e.fragment?"#"+e.fragment:"")},set:function(e,i,s){if("value"==e){var n=i.match(t.regs.scheme);n&&(n=n[1]),n&&null==this.schemes[n.toLowerCase()]?this.parsed={scheme:n,value:i}:this.parsed=this.parse(i,(s||this).parsed)||(n?{scheme:n,value:i}:{value:i})}else"data"==e?this.setData(i):this.parsed[e]=i;return this},get:function(e,t){switch(e){case"value":return this.combine(this.parsed,!!t&&t.parsed);case"data":return this.getData()}return this.parsed[e]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(e,t){var i=this.get(t||"query");if(!i&&0!==i)return e?null:{};var s=i.parseQueryString();return e?s[e]:s},setData:function(e,t,i){if("string"==typeof e){var s=this.getData();s[arguments[0]]=arguments[1],e=s}else t&&(e=Object.merge(this.getData(null,i),e));return this.set(i||"query",Object.toQueryString(e))},clearData:function(e){return this.set(e||"query","")},toString:e,valueOf:e});t.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/},t.base=new t(Array.convert(document.getElements("base[href]",!0)).getLast(),{base:document.location}),String.implement({toURI:function(e){return new t(this,e)}})}(),URI=Class.refactor(URI,{combine:function(e,t){if(!t||e.scheme!=t.scheme||e.host!=t.host||e.port!=t.port)return this.previous.apply(this,arguments);var i=e.file+(e.query?"?"+e.query:"")+(e.fragment?"#"+e.fragment:"");if(!t.directory)return(e.directory||(e.file?"":"./"))+i;var s,n=t.directory.split("/"),o=e.directory.split("/"),a="",r=0;for(s=0;s<n.length&&s<o.length&&n[s]==o[s];s++);for(r=0;r<n.length-s-1;r++)a+="../";for(r=s;r<o.length-1;r++)a+=o[r]+"/";return(a||(e.file?"":"./"))+i},toAbsolute:function(e){return e=new URI(e),e&&e.set("directory","").set("file",""),this.toRelative(e)},toRelative:function(e){return this.get("value",new URI(e))}}),function(){var e=this.Asset={javascript:function(e,t){t||(t={});var i=new Element("script",{src:e,type:"text/javascript"}),s=t.document||document,n=t.onload||t.onLoad;return delete t.onload,delete t.onLoad,delete t.document,n&&(i.addEventListener?i.addEvent("load",n):i.addEvent("readystatechange",function(){["loaded","complete"].contains(this.readyState)&&n.call(this)})),i.set(t).inject(s.head)},css:function(e,t){t||(t={});var i=t.onload||t.onLoad,s=t.document||document,n=t.timeout||3e3;["onload","onLoad","document"].each(function(e){delete t[e]});var o=new Element("link",{type:"text/css",rel:"stylesheet",media:"screen",href:e}).setProperties(t).inject(s.head);if(i){var a=!1,r=0,l=function(){for(var e=document.styleSheets,t=0;t<e.length;t++){var s=e[t],h=s.ownerNode?s.ownerNode:s.owningElement;if(h&&h==o)return a=!0,i.call(o)}return r++,!a&&n/50>r?setTimeout(l,50):void 0};setTimeout(l,0)}return o},image:function(e,t){t||(t={});var i=new Image,s=document.id(i)||new Element("img");return["load","abort","error"].each(function(e){var n="on"+e,o="on"+e.capitalize(),a=t[n]||t[o]||function(){};delete t[o],delete t[n],i[n]=function(){i&&(s.parentNode||(s.width=i.width,s.height=i.height),i=i.onload=i.onabort=i.onerror=null,a.delay(1,s,s),s.fireEvent(e,s,1))}}),i.src=s.src=e,i&&i.complete&&i.onload.delay(1),s.set(t)},images:function(t,i){t=Array.convert(t);var s=function(){},n=0;return i=Object.merge({onComplete:s,onProgress:s,onError:s,properties:{}},i),new Elements(t.map(function(s,o){return e.image(s,Object.append(i.properties,{onload:function(){n++,i.onProgress.call(this,n,o,s),n==t.length&&i.onComplete()},onerror:function(){n++,i.onError.call(this,n,o,s),n==t.length&&i.onComplete()}}))}))}}}(),function(){var e=this.Color=new Type("Color",function(e,t){switch(arguments.length>=3?(t="rgb",e=Array.slice(arguments,0,3)):"string"==typeof e&&(e=e.match(/rgb/)?e.rgbToHex().hexToRgb(!0):e.match(/hsb/)?e.hsbToRgb():e.hexToRgb(!0)),t=t||"rgb"){case"hsb":var i=e;e=e.hsbToRgb(),e.hsb=i;break;case"hex":e=e.hexToRgb(!0)}return e.rgb=e.slice(0,3),e.hsb=e.hsb||e.rgbToHsb(),e.hex=e.rgbToHex(),Object.append(e,this)});e.implement({mix:function(){var t=Array.slice(arguments),i="number"==typeOf(t.getLast())?t.pop():50,s=this.slice();return t.each(function(t){t=new e(t);for(var n=0;3>n;n++)s[n]=Math.round(s[n]/100*(100-i)+t[n]/100*i)}),new e(s,"rgb")},invert:function(){return new e(this.map(function(e){return 255-e}))},setHue:function(t){return new e([t,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(t){return new e([this.hsb[0],t,this.hsb[2]],"hsb")},setBrightness:function(t){return new e([this.hsb[0],this.hsb[1],t],"hsb")}}),this.$RGB=function(t,i,s){return new e([t,i,s],"rgb")},this.$HSB=function(t,i,s){return new e([t,i,s],"hsb")},this.$HEX=function(t){return new e(t,"hex")},Array.implement({rgbToHsb:function(){var e=this[0],t=this[1],i=this[2],s=0,n=Math.max(e,t,i),o=Math.min(e,t,i),a=n-o,r=n/255,l=0!=n?a/n:0;if(0!=l){var h=(n-e)/a,u=(n-t)/a,c=(n-i)/a;s=e==n?c-u:t==n?2+h-c:4+u-h,0>(s/=6)&&s++}return[Math.round(360*s),Math.round(100*l),Math.round(100*r)]},hsbToRgb:function(){var e=Math.round(this[2]/100*255);if(0==this[1])return[e,e,e];var t=this[0]%360,i=t%60,s=Math.round(this[2]*(100-this[1])/1e4*255),n=Math.round(this[2]*(6e3-this[1]*i)/6e5*255),o=Math.round(this[2]*(6e3-this[1]*(60-i))/6e5*255);switch(Math.floor(t/60)){case 0:return[e,o,s];case 1:return[n,e,s];case 2:return[s,e,o];case 3:return[s,n,e];case 4:return[o,s,e];case 5:return[e,s,n]}return!1}}),String.implement({rgbToHsb:function(){var e=this.match(/\d{1,3}/g);return e?e.rgbToHsb():null},hsbToRgb:function(){var e=this.match(/\d{1,3}/g);return e?e.hsbToRgb():null}})}(),function(){this.Group=new Class({initialize:function(){this.instances=Array.flatten(arguments)},addEvent:function(e,t){var i=this.instances,s=i.length,n=s,o=new Array(s),a=this;i.each(function(r,l){r.addEvent(e,function(){o[l]||n--,o[l]=arguments,n||(t.call(a,i,r,o),n=s,o=new Array(s))})})}})}(),Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:!0},initialize:function(e,t){this.parent(e,t),this.load()},save:function(){var e=JSON.encode(this.hash);return!(!e||e.length>4096)&&("{}"==e?this.dispose():this.write(e),!0)},load:function(){return this.hash=new Hash(JSON.decode(this.read(),!0)),this}}),Hash.each(Hash.prototype,function(e,t){"function"==typeof e&&Hash.Cookie.implement(t,function(){var t=e.apply(this.hash,arguments);return this.options.autoSave&&this.save(),t})}),function(){var e=this.Table=function(){this.length=0;var e=[],t=[];this.set=function(i,s){var n=e.indexOf(i);if(-1==n){var o=e.length;e[o]=i,t[o]=s,this.length++}else t[n]=s;return this},this.get=function(i){var s=e.indexOf(i);return-1==s?null:t[s]},this.erase=function(i){var s=e.indexOf(i);return-1!=s?(this.length--,e.splice(s,1),t.splice(s,1)[0]):null},this.each=this.forEach=function(i,s){for(var n=0,o=this.length;o>n;n++)i.call(s,e[n],t[n],this)}};this.Type&&new Type("Table",e)}(),"Affinity"in window||(window.Affinity={}),Affinity.started=(new Date).getTime(),Affinity.views={},Affinity.Components={},Affinity.Components.Commons={},Affinity.Components.Commons.Version="6.0.11.1",Affinity.Components.Commons.Notes="WebWorker support (disabled)",Affinity.Components.Commons.Name="UI Framewrok Commons",Affinity.Components.Commons.File="commons.6.0.0.js",Affinity.Components.Commons.Notes="API Structure change",Affinity.Components.Commons.Jira="",Affinity.Components.MooTools={},Affinity.Components.MooTools.Version="1.6.0",Affinity.Components.MooTools.Name="MooTools Core",Affinity.Components.MooTools.File="MooTools-Core-1.6.0.js",Affinity.Components.MooTools.Jira="",Affinity.Components.MoreTools={},Affinity.Components.MoreTools.Version="1.6.0",Affinity.Components.MoreTools.Name="MooTools More",Affinity.Components.MoreTools.File="MooTools-More-1.6.0.js",Affinity.Components.MoreTools.Jira="","undefined"==typeof console&&(console={log:function(){}}),"undefined"==typeof MooTools)throw new ReferenceError("This site requires MooTools 1.6.0 and MooTools.More 1.6.0");var doc=document.documentElement;doc.setAttribute("data-useragent",navigator.userAgent),"events"in Affinity||(Affinity.events={}),Affinity.mobile=!1,Affinity.events={over:"mouseover",out:"mouseout",overAll:"mouseenter",outAll:"mouseleave",start:"mousedown",move:"mousemove",end:"mouseup",click:"click"},Affinity.icons={AddToList:"&#xe096;",Air:"&#xe047;",Alarm:"&#xe855;",AlarmAdd:"&#xe856;",Archive:"&#xe0a2;",ArrowDown:"&#xe0c0;",ArrowDownCircle:"&#xe0c8;",ArrowDownSmall:"&#xe0c4;",ArrowLeft:"&#xe0bf;",ArrowLeftCircle:"&#xe0c7;",ArrowLeftSmall:"&#xe0c3;",ArrowLineBigDown:"&#xe0d8;",ArrowLineBigLeft:"&#xe0d7;",ArrowLineBigRight:"&#xe0da;",ArrowLineBigUp:"&#xe0d9;",ArrowLineDown:"&#xe0d0;",ArrowLineLeft:"&#xe0cf;",ArrowLineRight:"&#xe0d2;",ArrowLineSmallDown:"&#xe0d4;",ArrowLineSmallLeft:"&#xe0d3;",ArrowLineSmallRight:"&#xe0d6;",ArrowLineSmallUp:"&#xe0d5;",ArrowLineUp:"&#xe0d1;",ArrowLongDown:"&#xe0dc;",ArrowLongLeft:"&#xe0db;",ArrowLongRight:"&#xe0de;",ArrowLongUp:"&#xe0dd;",ArrowRight:"&#xe0c2;",ArrowRightCircle:"&#xe0ca;",ArrowRightSmall:"&#xe0c6;",ArrowUp:"&#xe0c1;",ArrowUpCircle:"&#xe0c9;",ArrowUpSmall:"&#xe0c5;",ArrowheadDown:"&#xe0cc;",ArrowheadLeft:"&#xe0cb;",ArrowheadRight:"&#xe0ce;",ArrowheadUp:"&#xe0cd;",ArrowheadUpDown:"&#xe0df;",Back:"&#xe093;",Bag:"&#xe03b;",Barcode:"&#xe0fc;",Battery:"&#xe04d;",Bell:"&#xe029;",Blocked:"&#xe084;",Book:"&#xe039;",Book2:"&#xe0ac;",Bookmark:"&#xe0aa;",Bookmarks:"&#xe0ab;",Box:"&#xe06a;",Braces:"&#xe104;",Briefcase:"&#xe046;",Brightness:"&#xe060;",BrogressThird:"&#xe05c;",Browser:"&#xe058;",Brush:"&#xe053;",Bucket:"&#xe04e;",BulletList:"&#xe095;",Calendar:"&#xe041;",Camera:"&#xe030;",Cancel:"&#xe083;",Car:"&#xe909;",Cart:"&#xe069;",Cc:"&#xe0e3;",CcBy:"&#xe0e4;",CcNc:"&#xe0e5;",CcNcEu:"&#xe0e6;",CcNcJp:"&#xe0e7;",CcNd:"&#xe0e9;",CcPd:"&#xe0ea;",CcSa:"&#xe0e8;",CcShare:"&#xe0ec;",CcShare3:"&#xe0ed;",CcZero:"&#xe0eb;",Ccw:"&#xe08c;",Cd:"&#xe045;",Chat:"&#xe021;",Clipboard:"&#xe068;",Clock:"&#xe03f;",Cloud:"&#xe0a8;",Code:"&#xe061;",CodeA:"&#xe0ee;",CodeD:"&#xe0f0;",CodeH:"&#xe0ef;",CodeM:"&#xe10e;",CodeP:"&#xe10f;",CodeR:"&#xe0f1;",CodeS:"&#xe0f2;",Cog:"&#xe02c;",Comment:"&#xe022;",Compare:"&#xe103;",Compass:"&#xe016;",Cone:"&#xe055;",CreditCard:"&#xe065;",Cross:"&#xe07a;",CrossRound:"&#xe080;",CrossSquare:"&#xe07d;",Csharp:"&#xe0ff;",Cup:"&#xe051;",Cw:"&#xe08b;",Cycle:"&#xe08a;",Database:"&#xe066;",Directions:"&#xe005;",Docs:"&#xe09c;",DollarRound:"&#xe0fe;",Dot:"&#xe0e2;",Dots:"&#xe0e1;",DotsVert:"&#xe000;",Download:"&#xe0a5;",Drive:"&#xe050;",Droplet:"&#xe044;",Droplets:"&#xe06f;",Earth:"&#xe056;",Education:"&#xe038;",Eightball:"&#xe901;",Ellipsis:"&#xe0e0;",EmptyInbox:"&#xe00b;",Export:"&#xe013;",Extension:"&#xe87b;",Eye:"&#xe03e;",Feather:"&#xe009;",FieldEdit:"&#xe001;",FileExcel:"&#xe908;",FilePdf:"&#xe902;",FileWord:"&#xe907;",First:"&#xe0b3;",Flag:"&#xe02b;",Flashlight:"&#xe027;",FlowBranch:"&#xe0bb;",FlowCascade:"&#xe0ba;",FlowLine:"&#xe0bd;",FlowParallel:"&#xe0be;",FlowTree:"&#xe0bc;",Folder:"&#xe0a1;",Forward:"&#xe00e;",Gauge:"&#xe049;",Ghost:"&#xe0fa;",Gift:"&#xe105;",GraphBars:"&#xe073;",GraphLinefill:"&#xe074;",GraphPie:"&#xe072;",GraphStatistics:"&#xe071;",Grid:"&#xe070;",HeartEmpty:"&#xe01c;",HeartFull:"&#xe01b;",HelpRound:"&#xe088;",History:"&#xe092;",Hourglass:"&#xe048;",House:"&#xe024;",Incident:"&#xe548;",Infinity:"&#xe063;",Info:"&#xe085;",InfoRound:"&#xe086;",Install:"&#xe0a7;",Key:"&#xe04c;",Keyboard:"&#xe057;",Kiwi:"&#xe102;",Lab:"&#xe903;",Landscape:"&#xe09d;",Language:"&#xe04a;",Last:"&#xe0b4;",Layout:"&#xe097;",Leaf:"&#xe034;",LifeRing:"&#xe03d;",LightBulb:"&#xe064;",Lightning:"&#xe042;",Link:"&#xe02a;",List:"&#xe098;",Location:"&#xe014;",LocationArrow:"&#xe017;",Lock:"&#xe075;",LockApproved:"&#xe90c;",LockDeclined:"&#xe90d;",LockOpen:"&#xe90a;",LockPaid:"&#xe90e;",LockSubmitted:"&#xe90b;",Login:"&#xe078;",Logout:"&#xe077;",Loop:"&#xe091;",Magnet:"&#xe04f;",Mail:"&#xe006;",Map:"&#xe015;",Megaphone:"&#xe031;",Microphone:"&#xe040;",Minus:"&#xe081;",MinusRound:"&#xe07e;",MinusSquare:"&#xe07b;",Mobile:"&#xe003;",Moneybag:"&#xe0fd;",Moon:"&#xe032;",MoreLeft:"&#xe10a;",MoreRight:"&#xe10d;",Mouse:"&#xe004;",Music:"&#xe036;",MusicSemi:"&#xe035;",MusicSquare:"&#xe0a0;",Mute:"&#xe0b9;",Network:"&#xe04b;",New:"&#xe037;",Newspaper:"&#xe03a;",Next:"&#xe0b1;",Page:"&#xe099;",PageEmpty:"&#xe09b;",PageFull:"&#xe09a;",Palette:"&#xe033;",Paperclip:"&#xe00a;",Paperplane:"&#xe007;",Pause:"&#xe0ae;",Pencil:"&#xe008;",Phone:"&#xe002;",Pictures:"&#xe09e;",Pin:"&#xe904;",Plane:"&#xe03c;",Play:"&#xe0ad;",Plugin:"&#xe905;",Plus:"&#xe082;",PlusRound:"&#xe07f;",PlusSquare:"&#xe07c;",Poop:"&#xe101;",Popup:"&#xe025;",Previous:"&#xe0b2;",Printer:"&#xe028;",ProgressEmpty:"&#xe05d;",ProgressFull:"&#xe05a;",ProgressHalf:"&#xe05b;",Prompt:"&#xe109;",PromptAlert:"&#xe10c;",PromptInfo:"&#xe10b;",Publish:"&#xe059;",Qrcode:"&#xe0fb;",Question:"&#xe087;",Quote:"&#xe023;",Record:"&#xe0af;",Repeat:"&#xe090;",Reply:"&#xe00c;",ReplyAll:"&#xe00d;",ResizeEnlarge:"&#xe0b5;",ResizeShrink:"&#xe0b6;",Return:"&#xe08f;",ReturnBack:"&#xe08e;",Rocket:"&#xe052;",Rss:"&#xe06c;",Save:"&#xe0a6;",Scaledown:"&#xe107;",Scaleup:"&#xe108;",Schedule:"&#xe900;",Screen:"&#xe062;",Search:"&#xe026;",Sharable:"&#xe01a;",Share:"&#xe019;",Shield:"&#xe906;",Shuffle:"&#xe08d;",Sound:"&#xe0b8;",StarEmpty:"&#xe01e;",StarFull:"&#xe01d;",Stop:"&#xe0b0;",Suitcase:"&#xe054;",Sun:"&#xe05f;",SunSmall:"&#xe05e;",Switch:"&#xe094;",Sync:"&#xe100;",Tag:"&#xe02f;",Target:"&#xe018;",Thermometer:"&#xe06e;",ThumbsDown:"&#xe020;",ThumbsUp:"&#xe01f;",Thunder:"&#xe043;",Tick:"&#xe079;",Ticket:"&#xe06b;",Tools:"&#xe02d;",Traffic:"&#xe565;",Trash:"&#xe0a3;",Trophy:"&#xe02e;",Upload:"&#xe0a4;",Upload2:"&#xe0a9;",User:"&#xe0f3;",UserAdd:"&#xe0f5;",UserAddOld:"&#xe011;",UserBlock:"&#xe0f7;",UserBoss:"&#xe0f8;",UserCheck:"&#xe18a;",UserCheckOutline:"&#xe18b;",UserDel:"&#xe0f6;",UserOld:"&#xe00f;",Users:"&#xe0f4;",UsersOld:"&#xe010;",Vcard:"&#xe012;",Video:"&#xe09f;",Voicemail:"&#xe067;",Volume:"&#xe0b7;",Warning:"&#xe089;",Wireless:"&#xe06d;",Wrench:"&#xe0f9;",Zzz:"&#xe106;"},Affinity.colors={green:"#7abd2d",blue:"#44b5ec",lightblue:"#e3eef3",orange:"#ff6600",yellow:"#ffbd00",red:"#ff0000",grey:"#888888"},Affinity.icons.getIcon=function(e,t){return e&&e in Affinity.icons?Affinity.icons[e]:e&&(e=e.replace("icon","").trim().camelCase())in Affinity.icons?Affinity.icons[e]:t&&t in Affinity.icons?Affinity.icons[t]:""},Affinity.appname="none",Affinity.apiversion=2,Affinity.urlroot="",Affinity.authroot="",Affinity.zelosroot="",Affinity.lookupapi="",Affinity.uisession=String.uniqueID(),Affinity.uiready=!1,Affinity.login=null,Affinity.datalist=!1,Affinity.loaders={},Affinity.loaders.dark="data:image/gif;base64,R0lGODlhEAAQAPQAADMzM8zMzDs7O3h4eERERKGhoYKCgszMzJaWlra2tmNjY1lZWb+/v21tbcjIyKqqqoyMjAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.light="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zMzM/Ly8qGhoebm5mpqapSUlDMzM3l5eU9PT7y8vMrKykJCQq+vrzY2Nl5eXoaGhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.blue="data:image/gif;base64,R0lGODlhEAAQAPQAAJrS7v///5/U7sfm9aXX7+Lx+c3o9v///9vu+O/3+7rg87Pd8vb6/MDi9Pz9/ej0+tXr9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.large={},Affinity.loaders.large.light="data:image/gif;base64,R0lGODlhIAAgAPMAAO/v7wAAALq6unx8fKurq5CQkDIyMlBQUMvLy9bW1rCwsBwcHAMDAwAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==",Affinity.loaders.large.dark="data:image/gif;base64,R0lGODlhIAAgAPMAADMzM////19fX5SUlGxsbIKCgtLS0rm5uVFRUUdHR2dnZ+bm5vr6+gAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==",Affinity.agent=window.navigator.userAgent,Affinity.oldess=!1,Affinity.oldessLaunched=!1,Affinity.oldessFrame=!1,Affinity.oldessWindow=!1,Affinity.getScrollBarWidth=function(){var e=document.createElement("p");e.style.width="100%",e.style.height="200px";var t=document.createElement("div");t.style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t);var i=e.offsetWidth;t.style.overflow="scroll";var s=e.offsetWidth;return i==s&&(s=t.clientWidth),document.body.removeChild(t),i-s},Affinity.scrollBarSize=0,window.addEvent("domready",function(){Affinity.scrollBarSize=Affinity.getScrollBarWidth()}),Affinity.UI={},Affinity.UI.debug={},Affinity.UI.lookups={},
Affinity.UI.lookupLoaders=[],Affinity.UI.displaylookups={},Affinity.UI.displaylookupLoaders=[],Affinity.UI.dependancies={},Affinity.UI.dependancyLoaders=[],Affinity.UI.autocomplete={},Affinity.UI.lastAutoKill={},Affinity.UI.delayAutoKill=function(e,t){document.getElement("."+t)&&(document.getElement("."+t).removeEvents(),document.getElement("."+t).destroy()),window.Affinity.UI.lastAutoKill[e]=null,delete window.Affinity.UI.lastAutoKill[e]};var datalistTest=document.createElement("datalist");if("options"in datalistTest&&(Affinity.datalist=!0),datalistTest=null,delete datalistTest,Affinity.essmessage="",Affinity.UI.scrolling=!1,Affinity.UI.autoscroll=function(e){var t=window;if(Affinity.oldessFrame)try{t=window.parent.window}catch(e){}try{var i=t.document.documentElement,s=t.document.body,n=i&&i.scrollTop||s&&s.scrollTop||0;e>0&&t.scrollTo(0,n+10),e<0&&t.scrollTo(0,n-10)}catch(e){}},document.addEvent(Affinity.events.move,function(e){if(Affinity.UI.drageventFired){var t=e.client.y,i=window.innerHeight||window.document.documentElement.clientHeight,s=50,n=i-50;if(Affinity.oldessFrame)try{var o=window.parent;i=o.innerHeight||o.document.documentElement.clientHeight;var a=o.document.documentElement,r=o.document.body,l=a&&a.scrollTop||r&&r.scrollTop||0,h=0;h=document.documentMode&&document.documentMode<9?Affinity.oldessFrame.querySelectorAll(".ContentBody")[0].offsetTop:Affinity.oldessFrame.getElementsByClassName("ContentBody")[0].offsetTop;var u=l-h,s=50+u,n=u+i-50}catch(e){}t>n?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[1])):t<s?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[-1])):Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}}),document.addEvent(Affinity.events.end,function(){Affinity.UI.drageventFired=!1,Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}),Affinity.Konami=new Class({Implements:[Options],options:{onSuccess:function(){}},input:"",pattern:"38384040373937396665",initialize:function(e){this.setOptions(e),document.addEvent("keydown",function(e){this.input+=e.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input==this.pattern&&this.options.onSuccess()}.bind(this))}}),Affinity.RickRoll=new Class({Implements:[Options],Binds:["inject","destroy"],options:{},input:"",ytBox:!1,pattern:"8273677582797676",initialize:function(e){this.setOptions(e),document.addEvent("keydown",function(e){this.input+=e.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input==this.pattern&&this.inject()}.bind(this))},inject:function(){this.destroy(),this.ytBox=new Element("div").setStyles({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.8)","text-align":"center","z-index":99999999999}).inject(document.body,"bottom").set("html",'<iframe width="420" height="315" style="position:fixed;top:50%;left:50%;margin:-157px 0 0 -210px;" src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?rel=0&amp;autoplay=1&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>').addEvent("click",this.destroy)},destroy:function(){this.ytBox&&(this.ytBox.removeEvents(),this.ytBox.destroy())}}),new Affinity.RickRoll,Affinity.CookieMonster=new new Class({Read:function(e){if(!Affinity.isie)return Cookie.read(e);var t=document.cookie.indexOf(e+"=");if(-1!=t){t+=e.length+1;var i=document.cookie.indexOf(";",t);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(t,i))}},Write:function(e,t,i){var s=new URI(window.location.href).parsed.host,n=new Date;if("null"!==typeOf(i)&&!isNaN(i)&&parseFloat(i)>0){var o=new Date(n.getTime()+6e4*i),a=n.toUTCString(),r=o.toUTCString();if(log("&#169; Cookie Write Expires - name: "+e+", value: "+t),log("  expires: "+r+", now: "+a+", expires value: "+i+", in days: "+parseFloat(i)/1440+", domain: "+s),Affinity.isie)try{return document.cookie=e+"="+escape(t)+"; expires="+r+"; domain:"+s,t}catch(e){return!1}else try{return Cookie.write(e,t,{duration:parseFloat(i)/1440}),t}catch(e){return!1}}else if(log("&#169; Cookie Write - name: "+e+", value: "+t),Affinity.isie)try{return document.cookie=e+"="+escape(t)+";",t}catch(e){return!1}else try{return Cookie.write(e,t),t}catch(e){return!1}},Delete:function(e){if(log("&#169; Cookie Delete - name: "+e),Affinity.isie){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;";try{return Cookie.dispose(e),!0}catch(e){return!1}}else try{return Cookie.dispose(e),!0}catch(e){return!1}}}),Affinity.logger=new new Class({Binds:["build","enable","disable","enableLog","disableLog","log","clear","open","close"],enabled:!1,__prelog:[],initialize:function(){window.log=this.log,window.logClear=this.clear,window.logEnable=this.enableLog,window.logDisable=this.disableLog},build:function(){if(!Affinity.uiready)return window.removeEvent("UiReady",this.build),void window.addEvent("UiReady",this.build);window.removeEvent("UiReady",this.build),document.id("_log")&&document.id("_log").destroy(),document.id("_logbutton")&&document.id("_logbutton").destroy(),this.enabled=!0,this.logBox=new Element("div",{id:"_log"}).inject(document.body,"bottom"),this.logsBox=new Element("div",{html:"",class:"logs"}).inject(this.logBox,"top"),this.closeButton=new Element("div",{html:"close",class:"close"}).inject(this.logBox,"top"),this.clearButton=new Element("div",{html:"clear",class:"clear"}).inject(this.logBox,"top"),this.hiddenButton=new Element("div",{id:"_logbutton"}).inject(this.logBox,"after"),this.hiddenButton.setStyles({position:"absolute",top:5,left:5,width:30,height:30,"z-index":9999999998}),this.logBox.setStyles({position:"absolute",top:40,left:5,width:"80%",height:"80%",border:"1px solid black","background-color":"#fff",color:"000","z-index":9999999999,"-webkit-transform":"translateX(0)",transform:"translateX(0)",display:"none"}),this.logsBox.setStyles({width:"100%",height:"100%",padding:10,overflow:"scroll","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),this.clearButton.setStyles({position:"absolute",top:10,right:80,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.setStyles({position:"absolute",top:10,right:30,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.addEvent(Affinity.events.click,this.close),this.clearButton.addEvent(Affinity.events.click,this.clear),this.hiddenButton.addEvent(Affinity.events.click,this.open),this.log("// log started "+new Date),this.__prelog.length>0&&Array.each(this.__prelog,function(e){this.log(e[0],e[1])}.bind(this)),this.enabled=!1,window.fireEvent("LogReady")},enable:function(){this.destroy(),this.build(),this.open()},disable:function(){this.destroy()},enableLog:function(){return this.enabled=!0,this.log("// log enabled "+new Date),'Log Enabled. Enter "disableLog()" to stop.'},disableLog:function(){return this.log("// log disabled "+new Date),this.enabled=!1,'Log disabled. Enter "enableLog()" to start.'},log:function(e,t){if(this.enabled){if("string"===typeOf(e)&&("show"===e||"open"===e))return void this.open();var i="object"===typeOf(e)||"array"===typeOf(e)?JSON.stringify(e,null,2):"element"===typeOf(e)?"element type: "+e.get("tag")+"\r\n"+JSON.stringify(e.getProperties("id","class","style","src","title","alt"),null,2):e;"object"===typeOf(t)?new Element("<pre>",{html:i}).inject(this.logsBox,"top").setStyles(t):"string"===typeOf(t)?new Element("<pre>",{html:i}).inject(this.logsBox,"top").set("style",t):new Element("<pre>",{html:i}).inject(this.logsBox,"top")}else this.__prelog.push([e,t])},clear:function(){this.enabled&&(this.logsBox.empty(),this.log("// log cleared "+new Date))},open:function(){this.enabled&&("none"===this.logBox.getStyle("display")?this.logBox.setStyle("display","block"):this.logBox.setStyle("display","none"))},close:function(){this.enabled&&("block"===this.logBox.getStyle("display")?this.logBox.setStyle("display","none"):this.logBox.setStyle("display","block"))},destroy:function(){window.removeEvent("UiReady",this.build),this.enabled=!1,this.closeButton&&this.closeButton.remveEvents(),this.clearButton&&this.clearButton.remveEvents(),this.hiddenButton&&this.hiddenButton.remveEvents(),this.logBox&&this.logBox.destroy()}}),Affinity.SmartClose=new Class({Binds:["isActive","checkActive","isOver","setClose","overAll","outAll","windowClick"],over:!1,isOverCheckTimer:!1,initialize:function(e,t){if(Affinity.mobile)return"is mobile";this.class="smart-close-"+String.uniqueID(),this.element=e,this.element.addClass(this.class),this.element.isOver=this.isOver,this.element.addEvent(Affinity.events.overAll,this.overAll),this.element.addEvent(Affinity.events.outAll,this.outAll),this.element.addEvent("focus",this.setClose)},isActive:function(){return!!document.activeElement&&(document.activeElement===this.element||(document.activeElement.getParent("."+this.class),this.element),!0)},checkActive:function(){this.isActive()||(this.over=!1,this.windowClick())},isOver:function(){return this.isActive()||(this.over=!1),this.over},setClose:function(){window.removeEvent(Affinity.events.click,this.windowClick),window.addEvent(Affinity.events.click,this.windowClick)},overAll:function(){clearTimeout(this.isOverCheckTimer),this.setClose(),this.over=!0,this.isOverCheckTimer=this.checkActive.delay(1e3,this)},outAll:function(){clearTimeout(this.isOverCheckTimer),this.over=!1},windowClick:function(){this.over||(this.element.fireEvent("SmartClose"),window.removeEvent(Affinity.events.click,this.windowClick))}}),Affinity.UI.mobileZooming=!1,Affinity.mobile&&window.addEvents({touchmove:function(e){2===e.touches.length&&(Affinity.UI.mobileZooming=!0)},touchend:function(e){if(Affinity.UI.mobileZooming){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1),window.dispatchEvent(t)}Affinity.UI.mobileZooming=!1}}),Affinity.GetCacheSafePath=function(e){return Affinity.isie&&"string"===typeOf(e)?e+(e.contains("?")?"&ran=":"?ran=")+String.uniqueID()+"-"+Date.parse(new Date).format("%s"):e},Affinity.ProcessUrl=function(e){var t,i="/_Api/Zelos",s=e.replace("%3F","?"),s=Affinity.isTeampayoffice&&new RegExp("timesheets"+i,"i").test(s)?s.replace(new RegExp("timesheets"+i,"i"),i):s,s=Affinity.isTeampayofficeBranch&&new RegExp("tb"+i,"i").test(s)?s.replace(new RegExp("tb"+i,"i"),i):s,s=s.replace(i+"?",""),n=s.indexOf("&")>-1&&-1===s.indexOf("?")?s.replace("&","?"):s,o=new URI(n),a={};return"null"!==typeOf(o.parsed.query)&&(queryObj=o.parsed.query.parseQueryString(),Object.each(queryObj,function(e,t){"array"===typeOf(e)&&(queryObj[t]=e[e.length-1])}),a=Object.toQueryString(queryObj)),o.parsed.query="",t=o.toString(),t="null"!==typeOf(o.parsed.scheme)?t.replace(o.parsed.scheme+"://",""):t,t="null"!==typeOf(o.parsed.host)?t.replace(o.parsed.host,""):t,t="null"!==typeOf(o.parsed.port)?t.replace(":"+o.parsed.port,""):t,t=-1===t.indexOf(i)?i+"?"+t:t,t=("/"===t.charAt(0)?t.substring(1):t)+"?"+decodeURIComponent(Object.toQueryString(a)),t=Affinity.isTeampayoffice&&!Affinity.isTeampayofficeBranch&&-1===t.indexOf("timesheets")?"/timesheets/"+t:t,t=Affinity.isTeampayofficeBranch&&-1===t.indexOf("tb")?"/tb/"+t:t,t=t.replace(new RegExp("//","g"),"/"),t=t.replace("??","?"),t=t.replace("?/","?")},Affinity.ProcessUrlObj=function(e,t){var i,s;return t="null"!==typeOf(t)?t:{},s=t.parseQueryString(),Object.each(s,function(e,t){"array"===typeOf(e)&&(s[t]=e[e.length-1])}),t=Object.toQueryString(s),e.parsed.query="",e.parsed.directory=Affinity.isTeampayoffice&&new RegExp("timesheets/","i").test(e.parsed.directory)?e.parsed.directory.replace(new RegExp("timesheets/","i"),""):e.parsed.directory,e.parsed.directory=Affinity.isTeampayofficeBranch&&new RegExp("tb/","i").test(e.parsed.directory)?e.parsed.directory.replace(new RegExp("tb/","i"),""):e.parsed.directory,e.parsed.directory=e.parsed.directory.replace(new RegExp("//","g"),"/"),i=e.toString(),i="null"!==typeOf(e.parsed.scheme)?i.replace(e.parsed.scheme+"://",""):i,i="null"!==typeOf(e.parsed.host)?i.replace(e.parsed.host,""):i,i="null"!==typeOf(e.parsed.port)?i.replace(":"+e.parsed.port,""):i,i=-1===i.indexOf("/_Api/Zelos")?"/_Api/Zelos?"+i:i,i=("/"===i.charAt(0)?i.substring(1):i)+"?"+decodeURIComponent(Object.toQueryString(t)),i=Affinity.isTeampayoffice&&!Affinity.isTeampayofficeBranch&&-1===i.indexOf("timesheets")?"/timesheets/"+i:i,i=Affinity.isTeampayofficeBranch&&-1===i.indexOf("tb")?"/tb/"+i:i,i=i.replace(new RegExp("//","g"),"/"),i=i.replace("??","?"),i=i.replace("?/","?")},Locale.define("en-NZ","Date",{dateOrder:["date","month","year","/"],shortDate:"%D/%M/%Y",shortTime:"%I:%M%p",AM:"am",PM:"pm"}).inherit("en-US","Date"),Locale.define("en-AU").inherit("en-NZ","Date"),Locale.use("en-NZ"),Date.implement({toZelos:function(){return Date.parse(this.format("%d/%m/%Y %H:%M:%S")).format("%Y-%m-%dT%H:%M:%S")},toTime:function(){try{return this.format("%k:%M:%S")}catch(e){return"Invalid Date"}},toTime24:function(){this.toTime()},toTime12:function(){try{return this.format("%l:%M:%S %p").toLowerCase()}catch(e){return"Invalid Date"}},toSimple:function(){try{return this.format("%d-%m-%Y")}catch(e){return"Invalid Date"}},toSimpleDateTime:function(){try{return this.format("%d-%m-%Y %k:%M:%S")}catch(e){return"Invalid Date"}},toServer:function(){try{return this.format("%d.%m.%Y %k:%M:%S %z")}catch(e){return"Invalid Date"}},toFriendly:function(){try{return this.format("%A %B %e%o %Y").replace(/  /gi," ")}catch(e){return"Invalid Date"}},toFriendlyShort:function(){try{return this.format("%a %b %e%o %Y").replace(/  /gi," ")}catch(e){return"Invalid Date"}},toWords:function(){try{return this.timeDiffInWords()}catch(e){return"Invalid Date"}},toWordsShort:function(){try{return this.timeDiffInWords().replace(/year/g,"yr").replace(/month/g,"mnth").replace(/hour/g,"hr").replace(/minute/g,"min").replace(/second/g,"sec").replace(/about/g,"")}catch(e){return"Invalid Date"}},matches:function(e,t,i){if("null"!==typeOf(e)){var s=Date.parse(this),n=Date.parse(e);if(s&&n&&"date"==typeOf(s)&&"date"===typeOf(n)&&s.isValid()&&n.isValid()&&("boolean"===typeOf(t)&&t&&(s=s.setSeconds(0),n=n.setSeconds(0)),"boolean"===typeOf(i)&&i&&(s=s.setMilliseconds(0),n=n.setMilliseconds(0)),s=s.getTime(),n=n.getTime(),s===n))return!0}return!1},elapsed:function(){return((new Date).getTime()-this.getTime())/1e3},sameDay:function(e){if("null"!==typeOf(e)){var t=Date.parse(this),i=Date.parse(e);if(t&&i&&"date"==typeOf(t)&&"date"===typeOf(i)&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t===i))return!0}return!1},lessThan:function(e){if("null"!==typeOf(e)){var t=Date.parse(this),i=Date.parse(e);if(t&&i&&"date"==typeOf(t)&&"date"===typeOf(i)&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t<i))return!0}return!1},lessThanOrEqualTo:function(e){if("null"!==typeOf(e)){if(this.sameDay(e))return!0;if(this.lessThan(e))return!0}return!1},greaterThan:function(e){if("null"!==typeOf(e)){var t=Date.parse(this),i=Date.parse(e);if(t&&i&&"date"==typeOf(t)&&"date"===typeOf(i)&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t>i))return!0}return!1},greaterThanOrEqualTo:function(e){if("null"!==typeOf(e)){if(this.sameDay(e))return!0;if(this.greaterThan(e))return!0}return!1}}),Date.defineFormat("zelos",function(e){return e.toZelos()}),Date.CurentYear=(new Date).get("year"),Date.FormatStrings=[["christmas","12.25."+(Date.CurentYear+1)],["xmas","12.25."+(Date.CurentYear+1)],["newyear","1.1."+(Date.CurentYear+1)],["new year","1.1."+(Date.CurentYear+1)]],Date.TimeTravel=[["second",/(\+|\-)\s*[0-9]+( )*(seconds|second|sec|s)/],["minute",/(\+|\-)\s*[0-9]+( )*(minutes|minute|min|m)/],["hour",/(\+|\-)\s*[0-9]+( )*(hours|hour|h)/],["day",/(\+|\-)\s*[0-9]+( )*(days|day|d)/],["week",/(\+|\-)\s*[0-9]+( )*(weeks|week|w)/],["month",/(\+|\-)\s*[0-9]+( )*(months|month)/],["year",/(\+|\-)\s*[0-9]+( )*(years|year|y)/]],String.implement({toDate:function(){Locale.use("en-GB");var e,t,i,n;if(s=this.toLowerCase().trim(),"now"===s)return new Date;for(s.contains("now ")&&(s=s.replace(/(now |today )/,(new Date).format("%k:%H:%S "))),/^\d+$/.test(s)&&s.length>=6&&(s=s.length>8?1e3*parseInt(s,10)+"":s.substr(0,2)+"."+s.substr(2,2)+"."+s.substr(4)),e=0;e<Date.FormatStrings.length;e++)if(s.contains(Date.FormatStrings[e][0])){s=s.replace(Date.FormatStrings[e][0],Date.FormatStrings[e][1]);break}for(e=0;e<Date.TimeTravel.length;e++)s.test(Date.TimeTravel[e][1])&&(t=s.match(Date.TimeTravel[e][1])[0],i=t.match(/[0-9]+/)[0],t.indexOf("+")&&(n=Date.parse(s.replace(t,"").trim()).decrement(Date.TimeTravel[e][0],parseFloat(i))),t.indexOf("-")&&(n=Date.parse(s.replace(t,"").trim()).increment(Date.TimeTravel[e][0],parseFloat(i))));n=null==n?Date.parse(s):n;try{return 0==n.format("%s")?"Invalid Date":n}catch(e){return"Invalid Date"}}}),Object.valueFromKeyString=function(e,t){try{t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,"");for(var i=t.split("."),s=0,n=i.length;s<n;++s){var o=i[s];if(!(o in e))return!1;e=e[o]}return e}catch(e){return null}},Array.implement({mapFromKey:function(e){if(this.length>0&&e in this[0])return this.reduce(function(t,i,s){return t[i[e]]=i,t},{})}}),JSON.Unauthorized=function(e,t){var i=!1,s=typeOf(e);return"object"!==s&&"array"!==s||(e=JSON.encode(e),s="string"),"string"===s&&(e.test("unauthorized","gi")||e.test("unauthorised","gi")||e.test("/(401/)","gi")||e.test("/(403/)","gi"))&&(log("&#x270B; json response is unauthorized"+(null!==typeOf(t)?" ("+unescape(t)+")":"")+" &#x270B;"),log(JSON.stringify(e,null,2)),log("&#x270B; END json response is unauthorized log &#x270B;"),window.prompts&&Affinity.prompts.hide(),window.fireEvent("unauthorized"),i=!0),e=null,i},Element.implement({hasWidget:function(e){return!!this.retrieve(e)},getWidget:function(e){return this.retrieve(e)?this.retrieve(e):!!this.retrieve("widget")&&this.retrieve("widget")},destroyWidget:function(e){var t=this.getWidget(e);return t&&"destroy"in t&&t.destroy(),delete t,null},exists:function(){try{if(document.contains(this))return this}catch(e){}return!1}}),DOMEvent.implement({getTarget:function(e){return this.target.hasClass(e)?this.target:this.target.get("id")===e?this.target:this.target.getParent("."+e)?this.target.getParent("."+e):this.target.getParent("#"+e)?this.target.getParent("#"+e):this.target}}),Element.implement({hasEvent:function(e,t){var i=this.retrieve("events");switch(i&&i[e]&&(void 0==t||i[e].keys.contains(t))){case null:case!1:case void 0:case 0:return!1;default:return!0}}}),Affinity.FormElement=new Class({Implements:[Options,Events],Binds:["clearEvents","setEvents","sanatiseValue","cloneValue","setValue","getValue","getDisplayValue","checkChanged","lookup","lookupComplete","destroy"],options:{},element:!1,dynamicContents:!1,dynamicFirstLoad:!0,defaultValue:"",valueEmpty:!1,changed:!1,initialize:function(e,t){this.setOptions(t),this.element=e,e.retrieve("defaultValue")||(this.element=e,this.setEvents(),this.defaultValue=this.sanatiseValue(e.value),this.element.store("defaultValue",this.defaultValue)),this.element.store("widget",this),this.element.store("elementWidget",this),this.element.addClass("widget"),this.element.value=this.sanatiseValue(this.element.value),this.lastValue=this.element.value},reset:function(){this.changed=!0,this.defaultValue=this.sanatiseValue(this.element.value),this.lastValue=this.element.value,this.element.store("defaultValue",this.defaultValue),this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:null}),this.element.addClass("changed").removeClass("restored")},clearEvents:function(){this.element.removeEvent("input",this.checkChanged),this.element.removeEvent("lookup",this.lookup),this.element.removeEvent("lookupComplete",this.lookupComplete),this.element.removeEvent("change",this.checkChanged),this.element.removeEvent("blur",this.checkChanged)},setEvents:function(){this.clearEvents(),this.element.get("list")?this.element.addEvent("input",this.checkChanged):(this.element.addEvent("lookup",this.lookup),this.element.addEvent("lookupComplete",this.lookupComplete),this.element.addEvent("change",this.checkChanged),this.element.addEvent("blur",this.checkChanged))},sanatiseValue:function(e){try{return null===e||void 0===e||""===e.trim()?"":e}catch(t){return e}},cloneValue:function(e){return(e+"").trim()},getValue:function(){return this.element.value},setValue:function(e){this.element.value=this.sanatiseValue(e),this.defaultValue=this.element.value,this.lastValue=this.element.value,this.element.store("defaultValue",this.defaultValue),this.element.removeClass("changed").removeClass("restored"),this.changed=!1},getDisplayValue:function(){return this.element.value},checkChanged:function(e){var t;return t="null"!==typeOf(e)&&"null"!==typeOf(e.target)?e.target.value:this.sanatiseValue(this.element.value),this.cloneValue(t)!==this.cloneValue(this.defaultValue)?(this.changed=!0,this.lastValue===this.element.value&&(this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:e}),this.element.addClass("changed").removeClass("restored")),this.lastValue=this.element.value):(this.changed=!1,this.element.fireEvent("restored",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"restored",originalEvent:e}),this.lastValue=this.element.value,this.element.addClass("restored").removeClass("changed")),this.changed},lookup:function(){this.dynamicContents=!0},lookupComplete:function(e){this.dynamicFirstLoad&&(this.defaultValue=e.defaultValue,this.element.store("defaultValue",this.defaultValue),this.dynamicFirstLoad=!1),this.checkChanged({target:this.element})},destroy:function(){this.clearEvents(),this.element.eliminate("defaultValue"),this.element.eliminate("elementWidget")}}),Element.implement({makeFormElement:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.FormElement(this),this}}),Affinity.ElementValueTracker=new Class({Implements:[Options,Events],Binds:["__removeEvents","__addEvents","__elementChanged","__elementBlured","__doChangeCheck","__doChangeCheckThrottled","__lookupComplete","addElement","removeElement","setValue","hasChanged","hasRestored","getValue","getDefault","getLast","changeStatus"],options:{},elements:[],values:[],valuesDefault:[],valuesLast:[],id:!1,initialize:function(e){this.id=String.uniqueID(),e&&!e.hasClass("has-change-tracker")&&this.addElement(e)},__removeEvents:function(e){e.removeEvent("change",this.__elementChanged),e.removeEvent("blur",this.__elementBlured)},__addEvents:function(e){e.addEvent("change",this.__elementChanged),e.addEvent("blur",this.__elementBlured)},__cloneValue:function(e){var t="number"===typeOf(e),i=(e+"").trim();return t?parseFloat(i):i},__sanatiseValue:function(e){try{return null===e||void 0===e||""===e.trim()?"":e}catch(t){return e}},__isSame:function(e,t){return(e+"").trim().toLowerCase()===(t+"").trim().toLowerCase()},__doChangeCheck:function(e){clearTimeout(this.__doChangeCheckThrottle),this.__doChangeCheckThrottle=this.__doChangeCheckThrottled.delay(100,this,[e])},__doChangeCheckThrottle:!1,__doChangeCheckThrottled:function(e){if(e&&["object","event","domevent"].contains(typeOf(e))&&"target"in e&&this.elements.indexOf(e.target)>-1){var t,i;Array.each(this.elements,function(e,s){t=i=!1,this.values[s]=this.__sanatiseValue(e.value),this.__isSame(this.values[s],this.valuesDefault[s])?i=!0:t=!0,e.removeClass("cant-select-default"),t&&(e.removeClass("value-restored").addClass("value-changed"),e.fireEvent("ElementChanged",{value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]}),this.fireEvent("ElementChanged",{value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]}),window.fireEvent("AnElementChanged",{target:this.elements[s],value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]}),this.values[s]!==this.valuesDefault[s]&&(e.get("class").test(new RegExp("dependencies","gi"))||e.get("class").test(new RegExp("lookup","gi")))&&e.addClass("cant-select-default")),i&&(e.removeClass("value-changed").addClass("value-restored"),e.fireEvent("ElementRestored",{value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]}),this.fireEvent("ElementRestored",{value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]}),window.fireEvent("AnElementRestored",{target:this.elements[s],value:this.values[s],last:this.valuesLast[s],default:this.valuesDefault[s]})),this.valuesLast[s]=this.values[s]}.bind(this))}},__elementChanged:function(e){this.__doChangeCheck(e)},__elementBlured:function(e){this.__doChangeCheck(e)},__lookupComplete:function(e){this.__doChangeCheck.delay(500,this,[e])},addElement:function(e){if(!e.retrieve("changetracker")){var t="value"in e?e.value:"",i=e.get("data-default-value")?e.get("data-default-value"):t;-1===this.elements.indexOf(e)?(this.elements.push(e),this.values.push(t),this.valuesDefault.push(i),this.valuesLast.push(t),this.__removeEvents(e),this.__addEvents(e),e.addEvent("lookupComplete",this.__lookupComplete),e.addClass("has-change-tracker"),e.store("changetracker",this)):this.setValue(e,t)}},removeElement:function(e){if(-1!==this.elements.indexOf(e)){var t=this.elements.indexOf(e);this.elements.splice(t,1),this.values.splice(t,1),this.valuesLast.splice(t,1),this.valuesDefault.splice(t,1),this.__removeEvents(e),e.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),e.eliminate("changetracker")}},setValue:function(e,t){if(-1!==this.elements.indexOf(e)){var i=this.elements.indexOf(e);e.value=t,e.removeClass("value-restored").removeClass("value-changed"),this.values[i]=t,this.valuesDefault[i]=t,this.valuesLast[i]=t,this.__removeEvents(e),this.__addEvents(e)}else this.addElement(e)},hasChanged:function(){var e=!1;return Array.each(this.elements,function(t,i){t.hasClass("value-changed")&&(e=!0),this.__isSame(this.values[i],this.valuesDefault[i])||(e=!0)}.bind(this)),e},hasRestored:function(){var e=!1;return Array.each(this.elements,function(t){t.hasClass("value-restored")&&(e=!0)}.bind(this)),e},getValue:function(e){var t=e||this.elements[0],i=this.elements.indexOf(t);if(-1!==i)return this.values[i];throw new Error("Target element not tracked")},getDefault:function(e){var t=e||this.elements[0],i=this.elements.indexOf(t);if(-1!==i)return this.valuesDefault[i];throw new Error("Target element not tracked")},getLast:function(e){var t=e||this.elements[0],i=this.elements.indexOf(t);if(-1!==i)return this.valuesLast[i];throw new Error("Target element not tracked")},changeStatus:function(){return{changed:this.hasChanged(),restored:this.hasRestored(),values:this.values,last:this.valuesLast,defaults:this.valuesDefault}},destroy:function(){Array.each(this.elements,function(e){this.__removeEvents(e),e.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),e.eliminate("changetracker")}.bind(this))}}),Element.implement({addChangeTracker:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.ElementValueTracker(this),this},hasChanged:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").hasChanged()},getTrackedValue:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getValue(this)},getTrackedDefault:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getDefault(this)},getTrackedLast:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getLast(this)},fireTrackedChange:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").__elementChanged({target:this}),this.retrieve("changetracker").getValue(this)}}),Element.implement({exists:function(){try{if(document.body.contains(this)||this.ownerDocument&&this.ownerDocument.body.contains(this))return this}catch(e){return!1}return!1}}),Element.Events.added={onAdd:function(){this.exists()?this.fireEvent("exists",this):(this.store("_exists_method",function(){this.exists()&&(clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method"),this.fireEvent("exists",this))}),this.store("_exists_timer",this.retrieve("_exists_method").periodical(100,this)))},onRemove:function(){clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method")}},Element.Events.removed={onAdd:function(){this.exists()?(this.store("_not_exists_method",function(){this.exists()||(clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_timer"),this.eliminate("_not_exists_method"),this.fireEvent("notexists",!0))}),this.store("_not_exists_timer",this.retrieve("_not_exists_method").periodical(1e3,this))):this.fireEvent("notexists",!0)},onRemove:function(){clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_method"),this.eliminate("_not_exists_method")}},String.prototype.soundex=function(e,t){var s,n,o,a,r,l=this,h="";for(l=l.toUpperCase(),h=l,h=h.replace(/[^A-Z]/gi," "),h=h.replace(/^\s*/g,""),h=h.replace(/\s*$/g,""),h=h.replace(/^GH/g,"G"),h=h.replace(/DG/g,"G"),h=h.replace(/GH/g,"H"),h=h.replace(/GN/g,"N"),h=h.replace(/KN/g,"N"),h=h.replace(/PH/g,"F"),h=h.replace(/MP([STZ])/g,"M$1"),h=h.replace(/^PS/g,"S"),h=h.replace(/^PF/g,"F"),h=h.replace(/MB/g,"M"),h=h.replace(/TCH/g,"CH"),r=h.substr(0,1),"H"!=r&&"W"!=r||(h="-"+h.substr(1)),h=h.replace(/[AEIOUYHW]/g,"0"),h=h.replace(/[BPFV]/g,"1"),h=h.replace(/[CSGJKQXZ]/g,"2"),h=h.replace(/[DT]/g,"3"),h=h.replace(/[L]/g,"4"),h=h.replace(/[MN]/g,"5"),h=h.replace(/[R]/g,"6"),a=h.length,o="",s="",i=0;i<a;i++)n=h.charAt(i),n==o?s+=" ":(s+=n,o=n);return h=s,h=h.substr(1),h=h.replace(/\s/g,""),h=h.replace(/0/g,""),h+="0000000000",h=r+h,h=h.substr(0,5)},String.prototype.distance=function(e){var t=this.toLowerCase(),i=e.toLowerCase();if(0===t.length)return i.length;if(0===i.length)return t.length;var s,n=[];for(s=0;s<=i.length;s++)n[s]=[s];var o;for(o=0;o<=t.length;o++)n[0][o]=o;for(s=1;s<=i.length;s++)for(o=1;o<=t.length;o++)i.charAt(s-1)==t.charAt(o-1)?n[s][o]=n[s-1][o-1]:n[s][o]=Math.min(n[s-1][o-1]+1,Math.min(n[s][o-1]+1,n[s-1][o]+1));return n[i.length][t.length]},"null"==typeOf(File))var File={};if("null"==typeOf(Request))var File={};File.Upload=new Class({Implements:[Options,Events],options:{onComplete:function(){}},initialize:function(e){var t=this;this.setOptions(e),this.uploadReq=new Request.File({onComplete:function(){t.fireEvent("complete",arguments),this.reset()}}),this.options.data&&this.data(this.options.data),this.options.images&&this.addMultiple(this.options.images)},data:function(e){var t=this;this.options.url.indexOf("?")<0&&(this.options.url+="?"),Object.each(e,function(e,i){"?"!=t.options.url.charAt(t.options.url.length-1)&&(t.options.url+="&"),t.options.url+=encodeURIComponent(i)+"="+encodeURIComponent(e)})},addMultiple:function(e){var t=this;e.each(function(e){t.add(e)})},add:function(e){if("null"!==typeOf(e)){var e=document.id(e),t=(e.get("name"),e.files[0]);this.uploadReq.append("fileData",t)}},addPostData:function(e){this.uploadReq.addPostData(e)},send:function(e){e&&this.add(e),this.uploadReq.send({url:this.options.url})}}),Request.File=new Class({Extends:Request,options:{emulation:!1,urlEncoded:!1},initialize:function(e){this.xhr=new Browser.Request,this.formData=new FormData,
this.setOptions(e),this.headers=this.options.headers},append:function(e,t){return this.formData.append(e,t),this.formData},addPostData:function(e){var t=this;Object.each(e,function(e,i){t.formData.append(i,e)})},reset:function(){this.formData=new FormData},send:function(e){var t=e.url||this.options.url;this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0;var i=this.xhr;return i.open("POST",t,!0),i.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,function(e,t){try{i.setRequestHeader(t,e)}catch(i){this.fireEvent("exception",[t,e])}},this),this.fireEvent("request"),i.send(this.formData),this.options.async||this.onStateChange(),this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)),this}}),Affinity.Shake=new Class({Implements:Options,options:{distance:4,duration:50,transition:Fx.Transitions.Sine.easeInOut,loops:2},initialize:function(e,t){this.setOptions(t),this.element=e,this.tween=new Fx.Tween(this.element,{link:"chain",duration:this.options.duration,transition:this.options.transition,property:"margin-left"})},shake:function(){var e=this.options.distance;for(this.loops=0;this.loops<this.options.loops;this.loops++)this.tween.start("left",e).start("left",-e),this.tween.start("left",e).start("left",0);delete e},stop:function(){this.loops=this.options.loops,this.tween.cancel(),this.element.setStyle("margin-left",0)}}),window.addEvent("UiReady",function(){Affinity.oldess&&Affinity.oldessFrame&&Affinity.agent.contains("Chrome")&&Affinity.agent.contains("Windows NT 6.2")&&window.addEvent("click",function(){document.getElement("body").className.contains("redraw")?(document.getElement("body").setStyle("width","100%"),document.getElement("body").className="newui"):(document.getElement("body").setStyle("width","99.9%"),document.getElement("body").className="newui redraw")}),void 0!==window.masterMessage&&Affinity.isie&&Affinity.ieversion<9&&masterMessage({message:'<strong class="color red large">Warning!</strong><br /><br />We do not support Internet Explorer 8 and less.<br />Some functionality may not work.<br /><br />We recommend <a href="https://www.google.com/chrome/browser/desktop/" target="_blank" class="color green">Chrome</a> or updating to at least IE9.<br /><br />Continue at your own risk.',okText:"Accept and Continue"})}),Affinity.PageReady=function(){window.removeEvent("PageReady",Affinity.PageReady),Affinity.apiversion>1?(Affinity.zelosroot=Affinity.zelosroot,Affinity.lookupapi=Affinity.zelosroot+"?api=Lookup/Get"):Affinity.lookupapi=Affinity.zelosroot+"?api=Lookup/Get",document.documentMode&&8==document.documentMode&&document.getElement("body").addClass("ie8"),Affinity.mobile;var e=document.body.classList;Affinity.ismac=!!e.contains("mac"),Affinity.isie=!!e.contains("ie"),Affinity.isEdge=e.contains("ieedge"),Affinity.isie&&(Affinity.ieversion=Browser.version),Affinity.isie&&(Affinity.iedocmode=!!document.documentMode&&document.documentMode),Affinity.ismobile=!!e.contains("mobile"),Affinity.mobile&&(Affinity.ismobile=!0),Affinity.isTeampayoffice=-1!==window.location.href.toLowerCase().indexOf("teampayoffice"),Affinity.isTeampayofficeBranch=!!Affinity.isTeampayoffice&&-1!==window.location.href.toLowerCase().indexOf("/tb"),Affinity.refreshControll={},Affinity.refreshControll.initialLoad=!0,Affinity.refreshControll.lastRefresh=(new Date).getTime(),window.addEvent("keydown",function(e){if("f5"===e.key||"F5"===e.key||e.control&&("r"===e.key||"R"===e.key)){var t=(new Date).getTime(),i=Affinity.refreshControll.initialLoad?7e3:5e3;t-Affinity.refreshControll.lastRefresh<i&&(e.stop(),uialert({message:"Refreshing this often can slow things down.<br />If you believe the page is not responding,<br />please contact Affinity Help desk.",showButtons:!0})),Affinity.refreshControll.lastRefresh=(new Date).getTime(),Affinity.refreshControll.initialLoad=!1}}),Affinity&&Affinity.isie&&Affinity.ieversion<9&&document.addEvent("keydown",function(e){8!=e.key&&"backspace"!==e.key||(e.target.get("tag").test("select","gi")||e.target.disabled||e.target.readOnly)&&e.preventDefault()}),window.addEvent("userComplete",function(e){document.getElements(".displayname").set("html",e.commonName?e.commonName:e.displayName?e.displayName:"")});try{parent&&"parentFrameResize"in parent&&(window.addEvent("ResizeFrame",function(){if(document.getElement(".content")){var e=document.getElement(".content"),t=e.getScrollSize();if(parent&&"parentFrameResize"in parent&&window.parent.window!==window){var i=window.parent.window.innerWidth?window.parent.window.innerWidth-70:window.parent.window.document.body.offsetWidth-70;t.x=i&&i>0?i:1e3,parent.parentFrameResize({x:t.x,y:t.y+100})}}}),window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500))}catch(e){}},window.addEvent("PageReady",Affinity.PageReady),window.addEvent("load",function(){(function(){Affinity.disableAutoPageReady||Affinity.uiready||window.fireEvent("PageReady")}).delay(1e3,this)}),Affinity.log=!0,Affinity.user=null,Affinity.prettyuploads=!0,Affinity.selectToAutoNum=0,Affinity.selectmax=2e3,Affinity.enableSelectLimit=!0,Affinity.useWebWorkers=!1,Affinity.enableFavourites=!1,Affinity.disableAutoPageReady=!1,window.config=document.config=Affinity;var UIAddress=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),window.googleAddressAutocompletes||(window.googleAddressAutocompletes={},window.googleAddressApiScripts=!1,window.googleAddressWidgetCount=0),window.googleAddressStartTime=(new Date).getTime(),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-address"),this.process)},process:function(e){(function(){e.removeClass("ui-address"),new UIAddressWidget({element:e,index:window.googleAddressWidgetCount}),window.googleAddressWidgetCount++}).delay(250*window.googleAddressWidgetCount)}}),UIAddressWidget=new Class({Implements:[Options,Events],Binds:["revert","destroy","findComponent","getCityFromLatLong","getClosestLocation","clearValues","updatePropertyValue","fillInAddress","loadScript","addressInit","getPlaceFromValue","setPlaceValues","mainAddressFocus","mainAddressBlur","checkForError","setPlaceValuesEvent","getCityFromLatLongEvent","fireCityFromLatLong"],options:{element:null,index:0},element:null,index:0,type:"address",uuid:"",place:!1,initialize:function(e){if(this.setOptions(e),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.apikey="AIzaSyDX7vRyaNWfkZQfj0xx9Kthii3HBXk5DGc",this.originalElement=this.options.element,this.disabled=!!this.originalElement.get("disabled"),this.uuid=String.uniqueID(),this.index=this.options.index,this.element=new Element("div",{class:"addressbox ui-validate","data-validate-method":"address"}).inject(this.options.element,"before"),window.googleAddressAutocompletes["address_"+this.uuid]=this,this.options.element.removeClass("ui-address").addClass("ui-address-done full-address"),this.addressinput=new Element("input",{class:"googleAddress",type:"text",id:"googleAddress_"+this.uuid,placeholder:"Enter your address to fill the fields below"}).inject(this.element,"top"),this.errorIcon=new Element("span",{class:"addressbox-error-icon icon-warning ui-has-tooltip hidden","data-tooltip":"This is not a valid Address"}).inject(this.element),this.addressComponentWrapper=new Element("div").set("reveal",{duration:250,transition:Fx.Transitions.Sine.easeInOut}).inject(this.element).toggle(),this.addressNumber=new Element("input",{class:"number",type:"text",id:"street_number_"+this.uuid,placeholder:"Number",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Number"'}).inject(this.addressComponentWrapper),this.addressStreet=new Element("input",{class:"street",type:"text",id:"street_address_"+this.uuid,placeholder:"Street",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Street"'}).inject(this.addressComponentWrapper),this.addressSuburb=new Element("input",{class:"suburb",type:"text",id:"suburb_"+this.uuid,placeholder:"Suburb",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Suburb"'}).inject(this.addressComponentWrapper),this.addressCity=new Element("input",{class:"city",type:"text",id:"city_"+this.uuid,placeholder:"City",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "City"'}).inject(this.addressComponentWrapper),this.addressState=new Element("input",{class:"state",type:"text",id:"state_"+this.uuid,placeholder:"State",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "State"'}).inject(this.addressComponentWrapper),this.addressCountry=new Element("input",{class:"country",type:"text",id:"country_"+this.uuid,placeholder:"Country",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Country"'}).inject(this.addressComponentWrapper),this.addressPostcode=new Element("input",{class:"postcode",type:"text",id:"postal_code_"+this.uuid,placeholder:"Postcode",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Postcode"'}).inject(this.addressComponentWrapper),this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.subhiddenaddress1=new Element("input",{class:"address1 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress2=new Element("input",{class:"address2 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress3=new Element("input",{class:"address3 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress4=new Element("input",{class:"address4 validate ui-address-done"}).inject(this.hiddenWrapper),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before"),this.loadScript(),this.disabled?this.addressinput.addClass("hidden"):(this.addressNumber.addEvent("keyup",this.updatePropertyValue),this.addressStreet.addEvent("keyup",this.updatePropertyValue),this.addressSuburb.addEvent("keyup",this.updatePropertyValue),this.addressCity.addEvent("keyup",this.updatePropertyValue),this.addressState.addEvent("keyup",this.updatePropertyValue),this.addressCountry.addEvent("keyup",this.updatePropertyValue),this.addressPostcode.addEvent("keyup",this.updatePropertyValue),this.addressinput.addEvent("focus",this.mainAddressFocus),this.addressinput.addEvent("blur",this.mainAddressBlur)),Affinity.tooltips.processNew()},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.addressNumber.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressStreet.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressSuburb.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressCity.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressState.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressCountry.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressPostcode.removeEvent("keyup",this.updatePropertyValue).destroy(),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()},findComponent:function(e,t){for(var i=!1,s=0;s<e.length;s++)if("address_components"in e[s])for(var n=0;n<e[s].address_components.length;n++)if(e[s].address_components[n].types.contains(t)){i=e[s].address_components[n];break}return i},getLatLong:function(e){var t=[];return Object.each(e,function(e,i){"function"===typeOf(e)?t.push(this.place.geometry.location[i]()):typeOf("object"!==e)&&t.push(e)}.bind(this)),t.slice(0,2)},fireCityFromLatLong:function(e,t){(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(e,t)},function(i,s){s==google.maps.GeocoderStatus.OK?this.fireEvent("gotCity",{uuid:this.uuid,city:this.findComponent(i,"colloquial_area")}):"OVER_QUERY_LIMIT"==s&&("warn"in console&&console.warn(this.index+' received google status in "fireCityFromLatLong" with "'+s+'"'),this.fireCityFromLatLong.delay(500,this,[e,t]))}.bind(this))},getCityFromLatLong:function(e,t){this.addEvent("gotCity",this.getCityFromLatLongEvent),this.fireCityFromLatLong(e,t)},getCityFromLatLongEvent:function(e){e.uuid===this.uuid&&(this.removeEvent("gotCity",this.getCityFromLatLongEvent),this.place.address_components.push(e.city),this.setPlaceValues())},getPlaceFromValue:function(e){var t;try{if(t=JSON.parse(e),t.street){var i=t.street.indexOf(" ");this.addressNumber.value=t.street.substring(0,i),this.addressStreet.value=t.street.substring(i+1,t.street.length)}this.addressSuburb.value=t.suburb?t.suburb:"",this.addressCity.value=t.city?t.city:"",this.addressState.value=t.state?t.state:"",this.addressCountry.value=t.country?t.country:"",this.addressPostcode.value=t.postcode?t.postcode:""}catch(s){t=e.split(",");var i=t[0].indexOf(" ");switch(this.addressNumber.value=t[0].substring(0,i),this.addressStreet.value=t[0].substring(i+1,t[0].length),this.addressSuburb.value=t[1],this.addressCountry.value=t[4]?t[4]:"",this.addressPostcode.value=t[3],this.addressCountry.value){case"New Zealand":this.addressCity.value=t[2];break;case"Australia":this.addressState.value=t[2];break;default:this.addressCity.value=t[2]}}},clearValues:function(){this.addressNumber.value="",this.addressStreet.value="",this.addressSuburb.value="",this.addressCity.value="",this.addressState.value="",this.addressCountry.value="",this.addressPostcode.value=""},setPlaceValues:function(){this.values={},Array.each(this.place.address_components,function(e){try{this.values[e.types[0]]={},this.values[e.types[0]].long=e.long_name,this.values[e.types[0]].short=e.short_name}catch(e){}}.bind(this)),this.countryCode=!1;var e=this.findComponent([this.place],"country");if(e&&(this.countryCode=e.short_name),this.countryCode&&""!=this.countryCode){var t=this.getLatLong(this.place.geometry.location);t.length>=2&&!isNaN(t[0])&&!isNaN(t[1])&&(this.addEvent("gotCity",this.setPlaceValuesEvent),this.fireCityFromLatLong(t[0],t[1]))}},setPlaceValuesEvent:function(e){if(e.uuid===this.uuid){if(this.removeEvent("gotCity",this.setPlaceValuesEvent),e&&"city"in e)try{this.values[e.city.types[0]]={},this.values[e.city.types[0]].long=e.city.long_name,this.values[e.city.types[0]].short=e.city.short_name}catch(e){}switch(this.countryCode){case"AU":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.locality?this.values.locality.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.colloquial_area?this.values.colloquial_area.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"NZ":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value="",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"GB":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value=this.values.administrative_area_level_2?this.values.administrative_area_level_2.long:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code_prefix?this.values.postal_code_prefix.long:"";break;case"US":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;default:this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:""}this.updatePropertyValue()}},mainAddressFocus:function(e){this.addressinput.set("placeholder","")},mainAddressBlur:function(e){this.addressinput.set("placeholder","Enter your address to fill the fields below"),this.checkForError()},checkForError:function(){var e=[this.addressNumber.value+" "+this.addressStreet.value,this.addressSuburb.value],t=[this.addressCity.value,this.addressState.value,this.addressCountry.value,this.addressPostcode.value];""===Array.clone(e).combine(Array.clone(t)).join("").trim()||""===e.join("").trim()?this.errorIcon.removeClass("hidden"):this.errorIcon.addClass("hidden")},addressInit:function(){if(!document.id("googleAddress_"+this.uuid))throw"target google autocomplete input can not be found";if(!("google"in window&&"maps"in window.google))throw"google maps implementation cannot be found";if("maps"in Affinity.UI||(Affinity.UI.maps={}),!("autocompleteBounds"in Affinity.UI.maps)){Affinity.UI.maps.autocompleteBounds=!1;var e=new google.maps.LatLng(-36.847605,174.7485493),t=new google.maps.Circle({center:e,radius:15});Affinity.UI.maps.autocompleteBounds=t.getBounds()}this.disabled||document.id("googleAddress_"+this.uuid).set("disabled",null),this.addressComponentWrapper.reveal();var i;document.config.ismobile||(document.id("googleAddress_"+this.uuid).set("autocomplete","off"),new Element("input",{type:"text",name:"address_fake_"+this.uuid,id:"address_fake_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before"),new Element("input",{type:"text",name:"prevent_autofill_"+this.uuid,id:"prevent_autofill_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before")),i=new google.maps.places.Autocomplete(document.id("googleAddress_"+this.uuid),{types:["geocode"],componentRestrictions:{country:["nz","au"]}}),"null"!==typeOf(window.autocompleteBounds)&&i.setBounds(Affinity.UI.maps.autocompleteBounds),google.maps.event.addListener(i,"place_changed",function(){this.clearValues(),this.place=i.getPlace();var e=document.id("googleAddress_"+this.uuid).value.trim();axios.get("https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key="+this.apikey).then(function(e){e.hasOwnProperty("data")&&e.data.hasOwnProperty("results")&&(this.place=e.data.results[0],this.setPlaceValues())}.bind(this)).catch(function(e){console.log(e)})}.bind(this));var s=document.id("subhidden_"+this.uuid).getElement(".full-address").value;"null"!==typeOf(s)&&"string"===typeOf(s)&&""!==s.trim()&&this.getPlaceFromValue(s),this.updatePropertyValue()},updatePropertyValue:function(){var e=JSON.stringify({street:this.addressNumber.value+" "+this.addressStreet.value,suburb:this.addressSuburb.value,city:this.addressCity.value,state:this.addressState.value,country:this.addressCountry.value,postcode:this.addressPostcode.value});document.id("subhidden_"+this.uuid).getElement(".full-address").value=e,this.checkForError()},isGoogleApiready:function(){return"google"in window&&"object"===typeOf(google)&&"maps"in google&&"object"===typeOf(google.maps)&&"places"in google.maps&&"object"===typeOf(google.maps.places)&&"Autocomplete"in google.maps.places&&"function"===typeOf(google.maps.places.Autocomplete)},maybeLoadTimer:!1,loadScript:function(){if(this.isGoogleApiready())this.addressInit();else if(window.googleAddressApiScripts)this.maybeLoadTimer=function(){this.isGoogleApiready()&&(clearInterval(this.maybeLoadTimer),this.addressInit())}.periodical(500,this);else{window.googleAddressApiScripts=!0;var e="window.googleAddressAutocompletes.address_"+this.uuid+".addressInit";new Element("script",{src:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&callback="+e+"&key="+this.apikey}).inject(document.getElement("head"),"bottom")}}}),UIAutoComplete=new Class({Version:"1.0.9.2",File:"ui.autocomplete.js",Notes:"Position including scroll",Implements:[Options],Binds:["processNew","doAutoComplete","hideAll"],options:{},widgets:{},initialize:function(e){this.setOptions(e),Affinity.UI.autocomplete||(Affinity.UI.autocomplete={}),Affinity.UI.lastAutoKill={},"null"===typeOf(Affinity.UI.ghostFocus)&&(Affinity.UI.ghostFocus=new Element("input",{type:"text"}),new Element("div",{class:"subhidden"}).adopt(Affinity.UI.ghostFocus).inject(document.body,"bottom")),window.autocompletes=this,this.processNew()},processNew:function(){Array.each(document.getElements(".ui-autocomplete"),function(e){e.hasClass("has-lookup")||e.hasClass("lookup-loading")||(e.removeClass("ui-autocomplete"),Affinity.mobile&&"UIAutoCompleteMobileWidget"in window?ac=new UIAutoCompleteMobileWidget({selectElement:e}):ac=new UIAutoCompleteWidget({selectElement:e}),this.widgets[ac.uuid]||(this.widgets[ac.uuid]=ac))}.bind(this))},doAutoComplete:function(e){var t=new UIAutoCompleteWidget({selectElement:e});this.widgets[t.uuid]||(this.widgets[t.uuid]=t)},hideAll:function(e){Object.each(this.widgets,function(t){"null"!==typeOf(e)&&e.uuid?t.uuid!==e.uuid&&t.hide("master hide all"):t.hide("master hide all")}.bind(this))}}),UIAutoCompleteWidget=new Class({debug:!1,Implements:[Options,Events],Binds:["fuzzyWorkerComplete","cleanDisplay","processOptions","updateOptions","stopEvent","getValue","setValue","getDisplayValue","position","windowClickStart","windowClickEnd","listOver","listOut","elementOver","elementOut","doFocus","doClick","doKeyUp","doKeyDown","fuzzySearch","continueWithFuzzySearch","itemClicked","escapeRegExp","obscure","reveal","hide","show","clearList","revert","destroy","searchMode_fireChangeEvents","searchMode_valueToOption","searchMode_iconClicked","searchMode_displayBlur"],options:{stopInitialChange:!1,selectElement:null},webworkerpath:"./scripts/common/ui.autocomplete.web.worker.js",list:[],selectElement:null,listElement:null,displayElement:null,changed:!1,defaultChangeValue:null,center:!1,autowidth:!1,uuid:"",killid:"",type:"autocomplete",initialize:function(e){if(Affinity.mobile&&"UIAutoCompleteMobileWidget"in window)return new UIAutoCompleteMobileWidget(e);this.setOptions(e),this.useWebWorkers=!!Affinity.useWebWorkers&&"undefined"!=typeof Worker,this.useWebWorkers&&(this.fuzzyWorker=new Worker(this.webworkerpath),this.fuzzyWorker.onmessage=this.fuzzyWorkerComplete),this.searchMode=!1,Affinity&&Affinity.mobile&&(this.searchMode=!0),this.icons={},this.icons.search=Affinity.icons.Search,this.selectElement=this.options.selectElement,this.selectElement.hasClass("ui-autocomplete-center")&&(this.center=!0),this.selectElement.hasClass("ui-autocomplete-autowidth")&&(this.autowidth=!0),this.bestguess=null,this.selectElement.set("tabindex",5e3),this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.selectElement,"after"),this.selectElement.inject(this.hiddenWrapper),this.uuid=null==this.selectElement.get("id")?String.uniqueID():this.selectElement.get("id"),this.killid="ac-destroy-"+String.uniqueID(),window.autocompletes.widgets[this.uuid]||(window.autocompletes.widgets[this.uuid]=this),this.selectElement.set("id",this.uuid),this.processOptions.delay(100,this),this.selectElement.store("widget",this),this.selectElement.retrieve("changetracker")?this.valuetracker=this.selectElement.retrieve("changetracker"):this.valuetracker=new Affinity.ElementValueTracker,this.valuetracker.addElement(this.selectElement),document.addEvent("scroll",this.position),document.addEvent("resize",this.position)},fuzzyWorkerComplete:function(e){var t=e.data;switch(t.job){case"getOptions":this.searchMode&&(this.massiveSelect.innerHTML=t.html,Affinity.prompts.adopt(this.massiveSelect),this.massiveSelect.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:this.massiveSelect,onComplete:function(e){this.massiveLoader.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position()}.bind(this)}));break;case"getList":var i=null;this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),t.data.defaultID&&(i=this.listElement.getElement("#"+e.data.data.defaultID),this.defaultValue=i,this.lastSelected=i,this.defaultChangeValue=i.get("data-value")),this.continueProcessOptsions(i);break;case"resetList":this.listElement.innerHTML=t.html,this.iconElement&&this.iconElement.removeClass("working"),t.select&&(this.lastSelected=document.id(t.select),this.defaultValue=document.id(t.select),this.bestguess=document.id(t.select),this.selectElement.value=""),this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.defaultValue.value,this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),window.fireEvent("elementChanged",{element:this.selectElement});break;case"doSearch":;this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,t.bestguess&&(this.bestguess=document.id(t.bestguess)),this.iconElement&&this.iconElement.removeClass("working"),this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked)}},cleanDisplay:function(e){if("string"===typeOf(e)&&""!==e.trim()){return e.split(",").filter(function(e){return""!==e}).join(", ").trim().replace(/&amp;/gi,"&")}return e},getValue:function(){return this.selectElement.value},setValue:function(e,t){if(t=t||!0,e=this.cleanDisplay(e),"null"!==typeOf(this.listElement))if(this.searchMode)this.datalistElement.getElement("option[value="+e+"]")&&(this.displayElement.value=e,this.mobileChange());else{if(!e||""===e||"null"===typeOf(this.fuzzySearchItems)||!1===this.fuzzySearchItems)return void this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t});for(var i=!1,s=0;s<this.fuzzySearchItems.length;s++)if(this.fuzzySearchItems[s].value+""==e+""){i=document.id(this.fuzzySearchItems[s].id);break}i?this.itemClicked({target:i,fireEvents:t}):this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t})}},getDisplayValue:function(){return this.cleanDisplay(this.displayElement.value)},status:"closed",searchMode_firstPass:!0,searchMode_lastKnownValue:"",searchMode_fireChangeEvents:function(e){this.changed="boolean"===typeOf(e)&&!0===e,this.defaultChangeValue!==this.selectElement.value&&(this.defaultChangeValue=this.selectElement.value,this.changed=!0),!this.searchMode_firstPass&&this.changed&&this.searchMode_lastKnownValue===this.selectElement.value&&(this.changed=!1),this.changed&&(this.defaultChangeValue=this.selectElement.value,this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete search mode"})),this.searchMode_firstPass=!1},searchMode_valueToOption:function(e,t,i){if(i=i||!1,this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.selectElement.empty(),new Element("option",{value:e,html:t}).inject(this.selectElement),this.selectElement.value=e,this.selectElement.selectedIndex=0;else{this.selectElement.value=e;for(var s=this.selectElement.getElements("options"),n=0;n<s.length;n++)if(s[n].value===e){this.selectElement.selectedIndex=n;break}}this.displayElement.value=e,this.displayElement.store("data-search-value",e),this.searchMode_fireChangeEvents(i)},searchMode_iconClicked:function(){var e=this.cleanDisplay(this.displayElement.value);if(!Affinity.mobile&&""!==e.trim()&&e.length>1||Affinity.mobile){var t=new Element("select",{class:"override ui-autocomplete-center hidden"}),i=new Element("span",{html:'Loading list <img src="'+Affinity.loaders.dark+'" />'});uialert({message:"Set Value<br /><br />",showButtons:!0,showCancel:!0,canClose:!Affinity.mobile,position:{position:"fixed",top:10},onOk:function(){var e=document.id("UIPromtBox").getElement("select"),t=e.selectedIndex||0,i=e.getElements("option"),s=i[t];s.get("value");this.searchMode_valueToOption(s.get("value"),s.get("html"),!0),e.getWidget()&&e.getWidget().destroy(),e.destroy()}.bind(this),onCancel:function(){t.getWidget()&&t.getWidget().destroy(),t.destroy()},onClose:function(){t.getWidget()&&t.getWidget().destroy(),t.destroy()}}),Affinity.prompts.adopt(i),Affinity.prompts.hideButtons(),function(){if(this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")){var s,n=this.selectElement.retrieve("data-store"),o=this.selectElement.retrieve("data-key"),a=Affinity.UI[n][o].api;a=a.contains("limit")?a.substr(0,a.indexOf("limit")-1):a,0===Affinity.UI[n][o].data.length?new Request.JSONP({callbackKey:"jsoncallback",url:a,method:"get",timeout:3e4,onComplete:function(a){JSON.Unauthorized(a,Affinity.UI[n][o].id+", lookup massive loader")||("error"in a?i.set("html","Failed loading list. Please refresh and try again."):"array"===typeOf(a)&&a.length>0&&(Affinity.UI[n][o].data=a,Affinity.UI[n][o].loaded=!0,this.useWebWorkers?(this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[n][o].data,searchFor:e,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[n][o].data,function(i){(i.Value.toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(s=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(t),i.Value===e&&s.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),
Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))))}.bind(this),onError:function(e){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onFailure:function(e){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onTimeout:function(){i.set("html","List loader timed out. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this)}).send():this.useWebWorkers?(this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[n][o].data,searchFor:e,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[n][o].data,function(i){(i.Value.toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(s=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(t),i.Value===e&&s.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))}else if(this.useWebWorkers)this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[n][o].data,searchFor:e,ismobile:Affinity.mobile});else{Array.each(this.selectElement.getElements("option"),function(i){(i.get("html").stripTags().toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(i=new Element("option",{value:i.get("value")?i.get("value"):i.get("html").stripTags(),html:this.cleanDisplay(i.get("html"))}).inject(t),i.get("html")===e&&i.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}})}}.delay(300,this)}else""!==e.trim()&&1===e.length?uialert({message:"You must enter more than 1 character",showButtons:!0}):uialert({message:"You must enter a search term",showButtons:!0})},searchMode_displayBlur:function(){var e=this.cleanDisplay(this.displayElement.value),t=this.displayElement.retrieve("data-search-value");""!==t&&e===t||(t=e),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.selectElement.empty(),this.searchMode_valueToOption(t,e))},updateOptions:function(){this.clearList(),this.processOptions()},processCount:0,processOptions:function(){if("null"!==typeOf(this.selectElement)&&this.selectElement&&"getElements"in this.selectElement){var e=this.selectElement.getElements("option");(e.length>Affinity.selectmax||this.selectElement.hasClass("massive"))&&(this.searchMode=!0),this.searchMode&&this.selectElement.hasClass("override")&&(this.searchMode=!1);var t,i=!0,s=!0;if(this.searchMode){if(t=this.uuid,Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display").inject(this.hiddenWrapper,"before"),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),i=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),i&&(this.displayElement=new Element("input",{type:"text",class:"ui-autocomplete-display",id:t+"-Display"}).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.killid),t=this.uuid+"_icon",Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),s=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),s&&(this.iconElement=new Element("span",{class:"ui-autocomplete-display-icon searchmode",id:t+"-Display-Icon",html:Affinity.icons.Search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.selectElement.hasClass("massive")&&this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"))),!this.selectElement.hasClass("massive"))if(this.selectElement.addClass("massive"),this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"));else if(e.length>0){var n=this.selectElement.selectedIndex&&this.selectElement.selectedIndex>0?this.selectElement.selectedIndex:0;this.searchMode_valueToOption(e[n].get("value")||"",e[n].get("html"))}this.selectElement.set("data-display-id",this.uuid+"-Display"),this.fireEvent("complete",this)}else{this.displayElement?this.listElement.empty():(t=this.uuid,Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid),this.displayElement.removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display").cloneEvents(this.selectElement),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),i=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),i&&(this.displayElement=new Element("input",{type:"text",class:"ui-autocomplete-display",id:this.uuid+"-Display"}).cloneEvents(this.selectElement).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.selectElement.get("class")),this.displayElement.addClass(this.killid),t=this.uuid+"_icon",Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),s=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),s&&(this.iconElement=new Element("span",{class:"ui-autocomplete-display-icon",id:t+"-Display-Icon",html:this.icons.search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.displayElement.makeFormElement(),this.displayElement.addClass("widget"),this.displayElement.store("widget",this),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.displayElement.set("autocomplete","off"),this.selectElement.hasClass("has-message-icon")&&this.displayElement.addClass("has-message-icon"),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.listElement=new Element("ul",{class:"ui-autocomplete-list",id:this.domid}).inject(document.body,"bottom"),this.autowidth&&this.listElement.addClass("auto-width"),Affinity.mobile?window.addEvent("mobileback",function(){this.hide()}.bind(this)):(new Affinity.SmartClose(this.displayElement),new Affinity.SmartClose(this.listElement),this.displayElement.addEvent("SmartClose",function(){this.listElement.isOver()||this.hide()}.bind(this)),this.listElement.addEvent("SmartClose",function(){this.displayElement.isOver()||this.hide()}.bind(this))),(this.displayElement.hasClass("width-auto")||this.displayElement.hasClass("width-full"))&&this.listElement.setStyle("width",this.displayElement.getSize().x),this.listElement.set("tween",{duration:100}),this.listElement.fade("hide"),this.displayElement.addEvent("focus",this.doFocus),this.listElement.set("tween",{duration:100,onComplete:function(e){0===e.getStyle("opacity")?e.addClass("hidden"):e.removeClass("hidden")}}),this.listElement.fade("hide"));var o,a;this.items=[],this.fuzzySearchItems=[];var r=null;this.defaultValue=null,this.useWebWorkers?(this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"getList",html:this.selectElement.innerHTML,defaultValue:this.selectElement.get("data-default-value")||!1,uuid:this.uuid})):(Array.each(this.selectElement.getElements("option"),function(e,t){o=this.cleanDisplay(e.get("html")),value=e.get("value"),a=new Element("li",{html:o,"data-value":value,class:"visible",id:this.uuid+"-li-"+t}),a.set("data-index",t),a.set("data-value",value),a.addEvent(Affinity.events.click,this.itemClicked),a.inject(this.listElement),e.selected&&(r=a,this.defaultValue=a,a.addClass("selected"),this.lastSelected=a,this.defaultChangeValue=e.value),this.items.push(a),this.fuzzySearchItems.push({id:this.uuid+"-li-"+t,html:o,klass:"visible",searchstr:o,value:e.value})}.bind(this)),this.continueProcessOptsions(r))}}},continueProcessOptsions:function(e){this.searchMode||(this.useWebWorkers||(this.fuzzySearchItemsTotal=this.fuzzySearchItems.length),this.iconElement&&this.iconElement.removeClass("working"),this.fuzzySearchLargeDataDelay=!1,this.fuzzySearchLargeDataDelay=100,this.fuzzySearchItemsTotal>=2e3&&this.fuzzySearchItemsTotal<3e3&&(this.fuzzySearchLargeDataDelay=250),this.fuzzySearchItemsTotal>=3e3&&this.fuzzySearchItemsTotal<5e3&&(this.fuzzySearchLargeDataDelay=500),this.fuzzySearchItemsTotal>=5e3&&(this.fuzzySearchLargeDataDelay=1e3),Affinity.isie&&11===Affinity.ieversion&&(this.fuzzySearchLargeDataDelay=1001),null===this.defaultValue&&(this.defaultValue=this.listElement.getElement("li")),this.keyHeldCheck=!1,this.keyHeld=!1,this.keyHeldDelay=null,this.displayElement.addEvent("keyup",this.doKeyUp),this.displayElement.addEvent("keydown",this.doKeyDown),null!==e&&this.defaultSelected({target:e}),this.fireEvent("complete",this),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,this.options.stopInitialChange&&this.selectElement.fireEvent("change",{target:this.selectElement}),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this)),this.displayElement&&this.valuetracker.addElement(this.displayElement)},stopEvent:function(e){e.stop()},reset:function(){if(!this.searchMode){var e=!1;"null"!==typeOf(this.defaultValue)&&this.defaultValue&&"li"===this.defaultValue.get("tag")&&(e=this.defaultValue),"null"!==typeOf(this.lastSelected)&&this.lastSelected&&"li"===this.lastSelected.get("tag")&&(e=this.lastSelected),Array.each(this.items,function(t,i){t.inject(this.listElement),t.removeClass("selected"),t.removeClass("hidden"),t.addClass("visible"),this.fuzzySearchLargeDataDelay||t.set("html",this.cleanDisplay(t.get("html").stripTags())),e&&t===e&&(t.addClass("selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5),this.displayElement.value=this.cleanDisplay(e.get("html").stripTags()))}.bind(this))}},checkExists:function(){document.contains(this.selectElement)||(clearInterval(this.checkExistsPeriodical),this.destroy())},doFocusDelay:!1,doFocus:function(){clearTimeout(this.doFocusDelay),this.doFocusDelay=function(){"closed"==this.status&&this.show("displayElement focus")}.delay(100,this),Affinity.mobile&&(this.displayElement.selectionStart=0,this.displayElement.selectionEnd=999999)},doClick:function(e){this.stopEvent(e),this.displayElement.select()},doKeyUp:function(e){"tab"==e.key||e.shift||("tab"==e.key&&this.hide("on key up tab"),clearTimeout(this.keyHeldDelay),this.keyHeld||this.elementKeyUp(e),this.keyHeld=!1,this.keyHeldCheck=!1)},doKeyDown:function(e){if("tab"==e.key&&this.hide("on key down tab"),"tab"!=e.key){if("enter"==e.key)return void this.stopEvent(e);if("down"==e.key||"up"==e.key){if(this.keyHeldCheck||this.keyHeld)return void this.stopEvent(e);this.keyHeldCheck||this.keyHeld||(this.keyHeldCheck=!0,this.keyHeldDelay=this.elementKeySetHeld.delay(500,this,[e]))}}},elementKeySetHeld:function(e){this.keyHeld=!0,this.elementKeyUp(e)},getTopVisibleElement:function(){var e,t,i,s=this.listElement.getElements("li.visible");for(e=0;e<s.length;e++)if(t=s[e],i=t.getPosition(this.listElement),i.y>0)return t},getBottomVisibleElement:function(){var e,t,i,s=this.listElement.getSize().y,n=this.listElement.getElements("li.visible");for(e=n.length-1;e>0;e--)if(t=n[e],i=t.getPosition(this.listElement),i.y<s)return t},scrollToTop:function(e){var t=this.listElement.getScroll().y,i=e.getPosition(this.listElement).y,s=e.getSize().y;i<0&&this.listElement.scrollTo(0,t+i-s+10)},scrollToBottom:function(e){var t=this.listElement.getScroll().y,i=this.listElement.getSize().y,s=e.getPosition(this.listElement).y,n=e.getSize().y;s>i-n&&this.listElement.scrollTo(0,t+(s-i)+n+5)},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},fuzzyRunning:!1,fuzzySearch:function(e,t,i,s){if(!this.fuzzyRunning){this.fuzzyRunning=!0;var n,o=[];if(this.useWebWorkers)this.fuzzyDoSearchData={searchData:e,target:s},this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"doSearch",data:e,searchKey:t,searchFor:i,perfDelay:this.fuzzySearchLargeDataDelay});else{var a,n,r,l,h,u,c,d,p,m,f,g,v,y,b,A,w=[];isNaN(i)?Array.each(e,function(e,s){n=document.id(e.id),r=0,h=[],i=i.toLowerCase(),u=e[t].toLowerCase().trim(),c=i===u,d=u.indexOf(i)>-1,f=i.split(" "),p=f.length,c?(m=p,l=99999,r=99999,this.fuzzySearchLargeDataDelay?n.removeClass("hidden").addClass("visible"):(A="<strong>"+this.cleanDisplay(n.get("html").stripTags())+"</strong>",n.set("html",A).removeClass("hidden").addClass("visible"))):!c&&d?(m=u.split(i).length-1||0,l=m,r=l+100,this.fuzzySearchLargeDataDelay?n.removeClass("hidden").addClass("visible"):(A=this.cleanDisplay(n.get("html").stripTags()).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1</strong>"),n.set("html",A).removeClass("hidden").addClass("visible"))):this.fuzzySearchLargeDataDelay<1001&&(g=u.split(" "),m=0,Array.each(f,function(e){Array.each(g,function(t){" "!=e&&""!=e&&(v=e.soundex(),y=t.soundex(),0==(b=v.distance(y))&&(m+=1))})}),r=m,l=Number.round(m/p,2)||0,r>=0&&(this.fuzzySearchLargeDataDelay?n.removeClass("hidden").addClass("visible"):(A=this.cleanDisplay(n.get("html").stripTags()),n.set("html",A).removeClass("hidden").addClass("visible")))),a={originalIndex:s,score:r,wordScore:l},w.push(a)}.bind(this)):Array.each(e,function(e,s){n=document.id(e.id),e[t].contains(i)?(l=e[t].split(i).length-1||0,g=e[t].split(" "),w.push({originalIndex:s,score:l,wordScore:l/g}),n.removeClass("hidden").addClass("visible")):n.addClass("hidden").removeClass("visible")}),w.sort(function(e,t){return parseFloat(e.score)===parseFloat(t.score)?parseFloat(e.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(e.score)<parseFloat(t.score)?1:-1});var E=!1;Array.each(w,function(t){a=e[t.originalIndex],a.score=t.score,a.wordScore=t.wordScore,o.push(a),n=document.id(a.id),t.score>0?(n.inject(s),E=!0):n.addClass("hidden").removeClass("visible")}),!E&&w.length>0&&w[0].originalIndex&&e[w[0].originalIndex]&&e[w[0].originalIndex].id&&(this.bestguess=document.id(e[w[0].originalIndex].id))}return this.fuzzyRunning=!1,o}},elementKeyUp:function(e){var t=this.cleanDisplay(this.displayElement.value.toLowerCase()),i=this.listElement.getElement("li.visible.selected")||!1;if("enter"==e.key&&i)return this.stopEvent(e),void this.itemClicked({target:i});if("down"==e.key||"up"==e.key)return"closed"==this.status&&this.show(),e.preventDefault(),"down"==e.key&&this.elementDown(e),"up"==e.key&&this.elementUp(e),void(this.keyHeld&&this.elementKeyUp.delay(50,this,[e]));if(8===e.code||16===e.code||32===e.code||46===e.code||e.code>=48&&e.code<=57||e.code>=65&&e.code<=90||e.code>=96&&e.code<=105){if("closed"==this.status&&this.show(),""===t)return void(this.useWebWorkers?this.fuzzyWorker.postMessage({job:"resetList"}):(Array.each(this.items,function(e,t){e.inject(this.listElement),e.set("html",this.cleanDisplay(e.get("html").stripTags())),e.removeClass("selected").removeClass("hidden").addClass("visible"),""===e.get("html").trim()&&(e.addClass("selected"),i!==e&&(this.changed=!0),this.lastSelected=e,this.defaultValue=e,this.selectElement.value="",this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.selectElement.getElements("option")[0].value)}.bind(this)),this.bestguess=this.defaultValue,window.fireEvent("elementChanged",{element:this.selectElement})));this.listElement.getElements("li").removeClass("selected"),this.listElement.scrollTo(0,0),i&&(this.lastSelected=i),this.fuzzySearchLargeDataDelay?(clearTimeout(this.fuzzySearchDelay),this.fuzzySearchDelay=this.continueWithFuzzySearch.delay(this.fuzzySearchLargeDataDelay,this)):this.continueWithFuzzySearch(),this.position()}},continueWithFuzzySearch:function(){this.fuzzySearch(this.fuzzySearchItems,"searchstr",this.cleanDisplay(this.displayElement.value.toLowerCase()),this.listElement);this.position()},elementUp:function(){if(0===this.listElement.getElements("li.visible").length)return void this.hide("elementUp with empty list");var e=this.listElement.getElement("li.visible.selected"),t=this.getTopVisibleElement(),i=this.getBottomVisibleElement(),s=-1,n=this.listElement.getElements("li.visible");e&&(s=n.indexOf(e),e.removeClass("selected")),s>n.indexOf(i)?i&&"addClass"in i&&i.addClass("selected"):s>0?n[s-1]&&"addClass"in n[s-1]&&(n[s-1].addClass("selected"),this.scrollToTop(n[s-1])):this.listElement.scrollHeight==this.listElement.clientHeight?i&&"addClass"in i&&i.addClass("selected"):t&&"addClass"in t&&t.addClass("selected"),window.fireEvent("elementChanged",{element:this.selectElement})},elementDown:function(){if(0===this.listElement.getElements("li.visible").length)return void this.hide("elementDown with empty list");var e=this.listElement.getElement("li.visible.selected"),t=this.getTopVisibleElement(),i=this.getBottomVisibleElement(),s=-1,n=this.listElement.getElements("li.visible");e&&"addClass"in e&&(s=n.indexOf(e),e.removeClass("selected")),s<n.indexOf(t)?t&&"addClass"in t&&t.addClass("selected"):s<n.length-1?n[s+1]&&"addClass"in n[s+1]&&(n[s+1].addClass("selected"),this.scrollToBottom(n[s+1])):this.listElement.scrollHeight==this.listElement.clientHeight?t&&"addClass"in t&&t.addClass("selected"):i&&"addClass"in i&&i.addClass("selected")},defaultSelected:function(e){var t=this.cleanDisplay(e.target.get("html").stripTags());this.listElement.getElements("li").removeClass("selected"),e.target.addClass("selected"),this.displayElement.value=t,this.selectElement.selectedIndex=e.target.get("data-index"),this.selectElement.value=e.target.get("data-value")},itemClicked:function(e){this.hide("item clicked");var t="li"==e.target.get("tag")?e.target:e.target.getParent("li"),i=!e.hasOwnProperty("fireEvents")||!1!==e.fireEvents;this.listElement.getElements("li").removeClass("selected"),t.addClass("selected"),this.lastSelected=t,this.displayElement.value=this.cleanDisplay(t.get("html").stripTags()),this.selectElement.selectedIndex=t.get("data-index"),this.selectElement.value=t.get("data-value"),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,i&&(this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete itemClicked"}),this.fireEvent("elementChanged",this.selectElement.value))},position:function(){if(this.displayElement&&this.listElement)try{var e=this.displayElement.getPosition(),t=this.displayElement.measure(function(){return this.getSize()}),i=window.getSize(),s=document.body.scrollTop||0,n=e.y+t.y+s+5,o=e.x,a=this.listElement.measure(function(){return this.getSize()});this.center&&(o=e.x+t.x/2-a.x/2),i.y-e.y<a.y&&(n=e.y-a.y-5+s),e.x+a.x>i.x&&(o=i.x-a.x-5),this.listElement.setStyles({position:Affinity.mobile?"fixed":"absolute",top:n,left:o})}catch(e){}},obscure:function(){this.hide(),this.iconElement&&this.iconElement.addClass("hidden"),this.displayElement&&this.displayElement.addClass("hidden")},reveal:function(){this.iconElement&&this.iconElement.removeClass("hidden"),this.displayElement.removeClass("hidden")},hide:function(e){if("closed"!==this.status){clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay);var t=this.listElement;t.fade("out"),this.status="closed",function(){t.addClass("hidden"),this.listElement&&"getElement"in this.listElement&&!this.listElement.getElement("li.visible.selected")&&(this.lastSelected=this.listElement.getElement("li.visible.selected")),this.reset()}.delay(250,this)}},show:function(e){if("open"!==this.status&&this.listElement&&"getElements"in this.listElement&&this.listElement.getElements("li.visible").length>0){window.autocompletes.hideAll(this),clearTimeout(this.doFocusDelay);var t=this.listElement;if(t.removeClass("hidden"),this.position(),t.fade("in"),this.status="open",this.position.delay(250,this),this.listElement&&"getElement"in this.listElement&&this.listElement.getElement("li.visible.selected")){var i=this.listElement.getElement("li.visible.selected");this.listElement.scrollTo(0,i.getPosition(this.listElement).y-5)}}},clearList:function(){this.listElement&&(Array.each(this.listElement.getElements("li"),function(e){e.removeEvents()}.bind(this)),this.listElement.empty())},revert:function(e){var t="null"!==typeOf(e)&&e;this.useWebWorkers&&this.fuzzyWorker&&"terminate"in this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1);return clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay),clearInterval(this.checkExistsPeriodical),this.doFocusDelay=null,this.fuzzySearchDelay=null,this.checkExistsPeriodical=null,this.displayElement&&(Affinity.UI.lastAutoKill[this.uuid]={},Affinity.UI.lastAutoKill[this.uuid].id=this.uuid+"",Affinity.UI.lastAutoKill[this.uuid].killid=this.killid+"",Affinity.UI.lastAutoKill[this.uuid].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"",this.killid+""]),this.iconElement&&(this.iconElement.addClass("loading"),Affinity.UI.lastAutoKill[this.uuid+"_icon"]={},Affinity.UI.lastAutoKill[this.uuid+"_icon"].id=this.uuid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].killid=this.killid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"_icon",this.killid+"_icon"]))),Affinity.mobile||(document.removeEvent("scroll",this.position),document.removeEvent("resize",this.position)),this.listElement&&(this.listElement.set("tween",null),this.listElement.removeEvents(),this.clearList(),this.listElement.destroy()),this.displayElement&&(this.displayElement.removeEvents(),this.displayElement.getWidget("elementWidget")&&this.displayElement.getWidget("elementWidget").destroy(),this.searchMode&&this.displayElement.eliminate("value")),this.selectElement&&(this.selectElement.inject(this.hiddenWrapper,"before"),this.selectElement.eliminate("widget"),t&&(this.selectElement.retrieve("changetracker")&&this.selectElement.retrieve("changetracker").destroy(),this.selectElement.destroy())),this.hiddenWrapper&&this.hiddenWrapper.destroy(),window.autocompletes.widgets[this.uuid]&&(window.autocompletes.widgets[this.uuid]=null,delete window.autocompletes.widgets[this.uuid]),Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this)),!0},destroy:function(){this.useWebWorkers&&this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1),this.revert(!0)}}),fuzzyRunning=!1,fuzzySearchData=[],originalListHTML="",initialSelected="";onmessage=function(e){var t=e.data;"getOptions"===t.job&&returnSelectOptions(t.data,t.searchFor,t.ismobile),"getList"===t.job&&returnList(t.uuid,t.html,t.defaultValue,t.uuid),"resetList"===t.job&&returnResetList(),"doSearch"===t.job&&fuzzySearch(t.data,t.searchKey,t.searchFor,t.perfDelay)};var UIBankNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-banknumber"),this.process)},process:function(e){e.removeClass("ui-banknumber"),new UIBankNumberWidget({element:e})}}),UIBankNumberWidget=new Class({Implements:[Options,Events],Binds:["bankFieldChange","currentLocation","bankFields","buildNZBank","buildAUBank","bankValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy","padLeft"],options:{element:null,hasPayPoint:!0},element:null,type:"banknumber",initialize:function(e){if(this.setOptions(e),this.uuid=String.uniqueID(),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{class:"countryselector"}).inject(this.options.element,"before"),this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown="True"===t?new Element("select",{class:"selector validate","data-validate-method":"bankNumberCountry"}).inject(this.dropdownDiv):new Element("select",{class:"selector"}).inject(this.dropdownDiv),this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown),this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdown),this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after"),this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(e){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden"),this.disabled?(this.countrySelectEl=new Element("input",{type:"text",class:"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.bankFieldChange,window.addEvent("bankValidationReturned",this.processValidation)),this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country"),this.bankFields(this.currentLocation())},bankFieldChange:function(){null!=this.element&&this.element.destroy(),this.bankFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?"select"===this.countrySelectEl.get("tag")&&"-1"!=this.countrySelectEl.selectedIndex?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},bankFields:function(e){"NZ"===e?(this.buildNZBank(),this.originalElement.removeClass("hidden")):"AU"===e?(this.buildAUBank(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("bankValidationError",{target:this.originalElement,silent:!0}))},buildNZBank:function(){this.element=new Element("div",{class:"banknumberbox ui-validate nz","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.bankNumberPart1=new Element("input",{class:"bank",id:"bank",type:"text",maxlength:"2"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart2=new Element("input",{class:"branch",id:"branch",type:"text",maxlength:"4"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart3=new Element("input",{class:"account",id:"account",type:"text",maxlength:"7"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart4=new Element("input",{class:"suffix",id:"suffix",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.name=new Element("span",{class:"names"}).inject(this.element),this.bankname=new Element("span",{class:"bankname"}).inject(this.name),this.branchname=new Element("span",{class:"branchname"}).inject(this.name),this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before")),this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.bankNumberPart4.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.bankNumberPart3.onblur=this.padLeft,this.bankNumberPart4.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},buildAUBank:function(){this.element=new Element("div",{class:"banknumberbox ui-validate au","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.bankNumberPart1=new Element("input",{class:"bank",id:"bank",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart2=new Element("input",{class:"branch",id:"branch",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart3=new Element("input",{class:"account",id:"account",type:"text",maxlength:"14"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.name=new Element("span",{class:"names"}).inject(this.element),this.bankname=new Element("span",{class:"bankname"}).inject(this.name),this.branchname=new Element("span",{class:"branchname"}).inject(this.name),this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before")),this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden(),this.bankValidation()},padLeft:function(){this.bankNumberPart3&&""!==this.bankNumberPart3.value&&(this.bankNumberPart3.value=this.bankNumberPart3.value.padStart(7,"0"))},setFromInitialValue:function(){var e=this.hiddenWrapper.getElement("input").value.split("-");"NZ"==this.currentLocation()?(this.bankNumberPart1.value=e[0]?e[0].length>2?e[0].substring(0,2):e[0]:"",this.bankNumberPart2.value=e[1]?e[1]:"",this.bankNumberPart3.value=e[2]?e[2]:"",this.bankNumberPart4&&(e[2]&&e[2].length>7?(this.bankNumberPart3.value=e[2].substring(0,7),this.bankNumberPart4.value=e[2].substring(7,e[2].length)):this.bankNumberPart4.value=e[3]?e[3]:"")):"AU"==this.currentLocation()?(this.bankNumberPart1.value=e[0]?e[0]:"",this.bankNumberPart2.value=e[1]?e[1]:"",this.bankNumberPart3.value=(e[2]?e[2]:"")+(e[3]?e[3]:"")):(this.bankNumberPart1.value="",this.bankNumberPart2.value="",this.bankNumberPart3.value="",
this.bankNumberPart4&&(this.bankNumberPart4.value="")),this.bankValidation()},copyToHidden:function(){var e="";if("NZ"==this.currentLocation()){var t=""!=this.bankNumberPart1.value?this.bankNumberPart1.value+"-":"",i=""!=this.bankNumberPart2.value?this.bankNumberPart2.value+"-":"",s=""!=this.bankNumberPart3.value?this.bankNumberPart3.value+"-":"";e=t+i+s+(""!=this.bankNumberPart4.value?this.bankNumberPart4.value:"")}else if("AU"==this.currentLocation()){var t=""!=this.bankNumberPart1.value?this.bankNumberPart1.value+"-":"",i=""!=this.bankNumberPart2.value?this.bankNumberPart2.value+"-":"",s=""!=this.bankNumberPart3.value?this.bankNumberPart3.value:"";e=t+i+s}this.hiddenWrapper.getElement("input").value=e,this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},bankValidationDelay:!1,bankValidation:function(){clearTimeout(this.bankValidationDelay),this.bankValidationDelay=function(){var e=this.hiddenWrapper.getElement("input"),t=e.getParent("form");if(null!=t&&t.retrieve("validation")){t.retrieve("validation").validateBankNumber(e,this.currentLocation(),e.get("name"))}}.delay(500,this)},processValidation:function(e){var t=e.el,i=e.data;t===this.originalElement&&(this.bankname.set("html",i.bankName),this.branchname.set("html",i.branchName),i.success?this.success():t.value?this.failed():(window.fireEvent("bankValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Tick),t.removeClass("red").addClass("green")},failed:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Cross),t.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()}}),UIDateCalendar=new Class({Version:"1.0.0.0",File:"ui.date.calendar.js",Implements:[Options,Events],Binds:["processNew","processDateInput","hideAll"],options:{outputFormat:"%d.%m.%Y",displayFormat:"%a the %e%o of %b %Y"},widgets:{},initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.calendars=this,this.processNew()},processNew:function(){Array.each(document.getElements("input.uidate-calendar"),this.processDateInput)},processDateInput:function(e){if(!e.hasClass("uidone")){e.addClass("uidone");var t={target:e,postName:e.get("name")||"",postId:e.get("id")||"",startDate:e.get("data-start-date")||new Date,validationMethods:e.get("data-validate-method")||"",validationErrorStr:e.get("data-validate-error-str")||"",showInline:!!e.hasClass("show-inline"),nullable:!1};switch(e.get("data-calendar-type")){case"date":t.showCalendar=!0,t.showTime=!1;break;case"time":t.showCalendar=!1,t.showTime=!0;break;case"datetime":t.showCalendar=!0,t.showTime=!0;break;case"hoursmins":t.showCalendar=!0,t.showTime=!0,t.hoursmins=!0;break;default:t.showCalendar=!0,t.showTime=!1}e.get("data-calendar-display-format")&&(t.displayFormat=e.get("data-calendar-display-format")),e.get("data-calendar-return-format")&&(t.outputFormat=e.get("data-calendar-return-format")),e.get("data-calendar-nullable")&&(t.nullable="true"===e.get("data-calendar-nullable").trim().toLowerCase()),e.get("data-calendar-hoursmins")&&(t.hoursmins="true"===e.get("data-calendar-hoursmins").trim().toLowerCase()),e.hasClass("preserve-original-input")&&(t.preserveOriginalInput=!0),t.hoursmins&&!e.get("data-start-date")&&(t.startDate.setMinutes(0),t.startDate.setHours(0),t.startDate.setSeconds(0),t.startDate.setMilliseconds(0));var i=new UIDateTimeWidget(t);this.widgets[i.uuid]||(this.widgets[i.uuid]=i),delete i,delete t}},hideAll:function(e){Object.each(this.widgets,function(t){"null"!==typeOf(e)&&e.uuid?t.uuid!==e.uuid&&t.hide():t.hide()}.bind(this))}}),UIDateTimeWidget=new Class({Implements:[Options,Events],options:{target:null,preserveOriginalInput:!1,outputFormat:"%d.%m.%Y",displayFormat:"%a %e %b %Y",showCalendar:!0,showTime:!1,startDate:null,labelName:"",postId:"",postName:"",validationMethods:"",validationErrorStr:"",cssPosition:"absolute",watchOutput:!1,nullable:!1,hoursmins:!1,showInline:!1},Binds:["getDate","getDateObject","getValue","getDisplayValue","documentClick","calendarClick","calendarEnter","calendarLeave","monthElementClicked","yearElementClicked","monthSelectorClicked","yearSelectorClicked","lastMonth","nextMonth","resetCalendar","nextMonthDown","lastMonthDown","dayClicked","timeChanged","setCalendarDate","changeMonth","changeYear","attemptParse","setToday","setNone","externalShow","watchOutputChanges","obscure","reveal","show","hide","destroy"],row:null,date:null,__uiDate:null,__selectedDate:null,getValue:function(){return this.date.format(this.options.displayFormat)},getDisplayValue:function(){return this.date.format(this.options.outputFormat)},initialize:function(e){this.setOptions(e),this.showDefault="none"!=this.options.startDate;var t=new Date;if(this.__uiDate=t.clone(),this.__selectedDate=this.date=!1,"none"==this.options.startDate?this.options.target&&"value"in this.options.target&&""!==this.options.target.value.trim()&&Date.parse(this.options.target.value).isValid()?(this.__uiDate=Date.parse(this.options.target.value),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone(),this.showDefault=!0):this.showDefault=!1:"today"==this.options.startDate?(this.__uiDate=t.clone(),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()):this.options.startDate&&null!==this.options.startDate&&Date.parse(this.options.startDate).isValid()&&(this.__uiDate=Date.parse(this.options.startDate),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.hoursmins&&t.getTime()===this.__uiDate.getTime()&&(this.__uiDate.setMinutes(0),this.__uiDate.setHours(0),this.__uiDate.setSeconds(0),this.__uiDate.setMilliseconds(0),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.nullable&&(this.showDefault=!1),this.id=null!=this.options.target&&this.options.target.get("id")?this.options.target.get("id"):String.uniqueID(),this.uuid=this.id,Affinity.UI.calendars.widgets[this.uuid]||(Affinity.UI.calendars.widgets[this.uuid]=this),this.display=new Element("input",{type:"text",class:"ui-calendar-display data-hj-whitelist widget",id:this.id+"-Display"}).store("widget",this),this.output=new Element("input",{type:"hidden",name:this.options.postName,id:this.options.postId,"data-display-id":this.id+"-Display"}),Affinity.mobile&&this.display.set("readonly","true"),""!=this.options.validationMethods&&(this.output.addClass("validate"),this.output.set("data-validate-method",this.options.validationMethods),this.options.validationErrorStr&&this.output.set("data-validate-error-str",this.options.validationErrorStr)),this.watch=this.options.watchOutput||!1,"null"!==typeOf(this.options.target)&&this.options.target.hasClass("uidate-watch")&&(this.watch=!0),this.watch&&(this.watchTimer=this.watchOutputChanges.periodical(500,this)),this.reuse=this.options.preserveOriginalInput||!1,"null"!==typeOf(this.options.target)&&this.options.target.hasClass("uidate-preserve")&&(this.reuse=!0),this.reuse)if("null"===typeOf(this.options.target))this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{class:"hidden"}).inject(this.label,"after");else{this.row=this.options.target.getParent(".form-row")||!1,this.target=this.options.target,this.output=this.target;var i=new Element("div",{class:"subhidden"});this.target.store("widget",this),this.row?(i.inject(this.row,"top"),this.display.inject(this.row,"bottom")):(i.inject(this.output,"before"),this.display.inject(this.output,"after")),this.output.inject(i)}else{if(null==this.options.target)this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{class:"hidden"}).inject(this.label,"after");else{this.target=new Element("div",{class:"hidden"}).inject(this.options.target,"after");var s;this.options.target.value&&(s=Date.parse(this.options.target.value),s.isValid()&&(this.options.startDate=s)),this.row=this.options.target.getParent(".form-row"),this.options.postId=this.options.target.get("id"),""==this.options.postName&&(this.options.postName=this.options.target.get("name"),this.output.set("name",this.options.postName)),this.display.cloneEvents(this.options.target),this.options.target.set("id","__"+this.options.target.get("id")),this.options.target.set("name",null),this.options.target.removeEvents(),this.options.target.store("widget",this).addClass("hidden")}null!==this.row&&this.row.set("class","form-row ui-calendar-row "+this.id),this.display.inject(this.target,"after"),this.output.inject(this.target,"after"),this.target.destroy()}this.icons={},this.icons.Open=Affinity.icons.Popup||"&#xe012;",this.icons.Today=Affinity.icons.Calendar||"&#xe02e;",this.icons.Clear=Affinity.icons.Cross||"&#xe067;",this.icons.Tick=Affinity.icons.Tick,this.dontClose=!1,this.calendarOver=!1,this.buttons=new Element("span",{class:"ui-calendar-buttons"}).inject(this.display,"after"),this.showbutton=new Element("span",{class:"ui-calendar-button button w-icon-only blue ui-has-tooltip",html:"<span>"+this.icons.Open+"</span>","data-calendar":this.id,"data-tooltip":"Open","data-tooltip-dir":"top"}).inject(this.buttons),this.todaybutton=new Element("span",{class:"ui-calendar-button button w-icon-only green ui-has-tooltip",html:"<span>"+this.icons.Today+"</span>","data-calendar":this.id,"data-tooltip":"Set date to today","data-tooltip-dir":"top"}).inject(this.buttons),this.clearbutton=new Element("span",{class:"ui-calendar-button button w-icon-only orange ui-has-tooltip",html:"<span>"+this.icons.Clear+"</span>","data-calendar":this.id,"data-tooltip":"Clear the date","data-tooltip-dir":"top"}).inject(this.buttons),this.calendarBox=new Element("div",{class:"ui-calendar",id:this.domid}).inject(document.body),this.calendarBox.set("reveal",{duration:250}),this.options.showInline||this.calendarBox.addEvent(Affinity.events.click,this.calendarClick),Affinity.mobile&&this.options.showInline||(this.calendarBox.addEvent(Affinity.events.overAll,this.calendarEnter),this.calendarBox.addEvent(Affinity.events.outAll,this.calendarLeave)),this.options.showInline||(this.display.addEvent(Affinity.events.click,this.externalShow),this.showbutton.addEvent(Affinity.events.click,this.externalShow),this.display.addEvent("blur",this.attemptParse),document.addEvent(Affinity.events.click,this.documentClick),this.todaybutton.addEvent(Affinity.events.click,this.setToday),this.clearbutton.addEvent(Affinity.events.click,this.setNone)),this.output&&this.date&&"element"===typeOf(this.output)&&"date"===typeOf(this.date)&&this.options.outputFormat&&this.output.store("defaultValue",this.date.format(this.options.outputFormat)),this.printField=!1,this.display.getParent(".ui-calendar-row")&&this.display.getParent(".ui-calendar-row").getElement(".print-field")&&(this.printField=this.display.getParent(".ui-calendar-row").getElement(".print-field")),this.buildCalendar(),window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this)),Affinity.mobile&&(window.addEvent("mobileback",this.documentClick),"onorientationchange"in window&&window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this))),this.valuetracker=new Affinity.ElementValueTracker,this.display&&this.valuetracker.addElement(this.display),this.output&&this.valuetracker.addElement(this.output),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this),this.options.showInline&&(this.buttons.addClass("hidden"),this.display.addClass("hidden"),this.calendarBox.addClass("inline"),this.calendarBox.inject(this.display.getParent(),"bottom"),this.show())},checkExists:function(){document.contains(this.output)||(clearInterval(this.checkExistsPeriodical),this.destroy())},documentClick:function(e){"open"==this.status&&this.hide(null,"doc "+this.id)},calendarClick:function(e){e.stopPropagation(),e.preventDefault()},calendarEnter:function(e){this.calendarOver=!0},calendarLeave:function(e){this.calendarOver=!1},monthElementClicked:function(e){this.calendarContainer.reveal(),this.monthbox.dissolve(),this.changeMonth(e.target.get("data-value")),this.monthbox.getElements(".active").removeClass("active"),e.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},yearElementClicked:function(e){this.calendarContainer.reveal(),this.yearbox.dissolve(),this.changeYear(e.target.get("data-value")),this.yearbox.getElements(".active").removeClass("active"),e.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},monthSelectorClicked:function(e){this.monthbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve()},yearSelectorClicked:function(e){this.yearbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve(),function(){var e=this.yearbox.getElement(".active").getPosition(this.yearbox).y;this.yearbox.scrollTo(0,e-5)}.delay(500,this)},nextMonthDown:function(e){e.preventDefault(),e.stopPropagation()},lastMonthDown:function(e){e.preventDefault(),e.stopPropagation()},getHumanHour:function(e){return 0==e?"Midnight":e<12?e+" am":e>12?e-12+" pm":"Midday"},buildCalendar:function(){var e,t,i=new Date;if(this.options.showCalendar){this.calendarContainer=new Element("div").inject(this.calendarBox),this.lastButton=new Element("span",{html:"&#9668;",class:"ui-calendar-nextlast"}).inject(this.calendarContainer);var s=new Element("span",{html:"",class:"ui-calendar-monthyear"}).inject(this.calendarContainer);for(this.nextButton=new Element("span",{html:"&#9658;",class:"ui-calendar-nextlast"}).inject(this.calendarContainer),this.monthButton=new Element("span",{class:"ui-calendar-month"}).inject(s),this.yearButton=new Element("span",{class:"ui-calendar-year"}).inject(s),this.monthbox=new Element("div",{class:"ui-calendar-monthbox"}).inject(this.calendarBox),this.monthbox.set("reveal",{duration:250}),this.monthbox.toggle(),this.yearbox=new Element("div",{class:"ui-calendar-yearbox"}).inject(this.calendarBox),this.yearbox.set("reveal",{duration:250}),this.yearbox.toggle(),e=0;e<12;e++)this.monthbox.adopt(new Element("span",{class:"m"+e+(e===i.getMonth()?" today":""),html:i.clone().set("month",e).format("%b"),"data-value":e}).addEvent(Affinity.events.click,this.monthElementClicked));var n=i.clone();for(e=n.getFullYear()-100;e<n.getFullYear()+50;e++)new Element("span",{class:"y"+e+(e===i.getFullYear()?" today":""),html:e,"data-value":e}).addEvent(Affinity.events.click,this.yearElementClicked).inject(this.yearbox,"top");for(e=0;e<7;e++)i.set("day",e),new Element("span",{html:i.format("%a"),class:"ui-calendar-daylabel"}).inject(this.calendarContainer);for(e=0;e<42;e++)t=new Element("span",{class:"ui-calendar-day"}).adopt(new Element("span")).inject(this.calendarContainer),this.setupClickable(t);this.nextButton.addEvent(Affinity.events.click,this.nextMonth),this.lastButton.addEvent(Affinity.events.click,this.lastMonth),this.monthButton.addEvent(Affinity.events.click,this.monthSelectorClicked),this.yearButton.addEvent(Affinity.events.click,this.yearSelectorClicked),Affinity.mobile||(this.nextButton.addEvent("mousedown",this.nextMonthDown),this.lastButton.addEvent("mousedown",this.lastMonthDown))}if(this.options.showTime){var o=150;this.options.showCalendar&&(this.calendarContainer.set("reveal",{duration:250}),o=this.calendarContainer.measure(function(){return this.getSize()}).x-20);var a=!!this.__selectedDate&&this.__selectedDate.clone();this.timeWidget=new UITimePickerWidget({target:this.calendarBox,displayInput:this.display,timeonly:!this.options.showCalendar,date:a,hoursmins:this.options.hoursmins,dateWidget:this,onTimeSet:function(e){"date"===typeOf(e)&&e.isValid()&&(this.__selectedDate?e.getTime()!==this.__selectedDate.getTime()&&(this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__selectedDate=this.date.clone(),this.__uiDate=this.date.clone(),this.setCalendarDate()):this.date?e.getTime()!==this.date.getTime()&&(this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):this.options.nullable?this.options.showCalendar||(this.date=e,this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):(this.date=e,this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()))}.bind(this),onOpen:function(){this.options.showCalendar&&this.calendarContainer.dissolve()}.bind(this),onDone:function(e){this.options.showCalendar?this.calendarContainer.reveal():this.hide(e,"timeWidget"),this.output.fireEvent("change",{target:this.output})}.bind(this),width:o})}this.setupCalendar(null!=this.options.startDate)},setupCalendar:function(e){var t="null"!==typeOf(e)&&e,i=new Date;if(this.options.showCalendar){var s,n=1,o=this.__uiDate.get("month"),a=this.__uiDate.get("year"),r=this.__uiDate.get("lastdayofmonth"),l=this.__uiDate.clone().set("date",1).get("day");this.calendarBox.getElement(".ui-calendar-month").set("html",this.__uiDate.format("%B")),this.calendarBox.getElement(".ui-calendar-year").set("html",this.__uiDate.getFullYear()),this.calendarBox.getElements(".ui-calendar-day").removeClass("today").removeClass("selected").removeClass("active"),Array.each(this.calendarBox.getElements(".ui-calendar-day"),function(e,t){e.set("class","ui-calendar-day"),e.getElement("span").set("html","&nbsp;"),t>=l&&t<l+r&&n==i.get("date")&&o==i.get("month")&&a==i.get("year")&&e.addClass("today"),t>=l&&t<l+r&&n==this.__uiDate.get("date")&&o==this.__uiDate.get("month")&&a==this.__uiDate.get("year")&&e.addClass("selected"),t>=l&&t<l+r&&(s=this.__uiDate.clone().set("date",n).format("%b%d%Y"),e.getElement("span").set("html",n),e.addClass(s),e.addClass("active"),e.store("date",this.__uiDate.clone().set("date",n)),n++)}.bind(this)),this.monthbox.getElements(".active").removeClass("active"),this.monthbox.getElement(".m"+this.__uiDate.getMonth()).addClass("active"),this.yearbox.getElements(".active").removeClass("active"),this.yearbox.getElement(".y"+this.__uiDate.getFullYear()).addClass("active")}this.options.showTime&&this.timeWidget.setTime(this.__uiDate),t&&this.setCalendarDate()},setupClickable:function(e){e.addEvent(Affinity.events.click,this.dayClicked)},dayClicked:function(e){var t,i=e.target.hasClass("ui-calendar-day")?e.target:e.target.getParent(".ui-calendar-day");if(i.hasClass("active")){this.calendarBox.getElements(".ui-calendar-day.selected").removeClass("selected"),t=i.retrieve("date"),this.date=t.clone(),this.__uiDate=t.clone(),this.__selectedDate=t.clone(),i.addClass("selected");this.setCalendarDate();this.fireEvent("dateClicked",this.date),this.options.showTime||this.hide()}},nextMonth:function(e){var t=this.__uiDate.get("month"),i=t;i=i+1>11?0:i+1,this.changeMonth(i),0===i&&this.changeYear(this.__uiDate.get("year")+1)},lastMonth:function(e){var t=this.__uiDate.get("month"),i=t;i=i-1<0?11:i-1,this.changeMonth(i),11===i&&this.changeYear(this.__uiDate.get("year")-1)},changeMonth:function(e){this.doEvent=!1;var t=this.__uiDate.clone().set("date",1).set("month",e),i=t.get("lastdayofmonth"),s=this.__uiDate.get("date");s=s>i?i:s,this.__uiDate.set("date",1).set("month",e).set("date",s),this.setupCalendar(),this.setCalendarDate()},changeYear:function(e){this.doEvent=!1;var t=this.__uiDate.clone().set("date",1).set("month",e),i=t.get("lastdayofmonth"),s=this.__uiDate.get("date");s=s>i?i:s,this.__uiDate.set("date",1).set("year",e).set("date",s),this.setupCalendar(),this.setCalendarDate()},doEvent:!0,setCalendarDate:function(){var e=!1;return this.__selectedDate&&(this.__selectedDate.format(this.options.outputFormat)!==this.output.value&&(e=!0),this.display.value=this.__selectedDate.format(this.options.displayFormat),this.output.value=this.__selectedDate.format(this.options.outputFormat),this.printField&&this.printField.set("html",this.display.value)),this.doEvent&&(e&&window.fireEvent("formElementChanged",{element:this.output}),this.fireEvent("dateChanged",this.date),window.fireEvent("elementChanged",{element:this.output}),this.output.fireEvent("change",{target:this.output})),this.doEvent=!0,!0},getDate:function(){var e=this.getDateObject();return!!e&&e.format(this.options.outputFormat)},getDateObject:function(){if(this.__selectedDate)return this.__selectedDate;if(!this.options.nullable){if(this.date)return this.date;if(this.__uiDate)return this.__uiDate}return!1},getRawDate:function(){if(!this.__selectedDate)return!1;if(""===this.output.value)return!1;var e=Date.parse(this.output.value);return!(null===e||!typeOf(e)||!e.isValid())&&e},setDate:function(e,t){if(e&&"date"!==typeOf(e))try{e=Date.parse(e)}catch(e){return}e&&"date"===typeOf(e)&&e.isValid()?("boolean"===typeOf(t)&&!1===t&&(this.doEvent=!1),this.date=e,this.__uiDate=e.clone(),this.__selectedDate=e.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0):this.options.nullable?("boolean"===typeOf(t)&&!1===t&&(this.doEvent=!1),this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.setupCalendar(),this.output.value="",this.display.value="",this.doEvent=!0):(this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0)},setToday:function(e){this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.dontClose=!1,this.setupCalendar(!0)},setNone:function(e){this.date=this.__uiDate=new Date,this.__selectedDate=!1,this.output.value="",this.display.value="",this.showDefault=!1,this.dontClose=!1,this.output.fireEvent("change",{target:this.output})},attemptParse:function(e){if("null"===typeOf(e)||!e.type||"blur"!==e.type||"open"!==this.status||!this.calendarOver)if(!this.options.showCalendar&&this.options.showTime&&this.timeWidget);else{var t=this.display.value,i=!1;try{i=Date.parse(t)}catch(e){console.log(e)}if(i&&"date"==typeOf(i))if(i.isValid()){var s=!!this.__selectedDate&&this.__selectedDate.clone();this.date=i,this.__uiDate=i.clone(),this.__selectedDate=i.clone(),"null"!==typeOf(e)?this.setupCalendar(!0):this.setupCalendar(),s&&i.setMilliseconds(0)===this.date.setMilliseconds(0)||(this.setCalendarDate(),this.output.fireEvent("change",{target:this.output}))}else this.__selectedDate=!1,this.display.value="Invalid Date. No date set.",this.output.value="",this.output.fireEvent("change",{target:this.output});else this.options.nullable?(this.output.value="",this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.output.fireEvent("change",{target:this.output})):(this.__selectedDate?this.display.value=this.__selectedDate.format(this.options.displayFormat):this.display.value=this.__uiDate.format(this.options.displayFormat),this.printField&&this.printField.set("html",this.display.value));this.hide(null,"attemptParse "+this.id)}},positionOverride:!1,position:function(){var e,t,i=this.positionOverride?this.positionOverride.getPosition():this.display.getPosition(),s=this.positionOverride?this.positionOverride.getSize():this.display.getSize(),n=window.getSize(),o=i.y+s.y+5,a=i.x,r=this.options.cssPosition,l=this.calendarBox.measure(function(){return this.getSize()});if(Affinity.mobile){if(!this.calendarBox.hasClass("scaled")){a=0,s=l;var n=parent.getSize();n.x-=40,n.y-=40,e=s.x>s.y?Number(n.x/s.x).round(2):Number(n.y/s.y).round(2),s.y*e>n.y&&(e=Number(n.y/s.y).round(2)),s.x*e>n.x&&(e=Number(n.x/s.x).round(2)),n.x+40>s.x*e&&(a=(n.x+40-s.x*e)/2),t={position:"fixed",top:a,left:a,"-webkit-transform":"scale("+e+")","-webkit-transform-origin":"0 0",transform:"scale("+e+")","transform-origin":"0 0"},this.calendarBox.setStyles(t),this.calendarBox.addClass("scaled")}}else n.y-(i.y-window.getScroll().y)<l.y&&(o=i.y-l.y-5),i.x-window.getScroll().x+l.x>n.x&&(a=n.x-l.x-5),"fixed"===r&&(o-=window.getScroll().y),t={position:r,top:o,left:a},this.calendarBox.setStyles(t),this.delayedRePosition&&clearTimeout(this.delayedRePosition),this.delayedRePosition=setTimeout(function(){this.calendarBox.setStyles(t)}.bind(this),500)},watchOutputChanges:function(){var e=this.output.value,t=Date.parse(e);t&&t.hasOwnProperty("isValid")&&t.isValid()&&t!==this.date&&this.setDate(t,!1)},externalShow:function(e){e.stopPropagation(),Affinity.UI.calendars.hideAll(this),Affinity.mobile&&this.display.blur(),this.show()},obscure:function(){this.hide(),this.showbutton&&this.showbutton.addClass("hidden"),this.todaybutton&&this.todaybutton.addClass("hidden"),this.clearbutton&&this.clearbutton.addClass("hidden"),this.display&&this.display.addClass("hidden")},reveal:function(){this.showbutton&&this.showbutton.removeClass("hidden"),this.todaybutton&&this.todaybutton.removeClass("hidden"),this.clearbutton&&this.clearbutton.removeClass("hidden"),this.display&&this.display.removeClass("hidden")},show:function(e){this.options.showInline||(Affinity.UI.calendars.hideAll(this),this.position()),this.calendarBox.reveal(),this.status="open"},hide:function(e,t){this.options.showInline||this.dontClose||(this.monthbox&&this.monthbox.dissolve(),this.yearbox&&this.yearbox.dissolve(),this.calendarContainer&&this.calendarContainer.reveal(),this.calendarBox&&this.calendarBox.dissolve(),this.status="closed")},destroy:function(){if(clearInterval(this.checkExistsPeriodical),this.showbutton&&this.showbutton.removeEvents(),this.todaybutton&&this.todaybutton.removeEvents(),this.clearbutton&&this.clearbutton.removeEvents(),this.display&&this.display.removeEvents(),document.removeEvent(Affinity.events.click,this.documentClick),this.options.showCalendar&&(this.calendarContainer&&(Array.each(this.calendarContainer.getElements(".ui-calendar-day"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.calendarContainer.set("reveal",null),this.calendarContainer.set("tween",null),this.calendarContainer.removeEvents()),this.monthbox&&(Array.each(this.monthbox.getElements("span"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.monthbox.set("reveal",null),this.monthbox.set("tween",null),this.monthbox.removeEvents()),this.yearbox&&(Array.each(this.yearbox.getElements("span"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.yearbox.set("reveal",null),this.yearbox.set("tween",null),this.yearbox.removeEvents()),this.nextButton&&this.nextButton.removeEvents(),this.lastButton&&this.lastButton.removeEvents(),this.yearButton&&this.yearButton.removeEvents(),this.monthButton&&this.monthButton.removeEvents()),this.options.showTime&&this.timeWidget.destroy(),Affinity.UI.calendars.widgets[this.uuid]&&(Affinity.UI.calendars.widgets[this.uuid]=null,delete Affinity.UI.calendars.widgets[this.uuid]),this.buttons&&(this.buttons.empty(),this.buttons.destroy()),this.display&&this.display.destroy(),this.output&&this.output.destroy(),this.calendarBox&&(this.calendarBox.set("reveal",null),this.calendarBox.set("tween",null),this.calendarBox.removeEvents(),this.calendarBox.empty(),this.calendarBox.destroy()),this.options.target)try{this.options.target.eliminate("widget"),this.options.target.destroy()}catch(e){}Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this))}});Date.CurentYear=(new Date).get("year"),Date.FormatStrings=[["christmas","12.25."+(Date.CurentYear+1)],["xmas","12.25."+(Date.CurentYear+1)],["newyear","1.1."+(Date.CurentYear+1)],["new year","1.1."+(Date.CurentYear+1)]],Date.TimeTravel=[["day",/(\+|\-)\s*[0-9]+( )*(days|day|d)/],["week",/(\+|\-)\s*[0-9]+( )*(weeks|week|w)/],["month",/(\+|\-)\s*[0-9]+( )*(months|month|m)/],["year",/(\+|\-)\s*[0-9]+( )*(years|year|y)/]],Date.StringParse=function(e){Locale.use("en-GB");var t,i,s,n;for(e=e.toLowerCase().trim(),/^\d+$/.test(e)&&e.length>=6&&(e=e.length>8?1e3*parseInt(e,10)+"":e.substr(0,2)+"."+e.substr(2,2)+"."+e.substr(4)),t=0;t<Date.FormatStrings.length;t++)if(e.contains(Date.FormatStrings[t][0])){e=e.replace(Date.FormatStrings[t][0],Date.FormatStrings[t][1]);break}for(t=0;t<Date.TimeTravel.length;t++)e.test(Date.TimeTravel[t][1])&&(i=e.match(Date.TimeTravel[t][1])[0],s=i.match(/[0-9]+/)[0],i.indexOf("+")&&(n=Date.parse(e.replace(i,"").trim()).decrement(Date.TimeTravel[t][0],parseFloat(s))),i.indexOf("-")&&(n=Date.parse(e.replace(i,"").trim()).increment(Date.TimeTravel[t][0],parseFloat(s))));n=null==n?Date.parse(e):n;try{return 0==n.format("%s")?"Invalid Date":n}catch(e){return"Invalid Date"}};var UIDateCleverInput=new Class({Implements:[Options,Events],Binds:["processDateInput","dateKeyUp"],options:{displayFormat:"%A %e%o %B %Y",outputFormat:"%Y-%m-%d %H:%M:%S %Z%z",placeholderText:"Enter a date. Eg. 20 April 2020",helpHtml:'<strong>Enter any date in almost any fromat:</strong><br /><br />"22 1 2013", "22.01.13", "22/1", 22/1/13", etc.<br /><br /><strong>Enter date with normal language:</strong><br /><br />"22 Jan" or "22nd january 2013"<br />"Today", "Tomorrow", "Next Week", "Next Month", "Last Week", "Last Month", "Christmas", "Xmas", "New Year", "Newyear".<br /><br /><strong>Move forward or back in time:</strong><br /><br />"Today +10days", "Today +2weeks", "Christmas -1week", "22/1/13 +1month", etc.',hideOutput:!0},initialize:function(e){this.setOptions(e);var t,i;Array.each(document.getElements("input.date-cleverinput"),function(e){t=new Element("input",{type:"text",placeholder:this.options.placeholderText}).inject(e,"before"),i=new Element("span",{class:"date-display"}).inject(t,"after"),new Element("label").inject(t,"after"),new Element("br").inject(t,"after"),e.set("type","hidden"),t.store("display",i),t.store("output",e),t.addEvent("keyup",function(e){var t=Date.StringParse(e.target.value),i=e.target;"Invalid Date"==t?(i.retrieve("display").set("html",t),i.retrieve("output").value=""):(i.retrieve("display").set("html",t.format(this.options.displayFormat)),i.retrieve("output").value=t.format(this.options.outputFormat)),delete t,delete i}.bind(this))}.bind(this)),document.helpbubble&&document.helpicon&&new Element("span",{html:"?",class:"indicator black help","data-help":this.options.helpHtml}).inject(t,"after"),delete t,delete i}}),UIDateDropDowns=new Class({Implements:[Options],Binds:["processDates","setDate"],options:{dateMooFormat:"%d.%m.%Y"},initialize:function(e){this.setOptions(e),this.days=["sun","mon","tue","wed","thu","fri","sat"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.today=new Date,this.dateInputs=document.getElements("input.date-drops"),Array.each(this.dateInputs,this.processDates)},processDates:function(e){e.set("type","hidden");var t,i,s;""!=e.value&&(s=Date.parse(e.value),s.isValid()&&(this.today=s));var n=new Element("div",{class:"datepicker"}).inject(e,"before"),o=new Element("select",{class:"date-day"}).inject(n),a=new Element("select",{class:"date-month"}).inject(n),r=new Element("select",{class:"date-year"}).inject(n);new Element("br").inject(n),new Element("span").inject(n),n.adopt(e);var l=!1;for(""!=n.getElement("input").value&&null===(l=Date.parse(n.getElement("input").value))&&(l=!1),new Element("option",{value:"",html:""}).inject(o),t=0;t<31;t++)new Element("option",{value:t+1,html:t+1}).inject(o);for(l&&(o.value=parseInt(this.today.format("%e"),10)),new Element("option",{
value:"",html:""}).inject(a),t=0;t<12;t++)new Element("option",{value:t,html:this.months[t].capitalize()}).inject(a);for(l&&(a.value=parseInt(this.today.format("%m"),10)-1),new Element("option",{value:"",html:""}).inject(r),i=parseInt(this.today.format("%Y"),10),t=i-100;t<i+10;t++)new Element("option",{value:t,html:t}).inject(r);l&&(r.value=i),o.addEvent("change",this.setDate),a.addEvent("change",this.setDate),r.addEvent("change",this.setDate),this.setDate(null,n)},setDate:function(e,t){null!=e&&(t=e.target.getParent());var i=t.getElements("select");if(""===i[0].value||""===i[1].value||""===i[2].value)return t.getElement("input").value="",void t.getElement("span").set("html","");var s=(new Date).set("year",i[2].value).set("month",i[1].value).set("date",i[0].value).set("hr",0).set("min",0).set("sec",0).set("ms",0);s.isValid()&&(t.getElement("input").value=s.format(this.options.dateMooFormat),t.getElement("span").set("html",s.format("%A the %e%o of %B %Y"))),delete s,delete i}}),UIDatePicker=new Class({Implements:[Options],Binds:["targetClicked","buildMonth","show","hide","monthContainerClicked","yearContainerClicked","monthClicked","yearClicked",,"oldYears","newYears","dateClicked","nextMonth","lastMonth"],Options:{target:null,canSelectPast:!1,dateMooFormat:"%d/%m/%Y"},initialize:function(e){if(this.setOptions(e),null!=this.options.target){"string"==typeOf(this.options.target)?this.target=document.id(this.options.target):this.target=this.options.target;var t=["sun","mon","tue","wed","thu","fri","sat"],i=["january","february","march","april","may","june","july","august","september","october","november","december"];this.cal=new Element("div",{class:"uicalendar"}).inject(document.body);var s=this.target.getPosition(document.body);s.x+=10,s.y+=this.target.getSize().y+10,this.cal.setPosition(s),this.cal.fade("hide"),delete s,this.container=new Element("div",{class:"uical-container"}).inject(this.cal),this.container.addEvent("click",function(e){e.preventDefault(),e.stopPropagation()}),this.startDate=new Date,this.date=new Date,new Element("div",{class:"uical-last",html:"&#9668;"}).inject(this.container).addEvents({click:this.lastMonth,mousedown:function(e){e.preventDefault()}}),this.dateContainer=new Element("div",{class:"uical-date"}).inject(this.container),this.monthContainer=new Element("span").inject(this.dateContainer),this.yearContainer=new Element("span").inject(this.dateContainer),this.monthContainer.addEvent("click",this.monthContainerClicked),this.yearContainer.addEvent("click",this.yearContainerClicked),new Element("div",{class:"uical-next",html:"&#9658;"}).inject(this.container).addEvents({click:this.nextMonth,mousedown:function(e){e.preventDefault()}});var n,o;for(n=0;n<7;n++)n,o=0==n?"uical-day-title left":"uical-day-title",new Element("div",{class:o,html:t[n]}).inject(this.container);this.daysContainer=new Element("div",{class:"uical-days"}).inject(this.container),new Element("div",{class:"clear"}).inject(this.container),this.yearsContainer=new Element("div",{class:"uical-monthsyears uical-years"}).inject(this.container),new Element("div",{class:"uical-last",html:"&#9668;"}).inject(this.yearsContainer).addEvents({click:this.oldYears,mousedown:function(e){e.preventDefault()}}),new Element("div",{class:"uical-next",html:"&#9658;"}).inject(this.yearsContainer).addEvents({click:this.newYears,mousedown:function(e){e.preventDefault()}}),this.yearsInner=new Element("div",{class:"clear"}).inject(this.yearsContainer),this.yearsContainer.fade("hide");var a=parseInt(this.startDate.format("%Y"));for(n=a-13;n<a+12;n++)o=n==a?"uical-monthyear today":"uical-monthyear",new Element("div",{class:o,html:n}).inject(this.yearsInner).addEvent("click",this.yearClicked);delete yearsInner,this.monthsContainer=new Element("div",{class:"uical-monthsyears"}).inject(this.container),new Element("br").inject(this.monthsContainer);var r=new Element("div",{class:"clear"}).inject(this.monthsContainer);for(this.monthsContainer.fade("hide"),n=0;n<12;n++)o=n==a?"uical-monthyear today":"uical-monthyear",new Element("div",{class:o,html:i[n]}).store("index",n).inject(r).addEvent("click",this.monthClicked);delete r,this.buildMonth(),this.target.addEvent("click",this.targetClicked)}},buildMonth:function(){this.dateContainer.getElements("span")[0].set("html",this.date.format("%B")),this.dateContainer.getElements("span")[1].set("html",this.date.format("%Y"));var e,t,i,s="",n=this.date.clone(),o=parseInt(n.set("date",1).format("%w")),a=parseInt(n.get("lastdayofmonth")),r=parseInt(this.date.format("%e"))+o-1;for(e=0;e<42;e++)s=e>=o&&e<a+o?e+1-o:"",t=e%7==0?"uical-day left":"uical-day",t=e==r&&n.format("%m%Y")==this.startDate.format("%m%Y")?t+" today":t,t=this.options.canSelectPast?""!=s?t+" uical-selectable":t:e>=r&&""!=s?t+" uical-selectable":t,document.id("uical-day"+e)?(i=document.id("uical-day"+e),i.removeEvent("click",this.dateClicked),i.removeAttribute("class")):i=new Element("div",{id:"uical-day"+e}).inject(this.daysContainer),i.addClass(t),i.set("html",s),t.contains("uical-selectable")&&i.addEvent("click",this.dateClicked),delete i;delete e,delete t,delete s,delete n,delete o,delete a,delete r},monthContainerClicked:function(e){this.monthsContainer.fade("in")},monthClicked:function(e){this.date.set("month",e.target.retrieve("index")),this.buildMonth(),this.monthsContainer.fade("out")},oldYears:function(e){var t=parseInt(this.yearsInner.getFirst(".uical-monthyear").get("html"));Array.each(this.yearsInner.getElements(".uical-monthyear"),function(e,i){e.set("html",t-25+i)})},newYears:function(e){var t=parseInt(this.yearsInner.getLast(".uical-monthyear").get("html"));Array.each(this.yearsInner.getElements(".uical-monthyear"),function(e,i){e.set("html",t+i+1)})},yearContainerClicked:function(e){this.yearsContainer.fade("in")},yearClicked:function(e){this.date.set("year",e.target.get("html")),this.buildMonth(),this.yearsContainer.fade("out")},dateClicked:function(e){e.preventDefault(),e.stopPropagation();var t=e.target.hasClass("uical-day")?e.target:e.target.getParents(".uical-day")[0];this.date.set("date",t.get("html")),this.target.value=this.date.format(this.options.dateMooFormat),this.hide()},targetClicked:function(e){e.preventDefault(),e.stopPropagation();var t=parseInt(this.startDate.format("%Y"))-13;Array.each(this.yearsInner.getElements(".uical-monthyear"),function(e,i){e.set("html",t+i)}),this.show()},nextMonth:function(e){this.date.increment("month",1),this.buildMonth()},lastMonth:function(e){this.date.decrement("month",1),this.buildMonth()},show:function(){document.addEvent("click",this.hide),this.cal.fade("in")},hide:function(){document.removeEvent("click",this.hide),this.cal.fade("out"),this.monthsContainer.fade("out"),this.yearsContainer.fade("out")}}),UIDatePickerSimple=new Class({Implements:[Options],Binds:["processDates","setDate"],Options:{dateMooFormat:"%d.%m.%Y"},initialize:function(e){this.setOptions(e),this.days=["sun","mon","tue","wed","thu","fri","sat"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.today=new Date,this.dateInputs=document.getElements("input.date-drops"),Array.each(this.dateInputs,this.processDates)},processDates:function(e){e.set("type","hidden");var t,i,s;""!=e.value&&(s=Date.parse(e.value),s.isValid()&&(this.today=s));var n=new Element("div",{class:"simpledatepicker"}).inject(e,"before"),o=new Element("select",{class:"date-day"}).inject(n),a=new Element("select",{class:"date-month"}).inject(n),r=new Element("select",{class:"date-year"}).inject(n);for(new Element("br").inject(n),new Element("span").inject(n),n.adopt(e),t=0;t<31;t++)new Element("option",{value:t+1,html:t+1}).inject(o);for(o.value=parseInt(this.today.format("%e")),t=0;t<12;t++)new Element("option",{value:t,html:this.months[t].capitalize()}).inject(a);for(a.value=parseInt(this.today.format("%m"))-1,i=parseInt(this.today.format("%Y")),t=i-100;t<i+10;t++)new Element("option",{value:t,html:t}).inject(r);r.value=i,o.addEvent("change",this.setDate),a.addEvent("change",this.setDate),r.addEvent("change",this.setDate),this.setDate(null,n)},setDate:function(e,t){null!=e&&(t=e.target.getParent());var i=t.getElements("select"),s=(new Date).set("year",i[2].value).set("month",i[1].value).set("date",i[0].value).set("hr",0).set("min",0).set("sec",0).set("ms",0);t.getElement("input").value=s.format(this.Options.dateMooFormat),t.getElement("span").set("html",s.format("%A the %e%o of %B %Y"))}}),UIDisplayLookup=new Class({Version:"1.0.2.0",File:"ui.display.lookup.js",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","setValue","refreshQueue","cancelQueue","processQueue"],options:{jsonp:!1},enabled:!1,initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.displaylookups||(Affinity.UI.displaylookups={}),Affinity.UI.displaylookupLoaders=[],window.addEvent("refreshQueues",this.refreshQueue),window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this)),this.processNew()},processNew:function(e){this.setOptions(e);var t=document.getElements(".has-display-lookup");Array.each(t,this.processLookup),this.processQueue(),delete t},processLookup:function(e){var t,i;e.get("data-lookup-api")&&(e.removeClass("has-display-lookup"),""!==e.get("data-lookup-api")&&(t=e.get("data-lookup-api"),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.displaylookups[i]?Affinity.UI.displaylookups[i].elements.contains[e]||Affinity.UI.displaylookups[i].elements.push(e):Affinity.UI.displaylookups[i]={api:t,id:"dis_lookup_"+String.uniqueID(),type:"display",loaded:!1,elements:[e]}))},getApiKey:function(e){var t,i,s=new URI(e.toLowerCase()),n=s.get("query").parseQueryString(),o=[],a=[],r=!1,l="";return Object.each(n,function(e,t){"ran"!==t.toLowerCase()&&("parameters"!==t?o.push(t+"-"+e):r=JSON.parse(e))}),o=o.sort(),r&&"object"===typeOf(r)&&"parameter"in r&&"array"===typeOf(r.parameter)&&(Array.each(r.parameter,function(e){t=[],Object.each(e,function(e,i){"ran"!==i.toLowerCase()&&t.push(i+"-"+e)}),t.sort(),a.push(t.join("|"))}),a.sort(),l="|parameters|"+a.join("||")),i=o.join("|")+l,"display-"+i.replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,function(e){"cancel"in e&&e.cancel(),e.removeEvents(),e=null}),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,function(e,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null}),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){log("&#171; CANCEL AND CLEAR ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,function(e){"cancel"in e&&e.cancel(),"removeEvents"in e&&e.removeEvents(),e=null}),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,function(e,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null,Affinity.UI.displaylookups[t].elements=[],Affinity.UI.displaylookups[t]=null,delete Affinity.UI.displaylookups[t]}),Affinity.UI.displaylookups={}},processQueue:function(){var e,t;try{Object.each(Affinity.UI.displaylookups,function(i,s){if(!this.enabled)throw log("! display lookup queue disabled - process stooped !"),"break Object.each";!0===Affinity.UI.displaylookups[s].loaded&&this.setElements(s),!1===Affinity.UI.displaylookups[s].loaded&&(t=Affinity.UI.displaylookups[s].api,t.contains("ran=")||(t=t.contains("?")?t+="&ran="+String.uniqueID():t+="?ran="+String.uniqueID()),Affinity.UI.displaylookups[s].loaded="loading...",(e=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:t,method:"get",noCache:!0,onComplete:function(e){JSON.Unauthorized(e,Affinity.UI.displaylookups[s].id)||(Affinity.UI.displaylookups[s].data=e,"null"!==typeOf(e.success)&&!1===e.success?this.setError(s,e.error&&""!==e.error?e.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[s].loaded=!0,this.setElements(s)))}.bind(this)}):new Request.JSON({url:t,method:"get",noCache:!0,onSuccess:function(e){JSON.Unauthorized(e,Affinity.UI.displaylookups[s].id)||(Affinity.UI.displaylookups[s].data=e,"null"!==typeOf(e.success)&&!1===e.success?this.setError(s,e.error&&""!==e.error?e.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[s].loaded=!0,this.setElements(s)))}.bind(this)}))&&(Affinity.UI.displaylookupLoaders.push(e),e.send()))}.bind(this))}catch(e){}},setError:function(e,t){Array.each(Affinity.UI.displaylookups[e].elements,function(e){new Element("span",{class:"errorstr inplace-of-input",html:t}).inject(e,"after"),e.addClass("hidden")}.bind(this))},setElements:function(e){Array.each(Affinity.UI.displaylookups[e].elements,function(t){"null"!==typeOf(t)&&"function"===typeOf(t.get)&&t.get("data-lookup-api")&&this.setValue(Affinity.UI.displaylookups[e].data,t)}.bind(this))},setValue:function(e,t){if("array"===typeOf(e)&&e.length>0&&"null"!==typeOf(e[0].Value)&&""!==e[0].Value){var i=e[0].Value.trim();"cleverforms"!==Affinity.appname&&(i=e[0].Value.split(",").sort(function(e,t){return t.length-e.length})[0].trim()),t.getElement(".display")||t.hasClass("display")?(t.getElement(".display")&&t.getElement(".display").set("html",i),t.hasClass("display")&&t.set("html",i)):"value"in t?t.value=i:t.set("html",i),t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t}),delete i}}}),UIDrawPanels=new Class({Version:"1.0.0.0",File:"ui.drawpanel.js",Implements:[Options],Binds:["init","processDrawPad"],options:{},initialize:function(e){this.setOptions(e),this.init()},canvasSupported:function(){if(Browser.IE&&Borwser.version<9)return!1;var e=document.createElement("canvas");return void 0===e.getContext||"undefined"==typeOf(e.getContext("2d"))?(delete e,!1):(e.destroy(),delete e,!0)},processNew:function(){this.init()},init:function(){this.canvasSupported()&&Array.each(document.getElements(".ui-drawpad"),this.processDrawPad)},processDrawPad:function(e,t){e.removeClass("ui-drawpad");var i="",s="",n="",o=[];null!=e.get("data-bg-image")&&""!=e.get("data-bg-image")&&(bgnames=e.get("data-bg-name").split("||"),i=e.get("data-bg-image").split("||"),s=e.get("data-bg-image-width").split("||"),n=e.get("data-bg-image-height").split("||"),Array.each(i,function(e,t){o.push({name:bgnames[t],image:i[t],width:s[t],height:n[t]})})),new UIDrawPanel({element:e,bgImageData:o})}}),UIDrawPanel=new Class({Implements:[Options],Binds:["changeBgImage","canvasDown","canvasUp","setData","clear"],options:{element:null,bgImageData:[]},initialize:function(e){if(this.setOptions(e),this.icons={},this.icons.clear=Affinity.icons.CrossRound||"@Html.Raw(Affinity.UIFramework.Icons.CrossRound)",null==this.options.element)throw new Error("element must be set in options.");var t=this.options.element.get("name"),i=this.options.element.get("id"),s=this.options.element.value;this.element=new Element("input",{type:"hidden",value:s}).inject(this.options.element,"after"),this.options.element.destroy(),delete this.options.element,t&&this.element.set("name",t),i&&this.element.set("id",i);var n=500,o=Affinity.mobile?250:120;this.options.bgImageData.length>0&&(n=this.options.bgImageData[0].width,o=this.options.bgImageData[0].height),this.canvas=new Element("canvas",{class:"uidrawpanel",width:n,height:o}).inject(this.element,"after"),this.canvas.width=n,this.canvas.height=o,this.canvas.style.width=n+"px",this.canvas.style.height=o+"px",this.drawPanel=new SignaturePad(this.canvas,{}),this.canvas.addEventListener("CanvasReady",this.setData),this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(new Element("br").inject(this.canvas,"before"),new Element("label",{html:"Select Background"}).inject(this.canvas,"before"),this.imageSelect=new Element("select").addEvent("change",this.changeBgImage).inject(this.canvas,"before"),Array.each(this.options.bgImageData,function(e,t){this.imageSelect.adopt(new Element("option",{html:e.name,value:t}))}.bind(this)),this.imageSelect.adopt(new Element("option",{html:"No Image",value:-1}))),this.changeBgImage({target:{value:0}})),this.clearButton=new Element("span",{html:"<span>"+this.icons.clear+"</span>Clear",class:"button orange w-icon"}).inject(this.canvas,"after"),new Element("br").inject(this.element,"before"),new Element("br").inject(this.canvas,"before"),new Element("br").inject(this.canvas,"after"),this.clearButton.addEvent(Affinity.events.click,this.clear),this.canvas.addEvent(Affinity.events.start,this.canvasDown),this.canvas.addEvent(Affinity.events.end,this.canvasUp),document.addEvent(Affinity.events.end,this.canvasUp)},changeBgImage:function(e){var t=this.options.bgImageData[e.target.value];null==t&&(t={width:500,height:Affinity.mobile?250:120,image:null}),this.drawPanel.clear(),this.element.value="",this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",null!==t.image&&this.drawPanel.fromDataURL(t.image)},canvasDown:function(){this.eventIsDown=!0},canvasUp:function(){this.eventIsDown&&(this.eventIsDown=!1,this.setData())},setData:function(){this.element.value=this.drawPanel.toDataURL()},clear:function(){this.drawPanel.clear(),this.element.value="";var e={value:0};this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(e=this.imageSelect),this.changeBgImage({target:e}))}}),SignaturePad=function(e){"use strict";var t=function(e,t){var i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this._canvas=e,this._ctx=e.getContext("2d"),this.clear(),this._handleMouseEvents(),this._handleTouchEvents()};t.prototype.clear=function(){var e=this._ctx,t=this._canvas;e.fillStyle=this.backgroundColor,e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),this._reset()},t.prototype.toDataURL=function(e,t){var i=this._canvas;return i.toDataURL.apply(i,arguments)},t.prototype.fromDataURL=function(e){var t=this,i=new Image;this._reset(),i.src=e,i.onload=function(){t._ctx.drawImage(i,0,0,t._canvas.width,t._canvas.height),t._canvas.dispatchEvent(new CustomEvent("CanvasReady"))},this._isEmpty=!1},t.prototype._strokeUpdate=function(e){var t=this._createPoint(e);this._addPoint(t)},t.prototype._strokeBegin=function(e){this._reset(),this._strokeUpdate(e)},t.prototype._strokeDraw=function(e){var t=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;t.beginPath(),this._drawPoint(e.x,e.y,i),t.closePath(),t.fill()},t.prototype._strokeEnd=function(e){var t=this.points.length>2,i=this.points[0];!t&&i&&this._strokeDraw(i)},t.prototype._handleMouseEvents=function(){var t=this;this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",function(e){1===e.which&&(t._mouseButtonDown=!0,t._strokeBegin(e))}),this._canvas.addEventListener("mousemove",function(e){t._mouseButtonDown&&t._strokeUpdate(e)}),e.addEventListener("mouseup",function(e){1===e.which&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(e))})},t.prototype._handleTouchEvents=function(){var t=this;this._canvas.addEventListener("touchstart",function(e){var i=e.changedTouches[0];t._strokeBegin(i)}),this._canvas.addEventListener("touchmove",function(e){e.preventDefault();var i=e.changedTouches[0];t._strokeUpdate(i)}),e.addEventListener("touchend",function(e){e.target===t._canvas&&t._strokeEnd()})},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(e){var t=this._canvas.getBoundingClientRect();return new i(e.clientX-t.left,e.clientY-t.top)},t.prototype._addPoint=function(e){var t,i,n,o,a=this.points;a.push(e),a.length>2&&(3===a.length&&a.unshift(a[0]),o=this._calculateCurveControlPoints(a[0],a[1],a[2]),t=o.c2,o=this._calculateCurveControlPoints(a[1],a[2],a[3]),i=o.c1,n=new s(a[1],t,i,a[2]),this._addCurve(n),a.shift())},t.prototype._calculateCurveControlPoints=function(e,t,s){var n=e.x-t.x,o=e.y-t.y,a=t.x-s.x,r=t.y-s.y,l={x:(e.x+t.x)/2,y:(e.y+t.y)/2},h={x:(t.x+s.x)/2,y:(t.y+s.y)/2},u=Math.sqrt(n*n+o*o),c=Math.sqrt(a*a+r*r),d=l.x-h.x,p=l.y-h.y,m=c/(u+c),f={x:h.x+d*m,y:h.y+p*m},g=t.x-f.x,v=t.y-f.y;return{c1:new i(l.x+g,l.y+v),c2:new i(h.x+g,h.y+v)}},t.prototype._addCurve=function(e){var t,i,s=e.startPoint,n=e.endPoint;t=n.velocityFrom(s),t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(t),this._drawCurve(e,this._lastWidth,i),this._lastVelocity=t,this._lastWidth=i},t.prototype._drawPoint=function(e,t,i){var s=this._ctx;s.moveTo(e,t),s.arc(e,t,i,0,2*Math.PI,!1),this._isEmpty=!1},t.prototype._drawCurve=function(e,t,i){var s,n,o,a,r,l,h,u,c,d,p,m=this._ctx,f=i-t;for(s=Math.floor(e.length()),m.beginPath(),o=0;o<s;o++)a=o/s,r=a*a,l=r*a,h=1-a,u=h*h,c=u*h,d=c*e.startPoint.x,d+=3*u*a*e.control1.x,d+=3*h*r*e.control2.x,d+=l*e.endPoint.x,p=c*e.startPoint.y,p+=3*u*a*e.control1.y,p+=3*h*r*e.control2.y,p+=l*e.endPoint.y,n=t+l*f,this._drawPoint(d,p,n);m.closePath(),m.fill()},t.prototype._strokeWidth=function(e){return Math.max(this.maxWidth/(e+1),this.minWidth)};var i=function(e,t,i){this.x=e,this.y=t,this.time=i||(new Date).getTime()};i.prototype.velocityFrom=function(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1},i.prototype.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))};var s=function(e,t,i,s){this.startPoint=e,this.control1=t,this.control2=i,this.endPoint=s};return s.prototype.length=function(){var e,t,i,s,n,o,a,r,l=0;for(e=0;e<=10;e++)t=e/10,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),e>0&&(a=i-n,r=s-o,l+=Math.sqrt(a*a+r*r)),n=i,o=s;return l},s.prototype._point=function(e,t,i,s,n){return t*(1-e)*(1-e)*(1-e)+3*i*(1-e)*(1-e)*e+3*s*(1-e)*e*e+n*e*e*e},t}(document),UIDynamicGrid=new Class({Implements:[Options],Binds:["init","delRow","newRow","inputReplace","inputReturn","setOutputData","returnData"],Options:{container:null},tables:{},initialize:function(e){this.setOptions(e),this.focused=null,this.input=new Element("input",{type:"text",events:{focus:function(e){this.focused=e.target}.bind(this),blur:function(e){this.focused=null,this.inputReturn(e.target)}.bind(this)}}),this.input.addEvent("keydown",function(e){13==e.event.keyCode&&(e.stopPropagation(),e.preventDefault(),this.focused==e.target&&this.focused.blur())}.bind(this)),this.init()},init:function(){null==this.options.container&&(this.options.container=document.body),Array.each(document.getElements("table.dynamic"),function(e){var t=e,i=t.get("id");null==i&&(i=String.uniqueID(),t.set("id",i)),this.tables[i]||(this.tables[i]=t,document.id("listdata")?this.outputdatafield=document.id("listdata"):(this.outputdatafield=new Element("input",{id:"listdata",name:"listdata",type:"hidden"}),this.outputdatafield.inject(t,"after")),Array.each(t.getElements("td.dynamic"),function(e){e.addEvent("click",this.inputReplace)}.bind(this)))}.bind(this)),Array.each(document.getElements("table.dynamic .new, table.dynamic .del"),function(e){e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this))},inputReplace:function(e,t){if(null!==e?(element="td"==e.target.get("tag")?e.target:e.target.getParents("td")[0],e.preventDefault(),e.stopPropagation()):element=t,element.getElement("input"))this.input.focus();else{var i=element.get("html").stripTags().trim();element.empty();var s=element.getComputedSize();this.input.setStyles({width:s.width-10,height:s.height-2}),this.input.inject(element),this.input.value=i,this.input.focus(),element.setStyles({width:s.width,height:s.height}),delete i,delete s}},inputReturn:function(e){if(e&&"input"==e.get("tag")){var t=e.getParent(),i=e.getParents("table")[0],s=e.value.stripTags().trim();s=""==s?"Enter a value":s,t.empty(),t.set("html",s),this.setOutputData(i),delete s,delete t,delete i}},delRow:function(e){e.preventDefault();var t=e.target.getParents("table")[0];e.target.getParents("tr")[0].destroy(),this.setOutputData(t),this.zebra(t),delete t},newRow:function(e){e.preventDefault();var t,i,s=e.target.getParents("table")[0],n=s.getElement(".template").clone();e.target.getParents("th")[0]?(t=s,i="bottom"):(t=e.target.getParents("tr")[0],i="after"),n.removeClass("template"),n.removeClass("hidden"),n.inject(t,i),Array.each(n.getElements(".new,.del"),function(e){e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this)),Array.each(n.getElements("td.dynamic"),function(e){e.empty(),e.addEvent("click",this.inputReplace)}.bind(this)),this.inputReplace(null,n.getElement("td.dynamic")),this.zebra(s)},zebra:function(e){Array.each(e.getElements("tr"),function(e,t){t>0&&(e.addClass("odd"),t%2==0&&e.removeClass("odd"))}.bind(this))},setOutputData:function(e){var t=this.returnData(e,!0);this.outputdatafield.value=t,delete t},returnData:function(e,t){t=void 0!==t&&t;var i,s,n=[],o=e.getElements("tr th.has-data-name");return o.length>1?Array.each(e.getElements("tr"),function(e,t){t>0&&(i={},Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(s=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=s&&(i[o[t].get("data-name")]=s)}.bind(this)),Object.getLength(i)>0&&n.push(i))}.bind(this)):Array.each(e.getElements("tr"),function(e,t){Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(s=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=s&&n.push(s)}.bind(this))}.bind(this)),t&&(n=JSON.stringify(n)),n}}),saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},s=t.createElementNS("http://www.w3.org/1999/xhtml","a"),n=!e.externalHost&&"download"in s,o=function(i){var s=t.createEvent("MouseEvents");s.initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(s)},a=e.webkitRequestFileSystem,r=e.requestFileSystem||a||e.mozRequestFileSystem,l=function(t){(e.setImmediate||e.setTimeout)(function(){throw t},0)},h=0,u=[],c=function(){for(var e=u.length;e--;){var t=u[e];"string"==typeof t?i().revokeObjectURL(t):t.remove()}u.length=0},d=function(e,t,i){t=[].concat(t);for(var s=t.length;s--;){var n=e["on"+t[s]];if("function"==typeof n)try{n.call(e,i||e)}catch(e){l(e)}}},p=function(t,l){var c,p,m,f=this,g=t.type,v=!1,y=function(){var e=i().createObjectURL(t);return u.push(e),e},b=function(){d(f,"writestart progress write writeend".split(" "))},A=function(){!v&&c||(c=y()),p?p.location.href=c:window.open(c,"_blank"),f.readyState=f.DONE,b()},w=function(e){return function(){if(f.readyState!==f.DONE)return e.apply(this,arguments)}},E={create:!0,exclusive:!1};return f.readyState=f.INIT,l||(l="download"),n?(c=y(),s.href=c,s.download=l,o(s),f.readyState=f.DONE,void b()):(e.chrome&&g&&"application/octet-stream"!==g&&(m=t.slice||t.webkitSlice,t=m.call(t,0,t.size,"application/octet-stream"),v=!0),a&&"download"!==l&&(l+=".download"),("application/octet-stream"===g||a)&&(p=e),r?(h+=t.size,void r(e.TEMPORARY,h,w(function(e){e.root.getDirectory("saved",E,w(function(e){var i=function(){e.getFile(l,E,w(function(e){e.createWriter(w(function(i){i.onwriteend=function(t){p.location.href=e.toURL(),u.push(e),f.readyState=f.DONE,d(f,"writeend",t)},i.onerror=function(){var e=i.error;e.code!==e.ABORT_ERR&&A()},"writestart progress write abort".split(" ").forEach(function(e){i["on"+e]=f["on"+e]}),i.write(t),f.abort=function(){i.abort(),f.readyState=f.DONE},f.readyState=f.WRITING}),A)}),A)};e.getFile(l,{create:!1},w(function(e){e.remove(),i()}),w(function(e){e.code===e.NOT_FOUND_ERR?i():A()}))}),A)}),A)):void A())},m=p.prototype,f=function(e,t){return new p(e,t)};return m.abort=function(){var e=this;e.readyState=e.DONE,d(e,"abort")},m.readyState=m.INIT=0,m.WRITING=1,m.DONE=2,m.error=m.onwritestart=m.onprogress=m.onwrite=m.onabort=m.onerror=m.onwriteend=null,e.addEventListener("unload",c,!1),f.unload=function(){c(),e.removeEventListener("unload",c,!1)},f}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],function(){return saveAs}),String.prototype.endsWithAny=function(){for(var e=Array.prototype.slice.call(arguments),t=this.toLowerCase().toString(),i=0;i<e.length;i++)if(-1!==t.indexOf(e[i],t.length-e[i].length))return!0;return!1};var saveTextAs=saveTextAs||function(e,t,i){if(t=t||"download.txt",i=i||"utf-8",e=(e||"").replace(/\r?\n/g,"\r\n"),saveAs&&Blob){var s=new Blob([e],{type:"text/plain;charset="+i});return saveAs(s,t),!0}var n=window.frames.saveTxtWindow;if(!n&&(n=document.createElement("iframe"),n.id="saveTxtWindow",n.style.display="none",document.body.insertBefore(n,null),!(n=window.frames.saveTxtWindow)&&!(n=window.open("","_temp","width=100,height=100"))))return window.alert("Sorry, download file could not be created."),!1;var o=n.document;o.open("text/plain","replace"),o.charset=i,t.endsWithAny(".htm",".html")?(o.close(),o.body.innerHTML="\r\n"+e+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),o.write(e),o.close());var a=o.execCommand("SaveAs",null,t);return n.close(),a},UIFormHideables=new Class({Version:"1.0.0.0",File:"ui.form.hidables.js",Implements:[Options],Binds:["processNew","process","getHideableId","setupSelectSiwtch","doSelectSwitch"],options:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(e){this.setOptions(e),this.hideableTriggerElements=document.getElements(".is-hideable-switch"),Array.each(this.hideableTriggerElements,this.process)},process:function(e){var t=e.get("tag").toLowerCase();switch(e.removeClass("is-hideable-switch").addClass("hideable-switch"),t){case"select":this.setupSelectSiwtch(e)}},getHideableId:function(e){return"ui-hideable-id-"+e.trim().toLowerCase().replace(/ /g,"-")},setupSelectSiwtch:function(e){var t,i=[];Array.each(e.getElements("option"),function(e){t=this.getHideableId(e.value),i.push(t),document.getElement("."+t)&&document.getElement("."+t).set("reveal",{duration:250,mode:"vertical"}).toggle()}.bind(this)),e.store("hideable-targets",i),e.addEvent("change",this.doSelectSwitch),this.doSelectSwitch({type:"change",target:e})},doSelectSwitch:function(e){var t,i,s,n;"null"!==typeOf(e)&&"change"===e.type&&(t=e.target,i=t.retrieve("hideable-targets"),s=t.value,n=this.getHideableId(s),document.getElement("."+n)&&(Array.each(i,function(e){e!==n&&document.getElement("."+e)&&document.getElement("."+e).dissolve()}),document.getElement("."+n).reveal()))}}),UIFormatDate=new Class({Implements:[Options],Binds:["init","processDate"],options:{},initialize:function(e){this.setOptions(e),this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-format-date"),this.processDate)},processDate:function(e){var t,i,s;t="%I:%M:%S %p, %A %B %e%o %Y",e.get("data-date-format")&&""!==e.get("data-date-format").trim()&&(t=e.get("data-date-format").trim()),i=e.get("html").trim(),document.config.isie&&i.toLowerCase().contains("gmt")&&(i=i.replace(/GMT/gi,"")),i.toLowerCase().contains(".")&&(i=i.replace(/\./gi,"/")),s=Date.parse(i),s.isValid()&&e.set("html",s.format(t)),delete fromat,delete dateStrl,delete s}}),UIGraphGauge=new Class({Implements:[Options,Events],Binds:["setValue"],
options:{target:null,type:"bar",title:"",label:"",targetValue:!1,targetValueLabel:"",targetValueColor:"#000000",targetValueFontColor:"#999999",value:50,min:0,max:100,showMinMax:!0,gaugeWidthScale:1,showInnerShadow:!1,shadowOpacity:.2,shadowSize:5,shadowVerticalOffset:3,gaugeColor:"#edebeb",barColors:["#8dca35","#8dca35","#f9c802","#ff0000"],overlays:!1,barColorsGradient:!0,startAnimationTime:750,startAnimationType:"<>",refreshAnimationTime:750,refreshAnimationType:"<>",labelFontColor:"#b3b3b3",valueFontColor:"#010101",titleFontColor:"#999999",fontFamily:"'HelveticaNeue-Light', 'Helvetica Neue Light', 'Helvetica Neue', Helvetica, Arial, 'Lucida Grande', sans-serif"},initialize:function(e){this.setOptions(e),this.target=this.options.target,this.options.type=this.options.type.toLowerCase().trim(),this.options.id=this.target.get("id")?this.target.get("id"):String.uniqueID(),this.target.set("id",this.options.id),this.options.value>this.options.max&&(this.options.value=this.options.max),this.options.value<this.options.min&&(this.options.value=this.options.min);var t=this.target.getSize(),i=widgetW=t.x,s=widgetH=t.y;this.originalValue=this.options.value,this.canvas=Raphael(this.options.id,"110%","110%");var n=(i-widgetW)/2,o=(s-widgetH)/2,a=widgetH/8>10?widgetH/10:10,r=n+widgetW/2,l=o+widgetH/6.5,h=widgetH/6.4>16?widgetH/6.4:16,u=n+widgetW/2,c=o+widgetH/1.4,d=widgetH/16>10?widgetH/16:10,p=n+widgetW/2,m=c+h/2+6,f=widgetH/16>10?widgetH/16:10,g=n+widgetW/10+widgetW/6.666666666666667*this.options.gaugeWidthScale/2,v=o+widgetH/1.126760563380282,y=widgetH/16>10?widgetH/16:10,b=n+widgetW-widgetW/10-widgetW/6.666666666666667*this.options.gaugeWidthScale/2,A=o+widgetH/1.126760563380282;this.params={canvasW:i,canvasH:s,widgetW:widgetW,widgetH:widgetH,dx:n,dy:o,titleFontSize:a,titleX:r,titleY:l,valueFontSize:h,valueX:u,valueY:c,labelFontSize:d,labelX:p,labelY:m,minFontSize:f,minX:g,minY:v,maxFontSize:y,maxX:b,maxY:A},this.canvas.customAttributes.barArc=function(e,t,i,s,n,o,a,r){var l,h,u,c,d,p,m,f,g,v;return l=(1-(e-t)/(i-t))*Math.PI,h=s/2-s/10,u=h-s/6.666666666666667*r,c=s/2+o,d=n/1.25+a,p=s/2+o+h*Math.cos(l),m=n-(n-d)-h*Math.sin(l),f=s/2+o+u*Math.cos(l),g=n-(n-d)-u*Math.sin(l),v="M"+(c-u)+","+d+" ",v+="L"+(c-h)+","+d+" ",v+="A"+h+","+h+" 0 0 1 "+p+","+m+" ",v+="L"+f+","+g+" ",v+="A"+u+","+u+" 0 0 0 "+(c-u)+","+d+" ",v+="Z ",{path:v}},this.canvas.customAttributes.needle=function(e,t,i,s,n,o,a,r){var l,h=(1-(e-t)/(i-t))*Math.PI,u=s/2-s/10,c=u-s/4*r,d=n/1.25+a,p=s/2+o+u*Math.cos(h),m=n-(n-d)+a-u*Math.sin(h),f=s/2+o+c*Math.cos(h),g=n-(n-d)+a-c*Math.sin(h);return l+="M"+f+","+g+" ",l+="L"+p+","+m+" ",{path:l}},this.canvas.customAttributes.barSegment=function(e,t,i,s,n,o,a,r,l){var h,u=(1-(e-i)/(s-i))*Math.PI,c=n/2-n/10,d=c-n/6.666666666666667*l,p=o/1.25+r,m=n/2+a+c*Math.cos(u),f=o-(o-p)+r-c*Math.sin(u),g=n/2+a+d*Math.cos(u),v=o-(o-p)+r-d*Math.sin(u);h+="M"+m+","+f+" ",h+="L"+g+","+v+" ";var y=m,b=f;return u=(1-(t-i)/(s-i))*Math.PI,c=n/2-n/10,d=c-n/6.666666666666667*l,n/2+a,p=o/1.25+r,m=n/2+a+c*Math.cos(u),f=o-(o-p)+r-c*Math.sin(u),g=n/2+a+d*Math.cos(u),v=o-(o-p)+r-d*Math.sin(u),h+="A"+d+","+d+" 0 0 1 "+g+","+v+" ",h+="L"+m+","+f+" ",h+="A"+c+","+c+" 0 0 0 "+y+","+b+" ",h+="Z ",{path:h}},this.canvas.customAttributes.targetLine=function(e,t,i,s,n,o,a,r){var l,h=(1-(e-t)/(i-t))*Math.PI,u=s/2-s/10,c=u-s/6.666666666666667*r,d=n/1.25+a,p=s/2+o+u*Math.cos(h),m=n-(n-d)+a-u*Math.sin(h),f=s/2+o+c*Math.cos(h),g=n-(n-d)+a-c*Math.sin(h);return l+="M"+f+","+g+" ",l+="L"+p+","+m+" ",{path:l}},this.txtTitle=this.canvas.text(this.params.titleX,this.params.titleY,"-"),this.txtTitle.attr({"font-size":this.params.titleFontSize,"font-weight":"bold","font-family":this.options.fontFamily,fill:this.options.titleFontColor,"fill-opacity":0}),this.txtTitle.id=this.options.id+"-txttitle",this.txtLabel=this.canvas.text(this.params.labelX,this.params.labelY,"-"),this.txtLabel.attr({"font-size":this.params.labelFontSize,"font-weight":"normal","font-family":this.options.fontFamily,fill:this.options.labelFontColor,"fill-opacity":0}),this.txtLabel.id=this.options.id+"-txtlabel",this.gauge=this.canvas.path().attr({stroke:"none",fill:this.options.gaugeColor,barArc:[this.options.max,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]}),this.gauge.id=this.options.id+"-gauge";var w,E=[{name:"green",color:"#8dca35",description:"",min:0,max:0},{name:"orange",color:"#ff8640",description:"",min:0,max:0},{name:"red",color:"#e33100",description:"",min:0,max:0}];Array.each(E,function(e,t){w=this.canvas.path().attr({stroke:"none",fill:e.color,"fill-opacity":0,barSegment:[e.min,e.max,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]}),w.id=this.options.id+"-overlay-"+t}.bind(this)),"bar"===this.options.type&&(this.level=this.canvas.path().attr({stroke:"none",fill:this.getColorForPercentage(0,this.options.barColors,this.options.barColorsGradient),"fill-opacity":0,barArc:[this.options.min,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]}),this.level.id=this.options.id+"-level"),"needle"===this.options.type&&(this.level=this.canvas.path().attr({fill:"none",stroke:"black","stroke-width":1,"stroke-opacity":0,needle:[this.options.min,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]}),this.level.id=this.options.id+"-level");this.options.gaugeWidthScale;this.targetValue=this.canvas.path().attr({fill:"none",stroke:"black","stroke-width":1,"stroke-opacity":0,targetLine:[0,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]}),this.targetValue.id=this.options.id+"-targetValue";var x=this.gauge.getBBox().x+this.gauge.getBBox().width/2,C=this.params.labelY+this.txtLabel.getBBox().height;this.targetValueLabel=this.canvas.text(x,C,""),this.targetValueLabel.attr({"text-anchor":"middle","font-size":this.params.labelFontSize,"font-weight":"normal","font-family":this.options.fontFamily,fill:this.options.targetValueFontColor,"fill-opacity":0}),this.targetValueLabel.id=this.options.id+"-targetValuelabel",this.txtValue=this.canvas.text(this.params.valueX,this.params.valueY,this.originalValue),this.txtValue.attr({"font-size":this.params.valueFontSize,"font-weight":"bold","font-family":this.options.fontFamily,fill:this.options.valueFontColor,"fill-opacity":0}),this.txtValue.id=this.options.id+"-txtvalue";var k=this;eve.on("raphael.anim.frame."+k.options.id+"-level",function(e){var t,i;"bar"===k.options.type&&(t=k.level.attr("barArc")),"needle"===k.options.type&&(t=k.level.attr("needle")),i=k.originalVal%1!=0?Number.round(t[0],2):Math.round(t[0]),k.txtValue.attr({text:i})}),eve.on("raphael.anim.finish."+k.options.id+"-level",function(){k.txtValue.attr({text:k.originalVal})}),this.txtMin=this.canvas.text(this.params.minX,this.params.minY,""),this.txtMin.attr({"font-size":this.params.minFontSize,"font-weight":"normal","font-family":this.options.fontFamily,fill:this.options.labelFontColor,"fill-opacity":0}),this.txtMin.id=this.options.id+"-txtmin",this.txtMax=this.canvas.text(this.params.maxX,this.params.maxY,""),this.txtMax.attr({"font-size":this.params.maxFontSize,"font-weight":"normal","font-family":this.options.fontFamily,fill:this.options.labelFontColor,"fill-opacity":0}),this.txtMax.id=this.options.id+"-txtmax";var S=this.canvas.canvas.childNodes[1];document.config.isie?onCreateElementNsReady(function(){this.generateShadow()}):this.generateShadow("http://www.w3.org/2000/svg",S),this.setGuage({title:this.options.title,label:this.options.label,targetValue:this.options.targetValue,targetLabel:this.options.targetValueLabel,min:this.options.min,max:this.options.max,overlays:this.options.overlays,value:this.originalValue}),function(){this.fireEvent("complete")}.delay(this.options.startAnimationTime,this)},setGuage:function(e){e.title&&this.setTitle(e.title),e.label&&this.setLabel(e.label),"null"!==typeOf(e.min)&&"null"!==typeOf(e.max)&&this.setMinMax(e.min,e.max),e.overlays&&this.setOverlays(e.overlays),"null"!==typeOf(e.value)&&this.setValue(e.value),"null"!==typeOf(e.targetValue)&&e.targetLabel&&this.setTargetValue(e.targetValue,e.targetLabel)},setTitle:function(e){this.options.title=e,this.txtTitle.attr({text:e}),this.txtTitle.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType)},setLabel:function(e){this.options.label=e,this.txtLabel.attr({text:this.options.label}),this.txtLabel.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType)},setMinMax:function(e,t){this.options.min=e,this.options.max=t,this.options.value>this.options.max&&(this.options.value=this.options.max),this.options.value<this.options.min&&(this.options.value=this.options.min),this.txtMin.attr({text:this.options.min}),this.txtMin.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType),this.txtMax.attr({text:this.options.max}),this.txtMax.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType)},setTargetValue:function(e,t){this.options.targetValue=e,this.options.targetValueLabel=t;this.options.targetValue&&(this.targetValue.animate({"stroke-opacity":1,targetLine:[this.options.targetValue,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]},this.options.refreshAnimationTime,this.options.refreshAnimationType),this.targetValueLabel.attr({text:this.options.targetValueLabel}),this.targetValueLabel.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType))},setOverlays:function(e){var t;if(this.options.overlays=e,"array"===typeOf(this.options.overlays))Array.each(this.options.overlays,function(e,i){t=this.canvas.getById(this.options.id+"-overlay-"+i),t.animate({fill:e.color,"fill-opacity":1,barSegment:[e.min,e.max,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale]},this.options.refreshAnimationTime,this.options.refreshAnimationType)}.bind(this));else for(var i=0;i<50&&(t=this.canvas.getById(this.options.id+"-overlay-"+i));i++)t.animate({"fill-opacity":0},this.options.refreshAnimationTime,this.options.refreshAnimationType)},setValue:function(e){this.originalVal=e,this.options.value=e,this.options.value>this.options.max&&(this.options.value=this.options.max),this.options.value<this.options.min&&(this.options.value=this.options.min),function(){if(this.txtValue.attr({text:this.originalVal}),this.txtValue.attr("fill-opacity")<1&&this.txtValue.animate({"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType),"bar"===this.options.type){var t=(e-this.options.min)/(this.options.max-this.options.min);this.options.targetValue&&(t=(e-this.options.min)/(this.options.targetValue-this.options.min));var i=this.getColorForPercentage(t,this.options.barColors,this.options.barColorsGradient);this.canvas.getById(this.options.id+"-level").animate({barArc:[e,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale],fill:i,"fill-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType)}"needle"===this.options.type&&this.canvas.getById(this.options.id+"-level").animate({needle:[e,this.options.min,this.options.max,this.params.widgetW,this.params.widgetH,this.params.dx,this.params.dy,this.options.gaugeWidthScale],"stroke-opacity":1},this.options.refreshAnimationTime,this.options.refreshAnimationType)}.delay(1e3,this)},generateShadow:function(e,t){var i=document.createElementNS(e,"filter");i.setAttribute("id",this.options.id+"-inner-shadow"),t.appendChild(i);var s=document.createElementNS(e,"feOffset");s.setAttribute("dx",0),s.setAttribute("dy",this.options.shadowVerticalOffset),i.appendChild(s);var n=document.createElementNS(e,"feGaussianBlur");n.setAttribute("result","offset-blur"),n.setAttribute("stdDeviation",this.options.shadowSize),i.appendChild(n);var o=document.createElementNS(e,"feComposite");o.setAttribute("operator","out"),o.setAttribute("in","SourceGraphic"),o.setAttribute("in2","offset-blur"),o.setAttribute("result","inverse"),i.appendChild(o);var a=document.createElementNS(e,"feFlood");a.setAttribute("flood-color","black"),a.setAttribute("flood-opacity",this.options.shadowOpacity),a.setAttribute("result","color"),i.appendChild(a);var r=document.createElementNS(e,"feComposite");r.setAttribute("operator","in"),r.setAttribute("in","color"),r.setAttribute("in2","inverse"),r.setAttribute("result","shadow"),i.appendChild(r);var l=document.createElementNS(e,"feComposite");l.setAttribute("operator","over"),l.setAttribute("in","shadow"),l.setAttribute("in2","SourceGraphic"),i.appendChild(l),1==this.options.showInnerShadow&&Array.each(this.canvas.canvas.childNodes,function(e,t){"path"!==e.get("tag")||e.get("data-no-shadow")||this.canvas.canvas.childNodes[t].setAttribute("filter","url(#"+this.options.id+"-inner-shadow)")}.bind(this))},getColorForPercentage:function(e,t,i){if(e>1)return t[t.length-1];var s=t.length;if(1===s)return t[0];for(var n=i?1/(s-1):1/s,o=new Array,a=0;a<t.length;a++){var r=i?n*a:n*(a+1),l=parseInt(this.cutHex(t[a]).substring(0,2),16),h=parseInt(this.cutHex(t[a]).substring(2,4),16),u=parseInt(this.cutHex(t[a]).substring(4,6),16);o[a]={pct:r,color:{r:l,g:h,b:u}}}if(0==e)return"rgb("+[o[0].color.r,o[0].color.g,o[0].color.b].join(",")+")";for(var a=0;a<o.length;a++)if(e<=o[a].pct){if(1==i){var c=o[a-1],d=o[a],p=d.pct-c.pct,m=(e-c.pct)/p,f=1-m,g=m,v={r:Math.floor(c.color.r*f+d.color.r*g),g:Math.floor(c.color.g*f+d.color.g*g),b:Math.floor(c.color.b*f+d.color.b*g)};return"rgb("+[v.r,v.g,v.b].join(",")+")"}return"rgb("+[o[a].color.r,o[a].color.g,o[a].color.b].join(",")+")"}},cutHex:function(e){return"#"==e.charAt(0)?e.substring(1,7):e}}),UIDynamicGrid=new Class({Implements:[Options],Binds:["init","moveUp","moveDn","delRow","newRow","inputReplace","inputReturn","setOutputData","returnData","handleCSVFile","saveCSV"],options:{container:null},tables:{},initialize:function(e){this.setOptions(e),this.docsv=!1,this.iemode=!1,document.config&&document.config.isie&&document.config.ieversion&&document.config.ieversion>10?window.encodeURIComponent&&window.FileReader&&(this.docsv=!0,this.iemode=!0):window.encodeURIComponent&&window.FileReader&&(this.docsv=!0),this.focused=null,this.input=new Element("input",{type:"text",events:{focus:function(e){this.focused=e.target}.bind(this),blur:function(e){this.focused=null,this.inputReturn(e.target)}.bind(this)}}),this.input.addEvent("keydown",function(e){13==e.event.keyCode&&(e.stopPropagation(),e.preventDefault(),this.focused==e.target&&this.focused.blur())}.bind(this)),this.init()},init:function(){null==this.options.container&&(this.options.container=document.body),Array.each(document.getElements("table.dynamic"),function(e){var t=e,i=t.get("id");null==i&&(i=String.uniqueID(),t.set("id",i)),this.tables[i]||(this.tables[i]=t,this.docsv&&(this.csvUploader=new Element("input",{type:"file",accept:".csv"}).store("id",i).addEvent("change",this.handleCSVFile),this.iemode?new Element("span",{class:"csvdrop-ie button green",html:"Load CSV"}).adopt(this.csvUploader).inject(t.getElement(".new"),"before"):new Element("span",{class:"csvdrop ui-has-tooltip","data-tooltip":"Drop CSV file here","data-tooltip-dir":"top",html:Affinity.icons.Upload2}).adopt(this.csvUploader).inject(t.getElement(".new"),"before")),document.id("listdata")?this.outputdatafield=document.id("listdata"):(this.outputdatafield=new Element("input",{id:"listdata",name:"listdata",type:"hidden"}),this.outputdatafield.inject(t,"after")),Array.each(t.getElements("td.dynamic"),function(e){e.addEvent("click",this.inputReplace)}.bind(this))),this.docsv&&new Element("span",{class:"button w-icon green save"}).adopt(new Element("span",{html:Affinity.icons.Save}),new Element("span",{html:"Save list as CSV file"})).store("id",i).addEvent("click",this.saveCSV).inject(t.getParent(),"after"),Affinity.tooltips.processNew(),this.zebra(t),this.setOutputData(t)}.bind(this)),Array.each(document.getElements("table.dynamic .new, table.dynamic .del, table.dynamic .up, table.dynamic .dn"),function(e){e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow),e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn)}.bind(this))},inputReplace:function(e,t){if(null!==e?(element="td"==e.target.get("tag")?e.target:e.target.getParent("td"),e.preventDefault(),e.stopPropagation()):element=t,element.getElement("input"))this.input.focus();else{var i=element.get("html").stripTags().trim();element.empty();var s=element.getComputedSize();this.input.setStyles({width:s.width-10,height:s.height-2}),this.input.inject(element),i="Enter a value"==i?"":i,this.input.value=i,this.input.focus(),element.setStyles({width:s.width,height:s.height}),delete i,delete s}},inputReturn:function(e){if(e&&"input"==e.get("tag")){var t=e.getParent(),i=e.getParents("table")[0],s=e.value.stripTags().trim();s=""==s?"Enter a value":s,t.empty(),t.set("html",s),this.setOutputData(i),delete s,delete t,delete i}},moveUp:function(e){e.preventDefault();var t=e.target.getParent("table"),i=t.getElement("tbody"),s=t.getElement(".template").clone();t.getElement(".template").destroy();var n=e.target.getParent("tr"),o=i.getElements("tr"),a=o.indexOf(n);a>1&&n.inject(o[a-1],"before"),this.setOutputData(t),this.zebra(n.getParent("table")),s.inject(i),delete t,delete i,delete s,delete n,delete o,delete a},moveDn:function(e){e.preventDefault();var t=e.target.getParent("table"),i=t.getElement("tbody"),s=t.getElement(".template").clone();t.getElement(".template").destroy();var n=e.target.getParent("tr"),o=i.getElements("tr"),a=o.indexOf(n);a<o.length-1&&n.inject(o[a+1],"after"),this.setOutputData(t),this.zebra(n.getParent("table")),s.inject(i),delete t,delete i,delete s,delete n,delete o,delete a},delRow:function(e){e.preventDefault();var t=e.target.getParents("table")[0];e.target.getParents("tr")[0].destroy(),this.setOutputData(t),this.zebra(t),delete t},newRow:function(e){try{e.preventDefault()}catch(e){}var t,i,s=e.target.getParents("table")[0],n=s.getElement(".template").clone();e.target.getParents("th")[0]?(t=s,i="bottom"):(t=e.target.getParents("tr")[0],i="after"),n.removeClass("template"),n.removeClass("hidden"),n.inject(t,i),Array.each(n.getElements(".new,.del,.up,.dn"),function(e){e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn),e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this)),Array.each(n.getElements("td.dynamic"),function(e){e.empty(),e.addEvent("click",this.inputReplace)}.bind(this)),this.inputReplace(null,n.getElement("td.dynamic")),this.zebra(s)},zebra:function(e){Array.each(e.getElements("tr"),function(e,t){t>0&&(e.addClass("odd"),t%2==0&&e.removeClass("odd"))}.bind(this))},setOutputData:function(e){var t=this.returnData(e,!0);return this.outputdatafield.value=t,t},returnData:function(e,t){t=void 0!==t&&t;var i,s,n=[],o=e.getElements("tr th.has-data-name");return o.length>1?Array.each(e.getElements("tr"),function(e,t){t>0&&(i={},Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(s=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=s&&(i[o[t].get("data-name")]=escape(s))}.bind(this)),Object.getLength(i)>0&&n.push(i))}.bind(this)):Array.each(e.getElements("tr"),function(e,t){Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(s=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=s&&n.push(escape(s))}.bind(this))}.bind(this)),t&&(n=JSON.stringify(n)),n},handleCSVFile:function(e){var t=e.target,i=t.retrieve("id"),s=this.tables[i],n=s.getElement("tbody");Affinity.prompts.hide();var o=new FileReader;o.readAsText(t.files[0]),o.onload=function(e){var i,o,a=e.target.result,r=a.split(/\r\n|\n/);for(i=0;i<r.length;i++)""!=r[i]&&(o=s.getElement(".template").clone().removeClass("template").removeClass("hidden").inject(n,"bottom"),Array.each(o.getElements(".new,.del,.up,.dn"),function(e){e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn),e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this)),Array.each(o.getElements("td.dynamic"),function(e){e.set("html",r[i]),e.addEvent("click",this.inputReplace)}.bind(this)));this.zebra(s),t.files=[],t.value="",this.setOutputData(s)}.bind(this),o.onerror=function(e){"NotReadableError"==e.target.error.name&&console.log("Can't read file!")}.bind(this)},saveCSV:function(e){var t=e.target.hasClass("save")?e.target:e.target.getParent(".button.save"),i=t.retrieve("id"),s=this.tables[i],n=(s.getElement("tbody"),this.setOutputData(s)),o=unescape(n).replace("[","").replace("]","").split(",").join("\r\n");uiprompt({message:"Please enter a name for your file",onOk:function(e){if(this.iemode)saveTextAs(o,e+".csv");else{var t=new Blob([o],{type:"text/plain;charset=utf-8"});saveAs(t,e+".csv")}}.bind(this)})}}),UIGrid=new Class({Version:"1.0.0.0",File:"ui.grid.js",Implements:[Options],Binds:["processTables","setupTable","zebra"],options:{},tables:{},initialize:function(e){this.setOptions(e),this.processTables(),Affinity.UI.Grids={},Affinity.UI.Grids.Zebra=this.zebra},processTables:function(e,t){var i;null==e?Array.each(document.getElements("table.ui-grid"),function(e){i=""==e.get("id")?String.uniqueID():e.get("id"),"null"==typeOf(this.tables[i])?(this.tables[i]=e,this.setupTable(e,t)):this.zebra(e,t)}.bind(this)):e.hasClass("ui-grid")&&(i=""==e.get("id")?String.uniqueID():e.get("id"),"null"==typeOf(this.tables[i])?(this.tables[i]=e,this.setupTable(e,t)):this.zebra(e,t)),delete i},setupTable:function(e,t){this.zebra(e,t)},zebra:function(e,t){var i="tr";void 0!==t&&"string"==typeof t&&(i="tr."+t);var s=null==e?document.getElements("table.ui-grid"):[e],n=0;Array.each(s,function(e){n=0,"getElements"in e&&(e.getElements(i).removeClass("odd"),Array.each(e.getElements("tbody "+i),function(e,t){e.hasClass("hidden")||(e.addClass(n%2==0?"":"odd"),n++)}.bind(this)))}.bind(this)),delete n}}),UIScrollableGrid=new Class({Implements:[Options],Binds:["resize","preventScroll"],options:{},initialize:function(e){this.setOptions(e);var t,i;Array.each(document.getElements("table.ui-grid-scrollable"),function(e){this.processTable(e)}.bind(this)),delete t,delete i,this.resize()},processTable:function(e){e.get("data-height")&&(e.getParent().hasClass("section-table")||e.getParent().hasClass("page-table"))&&e.getElements("tbody tr").length>0&&(tablebox=e.getParent(),titles=tablebox.clone(),tablebox.addClass("ui-gridbox-scrollable"),titles.getElement("tbody")&&titles.getElement("tbody").destroy(),titles.getElement("tfoot")&&titles.getElement("tfoot").destroy(),e.getElement("thead")&&e.getElement("thead").destroy(),titles.inject(tablebox,"before").store("table",e).addClass("ui-gridbox-scrollable-titles"),tablebox.store("height",e.get("data-height")).setStyles({"max-height":e.get("data-height")+"px",overflow:"auto"}),titles.getElement("table").removeClass("ui-grid-scrollable").erase("data-height"),e.addEvent("mousewheel",this.preventScroll))},resize:function(e){var t,i,s;Array.each(document.getElements(".ui-gridbox-scrollable-titles"),function(e){t=e.getElements("th"),i=e.retrieve("table"),s=i.getElement("tr").getElements("td"),Array.each(s,function(e,i){i<s.length-1&&t[i].setStyle("width",e.getSize().x-12)})}),delete t,delete i,delete s},preventScroll:function(e){var t="table"==e.target.get("tag")?e.target.getParent():e.target.getParent("table").getParent(),i=t.getScroll();e.wheel>0&&i.y<=0&&e.preventDefault(),e.wheel<0&&i.y>=t.getScrollSize().y-parseFloat(t.retrieve("height"))&&e.preventDefault(),delete t,delete i}}),UISortableGrid=new Class({Version:"1.0.0.0",File:"ui.grid.sortable.js",Implements:[Options,Events],Binds:["checkTables","processTable","multisort","sortColumn"],options:{},tables:{},initialize:function(e){if(this.setOptions(e),"class"!=typeOf(UIGrid)||"null"==typeOf(Affinity.uiGrid))throw new Error({"Missing Component":"UISortableGrid requires UIGrid"});this.icons={},this.icons.unsorted=Affinity.icons.ArrowheadUpDown||"&#xe0cc;",this.icons.sortup=Affinity.icons.ArrowheadUp||"&#xe0ba;",this.icons.sortdn=Affinity.icons.ArrowheadDown||"&#xe0b9;",Array.each(document.getElements("table"),this.checkTables)},checkTables:function(e){e.getElements("thead th.sort-on").length>0&&this.processTable(e)},processTable:function(e,t){this.headers=e.getElements("thead th");var i=e.getElements("tbody tr"),s=e.get("id")?e.get("id"):String.uniqueID();e.get("data-icon")&&(this.icons.unsorted=e.get("data-icon")),e.get("data-up-icon")&&(this.icons.sortup=e.get("data-up-icon")),e.get("data-down-icon")&&(this.icons.sortdn=e.get("data-down-icon")),e.set("id",s),this.tables[s]={},this.tables[s].table=e,this.tables[s].columns={};var n=0;if(Array.each(this.headers,function(e,t){e.hasClass("sort-on")&&(e.getElement("div.icon")||(e.adopt(new Element("div",{class:"icon",html:this.icons.unsorted})),e.addEvent("mousedown",function(e){e.preventDefault()}),e.addEvent("click",this.sortColumn)),this.tables[s].columns["h"+t]={method:e.get("data-sort-method"),direction:-1,sortables:[]})}.bind(this)),Array.each(i,function(e,t){Array.each(e.getElements("td"),function(e,t){this.tables[s].columns["h"+t]&&("string"===this.tables[s].columns["h"+t].method&&this.tables[s].columns["h"+t].sortables.push([e.get("html"),e]),"date"===this.tables[s].columns["h"+t].method&&(""==e.get("html")?this.tables[s].columns["h"+t].sortables.push([Date.parse(0).format("%s"),e]):this.tables[s].columns["h"+t].sortables.push([Date.parse(e.get("html")).format("%s"),e])),"float"!==this.tables[s].columns["h"+t].method&&"integer"!==this.tables[s].columns["h"+t].method||(""==e.get("html")?this.tables[s].columns["h"+t].sortables.push(0,e):this.tables[s].columns["h"+t].sortables.push([Number.from(e.get("html").replace(/[\s,$]/g,"")),e]))),n++}.bind(this))}.bind(this)),this.tables[s].total=n,e.set("tween",{duration:250}),Affinity.uiGrid.zebra(e,t),Affinity.hasOwnProperty("pageId")){var o,a="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId,r=Affinity.CookieMonster.Read(a),l=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase();r&&(r=JSON.parse(r),o=Date.parse(r.date),r.href===l&&(new Date).getTime()-o.getTime()<18e5&&(this.tables[e.get("id")].columns["h"+r.columnIndex].direction=-1*r.direction,this.sortColumn({target:e.getElements("th")[r.columnIndex]})),(new Date).getTime()-o.getTime()>18e5&&Affinity.CookieMonster.Delete(a))}},multisort:function(e,t){return e[0]==t[0]?0:e[0]<t[0]?-1:1},sortColumn:function(e){this.tables[e.target.getParent("table").get("id")].total>5e3?(e.target.getParent("table").fade(.25),this.continueSort.delay(500,this,[e])):this.continueSort(e)},continueSort:function(e){var t="th"===e.target.get("tag")?e.target:e.target.getParent("th"),i=t.getParent("table"),s=i.getElement("tbody"),n=this.tables[i.get("id")].columns["h"+i.getElements("th").indexOf(t)];if(Array.each(i.getElements("thead th"),function(e){e.getElement(".icon")&&e.getElement(".icon").set("html",this.icons.unsorted)}.bind(this)),n.direction*=-1,n.sortables.sort(this.multisort),n.direction<0&&n.sortables.reverse(),t.getElement(".icon").set("html",n.direction>0?this.icons.sortup:this.icons.sortdn),Array.each(n.sortables,function(e){e[1].getParent("tr").inject(s,"top")}.bind(this)),Affinity.uiGrid.zebra(i),i.fade(1),Affinity.hasOwnProperty("pageId")){var o,a={};a.date=new Date,a.href=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase(),a.direction=n.direction,a.columnIndex=i.getElements("th").indexOf(t),o=JSON.stringify(a);var r="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId;Affinity.CookieMonster.Write(r,o)}delete t,delete i,delete s,delete n},returnData:function(e,t){t=void 0!==t&&t;var i,s=[],n=e.getElements("tr th");return Array.each(e.getElements("tr"),function(e){i={},Array.each(e.getElements("td"),function(e,t){i[n[t].get("data-name")]=e.get("html")}.bind(this)),Object.getLength(i)>0&&s.push(i)}.bind(this)),t?JSON.stringify(s):s}}),UIHelpBubble=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:["populate","alignTo","position","hide","show"],options:{fadeTime:100},initialize:function(e){this.setOptions(e),document.getElement(".helpBubble.float")||(this.helpBubble=new Element("div",{class:"helpBubble right float"}).inject(document.body,"bottom"),this.helpBubble.set("tween",{duration:this.options.fadeTime}),this.helpBubble.fade("hide"))},populate:function(e){this.helpBubble&&(this.helpBubble.empty(),"element"==typeOf(e)&&this.helpBubble.adopt(e),"string"==typeOf(e)&&this.helpBubble.set("html",e),this.addClass("right"),this.setDirection("left"))},alignTo:function(e){var t=e.getPosition(),i=e.getSize();this.position({x:t.x+i.x+5,y:t.y+i.y/2-15})},setDirection:function(e){if(this.helpBubble){e=e.toLowerCase().trim()||"left";var t=["top","left","right","bottom","bottom-right","top-right"];t.contains(e)&&(Array.each(t,function(e){this.helpBubble.removeClass(e)}.bind(this)),this.addClass(e))}},addClass:function(e){this.helpBubble&&this.helpBubble.addClass(e)},position:function(e){this.helpBubble&&this.helpBubble.setStyles({top:e.y,left:e.x})},show:function(e){this.helpBubble&&(e&&!0===e&&(this.helpBubble.addEvent(Affinity.events.outAll,this.hide),this.helpBubble.addEvent(Affinity.events.overAll,this.show)),this.helpBubble.fade("in"))},hide:function(){this.helpBubble&&(this.helpBubble.removeEvents(),this.helpBubble.fade("out"))},getSize:function(){if(this.helpBubble)return this.helpBubble.measure(function(){return this.getSize()})}}),UIHelpIcon=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:[],options:{},initialize:function(e){if(this.setOptions(e),!Affinity.tooltips)throw"UI Help Icon requires UI Tooltips";Array.each(document.getElements(".indicator.help"),function(e){e.get("data-help")&&(e.set("data-tooltip",e.get("data-help")),e.addClass("ui-has-tooltip"),e.erase("data-help"))}.bind(this)),Affinity.tooltips.init()}}),UIHelpIcon=new Class({Implements:[Options],Binds:["helpOver","helpOut"],options:{},initialize:function(e){this.setOptions(e),Array.each(document.getElements(".indicator.help"),function(e){e.get("data-help")&&(e.addEvent(window.overAllEvent,this.helpOver),e.addEvent(window.outAllEvent,this.helpOut))}.bind(this))},helpOver:function(e){document.helpbubble.alignTo(e.target),document.helpbubble.populate(e.target.get("data-help")),document.helpbubble.show()},helpOut:function(e){document.helpbubble.hide()}}),UIHidables=new Class({Version:"1.0.0.0",File:"ui.hidables.js",Implements:[Options],Binds:["processNew","process","processTriggers","processEachTrigger","triggerClicked"],options:{},initialize:function(e){this.setOptions(e),this.hidableFxs={},this.processTriggers()},processNew:function(){this.processTriggers()},processTriggers:function(){var e=document.getElements(".has-hidable");e.length>0&&Array.each(e,this.processEachTrigger)},process:function(e){this.processEachTrigger(e)},processEachTrigger:function(e,t){var i,s=e.get("data-hidable-trigger-id");document.id(s)&&(i=document.id(e.get("data-hidable-trigger-id")),
i.store("hidableFx",new Fx.Reveal(i,{duration:250,mode:"vertical"})),e.addEvent("click",this.triggerClicked),i.setStyle("display","none"),i.removeClass("hidden"),i.hasClass("auto-hide")||i.retrieve("hidableFx").reveal())},triggerClicked:function(e){var t=!0,i=(e.target,document.id(e.target.get("data-hidable-trigger-id")));"checkbox"!=e.target.get("type")||e.target.checked||(t=!1),t?(i.retrieve("hidableFx").reveal(),e.target.get("name")&&Array.each(document.getElements("input[name="+e.target.get("name")+"]"),function(t){t!=e.target&&document.id(t.get("data-hidable-trigger-id")).retrieve("hidableFx").dissolve()}.bind(this))):i.retrieve("hidableFx").dissolve()}}),UIHideToggle=new Class({Implements:[Options],Binds:["init","processNew","processToggle"],options:{},initialize:function(e){this.setOptions(e),this.init()},init:function(){this.processNew()},processNew:function(){Array.each(document.getElements(".ui-hide-toggle"),this.processToggle)},processToggle:function(e,t){e.hasClass("ui-hide-toggle")&&(e.removeClass("ui-hide-toggle"),new UIHideToggleWidget({element:e}))}}),UIHideToggleWidget=new Class({Implements:[Options],Binds:["childFocus","toggle","hide","show"],options:{element:null},isHidden:!1,initialize:function(e){this.setOptions(e),this.element=this.options.element,this.toggleid=this.element.get("data-hide-toggle-id"),this.togglelement=document.id(this.toggleid),this.icons={},this.icons.hide=Affinity.icons.ResizeShrink||"&#xe0b4;",this.icons.show=Affinity.icons.ResizeEnlarge||"&#xe0b3;",this.togglelement&&(this.element.set("reveal",{duration:250,onHide:function(e){e.addClass("subhidden")}.bind(this)}),this.togglelement.set("html",this.icons.hide),this.togglelement.addEvent("click",this.toggle),Array.each(this.element.getElements("input,textarea,select"),function(e){e.addEvent("focus",this.childFocus)}.bind(this)));var t=this.element.get("data-hide-toggle-state");t&&"hidden"==t&&(this.element.addClass("subhidden"),this.element.setStyle("display","none"),this.isHidden=!0,this.togglelement.set("html",this.icons.show)),this.element.removeClass("hidden")},childFocus:function(e){this.isHidden&&this.element.contains(e.target)&&this.show()},toggle:function(){this.isHidden?this.show():this.hide()},hide:function(){this.isHidden=!0,this.togglelement.set("html",this.icons.show),this.element.dissolve()},show:function(){this.element.removeClass("subhidden"),this.isHidden=!1,this.togglelement.set("html",this.icons.hide),this.element.reveal()}}),UIInbox=new Class({Implements:[Options,Events],Binds:["processBox","selectBox","rowClicked","refreshInbox","refresh","setError"],options:{},initialize:function(e){this.setOptions(e),Array.each(document.getElements(".ui-inbox"),function(e){var t=new Element("div",{class:"hidden",html:"no errors",styles:{position:"absolute",top:"10px",right:"10px",padding:"10px",background:"white",border:"5px solid black","border-radius":"10px","z-index":"9999999999"}}).inject(e,"after");e.store("errors",t),e.getElement(".ui-inbox-labels h2").addEvent(Affinity.events.click,function(){t.toggleClass("hidden")});var i=e.get("id")||String.uniqueID(),s=e.get("data-tab-api"),n=e.get("data-refresh-frequency");n&&(n=parseFloat(n)||5,n=n<.5?.5:n);var o=e.getElements(".ui-inbox-labels li"),a=e.getElements(".ui-inbox-box"),r=e.getElement(".ui-inbox-readpane"),l={};e.set("id",i),l.tabApi=s||!1,l.tabIndex=Cookie.read("uiInboxIndex")||0,l.frequency=n,l.element=e,l.stoprefresh=!1,a.addClass("hidden"),Array.each(o,function(e,t){e.store("box",a[t]),this.processBox(a[t]),e.addEvent(Affinity.events.click,function(e){var t="li"==e.target.get("tag")?e.target:e.target.getParent("li");this.selectBox(t),delete t}.bind(this))}.bind(this)),e.getElement(".ui-inbox-labels li").addClass("selected"),e.getElement(".ui-inbox-box").removeClass("hidden"),new Fx.Reveal(r,{duration:250,mode:"vertical"}),r.setStyle("display","none"),r.removeClass("hidden"),s&&(l.refreshRequest=new CFRequest.JSON({url:s,onSuccess:function(e){this.refreshInbox(l,e)}.bind(this),onError:function(t){this.setError(e,t)}.bind(this),onFailure:function(t){this.setError(e,t)}.bind(this)}),e.getElement(".ui-inbox-loader")&&e.getElement(".ui-inbox-loader").removeClass("hidden"),e.hasClass("ui-inbox-requires-login")?window.addEvent("loggedin",function(){l.refreshRequest.send()}.bind(this)):l.refreshRequest.send()),e.store("inboxObj",l)}.bind(this))},selectBox:function(e){var t=e.getParent(".ui-inbox"),i=t.retrieve("inboxObj");i.tabIndex=t.getElements(".ui-inbox-labels li").indexOf(e),t.store("inboxObj",i),t.getElements(".ui-inbox-labels li").removeClass("selected"),t.getElements(".ui-inbox-box").addClass("hidden"),e.retrieve("box").removeClass("hidden"),e.addClass("selected"),i.tabApi&&this.startRefresh(t),window.fireEvent("inboxSelected",{menuItem:e,box:e.retrieve("box")})},processBox:function(e){Array.each(e.getElements("tbody tr"),function(e){e.get("data-itemdata")&&e.addEvent(Affinity.events.click,this.rowClicked)}.bind(this))},rowClicked:function(e){var t="tr"==e.target.get("tag")?e.target:e.target.getParent("tr"),i=JSON.parse(t.get("data-itemdata").replace(/'/g,'"')),s=t.getParent(".ui-inbox").getElement(".ui-inbox-readpane");s.getElement(".ui-inbox-date-display").set("html",i.date?unescape(i.date):""),s.getElement(".ui-inbox-from").set("html",i.from?unescape(i.from):""),s.getElement(".ui-inbox-subject").set("html",i.subject?unescape(i.subject):""),s.getElement(".ui-inbox-message").set("html",i.details?unescape(i.details):""),s.reveal(),delete t,delete i,delete s},stopRefresh:function(e){if(e){var t=e.retrieve("inboxObj");t&&(t.stoprefresh=!0,t.refreshRequest.isRunning()&&t.refreshRequest.cancel())}},startRefresh:function(e){if(e){var t=e.retrieve("inboxObj");t&&(e.getElement(".ui-inbox-loader")&&e.getElement(".ui-inbox-loader").removeClass("hidden"),t.stoprefresh=!1,t.refreshRequest.isRunning()&&t.refreshRequest.cancel(),t.refreshRequest.send())}},refreshInbox:function(e,t){this.fireEvent("refresh"),e.element&&e.element.getElement(".ui-inbox-loader")&&e.element.getElement(".ui-inbox-loader").addClass("hidden"),e.stoprefresh||(window.fireEvent("inboxUpdated",{elementid:e.element.get("id"),inbox:e,data:t}),e.frequency&&function(){e.element&&e.element.getElement(".ui-inbox-loader")&&e.element.getElement(".ui-inbox-loader").removeClass("hidden"),e.refreshRequest.send()}.delay(60*e.frequency*1e3,this))},refresh:function(){var e,t,i,s;Array.each(document.getElements(".ui-inbox"),function(n){lables=n.getElements(".ui-inbox-labels li"),s=n.getElements(".ui-inbox-boxes .ui-inbox-box"),Array.each(lables,function(n,o){e=s[o],t=e.getElements("tbody tr"),i=t.length,e.getElement("tbody tr.empty")&&0==--i&&e.getElement("tbody tr.empty").removeClass("hidden"),n.getElement(".indicator").set("html",i)}.bind(this))}.bind(this)),delete s,delete lables,delete i,delete t,delete e},setError:function(e,t){var i="";i="object"===typeOf(t)||"array"===typeOf(t)?JSON.stringify(t,null,2):t,e.retrieve("errors").set("html","<pre>"+i+"</pre>"),this.fireEvent("error",i)}});Locale.define("en-NZ","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["date","month","year","/"],ordinal:function(e){return e>3&&e<21?"th":["th","st","nd","rd","th"][Math.min(e%10,4)]},AM:"am",PM:"pm"}),Locale.use("en-NZ"),window.components=[["UIHelpBubble","helpbubble"],["UIGrid"],["UISortableGrid"],["UIDynamicGrid"],["UIScrollableGrid"],["UITabs"],["UIInbox"],["UIHidables"],["UIFormHideables","formhideables"],["UISectionHideables","sectionHidables"],["UIHideToggle","hidetoggle"],["UIUplaoders"],["UIUplaodersMulti","uploaders"],["UIReplaceArrows","arrows"],["UIValidation"],["UISanitise"],["UIDateDropDowns"],["UISelectLookup","lookups"],["UIDisplayLookup","displaylookups"],["UIDateCalendar"],["UIListBuilder"],["UIDateCleverInput"],["UIAutoComplete"],["UIQuickSearch"],["UIModal","modal"],["UIDrawPanels"],["UITooltips","tooltips"],["UIHelpIcon","helpicon"],["UIPompts","prompts"],["UIFormatDate"],["UIBankNumber","banknumber"],["UITaxNumber","taxnumber"],["UIMasterMessage","masterMessage"],["UIAddress","address"],["UIPager"],["UITextareaAutoSize","textAutoSize"]];var mybasepath=window.basepath||"";window.addEvent("PageReady",function(){if("Affinity"in window||(window.Affinity={}),!Affinity.uiready){for(var e,t=0;t<window.components.length;t++)if(e=window.components[t],void 0!==window[e[0]]&&"class"===typeOf(window[e[0]])){var i,s=e[0].replace("UI","ui");if(s in Affinity)console.log('name collision in Affinity for "'+s+'"');else if(Affinity[s]=new window[e[0]],Affinity.Components[s]={},Affinity.Components[s].Version=Affinity[s].Version||"",Affinity.Components[s].Name=Affinity[s].Name||e[0].replace(new RegExp("UI","gi"),"").split(/(?=[A-Z])/).join(" "),Affinity.Components[s].File=Affinity[s].File||"",Affinity.Components[s].Jira=Affinity[s].Jira||"",e.length>1)for(var n=1;n<e.length;n++)i=e[n],i in Affinity?console.log('name collision in Affinity for "'+i+'"'):Affinity[i]=Affinity[s]}s=null,i=null,e=null,Affinity.useWebWorkers=!(Affinity.isie&&Affinity.ieversion<=11)&&Affinity.useWebWorkers,Affinity.uiready=!0,window.fireEvent("UiReady")}});var UIInjectDatePicker=new Class({Implements:[Options],Options:{},initialize:function(e){this.setOptions(e);var t=document.getElements(".date-picker");t.length>0&&Array.each(t,function(e,t){new UIDatePicker({target:e,canSelectPast:!0,dateMooFormat:"%d.%m.%Y"})})}}),UIListBuilderWidget=new Class({Implements:[Options,Events],options:{target:null,delimeter:","},Binds:[""],list:[],outputList:[],initialize:function(e){this.setOptions(e),this.icons={},this.icons.del=Affinity.icons.CrossRound,this.options.target.addClass("uidone"),this.select=this.options.target;var t=this.select.get("name"),i=this.select.get("id"),s=this.select.get("data-validate-method")||"",n=this.select.get("data-validate-error-str")||"";this.select.erase("data-validate-method"),this.select.erase("data-validate-error-str"),this.select.removeClass("validate"),this.select.erase("name"),this.output=new Element("input",{type:"hidden",name:t,id:i}).inject(this.select,"before"),s&&""!=s&&(this.output.addClass("validate"),this.output.set("data-validate-method",s),""!=n&&this.output.set("data-validate-error-str",n)),delete t,delete i,delete s,delete n,this.selectButton=new Element("span",{class:"button green w-icon-only ui-list-builder-button"}).adopt(new Element("span",{html:Affinity.icons.PlusRound})).inject(this.select,"after"),this.listTable=new Element("table",{class:"ui-grid ui-list-builder-grid"}).inject(this.selectButton,"after"),new Element("thead").adopt(new Element("tr").adopt(new Element("th",{html:"Selected"}),new Element("th",{html:""}))).inject(this.listTable),this.lsitTableBody=new Element("tbody").inject(this.listTable),this.empty=new Element("tr").adopt(new Element("td",{colspan:2,html:"None"})).inject(this.lsitTableBody),new Element("div",{class:"section-table ui-list-builder-container"}).wraps(this.listTable),Array.each(this.select.getElements("option"),function(e){this.list.push({value:e.get("value"),display:e.get("html")})}.bind(this)),this.selectButton.addEvent("click",this.addItem.bind(this))},addItem:function(e){this.outputList.contains(this.select.value)||(0==this.outputList.length&&this.lsitTableBody.empty(),this.outputList.push(this.select.value),new Element("tr",{"data-value":this.select.value}).adopt(new Element("td",{html:this.list[this.select.selectedIndex].display}),new Element("td").adopt(new Element("span",{class:"button orange w-icon-only",html:"<span>"+this.icons.del+"</span>"}).addEvent("click",this.removeItem.bind(this)))).inject(this.lsitTableBody)),this.output.value=this.outputList.toString().replace(/,/g,this.options.delimeter),Affinity.uiGrid&&Affinity.uiGrid.zebra(this.listTable)},removeItem:function(e){var t=e.target.getParent("tr"),i=t.get("data-value");this.outputList.erase(i),t.destroy(),0==this.outputList.length&&this.empty.inject(this.lsitTableBody),delete t,delete i,this.output.value=this.outputList.toString().replace(/,/g,this.options.delimeter),Affinity.uiGrid&&Affinity.uiGrid.zebra(this.listTable)}}),UIListBuilder=new Class({Implements:[Options,Events],Binds:["processListBuilders"],options:{},initialize:function(e){this.setOptions(e),document.UI||(document.UI={}),document.UI.listBuilders||(document.UI.listBuilders={}),Array.each(document.getElements("select.ui-list-builder"),this.processListBuilders)},processListBuilders:function(e){e.hasClass("uidone")||new UIListBuilderWidget({target:e})}}),UILogin=new Class({Version:"1.0.1.2",Notes:"Feature branch for Timesheets Mileage",File:"ui.login.js",Notes:"API structure change",Implements:[Options,Events],Binds:["cont","show","hide","getAdminDates","getUser","check","login","logout","logged","setSession","clearSession","htmlTemplateLoadError","htmlTemplateLoadSuccess","requestSessionFailed","requestSessionFailedException","requestSessionFailedTimeout","getUserInformation"],options:{title:!1,auto:!0,showCancel:!1,target:null,targetbg:null,logoutButton:null,htmlTemplateUrl:null,underlay:!1},publicHolidays:[],user:{},access:{},keepSession:!1,rememberMe:!1,logstatus:"loggedout",profile_stub:{employeeNumber:null,firstName:null,lastName:null,commonName:null,currentPayPeriodBegins:null,currentPaydate:null,previousPaydate:null,nextPaydate:null,newestTimesheetDate:null,oldestTimesheetDate:null,showTimesheetFrom:null,startDayOfTheWeek:null,publicHolidays:[],admin:!1},area_stub:{IsManager:!1,IsEmployee:!1,DefaultView:!1,WeeklyDays:!1},area_timesheets_stub:{IsManager:!1,IsEmployee:!1,ShowPeriodView:!1,ShowWeeklyView:!1,ShowDetailView:!1,ShowOverviewView:!1,ShowDualDetailView:!1,ShowBulkView:!1,ShowMileageView:!1,ReadonlyWeeklyView:!1,ReadonlyDetailView:!1,ReadonlyDualdetailView:!1,DefaultView:!1,WeeklyDays:!1,AddUnit:!1,EnableFavourite:!1},hoiday_stub:{DateTime:null,Description:""},screenFilter_stub:{FieldName:"",ModelName:"",Label:""},initialize:function(e){this.setOptions(e),!1 in window&&(window.Affinity={}),Affinity.login={},Affinity.login.companyNumber=!1,Affinity.login.profile={},Affinity.login.userProfiles={},Affinity.login.areas={},Affinity.login.controller=this,window.addEvent("unauthorized",function(){this.logout({redirectToGateway:!0})}.bind(this)),window.addEvent("logoutViaTab",function(){this.logout()}.bind(this)),window.addEvent("logout",function(){this.getDomainName(window.location.host).indexOf("localhost")>-1?this.logout():this.logout({redirectToGateway:!0})}.bind(this)),null!==this.options.htmlTemplateUrl?new Request.HTML({url:mybasepath+this.options.htmlTemplateUrl,evalScripts:!1,onFailure:this.htmlTemplateLoadError,onError:this.htmlTemplateLoadError,onSuccess:this.htmlTemplateLoadSuccess}).get():this.setup()},htmlTemplateLoadSuccess:function(e){Array.each(e,function(e){e.inject(document.body,"bottom")}),this.options.title&&document.getElement(".login-underlay-header .heading").set("html",this.options.title),this.options.target=document.id("login-box"),this.options.targetbg=document.id("login-box-bg"),this.options.underlay?(this.options.targetbg=document.id("login-underlay"),document.id("login-box-bg")&&document.id("login-box-bg").destroy()):(this.options.targetbg=document.id("login-box-bg"),document.id("login-underlay")&&document.id("login-underlay").destroy()),Affinity.mobile||this.options.target.removeClass("invisible"),this.options.target.getElement(".font-icons").set("html",Affinity.icons.Key),this.setup()},htmlTemplateLoadError:function(){Affinity.prompts.hide(),this.fireEvent("error",'"'+mybasepath+this.options.htmlTemplateUrl+'" must exist in your project.')},setup:function(){this.user.firstName="",this.user.lastname="",this.user.displayname="",this.user.employeeNumber="",this.user.companyNumber="",this.options.underlay?this.options.targetbg.addClass("hidden"):(this.options.targetbg.set("tween",{duration:250}),this.options.targetbg.fade("hide")),this.options.target.set("tween",{duration:250}),this.options.target.fade("hide"),this.options.showCancel&&(this.options.target.getElement(".button.grey").removeClass("hidden"),this.options.target.getElement(".button.grey").addEvent(Affinity.events.click,this.cancel.bind(this))),this.userInput=this.options.target.getElement("input#username"),this.passInput=this.options.target.getElement("input#password"),this.rememberMeInput=this.options.target.getElement("input#rememberme"),this.keepSeesionInput=this.options.target.getElement("input#keeplogged"),this.errormesg=this.options.target.getElement(".errormsg"),this.username="",this.button=this.options.target.getElement(".button.green"),this.loader=new Element("img",{src:Affinity.loaders.light}).inject(this.button,"after"),this.loader.addClass("hidden"),this.button.addEvent(Affinity.events.click,this.processlogin.bind(this)),null!=this.options.logoutButton&&this.options.logoutButton.addEvent(Affinity.events.click,this.logout.bind(this)),window.addEvent("keyup",function(e){"enter"==e.key&&"open"==this.status&&this.processlogin()}.bind(this));var e="";e=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.authroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession=new Request.JSON({url:e,method:"get",timeout:6e4,onSuccess:this.setSession,onError:this.requestSessionFailed,onFailure:this.requestSessionFailed,onException:this.requestSessionFailedException,onTimeout:this.requestSessionFailedTimeout}),Affinity.mobile&&("onorientationchange"in window?window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this)):window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this))),this.fireEvent("ready");var t=new URI(window.location.href);if("null"!==typeOf(t.parsed.query)){var i=t.parsed.query.parseQueryString();if("null"!==typeOf(i.sessionKey))return this.checkSessionKey(i.sessionKey),void delete t}this.options.auto&&this.check()},getUserRequest:null,getUser:function(e){if(log("&#x2794; attempting getUser profile ("+e+") ..."),Affinity.login.userProfiles.hasOwnProperty(e))return window.fireEvent("gotUser",Affinity.login.userProfiles[e]),log("&#x2714; attempted getUser profile ("+e+") succeeded - already exists in local",{color:"green"}),Affinity.login.userProfiles[e];if("string"!==typeOf(e)||"string"===typeOf(e)&&""===e.trim())return window.fireEvent("gotUser",!1),!1;this.getUserRequest&&"isRunning"in this.getUserRequest&&this.getUserRequest.isRunning()&&this.getUserRequest.cancel();var t=Affinity.GetCacheSafePath(Affinity.authroot+"/GetEmployeeProfile?EmployeeNo="+e);this.getUserRequest=new Request.JSON({url:t,onRequest:function(t){log("&#x2794; attempting getUser profile request ("+e+") ...",{color:"blue"})},onSuccess:function(t){if(JSON.Unauthorized(t,"login getUser profile ("+e+")"))return log("&#x2714; attempted getUser profile ("+e+") failed - unauthorized",{color:"red"}),void window.fireEvent("gotUser",!1);if(t.hasOwnProperty("error")&&"null"!==typeOf(t.error))return"object"===typeOf(t.error)?(log("&#x2714; attempted getUser profile ("+e+") failed with errors - "+JSON.stringify(t.error),{color:"red"}),void window.fireEvent("gotUser",!1)):(log("&#x2714; attempted getUser profile ("+e+") failed with errors - "+t.error.split("\r\n").join(", "),{color:"red"}),void window.fireEvent("gotUser",!1));log("&#x2714; attempted getUser profile ("+e+") succeeded from zelos",{color:"green","font-weight":"bold"});var i=Object.clone(this.profile_stub);i.firstName=t.FirstName,i.lastName=t.LastName,i.commonName=t.CommonName,i.employeeNumber=t.EmployeeNumber,i.companyNumber=Affinity.login.profile.companyNumber,i.payPoints="null"!==typeOf(t.PayPoints)&&t.PayPoints,i.employeeGroups="null"!==typeOf(t.EmployeeGroups)?t.EmployeeGroups:[],i.screenFilters="null"!==typeOf(t.ScreenFilters)?t.ScreenFilters:[],i.publicHolidays="null"!==typeOf(t.PublicHolidays)?t.PublicHolidays:[],i.currentPayPeriodBegins="null"!==typeOf(t.CurrentPayPeriodBegins)&&Date.parse(t.CurrentPayPeriodBegins),i.currentPaydate="null"!==typeOf(t.CurrentPaydate)&&Date.parse(t.CurrentPaydate),i.previousPaydate="null"!==typeOf(t.PreviousPaydate)&&Date.parse(t.PreviousPaydate),i.nextPaydate="null"!==typeOf(t.NextPaydate)&&Date.parse(t.NextPaydate),i.oldestTimesheetDate="null"!==typeOf(t.OldestTimesheetDate)&&Date.parse(t.OldestTimesheetDate),i.newestTimesheetDate="null"!==typeOf(t.NewestTimesheetDate)&&Date.parse(t.NewestTimesheetDate),i.startDayOfTheWeek="null"!==typeOf(t.StartDayOfTheWeek)?parseInt(t.StartDayOfTheWeek):0,i.rowsPerPage="null"!==typeOf(t.RowsPerPage)?parseInt(t.RowsPerPage):20,t.EmployeeNumber>5e6&&(i=this.getAdminDates(i)),Affinity.login.userProfiles[i.employeeNumber]=Object.clone(i),window.fireEvent("gotUser",i)},onError:function(t){log("&#x2714; attempted getUser profile ("+e+") failed with errors - "+t,{color:"red"}),window.fireEvent("gotUser",!1)},onException:function(t,i){log("&#x2714; attempted getUser profile ("+e+") failed with errors - "+t+": "+i,{color:"red"})}.bind(this),onFailure:function(t){var i="";switch(t.status){case 401:i="unauthorized.";break;case 404:i="path not found.";break;case 500:var s;try{s=JSON.decode(t.responseText)}catch(e){s=!1,i=t.responseText}s&&(i=s.error?s.error:t.responseText),delete s;break;default:i=t.statusText}i.contains(401)||i.toLowerCase().contains("unauthorized")?log("&#x2714; attempted getUser profile ("+e+") failed - unauthorized",{color:"red"}):log("&#x2714; attempted getUser profile ("+e+") failed with errors - "+i,{color:"red"}),window.fireEvent("gotUser",!1)},onTimeout:function(){log("&#x2714; attempted getUser profile ("+e+") timeout",{color:"red"}),window.fireEvent("gotUser",!1)}}).get()},checkRequest:!1,check:function(){if(Affinity.apiversion>1){var e=Affinity.GetCacheSafePath(Affinity.authroot+"/GetUser");this.checkRequest=new Request.JSON({url:e,onSuccess:function(e){if("object"==typeof e&&"success"in e&&!e.success){var t="error"in e&&"string"==typeof n?e.error:"unknown error";console.debug("GetUser Failed: "),console.debug(e),log("** login check failed - "+t+" **"),this.logout()}else log("** login check succeeded **"),console.debug("GetUser Succeeded"),this.setSession(e)}.bind(this),onFailure:function(e){console.debug("GetUser Failed"),console.debug(e)}.bind(this),onException:function(e,t){console.debug("GetUser Exceptioned"),console.debug(e+t)}.bind(this),onTimeout:function(){console.debug("GetUser Timmed out")}}).get()}else{var t=Affinity.appname+"Session",i=Affinity.CookieMonster.Read(t);Affinity.session=!1,"string"===typeOf(i)&&""!==typeOf(i)&&"undefined"!==typeOf(i)&&(Affinity.session=i);var s=t+": "+Affinity.seesion;if(Affinity.session||("boolean"===typeOf(i)?s="no session key - cookie "+t+" is false":"string"===typeOf(i)&&""===i?s="no session key - cookie "+t+" is empty":"string"===typeOf(i)&&"undefined"===i?s="no session key - cookie "+t+" is undefined":"null"===typeOf(i)&&(s="no session key - cookie "+t+" is null or undefined")),log("** check login status ("+s+") **"),!Affinity.session)return log("** login check failed **"),this.clearSession(),this.logout({}),void this.login();var n="";if(this.user=!1,Affinity.CookieMonster.Read(Affinity.appname+"User")&&(user=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"User")),"null"===typeOf(user.firstName)&&"null"===typeOf(user.lastname)||"null"===user.firstName&&"null"===user.lastname||(user.firstName+"").trim()+(user.lastname+"").trim()+(user.displayName+"").trim()==""||""===user.employeeNumber||"null"===typeOf(user.employeeNumber)||"null"==user.employeeNumber||""===user.companyNumber||"null"===typeOf(user.companyNumber)||"null"==user.companyNumber||(this.user=user,window.fireEvent("userComplete",user))),!this.user)return log("** login check failed - minimum data requirement not met **"),this.clearSession(),this.logout({message:"Minimum login details are not set."}),this.button.removeClass("hidden"),this.loader.addClass("hidden"),void this.login();log("** login check succeeded **"),this.companyNumber=Affinity.CookieMonster.Read(Affinity.appname+"CompanyNumber"),this.keepSession="false"!==Affinity.CookieMonster.Read(Affinity.appname+"KeepSession"),this.rememberMe="false"!==Affinity.CookieMonster.Read(Affinity.appname+"RememberMe")&&Affinity.CookieMonster.Read(Affinity.appname+"RememberMe"),null!==this.rememberMe&&!1!==this.rememberMe?(this.username=this.rememberMe,this.rememberMe=!0):(this.username="",this.rememberMe=!1),null!==this.keepSession&&!1!==this.keepSession?this.keepSession=!0:this.keepSession=!1,Affinity.session?(Affinity.CookieMonster.Read(Affinity.appname+"Areas")&&(this.areas=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"Areas"))),Affinity.CookieMonster.Read(Affinity.appname+"PayPoints")&&(this.payPoints=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"PayPoints"))),Affinity.CookieMonster.Read(Affinity.appname+"EmployeeGroups")&&(this.employeeGroups=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"EmployeeGroups"))),Affinity.CookieMonster.Read(Affinity.appname+"ScreenFilters")&&(this.screenFilters=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"ScreenFilters"))),Affinity.CookieMonster.Read(Affinity.appname+"PublicHolidays")&&(this.publicHolidays=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"PublicHolidays"))),this.logged()):this.logout()}},getAdminDates:function(e){var t,i,s,n,o=(new Date).clearTime(),a="-7",r="+7",l="-6",h="+1";return e.admin=!0,"Affinity"in window&&"object"===typeOf(Affinity)&&"AdminPayPeriodBegins"in Affinity&&Affinity.AdminPayPeriodBegins&&(a=Affinity.AdminPayPeriodBegins,r=Affinity.AdminPayPeriodEnds,l=Affinity.AdminOldestTimesheet,h=Affinity.AdminNewestTimesheet),t=parseInt(a.replace("-","")),a.contains("+")?e.currentPayPeriodBegins=o.clone().increment("day",t):a.contains("-")&&(e.currentPayPeriodBegins=o.clone().decrement("day",t)),t=parseInt(r.replace("-","")),r.contains("+")?e.currentPayPeriodEnds=o.clone().increment("day",t):r.contains("-")&&(e.currentPayPeriodEnds=o.clone().decrement("day",t)),t=parseInt(l.replace("-","")),l.contains("+")?e.oldestTimesheetDate=o.clone().increment("month",t):l.contains("-")&&(e.oldestTimesheetDate=o.clone().decrement("month",t)),t=parseInt(h.replace("-","")),h.contains("+")?e.newestTimesheetDate=o.clone().increment("month",t):h.contains("-")&&(e.newestTimesheetDate=o.clone().decrement("month",t)),i=o.clone().decrement("month",1),s=o.clone(),n=o.clone().increment("month",1),e.currentPaydate=s.set("date",s.get("lastdayofmonth")),e.previousPaydate=i.set("date",i.get("lastdayofmonth")),e.nextPaydate=n.set("date",n.get("lastdayofmonth")),e},setSession:function(e){if("object"===typeOf(e)&&"success"in e&&!e.success)return this.clearSession(),void this.logout({message:"Invalid username or password."+("error"in e?"\x3c!--"+e.error+"--\x3e":"")});"isEss"in e&&"boolean"===typeOf(e.isEss)&&!0===e.isEss&&(Affinity.oldess=!0,Affinity.oldessLaunched=!0,Affinity.oldessFrame=!1,Affinity.oldessWindow=window.opener),"null"!==typeOf(e.Commonname)&&""!==e.Commonname||(e.Commonname=(e.Firstname+" "+e.Lastname).replace("  "," ").trim());var t=!1;Affinity.session=!1,Affinity.apiversion<2&&(Affinity.session=!1,"string"===typeOf(e.SessionKey)&&""!==typeOf(e.SessionKey)&&"undefined"!==typeOf(e.SessionKey)?Affinity.session=e.SessionKey:t=!0);var i="";if(t&&(i+="No session key (required for old API method)\r\n"),("null"===typeOf(e.Firstname)||"string"===typeOf(e.Firstname)&&""===e.Firstname.trim())&&(i+="No first name\r\n"),("null"===typeOf(e.Lastname)||"string"===typeOf(e.Lastname)&&""===e.Lastname.trim())&&(i+="No last name\r\n"),("null"===typeOf(e.EmployeeNumber)||"string"===typeOf(e.EmployeeNumber)&&""===e.EmployeeNumber.trim())&&(i+="No employee number\r\n"),("null"===typeOf(e.CompanyNumber)||"string"===typeOf(e.CompanyNumber)&&""===e.CompanyNumber.trim())&&(i+="No company number\r\n"),""!==i)return log("&#x2718; attempted login succeeded with errors - Minimum login details are not set"),this.clearSession(),void this.logout({message:"Minimum login details are not set.\x3c!--\r\n"+i+"\r\n--\x3e"});log("&#x2714; attempted login succeeded"),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.employeeNumber=e.EmployeeNumber,this.companyNumber=e.CompanyNumber,this.values={},Object.each(e,function(e,t){"string"!==typeOf(e)&&"number"!==typeOf(e)||(this.values[t]=e),this[t]=e}.bind(this)),"null"===typeOf(this.values.ShowTimesheetFrom)&&(this.values.ShowTimesheetFrom=Date.parse(new Date).decrement("day",14),this.ShowTimesheetFrom=this.values.ShowTimesheetFrom),"null"===typeOf(this.values.NewestTimesheetDate)&&"null"!==typeOf(this.values.ShowTimesheetFrom)&&("string"===typeOf(this.values.ShowTimesheetFrom)?this.values.NewestTimesheetDate=Date.parse(this.values.ShowTimesheetFrom).increment("month",1):"date"===typeOf(this.values.ShowTimesheetFrom)&&(this.values.NewestTimesheetDate=this.values.ShowTimesheetFrom.clone().increment("month",1)),this.NewestTimesheetDate=this.values.NewestTimesheetDate),this.areas=this.Areas,this.payPoints=e.PayPoints,this.employeeGroups=e.EmployeeGroups,this.screenFilters=e.ScreenFilters,e.PublicHolidays&&(this.publicHolidays=e.PublicHolidays),this.user={},this.user.firstName=this.values.Firstname,this.user.lastname=this.values.Lastname,this.user.displayName=this.values.Commonname,this.user.employeeNumber=this.employeeNumber,this.user.companyNumber=this.companyNumber;var s=Object.clone(this.profile_stub);s.firstName=e.Firstname,s.lastName=e.Lastname,s.commonName=e.Commonname,s.employeeNumber=e.EmployeeNumber,s.companyNumber=e.CompanyNumber,s.payPoints="null"!==typeOf(e.PayPoints)&&e.PayPoints,s.employeeGroups="null"!==typeOf(e.EmployeeGroups)?e.EmployeeGroups:[],s.screenFilters="null"!==typeOf(e.ScreenFilters)?e.ScreenFilters:[],s.publicHolidays="null"!==typeOf(e.PublicHolidays)?e.PublicHolidays:[],s.currentPayPeriodBegins="null"!==typeOf(e.CurrentPayPeriodBegins)&&Date.parse(e.CurrentPayPeriodBegins),s.currentPaydate="null"!==typeOf(e.CurrentPaydate)&&Date.parse(e.CurrentPaydate),s.previousPaydate="null"!==typeOf(e.PreviousPaydate)&&Date.parse(e.PreviousPaydate),s.nextPaydate="null"!==typeOf(e.NextPaydate)&&Date.parse(e.NextPaydate),s.oldestTimesheetDate="null"!==typeOf(e.OldestTimesheetDate)&&Date.parse(e.OldestTimesheetDate),s.newestTimesheetDate="null"!==typeOf(e.NewestTimesheetDate)&&Date.parse(e.NewestTimesheetDate),s.startDayOfTheWeek="null"!==typeOf(e.StartDayOfTheWeek)?parseInt(e.StartDayOfTheWeek):0,s.rowsPerPage="null"!==typeOf(e.RowsPerPage)?parseInt(e.RowsPerPage):20,e.EmployeeNumber>5e6&&(s=this.getAdminDates(s)),Affinity.login.profile=Object.clone(s),Affinity.login.hasOwnProperty("userProfiles")||(Affinity.login.userProfiles={}),Affinity.login.userProfiles[s.employeeNumber]=Object.clone(s),Affinity.login.areas={};var n;if("Areas"in e&&"object"===typeOf(e.Areas)&&Object.each(e.Areas,function(e,t){Affinity.login.areas[t]={},n={},n="Timesheet"===t?Object.clone(this.area_timesheets_stub):Object.clone(this.area_stub),Object.each(n,function(i,s){s in e&&(Affinity.login.areas[t][s]=e[s])}.bind(this))}.bind(this)),this.companyNumber=this.CompanyNumber,this.employeeNumber=this.EmployeeNumber,this.errormesg.addClass("hidden"),this.keepSeesionInput.checked?(Affinity.CookieMonster.Write(Affinity.appname+"KeepSession",!0),this.keepSession=!0):(Affinity.CookieMonster.Write(Affinity.appname+"KeepSession",!1),this.keepSession=!1),this.rememberMeInput.checked?(Affinity.CookieMonster.Write(Affinity.appname+"RememberMe",this.userInput.value),this.rememberMe=!0,this.username=this.userInput.value):(Affinity.CookieMonster.Write(Affinity.appname+"RememberMe",!1),this.rememberMe=!1,this.username=""),Affinity.apiversion>1);else if(Affinity.CookieMonster.Write(Affinity.appname+"Values",JSON.stringify(this.values)),Affinity.CookieMonster.Write(Affinity.appname+"Values",JSON.stringify(this.values)),
Affinity.CookieMonster.Write(Affinity.appname+"Areas",JSON.stringify(this.areas)),Affinity.CookieMonster.Write(Affinity.appname+"PayPoints",JSON.stringify(this.payPoints)),Affinity.CookieMonster.Write(Affinity.appname+"EmployeeGroups",JSON.stringify(this.employeeGroups)),Affinity.CookieMonster.Write(Affinity.appname+"ScreenFilters",JSON.stringify(this.screenFilters)),e.PublicHolidays&&Affinity.CookieMonster.Write(Affinity.appname+"PublicHolidays",JSON.stringify(this.publicHolidays)),Affinity.CookieMonster.Write(Affinity.appname+"User",JSON.stringify(this.user)),Affinity.CookieMonster.Write(Affinity.appname+"CompanyNumber",this.companyNumber,720),Affinity.CookieMonster.Write(Affinity.appname+"EmployeeNumber",this.employeeNumber,720),this.keepSession?Affinity.CookieMonster.Write(Affinity.appname+"Session",Affinity.session):Affinity.CookieMonster.Write(Affinity.appname+"Session",Affinity.session,720),"null"!==typeOf(e.success)&&!e.success||"null"!==typeOf(e.Error)||"null"!==typeOf(e.error)){var o=!1;return this.errormesg.set("html","We could not log you in"),this.errormesg.addClass("hidden"),"null"!==typeOf(e.error)&&""!==e.error?o=this.sanatiseError(e.error):"null"!==typeOf(e.Error)&&""!==e.Error&&(o=this.sanatiseError(e.error)),o&&(this.errormesg.set("html",o),this.errormesg.removeClass("hidden")),log("&#x2718; attempted login succeeded with errors - "+o),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.clearSession(),this.show(),void this.requestSessionFailed()}"loggedout"===this.logstatus&&(this.logstatus="loggedin",window.fireEvent("userComplete",Affinity.login.profile),this.logged())},clearSession:function(e){if(Affinity.apiversion>1||(Affinity.CookieMonster.Delete(Affinity.appname+"User"),Affinity.CookieMonster.Delete(Affinity.appname+"Areas"),Affinity.CookieMonster.Delete(Affinity.appname+"PayPoints"),Affinity.CookieMonster.Delete(Affinity.appname+"PublicHolidays"),Affinity.CookieMonster.Delete(Affinity.appname+"EmployeeGroups"),Affinity.CookieMonster.Delete(Affinity.appname+"ScreenFilters"),Affinity.CookieMonster.Delete(Affinity.appname+"Values"),Affinity.CookieMonster.Delete(Affinity.appname+"CompanyNumber"),Affinity.CookieMonster.Delete(Affinity.appname+"EmployeeNumber"),Affinity.CookieMonster.Delete(Affinity.appname+"Session"),Affinity.session=!1),"object"===typeOf(this.values)&&Object.each(this.values,function(e,t){this[t]=null,delete this[t]}.bind(this)),this.values={},this.user.firstName="",this.user.lastname="",this.user.displayname="",this.user.employeeNumber="",this.user.companyNumber="",this.user={},this.areas={Timesheet:{},Employee:{}},this.payPoints=[],this.employeeGroups=[],this.screenFilters=[],this.companyNumber=null,this.employeeNumber=null,this.publicHolidays=[],"null"!==typeOf(e)&&void 0!==typeOf(e.redirectToGateway)&&e.redirectToGateway){var t=this.getDomainName(window.location.host),i="https://www."+t+"/#/Login?redirectUrl=https://dashboard."+t+"/Leave";return null==document.querySelector(".dashboard#app")&&(i="https://www."+t+"/#/"),void(window.location.href=i)}this.show(),this.logstatus="loggedout",window.scrollTo(0,0),window.fireEvent("loggedout")},requestSessionFailed:function(e){"null"!==typeOf(e)&&(e.statusText?log("&#x2718; attempted login failed - "+e.statustext):log("&#x2718; attempted login failed with errors - "+JSON.stringify(e))),this.errormesg.removeClass("hidden"),this.button.removeClass("hidden"),this.loader.addClass("hidden")},requestSessionFailedException:function(e){log("&#x2718; attempted login failed with exception(s)"),this.errormesg.set("html","There was an exception. Please try again."),this.errormesg.removeClass("hidden"),this.requestSessionFailed()},requestSessionFailedTimeout:function(e){log("&#x2718; attempted login timed out"),this.errormesg.set("html","Attempt timed out. Please check your connection and try again."),this.errormesg.removeClass("hidden"),this.requestSessionFailed()},checkSessionKeyRequest:!1,checkSessionKey:function(e){var t;if(Affinity.apiversion>1)t=Affinity.GetCacheSafePath(Affinity.authroot+"/CheckSession"),this.checkSessionKeyRequest=new Request.JSON({url:t,onSuccess:this.setSession,onError:this.show,onFailure:this.show}),this.checkSessionKeyRequest.setHeader("sessionkey",e),this.checkSessionKeyRequest.get();else{t=Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),log("&#x2794; attempting login ...");var i=new Request.JSON({url:t,method:"get",onSuccess:this.setSession,onError:this.show,onFailure:this.show});i.setHeader("sessionkey",e),i.get(),delete url}},logged:function(){Affinity.apiversion>1?window.fireEvent("loggedin",!0):window.fireEvent("loggedin",Affinity.session),this.hide()},login:function(){this.show()},processlogin:function(){this.button.addClass("hidden"),this.loader.removeClass("hidden"),log("&#x2794; attempting login ...");var e="";e=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.authroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession.url=this.requestSession.options.url=e,this.requestSession.setHeader("username",this.userInput.value),this.requestSession.setHeader("password",this.passInput.value),this.requestSession.get()},logout:function(e){if(log("** log out **"),clearTimeout(this.hiddenTimer),this.clearSession(e),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.logstatus="loggingout...","null"!==typeOf(e)){if("null"!==typeOf(e.closewindow)&&e.closewindow)return void window.close();"string"===typeOf(e.message)&&(log("** log out message: \r\n"+e.message.replace("\x3c!--","").replace("--\x3e","")+"\r\n"),this.errormesg.set("html",e.message),this.errormesg.removeClass("hidden"))}var t,i;if(Affinity.apiversion>1)i=Affinity.GetCacheSafePath(Affinity.authroot+"/Logout"),t=new Request.JSON({url:i,method:"get",onRequest:function(){log("&#x2794; attempting logout ...",{color:"blue"})},onSuccess:function(e){log("&#x2714; attempted logout succeeded from zelos",{color:"green"})},onError:function(e){log("&#x2714; attempted logout failed with errors - "+e,{color:"red"})},onException:function(e,t){log("&#x2714; attempted logout failed with errors - "+e+": "+t,{color:"red"})}.bind(this),onFailure:function(e){var t="";switch(e.status){case 401:t="unauthorized.";break;case 404:t="path not found.";break;case 500:var i;try{i=JSON.decode(e.responseText)}catch(s){i=!1,t=e.responseText}i&&(t=i.error?i.error:e.responseText),delete i;break;default:t=e.statusText}t.contains(401)||t.toLowerCase().contains("unauthorized")?log("&#x2714; attempted logout failed - unauthorized",{color:"red"}):log("&#x2714; attempted logout failed with errors - "+t,{color:"red"})},onTimeout:function(){log("&#x2714; attempted logout timeout",{color:"red"})}}).get(),i=null;else{var s=Affinity.session+"";s&&""!==s&&(i=Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Logout")),"null"!==typeOf(i)&&(t=new Request.JSON({url:i,method:"get"}),t.setHeader("sessionkey",s),t.get(),i=s=null)}null!=e&&"undefined"!=typeOf(e.redirectToGateway)&&e.redirectToGateway||this.show(),function(){this.clearSession(e)}.delay(250,this)},sanatiseError:function(e){return"null"!==typeOf(e)&&e.toLowerCase().contains("failed to authenticate")?"Your Username or Password were incorrect":"null"===typeOf(e)?"We could not log you in":e.contains(" - ")?e.substring(e.indexOf(" - ")+3):e},getDomainName:function(e){return e.substring(e.lastIndexOf(".",e.lastIndexOf(".")-1)+1)},position:function(){var e=this.options.target.measure(function(){return this.getSize()});if(Affinity.mobile){if(!this.options.target.hasClass("scaled")){var t,i,s=0,e=this.options.target.measure(function(){return this.getSize()}),n=window.getSize();n.x-=40,n.y-=40,t=e.x>e.y?Number(n.x/e.x).round(2):Number(n.y/e.y).round(2),e.y*t>n.y&&(t=Number(n.y/e.y).round(2)),n.x+40>e.x*t&&(s=(n.x+40-e.x*t)/2),i={left:s,"-webkit-transform":"scale("+t+")","-webkit-transform-origin":"0 0",transform:"scale("+t+")","transform-origin":"0 0"},this.options.target.setStyles(i),this.options.target.removeClass("invisible"),this.options.target.addClass("scaled")}}else this.options.target.setStyles({"margin-top":0-(e.y/2+40)});delete e},hiddenTimer:null,setAsHidden:function(){this.options.target.addClass("hidden"),this.options.targetbg.addClass("hidden")},set:function(e){if(e.username&&(this.userInput.value=e.username),e.password&&(this.passInput.value=e.password),e.zelosServer||e.zelosroot){e.zelosServer&&(Affinity.zelosroot=e.zelosServer),e.zelosroot&&(Affinity.zelosroot=e.zelosroot),e.apiroot&&(Affinity.zelosroot=e.apiroot);var t="";t=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.zelosroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession.options.url=this.requestSession.url=t}},show:function(){this.status="open",this.userInput.value="",this.passInput.value="",this.rememberMeInput.checked=!1,this.keepSeesionInput.checked=!1,this.rememberMe&&(this.rememberMeInput.checked="checked",this.userInput.value=this.username),this.keepSession&&(this.keepSeesionInput.checked="checked"),clearTimeout(this.hiddenTimer),this.options.target.removeClass("hidden"),this.options.targetbg.removeClass("hidden"),this.options.target.fade("in"),this.options.underlay||this.options.targetbg.fade("in"),this.position()},hide:function(){this.status="closed",clearTimeout(this.hiddenTimer),this.options.underlay?this.options.targetbg.addClass("hidden"):this.options.targetbg.fade("out"),this.options.target.fade("out"),this.hiddenTimer=this.setAsHidden.delay(260,this)},cancel:function(){this.requestSession&&this.requestSession.isRunning()&&this.requestSession.cancel(),this.hide()}}),UIMasterMessageObject=new Class({message:"Message!",okText:"Ok",okIcon:"",onOk:function(){}}),UIMasterMessage=new Class({Version:"1.0.0.0",File:"ui.master.message.js",Implements:[Options],Binds:["message","center","show","hide"],options:{},status:"closed",message:"",initialize:function(e){this.setOptions(e),this.messageBoxBG=new Element("div",{id:"UIMasterBoxBG",class:"UIPromtBoxBG master"}).inject(document.body,"bottom"),this.messageBoxBG.set("tween",{duration:250}),this.messageBoxBG.fade("hide"),this.messageBox=new Element("div",{id:"UIMasterBox",class:"UIPromtBox master"}).inject(document.body,"bottom"),this.messageBox.set("tween",{duration:250}),this.messageBox.fade("hide"),this.trueButton=new Element("span",{class:"button green w-icon",tabindex:99999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{class:"label",html:""})),window.masterMessage=this.message},message:function(e){var t=new UIMasterMessageObject;"string"===typeOf(e)?t.message=e:(t.message=e.message?e.message:t.message,t.onOk=e.onOk?e.onOk:t.onOk,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick),this.messageBox.empty(),this.messageBox.adopt(new Element("span",{html:t.message,class:"content alignleft"})),this.onEnterMethod=function(){this.hide(),t.onOk()}.bind(this),this.messageBox.adopt(new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().addEvent("click",this.onEnterMethod))),this.messageBox.getElement(".green span").set("html",t.okIcon),this.messageBox.getElement(".green .label").set("html",t.okText),this.center(),this.show(),delete t},getCalculatedTop:function(){var e=this.messageBox.getSize(),t=e.y/2;if(Affinity.oldess&&Affinity.oldessFrame){var i,s=window.parent,n=s.document.documentElement,o=s.document.body,a=n&&n.scrollTop||o&&o.scrollTop||0,r=s.innerHeight||s.document.documentElement.clientHeight;i=document.documentMode&&document.documentMode<9?window.parent.document.getElementById("ctl00_MainPanel").querySelectorAll(".ContentBody")[0].offsetTop:window.parent.document.getElementById("ctl00_MainPanel").getElementsByClassName("ContentBody")[0].offsetTop;var l=a+r/2-i;return l<t+10&&(l=t+10),l}var h=document.getSize(),u=document.getScroll();return h.y/2+u.y},center:function(){var e=this.messageBox.getSize();this.messageBox.setStyles({margin:0-e.y/2+"px 0 0 "+(0-e.x/2)+"px",top:this.getCalculatedTop()}),delete e},show:function(){this.messageBoxBG.fade("in"),this.messageBox.fade("in"),this.status="open"},hide:function(){this.messageBoxBG.fade("out"),this.messageBox.fade("out"),this.status="closed",this.message="",window.removeEvent("keyup",this.okKeyUp);try{this.messageBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(e){}}}),UIModal=new Class({Version:"1.0.0.0",File:"ui.modal.js",Implements:[Options],Binds:["setElement","setString","adopt","position","clear","closeButtonCloser","backgroundCloser","show","hide"],Options:{},backgroundCloses:!0,initialize:function(e){this.setOptions(e),this.icons={},this.icons.del=Affinity.icons.CrossRound,document.id("uimodalbg")||(this.modalbg=new Element("div",{id:"uimodalbg",class:"white hidden"}).inject(document.body,"bottom")),document.id("uimodal")||(this.modal=new Element("div",{id:"uimodal",class:"shadow hidden"}).inject(document.body,"bottom"),this.modalclose=new Element("div",{class:"uimodalclose"}).inject(this.modal),new Element("span",{class:"icon-cross"}).inject(this.modalclose),this.modalbody=new Element("div",{class:"uimodalbody"}).inject(this.modal)),this.modalbg=document.id("uimodalbg"),this.modal=document.id("uimodal"),this.modalbg.set("tween",{duration:250}),this.modal.set("tween",{duration:250}),this.modalclose=this.modal.getElement(".uimodalclose"),this.modalbody=this.modal.getElement(".uimodalbody"),this.modalbg.addEvent("click",this.backgroundCloser),this.modalclose.addEvent("click",this.closeButtonCloser),this.modalbg.removeClass("hidden").fade("hide"),this.modal.removeClass("hidden").fade("hide"),window.addEvent("resize",function(e){this.position()}.bind(this)),this.position(),this.scroll={},this.scroll.enable=function(){this.modal.addClass("scroll")}.bind(this),this.scroll.disable=function(){this.modal.removeClass("scroll")}.bind(this),this.close={},this.close.enable=function(){this.modalclose.removeClass("hidden")}.bind(this),this.close.disable=function(){this.modalclose.addClass("hidden")}.bind(this)},getCalculatedTop:function(){if(Affinity.oldess&&Affinity.oldessFrame){var e=window.parent.window,t=e.document.documentElement,i=e.document.body,s=t&&t.scrollTop||i&&i.scrollTop||0,n=0,o=window.parent.document.getElementById("ctl00_MainPanel");o&&(n=document.documentMode&&document.documentMode<9?o.querySelectorAll(".ContentBody")[0].offsetTop:o.getElementsByClassName("ContentBody")[0].offsetTop);var a=s-n;return a<10&&(a=10),a+10}return 10},position:function(){var e=window.getSize();this.modalbg.setStyles({width:e.x,height:e.y}),this.modal.setStyles({left:e.x/2-this.modal.getDimensions().width/2,top:this.getCalculatedTop()}),this.modalbody.setStyles({"max-height":e.y-60}),delete e},setElement:function(e){this.modalbody.empty(),e.inject(this.modalbody),this.position(),this.close.enable(),this.scroll.enable()},adopt:function(e){this.setElement(e)},setString:function(e){this.modalbody.empty(),this.modalbody.set("html",e),this.position(),this.close.enable(),this.scroll.enable()},backgroundCloser:function(e){this.closeButtonCloser(e)},closeButtonCloser:function(e){window.fireEvent("leaveEditDetailCloses"),this.backgroundCloses&&this.hide()},hide:function(){"beforeClose"in this&&"function"===typeOf(this.beforeClose)&&(this.beforeClose(),this.beforeClose=null,delete this.beforeClose),this.modalbg.fade("out"),this.modal.fade("out"),this.clear.delay(500,this)},show:function(e){null==e?(e=!0,this.modalclose.fade("show")):this.modalclose.fade("hide"),this.backgroundCloses=e,this.modalbg.fade("in"),this.modal.fade("in")},clear:function(){this.modalbody.empty()}}),UIPager=new Class({Binds:["init"],initialize:function(){window.addEvent("UiReady",this.init)},init:function(){Array.each(document.getElements("table.paginate"),function(e){e.hasClass("has-pagination")||(e.removeClass("paginate").addClass("has-pagination"),new UIPagerWidget({table:e,pageSize:e.get("data-page-size"),itemLabel:e.get("data-item-label")}))})}}),UIPagerWidget=new Class({Implements:[Options,Events],Binds:["onTableChange","onPrevClick","onNextClick","onPageClick","onGoToClick"],options:{table:null,itemLabel:"item(s)",pageSize:0,maxPages:15},initialize:function(e){this.setOptions(e),this.table=this.options.table,this.element=new Element("div",{class:"pagination"}).store("pager",this);var t=new Element("div",{class:"nav-buttons"}).inject(this.element);this.prevButton=new Element("span",{text:"previous"}).inject(t).addEvent(Affinity.events.click,this.onPrevClick),this.pageCtr=new Element("span").inject(t),this.nextButton=new Element("span",{text:"next"}).inject(t).addEvent(Affinity.events.click,this.onNextClick),this.label=new Element("span",{class:"desc"}).inject(this.element),"null"!==typeOf(this.table)&&(this.element.inject(this.table,"after"),this.table.addEvent("change",this.onTableChange),this.update(0,0))},update:function(e,t){e=parseInt(e),t=parseInt(t);var i=parseInt(this.options.pageSize);i<=0&&(i=NaN);var s=isNaN(t)||isNaN(i)?NaN:Math.floor(t/i);if(t%i>0&&s++,this.pageCount=s,isNaN(s)||isNaN(e))this.hide();else{e<0?e=0:e>=s&&(e=s-1),this.currentPage=e,this.pageCtr.empty(),0===e?this.prevButton.addClass("disabled"):this.prevButton.removeClass("disabled"),e===s-1?this.nextButton.addClass("disabled"):this.nextButton.removeClass("disabled");var n=0===t?-1:e*i,o=n+(e===s-1?t%i:i);o===n&&(o+=i);var a=[];if(s>this.options.maxPages){for(var r=Math.floor(this.options.maxPages/3),l=Math.floor(r/2),h=this.options.maxPages-r,u=e+l<h,c=0;c<(u?h:r);c++)a.push(c);for(u=e-l>=s-h,c=s-1;c>=s-(u?h:r);c--)a.push(c);if(!u)for(var c=e-l;c<=e+l;c++)c<0||c>s-1?a.push(e-c):a.push(c)}else for(var c=0;c<s;c++)a.push(c);a.sort(function(e,t){return e-t});var d=-1;a.unique().each(function(e){if(d!=e-1){var t=new Element("span",{text:"..."}).addEvent(Affinity.events.click,this.onGoToClick);this.pageCtr.adopt(t)}var i=new Element("span",{class:"page",text:e+1}).addEvent(Affinity.events.click,this.onPageClick);e===this.currentPage&&i.addClass("selected"),d=e,this.pageCtr.adopt(i)},this),this.label.set("text","Showing "+this.options.itemLabel+" "+ ++n+" to "+o+" of "+t),this.show()}},hide:function(){this.element.addClass("hidden")},show:function(){this.element.removeClass("hidden")},onTableChange:function(e){var t=e.page;"null"==typeOf(t)&&(t=this.currentPage),this.update(t,e.rows)},onPrevClick:function(e){e.target.hasClass("disabled")||this.table.fireEvent("pageChange",--this.currentPage)},onNextClick:function(){event.target.hasClass("disabled")||this.table.fireEvent("pageChange",++this.currentPage)},onGoToClick:function(){uiprompt({message:"Go to page:",onOk:function(e){var t=parseInt(e)-1;isNaN(t)||(t<0?t=0:t>=this.pageCount&&(t=this.pageCount-1),this.currentPage=t,this.table.fireEvent("pageChange",this.currentPage))}.bind(this)})},onPageClick:function(e){e.target.hasClass("selected")||(this.currentPage=parseInt(e.target.get("text")),isNaN(this.currentPage)||this.currentPage--,this.table.fireEvent("pageChange",this.currentPage))}}),UIPromptPositionObject={position:"absolute",top:!1,left:!1},UILoaderObject={message:"Loading",onClose:function(){},timeout:null,position:{},showButtons:!1,showLoader:!0,noClose:!0,cssSelector:""},UIMessageObject={message:"Message!",onClose:function(){},timeout:null,position:{},cssSelector:""},UIAlertObject={message:"Alert!",messageAlign:"center",okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},showButtons:!0,showCancel:!1,noClose:!1,showLoader:!1,append:!1,position:{},cssSelector:"",showHiddenInfo:!1,hiddenInfoMessage:"",hiddenInfoButtonText:""},UIConfirmObject={message:"Yes or No?",messageAlign:"center",okText:"Yes",okIcon:"",okColor:"green",cancelText:"No",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPromptObject={message:"Enter text",messageAlign:"center",lines:1,okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",value:"",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPompts=new Class({Version:"1.0.4.0",Sequence:1050,Name:"Prompts",File:"ui.prompts.js",Jira:"",Notes:"Added value for TS Favs edit",Implements:[Options],Binds:["returnOptionsObject","message","alert","prompt","confirm","loader","center","show","escape","hide","hideDelay","clearHideDelay","okKeyUp"],options:{},status:"closed",message:"",currentObj:!1,container:!1,currentType:"",initialize:function(e){this.setOptions(e),document.id("UIPromtBoxBG")?this.promptBoxBG=document.id("UIPromtBoxBG"):this.promptBoxBG=new Element("div",{id:"UIPromtBoxBG",class:"UIPromtBoxBG"}).inject(document.body,"bottom"),this.promptBoxBG.set("tween",{duration:250}),this.promptBoxBG.fade("hide"),document.id("UIPromtBox")?this.promptBox=document.id("UIPromtBox"):this.promptBox=new Element("div",{id:"UIPromtBox",class:"UIPromtBox"}).inject(document.body,"bottom"),this.promptBox.set("tween",{duration:250}),this.promptBox.fade("hide"),this.container=this.promptBox,this.trueButton=new Element("span",{class:"button true-button w-icon",tabindex:9999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{class:"label",html:""})),this.falseButton=new Element("span",{class:"button false-button w-icon",tabindex:9999999}).adopt(new Element("span",{html:Affinity.icons.Cancel||"&#xe070;"}),new Element("span",{class:"label",html:""})),this.promptBoxBG.removeEvents(),this.promptBoxBG.addEvent("keyup",function(e){if(e.stop(),!this.obj.noClose&&"esc"==e.key)return void this.hide();"enter"==e.key&&this.obj.onOk()}.bind(this)),Affinity.mobile&&(window.removeEvent("mobileback",this.escape),window.addEvent("mobileback",this.escape)),window.prompts=this,window.uimessage=this.message,window.uialert=this.alert,window.uiconfirm=this.confirm,window.uiprompt=this.prompt,window.uiloader=this.loader},returnOptionsObject:function(e){var t={},i=Object.clone(e);return Object.merge(t,i)},message:function(e){var t=this.returnOptionsObject(UIMessageObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.timeout=e.timeout?e.timeout:t.timeout,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,class:"content align"+t.messageAlign})),this.center(),this.show(),null!==t.timeout&&this.hide.delay(t.timeout,this)},addLargeMessage:function(e){var t=new Element("div",{html:e,styles:{width:"100%","max-height":150,overflow:"auto","text-align":"left",margin:"10px 0"}});this.promptBox.getElement(".promptButtons")?t.inject(this.promptBox.getElement(".promptButtons"),"before"):t.inject(this.promptBox),this.center(),t=null},adopt:function(){for(var e=this.promptBox.getElement(".content"),t=0;t<arguments.length;t++)e.adopt(arguments[t]);t=e=null,this.center()},alert:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UIAlertObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,t.okColor=e.okColor?e.okColor:t.okColor,t.cancelText=e.cancelText?e.cancelText:t.cancelText,t.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,t.cancelColor=e.cancelColor?e.cancelColor:t.cancelColor,t.onOk=e.onOk?e.onOk:t.onOk,t.onCancel=e.onCancel?e.onCancel:t.onCancel,t.showButtons="boolean"===typeOf(e.showButtons)?e.showButtons:t.showButtons,t.showCancel="boolean"===typeOf(e.showCancel)?e.showCancel:t.showCancel,t.noClose="boolean"===typeOf(e.noClose)?e.noClose:t.noClose,t.showLoader="boolean"===typeOf(e.showLoader)?e.showLoader:t.showLoader,t.append=e.append?e.append:t.append,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.showHiddenInfo="boolean"===typeOf(e.showHiddenInfo)?e.showHiddenInfo:t.showHiddenInfo,t.hiddenInfoMessage=e.hiddenInfoMessage?e.hiddenInfoMessage:t.hiddenInfoMessage,t.hiddenInfoButtonText=e.hiddenInfoButtonText?e.hiddenInfoButtonText:t.hiddenInfoButtonText,void 0!==e.isCloseOnClick&&(t.isCloseOnClick=e.isCloseOnClick),t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){t.onOk(),this.hide()}.bind(this),this.onCancelMethod=function(){t.onCancel(),this.hide()}.bind(this);var i=this.falseButton.clone().removeEvents().addClass(t.cancelColor).addClass("hidden").addEvent("click",this.onCancelMethod);i.getElement("span").set("html",t.cancelIcon),i.getElement(".label").set("html",t.cancelText);var s=new Element("span",{html:"&nbsp;",class:"hidden"});if(this.message=t.append?this.message+(""!==this.message?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,class:"content align"+t.messageAlign})),t.showHiddenInfo){var n=new Element("div",{class:"hiddenInfoContainer",style:"display: none;",html:"<br />"+t.hiddenInfoMessage}).inject(this.promptBox),o=new Element("div",{class:"tooltip-view ui-has-tooltip more-button tile-more-button",style:"text-align: center;",html:'<br /><span class="button more w-icon more-info-button"><span class="icon-info"></span><span class="btn-tag tile-more">'+t.hiddenInfoButtonText+"</span></span>"}).inject(this.promptBox),a=new Element("div",{style:"text-align: center;",class:"tooltip-view ui-has-tooltip more-button tile-more-button",html:'<span class="button more w-icon more-info-button"><span></span><span class="btn-tag tile-more">Hide</span></span>'}).inject(n);o.addEvent(Affinity.events.click,function(e){n.style.display="block",o.style.display="none"}.bind(this)),a.addEvent(Affinity.events.click,function(e){n.style.display="none",o.style.display="block"}.bind(this))}return t.showLoader?(this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader")):this.promptBox.removeClass("loader"),t.noClose?this.promptBox.getElement("promptButtons")&&this.promptBox.getElement("promptButtons").destroy():t.showButtons&&(this.promptBox.adopt(new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),s,i)),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText)),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.showButtons||t.noClose?t.showCancel&&(s.removeClass("hidden"),i.removeClass("hidden")):this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.center(),this.show(),this},prompt:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UIPromptObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.value=e.value?e.value:t.value,t.lines=e.lines?e.lines:t.lines,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,t.okColor=e.okColor?e.okColor:t.okColor,t.onOk=e.onOk?e.onOk:t.onOk,t.cancelText=e.cancelText?e.cancelText:t.cancelText,t.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,t.cancelColor=e.cancelColor?e.cancelColor:t.cancelColor,t.onCancel=e.onCancel?e.onCancel:t.onCancel,t.noClose="boolean"===typeOf(e.noClose)?e.noClose:t.noClose,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){var e=document.id("UIPromtBox").getElement(".promptinput").value;this.hide(),t.onOk(e)}.bind(this),this.onCancelMethod=function(){var e=document.id("UIPromtBox").getElement(".promptinput").value;this.hide(),t.onCancel(e)}.bind(this);var i;return i=t.lines<2?new Element("input",{type:"text",class:"promptinput data-hj-whitelist",tabindex:9999997}):new Element("textarea",{rows:t.lines,class:"promptinput data-hj-whitelist",tabindex:9999997}),i.value=t.value,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,class:"content align"+t.messageAlign}),new Element("div",{class:"promptButtons"}).adopt(i),new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this.promptBox.getElement(".promptinput").focus(),this},confirm:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UIConfirmObject);return t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,t.okColor=e.okColor?e.okColor:t.okColor,t.onOk=e.onOk?e.onOk:t.onOk,t.cancelText=e.cancelText?e.cancelText:t.cancelText,t.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,t.cancelColor=e.cancelColor?e.cancelColor:t.cancelColor,t.onCancel=e.onCancel?e.onCancel:t.onCancel,t.noClose="boolean"===typeOf(e.noClose)?e.noClose:t.noClose,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){this.hide(),t.onOk(!0)}.bind(this),this.onCancelMethod=function(){this.hide(),t.onCancel(!1)}.bind(this),this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,class:"content align"+t.messageAlign}),new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"
}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),this.currentObj=t,window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this},loader:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UILoaderObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.message=t.append?this.message+(""!==this.message?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,class:"content align"+t.messageAlign})),this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader"),window.removeEvent("keyup",this.okKeyUp),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.center(),this.show()},getCalculatedTop:function(){if(Affinity.oldess&&Affinity.oldessFrame){var e=this.promptBox.getSize(),t=e.y/2,i=window.parent.window,s=i.document.documentElement,n=i.document.body,o=s&&s.scrollTop||n&&n.scrollTop||0,a=i.innerHeight||i.document.documentElement.clientHeight,r=0,l=window.parent.document.getElementById("ctl00_MainPanel");if(l&&(r=document.documentMode&&document.documentMode<9?l.querySelectorAll(".ContentBody")[0].offsetTop:l.getElementsByClassName("ContentBody")[0].offsetTop),"fixed"===this.promptBox.getStyle("position"))return a/2-r;var h=o+a/2-r;return h<t+10&&(h=t+10),h+10}var u=document.getSize();if("fixed"===this.promptBox.getStyle("position"))return u.y/2;var c=document.getScroll();return u.y/2+c.y},center:function(){if(!Affinity.mobile){var e=this.promptBox.getSize(),t=this.getCalculatedTop(),i="50%",s=0-e.y/2,n=0-e.x/2,o="absolute";if("null"!==typeOf(this.currentObj)&&"null"!==typeOf(this.currentObj.position)){var a=this.currentObj.position;o=a.position?a.position:"absolute",t=a.top?a.top:t,i=a.left?a.left:i,s=a.top?0:s,n=a.left?0:n}this.promptBox.setStyles({position:o,top:t,left:i,margin:s+"px 0 0 "+n+"px"})}},okKeyUp:function(e){"enter"==e.key&&"open"==this.status&&(this.promptBox.getElement(".promptinput")?this.promptBox.getElement(".promptinput")!=document.activeElement&&this.onEnterMethod():this.onEnterMethod())},showButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").removeClass("hidden"),this.promptBoxBG&&(this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.promptBoxBG.addEvent(Affinity.events.click,this.hide)))},hideButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").addClass("hidden"),this.promptBoxBG&&this.promptBoxBG.removeEvent(Affinity.events.click,this.hide))},show:function(){this.promptBoxBG.fade("in"),this.promptBox.fade("in"),this.status="open"},escape:function(){this.currentOb&&!this.currentOb.noClose&&this.hide()},clearOnClose:function(){window.onPromptClose=function(){}},hide:function(e){if("string"!=typeof e||""===e||e===this.currentType){"onPromptClose"in window&&window.onPromptClose(),this.clearOnClose(),this.promptBoxBG.fade("out"),this.promptBox.fade("out"),this.status="closed",this.message="",window.removeEvent("keyup",this.okKeyUp);try{this.promptBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(e){}this.currentObj=!1,this.currentType=""}},hideDelayTimer:!1,hideDelay:function(e){this.clearHideDelay(),this.hideDelayTimer=this.hide.delay(e)},clearHideDelay:function(){clearTimeout(this.hideDelayTimer)}}),UIQuickSearch=new Class({Implements:[Options],Binds:["search"],options:{},lists:{},initialize:function(e){this.setOptions(e);Array.each(document.getElements(".ui-quick-search"),function(e){this.processQiucksearch(e)}.bind(this))},processQiucksearch:function(e){if(searchbox=new Element("input",{type:"text",placeholder:"Search",class:"search-box-input"}).store("list",e).addEvent("keyup",this.search),"ul"!=e.get("tag")&&"ol"!=e.get("tag")||searchbox.inject(e,"before"),"th"==e.get("tag")){var t=e.get("html");e.empty(),new Element("table",{class:"search-box"}).adopt(new Element("tr").adopt(new Element("th",{html:t}),new Element("th").adopt(searchbox))).inject(e),delete t}delete searchbox},search:function(e){var t,i,s=e.target.value.toLowerCase(),n=e.target.retrieve("list");if(e.target.getParent(".ui-quick-search")&&"th"==e.target.getParent(".ui-quick-search").get("tag")){var o=n.cellIndex;s.length>0?Array.each(n.getParent("table").getElements("tbody tr"),function(e){t=e.getElements("td")[o].get("html").trim().toLowerCase().toLowerCase(),0==t.indexOf(s)?e.removeClass("hidden"):e.addClass("hidden")}):n.getParent("table").getElements("tbody tr").removeClass("hidden"),document.uiGrid.processTables(n.getParent("table")),delete o}else s.length>0?Array.each(n.getElements("li"),function(e,n){t=e.get("html").trim().toLowerCase().toLowerCase(),i=e.get("data-value").trim().toLowerCase().toLowerCase(),0==t.indexOf(s)||0==i.indexOf(s)?e.removeClass("hidden"):e.addClass("hidden")}):n.getElements("li").removeClass("hidden");delete s,delete t,delete i}}),UIReplaceArrows=new Class({Implements:[Options],Binds:["processArrows","processInlineArrows"],Options:{},initialize:function(e){this.setOptions(e),this.processArrows()},processArrows:function(){var e,t,i,s,n,o=0;Array.each(document.getElements(".ui-replace-arrows td").combine(document.getElements(".ui-replace-arrows th")),function(a,r){0==a.getElements(".button,button").length&&(e=a.get("html").split(","),a.empty(),Array.each(e,function(r,l){r.contains("-&gt;")||r.contains("->")?(r.contains("-&gt;")&&(t=r.split("-&gt;")),r.contains("->")&&(t=r.split("->")),i=new Element("table",{class:"arrow-table"}).inject(a),s=new Element("tr").inject(i),n=new Element("span",{html:t[0].trim()}).inject(new Element("td",{class:"left"}).inject(s)),new Element("span",{class:"smicon arrow"}).inject(new Element("td",{class:"arrow"}).inject(s)),new Element("td",{html:t[1].trim()}).inject(s),w=n.getSize().x,o=w>o?o=w:o):(new Element("span",{html:r.trim()}).inject(a),e.length>1&&new Element("br").inject(a))}))}),o>0&&document.getElements("td.left").setStyle("width",o),delete e,delete t,delete i,delete s,delete n},processInlineArrows:function(){var e=[];e.combine(document.getElements(".ui-replace-arrows td")),e.combine(document.getElements(".ui-replace-arrows li")),Array.each(e,function(e,t){("td"==e.get("tag")&&0==e.getElements(".button,button").length||"td"!=e.get("tag"))&&(e.get("html").contains("-&gt;")&&e.set("html",e.get("html").replace(/-&(gt);/g,'<span class="smicon arrow"></span>')),e.get("html").contains("->")&&e.set("html",e.get("html").replace(/->/g,'<span class="smicon arrow"></span>')))}),e=null,delete e}}),UISanitise=new Class({Implements:[Options],Binds:["init","processNew"],options:{prettyDateFormat:"%a %e %b %Y"},initialize:function(e){this.setOptions(e),this.init()},processNew:function(){this.init()},init:function(){var e,t;Array.each(document.getElements(".ui-sanatise"),function(i){""!==i.get("html")&&(i.get("data-sanatise-method")&&(e="sanatise"+i.get("data-sanatise-method").capitalize(),"function"==typeOf(this[e])&&(t=i.get("data-sanatise-params")?this[e](i.get("html"),i.get("data-sanatise-params").split(",")):this[e](i.get("html")),i.set("html",t))),i.removeClass("ui-sanatise"),i.erase("data-sanatise-method"),i.erase("data-sanatise-params"))}.bind(this)),delete e,delete t},setPrettyDateformat:function(e){this.options.prettyDateFormat=e},sanatiseCurrency:function(e){var t=parseFloat(e);return isNaN(t)?"$"+e:t.formatCurrency()},sanatiseHourstodays:function(e,t){var i=8;"array"!=typeOf(t)||isNaN(parseFloat(t[0]))||(i=parseFloat(t[0]));var s=parseFloat(e);return isNaN(s)?e:(s/i).round(0)+" day(s)"},sanatisePrettydate:function(e){var t=Date.parse(e);return t?t.format(this.options.prettyDateFormat):e}}),UISectionHideables=new Class({Version:"1.0.0.0",File:"ui.section.hidables.js",Implements:[Options],Binds:["processNew","process","switchClicked"],options:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(e){this.setOptions(e),this.hideableTriggerElements=document.getElements(".is-section-switch"),this.hideableTriggerElements.length>1&&Array.each(this.hideableTriggerElements,this.process)},process:function(e){if(e){e.removeClass("is-section-switch").addClass("section-switch");var t,i,s;t=e,i=e.getParent("form").getElements(".section"),i.shift(),Array.each(e.getParent("form").getElement(".section").getElements(".section-body"),function(e){i.push(e)}),s=[],Array.each(i,function(e){e.hasClass("-hidable-attached")||(s.push(new Fx.Reveal(e,{duration:250,mode:"vertical"})),e.addClass("-hidable-attached"))}),t.set("html",Affinity.icons.ArrowLineUp),t.store("sectionSwitchers",s),t.addEvent(Affinity.events.click,this.switchClicked),t.store("switchStatus","open"),t.removeClass("hidden"),this.setTooltip(t)}else console.error("section hidable: no eleemnt set")},setTooltip:function(e){Affinity.tooltips.removeTooltip(e),e.addClass("ui-has-tooltip"),"closed"===e.retrieve("switchStatus")?e.set("data-tooltip","Show Section"):e.set("data-tooltip","Hide Section"),e.set("data-tooltip-dir","top,left"),Affinity.tooltips.processTooltip(e)},switchClicked:function(e){var t=e.target.hasClass("section-switch")?e.target:e.target.getParent(".section-switch"),i=[],s=[],n=0;"open"===t.retrieve("switchStatus")?(t.set("html",Affinity.icons.ArrowLineDown),t.store("switchStatus","closed"),Array.each(t.retrieve("sectionSwitchers"),function(e){i.contains(e.subject)||(e.dissolve(),i.push(e.subject))}),this.setTooltip(t)):(Array.each(document.getElements(".section-switch"),function(e){e!==t&&"open"===e.retrieve("switchStatus")&&(n=250,i.push(e),e.set("html",Affinity.icons.ArrowLineDown),e.store("switchStatus","closed"),Array.each(e.retrieve("sectionSwitchers"),function(e){i.contains(e.subject)||(e.dissolve(),i.push(e.subject))}),this.setTooltip(e))}.bind(this)),function(){t.set("html",Affinity.icons.ArrowLineUp),Array.each(t.retrieve("sectionSwitchers"),function(e){s.contains(e.subject)||(e.reveal(),s.push(e.subject))}),t.store("switchStatus","open"),this.setTooltip(t)}.delay(n,this))},showSectionBySwitcher:function(e){var t=e,i=[],s=[],n=0;t&&(Array.each(document.getElements(".section-switch"),function(e){e!==t&&"open"===e.retrieve("switchStatus")&&(n=250,s.push(e),e.set("html",Affinity.icons.ArrowLineDown),e.store("switchStatus","closed"),Array.each(e.retrieve("sectionSwitchers"),function(e){s.contains(e.subject)||(e.dissolve(),s.push(e.subject))}),this.setTooltip(e))}.bind(this)),"closed"===t.retrieve("switchStatus")&&function(){t.set("html",Affinity.icons.ArrowLineUp),Array.each(t.retrieve("sectionSwitchers"),function(e){i.contains(e.subject)||(e.reveal(),i.push(e.subject))}),t.store("switchStatus","open"),this.setTooltip(t)}.delay(n,this))}}),UISelectLookup=new Class({Version:"1.0.4.0",File:"ui.select.lookups.js",Notes:"remove superfluous logging",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","refreshQueue","cancelQueue","processQueue","removeFromQueue","addToQueue","addDefaultOption","addFilterOption"],options:{jsonp:!1},enabled:!1,initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.lookups||(Affinity.UI.lookups={}),Affinity.UI.lookups.processLookup=this.processLookup,Affinity.UI.lookupLoaders=[],window.addEvent("refreshQueues",this.refreshQueue),Affinity.login?(window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this))):(this.enabled=!0,this.processNew())},processNew:function(e){this.setOptions(e);var t=document.getElements("select.has-lookup");Array.each(t,this.processLookup),this.processQueue(),delete t},processLookup:function(e){if(e.removeClass("has-lookup").addClass("was-lookup"),!e.hasClass("has-dependencies")&&(e.addClass("lookup-loading"),e.get("data-lookup-api"))){var t,i;if(e.get("data-lookup-api")&&(e.removeClass("has-display-lookup"),""!==e.get("data-lookup-api")&&(t=e.get("data-lookup-api"),e.retrieve("original-lookup-url")||e.store("original-lookup-url",t),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.lookups[i]?Affinity.UI.lookups[i].elements.contains[e]||Affinity.UI.lookups[i].elements.push(e):Affinity.UI.lookups[i]={api:t,id:"lookup_"+String.uniqueID(),type:"select",loaded:!1,massive:!1,elements:[e]})),e.addClass("hidden"),!e.getParent().getElement(".lookup-spinner")){var s=new Element("span",{html:'<img src="'+Affinity.loaders.light+'" />',class:"lookup-spinner hidden"}).inject(e,"after");e.store("spinner",s),e.getParent().getElement(".ui-autocomplete-display")||s.removeClass("hidden")}if(!e.getParent().getElement(".errorstr")){var n=new Element("span",{class:"errorstr inplace-of-input hidden"}).inject(e,"after");e.store("error",n)}window.fireEvent("lookupComplete",e),e.addChangeTracker(),e.fireEvent("lookup")}},getApiKey:function(e){var t,i,s=new URI(e.toLowerCase()),n=s.get("query").parseQueryString(),o=[],a=[],r=!1,l="";return Object.each(n,function(e,t){"ran"!==t.toLowerCase()&&("parameters"!==t?o.push(t+"-"+e):r=JSON.parse(e))}),o=o.sort(),r&&"object"===typeOf(r)&&"parameter"in r&&"array"===typeOf(r.parameter)&&(Array.each(r.parameter,function(e){t=[],Object.each(e,function(e,i){"ran"!==i.toLowerCase()&&t.push(i+"-"+e)}),t.sort(),a.push(t.join("|"))}),a.sort(),l="|parameters|"+a.join("||")),i=o.join("|")+l,"display-"+i.replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,function(e){"cancel"in e&&e.cancel(),e.removeEvents(),e=null}),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,function(e,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null}),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){return this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,function(e){"cancel"in e&&e.cancel(),"removeEvents"in e&&e.removeEvents(),e=null}),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,function(e,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null,Affinity.UI.lookups[t].elements=[],Affinity.UI.lookups[t]=null,delete Affinity.UI.lookups[t]}),Affinity.UI.lookups={},!0},processQueue:function(){var e,t;try{Object.each(Affinity.UI.lookups,function(i,s){this.enabled&&(!0===Affinity.UI.lookups[s].loaded&&this.setElements(s),!1===Affinity.UI.lookups[s].loaded&&(t=Affinity.UI.lookups[s].api,Affinity.UI.lookups[s].loaded="loading...",(e=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:t,method:"get",timeout:6e4,onComplete:function(e){JSON.Unauthorized(e,Affinity.UI.lookups[s].id)||(Affinity.UI.lookups[s].data=e,"error"in e?e.error.test("limit","gi")?(Affinity.UI.lookups[s].data=[],Affinity.UI.lookups[s].massive=!0,Affinity.UI.lookups[s].loaded=!0,this.setElements(s)):(this.setError(s,e.error&&""!==e.error?e.error:"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1):"array"===typeOf(e)&&e.length>0?(Affinity.UI.lookups[s].loaded=!0,this.setElements(s)):(Affinity.UI.lookups[s].loaded=!1,this.hideLoader(s),this.setError(s,"Data returned as empty array"),Array.each(Affinity.UI.lookups[s].elements,function(e){e.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(e){this.setError(s,"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1}.bind(this),onFailure:function(e){this.setError(s,"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1}.bind(this),onTimeout:function(){this.setError(s,"lookup timed out"),Affinity.UI.dependancies[s].loaded=!1}.bind(this)}):new Request.JSON({url:t,method:"get",timeout:6e4,onSuccess:function(e){JSON.Unauthorized(e,Affinity.UI.lookups[s].id)||(Affinity.UI.lookups[s].data=e,"error"in e?e.error.test("limit","gi")?(Affinity.UI.lookups[s].data=[],Affinity.UI.lookups[s].massive=!0,Affinity.UI.lookups[s].loaded=!0,this.setElements(s)):(this.setError(s,e.error&&""!==e.error?e.error:"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1):"array"===typeOf(e)&&e.length>0?(Affinity.UI.lookups[s].loaded=!0,this.setElements(s)):(Affinity.UI.lookups[s].loaded=!1,this.hideLoader(s),this.setError(s,"Data returned as empty array"),Array.each(Affinity.UI.lookups[s].elements,function(e){e.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(e){this.setError(s,"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1}.bind(this),onFailure:function(e){this.setError(s,"There was an error retrieving this data"),Affinity.UI.lookups[s].loaded=!1}.bind(this),onTimeout:function(){this.setError(s,"lookup timed out"),Affinity.UI.dependancies[s].loaded=!1}.bind(this)}))&&(Affinity.UI.lookupLoaders.push(e),e.send())))}.bind(this))}catch(e){}},removeFromQueue:function(e,t,i){var s,n;return t&&t.getWidget()&&(s=t.getWidget(),s.hasOwnProperty("revert")&&(s.revert(),"boolean"===typeOf(i)&&!0===i&&("empty"in t&&t.empty(),"value"in t&&(t.value="")))),t.retrieve("spinner")&&(spinner=t.retrieve("spinner"),spinner&&"destroy"in spinner&&spinner.destroy()),t.retrieve("error")&&(error=t.retrieve("error"),error&&"destroy"in error&&error.destroy()),Array.each(Affinity.UI.lookups,function(e,i){e.elements.contains(t)&&(n=e.elements.indexOf(t),array.splice(n,1))}),!0},addFilterOption:function(e,t){return e.set("filter-option",t),!0},addDefaultOption:function(e,t){if(t)e.adopt(t);else{var i=new Element("option",{value:"",html:"None"});e.adopt(i)}},addToQueue:function(e,t){return t.set("data-lookup-api",e),this.processLookup(t),!0},hideLoader:function(e){Array.each(Affinity.UI.lookups[e].elements,function(e){e.retrieve("spinner")&&e.retrieve("spinner").addClass("hidden")}.bind(this))},setError:function(e,t){Array.each(Affinity.UI.lookups[e].elements,function(e){e.retrieve("spinner")&&e.retrieve("spinner").addClass("hidden"),e.retrieve("error")&&(e.get("data-lookup-error-str")&&""!==e.get("data-lookup-error-str").trim()?e.retrieve("error").set("html",e.get("data-lookup-error-str").trim()).removeClass("hidden"):e.retrieve("error").set("html",t).removeClass("hidden"))}.bind(this))},setElements:function(e){Array.each(Affinity.UI.lookups[e].elements,function(t){if("null"!==typeOf(t)&&"function"===typeOf(t.get)&&t.get("data-lookup-api")){var i=this.filterSelect(t,Affinity.UI.lookups[e].data);this.populateSelect(t,i,e),t.erase("data-lookup-api")}}.bind(this))},filterSelect:function(e,t){var i=e.get("filter-option");return i?t.filter(function(e){return e.Value.indexOf(i)>-1}):t},populateSelect:function(e,t,i){var s,n,o=!1,a=e.get("data-default-value")||"",r=e.get("data-lookup-rules")?e.get("data-lookup-rules").split(","):[],l=e.getElements("option").length>0&&""!==e.getElements("option")[0].get("html").trim();if("array"===typeOf(t)){var h="null"!==typeOf(t[0])?t[0].Value:"";if(e.removeClass("lookup-loading"),Affinity.UI.lookups[i].massive||t.length>Affinity.selectmax)e.addClass("massive").store("data-store","lookups").store("data-key",i).store("data-value",a).store("data-label",a);else{var u={},c=e.getElements("option");c&&c.length>0&&Array.each(c,function(e){u[e.get("value")]=e}),c=null,Array.each(t,function(t,i){s=!1,n=t.Value,u[t.Key]?s=u[t.Key]:r.contains("hasValue")?""!==t.Value.trim()&&(s=new Element("option",{value:t.Key,html:n})):s=new Element("option",{value:t.Key,html:n}),s&&(t.Key==a?(s.set("selected","selected"),h=a,o=!0):r.contains("hasValue")&&""===a&&0===i&&(a=t.Key,s.set("selected","selected"),e.set("data-default-value",a),h=a,o=!0),e.adopt(s))})}var d="UIAutoComplete"in window&&"class"==typeOf(window.UIAutoComplete),p="UIAutoCompleteWidget"in window&&"class"==typeOf(window.UIAutoCompleteWidget);!o&&""==a&&"array"==typeOf(t)&&t.length>0&&(o=!0),e.retrieve("spinner")&&e.retrieve("spinner").destroy(),e.removeClass("hidden"),t.length>=Affinity.selectToAutoNum&&d&&e.addClass("ui-autocomplete"),e.hasClass("ui-autocomplete")&&p&&(e.removeClass("ui-autocomplete"),new UIAutoCompleteWidget({selectElement:e})),!l&&e.retrieve("changetracker")&&e.retrieve("changetracker").setValue(e,a),o&&(e.get("onChange")||e.get("onchange")?e.onChange():e.fireEvent("change",{target:e})),e.fireEvent("lookupComplete",{defaultValue:a,value:h,target:e})}delete o,delete s,delete a}}),UISideNav=new Class({Implements:[Options],Binds:["procesExistingNav","procesNav","itemClicked","show","hide"],Options:{nav:[]},initialize:function(e){this.setOptions(e),document.id("sidenav")&&(window.mobile&&(this.mobilenavopen=!1),this.showTween=new Fx.Tween(document.id("sidenav"),{property:"width",chain:!1,duration:250,transition:Fx.Transitions.Sine.easeOut,onComplete:function(){this.mobilenavopen=!0}.bind(this)}),this.hideTween=new Fx.Tween(document.id("sidenav"),{property:"width",chain:!1,duration:750,transition:Fx.Transitions.Bounce.easeOut,onComplete:function(){this.mobilenavopen=!1}.bind(this)}),window.mobile&&(this.mobilenavopen=!1),document.id("sidenav").addEvent(Affinity.events.over,this.show),document.id("sidenav").addEvent(Affinity.events.out,this.hide),this.navItems=[],Array.each(document.getElements("#sidenav .navitem"),this.procesExistingNav),this.navItems.append(this.options.nav),Array.each(this.navItems,this.procesNav))},procesExistingNav:function(e,t){var i=new UISideNavItem({name:e.getElement(".label").get("html").replace(/ /g,"").camelCase(),label:e.getElement(".label").get("html"),icon:e.getElement(".icon").get("class").replace("icon","").trim(),href:e.getElement("a").get("href")});this.navItems.push(i),e.destroy()},procesNav:function(e,t){e.returnElement().inject(document.id("sidenav")),e.element.addEvent(Affinity.events.click,this.itemClicked),this.navItems.push(e)},itemClicked:function(e){this.hide()},show:function(){(!window.mobile||window.mobile&&!this.mobilenavopen)&&(this.hideTween.cancel(),this.showTween.start(200))},hide:function(){(!window.mobile||window.mobile&&this.mobilenavopen)&&(this.showTween.cancel(),this.hideTween.start(40))}}),UISideNavItem=new Class({Implements:[Options],Options:{name:"",label:"",icon:"",href:""},name:"",label:"",icon:"",href:"",element:null,initialize:function(e){this.setOptions(e),this.name=this.options.name,this.label=this.options.label,this.icon=this.options.icon,this.href=this.options.href},returnElement:function(){if(null==this.element){this.element=new Element("div",{class:"navitem"});var e=new Element("a",{href:this.href,target:"_blank"}).inject(this.element);new Element("span",{class:"icon "+this.icon}).inject(e),new Element("span",{class:"label",html:this.label}).inject(e),e=null,delete e}return this.element}}),UISortableGrid=new Class({Implements:[Options],Binds:["sortColumn","continueSort"],Options:{container:null},tables:{},initialize:function(e){this.setOptions(e),null==this.options.container&&(this.options.container=document.body),Array.each(document.getElements("table.sortable .sort"),function(e){var t=e.getParents("table")[0],i=t.get("id"),s=e.get("id");null==i&&(i=String.uniqueID(),t.set("id",i)),null==s&&(s=String.uniqueID(),e.set("id",s)),new Element("div",{class:"dir",html:"&nbsp;",styles:{float:"right"}}).inject(e,"bottom"),this.tables[i]||(this.tables[i]={table:t,columns:{}}),this.tables[i].columns[s]||(this.tables[i].columns[s]={direction:-1,sortables:[]});var n=e.getAllPrevious().length,o=e.get("data-sort-method");null!=o&&(Array.each(t.getElements(".sortable"),function(e,t){e.getAllPrevious().length==n&&(e.getParent("tr").addClass("sort"+t),"int"==o?this.tables[i].columns[s].sortables.push([parseInt(e.get("html")),"sort"+t]):"date"==o?e.get("data-sort-timestamp")?this.tables[i].columns[s].sortables.push([e.get("data-sort-timestamp"),"sort"+t]):this.tables[i].columns[s].sortables.push([Date.parse(e.get("html")).format("%s"),"sort"+t]):this.tables[i].columns[s].sortables.push([e.get("html"),"sort"+t]))}.bind(this)),e.addEvent("mousedown",function(e){e.preventDefault()}),e.addEvent("click",this.sortColumn),e.setStyle("cursor","pointer"))}.bind(this))},multisort:function(e,t){return e[0]==t[0]?0:e[0]<t[0]?-1:1},sortColumn:function(e){e.target.getParent("table").setStyle("opacity",.25),this.continueSort.delay(10,this,[e])},upchar:"&#9650;",downchar:"&#9660;",continueSort:function(e){var t=e.target.getParent("table"),i=t.get("id"),s=e.target.hasClass("sort")?e.target:e.target.getParent(".sort"),n=s.get("id"),o=this.tables[i].columns[n].direction*=-1;this.tables[i].columns[n].sortables.sort(this.multisort),this.tables[i].columns[n].direction<0&&this.tables[i].columns[n].sortables.reverse();var a=this.tables[i].table.getElement("tr");t.getElements(".dir").set("html","&nbsp;"),s.getElement(".dir").set("html",o>0?this.downchar:this.upchar),Array.each(this.tables[i].columns[n].sortables,function(e){this.tables[i].table.getElement("."+e[1]).inject(a,"after")}.bind(this)),t.setStyle("opacity",1),document.uiGrid&&document.uiGrid.zebra(t)},returnData:function(e,t){t=void 0!==t&&t;var i,s=[],n=e.getElements("tr th");return Array.each(e.getElements("tr"),function(e){i={},Array.each(e.getElements("td"),function(e,t){i[n[t].get("data-name")]=e.get("html")}.bind(this)),Object.getLength(i)>0&&s.push(i)}.bind(this)),t?JSON.stringify(s):s}});!function(e,t){"object"==typeof exports?module.exports=t():"function"==typeof define&&define.amd?define(t):e.Spinner=t()}(this,function(){"use strict";function e(e,t){var i,s=document.createElement(e||"div");for(i in t)s[i]=t[i];return s}function t(e){for(var t=1,i=arguments.length;t<i;t++)e.appendChild(arguments[t]);return e}function i(e,t,i,s){var n=["opacity",t,~~(100*e),i,s].join("-"),o=.01+i/s*100,a=Math.max(1-(1-e)/t*(100-o),e),r=l.substring(0,l.indexOf("Animation")).toLowerCase(),h=r&&"-"+r+"-"||"";return u[n]||(c.insertRule("@"+h+"keyframes "+n+"{0%{opacity:"+a+"}"+o+"%{opacity:"+e+"}"+(o+.01)+"%{opacity:1}"+(o+t)%100+"%{opacity:"+e+"}100%{opacity:"+a+"}}",c.cssRules.length),u[n]=1),n}function s(e,t){var i,s,n=e.style;if(void 0!==n[t])return t;for(t=t.charAt(0).toUpperCase()+t.slice(1),s=0;s<h.length;s++)if(i=h[s]+t,void 0!==n[i])return i}function n(e,t){for(var i in t)e.style[s(e,i)||i]=t[i];return e}function o(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var s in i)void 0===e[s]&&(e[s]=i[s])}return e}function a(e){for(var t={x:e.offsetLeft,y:e.offsetTop};e=e.offsetParent;)t.x+=e.offsetLeft,t.y+=e.offsetTop;return t}function r(e){if(void 0===this)return new r(e);this.opts=o(e||{},r.defaults,d)}var l,h=["webkit","Moz","ms","O"],u={},c=function(){var i=e("style",{type:"text/css"});return t(document.getElementsByTagName("head")[0],i),i.sheet||i.styleSheet}(),d={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"auto",left:"auto",position:"relative"};r.defaults={},o(r.prototype,{spin:function(t){this.stop();var i,s,o=this,r=o.opts,h=o.el=n(e(0,{className:r.className}),{position:r.position,width:0,zIndex:r.zIndex}),u=r.radius+r.length+r.width;if(t&&(t.insertBefore(h,t.firstChild||null),s=a(t),i=a(h),n(h,{left:("auto"==r.left?s.x-i.x+(t.offsetWidth>>1):parseInt(r.left,10)+u)+"px",top:("auto"==r.top?s.y-i.y+(t.offsetHeight>>1):parseInt(r.top,10)+u)+"px"})),h.setAttribute("role","progressbar"),o.lines(h,o.opts),!l){var c,d=0,p=(r.lines-1)*(1-r.direction)/2,m=r.fps,f=m/r.speed,g=(1-r.opacity)/(f*r.trail/100),v=f/r.lines;!function e(){d++;for(var t=0;t<r.lines;t++)c=Math.max(1-(d+(r.lines-t)*v)%f*g,r.opacity),o.opacity(h,t*r.direction+p,c,r);o.timeout=o.el&&setTimeout(e,~~(1e3/m))}()}return o},stop:function(){var e=this.el;return e&&(clearTimeout(this.timeout),e.parentNode&&e.parentNode.removeChild(e),this.el=void 0),this},lines:function(s,o){function a(t,i){return n(e(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:t,boxShadow:i,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*h+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var r,h=0,u=(o.lines-1)*(1-o.direction)/2;h<o.lines;h++)r=n(e(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:l&&i(o.opacity,o.trail,u+h*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&t(r,n(a("#000","0 0 4px #000"),{top:"2px"})),t(s,t(r,a(o.color,"0 0 1px rgba(0,0,0,.1)")));return s},opacity:function(e,t,i){t<e.childNodes.length&&(e.childNodes[t].style.opacity=i)}});var p=n(e("group"),{behavior:"url(#default#VML)"});return!s(p,"transform")&&p.adj?function(){function i(t,i){return e("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',i)}c.addRule(".spin-vml","behavior:url(#default#VML)"),r.prototype.lines=function(e,s){function o(){return n(i("group",{coordsize:h+" "+h,coordorigin:-l+" "+-l}),{width:h,height:h})}function a(e,a,r){t(c,t(n(o(),{rotation:360/s.lines*e+"deg",left:~~a}),t(n(i("roundrect",{arcsize:s.corners}),{width:l,height:s.width,left:s.radius,top:-s.width>>1,filter:r}),i("fill",{color:s.color,opacity:s.opacity}),i("stroke",{opacity:0}))))}var r,l=s.length+s.width,h=2*l,u=2*-(s.width+s.length)+"px",c=n(o(),{position:"absolute",top:u,left:u});if(s.shadow)for(r=1;r<=s.lines;r++)a(r,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(r=1;r<=s.lines;r++)a(r);return t(e,c)},r.prototype.opacity=function(e,t,i,s){var n=e.firstChild;s=s.shadow&&s.lines||0,n&&t+s<n.childNodes.length&&(n=n.childNodes[t+s],n=n&&n.firstChild,(n=n&&n.firstChild)&&(n.opacity=i))}}():l=s(p,"animation"),r});var UITabs=new Class({Version:"1.0.0.0",File:"ui.tabs.js",Implements:[Options],Binds:["init","processNew"],options:{},initialize:function(e){this.setOptions(e),this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-tab-container"),function(e){if(!e.hasClass("ui-done")){e.addClass("ui-done");var t=e.getElements(".ui-tab");t.addClass("hidden"),Array.each(e.getElements(".ui-tab-title"),function(e,i){e.store("tab",t[i]),e.addEvents({click:function(e){var t=e.target.hasClass("ui-tab-title")?e.target:e.target.getParent(".ui-tab-title");t.getParent(".ui-tab-container").getElements(".ui-tab-title").removeClass("selected"),t.getParent(".ui-tab-container").getElements(".ui-tab").addClass("hidden"),t.retrieve("tab").removeClass("hidden"),t.addClass("selected")}})}.bind(this)),e.getElement(".ui-tab-title").addClass("selected"),e.getElement(".ui-tab").removeClass("hidden")}}.bind(this))}}),UITaxNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-taxnumber"),this.process)},process:function(e){e.removeClass("ui-taxnumber"),new UITaxNumberWidget({element:e})}}),UITaxNumberWidget=new Class({Implements:[Options,Events],Binds:["taxFieldChange","currentLocation","taxFields","buildNZTax","buildAUTax","taxValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy"],options:{
element:null,hasPayPoint:!0},element:null,type:"taxnumber",initialize:function(e){if(this.setOptions(e),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{class:"countryselector"}).inject(this.originalElement,"before"),this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown="True"===t?new Element("select",{class:"selector validate","data-validate-method":"taxNumberCountry"}).inject(this.dropdownDiv):new Element("select",{class:"selector"}).inject(this.dropdownDiv),this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown),this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdownoption1,"after"),this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after"),this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(e){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden"),this.disabled?(this.countrySelectEl=new Element("input",{type:"text",class:"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.taxFieldChange,window.addEvent("taxValidationReturned",this.processValidation)),this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country"),this.taxFields(this.currentLocation())},taxFieldChange:function(){null!=this.element&&this.element.destroy();var e,t,i,s,n,o,a,r,l,h,u;this.dropdown.getParent("form")&&(e=this.dropdown.getParent("form"),t=[],Array.each(e.getElements("input, select, textarea"),function(e){e.get("name")&&e.get("name").contains("TaxCode")&&t.push(e)}.bind(this)),t.length>0&&Array.each(t,function(e){i=e.get("data-display-id"),s=e.retrieve("original-lookup-url"),u=e.options[e.selectedIndex],r=Affinity.lookups.cancelQueue(),l=Affinity.lookups.removeFromQueue(s,e,!0),a=this.dropdown.value,-1===u.text.indexOf("- "+a)&&(u=null),n=new URI(s),o=n.parsed.query.parseQueryString(),o.payPointCountry=a,n.parsed.query=Object.toQueryString(o),s=n.toString(),Affinity.lookups.addDefaultOption(e,u),Affinity.lookups.addFilterOption(e,"- "+a),h=Affinity.lookups.addToQueue(s,e),Affinity.lookups.refreshQueue(),Affinity.lookups.processQueue()}.bind(this))),this.taxFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?"select"===this.countrySelectEl.get("tag")?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},taxFields:function(e){"NZ"===e?(this.buildNZTax(),this.originalElement.removeClass("hidden")):"AU"===e?(this.buildAUTax(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("taxValidationError",{target:this.originalElement,silent:!0}))},buildNZTax:function(){this.element=new Element("div",{class:"taxnumberbox ui-validate nz","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.taxNumberPart1=new Element("input",{class:"tax1",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart2=new Element("input",{class:"tax2",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart3=new Element("input",{class:"tax3",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement),this.element.inject(this.hiddenWrapper,"before")),this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},buildAUTax:function(){this.originalElement.get("disabled");this.element=new Element("div",{class:"taxnumberbox ui-validate au","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.taxNumberPart1=new Element("input",{class:"tax1",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart2=new Element("input",{class:"tax2",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart3=new Element("input",{class:"tax3",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement),this.element.inject(this.hiddenWrapper,"before")),this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden(),this.taxValidation()},setFromInitialValue:function(){var e=this.hiddenWrapper.getElement("input").value;this.taxNumberPart3.value=e.substr(e.length-3),this.taxNumberPart2.value=e.substr(e.length-6,3),this.taxNumberPart1.value=e.replace(e.substr(e.length-6),""),this.taxValidation()},copyToHidden:function(){var e=""!=this.taxNumberPart1.value?this.taxNumberPart1.value:"",t=""!=this.taxNumberPart2.value?this.taxNumberPart2.value:"",i=""!=this.taxNumberPart3.value?this.taxNumberPart3.value:"",s=e+t+i;this.hiddenWrapper.getElement("input").value=s,this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},taxValidationDelay:!1,taxValidation:function(){clearTimeout(this.taxValidationDelay),this.taxValidationDelay=function(){var e=this.hiddenWrapper.getElement("input"),t=e.getParent("form");if(null!=t&&t.retrieve("validation")){t.retrieve("validation").validateTaxNumber(e,this.currentLocation(),e.get("name"))}}.delay(500,this)},processValidation:function(e){var t=e.el,i=e.data;t===this.originalElement&&(i.success?this.success():t.value?this.failed():(window.fireEvent("taxValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Tick),t.removeClass("red").addClass("green")},failed:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Cross),t.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()}}),UITextareaAutoSize=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-textarea-autosize"),this.process)},process:function(e){e.removeClass("ui-textarea-autosize"),new UITextareaAutoSizeWidget({element:e})}}),UITextareaAutoSizeWidget=new Class({Implements:[Options,Events],Binds:["checkContent","hasContent","resize","revert","destroy"],options:{element:null},element:null,initialContent:!1,initialContentInterval:!1,initialize:function(e){if(this.setOptions(e),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";""===this.originalElement.value?this.initialContentInterval=this.checkContent.periodical(100,this):this.hasContent()},checkContent:function(){""!==this.originalElement.value&&(clearInterval(this.initialContentInterval),this.hasContent())},hasContent:function(){clearInterval(this.initialContentInterval),this.initialHeight=this.originalElement.getSize().y,this.originalElement.addEvent("keyup",this.resize),this.resize()},resize:function(){var e=this.originalElement.getSize().y,t=this.originalElement.getScrollSize().y;t>e&&t>this.initialHeight&&this.originalElement.setStyle("height",t)},revert:function(){clearInterval(this.initialContentInterval),this.originalElement.removeEvent("keyup",this.resize),Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this))},destroy:function(){this.revert()}}),UITimePickerWidget=new Class({Version:"1.0.0.0",File:"ui.time.picker.js",Implements:[Options,Events],options:{target:null,displayInput:!1,timeonly:!0,date:null,dateWidget:null,width:150,hoursmins:!1},Binds:["swapHours","swapMinutes","setAMPM","setAM","setPM","done","tileOver","tileOut","setMinute","swapHours","setHour","swapMinutes","setLastValue","attemptParse"],row:null,initialize:function(e){this.setOptions(e),this.options.width<150&&(this.options.width=150),this.icons={},this.icons.done=Affinity.icons.Tick,this.target=this.options.target,this.timeTarget=new Element("div",{class:"ui-calendar-time"}).setStyles({width:this.options.width}).inject(this.target),this.displayTarget=new Element("div",{class:"ui-calendar-time-display",html:"<span></span>:<span></span> <span></span>"}).inject(this.timeTarget),this.displayTarget.set("reveal",{duration:250}),this.containerBox=new Element("div",{class:"ui-calendar-time-container"}).setStyles({width:this.options.width}).inject(this.timeTarget),this.containerBox.set("reveal",{duration:250}),this.hoursTarget=new Element("div",{class:"ui-calendar-time-circle hours"}).inject(this.containerBox),this.minutesTarget=new Element("div",{class:"ui-calendar-time-circle minutes"}).inject(this.containerBox),this.hoursTarget.set("reveal",{duration:250}),this.minutesTarget.set("reveal",{duration:250}),this.minutesTarget.toggle();var t=this.displayTarget.getElements("span");this.hourDisplay=t[0],this.minDisplay=t[1],this.ampmDisplay=t[2],delete t,this.doneButton=new Element("div",{class:"button green w-icon done",html:"<span>"+this.icons.done+"</span> Done"}).inject(this.containerBox),this.amButton=new Element("div",{class:"am",html:"am"}).inject(this.containerBox),this.pmButton=new Element("div",{class:"pm",html:"pm"}).inject(this.containerBox),this.hourDisplay.addEvent(Affinity.events.click,this.swapHours),this.minDisplay.addEvent(Affinity.events.click,this.swapMinutes),this.options.hoursmins?(this.amButton.addClass("hidden"),this.pmButton.addClass("hidden"),this.ampmDisplay.addClass("hidden")):(this.ampmDisplay.addEvent(Affinity.events.click,this.setAMPM),this.amButton.addEvent(Affinity.events.click,this.setAM),this.pmButton.addEvent(Affinity.events.click,this.setPM)),this.doneButton.addEvent(Affinity.events.click,this.done),this.size={x:170,y:170},this.width=this.size.x-50,this.height=this.width,this.radius=this.width/2,this.center=new Element("div",{class:"circle-center"}).setStyles({top:this.size.x/2-15,left:this.options.width>150?this.size.x/2-15+(this.options.width-150)/2:this.size.x/2-15}).inject(this.containerBox,"top"),this.marker=new Element("div",{class:"circle-hover-marker"}).inject(this.containerBox,"top"),this.marker.set("tween",{duration:250}),this.marker.fade("hide"),this.canvasOK=!0,this.canvas=new Element("canvas",{width:150,height:150}).setStyles({position:"absolute",top:0,left:this.options.width>150?(this.options.width-150)/2:0,width:150,height:150}).inject(this.containerBox,"top");try{this.canvasContext=this.canvas.getContext("2d")}catch(e){this.canvasOK=!1}this.canvasOK?(this.canvasContext.lineWidth=2,this.canvasContext.strokeStyle=this.center.getStyle("background-color")):this.canvas.destroy();var i=new Element("div",{class:"ui-calendar-time-circle-bg"}).inject(this.containerBox,"top");this.options.width>150&&i.setStyle("left",(this.options.width-150)/2),this.fireSet=!0,null===this.options.date||!1===this.options.date?(this.fireSet=!1,this.date=new Date,this.date.setSeconds(0),this.date.setMilliseconds(0)):this.date=this.options.date.clone(),this.hour=this.date.getHours(),this.minunte=this.date.getMinutes(),this.ampm=this.hour>=12?"pm":"am",this.hoursTargetStatus="closed",this.minutesTargetStatus="closed",this.buildTimeElements(),this.hide(),this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.addEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.addEvent("focus",this.setLastValue),this.options.displayInput.addEvent("blur",this.attemptParse))},buildTimeElements:function(){var e,t,s=0,n=this.hoursTarget;for(t=3,i=0;i<12;i++)new Element("div",{html:t,class:"time-circle-tile h-"+t}).inject(n),t++,t>=13&&(t=1),this.options.hoursmins&&12===t&&(t=0);for(e=this.hoursTarget.getElements("div"),s=0,step=2*Math.PI/e.length,Array.each(e,function(e){var t=(e.getSize(),Math.round(this.width/2+this.radius*Math.cos(s)-10)+15),i=Math.round(this.height/2+this.radius*Math.sin(s)-10)+15;e.setStyles({left:t+"px",top:i+"px"}),s+=step,e.addEvent(Affinity.events.overAll,this.tileOver),e.addEvent(Affinity.events.outAll,this.tileOut),e.addEvent(Affinity.events.click,this.setHour),e.addEvent(Affinity.events.click,this.swapMinutes)}.bind(this)),n=this.minutesTarget,t=15,i=0;i<60;i++)new Element("div",{html:t,class:"time-circle-tile m-"+t}).inject(n),i+=4,(t+=5)>=60&&(t=0);e=this.minutesTarget.getElements("div"),s=0,step=2*Math.PI/e.length,Array.each(e,function(e){var t=Math.round(this.width/2+this.radius*Math.cos(s)-10)+15,i=Math.round(this.height/2+this.radius*Math.sin(s)-10)+15;e.setStyles({left:t+"px",top:i+"px"}),s+=step,e.addEvent(Affinity.events.overAll,this.tileOver),e.addEvent(Affinity.events.outAll,this.tileOut),e.addEvent(Affinity.events.click,this.setMinute),e.addEvent(Affinity.events.click,this.swapHours)}.bind(this))},setDisplayTime:function(){this.options.hoursmins?(this.hourDisplay.set("html",this.date.format("%H")),this.minDisplay.set("html",this.date.format("%M"))):(this.hourDisplay.set("html",this.date.format("%l")),this.minDisplay.set("html",this.date.format("%M")),this.ampmDisplay.set("html",this.date.format("%p").toLowerCase())),this.fireSet&&this.fireEvent("timeSet",this.date),this.fireSet=!0,this.options.timeonly&&this.displayTarget},setHour:function(e){this.hour=parseInt(e.target.get("html")),this.date.setHours(this.hour),this.setDisplayTime(),this.hoursTarget.getElements(".active").removeClass("active"),e.target.addClass("active")},setMinute:function(e){this.minunte=parseInt(e.target.get("html")),this.date.setMinutes(this.minunte),this.setDisplayTime(),this.minutesTarget.getElements(".active").removeClass("active"),e.target.addClass("active")},setAMPM:function(){this.containerBox.reveal(),this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),"am"==this.ampm?this.setPM():this.setAM()},setAM:function(e){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="am",this.date.getHours()>=12&&this.date.setHours(this.date.getHours()-12),this.setDisplayTime()},setPM:function(e){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="pm",this.date.getHours()<12&&this.date.setHours(this.date.getHours()+12),this.setDisplayTime()},swapMinutes:function(e){this.show(),this.hourDisplay.removeClass("active"),this.minDisplay.addClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="closed",this.minutesTargetStatus="open",this.hoursTarget.dissolve(),this.minutesTarget.reveal(),this.marker.fade("out"),function(){this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))}.delay(300,this)},swapHours:function(e){this.show(),this.hourDisplay.addClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="open",this.minutesTargetStatus="closed",this.hoursTarget.reveal(),this.minutesTarget.dissolve(),this.marker.fade("out"),function(){this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active"))}.delay(300,this)},positionMarker:function(e){var t=e.getPosition(this.containerBox);this.marker.setPosition({x:t.x-4,y:t.y-4}),this.marker.fade("in"),delete t},tileOver:function(e){if(this.canvasOK){var t=this.center.getPosition(this.canvas),i=e.target.getPosition(this.canvas);this.canvasContext.clearRect(0,0,150,150),this.canvasContext.beginPath(),this.canvasContext.moveTo(t.x+5,t.y+5),this.canvasContext.lineTo(i.x+10,i.y+10),this.canvasContext.stroke(),delete t,delete i}},tileOut:function(e){this.canvasOK&&this.canvasContext.clearRect(0,0,150,150),this.marker.fade("out"),"open"==this.hoursTargetStatus&&this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active")),"open"==this.minutesTargetStatus&&this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))},show:function(){clearTimeout(this.autoHideDelay),this.options.hoursmins||(this.containerBox.reveal(),this.showDisplay(),this.fireEvent("open",this.date))},hide:function(){if(this.hourDisplay&&this.hourDisplay.removeClass("active"),this.minDisplay&&this.minDisplay.removeClass("active"),this.ampmDisplay&&this.ampmDisplay.removeClass("active"),this.options.timeonly){if(this.options.dateWidget)try{this.options.dateWidget.hide()}catch(e){}}else this.containerBox.dissolve()},showDisplay:function(){this.displayTarget.reveal()},hideDisplay:function(){this.displayTarget.dissolve()},done:function(){this.hide(),this.fireEvent("timeSet",this.date),this.fireEvent("done",this.date)},setTime:function(e){this.date=e.clone(),this.setDisplayTime()},getTime:function(){return this.date},lastValue:!1,setLastValue:function(){this.options.displayInput&&"input"===this.options.displayInput.get("tag")&&(this.lastValue=this.options.displayInput.value)},autoHideDelay:null,attemptParse:function(e){if(clearTimeout(this.autoHideDelay),this.options.displayInput&&"input"===this.options.displayInput.get("tag")){var t,i,s,n=this.options.displayInput.value,o=!1,a=!1,r=!1;if(n=n.trim(),this.options.timeonly&&this.options.hoursmins){t=n.toLowerCase().replace(/m/," m ").replace(/h/," h ").split(/[^0-9mh]/i),t=t.filter(function(e){return"h"===e||"m"===e?e:!isNaN(parseFloat(e,10))}),t.contains("m")&&!isNaN(t[t.indexOf("m")-1])&&(r=parseFloat(t[t.indexOf("m")-1],10),t.splice(t.indexOf("m"),1)),t.contains("h")&&!isNaN(t[t.indexOf("h")-1])&&(a=parseFloat(t[t.indexOf("h")-1],10),t.splice(t.indexOf("h"),1)),r||a?(t=[],a?t.push(a):t.push(0),r?t.push(r):t.push(0)):(":"!==n.charAt(0)&&"."!==n.charAt(0)||t.unshift(0),1===t.length&&(t[1]="0")),a=parseInt(t[0],10),r=parseInt(t[1],10),parseInt(a,10)>11&&(a="11"),n.contains(".")&&(r=Math.round(60*parseFloat("0."+r))),parseInt(r,10)>59&&(a="59"),n=(a+"").pad(2,"0","left")+":"+(r+"").pad(2,"0","left");try{o=Date.parse(n)}catch(e){o=!1}o&&"date"===typeOf(o)&&o.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=n),this.setTime(o))}else if(this.options.timeonly&&(n=n.replace(new RegExp(/[^0-9.\:]/gi),"")),""!==n){if(n.contains(":")?(t=n.split(":"),i=t[0],parseInt(i,10)>24&&(i="24"),parseInt(i,10)<0&&(i="00"),i=i.pad(2,"0","left"),s=t[1].pad(2,"0","right"),parseInt(s,10)>60&&(i="00"),parseInt(i,10)<0&&(i="00"),n=i+":"+s):n.contains(".")?(t=n.split("."),i=t[0],parseInt(i,10)>24&&(i="24"),parseInt(i,10)<0&&(i="00"),i=i.pad(2,"0","left"),s=t[1].pad(2,"0","right"),r=parseInt(s,10),r>99&&(r=0),r<0&&(r=0),s=(Math.round(.6*r)+"").pad(2,"0","left"),n=i+":"+s):4===n.length?n=n.substring(0,2)+":"+n.substring(2):n.length>4?n=n.substring(0,2)+":"+n.substring(2,2):n.length<4&&(1===n.length&&(n="0"+n+"00"),2===n.length&&(n+="00"),3===n.length&&(n="0"+n),n=n.substring(0,2)+":"+n.substring(2)),this.options.timeonly){var l=parseInt(n.split(":")[0],10),h=parseInt(n.split(":")[1],10);l=l>24?0:l,h=h>59?0:h,n=(l+"").pad(2,"0","left")+":"+(h+"").pad(2,"0","left")}try{o=Date.parse(n)}catch(e){o=!1}o&&"date"===typeOf(o)&&o.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=n),this.setTime(o))}else this.lastValue&&(this.options.displayInput.value=this.lastValue)}e&&("object"===typeOf(e)||"domevent"===typeOf(e))&&"type"in e&&"blur"===e.type&&(this.autoHideDelay=this.hide.delay(250,this))},destroy:function(){this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.removeEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.removeEvent("focus",this.setLastValue),this.options.displayInput.removeEvent("blur",this.attemptParse)),this.hourDisplay.removeEvents(),this.minDisplay.removeEvents(),this.ampmDisplay.removeEvents(),this.amButton.removeEvents(),this.pmButton.removeEvents(),this.doneButton.removeEvents(),this.displayTarget.set("reveal",null),this.displayTarget.set("tween",null),this.containerBox.set("reveal",null),this.containerBox.set("tween",null),this.hoursTarget.set("reveal",null),this.hoursTarget.set("tween",null),this.minutesTarget.set("reveal",null),this.minutesTarget.set("tween",null),this.hourDisplay.destroy(),this.minDisplay.destroy(),this.ampmDisplay.destroy(),this.amButton.destroy(),this.pmButton.destroy(),this.doneButton.destroy(),this.canvasOK&&(this.canvas.destroy(),this.canvasContext=null),Array.each(this.hoursTarget.getElements("div"),function(e){e.removeEvents()}.bind(this)),this.hoursTarget.empty(),this.hoursTarget.destroy(),Array.each(this.minutesTarget.getElements("div"),function(e){e.removeEvents()}.bind(this)),this.minutesTarget.empty(),this.minutesTarget.destroy(),this.displayTarget.empty(),this.displayTarget.destroy(),Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this))}}),UITooltips=new Class({Version:"1.0.2.0",File:"ui.tooltip.js",Implements:[Options],Binds:["processNew","init","processTooltip","removeTooltip","itemOver","itemOut"],options:{},initialize:function(e){this.setOptions(e),Affinity.UI.Tooltips={},Affinity.UI.Tooltips.Process=this.processNew,Affinity.UI.Tooltips.Remove=this.removeTooltip,Affinity.UI.Tooltips.Hide=this.hideAll,this.init()},processNew:function(){this.init()},init:function(){if(!Affinity.helpbubble)throw"UI Tooltips requires UI Help Bubble";Array.each(document.getElements(".ui-has-tooltip"),this.processTooltip.bind(this))},processTooltip:function(e,t,i){e.get("data-tooltip")&&(e.hasEvent(Affinity.events.overAll,this.itemOver)||(e.addEvent(Affinity.events.overAll,this.itemOver),e.addEvent(Affinity.events.outAll,this.itemOut),"input"===e.get("tag")&&e.addEvent("blur",this.itemOut)),"boolean"===typeOf(t)&&t&&this.itemOver({target:e}))},removeTooltip:function(e){e.removeClass("ui-has-tooltip"),e.erase("data-tooltip"),e.erase("data-tooltip-dir"),e.removeEvent(Affinity.events.overAll,this.itemOver),e.removeEvent(Affinity.events.outAll,this.itemOut),"input"===e.get("tag")&&e.removeEvent("blur",this.itemOut)},itemOver:function(e){var t=e.target.hasClass("ui-has-tooltip")?e.target:e.target.getParent("ui-has-tooltip");if(t){Affinity.helpbubble.populate(t.get("data-tooltip"));var i=Affinity.helpbubble.getSize();if("object"===typeOf(i)&&"y"in i){var s,n=t.get("data-tooltip-dir")?t.get("data-tooltip-dir").toLowerCase().trim():"right",o=document.getScrollSize(),a=t.getPosition(),r=t.getSize(),l=(document.getScroll(),{x:0,y:0});switch(n){case"top":s="bottom",l.x=a.x,l.y=a.y-i.y-10;break;case"bottom":s="top",l.x=a.x,l.y=a.y+i.y-5;break;case"right":s="left",l.x=a.x+r.x+5,l.y=a.y+r.y/2-20;break;case"left":s="right",l.x=a.x-i.x-5,l.y=a.y+r.y/2-20;break;case"top,left":s="bottom-right",l.x=a.x+r.x-i.x,l.y=a.y-i.y-10;break;case"top,right":s="bottom",l.x=a.x,l.y=a.y-i.y-10;break;case"bottom,left":s="top-right",l.x=a.x+r.x-i.x,l.y=a.y+i.y;break;case"bottom,right":s="top",l.x=a.x,l.y=a.y+i.y;break;case"top,center":s="bottom",l.x=a.x,l.y=a.y-i.y-10;break;case"bottom,center":s="top",l.x=a.x,l.y=a.y+i.y-5}Affinity.helpbubble.setDirection(s),l.x+i.x>o.x&&(l.x=o.x-i.x-5),l.y+i.y>o.y&&(l.y=o.y-i.y-5),Affinity.helpbubble.position(l),Affinity.helpbubble.show(!!t.hasClass("ui-tooltip-selectable"))}}},itemOut:function(){Affinity.helpbubble.hide()},hideAll:function(){Affinity.helpbubble.hide()}}),UIUplaoders=new Class({Implements:[Options],Binds:["processUploaders","setFakeLabel"],options:{},uploaders:{},initialize:function(e){this.setOptions(e),this.processUploaders()},processNew:function(){processUploaders()},processUploaders:function(){if(this.ignoreUpload=!1,document.config.prettyuploads){var e=document.getElements(".upload");Array.each(e,function(e){if(!e.hasClass("uidone")){e.addClass("uidone");var t=e.getElement("input");t.fade("hide");var i=new Element("label").inject(e);i.adopt(t);new Element("span",{class:"button blue",html:"Choose File"}).inject(i),new Element("span",{html:"",class:"uploadlabel hidden"}).inject(i),new Element("i",{html:" ",class:""}).inject(i,"after");if(e.get("data-show-delete")&&"true"==e.get("data-show-delete")){new Element("span",{class:"button red",html:"Delete"}).inject(e).addEvent(Affinity.events.click,this.deleteFile)}var s=new Element("div",{html:"",class:"currentFileLabel"}).inject(e);e.getElement("input").addEvent("change",this.setFakeLabel),e.getElement("input").get("data-default-file-name")&&(e.getElement("input").get("data-default-file-path")?(s.set("html","Current File: "),new Element("a",{href:e.getElement("input").get("data-default-file-path"),html:e.getElement("input").get("data-default-file-name")}).inject(s)):s.set("html","Current File: "+e.getElement("input").get("data-default-file-name")))}}.bind(this)),delete button}},deleteFile:function(e){document.getElements(".uploadlabel").set("html",""),document.getElements(".currentFileLabel").set("html",""),document.getElementById("hiddenDeleteAttachment").set("value","true"),document.getElementById("files").set("value","")},setFakeLabel:function(e){var t=e.target.value;t.contains("fakepath")&&(t=t.substring(e.target.value.indexOf("fakepath")+9)),e.target.getParent().getLast("span").set("html",t)}}),UIUplaodersMulti=new Class({Version:"1.0.0.0",File:"ui.upload.multi.js",Implements:[Options,Events],Binds:["processNew","processUploader","addFile","addFileCont","addFileRow","deleteFile"],options:{auto:!0,maxsize:20971520,samenames:!0},uploaders:{},initialize:function(e){this.setOptions(e),this.icons={},this.icons.del=Affinity.icons.CrossRound||"&#xe06d;",Affinity.prettyuploads&&this.options.auto&&Array.each(document.getElements(".uploadmulti"),this.processUploader)},processNew:function(){Array.each(document.getElements(".uploadmulti"),this.processUploader)},processUploader:function(e){if(Affinity.prettyuploads&&!e.hasClass("uidone")){e.store("count",1);var t=new HtmlTable({properties:{class:"ui-grid"},headers:["File",""],rows:[]});new Element("div",{class:"upload-table hidden"}).adopt(t.element).inject(e),e.addClass("uidone");var i=(e.hasClass("isrequired"),new Element("label").inject(e)),s=e.get("data-question-name")+"_file0";e.getElement("input").set("name",s).set("id",s).addEvent("change",this.addFile).inject(i).fade("hide");var n=new Element("span",{class:"button blue"}).adopt(new Element("span",{class:"icon-add-to-list"}),new Element("span",{html:"Add&nbsp;File"})).inject(i);new Element("span",{html:"",class:"uploadlabel"}).inject(i);var o=e.getElement(".initialValues");if(o){var a=o.value.trim();if(""!==a){var r=a.split(",");Array.each(r,function(e){this.addFileRow(t.element,e,e)}.bind(this)),window.fireEvent("multiFileDefaults",{initialValues:a,table:t.element})}}delete t,delete i,delete s,delete n,delete a,Affinity.uiGrid.processTables(t.element)}},addFile:function(e){e.stop();var t={};if(t.uploadInput=e.target,t.uploader=t.uploadInput.getParent(".uploadmulti"),t.table=t.uploader.getElement("table"),t.questionName=t.uploader.get("data-question-name"),t.filePath=t.uploadInput.value,t.fileName=t.filePath,t.count=t.uploader.retrieve("count")+1,t.inputId=t.questionName+"_file"+t.count,t.fileEventData={fileElement:t.uploadInput,questionName:t.questionName,table:t.table},""===t.filePath||"null"==typeOf(t.filePath))return void delete t;if(t.uploadInput.files&&t.uploadInput.files[0].size>this.options.maxsize){window.fireEvent("multiFileTooLarge",{fileElement:t.uploadInput,maxsize:this.options.maxsize,size:t.uploadInput.files[0].size,table:t.table}),t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}return void delete t}t.fileName.contains("fakepath")&&(t.fileName=t.fileName.substring(t.uploadInput.value.indexOf("fakepath")+9)),t.fileName.contains("/")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("/")+1)),t.fileName.contains("\\")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("\\")+1));var i=!1;if(Array.each(t.table.getElements("tr"),function(e){e.retrieve("fileName")&&e.retrieve("fileName").trim()===t.fileName.trim()&&(i=!0)}),i){if(!this.options.samenames){uialert({message:"Filenames must be different.<br />You already have a file with name '"+t.fileName+"'."}),t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}return void delete t}uiconfirm({message:"You already have a file named '"+t.fileName+"'.<br />Would you like to continue anyway?",onOk:function(){this.addFileCont(e,t)}.bind(this),onCancel:function(){t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}delete t}.bind(this)})}else this.addFileCont(e,t)},addFileCont:function(e,t){e.stop(),this.addFileRow(t.table,t.fileName,null,t.inputId);var i=t.table.getParent(".uploadmulti");t.uploadInput.set("class","").addClass("subhidden").set("name",t.inputId).set("id",t.inputId).removeEvents(),function(){t.uploadInput=t.uploadInput.clone().set("name",t.questionName+"_file0").set("id",t.questionName+"_file0").set("class","").addClass("new-master").inject(t.uploadInput,"before").fade("hide"),t.uploadInput.removeEvents(),t.uploadInput.addEvent("change",this.addFile),t.uploadInput.value="",t.uploader.store("count",t.count),window.fireEvent("multiFileAdded",t.fileEventData),i.fireEvent("multiFileAdded",t.fileEventData)}.delay(50,this),delete t},addFileRow:function(e,t,i,s,n){var o,a;o=null!==i?'<span class="button orange delete w-icon-only"><span>'+this.icons.del+"</span></span>":'<span class="button orange delete new w-icon-only"><span>'+this.icons.del+"</span></span>",e.retrieve("HtmlTable").push([t,o]),a=e.getElements("tbody tr").getLast(),a.store("fileName",t),null!==i&&(a.store("fileId",i),a.addEvent("click",this.downloadFile.bind(this)),a.addClass("saved")),n&&(a.removeEvents(),a.getElement("td").empty(),new Element("a",{href:n,target:"_blank",html:t}).inject(a.getElement("td"))),null!==s&&a.store("inputId",s),a.getElements(".delete").addEvent("click",this.deleteFile),Affinity.uiGrid.zebra(e),e.getParent().removeClass("hidden"),delete o,delete a},
deleteFile:function(e){e.stop();var t=!1,i=e.target.hasClass("button")?e.target:e.target.getParent(".button"),s=e.target.getParent(".uploadmulti"),n=e.target.getParent("tr"),o=n.getParent("table"),a=s.get("data-question-name"),r=!1;if(n.retrieve("fileId")&&(r=n.retrieve("fileId")),i.hasClass("new")){var l=n.retrieve("inputId");s.getElement("#"+l)&&s.getElement("#"+l).destroy()}else if(window.fireEvent("validateMultiFileDelete",{row:n,table:o,deletionTarget:{deleteName:h,deletedId:r,questionName:a,table:o}}),s.fireEvent("validateMultiFileDelete",{row:n,table:o,deletionTarget:{deleteName:h,deletedId:r,questionName:a,table:o}}),!(t=n.hasClass("preventDeletion"))){n.retrieve("fileId")&&(r=n.retrieve("fileId"));var h=n.getElement("td").get("html");window.fireEvent("multiFileDeleted",{deleteName:h,deletedId:r,questionName:a,table:o}),s.fireEvent("multiFileDeleted",{deleteName:h,deletedId:r,questionName:a,table:o}),delete r,delete h}t?n.removeClass("preventDeletion"):(n.destroy(),Affinity.uiGrid.zebra(o),0==o.getElements("tbody tr").length&&o.getParent().addClass("hidden"),delete i,delete s,delete n,delete o,delete a)},downloadFile:function(e){e.stop();var t="td"==e.target.get("tag")?e.target:e.target.getParent("td"),i=t.getParent("tr").retrieve("fileId"),s=t.getParent("tr").retrieve("dowloadUrl");i&&s&&window.open(s+"?documentId="+i,"_blank")},setMaxSize:function(e){this.options.maxsize=e},reset:function(e){var t=!1,i=!1;if("element"===typeOf(e)&&(e.hasClass("uploadmulti")&&(t=e),"element"!==typeOf(e)||!e.get("type")||"input"!==e.get("type")&&"file"!==e.get("type")||(t=e.getParent(".uploadmulti"))),t&&t.getElement("label input")&&(i=t.getElement("label input")),t){var s=t.getElement("table"),n=t.get("data-question-name");if(Array.each(t.getElements("label input"),function(e){e!==i&&e.destroy()}),t.store("count",1),i&&(i.set("name",n+"_file0").set("id",n+"_file0").set("class",null).set("type","file").removeEvents().addEvent("change",this.addFile.bind(this)).fade("hide"),i.value="","files"in i))try{i.files=[]}catch(e){}s.getElement("tbody").empty(),s.getParent().addClass("hidden")}}}),UIValidation=new Class({Version:"1.0.2.0",File:"ui.validation.js",Notes:"API Structure change",initialize:function(e){if("object"===typeOf(e)&&("element"==typeOf(e.target)||"form"==typeOf(e.target)))return new UIFormValidation(e);this.processNew()},processNew:function(){Array.each(document.getElements("form.validate-form"),function(e){e.retrieve("validation")||new UIFormValidation({target:e})}.bind(this))}}),UIFormValidation=new Class({Implements:[Options],Binds:["disable","enable","ignoreRequired","doRequired","submitButtonMouseDown","validateForm","validate","processForm","validateForm","processErrors","validateElement","processError","validateHasvalue","validateSentence","validateString","validateNumber","validateInt","validateFloat","validateCurrency","validateEmail","validateChecked","validateMultiChecked","validateRadioSelected","validateLength","validateRange","validateDate","validateLinked","validateNomatch","validateUrl","validateFile","checkNum","validateBankNumber","validateTaxCode","validateTaxNumber","validateTaxNumberCountry","validateBankNumberCountry"],options:{target:null,onPost:null,onValidateCallback:null,onValidateFailCallback:null},approvedElements:["input","textarea","select"],approvedValidations:["file","banknumber","bankNumber","taxcode","taxnumber","taxNumber"],initialize:function(e){this.setOptions(e),this.options.target.retrieve("validation")&&this.options.target.retrieve("validation").destroy(),this.options.target.store("validation",this),this.options.target.addEvent("submit",this.validateForm),Array.each(this.options.target.getElements('*[type="submit"]'),function(e){e.addEvent(Affinity.events.start,this.submitButtonMouseDown)}.bind(this)),this.taxValidationRequests={},this.banknumValidationRequests={}},ignoreHasValue:!1,disaabled:!1,disable:function(){this.disaabled=!0},enable:function(){this.disaabled=!1},ignoreRequired:function(){this.ignoreHasValue=!0},doRequired:function(){this.ignoreHasValue=!1},destroy:function(){this.options.target.removeEvent("submit",this.validateForm),this.options.target.eliminate("validation"),this.options=null},submitButtonMouseDown:function(e){var t=e.target.hasClass(".button")?e.target:"button"===e.target.get("tag")?e.target:e.target.getParent(".button")?e.target.getParent(".button"):!!e.target.getParent("button")&&e.target.getParent("button");this.ignoreHasValue=!1,t&&t.hasClass("ignore-required")&&(this.ignoreHasValue=!0)},validateForm:function(e){this.disaabled||(e.preventDefault(),e.stopPropagation(),e.stop(),this.validate())},validate:function(){if(null===this.options.target)throw"Can not validate on no form";document.getElements(".error").removeClass("error"),document.getElements(".errorstr").destroy(),this.options.onPost&&"function"===typeOf(this.options.onPost)&&this.options.onPost(),this.errors=[],Array.each(this.options.target.getElements(".validate"),this.validateElement),document.getElements(".validated").removeClass("validated"),this.errors.length>0?this.processErrors():this.options.onValidateCallback&&"function"==typeOf(this.options.onValidateCallback)?this.options.onValidateCallback():this.options.target.submit()},processErrors:function(){var e;Array.each(this.errors,function(t,i){e=t[0],this.approvedElements.contains(e.get("tag"))&&e.addClass("error"),t[0].getPrevious("label")&&(e=t[0].getPrevious("label")),t[0].getParent().hasClass("currencybox")&&(e=t[0].getParent().getPrevious("label")),t[0].getParent().hasClass("countryselector")&&(e=t[0].getParent().getPrevious("label")),t[0].getParent().hasClass("subhidden")&&(e=t[0].getParent().getPrevious("label")),new Element("div",{class:"errorstr",html:t[1]}).inject(e,"before"),t[0].getParent(".form-row")&&t[0].getParent(".form-row").removeClass("valid").addClass("invalid")}.bind(this)),this.options.onValidateFailCallback&&"function"==typeOf(this.options.onValidateFailCallback)&&this.options.onValidateFailCallback(this.errors),delete e},processError:function(e,t){t.getAttribute("data-validate-error-str")&&(e=e+"<br />"+t.getAttribute("data-validate-error-str")),t.get("data-display-id")&&(t=document.id(t.get("data-display-id"))),this.errors.contains([t,e])||this.errors.push([t,e])},validateElement:function(e,t){if(e.getAttribute("data-validate-method")&&(this.approvedElements.contains(e.get("tag"))||this.approvedValidations.contains(e.get("data-validate-method")))){var i,s,n=e.getAttribute("data-validate-method").split(",");Array.each(n,function(t,n){i="validate"+t.capitalize(),(s="function"==typeOf(this[i]))&&(e.getParent(".form-row")&&e.getParent(".form-row").removeClass("invalid").addClass("valid"),"validateTaxNumber"===i||"validateBankNumber"===i||this[i](e))}.bind(this))}},validateHasvalue:function(e){if(!this.ignoreHasValue&&"element"==typeOf(e)){if(e.hasClass("hidden"))return;if("null"!==typeOf(e.value)){if(""!=e.value&&""!==e.value.trim())return;this.processError("This must have a value",e)}}},validateSentence:function(e){var t=/^[a-zA-Z0-9_\-.,:;'\"!?@#$%\*\/\\|()\s]*$/g,i=new RegExp(t);if(e.value.length>0&&!i.test(e.value)){var s=255;s=e.getAttribute("data-validate-length")?e.getAttribute("data-validate-length"):s,s=e.getAttribute("data-validate-max")?e.getAttribute("data-validate-max"):s,s=parseInt(s)||255,e.value.length>s?this.processError("The text is too large. The maximum length allowed is 255 characters.",e):this.processError("Some of the symbols used are invalid (ok symbols: . , _ - ; : ( ) ? $ * % @ # ! \\ ' \" )",e)}},validateString:function(e){var t=/^[A-Za-z0-9_\-.]+$/g,i=new RegExp(t);e.value.length>0&&(i.test(e.value)||this.processError("This may not have spaces and can only have numbers, letters and some symbols (ok symbols: _ - . )",e))},validateNumber:function(e){var t=/^[-+]?[0-9,.]+$/g,i=new RegExp(t);if(e.value.length>0){if(parseInt(e.value.replace(/[^0-9.]/g,""))>2147483647)return void this.processError("Number values can be no greater than 2147483647",e);i.test(e.value)||this.processError("This must only be numbers and may have commas and points",e)}},validateInt:function(e){var t=/^[-+]?[0-9]+$/g,i=new RegExp(t);if(e.value.length>0){if(parseInt(e.value)>2147483647)return void this.processError("Int values can be no greater than 2147483647",e);if(parseInt(e.value)<-2147483647)return void this.processError("Int values can be no smaller than -2147483647",e);i.test(e.value)||this.processError("This must be an integer value",e)}},validateFloat:function(e){var t=/^[-+]?[0-9]*\.?[0-9]+$/g,i=new RegExp(t);if(e.value.length>0){if(parseFloat(e.value)>2147483647)return void this.processError("Float values can be no greater than 2147483647",e);if(parseFloat(e.value)<-2147483647)return void this.processError("Float values can be no smaller than -2147483647",e);i.test(e.value)||this.processError("This must be a float value with maximum 5 decimal places",e)}},validateAlphanumeric:function(e){var t=/^[a-zA-Z0-9_\-.,:'!?$%\*\/\\|\s]+$/g,i=new RegExp(t);if(e.value.length>0){if(""===e.value.replace(/[^a-zA-Z]+/g,""))return void this.processError("This must have letters",e);i.test(e.value)||this.processError("This must have letters and can have numbers, spaces and some symbols . , _ - : ? $ * % ! \\ / ' |",e)}},validateCurrency:function(e){var t=/^\-?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1,5})?|(?:,[0-9]{3})*(?:\.[0-9]{1,5})?|(?:\.[0-9]{3})*(?:,[0-9]{1,5})?)$/g,i=new RegExp(t);if(e.value=e.value.replace(/\$|\s/gi,""),e.value.length>0){if(parseFloat(e.value.replace(/[^0-9.]/g,""))>2147483647)return void this.processError("Currency values can be no greater than 2147483647",e);if(parseFloat(e.value.replace(/[^0-9.-]/g,""))<-2147483647)return void this.processError("Currency values can be no smaller than -2147483647",e);i.test(e.value)||this.processError("This must be a valid currency value (without the currency symbol). Eg:<br />123,456,789.12<br />OR<br />123456789.12<br />Mind your commas and decimals!<br />Up to 5 decimal places is permitted.",e)}},validateEmail:function(e){var t=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i=new RegExp(t);e.value.length>0&&(i.test(e.value)||this.processError("This must be a valid email address",e))},validateChecked:function(e){this.ignoreHasValue||"checkbox"!=e.get("type")||e.checked||this.processError("This must be checked",e)},validateMultiChecked:function(e){this.ignoreHasValue||!e.hasClass("validated")&&"checkbox"==e.get("type")&&e.get("data-validation-multicheck-id")&&(e.checked||(checked=!1,Array.each(e.getParents("form")[0].getElements("input[type=checkbox]"),function(t){t.get("data-validation-multicheck-id")==e.get("data-validation-multicheck-id")&&t.checked&&(checked=!0),t.addClass("validated")}.bind(this)),0==checked&&this.processError("One of these must be checked",e)))},validateRadioSelected:function(e){this.ignoreHasValue||!e.hasClass("validated")&&"radio"==e.get("type")&&e.get("name")&&(e.checked||(checked=!1,Array.each(e.getParents("form")[0].getElements("input[name="+e.get("name")+"]"),function(e){e.checked&&(checked=!0),e.addClass("validated")}.bind(this)),0==checked&&this.processError("One of these must be selected",e)))},validateLength:function(e){if(e.value.length>0){var t=!!e.getAttribute("data-validate-length")&&e.getAttribute("data-validate-length"),i=!!e.getAttribute("data-validate-max")&&e.getAttribute("data-validate-max"),s=!!e.getAttribute("data-validate-min")&&e.getAttribute("data-validate-min");s&&e.value.length<parseInt(s)&&this.processError("This must be longer than "+s+"character(s)",e),i&&e.value.length>parseInt(i)&&this.processError("This must be shorter than "+i+" character(s)",e),t&&e.value.length<parseInt(t)&&this.processError("This must be at least "+t+" character(s)",e)}},validateRange:function(e){if(e.value.length>0){var t=!!e.getAttribute("data-validate-max")&&e.getAttribute("data-validate-max"),i=!!e.getAttribute("data-validate-min")&&e.getAttribute("data-validate-min");if(isNaN(e.value))return void this.processError("This must be a number",e);t&&parseFloat(e.value)>parseFloat(t)&&this.processError("This must be less than or equal to "+t,e),i&&parseFloat(e.value)<parseFloat(i)&&this.processError("This must be greater than or equal to "+i,e)}},validateDate:function(e){e.value.length>0&&(Date.parse(e.value).isValid()||this.processError("This must be a valid date",e))},validateLinked:function(e){},validateNomatch:function(e){var t,i,s,n=e.getParent(".default-form");e.get("data-validate-match")&&n.getElement("."+e.get("data-validate-match"))&&(t=e.value,i=n.getElement("."+e.get("data-validate-match")).value,s=n.getElement("."+e.get("data-validate-match")).getParent(".form-row").getElement("label"),t===i&&this.processError("This must not match "+s.get("html").stripTags(),e))},validateUrl:function(e){if(e.value.startsWith("mailto:"))return e.value=e.value.substring(7),this.validateEmail(e),void(e.value="mailto:"+e.value);var t=/(http|ftp|https|ftps):\/\/+([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?/,i=new RegExp(t);e.value.length>0&&(i.test(e.value)||this.processError("This must be a valid URL (try adding http:// to the start of the url)",e))},validateFile:function(e){if(!this.ignoreHasValue){var t,i=!1;if("element"==typeOf(e)){var s=e.getElements("input[type=file]");if(s.length>0)for(t=0;t<s.length;t++)if(""!==s[t].value){i=!0;break}var n=e.getElements("input.initialValues");try{if(n)if("string"===typeOf(n))""!==n.trim()&&(i=!0);else if(n.length>0)for(t=0;t<n.length;t++)if(null!==n[t].value&&""!==n[t].value){i=!0;break}}catch(e){}}i||this.processError("You must upload a file",e)}},checkNum:function(e){if(isNaN(e))return!1},validateBankNumber:function(e,t,i){if(!this.ignoreHasValue){var s=this.banknumValidationRequests[i];s&&s.isRunning()&&s.cancel(),this.banknumValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateBankNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("bankValidationSuccess"):window.fireEvent("bankValidationError"),window.fireEvent("bankValidationReturned",{el:e,data:t})},onError:function(){window.fireEvent("bankValidationError")},onFailure:function(){window.fireEvent("bankValidationError")}}).post({BankNumber:e.value,CountryCode:t})}},validateTaxNumberCountry:function(e){if(!this.ignoreHasValue)return""===e.value.trim()?(this.processError("You must select a country",e),!1):void 0},validateBankNumberCountry:function(e){if(!this.ignoreHasValue)return""===e.value.trim()?(this.processError("You must select a country",e),!1):void 0},validateTaxNumber:function(e,t,i){if(!this.ignoreHasValue){var s=this.taxValidationRequests[i];s&&s.isRunning()&&s.cancel(),this.taxValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateTaxNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("taxValidationSuccess"):window.fireEvent("taxValidationError"),window.fireEvent("taxValidationReturned",{el:e,data:t})},onError:function(){window.fireEvent("taxValidationError")},onFailure:function(){window.fireEvent("taxValidationError")}}).post({TaxNumber:e.value,CountryCode:t})}},validateText:function(e){var t=/^[a-zA-Z0-9_\-.,;'\"!?@#$\\|()\s]*$/g,i=new RegExp(t);if(e.value.length>0&&!i.test(e.value)){var s=255;s=e.getAttribute("data-validate-length")?e.getAttribute("data-validate-length"):s,s=e.getAttribute("data-validate-max")?e.getAttribute("data-validate-max"):s,s=parseInt(s)||255,e.value.length>s?this.processError("The text is too large. The maximum length allowed is 255 characters.",e):this.processError("You can only use these symbols: . , _ - ; ( ) ? $ @ # ! \\ ' \"",e)}}});
//# sourceMappingURL=lib.js.map
