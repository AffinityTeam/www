/*! For license information please see commonjs.js.LICENSE.txt */
!function(){function e(e,t,s){if(n)for(var o=n.length;o--;){var a=n[o];i.call(e,a)&&t.call(s,a,e[a])}}this.MooTools={version:"1.6.0",build:"529422872adfff401b901b8b6c7ca5114ee95e2b"};var t=this.typeOf=function(e){if(null==e)return"null";if(null!=e.$family)return e.$family();if(e.nodeName){if(1==e.nodeType)return"element";if(3==e.nodeType)return/\S/.test(e.nodeValue)?"textnode":"whitespace"}else if("number"==typeof e.length){if("callee"in e)return"arguments";if("item"in e)return"collection"}return typeof e},i=(this.instanceOf=function(e,t){if(null==e)return!1;for(var i=e.$constructor||e.constructor;i;){if(i===t)return!0;i=i.parent}return!!e.hasOwnProperty&&e instanceof t},Object.prototype.hasOwnProperty),n=!0;for(var s in{toString:1})n=null;n&&(n=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]);var o=this.Function;o.prototype.overloadSetter=function(t){var i=this;return function(n,s){if(null==n)return this;if(t||"string"!=typeof n){for(var o in n)i.call(this,o,n[o]);e(n,i,this)}else i.call(this,n,s);return this}},o.prototype.overloadGetter=function(e){var t=this;return function(i){var n,s;if("string"!=typeof i?n=i:arguments.length>1?n=arguments:e&&(n=[i]),n){s={};for(var o=0;o<n.length;o++)s[n[o]]=t.call(this,n[o])}else s=t.call(this,i);return s}},o.prototype.extend=function(e,t){this[e]=t}.overloadSetter(),o.prototype.implement=function(e,t){this.prototype[e]=t}.overloadSetter();var a=Array.prototype.slice;Array.convert=function(e){return null==e?[]:r.isEnumerable(e)&&"string"!=typeof e?"array"==t(e)?e:a.call(e):[e]},o.convert=function(e){return"function"==t(e)?e:function(){return e}},Number.convert=function(e){var t=parseFloat(e);return isFinite(t)?t:null},String.convert=function(e){return e+""},o.from=o.convert,Number.from=Number.convert,String.from=String.convert,o.implement({hide:function(){return this.$hidden=!0,this},protect:function(){return this.$protected=!0,this}});var r=this.Type=function(e,i){if(e){var n=e.toLowerCase();r["is"+e]=function(e){return t(e)==n},null!=i&&(i.prototype.$family=function(){return n}.hide())}return null==i?null:(i.extend(this),i.$constructor=r,i.prototype.$constructor=i,i)},l=Object.prototype.toString;r.isEnumerable=function(e){return null!=e&&"number"==typeof e.length&&"[object Function]"!=l.call(e)};var h={},d=function(e){var i=t(e.prototype);return h[i]||(h[i]=[])},c=function(e,i){if(!i||!i.$hidden){for(var n=d(this),s=0;s<n.length;s++){var o=n[s];"type"==t(o)?c.call(o,e,i):o.call(this,e,i)}var r=this.prototype[e];null!=r&&r.$protected||(this.prototype[e]=i),null==this[e]&&"function"==t(i)&&u.call(this,e,(function(e){return i.apply(e,a.call(arguments,1))}))}},u=function(e,t){if(!t||!t.$hidden){var i=this[e];null!=i&&i.$protected||(this[e]=t)}};r.implement({implement:c.overloadSetter(),extend:u.overloadSetter(),alias:function(e,t){c.call(this,e,this.prototype[t])}.overloadSetter(),mirror:function(e){return d(this).push(e),this}}),new r("Type",r);var m=function(e,t,i){var n=t!=Object,s=t.prototype;n&&(t=new r(e,t));for(var o=0,a=i.length;a>o;o++){var l=i[o],h=t[l],d=s[l];h&&h.protect(),n&&d&&t.implement(l,d.protect())}if(n){var c=s.propertyIsEnumerable(i[0]);t.forEachMethod=function(e){if(!c)for(var t=0,n=i.length;n>t;t++)e.call(s,s[i[t]],i[t]);for(var o in s)e.call(s,s[o],o)}}return m};m("String",String,["charAt","charCodeAt","concat","contains","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","contains"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",o,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]),Object.extend=u.overloadSetter(),Date.extend("now",(function(){return+new Date})),new r("Boolean",Boolean),Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide(),Number.extend("random",(function(e,t){return Math.floor(Math.random()*(t-e+1)+e)})),Array.implement({forEach:function(e,t){for(var i=0,n=this.length;n>i;i++)i in this&&e.call(t,this[i],i,this)},each:function(e,t){return Array.forEach(this,e,t),this}}),Object.extend({keys:function(t){var n=[];for(var s in t)i.call(t,s)&&n.push(s);return e(t,(function(e){n.push(e)})),n},forEach:function(e,t,i){Object.keys(e).forEach((function(n){t.call(i,e[n],n,e)}))}}),Object.each=Object.forEach;var p=function(e){switch(t(e)){case"array":return e.clone();case"object":return Object.clone(e);default:return e}};Array.implement("clone",(function(){for(var e=this.length,t=new Array(e);e--;)t[e]=p(this[e]);return t}));var f=function(e,i,n){switch(t(n)){case"object":"object"==t(e[i])?Object.merge(e[i],n):e[i]=Object.clone(n);break;case"array":e[i]=n.clone();break;default:e[i]=n}return e};Object.extend({merge:function(e,i,n){if("string"==t(i))return f(e,i,n);for(var s=1,o=arguments.length;o>s;s++){var a=arguments[s];for(var r in a)f(e,r,a[r])}return e},clone:function(e){var t={};for(var i in e)t[i]=p(e[i]);return t},append:function(e){for(var t=1,i=arguments.length;i>t;t++){var n=arguments[t]||{};for(var s in n)e[s]=n[s]}return e}}),["Object","WhiteSpace","TextNode","Collection","Arguments"].each((function(e){new r(e)}));var g=Date.now();String.extend("uniqueID",(function(){return(g++).toString(36)}))}(),Array.implement({every:function(e,t){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&!e.call(t,this[i],i,this))return!1;return!0},filter:function(e,t){for(var i,n=[],s=0,o=this.length>>>0;o>s;s++)s in this&&(i=this[s],e.call(t,i,s,this)&&n.push(i));return n},indexOf:function(e,t){for(var i=this.length>>>0,n=0>t?Math.max(0,i+t):t||0;i>n;n++)if(this[n]===e)return n;return-1},map:function(e,t){for(var i=this.length>>>0,n=Array(i),s=0;i>s;s++)s in this&&(n[s]=e.call(t,this[s],s,this));return n},some:function(e,t){for(var i=0,n=this.length>>>0;n>i;i++)if(i in this&&e.call(t,this[i],i,this))return!0;return!1},clean:function(){return this.filter((function(e){return null!=e}))},invoke:function(e){var t=Array.slice(arguments,1);return this.map((function(i){return i[e].apply(i,t)}))},associate:function(e){for(var t={},i=Math.min(this.length,e.length),n=0;i>n;n++)t[e[n]]=this[n];return t},link:function(e){for(var t={},i=0,n=this.length;n>i;i++)for(var s in e)if(e[s](this[i])){t[s]=this[i],delete e[s];break}return t},contains:function(e,t){return-1!=this.indexOf(e,t)},append:function(e){return this.push.apply(this,e),this},getLast:function(){return this.length?this[this.length-1]:null},getRandom:function(){return this.length?this[Number.random(0,this.length-1)]:null},include:function(e){return this.contains(e)||this.push(e),this},combine:function(e){for(var t=0,i=e.length;i>t;t++)this.include(e[t]);return this},erase:function(e){for(var t=this.length;t--;)this[t]===e&&this.splice(t,1);return this},empty:function(){return this.length=0,this},flatten:function(){for(var e=[],t=0,i=this.length;i>t;t++){var n=typeOf(this[t]);"null"!=n&&(e=e.concat("array"==n||"collection"==n||"arguments"==n||instanceOf(this[t],Array)?Array.flatten(this[t]):this[t]))}return e},pick:function(){for(var e=0,t=this.length;t>e;e++)if(null!=this[e])return this[e];return null},hexToRgb:function(e){if(3!=this.length)return null;var t=this.map((function(e){return 1==e.length&&(e+=e),parseInt(e,16)}));return e?t:"rgb("+t+")"},rgbToHex:function(e){if(this.length<3)return null;if(4==this.length&&0==this[3]&&!e)return"transparent";for(var t=[],i=0;3>i;i++){var n=(this[i]-0).toString(16);t.push(1==n.length?"0"+n:n)}return e?t:"#"+t.join("")}}),Function.extend({attempt:function(){for(var e=0,t=arguments.length;t>e;e++)try{return arguments[e]()}catch(e){}return null}}),Function.implement({attempt:function(e,t){try{return this.apply(t,Array.convert(e))}catch(e){}return null},bind:function(e){var t=this,i=arguments.length>1?Array.slice(arguments,1):null,n=function(){},s=function(){var o=e,a=arguments.length;this instanceof s&&(n.prototype=t.prototype,o=new n);var r=i||a?t.apply(o,i&&a?i.concat(Array.slice(arguments)):i||arguments):t.call(o);return o==e?r:o};return s},pass:function(e,t){var i=this;return null!=e&&(e=Array.convert(e)),function(){return i.apply(t,e||arguments)}},delay:function(e,t,i){return setTimeout(this.pass(null==i?[]:i,t),e)},periodical:function(e,t,i){return setInterval(this.pass(null==i?[]:i,t),e)}}),Number.implement({limit:function(e,t){return Math.min(t,Math.max(e,this))},round:function(e){return e=Math.pow(10,e||0).toFixed(0>e?-e:0),Math.round(this*e)/e},times:function(e,t){for(var i=0;this>i;i++)e.call(t,i,this)},toFloat:function(){return parseFloat(this)},toInt:function(e){return parseInt(this,e||10)}}),Number.alias("each","times"),function(e){var t={};["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"].each((function(e){Number[e]||(t[e]=function(){return Math[e].apply(null,[this].concat(Array.convert(arguments)))})})),Number.implement(t)}(),String.implement({contains:function(e,t){return(t?String(this).slice(t):String(this)).indexOf(e)>-1},test:function(e,t){return("regexp"==typeOf(e)?e:new RegExp(""+e,t)).test(this)},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,(function(e){return e.charAt(1).toUpperCase()}))},hyphenate:function(){return String(this).replace(/[A-Z]/g,(function(e){return"-"+e.charAt(0).toLowerCase()}))},capitalize:function(){return String(this).replace(/\b[a-z]/g,(function(e){return e.toUpperCase()}))},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(e){return parseInt(this,e||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(e){var t=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return t?t.slice(1).hexToRgb(e):null},rgbToHex:function(e){var t=String(this).match(/\d{1,3}/g);return t?t.rgbToHex(e):null},substitute:function(e,t){return String(this).replace(t||/\\?\{([^{}]+)\}/g,(function(t,i){return"\\"==t.charAt(0)?t.slice(1):null!=e[i]?e[i]:""}))}}),function(){var e=this.document,t=e.window=this,i=function(e,t){e=e.toLowerCase(),t=t?t.toLowerCase():"";var i=e.match(/(edge)[\s\/:]([\w\d\.]+)/);return i||(i=e.match(/(opera|ie|firefox|chrome|trident|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|(?:rv[\s\/:]|version[\s\/:])([\w\d\.]+)|$)/)||[null,"unknown",0]),"trident"==i[1]?(i[1]="ie",i[4]&&(i[2]=i[4])):"crios"==i[1]&&(i[1]="chrome"),"win"==(t=e.match(/ip(?:ad|od|hone)/)?"ios":(e.match(/(?:webos|android)/)||e.match(/mac|win|linux/)||["other"])[0])&&(t="windows"),{extend:Function.prototype.extend,name:"version"==i[1]?i[3]:i[1],version:parseFloat("opera"==i[1]&&i[4]?i[4]:i[2]),platform:t}},n=this.Browser=i(navigator.userAgent,navigator.platform);if("ie"==n.name&&e.documentMode&&(n.version=e.documentMode),n.extend({Features:{xpath:!!e.evaluate,air:!!t.runtime,query:!!e.querySelector,json:!!t.JSON},parseUA:i}),n.Request=function(){var e=function(){return new XMLHttpRequest},t=function(){return new ActiveXObject("MSXML2.XMLHTTP")},i=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt((function(){return e(),e}),(function(){return t(),t}),(function(){return i(),i}))}(),n.Features.xhr=!!n.Request,n.exec=function(i){if(!i)return i;if(t.execScript)t.execScript(i);else{var n=e.createElement("script");n.setAttribute("type","text/javascript"),n.text=i,e.head.appendChild(n),e.head.removeChild(n)}return i},String.implement("stripScripts",(function(e){var t="",i=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,(function(e,i){return t+=i+"\n",""}));return!0===e?n.exec(t):"function"==typeOf(e)&&e(t,i),i})),n.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event}),this.Window=this.$constructor=new Type("Window",(function(){})),this.$family=Function.convert("window").hide(),Window.mirror((function(e,i){t[e]=i})),this.Document=e.$constructor=new Type("Document",(function(){})),e.$family=Function.convert("document").hide(),Document.mirror((function(t,i){e[t]=i})),e.html=e.documentElement,e.head||(e.head=e.getElementsByTagName("head")[0]),e.execCommand)try{e.execCommand("BackgroundImageCache",!1,!0)}catch(e){}if(this.attachEvent&&!this.addEventListener){var s=function(){this.detachEvent("onunload",s),e.head=e.html=e.window=null,t=this.Window=e=null};this.attachEvent("onunload",s)}var o=Array.convert;try{o(e.html.childNodes)}catch(e){Array.convert=function(e){if("string"!=typeof e&&Type.isEnumerable(e)&&"array"!=typeOf(e)){for(var t=e.length,i=new Array(t);t--;)i[t]=e[t];return i}return o(e)};var a=Array.prototype,r=a.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each((function(e){var t=a[e];Array[e]=function(e){return t.apply(Array.convert(e),r.call(arguments,1))}}))}}(),function(){var e=this.Class=new Type("Class",(function(n){instanceOf(n,Function)&&(n={initialize:n});var s=function(){if(i(this),s.$prototyping)return this;this.$caller=null,this.$family=null;var e=this.initialize?this.initialize.apply(this,arguments):this;return this.$caller=this.caller=null,e}.extend(this).implement(n);return s.$constructor=e,s.prototype.$constructor=s,s.prototype.parent=t,s})),t=function(){if(!this.$caller)throw new Error('The method "parent" cannot be called.');var e=this.$caller.$name,t=this.$caller.$owner.parent,i=t?t.prototype[e]:null;if(!i)throw new Error('The method "'+e+'" has no parent.');return i.apply(this,arguments)},i=function(e){for(var t in e){var n=e[t];switch(typeOf(n)){case"object":var s=function(){};s.prototype=n,e[t]=i(new s);break;case"array":e[t]=n.clone()}}return e},n=function(t,i,n){if(e.Mutators.hasOwnProperty(t)&&null==(i=e.Mutators[t].call(this,i)))return this;if("function"==typeOf(i)){if(i.$hidden)return this;this.prototype[t]=n?i:function(e,t,i){i.$origin&&(i=i.$origin);var n=function(){if(i.$protected&&null==this.$caller)throw new Error('The method "'+t+'" cannot be called.');var e=this.caller,s=this.$caller;this.caller=s,this.$caller=n;var o=i.apply(this,arguments);return this.$caller=s,this.caller=e,o}.extend({$owner:e,$origin:i,$name:t});return n}(this,t,i)}else Object.merge(this.prototype,t,i);return this};e.implement("implement",n.overloadSetter()),e.Mutators={Extends:function(e){this.parent=e,this.prototype=function(e){e.$prototyping=!0;var t=new e;return delete e.$prototyping,t}(e)},Implements:function(e){Array.convert(e).each((function(e){var t=new e;for(var i in t)n.call(this,i,t[i],!0)}),this)}}}(),function(){this.Chain=new Class({$chain:[],chain:function(){return this.$chain.append(Array.flatten(arguments)),this},callChain:function(){return!!this.$chain.length&&this.$chain.shift().apply(this,arguments)},clearChain:function(){return this.$chain.empty(),this}});var e=function(e){return e.replace(/^on([A-Z])/,(function(e,t){return t.toLowerCase()}))};this.Events=new Class({$events:{},addEvent:function(t,i,n){return t=e(t),this.$events[t]=(this.$events[t]||[]).include(i),n&&(i.internal=!0),this},addEvents:function(e){for(var t in e)this.addEvent(t,e[t]);return this},fireEvent:function(t,i,n){t=e(t);var s=this.$events[t];return s?(i=Array.convert(i),s.each((function(e){n?e.delay(n,this,i):e.apply(this,i)}),this),this):this},removeEvent:function(t,i){t=e(t);var n=this.$events[t];if(n&&!i.internal){var s=n.indexOf(i);-1!=s&&delete n[s]}return this},removeEvents:function(t){var i;if("object"==typeOf(t)){for(i in t)this.removeEvent(i,t[i]);return this}for(i in t&&(t=e(t)),this.$events)if(!t||t==i)for(var n=this.$events[i],s=n.length;s--;)s in n&&this.removeEvent(i,n[s]);return this}}),this.Options=new Class({setOptions:function(){var e=this.options=Object.merge.apply(null,[{},this.options].append(arguments));if(this.addEvent)for(var t in e)"function"==typeOf(e[t])&&/^on[A-Z]/.test(t)&&(this.addEvent(t,e[t]),delete e[t]);return this}})}(),function(){function e(n,s){if(n.$thenableState===a)if(n===s)i(n,new TypeError("Tried to resolve a thenable with itself."));else if(!s||"object"!=typeof s&&"function"!=typeof s)t(n,s);else{var r;try{r=s.then}catch(e){i(n,e)}if("function"==typeof r){var l=!1;o((function(){try{r.call(s,(function(t){l||(l=!0,e(n,t))}),(function(e){l||(l=!0,i(n,e))}))}catch(e){l||(l=!0,i(n,e))}}))}else t(n,s)}}function t(e,t){e.$thenableState===a&&(e.$thenableResult=t,e.$thenableState=r,n(e))}function i(e,t){e.$thenableState===a&&(e.$thenableResult=t,e.$thenableState=l,n(e))}function n(e){var t,i=e.$thenableState,n=e.$thenableResult,a=e.$thenableReactions;i===r?(e.$thenableReactions=[],t="fulfillHandler"):i==l&&(e.$thenableReactions=[],t="rejectHandler"),t&&o(s.pass([n,a,t]))}function s(t,n,s){for(var o=0,a=n.length;a>o;++o){var r=n[o],l=r[s];if("Identity"===l)e(r.thenable,t);else if("Thrower"===l)i(r.thenable,t);else try{e(r.thenable,l(t))}catch(e){i(r.thenable,e)}}}var o,a=0,r=1,l=2,h=Class.Thenable=new Class({$thenableState:a,$thenableResult:null,$thenableReactions:[],resolve:function(t){return e(this,t),this},reject:function(e){return i(this,e),this},getThenableState:function(){switch(this.$thenableState){case a:return"pending";case r:return"fulfilled";case l:return"rejected"}},resetThenable:function(e){return i(this,e),function(e){e.$thenableState!==a&&(e.$thenableResult=null,e.$thenableState=a)}(this),this},then:function(e,t){"function"!=typeof e&&(e="Identity"),"function"!=typeof t&&(t="Thrower");var i=new h;return this.$thenableReactions.push({thenable:i,fulfillHandler:e,rejectHandler:t}),this.$thenableState!==a&&n(this),i},catch:function(e){return this.then(null,e)}});h.extend({resolve:function(t){var i;return t instanceof h?i=t:e(i=new h,t),i},reject:function(e){var t=new h;return i(t,e),t}}),o="undefined"!=typeof process&&"function"==typeof process.nextTick?process.nextTick:"undefined"!=typeof setImmediate?setImmediate:function(e){setTimeout(e,0)}}(),Object.extend({subset:function(e,t){for(var i={},n=0,s=t.length;s>n;n++){var o=t[n];o in e&&(i[o]=e[o])}return i},map:function(e,t,i){for(var n={},s=Object.keys(e),o=0;o<s.length;o++){var a=s[o];n[a]=t.call(i,e[a],a,e)}return n},filter:function(e,t,i){for(var n={},s=Object.keys(e),o=0;o<s.length;o++){var a=s[o],r=e[a];t.call(i,r,a,e)&&(n[a]=r)}return n},every:function(e,t,i){for(var n=Object.keys(e),s=0;s<n.length;s++){var o=n[s];if(!t.call(i,e[o],o))return!1}return!0},some:function(e,t,i){for(var n=Object.keys(e),s=0;s<n.length;s++){var o=n[s];if(t.call(i,e[o],o))return!0}return!1},values:function(e){for(var t=[],i=Object.keys(e),n=0;n<i.length;n++){var s=i[n];t.push(e[s])}return t},getLength:function(e){return Object.keys(e).length},keyOf:function(e,t){for(var i=Object.keys(e),n=0;n<i.length;n++){var s=i[n];if(e[s]===t)return s}return null},contains:function(e,t){return null!=Object.keyOf(e,t)},toQueryString:function(e,t){var i=[];return Object.each(e,(function(e,n){var s;switch(t&&(n=t+"["+n+"]"),typeOf(e)){case"object":s=Object.toQueryString(e,n);break;case"array":var o={};e.each((function(e,t){o[t]=e})),s=Object.toQueryString(o,n);break;default:s=n+"="+encodeURIComponent(e)}null!=e&&i.push(s)})),i.join("&")}}),function(){function e(e,o,a,l,d,u,m,p,f,g,v,y,b,A,E,w){if((o||-1===i)&&(t.expressions[++i]=[],n=-1,o))return"";if(a||l||-1===n){a=a||" ";var C=t.expressions[i];s&&C[n]&&(C[n].reverseCombinator=h(a)),C[++n]={combinator:a,tag:"*"}}var x=t.expressions[i][n];if(d)x.tag=d.replace(r,"");else if(u)x.id=u.replace(r,"");else if(m)m=m.replace(r,""),x.classList||(x.classList=[]),x.classes||(x.classes=[]),x.classList.push(m),x.classes.push({value:m,regexp:new RegExp("(^|\\s)"+c(m)+"(\\s|$)")});else if(b)w=(w=w||E)?w.replace(r,""):null,x.pseudos||(x.pseudos=[]),x.pseudos.push({key:b.replace(r,""),value:w,type:1==y.length?"class":"element"});else if(p){var k,S;switch(p=p.replace(r,""),v=(v||"").replace(r,""),f){case"^=":S=new RegExp("^"+c(v));break;case"$=":S=new RegExp(c(v)+"$");break;case"~=":S=new RegExp("(^|\\s)"+c(v)+"(\\s|$)");break;case"|=":S=new RegExp("^"+c(v)+"(-|$)");break;case"=":k=function(e){return v==e};break;case"*=":k=function(e){return e&&e.indexOf(v)>-1};break;case"!=":k=function(e){return v!=e};break;default:k=function(e){return!!e}}""==v&&/^[*$^]=$/.test(f)&&(k=function(){return!1}),k||(k=function(e){return e&&S.test(e)}),x.attributes||(x.attributes=[]),x.attributes.push({key:p,operator:f,value:v,test:k})}return""}var t,i,n,s,o={},a={},r=/\\/g,l=function(n,r){if(null==n)return null;if(!0===n.Slick)return n;n=(""+n).replace(/^\s+|\s+$/g,"");var h=(s=!!r)?a:o;if(h[n])return h[n];for(t={Slick:!0,expressions:[],raw:n,reverse:function(){return l(this.raw,!0)}},i=-1;n!=(n=n.replace(u,e)););return t.length=t.expressions.length,h[t.raw]=s?d(t):t},h=function(e){return"!"===e?" ":" "===e?"!":/^!/.test(e)?e.replace(/^!/,""):"!"+e},d=function(e){for(var t=e.expressions,i=0;i<t.length;i++){for(var n=t[i],s={parts:[],tag:"*",combinator:h(n[0].combinator)},o=0;o<n.length;o++){var a=n[o];a.reverseCombinator||(a.reverseCombinator=" "),a.combinator=a.reverseCombinator,delete a.reverseCombinator}n.reverse().push(s)}return e},c=function(e){return e.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,(function(e){return"\\"+e}))},u=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+c(">+~`!@$%^&={}\\;</")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),m=this.Slick||{};m.parse=function(e){return l(e)},m.escapeRegExp=c,this.Slick||(this.Slick=m)}.apply("undefined"!=typeof exports?exports:this),function(){var e={},t={},i=Object.prototype.toString;e.isNativeCode=function(e){return/\{\s*\[native code\]\s*\}/.test(""+e)},e.isXML=function(e){return!!e.xmlVersion||!!e.xml||"[object XMLDocument]"==i.call(e)||9==e.nodeType&&"HTML"!=e.documentElement.nodeName},e.setDocument=function(e){var i=e.nodeType;if(9==i);else if(i)e=e.ownerDocument;else{if(!e.navigator)return;e=e.document}if(this.document!==e){this.document=e;var n,s=e.documentElement,o=this.getUIDXML(s),a=t[o];if(a)for(n in a)this[n]=a[n];else{(a=t[o]={}).root=s,a.isXMLDocument=this.isXML(e),a.brokenStarGEBTN=a.starSelectsClosedQSA=a.idGetsName=a.brokenMixedCaseQSA=a.brokenGEBCN=a.brokenCheckedQSA=a.brokenEmptyAttributeQSA=a.isHTMLDocument=a.nativeMatchesSelector=!1;var r,l,h,d,c,u,m="slick_uniqueid",p=e.createElement("div"),f=e.body||e.getElementsByTagName("body")[0]||s;f.appendChild(p);try{p.innerHTML='<a id="'+m+'"></a>',a.isHTMLDocument=!!e.getElementById(m)}catch(e){}if(a.isHTMLDocument){p.style.display="none",p.appendChild(e.createComment("")),l=p.getElementsByTagName("*").length>1;try{p.innerHTML="foo</foo>",r=(u=p.getElementsByTagName("*"))&&!!u.length&&"/"==u[0].nodeName.charAt(0)}catch(e){}a.brokenStarGEBTN=l||r;try{p.innerHTML='<a name="'+m+'"></a><b id="'+m+'"></b>',a.idGetsName=e.getElementById(m)===p.firstChild}catch(e){}if(p.getElementsByClassName){try{p.innerHTML='<a class="f"></a><a class="b"></a>',p.getElementsByClassName("b").length,p.firstChild.className="b",d=2!=p.getElementsByClassName("b").length}catch(e){}try{p.innerHTML='<a class="a"></a><a class="f b a"></a>',h=2!=p.getElementsByClassName("a").length}catch(e){}a.brokenGEBCN=d||h}if(p.querySelectorAll){try{p.innerHTML="foo</foo>",u=p.querySelectorAll("*"),a.starSelectsClosedQSA=u&&!!u.length&&"/"==u[0].nodeName.charAt(0)}catch(e){}try{p.innerHTML='<a class="MiX"></a>',a.brokenMixedCaseQSA=!p.querySelectorAll(".MiX").length}catch(e){}try{p.innerHTML='<select><option selected="selected">a</option></select>',a.brokenCheckedQSA=0==p.querySelectorAll(":checked").length}catch(e){}try{p.innerHTML='<a class=""></a>',a.brokenEmptyAttributeQSA=0!=p.querySelectorAll('[class*=""]').length}catch(e){}}try{p.innerHTML='<form action="s"><input id="action"/></form>',c="s"!=p.firstChild.getAttribute("action")}catch(e){}if(a.nativeMatchesSelector=s.matches||s.mozMatchesSelector||s.webkitMatchesSelector,a.nativeMatchesSelector)try{a.nativeMatchesSelector.call(s,":slick"),a.nativeMatchesSelector=null}catch(e){}}try{s.slick_expando=1,delete s.slick_expando,a.getUID=this.getUIDHTML}catch(e){a.getUID=this.getUIDXML}f.removeChild(p),p=u=f=null,a.getAttribute=a.isHTMLDocument&&c?function(e,t){var i=this.attributeGetters[t];if(i)return i.call(e);var n=e.getAttributeNode(t);return n?n.nodeValue:null}:function(e,t){var i=this.attributeGetters[t];return i?i.call(e):e.getAttribute(t)},a.hasAttribute=s&&this.isNativeCode(s.hasAttribute)?function(e,t){return e.hasAttribute(t)}:function(e,t){return!(!(e=e.getAttributeNode(t))||!e.specified&&!e.nodeValue)};var g=s&&this.isNativeCode(s.contains),v=e&&this.isNativeCode(e.contains);for(n in a.contains=g&&v?function(e,t){return e.contains(t)}:g&&!v?function(t,i){return t===i||(t===e?e.documentElement:t).contains(i)}:s&&s.compareDocumentPosition?function(e,t){return e===t||!!(16&e.compareDocumentPosition(t))}:function(e,t){if(t)do{if(t===e)return!0}while(t=t.parentNode);return!1},a.documentSorter=s.compareDocumentPosition?function(e,t){return e.compareDocumentPosition&&t.compareDocumentPosition?4&e.compareDocumentPosition(t)?-1:e===t?0:1:0}:"sourceIndex"in s?function(e,t){return e.sourceIndex&&t.sourceIndex?e.sourceIndex-t.sourceIndex:0}:e.createRange?function(e,t){if(!e.ownerDocument||!t.ownerDocument)return 0;var i=e.ownerDocument.createRange(),n=t.ownerDocument.createRange();return i.setStart(e,0),i.setEnd(e,0),n.setStart(t,0),n.setEnd(t,0),i.compareBoundaryPoints(Range.START_TO_END,n)}:null,s=null,a)this[n]=a[n]}}};var n=/^([#.]?)((?:[\w-]+|\*))$/,s=/\[.+[*$^]=(?:""|'')?\]/,o={};e.search=function(e,t,i,a){var r=this.found=a?null:i||[];if(!e)return r;if(e.navigator)e=e.document;else if(!e.nodeType)return r;var l,h,d,u,m=this.uniques={},p=!(!i||!i.length),f=9==e.nodeType;if(this.document!==(f?e:e.ownerDocument)&&this.setDocument(e),p)for(h=r.length;h--;)m[this.getUID(r[h])]=!0;if("string"==typeof t){var g=t.match(n);e:if(g){var v=g[1],y=g[2];if(v){if("#"==v){if(!this.isHTMLDocument||!f)break e;if(!(d=e.getElementById(y)))return r;if(this.idGetsName&&d.getAttributeNode("id").nodeValue!=y)break e;if(a)return d||null;p&&m[this.getUID(d)]||r.push(d)}else if("."==v){if(!this.isHTMLDocument||(!e.getElementsByClassName||this.brokenGEBCN)&&e.querySelectorAll)break e;if(e.getElementsByClassName&&!this.brokenGEBCN){if(u=e.getElementsByClassName(y),a)return u[0]||null;for(h=0;d=u[h++];)p&&m[this.getUID(d)]||r.push(d)}else{var b=new RegExp("(^|\\s)"+c.escapeRegExp(y)+"(\\s|$)");for(u=e.getElementsByTagName("*"),h=0;d=u[h++];)if(className=d.className,className&&b.test(className)){if(a)return d;p&&m[this.getUID(d)]||r.push(d)}}}}else{if("*"==y&&this.brokenStarGEBTN)break e;if(u=e.getElementsByTagName(y),a)return u[0]||null;for(h=0;d=u[h++];)p&&m[this.getUID(d)]||r.push(d)}return p&&this.sort(r),a?null:r}e:if(e.querySelectorAll){if(!this.isHTMLDocument||o[t]||this.brokenMixedCaseQSA||this.brokenCheckedQSA&&t.indexOf(":checked")>-1||this.brokenEmptyAttributeQSA&&s.test(t)||!f&&t.indexOf(",")>-1||c.disableQSA)break e;var A,E=t,w=e;f||(A=w.getAttribute("id"),slickid="slickid__",w.setAttribute("id",slickid),E="#"+slickid+" "+E,e=w.parentNode);try{if(a)return e.querySelector(E)||null;u=e.querySelectorAll(E)}catch(e){o[t]=1;break e}finally{f||(A?w.setAttribute("id",A):w.removeAttribute("id"),e=w)}if(this.starSelectsClosedQSA)for(h=0;d=u[h++];)!(d.nodeName>"@")||p&&m[this.getUID(d)]||r.push(d);else for(h=0;d=u[h++];)p&&m[this.getUID(d)]||r.push(d);return p&&this.sort(r),r}if(!(l=this.Slick.parse(t)).length)return r}else{if(null==t)return r;if(!t.Slick)return this.contains(e.documentElement||e,t)?(r?r.push(t):r=t,r):r;l=t}this.posNTH={},this.posNTHLast={},this.posNTHType={},this.posNTHTypeLast={},this.push=!p&&(a||1==l.length&&1==l.expressions[0].length)?this.pushArray:this.pushUID,null==r&&(r=[]);var C,x,k,S,I,T,D,O,F,B,P,M,N,U,L=l.expressions;e:for(h=0;M=L[h];h++)for(C=0;N=M[C];C++){if(!this[S="combinator:"+N.combinator])continue e;if(I=this.isXMLDocument?N.tag:N.tag.toUpperCase(),T=N.id,D=N.classList,O=N.classes,F=N.attributes,B=N.pseudos,U=C===M.length-1,this.bitUniques={},U?(this.uniques=m,this.found=r):(this.uniques={},this.found=[]),0===C){if(this[S](e,I,T,O,F,B,D),a&&U&&r.length)break e}else if(a&&U){for(x=0,k=P.length;k>x;x++)if(this[S](P[x],I,T,O,F,B,D),r.length)break e}else for(x=0,k=P.length;k>x;x++)this[S](P[x],I,T,O,F,B,D);P=this.found}return(p||l.expressions.length>1)&&this.sort(r),a?r[0]||null:r},e.uidx=1,e.uidk="slick-uniqueid",e.getUIDXML=function(e){var t=e.getAttribute(this.uidk);return t||(t=this.uidx++,e.setAttribute(this.uidk,t)),t},e.getUIDHTML=function(e){return e.uniqueNumber||(e.uniqueNumber=this.uidx++)},e.sort=function(e){return this.documentSorter?(e.sort(this.documentSorter),e):e},e.cacheNTH={},e.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/,e.parseNTHArgument=function(e){var t=e.match(this.matchNTH);if(!t)return!1;var i=t[2]||!1,n=t[1]||1;"-"==n&&(n=-1);var s=+t[3]||0;return t="n"==i?{a:n,b:s}:"odd"==i?{a:2,b:1}:"even"==i?{a:2,b:0}:{a:0,b:n},this.cacheNTH[e]=t},e.createNTHPseudo=function(e,t,i,n){return function(s,o){var a=this.getUID(s);if(!this[i][a]){var r=s.parentNode;if(!r)return!1;var l=r[e],h=1;if(n){var d=s.nodeName;do{l.nodeName==d&&(this[i][this.getUID(l)]=h++)}while(l=l[t])}else do{1==l.nodeType&&(this[i][this.getUID(l)]=h++)}while(l=l[t])}o=o||"n";var c=this.cacheNTH[o]||this.parseNTHArgument(o);if(!c)return!1;var u=c.a,m=c.b,p=this[i][a];if(0==u)return m==p;if(u>0){if(m>p)return!1}else if(p>m)return!1;return(p-m)%u==0}},e.pushArray=function(e,t,i,n,s,o){this.matchSelector(e,t,i,n,s,o)&&this.found.push(e)},e.pushUID=function(e,t,i,n,s,o){var a=this.getUID(e);!this.uniques[a]&&this.matchSelector(e,t,i,n,s,o)&&(this.uniques[a]=!0,this.found.push(e))},e.matchNode=function(e,t){if(this.isHTMLDocument&&this.nativeMatchesSelector)try{return this.nativeMatchesSelector.call(e,t.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(e){}var i=this.Slick.parse(t);if(!i)return!0;var n,s,o=i.expressions,a=0;for(n=0;s=o[n];n++)if(1==s.length){var r=s[0];if(this.matchSelector(e,this.isXMLDocument?r.tag:r.tag.toUpperCase(),r.id,r.classes,r.attributes,r.pseudos))return!0;a++}if(a==i.length)return!1;var l,h=this.search(this.document,i);for(n=0;l=h[n++];)if(l===e)return!0;return!1},e.matchPseudo=function(e,t,i){var n="pseudo:"+t;if(this[n])return this[n](e,i);var s=this.getAttribute(e,t);return i?i==s:!!s},e.matchSelector=function(e,t,i,n,s,o){if(t){var a=this.isXMLDocument?e.nodeName:e.nodeName.toUpperCase();if("*"==t){if("@">a)return!1}else if(a!=t)return!1}if(i&&e.getAttribute("id")!=i)return!1;var r,l,h;if(n)for(r=n.length;r--;)if(!(h=this.getAttribute(e,"class"))||!n[r].regexp.test(h))return!1;if(s)for(r=s.length;r--;)if((l=s[r]).operator?!l.test(this.getAttribute(e,l.key)):!this.hasAttribute(e,l.key))return!1;if(o)for(r=o.length;r--;)if(l=o[r],!this.matchPseudo(e,l.key,l.value))return!1;return!0};var a={" ":function(e,t,i,n,s,o,a){var r,l,h;if(this.isHTMLDocument){e:if(i){if(!(l=this.document.getElementById(i))&&e.all||this.idGetsName&&l&&l.getAttributeNode("id").nodeValue!=i){if(!(h=e.all[i]))return;for(h[0]||(h=[h]),r=0;l=h[r++];){var d=l.getAttributeNode("id");if(d&&d.nodeValue==i){this.push(l,t,null,n,s,o);break}}return}if(!l){if(this.contains(this.root,e))return;break e}if(this.document!==e&&!this.contains(e,l))return;return void this.push(l,t,null,n,s,o)}e:if(n&&e.getElementsByClassName&&!this.brokenGEBCN){if(!(h=e.getElementsByClassName(a.join(" ")))||!h.length)break e;for(r=0;l=h[r++];)this.push(l,t,i,null,s,o);return}}if((h=e.getElementsByTagName(t))&&h.length)for(this.brokenStarGEBTN||(t=null),r=0;l=h[r++];)this.push(l,t,i,n,s,o)},">":function(e,t,i,n,s,o){if(e=e.firstChild)do{1==e.nodeType&&this.push(e,t,i,n,s,o)}while(e=e.nextSibling)},"+":function(e,t,i,n,s,o){for(;e=e.nextSibling;)if(1==e.nodeType){this.push(e,t,i,n,s,o);break}},"^":function(e,t,i,n,s,o){(e=e.firstChild)&&(1==e.nodeType?this.push(e,t,i,n,s,o):this["combinator:+"](e,t,i,n,s,o))},"~":function(e,t,i,n,s,o){for(;e=e.nextSibling;)if(1==e.nodeType){var a=this.getUID(e);if(this.bitUniques[a])break;this.bitUniques[a]=!0,this.push(e,t,i,n,s,o)}},"++":function(e,t,i,n,s,o){this["combinator:+"](e,t,i,n,s,o),this["combinator:!+"](e,t,i,n,s,o)},"~~":function(e,t,i,n,s,o){this["combinator:~"](e,t,i,n,s,o),this["combinator:!~"](e,t,i,n,s,o)},"!":function(e,t,i,n,s,o){for(;e=e.parentNode;)e!==this.document&&this.push(e,t,i,n,s,o)},"!>":function(e,t,i,n,s,o){(e=e.parentNode)!==this.document&&this.push(e,t,i,n,s,o)},"!+":function(e,t,i,n,s,o){for(;e=e.previousSibling;)if(1==e.nodeType){this.push(e,t,i,n,s,o);break}},"!^":function(e,t,i,n,s,o){(e=e.lastChild)&&(1==e.nodeType?this.push(e,t,i,n,s,o):this["combinator:!+"](e,t,i,n,s,o))},"!~":function(e,t,i,n,s,o){for(;e=e.previousSibling;)if(1==e.nodeType){var a=this.getUID(e);if(this.bitUniques[a])break;this.bitUniques[a]=!0,this.push(e,t,i,n,s,o)}}};for(var r in a)e["combinator:"+r]=a[r];var l={empty:function(e){var t=e.firstChild;return!(t&&1==t.nodeType||(e.innerText||e.textContent||"").length)},not:function(e,t){return!this.matchNode(e,t)},contains:function(e,t){return(e.innerText||e.textContent||"").indexOf(t)>-1},"first-child":function(e){for(;e=e.previousSibling;)if(1==e.nodeType)return!1;return!0},"last-child":function(e){for(;e=e.nextSibling;)if(1==e.nodeType)return!1;return!0},"only-child":function(e){for(var t=e;t=t.previousSibling;)if(1==t.nodeType)return!1;for(var i=e;i=i.nextSibling;)if(1==i.nodeType)return!1;return!0},"nth-child":e.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":e.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":e.createNTHPseudo("firstChild","nextSibling","posNTHType",!0),"nth-last-of-type":e.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",!0),index:function(e,t){return this["pseudo:nth-child"](e,""+(t+1))},even:function(e){return this["pseudo:nth-child"](e,"2n")},odd:function(e){return this["pseudo:nth-child"](e,"2n+1")},"first-of-type":function(e){for(var t=e.nodeName;e=e.previousSibling;)if(e.nodeName==t)return!1;return!0},"last-of-type":function(e){for(var t=e.nodeName;e=e.nextSibling;)if(e.nodeName==t)return!1;return!0},"only-of-type":function(e){for(var t=e,i=e.nodeName;t=t.previousSibling;)if(t.nodeName==i)return!1;for(var n=e;n=n.nextSibling;)if(n.nodeName==i)return!1;return!0},enabled:function(e){return!e.disabled},disabled:function(e){return e.disabled},checked:function(e){return e.checked||e.selected},focus:function(e){return this.isHTMLDocument&&this.document.activeElement===e&&(e.href||e.type||this.hasAttribute(e,"tabindex"))},root:function(e){return e===this.root},selected:function(e){return e.selected}};for(var h in l)e["pseudo:"+h]=l[h];var d=e.attributeGetters={for:function(){return"htmlFor"in this?this.htmlFor:this.getAttribute("for")},href:function(){return"href"in this?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return this.style?this.style.cssText:this.getAttribute("style")},tabindex:function(){var e=this.getAttributeNode("tabindex");return e&&e.specified?e.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var e=this.getAttributeNode("maxLength");return e&&e.specified?e.nodeValue:null}};d.MAXLENGTH=d.maxLength=d.maxlength;var c=e.Slick=this.Slick||{};c.version="1.1.7",c.search=function(t,i,n){return e.search(t,i,n)},c.find=function(t,i){return e.search(t,i,null,!0)},c.contains=function(t,i){return e.setDocument(t),e.contains(t,i)},c.getAttribute=function(t,i){return e.setDocument(t),e.getAttribute(t,i)},c.hasAttribute=function(t,i){return e.setDocument(t),e.hasAttribute(t,i)},c.match=function(t,i){return!(!t||!i)&&(!i||i===t||(e.setDocument(t),e.matchNode(t,i)))},c.defineAttributeGetter=function(t,i){return e.attributeGetters[t]=i,this},c.lookupAttributeGetter=function(t){return e.attributeGetters[t]},c.definePseudo=function(t,i){return e["pseudo:"+t]=function(e,t){return i.call(e,t)},this},c.lookupPseudo=function(t){var i=e["pseudo:"+t];return i?function(e){return i.call(this,e)}:null},c.override=function(t,i){return e.override(t,i),this},c.isXML=e.isXML,c.uidOf=function(t){return e.getUIDHTML(t)},this.Slick||(this.Slick=c)}.apply("undefined"!=typeof exports?exports:this);var Element=this.Element=function(e,t){var i=Element.Constructors[e];if(i)return i(t);if("string"!=typeof e)return document.id(e).set(t);if(t||(t={}),!/^[\w-]+$/.test(e)){var n=Slick.parse(e).expressions[0][0];e="*"==n.tag?"div":n.tag,n.id&&null==t.id&&(t.id=n.id);var s=n.attributes;if(s)for(var o,a=0,r=s.length;r>a;a++)null==t[(o=s[a]).key]&&(null!=o.value&&"="==o.operator?t[o.key]=o.value:o.value||o.operator||(t[o.key]=!0));n.classList&&null==t.class&&(t.class=n.classList.join(" "))}return document.newElement(e,t)};Browser.Element&&(Element.prototype=Browser.Element.prototype,Element.prototype._fireEvent=function(e){return function(t,i){return e.call(this,t,i)}}(Element.prototype.fireEvent)),new Type("Element",Element).mirror((function(e){if(!Array.prototype[e]){var t={};t[e]=function(){for(var t=[],i=arguments,n=!0,s=0,o=this.length;o>s;s++){var a=this[s],r=t[s]=a[e].apply(a,i);n=n&&"element"==typeOf(r)}return n?new Elements(t):t},Elements.implement(t)}})),Browser.Element||(Element.parent=Object,Element.Prototype={$constructor:Element,$family:Function.convert("element").hide()},Element.mirror((function(e,t){Element.Prototype[e]=t}))),Element.Constructors={};var IFrame=new Type("IFrame",(function(){var e,t=Array.link(arguments,{properties:Type.isObject,iframe:function(e){return null!=e}}),i=t.properties||{};t.iframe&&(e=document.id(t.iframe));var n=i.onload||function(){};delete i.onload,i.id=i.name=[i.id,i.name,e?e.id||e.name:"IFrame_"+String.uniqueID()].pick(),e=new Element(e||"iframe",i);var s=function(){n.call(e.contentWindow)};return window.frames[i.id]?s():e.addListener("load",s),e})),Elements=this.Elements=function(e){if(e&&e.length)for(var t,i={},n=0;t=e[n++];){var s=Slick.uidOf(t);i[s]||(i[s]=!0,this.push(t))}};Elements.prototype={length:0},Elements.parent=Array,new Type("Elements",Elements).implement({filter:function(e,t){return e?new Elements(Array.filter(this,"string"==typeOf(e)?function(t){return t.match(e)}:e,t)):this}.protect(),push:function(){for(var e=this.length,t=0,i=arguments.length;i>t;t++){var n=document.id(arguments[t]);n&&(this[e++]=n)}return this.length=e}.protect(),unshift:function(){for(var e=[],t=0,i=arguments.length;i>t;t++){var n=document.id(arguments[t]);n&&e.push(n)}return Array.prototype.unshift.apply(this,e)}.protect(),concat:function(){for(var e=new Elements(this),t=0,i=arguments.length;i>t;t++){var n=arguments[t];Type.isEnumerable(n)?e.append(n):e.push(n)}return e}.protect(),append:function(e){for(var t=0,i=e.length;i>t;t++)this.push(e[t]);return this}.protect(),empty:function(){for(;this.length;)delete this[--this.length];return this}.protect()}),function(){var e,t=Array.prototype.splice,i={0:0,1:1,length:2};t.call(i,1,1),1==i[1]&&Elements.implement("splice",function(){for(var e=this.length,i=t.apply(this,arguments);e>=this.length;)delete this[e--];return i}.protect()),Array.forEachMethod((function(e,t){Elements.implement(t,e)})),Array.mirror(Elements);try{e="x"==document.createElement("<input name=x>").name}catch(e){}var n=function(e){return(""+e).replace(/&/g,"&amp;").replace(/"/g,"&quot;")},s=function(){var e=document.createElement("style"),t=!1;try{e.innerHTML="#justTesing{margin: 0px;}",t=!!e.innerHTML}catch(e){}return t}();Document.implement({newElement:function(t,i){if(i){if(null!=i.checked&&(i.defaultChecked=i.checked),"checkbox"!=i.type&&"radio"!=i.type||null!=i.value||(i.value="on"),!s&&"style"==t){var o=document.createElement("style");return o.setAttribute("type","text/css"),i.type&&delete i.type,this.id(o).set(i)}e&&(t="<"+t,i.name&&(t+=' name="'+n(i.name)+'"'),i.type&&(t+=' type="'+n(i.type)+'"'),t+=">",delete i.name,delete i.type)}return this.id(this.createElement(t)).set(i)}})}(),function(){Slick.uidOf(window),Slick.uidOf(document),Document.implement({newTextNode:function(e){return this.createTextNode(e)},getDocument:function(){return this},getWindow:function(){return this.window},id:function(){var e={string:function(t,i,n){return(t=Slick.find(n,"#"+t.replace(/(\W)/g,"\\$1")))?e.element(t,i):null},element:function(e,t){if(Slick.uidOf(e),!t&&!e.$family&&!/^(?:object|embed)$/i.test(e.tagName)){var i=e.fireEvent;e._fireEvent=function(e,t){return i(e,t)},Object.append(e,Element.Prototype)}return e},object:function(t,i,n){return t.toElement?e.element(t.toElement(n),i):null}};return e.textnode=e.whitespace=e.window=e.document=function(e){return e},function(t,i,n){if(t&&t.$family&&t.uniqueNumber)return t;var s=typeOf(t);return e[s]?e[s](t,i,n||document):null}}()}),null==window.$&&Window.implement("$",(function(e,t){return document.id(e,t,this.document)})),Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}}),[Document,Element].invoke("implement",{getElements:function(e){return Slick.search(this,e,new Elements)},getElement:function(e){return document.id(Slick.find(this,e))}});var e={contains:function(e){return Slick.contains(this,e)}};document.contains||Document.implement(e),document.createElement("div").contains||Element.implement(e);var t=function(e,t){if(!e)return t;for(var i=(e=Object.clone(Slick.parse(e))).expressions,n=i.length;n--;)i[n][0].combinator=t;return e};Object.forEach({getNext:"~",getPrevious:"!~",getParent:"!"},(function(e,i){Element.implement(i,(function(i){return this.getElement(t(i,e))}))})),Object.forEach({getAllNext:"~",getAllPrevious:"!~",getSiblings:"~~",getChildren:">",getParents:"!"},(function(e,i){Element.implement(i,(function(i){return this.getElements(t(i,e))}))})),Element.implement({getFirst:function(e){return document.id(Slick.search(this,t(e,">"))[0])},getLast:function(e){return document.id(Slick.search(this,t(e,">")).getLast())},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(e){return document.id(Slick.find(this,"#"+(""+e).replace(/(\W)/g,"\\$1")))},match:function(e){return!e||Slick.match(this,e)}}),null==window.$$&&Window.implement("$$",(function(e){if(1==arguments.length){if("string"==typeof e)return Slick.search(this.document,e,new Elements);if(Type.isEnumerable(e))return new Elements(e)}return new Elements(arguments)}));var i={before:function(e,t){var i=t.parentNode;i&&i.insertBefore(e,t)},after:function(e,t){var i=t.parentNode;i&&i.insertBefore(e,t.nextSibling)},bottom:function(e,t){t.appendChild(e)},top:function(e,t){t.insertBefore(e,t.firstChild)}};i.inside=i.bottom;var n={},s={},o={};Array.forEach(["type","value","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","rowSpan","tabIndex","useMap"],(function(e){o[e.toLowerCase()]=e})),o.html="innerHTML",o.text=null==document.createElement("div").textContent?"innerText":"textContent",Object.forEach(o,(function(e,t){s[t]=function(t,i){t[e]=i},n[t]=function(t){return t[e]}})),s.text=(s.text,function(e,t){"style"==e.get("tag")?e.set("html",t):e[o.text]=t}),n.text=function(e){return function(t){return"style"==t.get("tag")?t.innerHTML:e(t)}}(n.text);var a={};Array.forEach(["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked","autofocus","controls","autoplay","loop"],(function(e){var t=e.toLowerCase();a[t]=e,s[t]=function(t,i){t[e]=!!i},n[t]=function(t){return!!t[e]}})),Object.append(s,{class:function(e,t){"className"in e?e.className=t||"":e.setAttribute("class",t)},for:function(e,t){"htmlFor"in e?e.htmlFor=t:e.setAttribute("for",t)},style:function(e,t){e.style?e.style.cssText=t:e.setAttribute("style",t)},value:function(e,t){e.value=null!=t?t:""}}),n.class=function(e){return"className"in e?e.className||null:e.getAttribute("class")};var r=document.createElement("button");try{r.type="button"}catch(e){}"button"!=r.type&&(s.type=function(e,t){e.setAttribute("type",t)}),r=null;var h,d,c=function(){var e=document.createElement("style"),t=!1;try{e.innerHTML="#justTesing{margin: 0px;}",t=!!e.innerHTML}catch(e){}return t}(),u=document.createElement("input");u.value="t",u.type="submit",h="t"!=u.value;try{u.value="",u.type="email",d="email"==u.type}catch(e){}u=null,(h||!d)&&(s.type=function(e,t){try{var i=e.value;e.type=t,e.value=i}catch(e){}});var m=function(e){return e.random="attribute","attribute"==e.getAttribute("random")}(document.createElement("div")),p=function(e){return e.innerHTML='<object><param name="should_fix" value="the unknown" /></object>',1!=e.cloneNode(!0).firstChild.childNodes.length}(document.createElement("div")),f=!!document.createElement("div").classList,g=function(e){var t=(e||"").clean().split(" "),i={};return t.filter((function(e){return""===e||i[e]?void 0:i[e]=e}))},v=function(e){this.classList.add(e)},y=function(e){this.classList.remove(e)};Element.implement({setProperty:function(e,t){var i,n=s[e.toLowerCase()];return n?n(this,t):(m&&(i=this.retrieve("$attributeWhiteList",{})),null==t?(this.removeAttribute(e),m&&delete i[e]):(this.setAttribute(e,""+t),m&&(i[e]=!0))),this},setProperties:function(e){for(var t in e)this.setProperty(t,e[t]);return this},getProperty:function(e){var t=n[e.toLowerCase()];if(t)return t(this);if(m){var i=this.getAttributeNode(e),s=this.retrieve("$attributeWhiteList",{});if(!i)return null;if(i.expando&&!s[e]){var o=this.outerHTML;if(o.substr(0,o.search(/\/?['"]?>(?![^<]*<['"])/)).indexOf(e)<0)return null;s[e]=!0}}var a=Slick.getAttribute(this,e);return a||Slick.hasAttribute(this,e)?a:null},getProperties:function(){var e=Array.convert(arguments);return e.map(this.getProperty,this).associate(e)},removeProperty:function(e){return this.setProperty(e,null)},removeProperties:function(){return Array.each(arguments,this.removeProperty,this),this},set:function(e,t){var i=Element.Properties[e];i&&i.set?i.set.call(this,t):this.setProperty(e,t)}.overloadSetter(),get:function(e){var t=Element.Properties[e];return t&&t.get?t.get.apply(this):this.getProperty(e)}.overloadGetter(),erase:function(e){var t=Element.Properties[e];return t&&t.erase?t.erase.apply(this):this.removeProperty(e),this},hasClass:f?function(e){return this.classList.contains(e)}:function(e){return g(this.className).contains(e)},addClass:f?function(e){return g(e).forEach(v,this),this}:function(e){return this.className=g(e+" "+this.className).join(" "),this},removeClass:f?function(e){return g(e).forEach(y,this),this}:function(e){var t=g(this.className);return g(e).forEach(t.erase,t),this.className=t.join(" "),this},toggleClass:function(e,t){return null==t&&(t=!this.hasClass(e)),t?this.addClass(e):this.removeClass(e)},adopt:function(){var e,t=this,i=Array.flatten(arguments),n=i.length;n>1&&(t=e=document.createDocumentFragment());for(var s=0;n>s;s++){var o=document.id(i[s],!0);o&&t.appendChild(o)}return e&&this.appendChild(e),this},appendText:function(e,t){return this.grab(this.getDocument().newTextNode(e),t)},grab:function(e,t){return i[t||"bottom"](document.id(e,!0),this),this},inject:function(e,t){return i[t||"bottom"](this,document.id(e,!0)),this},replaces:function(e){return(e=document.id(e,!0)).parentNode.replaceChild(this,e),this},wraps:function(e,t){return e=document.id(e,!0),this.replaces(e).grab(e,t)},getSelected:function(){return this.selectedIndex,new Elements(Array.convert(this.options).filter((function(e){return e.selected})))},toQueryString:function(){var e=[];return this.getElements("input, select, textarea").each((function(t){var i=t.type;if(t.name&&!t.disabled&&"submit"!=i&&"reset"!=i&&"file"!=i&&"image"!=i){var n="select"==t.get("tag")?t.getSelected().map((function(e){return document.id(e).get("value")})):"radio"!=i&&"checkbox"!=i||t.checked?t.get("value"):null;Array.convert(n).each((function(i){void 0!==i&&e.push(encodeURIComponent(t.name)+"="+encodeURIComponent(i))}))}})),e.join("&")}});var b={before:"beforeBegin",after:"afterEnd",bottom:"beforeEnd",top:"afterBegin",inside:"beforeEnd"};Element.implement("appendHTML","insertAdjacentHTML"in document.createElement("div")?function(e,t){return this.insertAdjacentHTML(b[t||"bottom"],e),this}:function(e,t){var n=new Element("div",{html:e}),s=n.childNodes,o=n.firstChild;if(!o)return this;if(s.length>1){o=document.createDocumentFragment();for(var a=0,r=s.length;r>a;a++)o.appendChild(s[a])}return i[t||"bottom"](o,this),this});var A={},E={},w=function(e){return E[e]||(E[e]={})},C=function(e){var t=e.uniqueNumber;return e.removeEvents&&e.removeEvents(),e.clearAttributes&&e.clearAttributes(),null!=t&&(delete A[t],delete E[t]),e},x={input:"checked",option:"selected",textarea:"value"};if(Element.implement({destroy:function(){var e=C(this).getElementsByTagName("*");return Array.each(e,C),Element.dispose(this),null},empty:function(){return Array.convert(this.childNodes).each(Element.dispose),this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},clone:function(e,t){e=!1!==e;var i,n=this.cloneNode(e),s=[n],o=[this];for(e&&(s.append(Array.convert(n.getElementsByTagName("*"))),o.append(Array.convert(this.getElementsByTagName("*")))),i=s.length;i--;){var a=s[i],r=o[i];if(t||a.removeAttribute("id"),a.clearAttributes&&(a.clearAttributes(),a.mergeAttributes(r),a.removeAttribute("uniqueNumber"),a.options))for(var l=a.options,h=r.options,d=l.length;d--;)l[d].selected=h[d].selected;var c=x[r.tagName.toLowerCase()];c&&r[c]&&(a[c]=r[c])}if(p){var u=n.getElementsByTagName("object"),m=this.getElementsByTagName("object");for(i=u.length;i--;)u[i].outerHTML=m[i].outerHTML}return document.id(n)}}),[Element,Window,Document].invoke("implement",{addListener:function(e,t){return window.attachEvent&&!window.addEventListener&&(A[Slick.uidOf(this)]=this),this.addEventListener?this.addEventListener(e,t,!!arguments[2]):this.attachEvent("on"+e,t),this},removeListener:function(e,t){return this.removeEventListener?this.removeEventListener(e,t,!!arguments[2]):this.detachEvent("on"+e,t),this},retrieve:function(e,t){var i=w(Slick.uidOf(this)),n=i[e];return null!=t&&null==n&&(n=i[e]=t),null!=n?n:null},store:function(e,t){return w(Slick.uidOf(this))[e]=t,this},eliminate:function(e){return delete w(Slick.uidOf(this))[e],this}}),window.attachEvent&&!window.addEventListener){var k=function(){Object.each(A,C),window.CollectGarbage&&CollectGarbage(),window.removeListener("unload",k)};window.addListener("unload",k)}Element.Properties={},Element.Properties.style={set:function(e){this.style.cssText=e},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}},Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}},Element.Properties.html={set:function(e){null==e?e="":"array"==typeOf(e)&&(e=e.join("")),this.styleSheet&&!c?this.styleSheet.cssText=e:this.innerHTML=e},erase:function(){this.set("html","")}};var S,I,T,D,O=document.createElement("div");if(O.innerHTML="<nav></nav>",!(I=1==O.childNodes.length)){var F="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" ");for(S=document.createDocumentFragment(),l=F.length;l--;)S.createElement(F[l])}O=null,T=Function.attempt((function(){return document.createElement("table").innerHTML="<tr><td></td></tr>",!0}));var B=document.createElement("tr"),P="<td></td>";B.innerHTML=P,D=B.innerHTML==P,B=null,T&&D&&I||(Element.Properties.html.set=function(e){var t={table:[1,"<table>","</table>"],select:[1,"<select>","</select>"],tbody:[2,"<table><tbody>","</tbody></table>"],tr:[3,"<table><tbody><tr>","</tr></tbody></table>"]};return t.thead=t.tfoot=t.tbody,function(i){if(this.styleSheet)return e.call(this,i);var n=t[this.get("tag")];if(n||I||(n=[0,"",""]),!n)return e.call(this,i);var s=n[0],o=document.createElement("div"),a=o;for(I||S.appendChild(o),o.innerHTML=[n[1],i,n[2]].flatten().join("");s--;)a=a.firstChild;this.empty().adopt(a.childNodes),I||S.removeChild(o),o=null}}(Element.Properties.html.set));var M=document.createElement("form");M.innerHTML="<select><option>s</option></select>","s"!=M.firstChild.value&&(Element.Properties.value={set:function(e){if("select"!=this.get("tag"))return this.setProperty("value",e);var t=this.getElements("option");e=String(e);for(var i=0;i<t.length;i++){var n=t[i],s=n.getAttributeNode("value");if((s&&s.specified?n.value:n.get("text"))===e)return n.selected=!0}},get:function(){var e=this,t=e.get("tag");if("select"!=t&&"option"!=t)return this.getProperty("value");if("select"==t&&!(e=e.getSelected()[0]))return"";var i=e.getAttributeNode("value");return i&&i.specified?e.value:e.get("text")}}),M=null,document.createElement("div").getAttributeNode("id")&&(Element.Properties.id={set:function(e){this.id=this.getAttributeNode("id").value=e},get:function(){return this.id||null},erase:function(){this.id=this.getAttributeNode("id").value=""}})}(),function(){var e={},t=this.DOMEvent=new Type("DOMEvent",(function(t,i){if(i||(i=window),(t=t||i.event).$extended)return t;this.event=t,this.$extended=!0,this.shift=t.shiftKey,this.control=t.ctrlKey,this.alt=t.altKey,this.meta=t.metaKey;for(var n=this.type=t.type,s=t.target||t.srcElement;s&&3==s.nodeType;)s=s.parentNode;if(this.target=document.id(s),0==n.indexOf("key")){var o=this.code=t.which||t.keyCode;this.shift&&"keypress"==n||(this.key=e[o]),("keydown"==n||"keyup"==n)&&(o>111&&124>o?this.key="f"+(o-111):o>95&&106>o&&(this.key=o-96)),null==this.key&&(this.key=String.fromCharCode(o).toLowerCase())}else if("click"==n||"dblclick"==n||"contextmenu"==n||"wheel"==n||"DOMMouseScroll"==n||0==n.indexOf("mouse")){var a=i.document;if(a=a.compatMode&&"CSS1Compat"!=a.compatMode?a.body:a.html,this.page={x:null!=t.pageX?t.pageX:t.clientX+a.scrollLeft,y:null!=t.pageY?t.pageY:t.clientY+a.scrollTop},this.client={x:null!=t.pageX?t.pageX-i.pageXOffset:t.clientX,y:null!=t.pageY?t.pageY-i.pageYOffset:t.clientY},("DOMMouseScroll"==n||"wheel"==n||"mousewheel"==n)&&(this.wheel=function(e){var t;if(e.wheelDelta)t=e.wheelDelta%120==0?e.wheelDelta/120:e.wheelDelta/12;else{var i=e.deltaY||e.detail||0;t=-(i%3==0?i/3:10*i)}return t}(t)),this.rightClick=3==t.which||2==t.button,"mouseover"==n||"mouseout"==n||"mouseenter"==n||"mouseleave"==n){for(var r="mouseover"==n||"mouseenter"==n,l=t.relatedTarget||t[(r?"from":"to")+"Element"];l&&3==l.nodeType;)l=l.parentNode;this.relatedTarget=document.id(l)}}else if(0==n.indexOf("touch")||0==n.indexOf("gesture")){this.rotation=t.rotation,this.scale=t.scale,this.targetTouches=t.targetTouches,this.changedTouches=t.changedTouches;var h=this.touches=t.touches;if(h&&h[0]){var d=h[0];this.page={x:d.pageX,y:d.pageY},this.client={x:d.clientX,y:d.clientY}}}this.client||(this.client={}),this.page||(this.page={})}));t.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){return this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0,this},preventDefault:function(){return this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1,this}}),t.defineKey=function(t,i){return e[t]=i,this},t.defineKeys=t.defineKey.overloadSetter(!0),t.defineKeys({38:"up",40:"down",37:"left",39:"right",27:"esc",32:"space",8:"backspace",9:"tab",46:"delete",13:"enter"})}(),function(){Element.Properties.events={set:function(e){this.addEvents(e)}},[Element,Window,Document].invoke("implement",{addEvent:function(e,t){var i=this.retrieve("events",{});if(i[e]||(i[e]={keys:[],values:[]}),i[e].keys.contains(t))return this;i[e].keys.push(t);var n=e,s=Element.Events[e],o=t,a=this;s&&(s.onAdd&&s.onAdd.call(this,t,e),s.condition&&(o=function(i){return!s.condition.call(this,i,e)||t.call(this,i)}),s.base&&(n=Function.convert(s.base).call(this,e)));var r=function(){return t.call(a)},l=Element.NativeEvents[n];return l&&(2==l&&(r=function(e){e=new DOMEvent(e,a.getWindow()),!1===o.call(a,e)&&e.stop()}),this.addListener(n,r,arguments[2])),i[e].values.push(r),this},removeEvent:function(e,t){var i=this.retrieve("events");if(!i||!i[e])return this;var n=i[e],s=n.keys.indexOf(t);if(-1==s)return this;var o=n.values[s];delete n.keys[s],delete n.values[s];var a=Element.Events[e];return a&&(a.onRemove&&a.onRemove.call(this,t,e),a.base&&(e=Function.convert(a.base).call(this,e))),Element.NativeEvents[e]?this.removeListener(e,o,arguments[2]):this},addEvents:function(e){for(var t in e)this.addEvent(t,e[t]);return this},removeEvents:function(e){var t;if("object"==typeOf(e)){for(t in e)this.removeEvent(t,e[t]);return this}var i=this.retrieve("events");if(!i)return this;if(e)i[e]&&(i[e].keys.each((function(t){this.removeEvent(e,t)}),this),delete i[e]);else{for(t in i)this.removeEvents(t);this.eliminate("events")}return this},fireEvent:function(e,t,i){var n=this.retrieve("events");return n&&n[e]?(t=Array.convert(t),n[e].keys.each((function(e){i?e.delay(i,this,t):e.apply(this,t)}),this),this):this},cloneEvents:function(e,t){var i=(e=document.id(e)).retrieve("events");if(!i)return this;if(t)i[t]&&i[t].keys.each((function(e){this.addEvent(t,e)}),this);else for(var n in i)this.cloneEvents(e,n);return this}}),Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,wheel:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,hashchange:1,popstate:2,pageshow:2,pagehide:2,error:1,abort:1,scroll:1,message:2},Element.Events={mousewheel:{base:"onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll"}};var e=function(e){var t=e.relatedTarget;return null==t||!!t&&t!=this&&"xul"!=t.prefix&&"document"!=typeOf(this)&&!this.contains(t)};"onmouseenter"in document.documentElement?(Element.NativeEvents.mouseenter=Element.NativeEvents.mouseleave=2,Element.MouseenterCheck=e):(Element.Events.mouseenter={base:"mouseover",condition:e},Element.Events.mouseleave={base:"mouseout",condition:e}),window.addEventListener||(Element.NativeEvents.propertychange=2,Element.Events.change={base:function(){var e=this.type;return"input"!=this.get("tag")||"radio"!=e&&"checkbox"!=e?"change":"propertychange"},condition:function(e){return"propertychange"!=e.type||"checked"==e.event.propertyName}})}(),function(){var e=!!window.addEventListener;Element.NativeEvents.focusin=Element.NativeEvents.focusout=2;var t=function(e,t,i,n,s){for(;s&&s!=e;){if(t(s,n))return i.call(s,n,s);s=document.id(s.parentNode)}},i={mouseenter:{base:"mouseover",condition:Element.MouseenterCheck},mouseleave:{base:"mouseout",condition:Element.MouseenterCheck},focus:{base:"focus"+(e?"":"in"),capture:!0},blur:{base:e?"blur":"focusout",capture:!0}},n="$delegation:",s=function(e){return{base:"focusin",remove:function(t,i){var s=t.retrieve(n+e+"listeners",{})[i];if(s&&s.forms)for(var o=s.forms.length;o--;)s.forms[o].removeEvent&&s.forms[o].removeEvent(e,s.fns[o])},listen:function(i,s,o,a,r,l){var h="form"==r.get("tag")?r:a.target.getParent("form");if(h){var d=i.retrieve(n+e+"listeners",{}),c=d[l]||{forms:[],fns:[]},u=c.forms,m=c.fns;if(-1==u.indexOf(h)){u.push(h);var p=function(e){t(i,s,o,e,r)};h.addEvent(e,p),m.push(p),d[l]=c,i.store(n+e+"listeners",d)}}}}},o=function(e){return{base:"focusin",listen:function(i,n,s,o,a){var r={blur:function(){this.removeEvents(r)}};r[e]=function(e){t(i,n,s,e,a)},o.target.addEvents(r)}}};e||Object.append(i,{submit:s("submit"),reset:s("reset"),change:o("change"),select:o("select")});var a=Element.prototype,r=a.addEvent,l=a.removeEvent,h=function(e,t){return function(i,n,s){if(-1==i.indexOf(":relay"))return e.call(this,i,n,s);var o=Slick.parse(i).expressions[0][0];if("relay"!=o.pseudos[0].key)return e.call(this,i,n,s);var a=o.tag;return o.pseudos.slice(1).each((function(e){a+=":"+e.key+(e.value?"("+e.value+")":"")})),e.call(this,i,n),t.call(this,a,o.pseudos[0].value,n)}},d={addEvent:function(e,n,s){var o=this.retrieve("$delegates",{}),a=o[e];if(a)for(var l in a)if(a[l].fn==s&&a[l].match==n)return this;var h=e,d=n,c=s,u=i[e]||{};e=u.base||h,n=function(e){return Slick.match(e,d)};var m=Element.Events[h];if(u.condition||m&&m.condition){var p=n,f=u.condition||m.condition;n=function(t,i){return p(t,i)&&f.call(t,i,e)}}var g=this,v=String.uniqueID(),y=u.listen?function(e,t){!t&&e&&e.target&&(t=e.target),t&&u.listen(g,n,s,e,t,v)}:function(e,i){!i&&e&&e.target&&(i=e.target),i&&t(g,n,s,e,i)};return a||(a={}),a[v]={match:d,fn:c,delegator:y},o[h]=a,r.call(this,e,y,u.capture)},removeEvent:function(e,t,n,s){var o,a,r=this.retrieve("$delegates",{}),h=r[e];if(!h)return this;if(s){var c=e,u=h[s].delegator,m=i[e]||{};return e=m.base||c,m.remove&&m.remove(this,s),delete h[s],r[c]=h,l.call(this,e,u,m.capture)}if(n){for(o in h)if((a=h[o]).match==t&&a.fn==n)return d.removeEvent.call(this,e,t,n,o)}else for(o in h)(a=h[o]).match==t&&d.removeEvent.call(this,e,t,a.fn,o);return this}};[Element,Window,Document].invoke("implement",{addEvent:h(r,d.addEvent),removeEvent:h(l,d.removeEvent)})}(),function(){var e,t=document.html;(e=document.createElement("div")).style.color="red",e.style.color=null;var i="red"==e.style.color,n="1px solid #123abc";e.style.border=n;var s=e.style.border!=n;e=null;var o=!!window.getComputedStyle,a=null!=document.createElement("div").style.borderRadius;Element.Properties.styles={set:function(e){this.setStyles(e)}};var r=null!=t.style.opacity,l=null!=t.style.filter,h=/alpha\(opacity=([\d.]+)\)/i,d=function(e,t,i){var n=e.style,s=n.filter||e.getComputedStyle("filter")||"";n.filter=(t.test(s)?s.replace(t,i):s+" "+i).trim(),n.filter||n.removeAttribute("filter")},c=r?function(e,t){e.style.opacity=t}:l?function(e,t){e.currentStyle&&e.currentStyle.hasLayout||(e.style.zoom=1),null==t||1==t?(d(e,h,""),1==t&&1!=u(e)&&d(e,h,"alpha(opacity=100)")):d(e,h,"alpha(opacity="+(100*t).limit(0,100).round()+")")}:function(e,t){e.store("$opacity",t),e.style.visibility=t>0||null==t?"visible":"hidden"},u=r?function(e){var t=e.style.opacity||e.getComputedStyle("opacity");return""==t?1:t.toFloat()}:l?function(e){var t,i=e.style.filter||e.getComputedStyle("filter");return i&&(t=i.match(h)),null==t||null==i?1:t[1]/100}:function(e){var t=e.retrieve("$opacity");return null==t&&(t="hidden"==e.style.visibility?0:1),t},m=null==t.style.cssFloat?"styleFloat":"cssFloat",p={left:"0%",top:"0%",center:"50%",right:"100%",bottom:"100%"},f=null!=t.style.backgroundPositionX,g=/^-(ms)-/,v=function(e){return e.replace(g,"$1-").camelCase()};Element.implement({getComputedStyle:function(e){if(!o&&this.currentStyle)return this.currentStyle[v(e)];var t=Element.getDocument(this).defaultView,i=t?t.getComputedStyle(this,null):null;return i?i.getPropertyValue(e==m?"float":e.hyphenate()):""},setStyle:function(e,t){if("opacity"==e)return null!=t&&(t=parseFloat(t)),c(this,t),this;if(e=v("float"==e?m:e),"string"!=typeOf(t)){var n=(Element.Styles[e]||"@").split(" ");t=Array.convert(t).map((function(e,t){return n[t]?"number"==typeOf(e)?n[t].replace("@",Math.round(e)):e:""})).join(" ")}else t==String(Number(t))&&(t=Math.round(t));return this.style[e]=t,(""==t||null==t)&&i&&this.style.removeAttribute&&function(e,t){"backgroundPosition"==t&&(e.removeAttribute(t+"X"),t+="Y"),e.removeAttribute(t)}(this.style,e),this},getStyle:function(e){if("opacity"==e)return u(this);if(e=v("float"==e?m:e),a&&-1!=e.indexOf("borderRadius"))return["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"].map((function(e){return this.style[e]||"0px"}),this).join(" ");var t=this.style[e];if(!t||"zIndex"==e){if(Element.ShortStyles.hasOwnProperty(e)){for(var i in t=[],Element.ShortStyles[e])t.push(this.getStyle(i));return t.join(" ")}t=this.getComputedStyle(e)}if(f&&/^backgroundPosition[XY]?$/.test(e))return t.replace(/(top|right|bottom|left)/g,(function(e){return p[e]}))||"0px";if(!t&&"backgroundPosition"==e)return"0px 0px";if(t){var n=(t=String(t)).match(/rgba?\([\d\s,]+\)/);n&&(t=t.replace(n[0],n[0].rgbToHex()))}if(!o&&!this.style[e]){if(/^(height|width)$/.test(e)&&!/px$/.test(t)){var r=0;return("width"==e?["left","right"]:["top","bottom"]).each((function(e){r+=this.getStyle("border-"+e+"-width").toInt()+this.getStyle("padding-"+e).toInt()}),this),this["offset"+e.capitalize()]-r+"px"}if(/^border(.+)Width|margin|padding/.test(e)&&isNaN(parseFloat(t)))return"0px"}return s&&/^border(Top|Right|Bottom|Left)?$/.test(e)&&/^#/.test(t)?t.replace(/^(.+)\s(.+)\s(.+)$/,"$2 $3 $1"):t},setStyles:function(e){for(var t in e)this.setStyle(t,e[t]);return this},getStyles:function(){var e={};return Array.flatten(arguments).each((function(t){e[t]=this.getStyle(t)}),this),e}}),Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundSize:"@px",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@",borderRadius:"@px @px @px @px"},Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}},["Top","Right","Bottom","Left"].each((function(e){var t=Element.ShortStyles,i=Element.Styles;["margin","padding"].each((function(n){var s=n+e;t[n][s]=i[s]="@px"}));var n="border"+e;t.border[n]=i[n]="@px @ rgb(@, @, @)";var s=n+"Width",o=n+"Style",a=n+"Color";t[n]={},t.borderWidth[s]=t[n][s]=i[s]="@px",t.borderStyle[o]=t[n][o]=i[o]="@",t.borderColor[a]=t[n][a]=i[a]="rgb(@, @, @)"})),f&&(Element.ShortStyles.backgroundPosition={backgroundPositionX:"@",backgroundPositionY:"@"})}(),function(){function e(e,t){return u(e,t).toInt()||0}function t(t){return e(t,"border-top-width")}function i(t){return e(t,"border-left-width")}function n(e){return/^(?:body|html)$/i.test(e.tagName)}function s(e){var t=e.getDocument();return t.compatMode&&"CSS1Compat"!=t.compatMode?t.body:t.html}var o=document.createElement("div"),a=document.createElement("div");o.style.height="0",o.appendChild(a);var r=a.offsetParent===o;o=a=null;var l=["height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"],h=["width","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],d=function(e){return"static"!=u(e,"position")||n(e)},c=function(e){return d(e)||/^(?:table|td|th)$/i.test(e.tagName)};Element.implement({scrollTo:function(e,t){return n(this)?this.getWindow().scrollTo(e,t):(this.scrollLeft=e,this.scrollTop=t),this},getSize:function(){if(n(this))return this.getWindow().getSize();if(!window.getComputedStyle)return{x:this.offsetWidth,y:this.offsetHeight};if("svg"==this.get("tag"))return function(e){var t=window.getComputedStyle(e),i={x:0,y:0};return l.each((function(e){i.y+=parseFloat(t[e])})),h.each((function(e){i.x+=parseFloat(t[e])})),i}(this);try{var e=this.getBoundingClientRect();return{x:e.width,y:e.height}}catch(e){return{x:0,y:0}}},getScrollSize:function(){return n(this)?this.getWindow().getScrollSize():{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){return n(this)?this.getWindow().getScroll():{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){for(var e=this.parentNode,t={x:0,y:0};e&&!n(e);)t.x+=e.scrollLeft,t.y+=e.scrollTop,e=e.parentNode;return t},getOffsetParent:r?function(){var e=this;if(n(e)||"fixed"==u(e,"position"))return null;for(var t="static"==u(e,"position")?c:d;e=e.parentNode;)if(t(e))return e;return null}:function(){var e=this;if(n(e)||"fixed"==u(e,"position"))return null;try{return e.offsetParent}catch(e){}return null},getOffsets:function(){if(this.getBoundingClientRect){var e=this.getBoundingClientRect(),t=document.id(this.getDocument().documentElement),i=t.getScroll(),s=this.getScrolls(),o="fixed"==u(this,"position");return{x:e.left.toFloat()+s.x+(o?0:i.x)-t.clientLeft,y:e.top.toFloat()+s.y+(o?0:i.y)-t.clientTop}}var a=this,r={x:0,y:0};if(n(this))return r;for(;a&&!n(a);)r.x+=a.offsetLeft,r.y+=a.offsetTop,a=a.offsetParent;return r},getPosition:function(e){var n=this.getOffsets(),s=this.getScrolls(),o={x:n.x-s.x,y:n.y-s.y};if(e&&(e=document.id(e))){var a=e.getPosition();return{x:o.x-a.x-i(e),y:o.y-a.y-t(e)}}return o},getCoordinates:function(e){if(n(this))return this.getWindow().getCoordinates();var t=this.getPosition(e),i=this.getSize(),s={left:t.x,top:t.y,width:i.x,height:i.y};return s.right=s.left+s.width,s.bottom=s.top+s.height,s},computePosition:function(t){return{left:t.x-e(this,"margin-left"),top:t.y-e(this,"margin-top")}},setPosition:function(e){return this.setStyles(this.computePosition(e))}}),[Document,Window].invoke("implement",{getSize:function(){var e=s(this);return{x:e.clientWidth,y:e.clientHeight}},getScroll:function(){var e=this.getWindow(),t=s(this);return{x:e.pageXOffset||t.scrollLeft,y:e.pageYOffset||t.scrollTop}},getScrollSize:function(){var e=s(this),t=this.getSize(),i=this.getDocument().body;return{x:Math.max(e.scrollWidth,i.scrollWidth,t.x),y:Math.max(e.scrollHeight,i.scrollHeight,t.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var e=this.getSize();return{top:0,left:0,bottom:e.y,right:e.x,height:e.y,width:e.x}}});var u=Element.getComputedStyle}(),Element.alias({position:"setPosition"}),[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}}),function(){var e=this.Fx=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{fps:60,unit:!1,duration:500,frames:null,frameSkip:!0,link:"ignore"},initialize:function(e){this.subject=this.subject||this,this.setOptions(e)},getTransition:function(){return function(e){return-(Math.cos(Math.PI*e)-1)/2}},step:function(e){if(this.options.frameSkip){var t=(null!=this.time?e-this.time:0)/this.frameInterval;this.time=e,this.frame+=t}else this.frame++;if(this.frame<this.frames){var i=this.transition(this.frame/this.frames);this.set(this.compute(this.from,this.to,i))}else this.frame=this.frames,this.set(this.compute(this.from,this.to,1)),this.stop()},set:function(e){return e},compute:function(t,i,n){return e.compute(t,i,n)},check:function(){if(!this.isRunning())return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},start:function(t,i){if(!this.check(t,i))return this;this.from=t,this.to=i,this.frame=this.options.frameSkip?0:-1,this.time=null,this.transition=this.getTransition();var n=this.options.frames,o=this.options.fps,a=this.options.duration;return this.duration=e.Durations[a]||a.toInt(),this.frameInterval=1e3/o,this.frames=n||Math.round(this.duration/this.frameInterval),"pending"!==this.getThenableState()&&this.resetThenable(this.subject),this.fireEvent("start",this.subject),s.call(this,o),this},stop:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps),this.frames==this.frame?(this.fireEvent("complete",this.subject),this.callChain()||this.fireEvent("chainComplete",this.subject)):this.fireEvent("stop",this.subject),this.resolve(this.subject===this?null:this.subject)),this},cancel:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps),this.frame=this.frames,this.fireEvent("cancel",this.subject).clearChain(),this.reject(this.subject)),this},pause:function(){return this.isRunning()&&(this.time=null,o.call(this,this.options.fps)),this},resume:function(){return this.isPaused()&&s.call(this,this.options.fps),this},isRunning:function(){var e=t[this.options.fps];return e&&e.contains(this)},isPaused:function(){return this.frame<this.frames&&!this.isRunning()}});e.compute=function(e,t,i){return(t-e)*i+e},e.Durations={short:250,normal:500,long:1e3};var t={},i={},n=function(){for(var e=Date.now(),t=this.length;t--;){var i=this[t];i&&i.step(e)}},s=function(e){var s=t[e]||(t[e]=[]);s.push(this),i[e]||(i[e]=n.periodical(Math.round(1e3/e),s))},o=function(e){var n=t[e];n&&(n.erase(this),!n.length&&i[e]&&(delete t[e],i[e]=clearInterval(i[e])))}}(),Fx.CSS=new Class({Extends:Fx,prepare:function(e,t,i){var n=(i=Array.convert(i))[0],s=i[1];if(null==s){s=n,n=e.getStyle(t);var o=this.options.unit;if(o&&n&&"string"==typeof n&&n.slice(-o.length)!=o&&0!=parseFloat(n)){e.setStyle(t,s+o);var a=e.getComputedStyle(t);if(!/px$/.test(a)&&null==(a=e.style[("pixel-"+t).camelCase()])){var r=e.style.left;e.style.left=s+o,a=e.style.pixelLeft,e.style.left=r}n=(s||1)/(parseFloat(a)||1)*(parseFloat(n)||0),e.setStyle(t,n+o)}}return{from:this.parse(n),to:this.parse(s)}},parse:function(e){return(e="string"==typeof(e=Function.convert(e)())?e.split(" "):Array.convert(e)).map((function(e){e=String(e);var t=!1;return Object.each(Fx.CSS.Parsers,(function(i){if(!t){var n=i.parse(e);(n||0===n)&&(t={value:n,parser:i})}})),t=t||{value:e,parser:Fx.CSS.Parsers.String}}))},compute:function(e,t,i){var n=[];return Math.min(e.length,t.length).times((function(s){n.push({value:e[s].parser.compute(e[s].value,t[s].value,i),parser:e[s].parser})})),n.$family=Function.convert("fx:css:value"),n},serve:function(e,t){"fx:css:value"!=typeOf(e)&&(e=this.parse(e));var i=[];return e.each((function(e){i=i.concat(e.parser.serve(e.value,t))})),i},render:function(e,t,i,n){e.setStyle(t,this.serve(i,n))},search:function(e){if(Fx.CSS.Cache[e])return Fx.CSS.Cache[e];var t={},i=new RegExp("^"+e.escapeRegExp()+"$"),n=function(e){Array.each(e,(function(e){if(e.media)n(e.rules||e.cssRules);else if(e.style){var s=e.selectorText?e.selectorText.replace(/^\w+/,(function(e){return e.toLowerCase()})):null;s&&i.test(s)&&Object.each(Element.Styles,(function(i,n){e.style[n]&&!Element.ShortStyles[n]&&(i=String(e.style[n]),t[n]=/^rgb/.test(i)?i.rgbToHex():i)}))}}))};return Array.each(document.styleSheets,(function(e){var t=e.href;if(!(t&&t.indexOf("://")>-1&&-1==t.indexOf(document.domain))){var i=e.rules||e.cssRules;n(i)}})),Fx.CSS.Cache[e]=t}}),Fx.CSS.Cache={},Fx.CSS.Parsers={Color:{parse:function(e){return e.match(/^#[0-9a-f]{3,6}$/i)?e.hexToRgb(!0):!!(e=e.match(/(\d+),\s*(\d+),\s*(\d+)/))&&[e[1],e[2],e[3]]},compute:function(e,t,i){return e.map((function(n,s){return Math.round(Fx.compute(e[s],t[s],i))}))},serve:function(e){return e.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(e,t){return t?e+t:e}},String:{parse:Function.convert(!1),compute:function(e,t){return t},serve:function(e){return e}}},Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(e,t){this.element=this.subject=document.id(e),this.parent(t)},set:function(e){for(var t in"string"==typeof e&&(e=this.search(e)),e)this.render(this.element,t,e[t],this.options.unit);return this},compute:function(e,t,i){var n={};for(var s in e)n[s]=this.parent(e[s],t[s],i);return n},start:function(e){if(!this.check(e))return this;"string"==typeof e&&(e=this.search(e));var t={},i={};for(var n in e){var s=this.prepare(this.element,n,e[n]);t[n]=s.from,i[n]=s.to}return this.parent(t,i)}}),Element.Properties.morph={set:function(e){return this.get("morph").cancel().setOptions(e),this},get:function(){var e=this.retrieve("morph");return e||(e=new Fx.Morph(this,{link:"cancel"}),this.store("morph",e)),e}},Element.implement({morph:function(e){return this.get("morph").start(e),this}}),Fx.implement({getTransition:function(){var e=this.options.transition||Fx.Transitions.Sine.easeInOut;if("string"==typeof e){var t=e.split(":");e=(e=Fx.Transitions)[t[0]]||e[t[0].capitalize()],t[1]&&(e=e["ease"+t[1].capitalize()+(t[2]?t[2].capitalize():"")])}return e}}),Fx.Transition=function(e,t){t=Array.convert(t);var i=function(i){return e(i,t)};return Object.append(i,{easeIn:i,easeOut:function(i){return 1-e(1-i,t)},easeInOut:function(i){return(.5>=i?e(2*i,t):2-e(2*(1-i),t))/2}})},Fx.Transitions={linear:function(e){return e}},Fx.Transitions.extend=function(e){for(var t in e)Fx.Transitions[t]=new Fx.Transition(e[t])},Fx.Transitions.extend({Pow:function(e,t){return Math.pow(e,t&&t[0]||6)},Expo:function(e){return Math.pow(2,8*(e-1))},Circ:function(e){return 1-Math.sin(Math.acos(e))},Sine:function(e){return 1-Math.cos(e*Math.PI/2)},Back:function(e,t){return t=t&&t[0]||1.618,Math.pow(e,2)*((t+1)*e-t)},Bounce:function(e){for(var t,i=0,n=1;;i+=n,n/=2)if(e>=(7-4*i)/11){t=n*n-Math.pow((11-6*i-11*e)/4,2);break}return t},Elastic:function(e,t){return Math.pow(2,10*--e)*Math.cos(20*e*Math.PI*(t&&t[0]||1)/3)}}),["Quad","Cubic","Quart","Quint"].each((function(e,t){Fx.Transitions[e]=new Fx.Transition((function(e){return Math.pow(e,t+2)}))})),Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(e,t){this.element=this.subject=document.id(e),this.parent(t)},set:function(e,t){return 1==arguments.length&&(t=e,e=this.property||this.options.property),this.render(this.element,e,t,this.options.unit),this},start:function(e,t,i){if(!this.check(e,t,i))return this;var n=Array.flatten(arguments);this.property=this.options.property||n.shift();var s=this.prepare(this.element,this.property,n);return this.parent(s.from,s.to)}}),Element.Properties.tween={set:function(e){return this.get("tween").cancel().setOptions(e),this},get:function(){var e=this.retrieve("tween");return e||(e=new Fx.Tween(this,{link:"cancel"}),this.store("tween",e)),e}},Element.implement({tween:function(e,t,i){return this.get("tween").start(e,t,i),this},fade:function(){var e,t,i=this.get("tween"),n=["opacity"].append(arguments);switch(null==n[1]&&(n[1]="toggle"),n[1]){case"in":e="start",n[1]=1;break;case"out":e="start",n[1]=0;break;case"show":e="set",n[1]=1;break;case"hide":e="set",n[1]=0;break;case"toggle":var s=this.retrieve("fade:flag",1==this.getStyle("opacity"));e="start",n[1]=s?0:1,this.store("fade:flag",!s),t=!0;break;default:e="start"}t||this.eliminate("fade:flag"),i[e].apply(i,n);var o=n[n.length-1];return"set"==e?this.setStyle("visibility",0==o?"hidden":"visible"):0!=o?i.$chain.length?i.chain((function(){this.element.setStyle("visibility","visible"),this.callChain()})):this.setStyle("visibility","visible"):i.chain((function(){this.element.getStyle("opacity")||(this.element.setStyle("visibility","hidden"),this.callChain())})),this},highlight:function(e,t){t||(t="transparent"==(t=this.retrieve("highlight:original",this.getStyle("background-color")))?"#fff":t);var i=this.get("tween");return i.start("background-color",e||"#ffff88",t).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original")),i.callChain()}.bind(this)),this}}),function(){var e=function(){},t="onprogress"in new Browser.Request,i=this.Request=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:!0,format:!1,method:"post",link:"ignore",isSuccess:null,emulation:!0,urlEncoded:!0,encoding:"utf-8",evalScripts:!1,evalResponse:!1,timeout:0,noCache:!1},initialize:function(e){this.xhr=new Browser.Request,this.setOptions(e),this.headers=this.options.headers},onStateChange:function(){var i=this.xhr;4==i.readyState&&this.running&&(this.running=!1,this.status=0,Function.attempt(function(){var e=i.status;this.status=1223==e?204:e}.bind(this)),i.onreadystatechange=e,t&&(i.onprogress=i.onloadstart=e),this.timer&&(clearTimeout(this.timer),delete this.timer),this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML},this.options.isSuccess.call(this,this.status)?this.success(this.response.text,this.response.xml):this.failure())},isSuccess:function(){var e=this.status;return e>=200&&300>e},isRunning:function(){return!!this.running},processScripts:function(e){return this.options.evalResponse||/(ecma|java)script/.test(this.getHeader("Content-type"))?Browser.exec(e):e.stripScripts(this.options.evalScripts)},success:function(e,t){this.onSuccess(this.processScripts(e),t),this.resolve({text:e,xml:t})},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure(),this.reject({reason:"failure",xhr:this.xhr})},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(e){this.fireEvent("loadstart",[e,this.xhr])},progress:function(e){this.fireEvent("progress",[e,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr),this.reject({reason:"timeout",xhr:this.xhr})},setHeader:function(e,t){return this.headers[e]=t,this},getHeader:function(e){return Function.attempt(function(){return this.xhr.getResponseHeader(e)}.bind(this))},check:function(){if(!this.running)return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},send:function(e){if(!this.check(e))return this;this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0;var i=typeOf(e);("string"==i||"element"==i)&&(e={data:e});var n=this.options,s=(e=Object.append({data:n.data,url:n.url,method:n.method},e)).data,o=String(e.url),a=e.method.toLowerCase();switch(typeOf(s)){case"element":s=document.id(s).toQueryString();break;case"object":case"hash":s=Object.toQueryString(s)}if(this.options.format){var r="format="+this.options.format;s=s?r+"&"+s:r}if(this.options.emulation&&!["get","post"].contains(a)){var l="_method="+a;s=s?l+"&"+s:l,a="post"}if(this.options.urlEncoded&&["post","put"].contains(a)){var h=this.options.encoding?"; charset="+this.options.encoding:"";this.headers["Content-type"]="application/x-www-form-urlencoded"+h}o||(o=document.location.pathname);var d=o.lastIndexOf("/");d>-1&&(d=o.indexOf("#"))>-1&&(o=o.substr(0,d)),this.options.noCache&&(o+=(o.indexOf("?")>-1?"&":"?")+String.uniqueID()),!s||"get"!=a&&"delete"!=a||(o+=(o.indexOf("?")>-1?"&":"?")+s,s=null);var c=this.xhr;return t&&(c.onloadstart=this.loadstart.bind(this),c.onprogress=this.progress.bind(this)),c.open(a.toUpperCase(),o,this.options.async,this.options.user,this.options.password),this.options.withCredentials&&"withCredentials"in c&&(c.withCredentials=!0),c.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,(function(e,t){try{c.setRequestHeader(t,e)}catch(i){this.fireEvent("exception",[t,e]),this.reject({reason:"exception",xhr:c,exception:i})}}),this),"pending"!==this.getThenableState()&&this.resetThenable({reason:"send"}),this.fireEvent("request"),c.send(s),this.options.async?this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)):this.onStateChange(),this},cancel:function(){if(!this.running)return this;this.running=!1;var i=this.xhr;return i.abort(),this.timer&&(clearTimeout(this.timer),delete this.timer),i.onreadystatechange=e,t&&(i.onprogress=i.onloadstart=e),this.xhr=new Browser.Request,this.fireEvent("cancel"),this.reject({reason:"cancel",xhr:i}),this}}),n={};["get","post","put","delete","patch","head","GET","POST","PUT","DELETE","PATCH","HEAD"].each((function(e){n[e]=function(t){var i={method:e};return null!=t&&(i.data=t),this.send(i)}})),i.implement(n),Element.Properties.send={set:function(e){return this.get("send").cancel().setOptions(e),this},get:function(){var e=this.retrieve("send");return e||(e=new i({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")}),this.store("send",e)),e}},Element.implement({send:function(e){var t=this.get("send");return t.send({data:this,url:e||t.options.url}),this}})}(),Request.HTML=new Class({Extends:Request,options:{update:!1,append:!1,evalScripts:!0,filter:!1,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(e){var t=this.options,i=this.response;i.html=e.stripScripts((function(e){i.javascript=e}));var n=i.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);n&&(i.html=n[1]);var s=new Element("div").set("html",i.html);if(i.tree=s.childNodes,i.elements=s.getElements(t.filter||"*"),t.filter&&(i.tree=i.elements),t.update){var o=document.id(t.update).empty();t.filter?o.adopt(i.elements):o.set("html",i.html)}else if(t.append){var a=document.id(t.append);t.filter?i.elements.reverse().inject(a):a.adopt(s.getChildren())}t.evalScripts&&Browser.exec(i.javascript),this.onSuccess(i.tree,i.elements,i.html,i.javascript),this.resolve({tree:i.tree,elements:i.elements,html:i.html,javascript:i.javascript})}}),Element.Properties.load={set:function(e){return this.get("load").cancel().setOptions(e),this},get:function(){var e=this.retrieve("load");return e||(e=new Request.HTML({data:this,link:"cancel",update:this,method:"get"}),this.store("load",e)),e}},Element.implement({load:function(){return this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString})),this}}),"undefined"==typeof JSON&&(this.JSON={}),function(){var special={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},escape=function(e){return special[e]||"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(e){return e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e)},JSON.encode=JSON.stringify?function(e){return JSON.stringify(e)}:function(e){switch(e&&e.toJSON&&(e=e.toJSON()),typeOf(e)){case"string":return'"'+e.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":return"["+e.map(JSON.encode).clean()+"]";case"object":case"hash":var t=[];return Object.each(e,(function(e,i){var n=JSON.encode(e);n&&t.push(JSON.encode(i)+":"+n)})),"{"+t+"}";case"number":case"boolean":return""+e;case"null":return"null"}return null},JSON.secure=!0,JSON.decode=function(string,secure){if(!string||"string"!=typeOf(string))return null;if(null==secure&&(secure=JSON.secure),secure){if(JSON.parse)return JSON.parse(string);if(!JSON.validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.")}return eval("("+string+")")}}(),Request.JSON=new Class({Extends:Request,options:{secure:!0},initialize:function(e){this.parent(e),Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(e){var t;try{t=this.response.json=JSON.decode(e,this.options.secure)}catch(t){return void this.fireEvent("error",[e,t])}null==t?this.failure():(this.onSuccess(t,e),this.resolve({json:t,text:e}))}});var Cookie=new Class({Implements:Options,options:{path:"/",domain:!1,duration:!1,secure:!1,document,encode:!0,httpOnly:!1},initialize:function(e,t){this.key=e,this.setOptions(t)},write:function(e){if(this.options.encode&&(e=encodeURIComponent(e)),this.options.domain&&(e+="; domain="+this.options.domain),this.options.path&&(e+="; path="+this.options.path),this.options.duration){var t=new Date;t.setTime(t.getTime()+24*this.options.duration*60*60*1e3),e+="; expires="+t.toGMTString()}return this.options.secure&&(e+="; secure"),this.options.httpOnly&&(e+="; HttpOnly"),this.options.document.cookie=this.key+"="+e,this},read:function(){var e=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return e?decodeURIComponent(e[1]):null},dispose:function(){return new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write(""),this}});Cookie.write=function(e,t,i){return new Cookie(e,i).write(t)},Cookie.read=function(e){return new Cookie(e).read()},Cookie.dispose=function(e,t){return new Cookie(e,t).dispose()},function(e,t){var i,n,s,o,a=[],r=t.createElement("div"),l=function(){clearTimeout(o),i||(Browser.loaded=i=!0,t.removeListener("DOMContentLoaded",l).removeListener("readystatechange",h),t.fireEvent("domready"),e.fireEvent("domready")),t=e=r=null},h=function(){for(var e=a.length;e--;)if(a[e]())return l(),!0;return!1},d=function(){clearTimeout(o),h()||(o=setTimeout(d,10))};t.addListener("DOMContentLoaded",l);var c=function(){try{return r.doScroll(),!0}catch(e){}return!1};r.doScroll&&!c()&&(a.push(c),s=!0),t.readyState&&a.push((function(){var e=t.readyState;return"loaded"==e||"complete"==e})),"onreadystatechange"in t?t.addListener("readystatechange",h):s=!0,s&&d(),Element.Events.domready={onAdd:function(e){i&&e.call(this)}},Element.Events.load={base:"load",onAdd:function(t){n&&this==e&&t.call(this)},condition:function(){return this==e&&(l(),delete Element.Events.load),!0}},e.addEvent("load",(function(){n=!0}))}(window,document),MooTools.More={version:"1.6.0",build:"45b71db70f879781a7e0b0d3fb3bb1307c2521eb"},function(){var e={wait:function(e){return this.chain(function(){return this.callChain.delay(null==e?500:e,this),this}.bind(this))}};Chain.implement(e),this.Fx&&Fx.implement(e),this.Element&&Element.implement&&this.Fx&&Element.implement({chains:function(e){return Array.convert(e||["tween","morph","reveal"]).each((function(e){(e=this.get(e))&&e.setOptions({link:"chain"})}),this),this},pauseFx:function(e,t){return this.chains(t).get(t||"tween").wait(e),this}})}(),Class.Mutators.Binds=function(e){return this.prototype.initialize||this.implement("initialize",(function(){})),Array.convert(e).concat(this.prototype.Binds||[])},Class.Mutators.initialize=function(e){return function(){return Array.convert(this.Binds).each((function(e){var t=this[e];t&&(this[e]=t.bind(this))}),this),e.apply(this,arguments)}},Class.Occlude=new Class({occlude:function(e,t){var i=(t=document.id(t||this.element)).retrieve(e||this.property);return i&&!this.occluded?this.occluded=i:(this.occluded=!1,t.store(e||this.property,this),this.occluded)}}),Class.refactor=function(e,t){return Object.each(t,(function(t,i){var n=e.prototype[i];n=n&&n.$origin||n||function(){},e.implement(i,"function"==typeof t?function(){var e=this.previous;this.previous=n;var i=t.apply(this,arguments);return this.previous=e,i}:t)})),e},Class.Singleton=new Class({initialize:function(e){var t,i=new Class(e);return function(){if(t)return t;(t=Object.append({},i.prototype)).constructor=i;var e=i.apply(t,arguments);return t="object"==typeof e?e:t}}}),function(){Events.Pseudos=function(e,t,i){var n="_monitorEvents:",s=function(e){return{store:e.store?function(t,i){e.store(n+t,i)}:function(t,i){(e._monitorEvents||(e._monitorEvents={}))[t]=i},retrieve:e.retrieve?function(t,i){return e.retrieve(n+t,i)}:function(t,i){return e._monitorEvents&&e._monitorEvents[t]||i}}},o=function(t){if(-1==t.indexOf(":")||!e)return null;for(var i=Slick.parse(t).expressions[0][0],n=i.pseudos,s=n.length,o=[];s--;){var a=n[s].key,r=e[a];null!=r&&o.push({event:i.tag,value:n[s].value,pseudo:a,original:t,listener:r})}return o.length?o:null};return{addEvent:function(e,i,n){var a=o(e);if(!a)return t.call(this,e,i,n);var r=s(this),l=r.retrieve(e,[]),h=a[0].event,d=Array.slice(arguments,2),c=i,u=this;return a.each((function(e){var t=e.listener,i=c;0==t?h+=":"+e.pseudo+"("+e.value+")":c=function(){t.call(u,e,i,arguments,c)}})),l.include({type:h,event:i,monitor:c}),r.store(e,l),e!=h&&t.apply(this,[e,i].concat(d)),t.apply(this,[h,c].concat(d))},removeEvent:function(e,t){var n=o(e);if(!n)return i.call(this,e,t);var a=s(this),r=a.retrieve(e);if(!r)return this;var l=Array.slice(arguments,2);return i.apply(this,[e,t].concat(l)),r.each((function(e,n){t&&e.event!=t||i.apply(this,[e.type,e.monitor].concat(l)),delete r[n]}),this),a.store(e,r),this}}};var e={once:function(e,t,i,n){t.apply(this,i),this.removeEvent(e.event,n).removeEvent(e.original,t)},throttle:function(e,t,i){t._throttled||(t.apply(this,i),t._throttled=setTimeout((function(){t._throttled=!1}),e.value||250))},pause:function(e,t,i){clearTimeout(t._pause),t._pause=t.delay(e.value||250,this,i)}};Events.definePseudo=function(t,i){return e[t]=i,this},Events.lookupPseudo=function(t){return e[t]};var t=Events.prototype;Events.implement(Events.Pseudos(e,t.addEvent,t.removeEvent)),["Request","Fx"].each((function(e){this[e]&&this[e].implement(Events.prototype)}))}(),function(){var e=this.Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,unDraggableTags:["button","input","a","textarea","select","option"],preventDefault:!1,stopPropagation:!1,compensateScroll:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var t=Array.link(arguments,{options:Type.isObject,element:function(e){return null!=e}});this.element=document.id(t.element),this.document=this.element.getDocument(),this.setOptions(t.options||{});var i=typeOf(this.options.handle);this.handles=("array"==i||"collection"==i?$$(this.options.handle):document.id(this.options.handle))||this.element,this.mouse={now:{},pos:{}},this.value={start:{},now:{}},this.offsetParent=function(e){var t=e.getOffsetParent();return!t||/^(?:body|html)$/i.test(t.tagName)?window:document.id(t)}(this.element),this.selection="selectstart"in document?"selectstart":"mousedown",this.compensateScroll={start:{},diff:{},last:{}},!("ondragstart"in document)||"FileReader"in window||e.ondragstartFixed||(document.ondragstart=Function.convert(!1),e.ondragstartFixed=!0),this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.convert(!1),scrollListener:this.scrollListener.bind(this)},this.attach()},attach:function(){return this.handles.addEvent("mousedown",this.bound.start),this.handles.addEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.addEvent("scroll",this.bound.scrollListener),this},detach:function(){return this.handles.removeEvent("mousedown",this.bound.start),this.handles.removeEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.removeEvent("scroll",this.bound.scrollListener),this},scrollListener:function(){if(this.mouse.start){var e=this.offsetParent.getScroll();if("absolute"==this.element.getStyle("position")){var t=this.sumValues(e,this.compensateScroll.last,-1);this.mouse.now=this.sumValues(this.mouse.now,t,1)}else this.compensateScroll.diff=this.sumValues(e,this.compensateScroll.start,-1);this.offsetParent!=window&&(this.compensateScroll.diff=this.sumValues(this.compensateScroll.start,e,-1)),this.compensateScroll.last=e,this.render(this.options)}},sumValues:function(e,t,i){var n={},s=this.options;for(var o in s.modifiers)s.modifiers[o]&&(n[o]=e[o]+t[o]*i);return n},start:function(e){if(!this.options.unDraggableTags.contains(e.target.get("tag"))){var t=this.options;if(!e.rightClick){t.preventDefault&&e.preventDefault(),t.stopPropagation&&e.stopPropagation(),this.compensateScroll.start=this.compensateScroll.last=this.offsetParent.getScroll(),this.compensateScroll.diff={x:0,y:0},this.mouse.start=e.page,this.fireEvent("beforeStart",this.element);var i=t.limit;this.limit={x:[],y:[]};var n,s,o=this.offsetParent==window?null:this.offsetParent;for(n in t.modifiers)if(t.modifiers[n]){var a=this.element.getStyle(t.modifiers[n]);if(a&&!a.match(/px$/)&&(s||(s=this.element.getCoordinates(o)),a=s[t.modifiers[n]]),t.style?this.value.now[n]=(a||0).toInt():this.value.now[n]=this.element[t.modifiers[n]],t.invert&&(this.value.now[n]*=-1),this.mouse.pos[n]=e.page[n]-this.value.now[n],i&&i[n])for(var r=2;r--;){var l=i[n][r];(l||0===l)&&(this.limit[n][r]="function"==typeof l?l():l)}}"number"==typeOf(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});var h={mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel};h[this.selection]=this.bound.eventStop,this.document.addEvents(h)}}},check:function(e){this.options.preventDefault&&e.preventDefault(),Math.round(Math.sqrt(Math.pow(e.page.x-this.mouse.start.x,2)+Math.pow(e.page.y-this.mouse.start.y,2)))>this.options.snap&&(this.cancel(),this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop}),this.fireEvent("start",[this.element,e]).fireEvent("snap",this.element))},drag:function(e){var t=this.options;t.preventDefault&&e.preventDefault(),this.mouse.now=this.sumValues(e.page,this.compensateScroll.diff,-1),this.render(t),this.fireEvent("drag",[this.element,e])},render:function(e){for(var t in e.modifiers)e.modifiers[t]&&(this.value.now[t]=this.mouse.now[t]-this.mouse.pos[t],e.invert&&(this.value.now[t]*=-1),e.limit&&this.limit[t]&&((this.limit[t][1]||0===this.limit[t][1])&&this.value.now[t]>this.limit[t][1]?this.value.now[t]=this.limit[t][1]:(this.limit[t][0]||0===this.limit[t][0])&&this.value.now[t]<this.limit[t][0]&&(this.value.now[t]=this.limit[t][0])),e.grid[t]&&(this.value.now[t]-=(this.value.now[t]-(this.limit[t][0]||0))%e.grid[t]),e.style?this.element.setStyle(e.modifiers[t],this.value.now[t]+e.unit):this.element[e.modifiers[t]]=this.value.now[t])},cancel:function(e){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel}),e&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(e){var t={mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop};t[this.selection]=this.bound.eventStop,this.document.removeEvents(t),this.mouse.start=null,e&&this.fireEvent("complete",[this.element,e])}})}(),Element.implement({makeResizable:function(e){var t=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},e));return this.store("resizer",t),t.addEvent("drag",function(){this.fireEvent("resize",t)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(e,t){if(this.parent(e,t),e=this.element,this.droppables=$$(this.options.droppables),this.setContainer(this.options.container),this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var i=e.getOffsetParent(),n=e.getStyles("left","top");!i||"auto"!=n.left&&"auto"!=n.top||e.setPosition(e.getPosition(i))}"static"==e.getStyle("position")&&e.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0),this.overed=null},setContainer:function(e){this.container=document.id(e),this.container&&"element"!=typeOf(this.container)&&(this.container=document.id(this.container.getDocument().body))},start:function(e){this.container&&(this.options.limit=this.calculateLimit()),this.options.precalculate&&(this.positions=this.droppables.map((function(e){return e.getCoordinates()}))),this.parent(e)},calculateLimit:function(){var e=this.element,t=this.container,i=document.id(e.getOffsetParent())||document.body,n=t.getCoordinates(i),s={},o={},a={},r={},l={},h=i.getScroll();["top","right","bottom","left"].each((function(n){s[n]=e.getStyle("margin-"+n).toInt(),o[n]=e.getStyle("border-"+n).toInt(),a[n]=t.getStyle("margin-"+n).toInt(),r[n]=t.getStyle("border-"+n).toInt(),l[n]=i.getStyle("padding-"+n).toInt()}),this);var d=e.offsetWidth+s.left+s.right,c=e.offsetHeight+s.top+s.bottom,u=0+h.x,m=0+h.y,p=n.right-r.right-d+h.x,f=n.bottom-r.bottom-c+h.y;if(this.options.includeMargins?(u+=s.left,m+=s.top):(p+=s.right,f+=s.bottom),"relative"==e.getStyle("position")){var g=e.getCoordinates(i);g.left-=e.getStyle("left").toInt(),g.top-=e.getStyle("top").toInt(),u-=g.left,m-=g.top,"relative"!=t.getStyle("position")&&(u+=r.left,m+=r.top),p+=s.left-g.left,f+=s.top-g.top,t!=i&&(u+=a.left+l.left,!l.left&&0>u&&(u=0),m+=i==document.body?0:a.top+l.top,!l.top&&0>m&&(m=0))}else u-=s.left,m-=s.top,t!=i&&(u+=n.left+r.left,m+=n.top+r.top);return{x:[u,p],y:[m,f]}},getDroppableCoordinates:function(e){var t=e.getCoordinates();if("fixed"==e.getStyle("position")){var i=window.getScroll();t.left+=i.x,t.right+=i.x,t.top+=i.y,t.bottom+=i.y}return t},checkDroppables:function(){var e=this.droppables.filter((function(e,t){e=this.positions?this.positions[t]:this.getDroppableCoordinates(e);var i=this.mouse.now;return i.x>e.left&&i.x<e.right&&i.y<e.bottom&&i.y>e.top}),this).getLast();this.overed!=e&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),e&&this.fireEvent("enter",[this.element,e]),this.overed=e)},drag:function(e){this.parent(e),this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(e){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,e]),this.overed=null,this.parent(e)}}),Element.implement({makeDraggable:function(e){var t=new Drag.Move(this,e);return this.store("dragger",t),t}}),function(){var e=function(e){return!(e&&!e.offsetHeight&&!e.offsetWidth)};Element.implement({measure:function(t){if(e(this))return t.call(this);for(var i=this.getParent(),n=[];!e(i)&&i!=document.body;)n.push(i.expose()),i=i.getParent();var s=this.expose(),o=t.call(this);return s(),n.each((function(e){e()})),o},expose:function(){if("none"!=this.getStyle("display"))return function(){};var e=this.style.cssText;return this.setStyles({display:"block",position:"absolute",visibility:"hidden"}),function(){this.style.cssText=e}.bind(this)},getDimensions:function(e){e=Object.merge({computeSize:!1},e);var t={x:0,y:0},i=function(e,t){return t.computeSize?e.getComputedSize(t):e.getSize()},n=this.getParent("body");if(n&&"none"==this.getStyle("display"))t=this.measure((function(){return i(this,e)}));else if(n)try{t=i(this,e)}catch(e){}return Object.append(t,t.x||0===t.x?{width:t.x,height:t.y}:{x:t.width,y:t.height})},getComputedSize:function(e){e=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},e);var t,i={},n={width:0,height:0};return"vertical"==e.mode?(delete n.width,delete e.planes.width):"horizontal"==e.mode&&(delete n.height,delete e.planes.height),function(e,t){var i=[];return Object.each(t,(function(t){Object.each(t,(function(t){e.each((function(e){i.push(e+"-"+t+("border"==e?"-width":""))}))}))})),i}(e.styles,e.planes).each((function(e){i[e]=this.getStyle(e).toInt()}),this),Object.each(e.planes,(function(e,s){var o=s.capitalize(),a=this.getStyle(s);"auto"!=a||t||(t=this.getDimensions()),a=i[s]="auto"==a?t[s]:a.toInt(),n["total"+o]=a,e.each((function(e){var t=function(e,t){var i=0;return Object.each(t,(function(t,n){n.test(e)&&(i+=t.toInt())})),i}(e,i);n["computed"+e.capitalize()]=t,n["total"+o]+=t}))}),this),Object.append(n,i)}})}(),function(){this.Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(e){this.setKnobPosition(e)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(e,t,i){this.setOptions(i),i=this.options,this.element=document.id(e),t=this.knob=document.id(t),this.previousChange=this.previousEnd=this.step=i.initialStep?i.initialStep:i.range?i.range[0]:0;var n={},s={x:!1,y:!1};switch(i.mode){case"vertical":this.axis="y",this.property="top",this.offset="offsetHeight";break;case"horizontal":this.axis="x",this.property="left",this.offset="offsetWidth"}this.setSliderDimensions(),this.setRange(i.range,null,!0),"static"==t.getStyle("position")&&t.setStyle("position","relative"),t.setStyle(this.property,-i.offset),s[this.axis]=this.property,n[this.axis]=[-i.offset,this.full-i.offset];var o={snap:0,limit:n,modifiers:s,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1,this.draggedKnob(),this.end()}.bind(this)};i.snap&&this.setSnap(o),this.drag=new Drag(t,o),null!=i.initialStep&&this.set(i.initialStep,!0),this.attach()},attach:function(){return this.element.addEvent("mousedown",this.clickedElement),this.options.wheel&&this.element.addEvent("mousewheel",this.scrolledElement),this.drag.attach(),this},detach:function(){return this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement),this.drag.detach(),this},autosize:function(){return this.setSliderDimensions().setKnobPosition(this.toPosition(this.step)),this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset],this.options.snap&&this.setSnap(),this},setSnap:function(e){return e||(e=this.drag.options),e.grid=Math.ceil(this.stepWidth),e.limit[this.axis][1]=this.element[this.offset],this},setKnobPosition:function(e){return this.options.snap&&(e=this.toPosition(this.step)),this.knob.setStyle(this.property,e),this},setSliderDimensions:function(){return this.full=this.element.measure(function(){return this.half=this.knob[this.offset]/2,this.element[this.offset]-this.knob[this.offset]+2*this.options.offset}.bind(this)),this},set:function(e,t){return this.range>0^e<this.min||(e=this.min),this.range>0^e>this.max||(e=this.max),this.step=e.round(this.modulus.decimalLength),t?this.checkStep().setKnobPosition(this.toPosition(this.step)):this.checkStep().fireEvent("tick",this.toPosition(this.step)).fireEvent("move").end(),this},setRange:function(e,t,i){return this.min=Array.pick([e[0],0]),this.max=Array.pick([e[1],this.options.steps]),this.range=this.max-this.min,this.steps=this.options.steps||this.full,this.stepSize=Math.abs(this.range)/this.steps,this.stepWidth=this.stepSize*this.full/Math.abs(this.range),this.setModulus(),e&&this.set(Array.pick([t,this.step]).limit(this.min,this.max),i),this},setModulus:function(){for(var e=((this.stepSize+"").split(".")[1]||[]).length,t="1";e--;)t+="0";this.modulus={multiplier:t.toInt(10),decimalLength:t.length-1}},clickedElement:function(e){if(!this.isDragging&&e.target!=this.knob){var t=this.range<0?-1:1,i=e.page[this.axis]-this.element.getPosition()[this.axis]-this.half;i=i.limit(-this.options.offset,this.full-this.options.offset),this.step=(this.min+t*this.toStep(i)).round(this.modulus.decimalLength),this.checkStep().fireEvent("tick",i).fireEvent("move").end()}},scrolledElement:function(e){var t="horizontal"==this.options.mode?e.wheel<0:e.wheel>0;this.set(this.step+(t?-1:1)*this.stepSize),e.stop()},draggedKnob:function(){var e=this.range<0?-1:1,t=this.drag.value.now[this.axis];t=t.limit(-this.options.offset,this.full-this.options.offset),this.step=(this.min+e*this.toStep(t)).round(this.modulus.decimalLength),this.checkStep(),this.fireEvent("move")},checkStep:function(){var e=this.step;return this.previousChange!=e&&(this.previousChange=e,this.fireEvent("change",e)),this},end:function(){var e=this.step;return this.previousEnd!==e&&(this.previousEnd=e,this.fireEvent("complete",e+"")),this},toStep:function(e){var t=(e+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?(t-t*this.modulus.multiplier%(this.stepSize*this.modulus.multiplier)/this.modulus.multiplier).round(this.modulus.decimalLength):t},toPosition:function(e){return this.full*Math.abs(this.min-e)/(this.steps*this.stepSize)-this.options.offset||0}})}(),function(){this.Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{},unDraggableTags:["button","input","a","textarea","select","option"]},initialize:function(e,t){this.setOptions(t),this.elements=[],this.lists=[],this.idle=!0,this.addLists($$(document.id(e)||e)),this.options.clone||(this.options.revert=!1),this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each((function(e){this.elements.push(e);var t=e.retrieve("sortables:start",function(t){this.start.call(this,t,e)}.bind(this));(this.options.handle&&e.getElement(this.options.handle)||e).addEvent("mousedown",t)}),this),this},addLists:function(){return Array.flatten(arguments).each((function(e){this.lists.include(e),this.addItems(e.getChildren())}),this),this},removeItems:function(){return $$(Array.flatten(arguments).map((function(e){this.elements.erase(e);var t=e.retrieve("sortables:start");return(this.options.handle&&e.getElement(this.options.handle)||e).removeEvent("mousedown",t),e}),this))},removeLists:function(){return $$(Array.flatten(arguments).map((function(e){return this.lists.erase(e),this.removeItems(e.getChildren()),e}),this))},getDroppableCoordinates:function(e){var t=e.getOffsetParent(),i=e.getPosition(t),n=window.getScroll(),s=t.getScroll();return i.x+=s.x,i.y+=s.y,"fixed"==t.getStyle("position")&&(i.x-=n.x,i.y-=n.y),i},getClone:function(e,t){if(!this.options.clone)return new Element(t.tagName).inject(document.body);if("function"==typeOf(this.options.clone))return this.options.clone.call(this,e,t,this.list);var i=t.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:t.getStyle("width")}).addEvent("mousedown",(function(e){t.fireEvent("mousedown",e)}));return i.get("html").test("radio")&&i.getElements("input[type=radio]").each((function(e,i){e.set("name","clone_"+i),e.get("checked")&&t.getElements("input[type=radio]")[i].set("checked",!0)})),i.inject(this.list).setPosition(this.getDroppableCoordinates(this.element))},getDroppables:function(){var e=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||e.append(this.lists).erase(this.list),e},insert:function(e,t){var i="inside";this.lists.contains(t)?(this.list=t,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(t)?"before":"after",this.element.inject(t,i),this.fireEvent("sort",[this.element,this.clone])},start:function(e,t){!this.idle||e.rightClick||!this.options.handle&&this.options.unDraggableTags.contains(e.target.get("tag"))||(this.idle=!1,this.element=t,this.opacity=t.getStyle("opacity"),this.list=t.getParent(),this.clone=this.getClone(e,t),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){e.stop(),this.clone.setStyle("visibility","visible"),this.element.setStyle("opacity",this.options.opacity||0),this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(e))},end:function(){this.drag.detach(),this.element.setStyle("opacity",this.opacity);var e=this;if(this.effect){var t=this.element.getStyles("width","height"),i=this.clone,n=i.computePosition(this.getDroppableCoordinates(i)),s=function(){this.removeEvent("cancel",s),i.destroy(),e.reset()};this.effect.element=i,this.effect.start({top:n.top,left:n.left,width:t.width,height:t.height,opacity:.25}).addEvent("cancel",s).chain(s)}else this.clone.destroy(),e.reset()},reset:function(){this.idle=!0,this.fireEvent("complete",this.element)},serialize:function(){var e=Array.link(arguments,{modifier:Type.isFunction,index:function(e){return null!=e}}),t=this.lists.map((function(t){return t.getChildren().map(e.modifier||function(e){return e.get("id")},this)}),this),i=e.index;return 1==this.lists.length&&(i=0),(i||0===i)&&i>=0&&i<this.lists.length?t[i]:t}})}(),function(){for(var e={relay:!1},t=["once","throttle","pause"],i=t.length;i--;)e[t[i]]=Events.lookupPseudo(t[i]);DOMEvent.definePseudo=function(t,i){return e[t]=i,this};var n=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(e,n.addEvent,n.removeEvent))}(),function(){var e="$moo:keys-pressed",t="$moo:keys-keyup";DOMEvent.definePseudo("keys",(function(i,n,s){var o=s[0],a=[],r=this.retrieve(e,[]),l=i.value;if("+"!=l?a.append(l.replace("++",(function(){return a.push("+"),""})).split("+")):a=["+"],r.include(o.key),a.every((function(e){return r.contains(e)}))&&n.apply(this,s),this.store(e,r),!this.retrieve(t)){var h=function(t){(function(){r=this.retrieve(e,[]).erase(t.key),this.store(e,r)}).delay(0,this)};this.store(t,h).addEvent("keyup",h)}})),DOMEvent.defineKeys({16:"shift",17:"control",18:"alt",20:"capslock",33:"pageup",34:"pagedown",35:"end",36:"home",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",107:"+",109:"-",189:"-"})}(),function(){var e={a:/[àáâãäåăą]/g,A:/[ÀÁÂÃÄÅĂĄ]/g,c:/[ćčç]/g,C:/[ĆČÇ]/g,d:/[ďđ]/g,D:/[ĎÐ]/g,e:/[èéêëěę]/g,E:/[ÈÉÊËĚĘ]/g,g:/[ğ]/g,G:/[Ğ]/g,i:/[ìíîï]/g,I:/[ÌÍÎÏ]/g,l:/[ĺľł]/g,L:/[ĹĽŁ]/g,n:/[ñňń]/g,N:/[ÑŇŃ]/g,o:/[òóôõöøő]/g,O:/[ÒÓÔÕÖØ]/g,r:/[řŕ]/g,R:/[ŘŔ]/g,s:/[ššş]/g,S:/[ŠŞŚ]/g,t:/[ťţ]/g,T:/[ŤŢ]/g,u:/[ùúûůüµ]/g,U:/[ÙÚÛŮÜ]/g,y:/[ÿý]/g,Y:/[ŸÝ]/g,z:/[žźż]/g,Z:/[ŽŹŻ]/g,th:/[þ]/g,TH:/[Þ]/g,dh:/[ð]/g,DH:/[Ð]/g,ss:/[ß]/g,oe:/[œ]/g,OE:/[Œ]/g,ae:/[æ]/g,AE:/[Æ]/g},t={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g},i={ms:1,s:1e3,m:6e4,h:36e5},n=/(\d*.?\d+)([msh]+)/,s=function(e,t){var i,n=e;for(i in t)n=n.replace(t[i],i);return n},o=function(e,t){return e=e||(t?"":"\\w+"),new RegExp(t?"<"+e+"(?!\\w)[^>]*>([\\s\\S]*?)</"+e+"(?!\\w)>":"</?"+e+"/?>|<"+e+"[\\s|/][^>]*>","gi")};String.implement({standardize:function(){return s(this,e)},repeat:function(e){return new Array(e+1).join(this)},pad:function(e,t,i){if(this.length>=e)return this;var n=(null==t?" ":""+t).repeat(e-this.length).substr(0,e-this.length);return i&&"right"!=i?"left"==i?n+this:n.substr(0,(n.length/2).floor())+this+n.substr(0,(n.length/2).ceil()):this+n},getTags:function(e,t){return this.match(o(e,t))||[]},stripTags:function(e,t){return this.replace(o(e,t),"")},tidy:function(){return s(this,t)},truncate:function(e,t,i){var n=this;if(null==t&&1==arguments.length&&(t="…"),n.length>e){if(n=n.substring(0,e),i){var s=n.lastIndexOf(i);-1!=s&&(n=n.substr(0,s))}t&&(n+=t)}return n},ms:function(){var e=n.exec(this);return null==e?Number(this):Number(e[1])*i[e[2]]}})}(),Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(e,t){return this.get("value").substring(e,t)},getSelectedText:function(){return this.setSelectionRange?this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd()):document.selection.createRange().text},getSelectedRange:function(){if(null!=this.selectionStart)return{start:this.selectionStart,end:this.selectionEnd};var e={start:0,end:0},t=this.getDocument().selection.createRange();if(!t||t.parentElement()!=this)return e;var i=t.duplicate();if("text"==this.type)e.start=0-i.moveStart("character",-1e5),e.end=e.start+t.text.length;else{var n=this.get("value"),s=n.length;i.moveToElementText(this),i.setEndPoint("StartToEnd",t),i.text.length&&(s-=n.match(/[\n\r]*$/)[0].length),e.end=s-i.text.length,i.setEndPoint("StartToStart",t),e.start=s-i.text.length}return e},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(e){return"end"==e&&(e=this.get("value").length),this.selectRange(e,e),this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(e,t){if(this.setSelectionRange)this.focus(),this.setSelectionRange(e,t);else{var i=this.get("value"),n=i.substr(e,t-e).replace(/\r/g,"").length;e=i.substr(0,e).replace(/\r/g,"").length;var s=this.createTextRange();s.collapse(!0),s.moveEnd("character",e+n),s.moveStart("character",e),s.select()}return this},insertAtCursor:function(e,t){var i=this.getSelectedRange(),n=this.get("value");return this.set("value",n.substring(0,i.start)+e+n.substring(i.end,n.length)),!1!==t?this.selectRange(i.start,i.start+e.length):this.setCaretPosition(i.start+e.length),this},insertAroundCursor:function(e,t){e=Object.append({before:"",defaultMiddle:"",after:""},e);var i=this.getSelectedText()||e.defaultMiddle,n=this.getSelectedRange(),s=this.get("value");if(n.start==n.end)this.set("value",s.substring(0,n.start)+e.before+i+e.after+s.substring(n.end,s.length)),this.selectRange(n.start+e.before.length,n.end+e.before.length+i.length);else{var o=s.substring(n.start,n.end);this.set("value",s.substring(0,n.start)+e.before+o+e.after+s.substring(n.end,s.length));var a=n.start+e.before.length;!1!==t?this.selectRange(a,a+o.length):this.setCaretPosition(a+s.length)}return this}}),function(){var e=!1,t=!1;Element.implement({pin:function(i,n){if(t||function(){var i=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);e=0===i.offsetTop,i.dispose(),t=!0}(),"none"==this.getStyle("display"))return this;var s,o,a,r=window.getScroll();if(!1!==i){if(s=this.getPosition(),!this.retrieve("pin:_pinned")){var l={top:s.y-r.y,left:s.x-r.x,margin:"0px",padding:"0px"};if(e&&!n)this.setStyle("position","fixed").setStyles(l);else{o=this.getOffsetParent();var h=this.getPosition(o),d=this.getStyles("left","top");(o&&"auto"==d.left||"auto"==d.top)&&this.setPosition(h),"static"==this.getStyle("position")&&this.setStyle("position","absolute"),h={x:d.left.toInt()-r.x,y:d.top.toInt()-r.y},a=function(){if(this.retrieve("pin:_pinned")){var e=window.getScroll();this.setStyles({left:h.x+e.x,top:h.y+e.y})}}.bind(this),this.store("pin:_scrollFixer",a),window.addEvent("scroll",a)}this.store("pin:_pinned",!0)}}else{if(!this.retrieve("pin:_pinned"))return this;"static"!=(o=this.getParent()).getComputedStyle("position")||o.getOffsetParent(),s=this.getPosition(),this.store("pin:_pinned",!1),(a=this.retrieve("pin:_scrollFixer"))?(this.store("pin:_scrollFixer",null),window.removeEvent("scroll",a)):this.setStyles({position:"absolute",top:s.y+r.y,left:s.x+r.x}),this.removeClass("isPinned")}return this},unpin:function(){return this.pin(!1)},togglePin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})}(),function(e){var t=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(e,i){return i=Object.merge({},t.options,i),t.setPositionOption(i),t.setEdgeOption(i),t.setOffsetOption(e,i),t.setDimensionsOption(e,i),i},setPositionOption:function(e){e.position=t.getCoordinateFromValue(e.position)},setEdgeOption:function(e){var i=t.getCoordinateFromValue(e.edge);e.edge=i||("center"==e.position.x&&"center"==e.position.y?{x:"center",y:"center"}:{x:"left",y:"top"})},setOffsetOption:function(e,t){var i={x:0,y:0},n={x:0,y:0},s=e.measure((function(){return document.id(this.getOffsetParent())}));s&&s!=e.getDocument().body&&(n=s.getScroll(),i=s.measure((function(){var e=this.getPosition();if("fixed"==this.getStyle("position")){var t=window.getScroll();e.x+=t.x,e.y+=t.y}return e})),t.offset={parentPositioned:s!=document.id(t.relativeTo),x:t.offset.x-i.x+n.x,y:t.offset.y-i.y+n.y})},setDimensionsOption:function(e,t){t.dimensions=e.getDimensions({computeSize:!0,styles:["padding","border","margin"]})},getPosition:function(e,i){var n={};i=t.getOptions(e,i);var s=document.id(i.relativeTo)||document.body;t.setPositionCoordinates(i,n,s),i.edge&&t.toEdge(n,i);var o=i.offset;return n.left=(n.x>=0||o.parentPositioned||i.allowNegative?n.x:0).toInt(),n.top=(n.y>=0||o.parentPositioned||i.allowNegative?n.y:0).toInt(),t.toMinMax(n,i),(i.relFixedPosition||"fixed"==s.getStyle("position"))&&t.toRelFixedPosition(s,n),i.ignoreScroll&&t.toIgnoreScroll(s,n),i.ignoreMargins&&t.toIgnoreMargins(n,i),n.left=Math.ceil(n.left),n.top=Math.ceil(n.top),delete n.x,delete n.y,n},setPositionCoordinates:function(e,t,i){var n=e.offset.y,s=e.offset.x,o=i==document.body?window.getScroll():i.getPosition(),a=o.y,r=o.x,l=window.getSize();switch(e.position.x){case"left":t.x=r+s;break;case"right":t.x=r+s+i.offsetWidth;break;default:t.x=r+(i==document.body?l.x:i.offsetWidth)/2+s}switch(e.position.y){case"top":t.y=a+n;break;case"bottom":t.y=a+n+i.offsetHeight;break;default:t.y=a+(i==document.body?l.y:i.offsetHeight)/2+n}},toMinMax:function(e,t){var i,n={left:"x",top:"y"};["minimum","maximum"].each((function(s){["left","top"].each((function(o){null!=(i=t[s]?t[s][n[o]]:null)&&("minimum"==s?e[o]<i:e[o]>i)&&(e[o]=i)}))}))},toRelFixedPosition:function(e,t){var i=window.getScroll();t.top+=i.y,t.left+=i.x},toIgnoreScroll:function(e,t){var i=e.getScroll();t.top-=i.y,t.left-=i.x},toIgnoreMargins:function(e,t){e.left+="right"==t.edge.x?t.dimensions["margin-right"]:"center"!=t.edge.x?-t.dimensions["margin-left"]:-t.dimensions["margin-left"]+(t.dimensions["margin-right"]+t.dimensions["margin-left"])/2,e.top+="bottom"==t.edge.y?t.dimensions["margin-bottom"]:"center"!=t.edge.y?-t.dimensions["margin-top"]:-t.dimensions["margin-top"]+(t.dimensions["margin-bottom"]+t.dimensions["margin-top"])/2},toEdge:function(e,t){var i={},n=t.dimensions,s=t.edge;switch(s.x){case"left":i.x=0;break;case"right":i.x=-n.x-n.computedRight-n.computedLeft;break;default:i.x=-Math.round(n.totalWidth/2)}switch(s.y){case"top":i.y=0;break;case"bottom":i.y=-n.y-n.computedTop-n.computedBottom;break;default:i.y=-Math.round(n.totalHeight/2)}e.x+=i.x,e.y+=i.y},getCoordinateFromValue:function(e){return"string"!=typeOf(e)?e:{x:(e=e.toLowerCase()).test("left")?"left":e.test("right")?"right":"center",y:e.test(/upper|top/)?"top":e.test("bottom")?"bottom":"center"}}};Element.implement({position:function(t){if(t&&(null!=t.x||null!=t.y))return e?e.apply(this,arguments):this;var i=this.setStyle("position","absolute").calculatePosition(t);return t&&t.returnPos?i:this.setStyles(i)},calculatePosition:function(e){return t.getPosition(this,e)}})}(Element.prototype.position),Elements.from=function(e,t){(t||null==t)&&(e=e.stripScripts());var i,n=e.match(/^\s*(?:<!--.*?-->\s*)*<(t[dhr]|tbody|tfoot|thead)/i);if(n){i=new Element("table");var s=n[1].toLowerCase();["td","th","tr"].contains(s)&&(i=new Element("tbody").inject(i),"tr"!=s&&(i=new Element("tr").inject(i)))}return(i||new Element("div")).set("html",e).getChildren()},function(){var e=this.IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:!1,zIndex:null,margin:0,offset:{x:0,y:0},browsers:!1},property:"IframeShim",initialize:function(e,t){return this.element=document.id(e),this.occlude()?this.occluded:(this.setOptions(t),this.makeShim(),this)},makeShim:function(){if(this.options.browsers){var t=this.element.getStyle("zIndex").toInt();if(!t){t=1;var i=this.element.getStyle("position");"static"!=i&&i||this.element.setStyle("position","relative"),this.element.setStyle("zIndex",t)}0>(t=(null!=this.options.zIndex||0===this.options.zIndex)&&t>this.options.zIndex?this.options.zIndex:t-1)&&(t=1),this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:t,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},class:this.options.className}).store("IframeShim",this);var n=function(){this.shim.inject(this.element,"after"),this[this.options.display?"show":"hide"](),this.fireEvent("inject")}.bind(this);e.ready?n():window.addEvent("load",n)}else this.position=this.hide=this.show=this.dispose=Function.convert(this)},position:function(){if(!e.ready||!this.shim)return this;var t=this.element.measure((function(){return this.getSize()}));return null!=this.options.margin&&(t.x=t.x-2*this.options.margin,t.y=t.y-2*this.options.margin,this.options.offset.x+=this.options.margin,this.options.offset.y+=this.options.margin),this.shim.set({width:t.x,height:t.y}).position({relativeTo:this.element,offset:this.options.offset}),this},hide:function(){return this.shim&&this.shim.setStyle("display","none"),this},show:function(){return this.shim&&this.shim.setStyle("display","block"),this.position()},dispose:function(){return this.shim&&this.shim.dispose(),this},destroy:function(){return this.shim&&this.shim.destroy(),this}})}(),window.addEvent("load",(function(){IframeShim.ready=!0})),function(){this.Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},class:"mask",maskMargins:!1,useIframeShim:!0,iframeShimOptions:{}},initialize:function(e,t){this.target=document.id(e)||document.id(document.body),this.target.store("mask",this),this.setOptions(t),this.render(),this.inject()},render:function(){this.element=new Element("div",{class:this.options.class,id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(e){this.fireEvent("click",e),this.options.hideOnClick&&this.hide()}.bind(this)}}),this.hidden=!0},toElement:function(){return this.element},inject:function(e,t){t=t||(this.options.inject?this.options.inject.where:"")||(this.target==document.body?"inside":"after"),e=e||this.options.inject&&this.options.inject.target||this.target,this.element.inject(e,t),this.options.useIframeShim&&(this.shim=new IframeShim(this.element,this.options.iframeShimOptions),this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)}))},position:function(){return this.resize(this.options.width,this.options.height),this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body}),this},resize:function(e,t){var i={styles:["padding","border"]};this.options.maskMargins&&i.styles.push("margin");var n=this.target.getComputedSize(i);if(this.target==document.body){this.element.setStyles({width:0,height:0});var s=window.getScrollSize();n.totalHeight<s.y&&(n.totalHeight=s.y),n.totalWidth<s.x&&(n.totalWidth=s.x)}return this.element.setStyles({width:Array.pick([e,n.totalWidth,n.x]),height:Array.pick([t,n.totalHeight,n.y])}),this},show:function(){return this.hidden?(window.addEvent("resize",this.position),this.position(),this.showMask.apply(this,arguments),this):this},showMask:function(){this.element.setStyle("display","block"),this.hidden=!1,this.fireEvent("show")},hide:function(){return this.hidden?this:(window.removeEvent("resize",this.position),this.hideMask.apply(this,arguments),this.options.destroyOnHide?this.destroy():this)},hideMask:function(){this.element.setStyle("display","none"),this.hidden=!0,this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide(),this.element.destroy(),this.fireEvent("destroy"),this.target.eliminate("mask")}})}(),Element.Properties.mask={set:function(e){var t=this.retrieve("mask");return t&&t.destroy(),this.eliminate("mask").store("mask:options",e)},get:function(){var e=this.retrieve("mask");return e||(e=new Mask(this,this.retrieve("mask:options")),this.store("mask",e)),e}},Element.implement({mask:function(e){return e&&this.set("mask",e),this.get("mask").show(),this},unmask:function(){return this.get("mask").hide(),this}}),function(){this.Spinner=new Class({Extends:this.Mask,Implements:Chain,options:{class:"spinner",containerPosition:{},content:{class:"spinner-content"},messageContainer:{class:"spinner-msg"},img:{class:"spinner-img"},fxOptions:{link:"chain"}},initialize:function(e,t){this.target=document.id(e)||document.id(document.body),this.target.store("spinner",this),this.setOptions(t),this.render(),this.inject();var i=function(){this.active=!1}.bind(this);this.addEvents({hide:i,show:i})},render:function(){this.parent(),this.element.set("id",this.options.id||"spinner-"+String.uniqueID()),this.content=document.id(this.options.content)||new Element("div",this.options.content),this.content.inject(this.element),this.options.message&&(this.msg=document.id(this.options.message)||new Element("p",this.options.messageContainer).appendText(this.options.message),this.msg.inject(this.content)),this.options.img&&(this.img=document.id(this.options.img)||new Element("div",this.options.img),this.img.inject(this.content)),this.element.set("tween",this.options.fxOptions)},show:function(e){return this.active?this.chain(this.show.bind(this)):this.hidden?(this.target.set("aria-busy","true"),this.active=!0,this.parent(e)):(this.callChain.delay(20,this),this)},showMask:function(e){var t=function(){this.content.position(Object.merge({relativeTo:this.element},this.options.containerPosition))}.bind(this);e?(this.parent(),t()):(this.options.style.opacity||(this.options.style.opacity=this.element.getStyle("opacity").toFloat()),this.element.setStyles({display:"block",opacity:0}).tween("opacity",this.options.style.opacity),t(),this.hidden=!1,this.fireEvent("show"),this.callChain())},hide:function(e){return this.active?this.chain(this.hide.bind(this)):this.hidden?(this.callChain.delay(20,this),this):(this.target.set("aria-busy","false"),this.active=!0,this.parent(e))},hideMask:function(e){return e?this.parent():void this.element.tween("opacity",0).get("tween").chain(function(){this.element.setStyle("display","none"),this.hidden=!0,this.fireEvent("hide"),this.callChain()}.bind(this))},destroy:function(){this.content.destroy(),this.parent(),this.target.eliminate("spinner")}})}(),Request=Class.refactor(Request,{options:{useSpinner:!1,spinnerOptions:{},spinnerTarget:!1},initialize:function(e){this._send=this.send,this.send=function(e){var t=this.getSpinner();return t?t.chain(this._send.pass(e,this)).show():this._send(e),this},this.previous(e)},getSpinner:function(){if(!this.spinner){var e=document.id(this.options.spinnerTarget)||document.id(this.options.update);if(this.options.useSpinner&&e){e.set("spinner",this.options.spinnerOptions);var t=this.spinner=e.get("spinner");["complete","exception","cancel"].each((function(e){this.addEvent(e,t.hide.bind(t))}),this)}}return this.spinner}}),Element.Properties.spinner={set:function(e){var t=this.retrieve("spinner");return t&&t.destroy(),this.eliminate("spinner").store("spinner:options",e)},get:function(){var e=this.retrieve("spinner");return e||(e=new Spinner(this,this.retrieve("spinner:options")),this.store("spinner",e)),e}},Element.implement({spin:function(e){return e&&this.set("spinner",e),this.get("spinner").show(),this},unspin:function(){return this.get("spinner").hide(),this}}),function(){var e=function(e){return decodeURIComponent(e.replace(/\+/g," "))};String.implement({parseQueryString:function(t,i){null==t&&(t=!0),null==i&&(i=!0);var n=this.split(/[&;]/),s={};return n.length?(n.each((function(n){var o=n.indexOf("=")+1,a=o?n.substr(o):"",r=o?n.substr(0,o-1).match(/([^\]\[]+|(\B)(?=\]))/g):[n],l=s;r&&(i&&(a=e(a)),r.each((function(i,n){t&&(i=e(i));var s=l[i];n<r.length-1?l=l[i]=s||{}:"array"==typeOf(s)?s.push(a):l[i]=null!=s?[s,a]:a})))})),s):s},cleanQueryString:function(e){return this.split("&").filter((function(t){var i=t.indexOf("="),n=0>i?"":t.substr(0,i),s=t.substr(i+1);return e?e.call(null,n,s):s||0===s})).join("&")}})}(),window.Form||(window.Form={}),Form.Request=new Class({Binds:["onSubmit","onFormValidate"],Implements:[Options,Events,Class.Occlude],options:{requestOptions:{evalScripts:!0,useSpinner:!0,emulation:!1,link:"ignore"},sendButtonClicked:!0,extraData:{},resetForm:!0},property:"form.request",initialize:function(e,t,i){return this.element=document.id(e),this.occlude()?this.occluded:void this.setOptions(i).setTarget(t).attach()},setTarget:function(e){return this.target=document.id(e),this.request?this.request.setOptions({update:this.target}):this.makeRequest(),this},toElement:function(){return this.element},makeRequest:function(){var e=this;return this.request=new Request.HTML(Object.merge({update:this.target,emulation:!1,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(t,i,n,s){["complete","success"].each((function(o){e.fireEvent(o,[e.target,t,i,n,s])}))},failure:function(){e.fireEvent("complete",arguments).fireEvent("failure",arguments)},exception:function(){e.fireEvent("failure",arguments)}}),this.attachReset()},attachReset:function(){return this.options.resetForm?(this.request.addEvent("success",function(){Function.attempt(function(){this.element.reset()}.bind(this)),window.OverText&&OverText.update()}.bind(this)),this):this},attach:function(e){var t=0!=e?"addEvent":"removeEvent";this.element[t]("click:relay(button, input[type=submit])",this.saveClickedButton.bind(this));var i=this.element.retrieve("validator");return i?i[t]("onFormValidate",this.onFormValidate):this.element[t]("submit",this.onSubmit),this},detach:function(){return this.attach(!1)},enable:function(){return this.attach()},disable:function(){return this.detach()},onFormValidate:function(e,t,i){if(i){var n=this.element.retrieve("validator");(e||n&&!n.options.stopOnFailure)&&(i.stop(),this.send())}},onSubmit:function(e){var t=this.element.retrieve("validator");return t?(this.element.removeEvent("submit",this.onSubmit),t.addEvent("onFormValidate",this.onFormValidate),void t.validate(e)):(e&&e.stop(),void this.send())},saveClickedButton:function(e,t){var i=t.get("name");i&&this.options.sendButtonClicked&&(this.options.extraData[i]=t.get("value")||!0,this.clickedCleaner=function(){delete this.options.extraData[i],this.clickedCleaner=function(){}}.bind(this))},clickedCleaner:function(){},send:function(){var e=this.element.toQueryString().trim(),t=Object.toQueryString(this.options.extraData);return e?e+="&"+t:e=t,this.fireEvent("send",[this.element,e.parseQueryString()]),this.request.send({data:e,url:this.options.requestOptions.url||this.element.get("action")}),this.clickedCleaner(),this}}),Element.implement("formUpdate",(function(e,t){var i=this.retrieve("form.request");return i?(e&&i.setTarget(e),t&&i.setOptions(t).makeRequest()):i=new Form.Request(this,e,t),i.send(),this})),Element.implement({isDisplayed:function(){return"none"!=this.getStyle("display")},isVisible:function(){var e=this.offsetWidth,t=this.offsetHeight;return(0!=e||0!=t)&&(e>0&&t>0||"none"!=this.style.display)},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var e;try{e=this.getStyle("display")}catch(e){}return"none"==e?this:this.store("element:_originalDisplay",e||"").setStyle("display","none")},show:function(e){return!e&&this.isDisplayed()?this:(e=e||this.retrieve("element:_originalDisplay")||"block",this.setStyle("display","none"==e?"block":e))},swapClass:function(e,t){return this.removeClass(e).addClass(t)}}),Document.implement({clearSelection:function(){if(window.getSelection){var e=window.getSelection();e&&e.removeAllRanges&&e.removeAllRanges()}else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(e){}}}),function(){var e=function(e){var t=e.options.hideInputs;if(window.OverText){var i=[null];OverText.each((function(e){i.include("."+e.options.labelClass)})),i&&(t+=i.join(", "))}return t?e.element.getElements(t):null};Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:"opacity"in document.documentElement,mode:"vertical",display:function(){return"tr"!=this.element.get("tag")?"block":"table-row"},opacity:1,hideInputs:"opacity"in document.documentElement?null:"select, input, textarea, object, embed"},dissolve:function(){if(this.hiding||this.showing)"chain"==this.options.link?this.chain(this.dissolve.bind(this)):"cancel"!=this.options.link||this.hiding||(this.cancel(),this.dissolve());else if("none"!=this.element.getStyle("display")){this.hiding=!0,this.showing=!1,this.hidden=!0,this.cssText=this.element.style.cssText;var t=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode});this.options.transitionOpacity&&(t.opacity=this.options.opacity);var i={};Object.each(t,(function(e,t){i[t]=[e,0]})),this.element.setStyles({display:Function.convert(this.options.display).call(this),overflow:"hidden"});var n=e(this);n&&n.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.hidden&&(this.hiding=!1,this.element.style.cssText=this.cssText,this.element.setStyle("display","none"),n&&n.setStyle("visibility","visible")),this.fireEvent("hide",this.element),this.callChain()}.bind(this)),this.start(i)}else this.callChain.delay(10,this),this.fireEvent("complete",this.element),this.fireEvent("hide",this.element);return this},reveal:function(){if(this.showing||this.hiding)"chain"==this.options.link?this.chain(this.reveal.bind(this)):"cancel"!=this.options.link||this.showing||(this.cancel(),this.reveal());else if("none"==this.element.getStyle("display")){var t;this.hiding=!1,this.showing=!0,this.hidden=!1,this.cssText=this.element.style.cssText,this.element.measure(function(){t=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode})}.bind(this)),null!=this.options.heightOverride&&(t.height=this.options.heightOverride.toInt()),null!=this.options.widthOverride&&(t.width=this.options.widthOverride.toInt()),this.options.transitionOpacity&&(this.element.setStyle("opacity",0),t.opacity=this.options.opacity);var i={height:0,display:Function.convert(this.options.display).call(this)};Object.each(t,(function(e,t){i[t]=0})),i.overflow="hidden",this.element.setStyles(i);var n=e(this);n&&n.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.element.style.cssText=this.cssText,this.element.setStyle("display",Function.convert(this.options.display).call(this)),this.hidden||(this.showing=!1),n&&n.setStyle("visibility","visible"),this.callChain(),this.fireEvent("show",this.element)}.bind(this)),this.start(t)}else this.callChain(),this.fireEvent("complete",this.element),this.fireEvent("show",this.element);return this},toggle:function(){return"none"==this.element.getStyle("display")?this.reveal():this.dissolve(),this},cancel:function(){return this.parent.apply(this,arguments),null!=this.cssText&&(this.element.style.cssText=this.cssText),this.hiding=!1,this.showing=!1,this}}),Element.Properties.reveal={set:function(e){return this.get("reveal").cancel().setOptions(e),this},get:function(){var e=this.retrieve("reveal");return e||(e=new Fx.Reveal(this),this.store("reveal",e)),e}},Element.Properties.dissolve=Element.Properties.reveal,Element.implement({reveal:function(e){return this.get("reveal").setOptions(e).reveal(),this},dissolve:function(e){return this.get("reveal").setOptions(e).dissolve(),this},nix:function(e){var t=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});return this.get("reveal").setOptions(e).dissolve().chain(function(){this[t.destroy?"destroy":"dispose"]()}.bind(this)),this},wink:function(){var e=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject}),t=this.get("reveal").setOptions(e.options);t.reveal().chain((function(){(function(){t.dissolve()}).delay(e.duration||2e3)}))}})}(),Form.Request.Append=new Class({Extends:Form.Request,options:{useReveal:!0,revealOptions:{},inject:"bottom"},makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:!1})).addEvents({success:function(e,t,i,n){var s,o=Elements.from(i);(s=1==o.length?o[0]:new Element("div",{styles:{display:"none"}}).adopt(o)).inject(this.target,this.options.inject),this.options.requestOptions.evalScripts&&Browser.exec(n),this.fireEvent("beforeEffect",s);var a=function(){this.fireEvent("success",[s,this.target,e,t,i,n])}.bind(this);this.options.useReveal?(s.set("reveal",this.options.revealOptions).get("reveal").chain(a),s.reveal()):a()}.bind(this),failure:function(e){this.fireEvent("failure",e)}.bind(this)}),this.attachReset()}}),function(){var e=function(e){return null!=e},t=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(e,i){"string"==typeof i&&(i=i.split("."));for(var n=0,s=i.length;s>n;n++){if(!t.call(e,i[n]))return null;e=e[i[n]]}return e},cleanValues:function(t,i){for(var n in i=i||e,t)i(t[n])||delete t[n];return t},erase:function(e,i){return t.call(e,i)&&delete e[i],e},run:function(e){var t=Array.slice(arguments,1);for(var i in e)e[i].apply&&e[i].apply(e,t);return e}})}(),function(){var e=null,t={},i=function(e){return instanceOf(e,n.Set)?e:t[e]},n=this.Locale={define:function(i,s,o,a){var r;return instanceOf(i,n.Set)?(r=i.name)&&(t[r]=i):(t[r=i]||(t[r]=new n.Set(r)),i=t[r]),s&&i.define(s,o,a),e||(e=i),i},use:function(t){return(t=i(t))&&(e=t,this.fireEvent("change",t)),this},getCurrent:function(){return e},get:function(t,i){return e?e.get(t,i):""},inherit:function(e,t,n){return(e=i(e))&&e.inherit(t,n),this},list:function(){return Object.keys(t)}};Object.append(n,new Events),n.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(e){this.name=e||""},define:function(e,t,i){var n=this.sets[e];return n||(n={}),t&&("object"==typeOf(t)?n=Object.merge(n,t):n[t]=i),this.sets[e]=n,this},get:function(e,i,n){var s=Object.getFromPath(this.sets,e);if(null!=s){var o=typeOf(s);return"function"==o?s=s.apply(null,Array.convert(i)):"object"==o&&(s=Object.clone(s)),s}var a=e.indexOf("."),r=0>a?e:e.substr(0,a),l=(this.inherits.sets[r]||[]).combine(this.inherits.locales).include("en-US");n||(n=[]);for(var h=0,d=l.length;d>h;h++)if(!n.contains(l[h])){n.include(l[h]);var c=t[l[h]];if(c&&null!=(s=c.get(e,i,n)))return s}return""},inherit:function(e,t){e=Array.convert(e),t&&!this.inherits.sets[t]&&(this.inherits.sets[t]=[]);for(var i=e.length;i--;)(t?this.inherits.sets[t]:this.inherits.locales).unshift(e[i]);return this}})}(),Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(e){return e>3&&21>e?"th":["th","st","nd","rd","th"][Math.min(e%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"}),function(){var e=this.Date,t=e.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"};["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each((function(t){e.Methods[t.toLowerCase()]=t}));var i=function(e,t,n){return 1==t?e:e<Math.pow(10,t-1)?(n||"0")+i(e,t-1,n):e};e.implement({set:function(e,i){e=e.toLowerCase();var n=t[e]&&"set"+t[e];return n&&this[n]&&this[n](i),this}.overloadSetter(),get:function(e){e=e.toLowerCase();var i=t[e]&&"get"+t[e];return i&&this[i]?this[i]():null}.overloadGetter(),clone:function(){return new e(this.get("time"))},increment:function(t,i){switch(i=null!=i?i:1,t=t||"day"){case"year":return this.increment("month",12*i);case"month":var n=this.get("date");return this.set("date",1).set("mo",this.get("mo")+i),this.set("date",n.min(this.get("lastdayofmonth")));case"week":return this.increment("day",7*i);case"day":return this.set("date",this.get("date")+i)}if(!e.units[t])throw new Error(t+" is not a supported interval");return this.set("time",this.get("time")+i*e.units[t]())},decrement:function(e,t){return this.increment(e,-1*(null!=t?t:1))},isLeapYear:function(){return e.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(t,i){return"string"==typeOf(t)&&(t=e.parse(t)),((t-this)/e.units[i||"day"](3,3)).round()},getLastDayOfMonth:function(){return e.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(e.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-e.UTC(this.get("year"),0,1))/e.units.day()},setDay:function(t,i){null==i&&""===(i=e.getMsg("firstDayOfWeek"))&&(i=1),t=(7+e.parseDay(t,!0)-i)%7;var n=(7+this.get("day")-i)%7;return this.increment("day",t-n)},getWeek:function(t){null==t&&""===(t=e.getMsg("firstDayOfWeek"))&&(t=1);var i,n=this,s=(7+n.get("day")-t)%7,o=0;if(1==t){var a=n.get("month"),r=n.get("date")-s;if(11==a&&r>28)return 1;0==a&&-2>r&&(n=new e(n).decrement("day",s),s=0),(i=new e(n.get("year"),0,1).get("day")||7)>4&&(o=-7)}else i=new e(n.get("year"),0,1).get("day");return o+=n.get("dayofyear"),o+=6-s,(o+=(7+i-t)%7)/7},getOrdinal:function(t){return e.getMsg("ordinal",t||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var e=this.get("timezoneOffset");return(e>0?"-":"+")+i((e.abs()/60).floor(),2)+i(e%60,2)},setAMPM:function(e){e=e.toUpperCase();var t=this.get("hr");return t>11&&"AM"==e?this.decrement("hour",12):12>t&&"PM"==e?this.increment("hour",12):this},getAMPM:function(){return this.get("hr")<12?"AM":"PM"},parse:function(t){return this.set("time",e.parse(t)),this},isValid:function(e){return e||(e=this),"date"==typeOf(e)&&!isNaN(e.valueOf())},format:function(t){if(!this.isValid())return"invalid date";if(t||(t="%x %X"),"string"==typeof t&&(t=o[t.toLowerCase()]||t),"function"==typeof t)return t(this);var n=this;return t.replace(/%([a-z%])/gi,(function(t,s){switch(s){case"a":return e.getMsg("days_abbr")[n.get("day")];case"A":return e.getMsg("days")[n.get("day")];case"b":return e.getMsg("months_abbr")[n.get("month")];case"B":return e.getMsg("months")[n.get("month")];case"c":return n.format("%a %b %d %H:%M:%S %Y");case"d":return i(n.get("date"),2);case"e":return i(n.get("date"),2," ");case"H":return i(n.get("hr"),2);case"I":return i(n.get("hr")%12||12,2);case"j":return i(n.get("dayofyear"),3);case"k":return i(n.get("hr"),2," ");case"l":return i(n.get("hr")%12||12,2," ");case"L":return i(n.get("ms"),3);case"m":return i(n.get("mo")+1,2);case"M":return i(n.get("min"),2);case"o":return n.get("ordinal");case"p":return e.getMsg(n.get("ampm"));case"s":return Math.round(n/1e3);case"S":return i(n.get("seconds"),2);case"T":return n.format("%H:%M:%S");case"U":return i(n.get("week"),2);case"w":return n.get("day");case"x":return n.format(e.getMsg("shortDate"));case"X":return n.format(e.getMsg("shortTime"));case"y":return n.get("year").toString().substr(2);case"Y":return n.get("year");case"z":return n.get("GMTOffset");case"Z":return n.get("Timezone")}return s}))},toISOString:function(){return this.format("iso8601")}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});var n=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],o={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",short:"%d %b %H:%M",long:"%B %d, %Y %H:%M",rfc822:function(e){return n[e.get("day")]+e.format(", %d ")+s[e.get("month")]+e.format(" %Y %H:%M:%S %Z")},rfc2822:function(e){return n[e.get("day")]+e.format(", %d ")+s[e.get("month")]+e.format(" %Y %H:%M:%S %z")},iso8601:function(e){return e.getUTCFullYear()+"-"+i(e.getUTCMonth()+1,2)+"-"+i(e.getUTCDate(),2)+"T"+i(e.getUTCHours(),2)+":"+i(e.getUTCMinutes(),2)+":"+i(e.getUTCSeconds(),2)+"."+i(e.getUTCMilliseconds(),3)+"Z"}},a=[],r=e.parse,l=function(t,i,n){var s=-1,o=e.getMsg(t+"s");switch(typeOf(i)){case"object":s=o[i.get(t)];break;case"number":if(!(s=o[i]))throw new Error("Invalid "+t+" index: "+i);break;case"string":var a=o.filter((function(e){return this.test(e)}),new RegExp("^"+i,"i"));if(!a.length)throw new Error("Invalid "+t+" string");if(a.length>1)throw new Error("Ambiguous "+t);s=a[0]}return n?o.indexOf(s):s},h=1900,d=70;e.extend({getMsg:function(e,t){return Locale.get("Date."+e,t)},units:{ms:Function.convert(1),second:Function.convert(1e3),minute:Function.convert(6e4),hour:Function.convert(36e5),day:Function.convert(864e5),week:Function.convert(6084e5),month:function(t,i){var n=new e;return 864e5*e.daysInMonth(null!=t?t:n.get("mo"),null!=i?i:n.get("year"))},year:function(t){return t=t||(new e).get("year"),e.isLeapYear(t)?316224e5:31536e6}},daysInMonth:function(t,i){return[31,e.isLeapYear(i)?29:28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(e){return e%4==0&&e%100!=0||e%400==0},parse:function(t){var i,n=typeOf(t);return"number"==n?new e(t):"string"!=n?t:(t=t.clean()).length?(a.some((function(e){var n=e.re.exec(t);return!!n&&(i=e.handler(n))})),i&&i.isValid()||(i=new e(r(t)))&&i.isValid()||(i=new e(t.toInt())),i):null},parseDay:function(e,t){return l("day",e,t)},parseMonth:function(e,t){return l("month",e,t)},parseUTC:function(t){var i=new e(t),n=e.UTC(i.get("year"),i.get("mo"),i.get("date"),i.get("hr"),i.get("min"),i.get("sec"),i.get("ms"));return new e(n)},orderIndex:function(t){return e.getMsg("dateOrder").indexOf(t)+1},defineFormat:function(e,t){return o[e]=t,this},defineParser:function(e){return a.push(e.re&&e.handler?e:f(e)),this},defineParsers:function(){return Array.flatten(arguments).each(e.defineParser),this},define2DigitYearStart:function(e){return h=e-(d=e%100),this}}).extend({defineFormats:e.defineFormat.overloadSetter()});var c=function(t){return new RegExp("(?:"+e.getMsg(t).map((function(e){return e.substr(0,3)})).join("|")+")[a-z]*")},u=function(t){switch(t){case"T":return"%H:%M:%S";case"x":return(1==e.orderIndex("month")?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null},m={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};m.m=m.I,m.S=m.M;var p,f=function(t){if(!p)return{format:t};var i=[],n=(t.source||t).replace(/%([a-z])/gi,(function(e,t){return u(t)||e})).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,(function(e,t){var n=m[t];return n?(i.push(t),"("+n.source+")"):t})).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:t,re:new RegExp("^"+n+"$","i"),handler:function(t){t=t.slice(1).associate(i);var n=(new e).clearTime(),s=t.y||t.Y;for(var o in null!=s&&g.call(n,"y",s),"d"in t&&g.call(n,"d",1),("m"in t||t.b||t.B)&&g.call(n,"m",1),t)g.call(n,o,t[o]);return n}}},g=function(t,i){if(!i)return this;switch(t){case"a":case"A":return this.set("day",e.parseDay(i,!0));case"b":case"B":return this.set("mo",e.parseMonth(i,!0));case"d":return this.set("date",i);case"H":case"I":return this.set("hr",i);case"m":return this.set("mo",i-1);case"M":return this.set("min",i);case"p":return this.set("ampm",i.replace(/\./g,""));case"S":return this.set("sec",i);case"s":return this.set("ms",1e3*("0."+i));case"w":return this.set("day",i);case"Y":return this.set("year",i);case"y":return 100>(i=+i)&&(i+=h+(d>i?100:0)),this.set("year",i);case"z":"Z"==i&&(i="+00");var n=i.match(/([+-])(\d{2}):?(\d{2})?/);return n=(n[1]+"1")*(60*n[2]+(+n[3]||0))+this.getTimezoneOffset(),this.set("time",this-6e4*n)}return this};e.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?"),Locale.addEvent("change",(function(e){Locale.get("Date")&&function(e){p=e,m.a=m.A=c("days"),m.b=m.B=c("months"),a.each((function(e,t){e.format&&(a[t]=f(e.format))}))}(e)})).fireEvent("change",Locale.getCurrent())}(),Locale.define("en-US","FormValidator",{required:"This field is required.",length:"Please enter {length} characters (you entered {elLength} characters)",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use only letters (a-z) within this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.example.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currentDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."}),window.Form||(window.Form={});var InputValidator=this.InputValidator=new Class({Implements:[Options],options:{errorMsg:"Validation failed.",test:Function.convert(!0)},initialize:function(e,t){this.setOptions(t),this.className=e},test:function(e,t){return!!(e=document.id(e))&&this.options.test(e,t||this.getProps(e))},getError:function(e,t){e=document.id(e);var i=this.options.errorMsg;return"function"==typeOf(i)&&(i=i(e,t||this.getProps(e))),i},getProps:function(e){return(e=document.id(e))?e.get("validatorProps"):{}}});if(Element.Properties.validators={get:function(){return(this.get("data-validators")||this.className).clean().replace(/'(\\.|[^'])*'|"(\\.|[^"])*"/g,(function(e){return e.replace(" ","\\x20")})).split(" ")}},Element.Properties.validatorProps={set:function(e){return this.eliminate("$moo:validatorProps").store("$moo:validatorProps",e)},get:function(e){if(e&&this.set(e),this.retrieve("$moo:validatorProps"))return this.retrieve("$moo:validatorProps");if(this.getProperty("data-validator-properties")||this.getProperty("validatorProps"))try{this.store("$moo:validatorProps",JSON.decode(this.getProperty("validatorProps")||this.getProperty("data-validator-properties"),!1))}catch(e){return{}}else{var t=this.get("validators").filter((function(e){return e.test(":")}));t.length?(e={},t.each((function(t){var i=t.split(":");if(i[1])try{e[i[0]]=JSON.decode(i[1],!1)}catch(e){}})),this.store("$moo:validatorProps",e)):this.store("$moo:validatorProps",{})}return this.retrieve("$moo:validatorProps")}},Form.Validator=new Class({Implements:[Options,Events],options:{fieldSelectors:"input, select, textarea",ignoreHidden:!0,ignoreDisabled:!0,useTitles:!1,evaluateOnSubmit:!0,evaluateFieldsOnBlur:!0,evaluateFieldsOnChange:!0,serial:!0,stopOnFailure:!0,warningPrefix:function(){return Form.Validator.getMsg("warningPrefix")||"Warning: "},errorPrefix:function(){return Form.Validator.getMsg("errorPrefix")||"Error: "}},initialize:function(e,t){this.setOptions(t),this.element=document.id(e),this.warningPrefix=Function.convert(this.options.warningPrefix)(),this.errorPrefix=Function.convert(this.options.errorPrefix)(),this._bound={onSubmit:this.onSubmit.bind(this),blurOrChange:function(e,t){this.validationMonitor(t,!0)}.bind(this)},this.enable()},toElement:function(){return this.element},getFields:function(){return this.fields=this.element.getElements(this.options.fieldSelectors)},enable:function(){this.element.store("validator",this),this.options.evaluateOnSubmit&&this.element.addEvent("submit",this._bound.onSubmit),this.options.evaluateFieldsOnBlur&&this.element.addEvent("blur:relay(input,select,textarea)",this._bound.blurOrChange),this.options.evaluateFieldsOnChange&&this.element.addEvent("change:relay(input,select,textarea)",this._bound.blurOrChange)},disable:function(){this.element.eliminate("validator"),this.element.removeEvents({submit:this._bound.onSubmit,"blur:relay(input,select,textarea)":this._bound.blurOrChange,"change:relay(input,select,textarea)":this._bound.blurOrChange})},validationMonitor:function(){clearTimeout(this.timer),this.timer=this.validateField.delay(50,this,arguments)},onSubmit:function(e){this.validate(e)&&this.reset()},reset:function(){return this.getFields().each(this.resetField,this),this},validate:function(e){var t=this.getFields().map((function(e){return this.validateField(e,!0)}),this).every((function(e){return e}));return this.fireEvent("formValidate",[t,this.element,e]),this.options.stopOnFailure&&!t&&e&&e.preventDefault(),t},validateField:function(e,t){if(this.paused)return!0;var i,n,s=!(e=document.id(e)).hasClass("validation-failed");if(this.options.serial&&!t&&(i=this.element.getElement(".validation-failed"),n=this.element.getElement(".warning")),e&&(!i||t||e.hasClass("validation-failed")||i&&!this.options.serial)){var o=e.get("validators"),a=o.some((function(e){return this.getValidator(e)}),this),r=[];o.each((function(t){t&&!this.test(t,e)&&r.include(t)}),this),s=0===r.length,a&&!this.hasValidator(e,"warnOnly")&&(s?(e.addClass("validation-passed").removeClass("validation-failed"),this.fireEvent("elementPass",[e])):(e.addClass("validation-failed").removeClass("validation-passed"),this.fireEvent("elementFail",[e,r]))),n||(o.some((function(e){return e.test("^warn")?this.getValidator(e.replace(/^warn-/,"")):null}),this),e.removeClass("warning"),o.map((function(t){return t.test("^warn")?this.test(t.replace(/^warn-/,""),e,!0):null}),this))}return s},test:function(e,t,i){if(t=document.id(t),this.options.ignoreHidden&&!t.isVisible()||this.options.ignoreDisabled&&t.get("disabled"))return!0;var n=this.getValidator(e);null!=i&&(i=!1),this.hasValidator(t,"warnOnly")&&(i=!0);var s=t.hasClass("ignoreValidation")||!n||n.test(t);return n&&this.fireEvent("elementValidate",[s,t,e,i]),!!i||s},hasValidator:function(e,t){return e.get("validators").contains(t)},resetField:function(e){return(e=document.id(e))&&e.get("validators").each((function(t){t.test("^warn-")&&(t=t.replace(/^warn-/,"")),e.removeClass("validation-failed"),e.removeClass("warning"),e.removeClass("validation-passed")}),this),this},stop:function(){return this.paused=!0,this},start:function(){return this.paused=!1,this},ignoreField:function(e,t){return(e=document.id(e))&&(this.enforceField(e),t?e.addClass("warnOnly"):e.addClass("ignoreValidation")),this},enforceField:function(e){return(e=document.id(e))&&e.removeClass("warnOnly").removeClass("ignoreValidation"),this}}),Form.Validator.getMsg=function(e){return Locale.get("FormValidator."+e)},Form.Validator.adders={validators:{},add:function(e,t){this.validators[e]=new InputValidator(e,t),this.initialize||this.implement({validators:this.validators})},addAllThese:function(e){Array.convert(e).each((function(e){this.add(e[0],e[1])}),this)},getValidator:function(e){return this.validators[e.split(":")[0]]}},Object.append(Form.Validator,Form.Validator.adders),Form.Validator.implement(Form.Validator.adders),Form.Validator.add("IsEmpty",{errorMsg:!1,test:function(e){return"select-one"==e.type||"select"==e.type?!(e.selectedIndex>=0&&""!=e.options[e.selectedIndex].value):null==e.get("value")||0==e.get("value").length}}),Form.Validator.addAllThese([["required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(e){return!Form.Validator.getValidator("IsEmpty").test(e)}}],["length",{errorMsg:function(e,t){return"null"!=typeOf(t.length)?Form.Validator.getMsg("length").substitute({length:t.length,elLength:e.get("value").length}):""},test:function(e,t){return"null"==typeOf(t.length)||e.get("value").length==t.length||0==e.get("value").length}}],["minLength",{errorMsg:function(e,t){return"null"!=typeOf(t.minLength)?Form.Validator.getMsg("minLength").substitute({minLength:t.minLength,length:e.get("value").length}):""},test:function(e,t){return"null"==typeOf(t.minLength)||e.get("value").length>=(t.minLength||0)}}],["maxLength",{errorMsg:function(e,t){return"null"!=typeOf(t.maxLength)?Form.Validator.getMsg("maxLength").substitute({maxLength:t.maxLength,length:e.get("value").length}):""},test:function(e,t){return e.get("value").length<=(t.maxLength||1e4)}}],["validate-integer",{errorMsg:Form.Validator.getMsg.pass("integer"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(-?[1-9]\d*|0)$/.test(e.get("value"))}}],["validate-numeric",{errorMsg:Form.Validator.getMsg.pass("numeric"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(e.get("value"))}}],["validate-digits",{errorMsg:Form.Validator.getMsg.pass("digits"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^[\d() .:\-\+#]+$/.test(e.get("value"))}}],["validate-alpha",{errorMsg:Form.Validator.getMsg.pass("alpha"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^[a-zA-Z]+$/.test(e.get("value"))}}],["validate-alphanum",{errorMsg:Form.Validator.getMsg.pass("alphanum"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||!/\W/.test(e.get("value"))}}],["validate-date",{errorMsg:function(e,t){if(Date.parse){var i=t.dateFormat||"%x";return Form.Validator.getMsg("dateSuchAs").substitute({date:(new Date).format(i)})}return Form.Validator.getMsg("dateInFormatMDY")},test:function(e,t){if(Form.Validator.getValidator("IsEmpty").test(e))return!0;var i=Locale.get("Date"),n=new RegExp([i.days,i.days_abbr,i.months,i.months_abbr,i.AM,i.PM].flatten().join("|"),"i"),s=e.get("value"),o=s.match(/[a-z]+/gi);if(o&&!o.every(n.exec,n))return!1;var a=Date.parse(s);if(!a)return!1;var r=t.dateFormat||"%x",l=a.format(r);return"invalid date"!=l&&e.set("value",l),a.isValid()}}],["validate-email",{errorMsg:Form.Validator.getMsg.pass("email"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i.test(e.get("value"))}}],["validate-url",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(e.get("value"))}}],["validate-currency-dollar",{errorMsg:Form.Validator.getMsg.pass("currencyDollar"),test:function(e){return Form.Validator.getValidator("IsEmpty").test(e)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(e.get("value"))}}],["validate-one-required",{errorMsg:Form.Validator.getMsg.pass("oneRequired"),test:function(e,t){return(document.id(t["validate-one-required"])||e.getParent(t["validate-one-required"])).getElements("input").some((function(e){return["checkbox","radio"].contains(e.get("type"))?e.get("checked"):e.get("value")}))}}]]),Element.Properties.validator={set:function(e){this.get("validator").setOptions(e)},get:function(){var e=this.retrieve("validator");return e||(e=new Form.Validator(this),this.store("validator",e)),e}},Element.implement({validate:function(e){return e&&this.set("validator",e),this.get("validator").validate()}}),function(){function e(e,t,i,n){if(t&&e[t])return e[t];var s=document.id(e[i]);return s?s.getElements(n):[]}Form.Validator.addAllThese([["validate-enforce-oncheck",{test:function(t,i){var n=t.getParent("form").retrieve("validator");return!n||(e(i,"toEnforce","enforceChildrenOf","input, select, textarea").each((function(e){t.checked?n.enforceField(e):(n.ignoreField(e),n.resetField(e))})),!0)}}],["validate-ignore-oncheck",{test:function(t,i){var n=t.getParent("form").retrieve("validator");return!n||(e(i,"toIgnore","ignoreChildrenOf","input, select, textarea").each((function(e){t.checked?(n.ignoreField(e),n.resetField(e)):n.enforceField(e)})),!0)}}],["validate-enforce-onselect-value",{test:function(t,i){if(!i.value)return!0;var n=t.getParent("form").retrieve("validator");return!n||(e(i,"toEnforce","enforceChildrenOf","input, select, textarea").each((function(e){i.value==t.value?n.enforceField(e):(n.ignoreField(e),n.resetField(e))})),!0)}}],["validate-nospace",{errorMsg:function(){return Form.Validator.getMsg("noSpace")},test:function(e,t){return!e.get("value").test(/\s/)}}],["validate-toggle-oncheck",{test:function(t,i){var n=t.getParent("form").retrieve("validator");if(!n)return!0;var s=e(i,"toToggle","toToggleChildrenOf","input, select, textarea");return t.checked?s.each((function(e){n.enforceField(e)})):s.each((function(e){n.ignoreField(e),n.resetField(e)})),!0}}],["validate-reqchk-bynode",{errorMsg:function(){return Form.Validator.getMsg("reqChkByNode")},test:function(t,i){return e(i,!1,"nodeId",i.selector||"input[type=checkbox], input[type=radio]").some((function(e){return e.checked}))}}],["validate-required-check",{errorMsg:function(e,t){return t.useTitle?e.get("title"):Form.Validator.getMsg("requiredChk")},test:function(e,t){return!!e.checked}}],["validate-reqchk-byname",{errorMsg:function(e,t){return Form.Validator.getMsg("reqChkByName").substitute({label:t.label||e.get("type")})},test:function(e,t){var i=t.groupName||e.get("name"),n=$$("[name="+i+"]"),s=n.some((function(e,t){return e.checked})),o=e.getParent("form").retrieve("validator");return s&&o&&n.each((function(e,t){o.resetField(e)})),s}}],["validate-match",{errorMsg:function(e,t){return Form.Validator.getMsg("match").substitute({matchName:decodeURIComponent((t.matchName+"").replace(/\+/g,"%20"))||document.id(t.matchInput).get("name")})},test:function(e,t){var i=e.get("value"),n=document.id(t.matchInput)&&document.id(t.matchInput).get("value");return!i||!n||i==n}}],["validate-after-date",{errorMsg:function(e,t){return Form.Validator.getMsg("afterDate").substitute({label:t.afterLabel||(t.afterElement?Form.Validator.getMsg("startDate"):Form.Validator.getMsg("currentDate"))})},test:function(e,t){var i=document.id(t.afterElement)?Date.parse(document.id(t.afterElement).get("value")):new Date,n=Date.parse(e.get("value"));return!n||!i||n>=i}}],["validate-before-date",{errorMsg:function(e,t){return Form.Validator.getMsg("beforeDate").substitute({label:t.beforeLabel||(t.beforeElement?Form.Validator.getMsg("endDate"):Form.Validator.getMsg("currentDate"))})},test:function(e,t){var i=Date.parse(e.get("value")),n=document.id(t.beforeElement)?Date.parse(document.id(t.beforeElement).get("value")):new Date;return!n||!i||n>=i}}],["validate-custom-required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(e,t){return e.get("value")!=t.emptyValue}}],["validate-same-month",{errorMsg:function(e,t){var i=document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value");return""!=e.get("value")?Form.Validator.getMsg(i?"sameMonth":"startMonth"):void 0},test:function(e,t){var i=Date.parse(e.get("value")),n=Date.parse(document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value"));return!i||!n||i.format("%B")==n.format("%B")}}],["validate-cc-num",{errorMsg:function(e){var t=e.get("value").replace(/[^0-9]/g,"");return Form.Validator.getMsg("creditcard").substitute({length:t.length})},test:function(e){if(Form.Validator.getValidator("IsEmpty").test(e))return!0;var t=e.get("value"),i=!1;if((t=t.replace(/[^0-9]/g,"")).test(/^4[0-9]{12}([0-9]{3})?$/)?i="Visa":t.test(/^5[1-5]([0-9]{14})$/)?i="Master Card":t.test(/^3[47][0-9]{13}$/)?i="American Express":t.test(/^6(?:011|5[0-9]{2})[0-9]{12}$/)?i="Discover":t.test(/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/)&&(i="Diners Club"),i){for(var n=0,s=0,o=t.length-1;o>=0;--o)0!=(s=t.charAt(o).toInt())&&((t.length-o)%2==0&&(s+=s),s>9&&(s=s.toString().charAt(0).toInt()+s.toString().charAt(1).toInt()),n+=s);if(n%10==0)return!0}for(var a="";""!=t;)a+=" "+t.substr(0,4),t=t.substr(4);return e.getParent("form").retrieve("validator").ignoreField(e),e.set("value",a.clean()),e.getParent("form").retrieve("validator").enforceField(e),!1}}]])}(),Form.Validator.Inline=new Class({Extends:Form.Validator,options:{showError:function(e){e.reveal?e.reveal():e.setStyle("display","block")},hideError:function(e){e.dissolve?e.dissolve():e.setStyle("display","none")},scrollToErrorsOnSubmit:!0,scrollToErrorsOnBlur:!1,scrollToErrorsOnChange:!1,scrollFxOptions:{transition:"quad:out",offset:{y:-20}}},initialize:function(e,t){this.parent(e,t),this.addEvent("onElementValidate",(function(e,t,i,n){var s=this.getValidator(i);if(!e&&s.getError(t)){n&&t.addClass("warning");var o=this.makeAdvice(i,t,s.getError(t),n);this.insertAdvice(o,t),this.showAdvice(i,t)}else this.hideAdvice(i,t)}))},makeAdvice:function(e,t,i,n){var s=n?this.warningPrefix:this.errorPrefix;s+=this.options.useTitles&&t.title||i;var o=n?"warning-advice":"validation-advice",a=this.getAdvice(e,t);return a=a?a.set("html",s):new Element("div",{html:s,styles:{display:"none"},id:"advice-"+e.split(":")[0]+"-"+this.getFieldId(t)}).addClass(o),t.store("$moo:advice-"+e,a),a},getFieldId:function(e){return e.id?e.id:e.id="input_"+e.name},showAdvice:function(e,t){var i=this.getAdvice(e,t);!i||t.retrieve("$moo:"+this.getPropName(e))||"none"!=i.getStyle("display")&&"hidden"!=i.getStyle("visibility")&&0!=i.getStyle("opacity")||(t.store("$moo:"+this.getPropName(e),!0),this.options.showError(i),this.fireEvent("showAdvice",[t,i,e]))},hideAdvice:function(e,t){var i=this.getAdvice(e,t);i&&t.retrieve("$moo:"+this.getPropName(e))&&(t.store("$moo:"+this.getPropName(e),!1),this.options.hideError(i),this.fireEvent("hideAdvice",[t,i,e]))},getPropName:function(e){return"advice"+e},resetField:function(e){return(e=document.id(e))?(this.parent(e),e.get("validators").each((function(t){this.hideAdvice(t,e)}),this),this):this},getAllAdviceMessages:function(e,t){var i=[];return e.hasClass("ignoreValidation")&&!t||e.get("validators").some((function(t){var n=t.test("^warn-")||e.hasClass("warnOnly");n&&(t=t.replace(/^warn-/,""));var s=this.getValidator(t);s&&i.push({message:s.getError(e),warnOnly:n,passed:s.test(),validator:s})}),this),i},getAdvice:function(e,t){return t.retrieve("$moo:advice-"+e)},insertAdvice:function(e,t){var i=t.get("validatorProps");i.msgPos&&document.id(i.msgPos)?document.id(i.msgPos).grab(e):t.type&&"radio"==t.type.toLowerCase()?t.getParent().adopt(e):e.inject(document.id(t),"after")},validateField:function(e,t,i){var n=this.parent(e,t);if((this.options.scrollToErrorsOnSubmit&&null==i||i)&&!n){for(var s=document.id(this).getElement(".validation-failed"),o=document.id(this).getParent();o!=document.body&&o.getScrollSize().y==o.getSize().y;)o=o.getParent();var a=o.retrieve("$moo:fvScroller");!a&&window.Fx&&Fx.Scroll&&(a=new Fx.Scroll(o,this.options.scrollFxOptions),o.store("$moo:fvScroller",a)),s&&(a?a.toElement(s):o.scrollTo(o.getScroll().x,s.getPosition(o).y-20))}return n},watchFields:function(e){e.each((function(e){this.options.evaluateFieldsOnBlur&&e.addEvent("blur",this.validationMonitor.pass([e,!1,this.options.scrollToErrorsOnBlur],this)),this.options.evaluateFieldsOnChange&&e.addEvent("change",this.validationMonitor.pass([e,!0,this.options.scrollToErrorsOnChange],this))}),this)}}),Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(e,t){this.elements=this.subject=$$(e),this.parent(t)},compute:function(e,t,i){var n={};for(var s in e){var o=e[s],a=t[s],r=n[s]={};for(var l in o)r[l]=this.parent(o[l],a[l],i)}return n},set:function(e){for(var t in e)if(this.elements[t]){var i=e[t];for(var n in i)this.render(this.elements[t],n,i[n],this.options.unit)}return this},start:function(e){if(!this.check(e))return this;var t={},i={};for(var n in e)if(this.elements[n]){var s=e[n],o=t[n]={},a=i[n]={};for(var r in s){var l=this.prepare(this.elements[n],r,s[r]);o[r]=l.from,a[r]=l.to}}return this.parent(t,i)}}),Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:!1,fixedWidth:!1,display:0,show:!1,height:!0,width:!1,opacity:!0,alwaysHide:!1,trigger:"click",initialDisplayFx:!0,resetHeight:!0,keepOpen:!1},initialize:function(){var e=function(e){return null!=e},t=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:e,elements:e});this.parent(t.elements,t.options);var i=this.options,n=this.togglers=$$(t.togglers);this.previous=-1,this.internalChain=new Chain,i.alwaysHide&&(this.options.link="chain"),(i.show||0===this.options.show)&&(i.display=!1,this.previous=i.show),i.start&&(i.display=!1,i.show=!1);var s=this.effects={};i.opacity&&(s.opacity="fullOpacity"),i.width&&(s.width=i.fixedWidth?"fullWidth":"offsetWidth"),i.height&&(s.height=i.fixedHeight?"fullHeight":"scrollHeight");for(var o=0,a=n.length;a>o;o++)this.addSection(n[o],this.elements[o]);this.elements.each((function(e,t){if(i.show===t)this.fireEvent("active",[n[t],e]);else for(var o in s)e.setStyle(o,0)}),this),(i.display||0===i.display||!1===i.initialDisplayFx)&&this.display(i.display,i.initialDisplayFx),!1!==i.fixedHeight&&(i.resetHeight=!1),this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(e,t){e=document.id(e),t=document.id(t),this.togglers.include(e),this.elements.include(t);var i=this.togglers,n=this.options,s=i.contains(e),o=i.indexOf(e),a=this.display.pass(o,this);if(e.store("accordion:display",a).addEvent(n.trigger,a),n.height&&t.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"}),n.width&&t.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"}),t.fullOpacity=1,n.fixedWidth&&(t.fullWidth=n.fixedWidth),n.fixedHeight&&(t.fullHeight=n.fixedHeight),t.setStyle("overflow","hidden"),!s)for(var r in this.effects)t.setStyle(r,0);return this},removeSection:function(e,t){var i=this.togglers,n=i.indexOf(e),s=this.elements[n],o=function(){i.erase(e),this.elements.erase(s),this.detach(e)}.bind(this);return this.now==n||null!=t?this.display(null!=t?t:n-1>=0?n-1:0).chain(o):o(),this},detach:function(e){var t=function(e){e.removeEvent(this.options.trigger,e.retrieve("accordion:display"))}.bind(this);return e?t(e):this.togglers.each(t),this},display:function(e,t){if(!this.check(e,t))return this;var i={},n=this.elements,s=this.options,o=this.effects,a=s.keepOpen,r=s.alwaysHide;if(null==t&&(t=!0),"element"==typeOf(e)&&(e=n.indexOf(e)),e==this.current&&!r&&!a)return this;if(s.resetHeight){var l=n[this.current];if(l&&!this.selfHidden)for(var h in o)l.setStyle(h,l[o[h]])}return this.timer&&"chain"==s.link?this:(null!=this.current&&(this.previous=this.current),this.current=e,this.selfHidden=!1,n.each((function(n,l){var h,d;if(i[l]={},!a||l==e){for(var c in l==e&&(d=n.offsetHeight>0&&s.height||n.offsetWidth>0&&s.width),l!=e?h=!0:(r||a)&&d&&(h=!0,this.selfHidden=!0),this.fireEvent(h?"background":"active",[this.togglers[l],n]),o)i[l][c]=h?0:n[o[c]];t||h||!s.resetHeight||(i[l].height="auto")}}),this),this.internalChain.clearChain(),this.internalChain.chain(function(){if(s.resetHeight&&!this.selfHidden){var t=n[e];t&&t.setStyle("height","auto")}}.bind(this)),t?this.start(i):this.set(i).internalChain.callChain())}}),Fx.Move=new Class({Extends:Fx.Morph,options:{relativeTo:document.body,position:"center",edge:!1,offset:{x:0,y:0}},start:function(e){var t=this.element,i=t.getStyles("top","left");return("auto"==i.top||"auto"==i.left)&&t.setPosition(t.getPosition(t.getOffsetParent())),this.parent(t.position(Object.merge({},this.options,e,{returnPos:!0})))}}),Element.Properties.move={set:function(e){return this.get("move").cancel().setOptions(e),this},get:function(){var e=this.retrieve("move");return e||(e=new Fx.Move(this,{link:"cancel"}),this.store("move",e)),e}},Element.implement({move:function(e){return this.get("move").start(e),this}}),Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:!0},initialize:function(e,t){if(this.element=this.subject=document.id(e),this.parent(t),"element"!=typeOf(this.element)&&(this.element=document.id(this.element.getDocument().body)),this.options.wheelStops){var i=this.element,n=this.cancel.pass(!1,this);this.addEvent("start",(function(){i.addEvent("mousewheel",n)}),!0),this.addEvent("complete",(function(){i.removeEvent("mousewheel",n)}),!0)}},set:function(){var e=Array.flatten(arguments);return this.element.scrollTo(e[0],e[1]),this},compute:function(e,t,i){return[0,1].map((function(n){return Fx.compute(e[n],t[n],i)}))},start:function(e,t){if(!this.check(e,t))return this;var i=this.element.getScroll();return this.parent([i.x,i.y],[e,t])},calculateScroll:function(e,t){var i=this.element,n=i.getScrollSize(),s=i.getScroll(),o=i.getSize(),a=this.options.offset,r={x:e,y:t};for(var l in r)r[l]||0===r[l]||(r[l]=s[l]),"number"!=typeOf(r[l])&&(r[l]=n[l]-o[l]),r[l]+=a[l];return[r.x,r.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(!1,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,!1))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",!1))},toBottom:function(){return this.start.apply(this,this.calculateScroll(!1,"bottom"))},toElement:function(e,t){t=t?Array.convert(t):["x","y"];var i,n=(i=this.element,/^(?:body|html)$/i.test(i.tagName)?{x:0,y:0}:this.element.getScroll()),s=Object.map(document.id(e).getPosition(this.element),(function(e,i){return!!t.contains(i)&&e+n[i]}));return this.start.apply(this,this.calculateScroll(s.x,s.y))},toElementEdge:function(e,t,i){t=t?Array.convert(t):["x","y"],e=document.id(e);var n={},s=e.getPosition(this.element),o=e.getSize(),a=this.element.getScroll(),r=this.element.getSize(),l={x:s.x+o.x,y:s.y+o.y};return["x","y"].each((function(e){t.contains(e)&&(l[e]>a[e]+r[e]&&(n[e]=l[e]-r[e]),s[e]<a[e]&&(n[e]=s[e])),null==n[e]&&(n[e]=a[e]),i&&i[e]&&(n[e]=n[e]+i[e])}),this),(n.x!=a.x||n.y!=a.y)&&this.start(n.x,n.y),this},toElementCenter:function(e,t,i){t=t?Array.convert(t):["x","y"],e=document.id(e);var n={},s=e.getPosition(this.element),o=e.getSize(),a=this.element.getScroll(),r=this.element.getSize();return["x","y"].each((function(e){t.contains(e)&&(n[e]=s[e]-(r[e]-o[e])/2),null==n[e]&&(n[e]=a[e]),i&&i[e]&&(n[e]=n[e]+i[e])}),this),(n.x!=a.x||n.y!=a.y)&&this.start(n.x,n.y),this}}),Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:!1,hideOverflow:!0,resetHeight:!1},initialize:function(e,t){e=this.element=this.subject=document.id(e),this.parent(t),t=this.options;var i=e.retrieve("wrapper"),n=e.getStyles("margin","position","overflow");t.hideOverflow&&(n=Object.append(n,{overflow:"hidden"})),t.wrapper&&(i=document.id(t.wrapper).setStyles(n)),i||(i=new Element("div",{styles:n}).wraps(e)),e.store("wrapper",i).setStyle("margin",0),"visible"==e.getStyle("overflow")&&e.setStyle("overflow","hidden"),this.now=[],this.open=!0,this.wrapper=i,this.addEvent("complete",(function(){this.open=0!=i["offset"+this.layout.capitalize()],this.open&&this.options.resetHeight&&i.setStyle("height","")}),!0)},vertical:function(){this.margin="margin-top",this.layout="height",this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left",this.layout="width",this.offset=this.element.offsetWidth},set:function(e){return this.element.setStyle(this.margin,e[0]),this.wrapper.setStyle(this.layout,e[1]),this},compute:function(e,t,i){return[0,1].map((function(n){return Fx.compute(e[n],t[n],i)}))},start:function(e,t){if(!this.check(e,t))return this;this[t||this.options.mode]();var i,n=this.element.getStyle(this.margin).toInt(),s=this.wrapper.getStyle(this.layout).toInt(),o=[[n,s],[0,this.offset]],a=[[n,s],[-this.offset,0]];switch(e){case"in":i=o;break;case"out":i=a;break;case"toggle":i=0==s?o:a}return this.parent(i[0],i[1])},slideIn:function(e){return this.start("in",e)},slideOut:function(e){return this.start("out",e)},hide:function(e){return this[e||this.options.mode](),this.open=!1,this.set([-this.offset,0])},show:function(e){return this[e||this.options.mode](),this.open=!0,this.set([0,this.offset])},toggle:function(e){return this.start("toggle",e)}}),Element.Properties.slide={set:function(e){return this.get("slide").cancel().setOptions(e),this},get:function(){var e=this.retrieve("slide");return e||(e=new Fx.Slide(this,{link:"cancel"}),this.store("slide",e)),e}},Element.implement({slide:function(e,t){e=e||"toggle";var i,n=this.get("slide");switch(e){case"hide":n.hide(t);break;case"show":n.show(t);break;case"toggle":var s=this.retrieve("slide:flag",n.open);n[s?"slideOut":"slideIn"](t),this.store("slide:flag",!s),i=!0;break;default:n.start(e,t)}return i||this.eliminate("slide:flag"),this}}),Fx.SmoothScroll=new Class({Extends:Fx.Scroll,options:{axes:["x","y"]},initialize:function(e,t){t=t||document,this.doc=t.getDocument(),this.parent(this.doc,e);var i=t.getWindow(),n=i.location.href.match(/^[^#]*/)[0]+"#";$$(this.options.links||this.doc.links).each((function(e){if(0==e.href.indexOf(n)){var t=e.href.substr(n.length);t&&this.useLink(e,t)}}),this),this.addEvent("complete",(function(){i.location.hash=this.anchor,this.element.scrollTo(this.to[0],this.to[1])}),!0)},useLink:function(e,t){return e.addEvent("click",function(i){var n=document.id(t)||this.doc.getElement("a[name="+t+"]");n&&(i.preventDefault(),this.toElement(n,this.options.axes).chain(function(){this.fireEvent("scrolledTo",[e,n])}.bind(this)),this.anchor=t)}.bind(this)),this}}),Fx.Sort=new Class({Extends:Fx.Elements,options:{mode:"vertical"},initialize:function(e,t){this.parent(e,t),this.elements.each((function(e){"static"==e.getStyle("position")&&e.setStyle("position","relative")})),this.setDefaultOrder()},setDefaultOrder:function(){this.currentOrder=this.elements.map((function(e,t){return t}))},sort:function(){if(!this.check(arguments))return this;var e=Array.flatten(arguments),t=0,i=0,n={},s={},o="vertical"==this.options.mode,a=this.elements.map((function(e,n){var a,r=e.getComputedSize({styles:["border","padding","margin"]});o?(a={top:t,margin:r["margin-top"],height:r.totalHeight},t+=a.height-r["margin-top"]):(a={left:i,margin:r["margin-left"],width:r.totalWidth},i+=a.width);var l=o?"top":"left";s[n]={};var h=e.getStyle(l).toInt();return s[n][l]=h||0,a}),this);this.set(s),(e=e.map((function(e){return e.toInt()}))).length!=this.elements.length&&(this.currentOrder.each((function(t){e.contains(t)||e.push(t)})),e.length>this.elements.length&&e.splice(this.elements.length-1,e.length-this.elements.length));var r=0;t=i=0,e.each((function(e){var s={};o?(s.top=t-a[e].top-r,t+=a[e].height):(s.left=i-a[e].left,i+=a[e].width),r+=a[e].margin,n[e]=s}),this);var l={};return Array.clone(e).sort().each((function(e){l[e]=n[e]})),this.start(l),this.currentOrder=e,this},rearrangeDOM:function(e){e=e||this.currentOrder;var t=this.elements[0].getParent(),i=[];return this.elements.setStyle("opacity",0),e.each((function(e){i.push(this.elements[e].inject(t).setStyles({top:0,left:0}))}),this),this.elements.setStyle("opacity",1),this.elements=$$(i),this.setDefaultOrder(),this},getDefaultOrder:function(){return this.elements.map((function(e,t){return t}))},getCurrentOrder:function(){return this.currentOrder},forward:function(){return this.sort(this.getDefaultOrder())},backward:function(){return this.sort(this.getDefaultOrder().reverse())},reverse:function(){return this.sort(this.currentOrder.reverse())},sortByElements:function(e){return this.sort(e.map((function(e){return this.elements.indexOf(e)}),this))},swap:function(e,t){"element"==typeOf(e)&&(e=this.elements.indexOf(e)),"element"==typeOf(t)&&(t=this.elements.indexOf(t));var i=Array.clone(this.currentOrder);return i[this.currentOrder.indexOf(e)]=t,i[this.currentOrder.indexOf(t)]=e,this.sort(i)}}),function(){var e=this.Keyboard=new Class({Extends:Events,Implements:[Options],options:{defaultEventType:"keydown",active:!1,manager:null,events:{},nonParsedEvents:["activate","deactivate","onactivate","ondeactivate","changed","onchanged"]},initialize:function(e){e&&e.manager&&(this._manager=e.manager,delete e.manager),this.setOptions(e),this._setup()},addEvent:function(t,i,n){return this.parent(e.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i,n)},removeEvent:function(t,i){return this.parent(e.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i)},toggleActive:function(){return this[this.isActive()?"deactivate":"activate"]()},activate:function(t){if(t){if(t.isActive())return this;this._activeKB&&t!=this._activeKB&&(this.previous=this._activeKB,this.previous.fireEvent("deactivate")),this._activeKB=t.fireEvent("activate"),e.manager.fireEvent("changed")}else this._manager&&this._manager.activate(this);return this},isActive:function(){return this._manager?this._manager._activeKB==this:e.manager==this},deactivate:function(t){return t?t===this._activeKB&&(this._activeKB=null,t.fireEvent("deactivate"),e.manager.fireEvent("changed")):this._manager&&this._manager.deactivate(this),this},relinquish:function(){return this.isActive()&&this._manager&&this._manager.previous?this._manager.activate(this._manager.previous):this.deactivate(),this},manage:function(e){return e._manager&&e._manager.drop(e),this._instances.push(e),e._manager=this,this._activeKB||this.activate(e),this},drop:function(e){return e.relinquish(),this._instances.erase(e),this._activeKB==e&&(this.previous&&this._instances.contains(this.previous)?this.activate(this.previous):this._activeKB=this._instances[0]),this},trace:function(){e.trace(this)},each:function(t){e.each(this,t)},_instances:[],_disable:function(e){this._activeKB==e&&(this._activeKB=null)},_setup:function(){this.addEvents(this.options.events),e.manager&&!this._manager&&e.manager.manage(this),this.options.active?this.activate():this.relinquish()},_handle:function(e,t){if(!e.preventKeyboardPropagation){var i=!!this._manager;i&&this._activeKB&&(this._activeKB._handle(e,t),e.preventKeyboardPropagation)||(this.fireEvent(t,e),!i&&this._activeKB&&this._activeKB._handle(e,t))}}}),t={},i=["shift","control","alt","meta"],n=/^(?:shift|control|ctrl|alt|meta)$/;e.parse=function(e,s,o){if(o&&o.contains(e.toLowerCase()))return e;if(e=e.toLowerCase().replace(/^(keyup|keydown):/,(function(e,t){return s=t,""})),!t[e])if("+"!=e){var a,r={};e.split("+").each((function(e){n.test(e)?r[e]=!0:a=e})),r.control=r.control||r.ctrl;var l=[];i.each((function(e){r[e]&&l.push(e)})),a&&l.push(a),t[e]=l.join("+")}else t[e]=e;return s+":keys("+t[e]+")"},e.each=function(t,i){for(var n=t||e.manager;n;)i(n),n=n._activeKB},e.stop=function(e){e.preventKeyboardPropagation=!0},e.manager=new e({active:!0}),e.trace=function(t){t=t||e.manager;var i=window.console&&console.log;i&&console.log("the following items have focus: "),e.each(t,(function(e){i&&console.log(document.id(e.widget)||e.wiget||e)}))};var s=function(t){var s=[];i.each((function(e){t[e]&&s.push(e)})),n.test(t.key)||s.push(t.key),e.manager._handle(t,t.type+":keys("+s.join("+")+")")};document.addEvents({keyup:s,keydown:s})}(),Keyboard.prototype.options.nonParsedEvents.combine(["rebound","onrebound"]),Keyboard.implement({addShortcut:function(e,t){return this._shortcuts=this._shortcuts||[],this._shortcutIndex=this._shortcutIndex||{},t.getKeyboard=Function.convert(this),t.name=e,this._shortcutIndex[e]=t,this._shortcuts.push(t),t.keys&&this.addEvent(t.keys,t.handler),this},addShortcuts:function(e){for(var t in e)this.addShortcut(t,e[t]);return this},removeShortcut:function(e){var t=this.getShortcut(e);return t&&t.keys&&(this.removeEvent(t.keys,t.handler),delete this._shortcutIndex[e],this._shortcuts.erase(t)),this},removeShortcuts:function(e){return e.each(this.removeShortcut,this),this},getShortcuts:function(){return this._shortcuts||[]},getShortcut:function(e){return(this._shortcutIndex||{})[e]}}),Keyboard.rebind=function(e,t){Array.convert(t).each((function(t){t.getKeyboard().removeEvent(t.keys,t.handler),t.getKeyboard().addEvent(e,t.handler),t.keys=e,t.getKeyboard().fireEvent("rebound")}))},Keyboard.getActiveShortcuts=function(e){var t=[],i=[];return Keyboard.each(e,[].push.bind(t)),t.each((function(e){i.extend(e.getShortcuts())})),i},Keyboard.getShortcut=function(e,t,i){var n=(i=i||{}).many?[]:null,s=i.many?function(t){var i=t.getShortcut(e);i&&n.push(i)}:function(t){n||(n=t.getShortcut(e))};return Keyboard.each(t,s),n},Keyboard.getShortcuts=function(e,t){return Keyboard.getShortcut(e,t,{many:!0})},function(){this.HtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"HtmlTable",initialize:function(){var e=Array.link(arguments,{options:Type.isObject,table:Type.isElement,id:Type.isString});return this.setOptions(e.options),!e.table&&e.id&&(e.table=document.id(e.id)),this.element=e.table||new Element("table",this.options.properties),this.occlude()?this.occluded:void this.build()},build:function(){this.element.store("HtmlTable",this),this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element),$$(this.body.rows),this.options.headers.length?this.setHeaders(this.options.headers):this.thead=document.id(this.element.tHead),this.thead&&(this.head=this.getHead()),this.options.footers.length&&this.setFooters(this.options.footers),this.tfoot=document.id(this.element.tFoot),this.tfoot&&(this.foot=document.id(this.tfoot.rows[0])),this.options.rows.each((function(e){this.push(e)}),this)},toElement:function(){return this.element},empty:function(){return this.body.empty(),this},set:function(e,t){var i="headers"==e?"tHead":"tFoot",n=i.toLowerCase();this[n]=(document.id(this.element[i])||new Element(n).inject(this.element,"top")).empty();var s=this.push(t,{},this[n],"headers"==e?"th":"td");return"headers"==e?this.head=this.getHead():this.foot=this.getHead(),s},getHead:function(){var e=this.thead.rows;return e.length>1?$$(e):!!e.length&&document.id(e[0])},setHeaders:function(e){return this.set("headers",e),this},setFooters:function(e){return this.set("footers",e),this},update:function(e,t,i){var n=e.getChildren(i||"td"),s=n.length-1;return t.each((function(t,o){var a=n[o]||new Element(i||"td").inject(e),r=(t&&Object.prototype.hasOwnProperty.call(t,"content")?t.content:"")||t,l=typeOf(r);t&&Object.prototype.hasOwnProperty.call(t,"properties")&&a.set(t.properties),/(element(s?)|array|collection)/.test(l)?a.empty().adopt(r):a.set("html",r),o>s?n.push(a):n[o]=a})),{tr:e,tds:n}},push:function(e,t,i,n,s){return"element"==typeOf(e)&&"tr"==e.get("tag")?(e.inject(i||this.body,s),{tr:e,tds:e.getChildren("td")}):this.update(new Element("tr",t).inject(i||this.body,s),e,n)},pushMany:function(e,t,i,n,s){return e.map((function(e){return this.push(e,t,i,n,s)}),this)}})}(),["adopt","inject","wraps","grab","replaces","dispose"].each((function(e){HtmlTable.implement(e,(function(){return this.element[e].apply(this.element,arguments),this}))})),HtmlTable=Class.refactor(HtmlTable,{options:{useKeyboard:!0,classRowSelected:"table-tr-selected",classRowHovered:"table-tr-hovered",classSelectable:"table-selectable",shiftForMultiSelect:!0,allowMultiSelect:!0,selectable:!1,selectHiddenRows:!1},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.selectedRows=new Elements,this.bound||(this.bound={}),this.bound.mouseleave=this.mouseleave.bind(this),this.bound.clickRow=this.clickRow.bind(this),this.bound.activateKeyboard=function(){this.keyboard&&this.selectEnabled&&this.keyboard.activate()}.bind(this),void(this.options.selectable&&this.enableSelect()))},empty:function(){return this.body.rows.length&&this.selectNone(),this.previous()},enableSelect:function(){return this.selectEnabled=!0,this.attachSelects(),this.element.addClass(this.options.classSelectable),this},disableSelect:function(){return this.selectEnabled=!1,this.attachSelects(!1),this.element.removeClass(this.options.classSelectable),this},push:function(){var e=this.previous.apply(this,arguments);return this.updateSelects(),e},toggleRow:function(e){return this[(this.isSelected(e)?"de":"")+"selectRow"](e)},selectRow:function(e,t){return this.isSelected(e)||!t&&!this.body.getChildren().contains(e)?void 0:(this.options.allowMultiSelect||this.selectNone(),this.isSelected(e)||(this.selectedRows.push(e),e.addClass(this.options.classRowSelected),this.fireEvent("rowFocus",[e,this.selectedRows]),this.fireEvent("stateChanged")),this.focused=e,document.clearSelection(),this)},isSelected:function(e){return this.selectedRows.contains(e)},getSelected:function(){return this.selectedRows},serialize:function(){var e=this.previous.apply(this,arguments)||{};return this.options.selectable&&(e.selectedRows=this.selectedRows.map(function(e){return Array.indexOf(this.body.rows,e)}.bind(this))),e},restore:function(e){this.options.selectable&&e.selectedRows&&e.selectedRows.each(function(e){this.selectRow(this.body.rows[e])}.bind(this)),this.previous.apply(this,arguments)},deselectRow:function(e,t){return this.isSelected(e)&&(t||this.body.getChildren().contains(e))?(this.selectedRows=new Elements(Array.convert(this.selectedRows).erase(e)),e.removeClass(this.options.classRowSelected),this.fireEvent("rowUnfocus",[e,this.selectedRows]),this.fireEvent("stateChanged"),this):void 0},selectAll:function(e){return e||this.options.allowMultiSelect?(this.selectRange(0,this.body.rows.length,e),this):void 0},selectNone:function(){return this.selectAll(!0)},selectRange:function(e,t,i){if(this.options.allowMultiSelect||i){var n=i?"deselectRow":"selectRow",s=Array.clone(this.body.rows);if("element"==typeOf(e)&&(e=s.indexOf(e)),"element"==typeOf(t)&&(t=s.indexOf(t)),e>(t=t<s.length-1?t:s.length-1)){var o=e;e=t,t=o}for(var a=e;t>=a;a++)(this.options.selectHiddenRows||s[a].isDisplayed())&&this[n](s[a],!0);return this}},deselectRange:function(e,t){this.selectRange(e,t,!0)},enterRow:function(e){this.hovered&&(this.hovered=this.leaveRow(this.hovered)),this.hovered=e.addClass(this.options.classRowHovered)},leaveRow:function(e){e.removeClass(this.options.classRowHovered)},updateSelects:function(){Array.each(this.body.rows,(function(e){var t=e.retrieve("binders");(t||this.selectEnabled)&&(t||(t={mouseenter:this.enterRow.pass([e],this),mouseleave:this.leaveRow.pass([e],this)},e.store("binders",t)),this.selectEnabled?e.addEvents(t):e.removeEvents(t))}),this)},shiftFocus:function(e,t){if(!this.focused)return this.selectRow(this.body.rows[0],t);var i=this.getRowByOffset(e,this.options.selectHiddenRows);return null===i||this.focused==this.body.rows[i]?this:void this.toggleRow(this.body.rows[i],t)},clickRow:function(e,t){(e.shift||e.meta||e.control)&&this.options.shiftForMultiSelect||e.rightClick&&this.isSelected(t)&&this.options.allowMultiSelect||this.selectNone(),e.rightClick?this.selectRow(t):this.toggleRow(t),e.shift&&(this.selectRange(this.rangeStart||this.body.rows[0],t,!this.rangeStart||!this.isSelected(t)),this.focused=t),this.rangeStart=t},getRowByOffset:function(e,t){if(!this.focused)return 0;var i=Array.indexOf(this.body.rows,this.focused);if(0==i&&0>e||i==this.body.rows.length-1&&e>0)return null;if(t)i+=e;else{var n=0;if(e>0)for(;e>n&&i<this.body.rows.length-1;)this.body.rows[++i].isDisplayed()&&n++;else for(;n>e&&i>0;)this.body.rows[--i].isDisplayed()&&n--}return i},attachSelects:function(e){var t=(e=null==e||e)?"addEvents":"removeEvents";if(this.element[t]({mouseleave:this.bound.mouseleave,click:this.bound.activateKeyboard}),this.body[t]({"click:relay(tr)":this.bound.clickRow,"contextmenu:relay(tr)":this.bound.clickRow}),this.options.useKeyboard||this.keyboard){if(this.keyboard||(this.keyboard=new Keyboard),!this.selectKeysDefined){this.selectKeysDefined=!0;var i,n,s=function(e){var t=function(s){clearTimeout(i),s.preventDefault();var o=this.body.rows[this.getRowByOffset(e,this.options.selectHiddenRows)];s.shift&&o&&this.isSelected(o)?(this.deselectRow(this.focused),this.focused=o):(!o||this.options.allowMultiSelect&&s.shift||this.selectNone(),this.shiftFocus(e,s)),i=n?t.delay(100,this,s):function(){n=!0,t(s)}.delay(400)}.bind(this);return t}.bind(this),o=function(){clearTimeout(i),n=!1};this.keyboard.addEvents({"keydown:shift+up":s(-1),"keydown:shift+down":s(1),"keyup:shift+up":o,"keyup:shift+down":o,"keyup:up":o,"keyup:down":o});var a="";this.options.allowMultiSelect&&this.options.shiftForMultiSelect&&this.options.useKeyboard&&(a=" (Shift multi-selects)."),this.keyboard.addShortcuts({"Select Previous Row":{keys:"up",shortcut:"up arrow",handler:s(-1),description:"Select the previous row in the table."+a},"Select Next Row":{keys:"down",shortcut:"down arrow",handler:s(1),description:"Select the next row in the table."+a}})}this.keyboard[e?"activate":"deactivate"]()}this.updateSelects()},mouseleave:function(){this.hovered&&this.leaveRow(this.hovered)}}),function(){var e=document.createElement("table");try{e.innerHTML="<tr><td></td></tr>",e=0===e.childNodes.length}catch(t){e=!0}HtmlTable=Class.refactor(HtmlTable,{options:{sortIndex:0,sortReverse:!1,parsers:[],defaultParser:"string",classSortable:"table-sortable",classHeadSort:"table-th-sort",classHeadSortRev:"table-th-sort-rev",classNoSort:"table-th-nosort",classGroupHead:"table-tr-group-head",classGroup:"table-tr-group",classCellSort:"table-td-sort",classSortSpan:"table-th-sort-span",sortable:!1,thSelector:"th"},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.sorted={index:null,dir:1},this.bound||(this.bound={}),this.bound.headClick=this.headClick.bind(this),this.sortSpans=new Elements,void(this.options.sortable&&(this.enableSort(),null!=this.options.sortIndex&&this.sort(this.options.sortIndex,this.options.sortReverse))))},attachSorts:function(e){this.detachSorts(),!1!==e&&this.element.addEvent("click:relay("+this.options.thSelector+")",this.bound.headClick)},detachSorts:function(){this.element.removeEvents("click:relay("+this.options.thSelector+")")},setHeaders:function(){this.previous.apply(this,arguments),this.sortable&&this.setParsers()},setParsers:function(){this.parsers=this.detectParsers()},detectParsers:function(){return this.head&&this.head.getElements(this.options.thSelector).flatten().map(this.detectParser,this)},detectParser:function(e,t){if(e.hasClass(this.options.classNoSort)||e.retrieve("htmltable-parser"))return e.retrieve("htmltable-parser");var i=new Element("div");i.adopt(e.childNodes).inject(e);var n=new Element("span",{class:this.options.classSortSpan}).inject(i,"top");this.sortSpans.push(n);var s,o=this.options.parsers[t],a=this.body.rows;switch(typeOf(o)){case"function":o={convert:o},s=!0;break;case"string":o=o,s=!0}return s||HtmlTable.ParserPriority.some((function(e){var i=HtmlTable.Parsers[e],n=i.match;if(!n)return!1;for(var s=0,r=a.length;r>s;s++){var l=document.id(a[s].cells[t]),h=l?l.get("html").clean():"";if(h&&n.test(h))return o=i,!0}})),o||(o=this.options.defaultParser),e.store("htmltable-parser",o),o},headClick:function(e,t){return this.head&&!t.hasClass(this.options.classNoSort)?this.sort(Array.indexOf(this.head.getElements(this.options.thSelector).flatten(),t)%this.body.rows[0].cells.length):void 0},serialize:function(){var e=this.previous.apply(this,arguments)||{};return this.options.sortable&&(e.sortIndex=this.sorted.index,e.sortReverse=this.sorted.reverse),e},restore:function(e){this.options.sortable&&e.sortIndex&&this.sort(e.sortIndex,e.sortReverse),this.previous.apply(this,arguments)},setSortedState:function(e,t){null!=t?this.sorted.reverse=t:this.sorted.index==e?this.sorted.reverse=!this.sorted.reverse:this.sorted.reverse=null==this.sorted.index,null!=e&&(this.sorted.index=e)},setHeadSort:function(e){var t=$$(this.head.length?this.head.map((function(e){return e.getElements(this.options.thSelector)[this.sorted.index]}),this).clean():this.head.cells[this.sorted.index]);t.length&&(e?(t.addClass(this.options.classHeadSort),this.sorted.reverse?t.addClass(this.options.classHeadSortRev):t.removeClass(this.options.classHeadSortRev)):t.removeClass(this.options.classHeadSort).removeClass(this.options.classHeadSortRev))},setRowSort:function(e,t){for(var i,n,s=e.length,o=this.body;s;){var a=e[--s],r=a.position,l=o.rows[r];if(!l.disabled)for(t||(i=this.setGroupSort(i,l,a),this.setRowStyle(l,s)),o.appendChild(l),n=0;s>n;n++)e[n].position>r&&e[n].position--}},setRowStyle:function(e,t){this.previous(e,t),e.cells[this.sorted.index].addClass(this.options.classCellSort)},setGroupSort:function(e,t,i){return e==i.value?t.removeClass(this.options.classGroupHead).addClass(this.options.classGroup):t.removeClass(this.options.classGroup).addClass(this.options.classGroupHead),i.value},getParser:function(){var e=this.parsers[this.sorted.index];return"string"==typeOf(e)?HtmlTable.Parsers[e]:e},sort:function(t,i,n,s){if(this.head){n||(this.clearSort(),this.setSortedState(t,i),this.setHeadSort(!0));var o=this.getParser();if(o){var a;e||(a=this.body.getParent(),this.body.dispose());var r=this.parseData(o).sort(s||function(e,t){return e.value===t.value?0:e.value>t.value?1:-1}),l=this.sorted.reverse==(o==HtmlTable.Parsers["input-checked"]);return l&&r.reverse(!0),this.setRowSort(r,n),a&&a.grab(this.body),this.fireEvent("stateChanged"),this.fireEvent("sort",[this.body,this.sorted.index,l?"asc":"desc"])}}},parseData:function(e){return Array.map(this.body.rows,(function(t,i){return{position:i,value:e.convert.call(document.id(t.cells[this.sorted.index]))}}),this)},clearSort:function(){this.setHeadSort(!1),this.body.getElements("td").removeClass(this.options.classCellSort)},reSort:function(){return this.sortable&&this.sort.call(this,this.sorted.index,this.sorted.reverse),this},enableSort:function(){return this.element.addClass(this.options.classSortable),this.attachSorts(!0),this.setParsers(),this.sortable=!0,this},disableSort:function(){return this.element.removeClass(this.options.classSortable),this.attachSorts(!1),this.sortSpans.each((function(e){e.destroy()})),this.sortSpans.empty(),this.sortable=!1,this}}),HtmlTable.ParserPriority=["date","input-checked","input-value","float","number"],HtmlTable.Parsers={date:{match:/^\d{2}[-\/ ]\d{2}[-\/ ]\d{2,4}$/,convert:function(){var e=Date.parse(this.get("text").stripTags());return"date"==typeOf(e)?e.format("db"):""},type:"date"},"input-checked":{match:/ type="(radio|checkbox)"/,convert:function(){return this.getElement("input").checked}},"input-value":{match:/<input/,convert:function(){return this.getElement("input").value}},number:{match:/^\d+[^\d.,]*$/,convert:function(){return this.get("text").stripTags().toInt()},number:!0},numberLax:{match:/^[^\d]+\d+$/,convert:function(){return this.get("text").replace(/[^-?^0-9]/,"").stripTags().toInt()},number:!0},float:{match:/^[\d]+\.[\d]+/,convert:function(){return this.get("text").replace(/[^-?^\d.e]/,"").stripTags().toFloat()},number:!0},floatLax:{match:/^[^\d]+[\d]+\.[\d]+$/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags().toFloat()},number:!0},string:{match:null,convert:function(){return this.get("text").stripTags().toLowerCase()}},title:{match:null,convert:function(){return this.title}}},HtmlTable.defineParsers=function(e){for(var t in HtmlTable.Parsers=Object.append(HtmlTable.Parsers,e),e)HtmlTable.ParserPriority.unshift(t)}}(),HtmlTable=Class.refactor(HtmlTable,{options:{classZebra:"table-tr-odd",zebra:!0,zebraOnlyVisibleRows:!0},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:void(this.options.zebra&&this.updateZebras())},updateZebras:function(){var e=0;Array.each(this.body.rows,(function(t){(!this.options.zebraOnlyVisibleRows||t.isDisplayed())&&this.zebra(t,e++)}),this)},setRowStyle:function(e,t){this.previous&&this.previous(e,t),this.zebra(e,t)},zebra:function(e,t){return e[(t%2?"remove":"add")+"Class"](this.options.classZebra)},push:function(){var e=this.previous.apply(this,arguments);return this.options.zebra&&this.updateZebras(),e}}),function(){this.Scroller=new Class({Implements:[Events,Options],options:{area:20,velocity:1,onChange:function(e,t){this.element.scrollTo(e,t)},fps:50},initialize:function(e,t){this.setOptions(t),this.element=document.id(e),this.docBody=document.id(this.element.getDocument().body),this.listener="element"!=typeOf(this.element)?this.docBody:this.element,this.timer=null,this.bound={attach:this.attach.bind(this),detach:this.detach.bind(this),getCoords:this.getCoords.bind(this)}},start:function(){return this.listener.addEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this},stop:function(){return this.listener.removeEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this.detach(),this.timer=clearInterval(this.timer),this},attach:function(){this.listener.addEvent("mousemove",this.bound.getCoords)},detach:function(){this.listener.removeEvent("mousemove",this.bound.getCoords),this.timer=clearInterval(this.timer)},getCoords:function(e){this.page="body"==this.listener.get("tag")?e.client:e.page,this.timer||(this.timer=this.scroll.periodical(Math.round(1e3/this.options.fps),this))},scroll:function(){var e=this.element.getSize(),t=this.element.getScroll(),i=this.element!=this.docBody&&this.element!=window?this.element.getOffsets():{x:0,y:0},n=this.element.getScrollSize(),s={x:0,y:0},o=this.options.area.top||this.options.area,a=this.options.area.bottom||this.options.area;for(var r in this.page)this.page[r]<o+i[r]&&0!=t[r]?s[r]=(this.page[r]-o-i[r])*this.options.velocity:this.page[r]+a>e[r]+i[r]&&t[r]+e[r]!=n[r]&&(s[r]=(this.page[r]-e[r]+a-i[r])*this.options.velocity),s[r]=s[r].round();(s.y||s.x)&&this.fireEvent("change",[t.x+s.x,t.y+s.y])}})}(),Locale.define("en-GB","Date",{dateOrder:["date","month","year"],shortDate:"%d/%m/%Y",shortTime:"%H:%M"}).inherit("en-US","Date"),Locale.define("en-US","Number",{decimal:".",group:",",currency:{prefix:"$ "}}),Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(e){this.options.log&&window.console&&console.log&&console.log("JSONP retrieving script with url:"+e)},onError:function(e){this.options.log&&window.console&&console.warn&&console.warn("JSONP "+e+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:!1},initialize:function(e){this.setOptions(e)},send:function(e){if(!Request.prototype.check.call(this,e))return this;this.running=!0;var t=typeOf(e);("string"==t||"element"==t)&&(e={data:e});var i=(e=Object.merge(this.options,e||{})).data;switch(typeOf(i)){case"element":i=document.id(i).toQueryString();break;case"object":case"hash":i=Object.toQueryString(i)}var n=this.index=Request.JSONP.counter++,s="request_"+n,o=e.url+(e.url.test("\\?")?"&":"?")+e.callbackKey+"=Request.JSONP.request_map.request_"+n+(i?"&"+i:"");o.length>2083&&this.fireEvent("error",o),Request.JSONP.request_map[s]=function(){delete Request.JSONP.request_map[s],this.success(arguments,n)}.bind(this);var a=this.getScript(o).inject(e.injectScript);return this.fireEvent("request",[o,a]),e.timeout&&this.timeout.delay(e.timeout,this),this},getScript:function(e){return this.script||(this.script=new Element("script",{type:"text/javascript",async:!0,src:e})),this.script},success:function(e){this.running&&this.clear().fireEvent("complete",e).fireEvent("success",e).callChain()},cancel:function(){return this.running&&this.clear().fireEvent("cancel"),this},isRunning:function(){return!!this.running},clear:function(){return this.running=!1,this.script&&(this.script.destroy(),this.script=null),this},timeout:function(){return this.running&&(this.running=!1,this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()),this}}),Request.JSONP.counter=0,Request.JSONP.request_map={},Request.implement({options:{initialDelay:5e3,delay:5e3,limit:6e4},startTimer:function(e){var t=function(){this.running||this.send({data:e})};return this.lastDelay=this.options.initialDelay,this.timer=t.delay(this.lastDelay,this),this.completeCheck=function(e){clearTimeout(this.timer),this.lastDelay=e?this.options.delay:(this.lastDelay+this.options.delay).min(this.options.limit),this.timer=t.delay(this.lastDelay,this)},this.addEvent("complete",this.completeCheck)},stopTimer:function(){return clearTimeout(this.timer),this.removeEvent("complete",this.completeCheck)}}),Request.Queue=new Class({Implements:[Options,Events],Binds:["attach","request","complete","cancel","success","failure","exception"],options:{stopOnFailure:!0,autoAdvance:!0,concurrent:1,requests:{}},initialize:function(e){var t;e&&(t=e.requests,delete e.requests),this.setOptions(e),this.requests={},this.queue=[],this.reqBinders={},t&&this.addRequests(t)},addRequest:function(e,t){return this.requests[e]=t,this.attach(e,t),this},addRequests:function(e){return Object.each(e,(function(e,t){this.addRequest(t,e)}),this),this},getName:function(e){return Object.keyOf(this.requests,e)},attach:function(e,t){return t._groupSend||(["request","complete","cancel","success","failure","exception"].each((function(i){this.reqBinders[e]||(this.reqBinders[e]={}),this.reqBinders[e][i]=function(){this["on"+i.capitalize()].apply(this,[e,t].append(arguments))}.bind(this),t.addEvent(i,this.reqBinders[e][i])}),this),t._groupSend=t.send,t.send=function(i){return this.send(e,i),t}.bind(this)),this},removeRequest:function(e){var t="object"==typeOf(e)?this.getName(e):e;return(t||"string"==typeOf(t))&&(e=this.requests[t])?(["request","complete","cancel","success","failure","exception"].each((function(i){e.removeEvent(i,this.reqBinders[t][i])}),this),e.send=e._groupSend,delete e._groupSend,this):this},getRunning:function(){return Object.filter(this.requests,(function(e){return e.running}))},isRunning:function(){return!!Object.keys(this.getRunning()).length},send:function(e,t){var i=function(){this.requests[e]._groupSend(t),this.queue.erase(i)}.bind(this);return i.name=e,Object.keys(this.getRunning()).length>=this.options.concurrent||this.error&&this.options.stopOnFailure?this.queue.push(i):i(),this},hasNext:function(e){return e?!!this.queue.filter((function(t){return t.name==e})).length:!!this.queue.length},resume:function(){return this.error=!1,(this.options.concurrent-Object.keys(this.getRunning()).length).times(this.runNext,this),this},runNext:function(e){return this.queue.length?(e?this.queue.each((function(i){t||i.name!=e||(t=!0,i())})):this.queue[0](),this):this;var t},runAll:function(){return this.queue.each((function(e){e()})),this},clear:function(e){return e?this.queue=this.queue.map((function(t){return t.name!=e&&t})).filter((function(e){return e})):this.queue.empty(),this},cancel:function(e){return this.requests[e].cancel(),this},onRequest:function(){this.fireEvent("request",arguments)},onComplete:function(){this.fireEvent("complete",arguments),this.queue.length||this.fireEvent("end")},onCancel:function(){this.options.autoAdvance&&!this.error&&this.runNext(),this.fireEvent("cancel",arguments)},onSuccess:function(){this.options.autoAdvance&&!this.error&&this.runNext(),this.fireEvent("success",arguments)},onFailure:function(){this.error=!0,!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext(),this.fireEvent("failure",arguments)},onException:function(){this.error=!0,!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext(),this.fireEvent("exception",arguments)}}),function(e){Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var e=0,t=this.length;if(t)for(;t--;)null!=this[t]&&(e+=parseFloat(this[t]));return e},unique:function(){return[].combine(this)},shuffle:function(){for(var e=this.length;e&&--e;){var t=this[e],i=Math.floor(Math.random()*(e+1));this[e]=this[i],this[i]=t}return this},reduce:function(t,i){for(var n=0,s=this.length;s>n;n++)n in this&&(i=i===e?this[n]:t.call(null,i,this[n],n,this));return i},reduceRight:function(t,i){for(var n=this.length;n--;)n in this&&(i=i===e?this[n]:t.call(null,i,this[n],n,this));return i},pluck:function(e){return this.map((function(t){return t[e]}))}})}(),Date.implement({timeDiffInWords:function(e){return Date.distanceOfTimeInWords(this,e||new Date)},timeDiff:function(e,t){null==e&&(e=new Date);for(var i,n,s=((e-this)/1e3).floor().abs(),o=[],a=[60,60,24,365,0],r=["s","m","h","d","y"],l=0;l<a.length&&(!l||s);l++)i=s,(n=a[l])&&(i=s%n,s=(s/n).floor()),o.unshift(i+(r[l]||""));return o.join(t||":")}}).extend({distanceOfTimeInWords:function(e,t){return Date.getTimePhrase(((t-e)/1e3).toInt())},getTimePhrase:function(e){var t=0>e?"Until":"Ago";0>e&&(e*=-1);var i={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:1/0},n="lessThanMinute";for(var s in i){var o=i[s];if(1.5*o>e){e>.75*o&&(n=s);break}e/=o,n=s+"s"}return e=e.round(),Date.getMsg(n+t,e).substitute({delta:e})}}).defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(e){var t=(new Date).clearTime();switch(e[0]){case"tom":return t.increment();case"yes":return t.decrement();default:return t}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(e){var t=(new Date).clearTime(),i=t.getDay(),n=Date.parseDay(e[2],!0),s=n-i;return i>=n&&(s+=7),"last"==e[1]&&(s-=7),t.set("date",t.getDate()+s)}}).alias("timeAgoInWords","timeDiffInWords"),function(){if(!this.Hash){var e=this.Hash=new Type("Hash",(function(e){for(var t in"hash"==typeOf(e)&&(e=Object.clone(e.getClean())),e)this[t]=e[t];return this}));this.$H=function(t){return new e(t)},e.implement({forEach:function(e,t){Object.forEach(this,e,t)},getClean:function(){var e={};for(var t in this)this.hasOwnProperty(t)&&(e[t]=this[t]);return e},getLength:function(){var e=0;for(var t in this)this.hasOwnProperty(t)&&e++;return e}}),e.alias("each","forEach"),e.implement({has:Object.prototype.hasOwnProperty,keyOf:function(e){return Object.keyOf(this,e)},hasValue:function(e){return Object.contains(this,e)},extend:function(t){return e.each(t||{},(function(t,i){e.set(this,i,t)}),this),this},combine:function(t){return e.each(t||{},(function(t,i){e.include(this,i,t)}),this),this},erase:function(e){return this.hasOwnProperty(e)&&delete this[e],this},get:function(e){return this.hasOwnProperty(e)?this[e]:null},set:function(e,t){return(!this[e]||this.hasOwnProperty(e))&&(this[e]=t),this},empty:function(){return e.each(this,(function(e,t){delete this[t]}),this),this},include:function(e,t){return null==this[e]&&(this[e]=t),this},map:function(t,i){return new e(Object.map(this,t,i))},filter:function(t,i){return new e(Object.filter(this,t,i))},every:function(e,t){return Object.every(this,e,t)},some:function(e,t){return Object.some(this,e,t)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(e){return Object.toQueryString(this,e)}}),e.alias({indexOf:"keyOf",contains:"hasValue"})}}(),Hash.implement({getFromPath:function(e){return Object.getFromPath(this,e)},cleanValues:function(e){return new Hash(Object.cleanValues(this,e))},run:function(){Object.run(arguments)}}),Number.implement({format:function(e){var t=this;e=e?Object.clone(e):{};var i=function(t){return null!=e[t]?e[t]:Locale.get("Number."+t)},n=0>t,s=i("decimal"),o=i("precision"),a=i("group"),r=i("decimals");if(n){var l=i("negative")||{};null==l.prefix&&null==l.suffix&&(l.prefix="-"),["prefix","suffix"].each((function(t){l[t]&&(e[t]=i(t)+l[t])})),t=-t}var h,d=i("prefix"),c=i("suffix");if(""!==r&&r>=0&&20>=r&&(t=t.toFixed(r)),o>=1&&21>=o&&(t=(+t).toPrecision(o)),t+="",!1===i("scientific")&&t.indexOf("e")>-1){var u=t.split("e"),m=+u[1];if(t=u[0].replace(".",""),0>m){for(m=-m-1,(h=u[0].indexOf("."))>-1&&(m-=h-1);m--;)t="0"+t;t="0."+t}else for((h=u[0].lastIndexOf("."))>-1&&(m-=u[0].length-h-1);m--;)t+="0"}if("."!=s&&(t=t.replace(".",s)),a){h=(h=t.lastIndexOf(s))>-1?h:t.length;for(var p=t.substring(h),f=h;f--;)(h-f-1)%3==0&&f!=h-1&&(p=a+p),p=t.charAt(f)+p;t=p}return d&&(t=d+t),c&&(t+=c),t},formatCurrency:function(e){var t=Locale.get("Number.currency")||{};return null==t.scientific&&(t.scientific=!1),t.decimals=null!=e?e:null==t.decimals?2:t.decimals,this.format(t)},formatPercentage:function(e){var t=Locale.get("Number.percentage")||{};return null==t.suffix&&(t.suffix="%"),t.decimals=null!=e?e:null==t.decimals?2:t.decimals,this.format(t)}}),function(){var e=function(){return this.get("value")},t=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[A-Fa-f0-9:]+\]|[^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(e,i){this.setOptions(i);var n=this.options.base||t.base;e||(e=n),e&&e.parsed?this.parsed=Object.clone(e.parsed):this.set("value",e.href||e.toString(),!!n&&new t(n))},parse:function(e,t){var i=e.match(this.regex);return!!i&&(i.shift(),this.merge(i.associate(this.parts),t))},merge:function(e,t){return!!(e&&e.scheme||t&&t.scheme)&&(t&&this.parts.every((function(i){return!e[i]&&(e[i]=t[i]||"",!0)})),e.port=e.port||this.schemes[e.scheme.toLowerCase()],e.directory=e.directory?this.parseDirectory(e.directory,t?t.directory:""):"/",e)},parseDirectory:function(e,i){if(!(e=("/"==e.substr(0,1)?"":i||"/")+e).test(t.regs.directoryDot))return e;var n=[];return e.replace(t.regs.endSlash,"").split("/").each((function(e){".."==e&&n.length>0?n.pop():"."!=e&&n.push(e)})),n.join("/")+"/"},combine:function(e){return e.value||e.scheme+"://"+(e.user?e.user+(e.password?":"+e.password:"")+"@":"")+(e.host||"")+(e.port&&e.port!=this.schemes[e.scheme]?":"+e.port:"")+(e.directory||"/")+(e.file||"")+(e.query?"?"+e.query:"")+(e.fragment?"#"+e.fragment:"")},set:function(e,i,n){if("value"==e){var s=i.match(t.regs.scheme);s&&(s=s[1]),s&&null==this.schemes[s.toLowerCase()]?this.parsed={scheme:s,value:i}:this.parsed=this.parse(i,(n||this).parsed)||(s?{scheme:s,value:i}:{value:i})}else"data"==e?this.setData(i):this.parsed[e]=i;return this},get:function(e,t){switch(e){case"value":return this.combine(this.parsed,!!t&&t.parsed);case"data":return this.getData()}return this.parsed[e]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(e,t){var i=this.get(t||"query");if(!i&&0!==i)return e?null:{};var n=i.parseQueryString();return e?n[e]:n},setData:function(e,t,i){if("string"==typeof e){var n=this.getData();n[arguments[0]]=arguments[1],e=n}else t&&(e=Object.merge(this.getData(null,i),e));return this.set(i||"query",Object.toQueryString(e))},clearData:function(e){return this.set(e||"query","")},toString:e,valueOf:e});t.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/},t.base=new t(Array.convert(document.getElements("base[href]",!0)).getLast(),{base:document.location}),String.implement({toURI:function(e){return new t(this,e)}})}(),URI=Class.refactor(URI,{combine:function(e,t){if(!t||e.scheme!=t.scheme||e.host!=t.host||e.port!=t.port)return this.previous.apply(this,arguments);var i=e.file+(e.query?"?"+e.query:"")+(e.fragment?"#"+e.fragment:"");if(!t.directory)return(e.directory||(e.file?"":"./"))+i;var n,s=t.directory.split("/"),o=e.directory.split("/"),a="",r=0;for(n=0;n<s.length&&n<o.length&&s[n]==o[n];n++);for(r=0;r<s.length-n-1;r++)a+="../";for(r=n;r<o.length-1;r++)a+=o[r]+"/";return(a||(e.file?"":"./"))+i},toAbsolute:function(e){return(e=new URI(e))&&e.set("directory","").set("file",""),this.toRelative(e)},toRelative:function(e){return this.get("value",new URI(e))}}),function(){var e=this.Asset={javascript:function(e,t){t||(t={});var i=new Element("script",{src:e,type:"text/javascript"}),n=t.document||document,s=t.onload||t.onLoad;return delete t.onload,delete t.onLoad,delete t.document,s&&(i.addEventListener?i.addEvent("load",s):i.addEvent("readystatechange",(function(){["loaded","complete"].contains(this.readyState)&&s.call(this)}))),i.set(t).inject(n.head)},css:function(e,t){t||(t={});var i=t.onload||t.onLoad,n=t.document||document,s=t.timeout||3e3;["onload","onLoad","document"].each((function(e){delete t[e]}));var o=new Element("link",{type:"text/css",rel:"stylesheet",media:"screen",href:e}).setProperties(t).inject(n.head);if(i){var a=!1,r=0,l=function(){for(var e=document.styleSheets,t=0;t<e.length;t++){var n=e[t],h=n.ownerNode?n.ownerNode:n.owningElement;if(h&&h==o)return a=!0,i.call(o)}return r++,!a&&s/50>r?setTimeout(l,50):void 0};setTimeout(l,0)}return o},image:function(e,t){t||(t={});var i=new Image,n=document.id(i)||new Element("img");return["load","abort","error"].each((function(e){var s="on"+e,o="on"+e.capitalize(),a=t[s]||t[o]||function(){};delete t[o],delete t[s],i[s]=function(){i&&(n.parentNode||(n.width=i.width,n.height=i.height),i=i.onload=i.onabort=i.onerror=null,a.delay(1,n,n),n.fireEvent(e,n,1))}})),i.src=n.src=e,i&&i.complete&&i.onload.delay(1),n.set(t)},images:function(t,i){t=Array.convert(t);var n=function(){},s=0;return i=Object.merge({onComplete:n,onProgress:n,onError:n,properties:{}},i),new Elements(t.map((function(n,o){return e.image(n,Object.append(i.properties,{onload:function(){s++,i.onProgress.call(this,s,o,n),s==t.length&&i.onComplete()},onerror:function(){s++,i.onError.call(this,s,o,n),s==t.length&&i.onComplete()}}))})))}}}(),function(){var e=this.Color=new Type("Color",(function(e,t){switch(arguments.length>=3?(t="rgb",e=Array.slice(arguments,0,3)):"string"==typeof e&&(e=e.match(/rgb/)?e.rgbToHex().hexToRgb(!0):e.match(/hsb/)?e.hsbToRgb():e.hexToRgb(!0)),t=t||"rgb"){case"hsb":var i=e;(e=e.hsbToRgb()).hsb=i;break;case"hex":e=e.hexToRgb(!0)}return e.rgb=e.slice(0,3),e.hsb=e.hsb||e.rgbToHsb(),e.hex=e.rgbToHex(),Object.append(e,this)}));e.implement({mix:function(){var t=Array.slice(arguments),i="number"==typeOf(t.getLast())?t.pop():50,n=this.slice();return t.each((function(t){t=new e(t);for(var s=0;3>s;s++)n[s]=Math.round(n[s]/100*(100-i)+t[s]/100*i)})),new e(n,"rgb")},invert:function(){return new e(this.map((function(e){return 255-e})))},setHue:function(t){return new e([t,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(t){return new e([this.hsb[0],t,this.hsb[2]],"hsb")},setBrightness:function(t){return new e([this.hsb[0],this.hsb[1],t],"hsb")}}),this.$RGB=function(t,i,n){return new e([t,i,n],"rgb")},this.$HSB=function(t,i,n){return new e([t,i,n],"hsb")},this.$HEX=function(t){return new e(t,"hex")},Array.implement({rgbToHsb:function(){var e=this[0],t=this[1],i=this[2],n=0,s=Math.max(e,t,i),o=s-Math.min(e,t,i),a=s/255,r=0!=s?o/s:0;if(0!=r){var l=(s-e)/o,h=(s-t)/o,d=(s-i)/o;n=e==s?d-h:t==s?2+l-d:4+h-l,0>(n/=6)&&n++}return[Math.round(360*n),Math.round(100*r),Math.round(100*a)]},hsbToRgb:function(){var e=Math.round(this[2]/100*255);if(0==this[1])return[e,e,e];var t=this[0]%360,i=t%60,n=Math.round(this[2]*(100-this[1])/1e4*255),s=Math.round(this[2]*(6e3-this[1]*i)/6e5*255),o=Math.round(this[2]*(6e3-this[1]*(60-i))/6e5*255);switch(Math.floor(t/60)){case 0:return[e,o,n];case 1:return[s,e,n];case 2:return[n,e,o];case 3:return[n,s,e];case 4:return[o,n,e];case 5:return[e,n,s]}return!1}}),String.implement({rgbToHsb:function(){var e=this.match(/\d{1,3}/g);return e?e.rgbToHsb():null},hsbToRgb:function(){var e=this.match(/\d{1,3}/g);return e?e.hsbToRgb():null}})}(),function(){this.Group=new Class({initialize:function(){this.instances=Array.flatten(arguments)},addEvent:function(e,t){var i=this.instances,n=i.length,s=n,o=new Array(n),a=this;i.each((function(r,l){r.addEvent(e,(function(){o[l]||s--,o[l]=arguments,s||(t.call(a,i,r,o),s=n,o=new Array(n))}))}))}})}(),Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:!0},initialize:function(e,t){this.parent(e,t),this.load()},save:function(){var e=JSON.encode(this.hash);return!(!e||e.length>4096||("{}"==e?this.dispose():this.write(e),0))},load:function(){return this.hash=new Hash(JSON.decode(this.read(),!0)),this}}),Hash.each(Hash.prototype,(function(e,t){"function"==typeof e&&Hash.Cookie.implement(t,(function(){var t=e.apply(this.hash,arguments);return this.options.autoSave&&this.save(),t}))})),function(){var e=this.Table=function(){this.length=0;var e=[],t=[];this.set=function(i,n){var s=e.indexOf(i);if(-1==s){var o=e.length;e[o]=i,t[o]=n,this.length++}else t[s]=n;return this},this.get=function(i){var n=e.indexOf(i);return-1==n?null:t[n]},this.erase=function(i){var n=e.indexOf(i);return-1!=n?(this.length--,e.splice(n,1),t.splice(n,1)[0]):null},this.each=this.forEach=function(i,n){for(var s=0,o=this.length;o>s;s++)i.call(n,e[s],t[s],this)}};this.Type&&new Type("Table",e)}(),"Affinity"in window||(window.Affinity={}),"undefined"==typeof console&&(console={log:function(){}}),"undefined"==typeof MooTools)throw new ReferenceError("This site requires MooTools 1.4.5 and MooTools.More 1.4.0.1");var doc=document.documentElement;doc.setAttribute("data-useragent",navigator.userAgent),"events"in Affinity||(Affinity.events={}),Affinity.mobile=!1,Affinity.events={over:"mouseover",out:"mouseout",overAll:"mouseenter",outAll:"mouseleave",start:"mousedown",move:"mousemove",end:"mouseup",click:"click"},Affinity.icons={AddToList:"&#xe096;",Air:"&#xe047;",Alarm:"&#xe855;",AlarmAdd:"&#xe856;",Archive:"&#xe0a2;",ArrowDown:"&#xe0c0;",ArrowDownCircle:"&#xe0c8;",ArrowDownSmall:"&#xe0c4;",ArrowLeft:"&#xe0bf;",ArrowLeftCircle:"&#xe0c7;",ArrowLeftSmall:"&#xe0c3;",ArrowLineBigDown:"&#xe0d8;",ArrowLineBigLeft:"&#xe0d7;",ArrowLineBigRight:"&#xe0da;",ArrowLineBigUp:"&#xe0d9;",ArrowLineDown:"&#xe0d0;",ArrowLineLeft:"&#xe0cf;",ArrowLineRight:"&#xe0d2;",ArrowLineSmallDown:"&#xe0d4;",ArrowLineSmallLeft:"&#xe0d3;",ArrowLineSmallRight:"&#xe0d6;",ArrowLineSmallUp:"&#xe0d5;",ArrowLineUp:"&#xe0d1;",ArrowLongDown:"&#xe0dc;",ArrowLongLeft:"&#xe0db;",ArrowLongRight:"&#xe0de;",ArrowLongUp:"&#xe0dd;",ArrowRight:"&#xe0c2;",ArrowRightCircle:"&#xe0ca;",ArrowRightSmall:"&#xe0c6;",ArrowUp:"&#xe0c1;",ArrowUpCircle:"&#xe0c9;",ArrowUpSmall:"&#xe0c5;",ArrowheadDown:"&#xe0cc;",ArrowheadLeft:"&#xe0cb;",ArrowheadRight:"&#xe0ce;",ArrowheadUp:"&#xe0cd;",ArrowheadUpDown:"&#xe0df;",Back:"&#xe093;",Bag:"&#xe03b;",Barcode:"&#xe0fc;",Battery:"&#xe04d;",Bell:"&#xe029;",Blocked:"&#xe084;",Book:"&#xe039;",Book2:"&#xe0ac;",Bookmark:"&#xe0aa;",Bookmarks:"&#xe0ab;",Box:"&#xe06a;",Braces:"&#xe104;",Briefcase:"&#xe046;",Brightness:"&#xe060;",BrogressThird:"&#xe05c;",Browser:"&#xe058;",Brush:"&#xe053;",Bucket:"&#xe04e;",BulletList:"&#xe095;",Calendar:"&#xe041;",Camera:"&#xe030;",Cancel:"&#xe083;",Car:"&#xe909;",Cart:"&#xe069;",Cc:"&#xe0e3;",CcBy:"&#xe0e4;",CcNc:"&#xe0e5;",CcNcEu:"&#xe0e6;",CcNcJp:"&#xe0e7;",CcNd:"&#xe0e9;",CcPd:"&#xe0ea;",CcSa:"&#xe0e8;",CcShare:"&#xe0ec;",CcShare3:"&#xe0ed;",CcZero:"&#xe0eb;",Ccw:"&#xe08c;",Cd:"&#xe045;",Chat:"&#xe021;",Clipboard:"&#xe068;",Clock:"&#xe03f;",Cloud:"&#xe0a8;",Code:"&#xe061;",CodeA:"&#xe0ee;",CodeD:"&#xe0f0;",CodeH:"&#xe0ef;",CodeM:"&#xe10e;",CodeP:"&#xe10f;",CodeR:"&#xe0f1;",CodeS:"&#xe0f2;",Cog:"&#xe02c;",Comment:"&#xe022;",Compare:"&#xe103;",Compass:"&#xe016;",Cone:"&#xe055;",CreditCard:"&#xe065;",Cross:"&#xe07a;",CrossRound:"&#xe080;",CrossSquare:"&#xe07d;",Csharp:"&#xe0ff;",Cup:"&#xe051;",Cw:"&#xe08b;",Cycle:"&#xe08a;",Database:"&#xe066;",Directions:"&#xe005;",Docs:"&#xe09c;",DollarRound:"&#xe0fe;",Dot:"&#xe0e2;",Dots:"&#xe0e1;",DotsVert:"&#xe000;",Download:"&#xe0a5;",Drive:"&#xe050;",Droplet:"&#xe044;",Droplets:"&#xe06f;",Earth:"&#xe056;",Education:"&#xe038;",Eightball:"&#xe901;",Ellipsis:"&#xe0e0;",EmptyInbox:"&#xe00b;",Export:"&#xe013;",Extension:"&#xe87b;",Eye:"&#xe03e;",Feather:"&#xe009;",FieldEdit:"&#xe001;",FileExcel:"&#xe908;",FilePdf:"&#xe902;",FileWord:"&#xe907;",First:"&#xe0b3;",Flag:"&#xe02b;",Flashlight:"&#xe027;",FlowBranch:"&#xe0bb;",FlowCascade:"&#xe0ba;",FlowLine:"&#xe0bd;",FlowParallel:"&#xe0be;",FlowTree:"&#xe0bc;",Folder:"&#xe0a1;",Forward:"&#xe00e;",Gauge:"&#xe049;",Ghost:"&#xe0fa;",Gift:"&#xe105;",GraphBars:"&#xe073;",GraphLinefill:"&#xe074;",GraphPie:"&#xe072;",GraphStatistics:"&#xe071;",Grid:"&#xe070;",HeartEmpty:"&#xe01c;",HeartFull:"&#xe01b;",HelpRound:"&#xe088;",History:"&#xe092;",Hourglass:"&#xe048;",House:"&#xe024;",Incident:"&#xe548;",Infinity:"&#xe063;",Info:"&#xe085;",InfoRound:"&#xe086;",Install:"&#xe0a7;",Key:"&#xe04c;",Keyboard:"&#xe057;",Kiwi:"&#xe102;",Lab:"&#xe903;",Landscape:"&#xe09d;",Language:"&#xe04a;",Last:"&#xe0b4;",Layout:"&#xe097;",Leaf:"&#xe034;",LifeRing:"&#xe03d;",LightBulb:"&#xe064;",Lightning:"&#xe042;",Link:"&#xe02a;",List:"&#xe098;",Location:"&#xe014;",LocationArrow:"&#xe017;",Lock:"&#xe075;",LockApproved:"&#xe90c;",LockDeclined:"&#xe90d;",LockOpen:"&#xe90a;",LockPaid:"&#xe90e;",LockSubmitted:"&#xe90b;",Login:"&#xe078;",Logout:"&#xe077;",Loop:"&#xe091;",Magnet:"&#xe04f;",Mail:"&#xe006;",Map:"&#xe015;",Megaphone:"&#xe031;",Microphone:"&#xe040;",Minus:"&#xe081;",MinusRound:"&#xe07e;",MinusSquare:"&#xe07b;",Mobile:"&#xe003;",Moneybag:"&#xe0fd;",Moon:"&#xe032;",MoreLeft:"&#xe10a;",MoreRight:"&#xe10d;",Mouse:"&#xe004;",Music:"&#xe036;",MusicSemi:"&#xe035;",MusicSquare:"&#xe0a0;",Mute:"&#xe0b9;",Network:"&#xe04b;",New:"&#xe037;",Newspaper:"&#xe03a;",Next:"&#xe0b1;",Page:"&#xe099;",PageEmpty:"&#xe09b;",PageFull:"&#xe09a;",Palette:"&#xe033;",Paperclip:"&#xe00a;",Paperplane:"&#xe007;",Pause:"&#xe0ae;",Pencil:"&#xe008;",Phone:"&#xe002;",Pictures:"&#xe09e;",Pin:"&#xe904;",Plane:"&#xe03c;",Play:"&#xe0ad;",Plugin:"&#xe905;",Plus:"&#xe082;",PlusRound:"&#xe07f;",PlusSquare:"&#xe07c;",Poop:"&#xe101;",Popup:"&#xe025;",Previous:"&#xe0b2;",Printer:"&#xe028;",ProgressEmpty:"&#xe05d;",ProgressFull:"&#xe05a;",ProgressHalf:"&#xe05b;",Prompt:"&#xe109;",PromptAlert:"&#xe10c;",PromptInfo:"&#xe10b;",Publish:"&#xe059;",Qrcode:"&#xe0fb;",Question:"&#xe087;",Quote:"&#xe023;",Record:"&#xe0af;",Repeat:"&#xe090;",Reply:"&#xe00c;",ReplyAll:"&#xe00d;",ResizeEnlarge:"&#xe0b5;",ResizeShrink:"&#xe0b6;",Return:"&#xe08f;",ReturnBack:"&#xe08e;",Rocket:"&#xe052;",Rss:"&#xe06c;",Save:"&#xe0a6;",Scaledown:"&#xe107;",Scaleup:"&#xe108;",Schedule:"&#xe900;",Screen:"&#xe062;",Search:"&#xe026;",Sharable:"&#xe01a;",Share:"&#xe019;",Shield:"&#xe906;",Shuffle:"&#xe08d;",Sound:"&#xe0b8;",StarEmpty:"&#xe01e;",StarFull:"&#xe01d;",Stop:"&#xe0b0;",Suitcase:"&#xe054;",Sun:"&#xe05f;",SunSmall:"&#xe05e;",Switch:"&#xe094;",Sync:"&#xe100;",Tag:"&#xe02f;",Target:"&#xe018;",Thermometer:"&#xe06e;",ThumbsDown:"&#xe020;",ThumbsUp:"&#xe01f;",Thunder:"&#xe043;",Tick:"&#xe079;",Ticket:"&#xe06b;",Tools:"&#xe02d;",Traffic:"&#xe565;",Trash:"&#xe0a3;",Trophy:"&#xe02e;",Upload:"&#xe0a4;",Upload2:"&#xe0a9;",User:"&#xe0f3;",UserAdd:"&#xe0f5;",UserAddOld:"&#xe011;",UserBlock:"&#xe0f7;",UserBoss:"&#xe0f8;",UserCheck:"&#xe18a;",UserCheckOutline:"&#xe18b;",UserDel:"&#xe0f6;",UserOld:"&#xe00f;",Users:"&#xe0f4;",UsersOld:"&#xe010;",Vcard:"&#xe012;",Video:"&#xe09f;",Voicemail:"&#xe067;",Volume:"&#xe0b7;",Warning:"&#xe089;",Wireless:"&#xe06d;",Wrench:"&#xe0f9;",Zzz:"&#xe106;"},window.UIIcons||(window.UIIcons=Affinity.icons),Affinity.icons.getIcon=function(e,t){return e&&e in Affinity.icons||e&&(e=e.replace("icon","").trim().camelCase())in Affinity.icons?Affinity.icons[e]:t&&t in Affinity.icons?Affinity.icons[t]:""},Affinity.appname="none",Affinity.apiversion=1,Affinity.urlroot="",Affinity.authroot="",Affinity.apiroot="",Affinity.zelosroot="",Affinity.lookupapi="",Affinity.uisession=String.uniqueID(),Affinity.uiready=!1,Affinity.login=null,Affinity.datalist=!1,Affinity.loaders={},Affinity.loaders.dark="data:image/gif;base64,R0lGODlhEAAQAPQAADMzM8zMzDs7O3h4eERERKGhoYKCgszMzJaWlra2tmNjY1lZWb+/v21tbcjIyKqqqoyMjAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.light="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zMzM/Ly8qGhoebm5mpqapSUlDMzM3l5eU9PT7y8vMrKykJCQq+vrzY2Nl5eXoaGhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.blue="data:image/gif;base64,R0lGODlhEAAQAPQAAJrS7v///5/U7sfm9aXX7+Lx+c3o9v///9vu+O/3+7rg87Pd8vb6/MDi9Pz9/ej0+tXr9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.large={},Affinity.loaders.large.light="data:image/gif;base64,R0lGODlhIAAgAPMAAO/v7wAAALq6unx8fKurq5CQkDIyMlBQUMvLy9bW1rCwsBwcHAMDAwAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==",Affinity.loaders.large.dark="data:image/gif;base64,R0lGODlhIAAgAPMAADMzM////19fX5SUlGxsbIKCgtLS0rm5uVFRUUdHR2dnZ+bm5vr6+gAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==",Affinity.agent=window.navigator.userAgent,Affinity.oldess=!1,Affinity.oldessLaunched=!1,Affinity.oldessFrame=!1,Affinity.oldessWindow=!1,Affinity.UI={},Affinity.UI.lookups={},Affinity.UI.lookupLoaders=[],Affinity.UI.displaylookups={},Affinity.UI.displaylookupLoaders=[],Affinity.UI.dependancies={},Affinity.UI.dependancyLoaders=[],Affinity.UI.autocomplete={},Affinity.UI.lastAutoKill={},Affinity.UI.delayAutoKill=function(e,t){document.getElement("."+t)&&(document.getElement("."+t).removeEvents(),document.getElement("."+t).destroy()),window.Affinity.UI.lastAutoKill[e]=null,delete window.Affinity.UI.lastAutoKill[e]};var datalistTest=document.createElement("datalist");if("options"in datalistTest&&(Affinity.datalist=!0),datalistTest=null,delete datalistTest,Affinity.UI.scrolling=!1,Affinity.UI.autoscroll=function(e){var t=window;if(Affinity.oldessFrame)try{t=window.parent.window}catch(e){}try{var i=t.document.documentElement,n=t.document.body,s=i&&i.scrollTop||n&&n.scrollTop||0;e>0&&t.scrollTo(0,s+10),e<0&&t.scrollTo(0,s-10)}catch(e){}},document.addEvent(Affinity.events.move,(function(e){if(Affinity.UI.drageventFired){var t=e.client.y,i=window.innerHeight||window.document.documentElement.clientHeight,n=50,s=i-50;if(Affinity.oldessFrame)try{var o=window.parent,a=o.document.documentElement,r=o.document.body;i=o.innerHeight||o.document.documentElement.clientHeight;var l=a&&a.scrollTop||r&&r.scrollTop||0,h=o.document.getElementById("ctl00_MainPanel"),d=l-(document.documentMode&&document.documentMode<9?h.querySelectorAll(".ContentBody")[0]:h.getElementsByClassName("ContentBody")[0]).offsetTop;n=50+d,s=d+i-50}catch(e){}t>s?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[1])):t<n?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[-1])):Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}})),document.addEvent(Affinity.events.end,(function(){Affinity.UI.drageventFired=!1,Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))})),Affinity.Konami=new Class({Implements:[Options],options:{onSuccess:function(){}},input:"",pattern:"38384040373937396665",initialize:function(e){this.setOptions(e),document.addEvent("keydown",function(e){this.input+=e.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input==this.pattern&&this.options.onSuccess()}.bind(this))}}),Affinity.RickRoll=new Class({Implements:[Options],Binds:["inject","destroy"],options:{},input:"",ytBox:!1,pattern:"8273677582797676",initialize:function(e){this.setOptions(e),document.addEvent("keydown",function(e){this.input+=e.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input==this.pattern&&this.inject()}.bind(this))},inject:function(){this.destroy(),this.ytBox=new Element("div").setStyles({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.8)","text-align":"center","z-index":99999999999}).inject(document.body,"bottom").set("html",'<iframe width="420" height="315" style="position:fixed;top:50%;left:50%;margin:-157px 0 0 -210px;" src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?rel=0&amp;autoplay=1&amp;showinfo=0" frameborder="0" allowfullscreen></iframe>').addEvent("click",this.destroy)},destroy:function(){this.ytBox&&(this.ytBox.removeEvents(),this.ytBox.destroy())}}),new Affinity.RickRoll,Affinity.CookieMonster=new new Class({Read:function(e){if(!Affinity.isie)return Cookie.read(e);var t=document.cookie.indexOf(e+"=");if(-1!=t){t+=e.length+1;var i=document.cookie.indexOf(";",t);return-1==i&&(i=document.cookie.length),unescape(document.cookie.substring(t,i))}},Write:function(e,t,i){var n=new URI(window.location.href).parsed.host,s=new Date;if("null"!==typeOf(i)&&!isNaN(i)&&parseFloat(i)>0){var o=new Date(s.getTime()+6e4*i),a=s.toUTCString(),r=o.toUTCString();log("&#169; Cookie Write Expires - name: "+e+", value: "+t),log("  expires: "+r+", now: "+a+", expires value: "+i+", in days: "+parseFloat(i)/1440+", domain: "+n),Affinity.isie?document.cookie=e+"="+escape(t)+"; expires="+r+"; domain:"+n:Cookie.write(e,t,{duration:parseFloat(i)/1440})}else log("&#169; Cookie Write - name: "+e+", value: "+t),Affinity.isie?document.cookie=e+"="+escape(t)+";":Cookie.write(e,t)},Delete:function(e){if(log("&#169; Cookie Delete - name: "+e),Affinity.isie){document.cookie=e+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;";try{Cookie.dispose(e)}catch(e){}}else Cookie.dispose(e)}}),Affinity.logger=new new Class({Binds:["build","enable","disable","log","clear","open","close"],enabled:!1,initialize:function(){window.log=function(){}},build:function(){if(!Affinity.uiready)return window.removeEvent("UiReady",this.build),void window.addEvent("UiReady",this.build);window.removeEvent("UiReady",this.build),document.id("_log")&&document.id("_log").destroy(),document.id("_logbutton")&&document.id("_logbutton").destroy(),this.logBox=new Element("div",{id:"_log"}).inject(document.body,"bottom"),this.logsBox=new Element("div",{html:"",class:"logs"}).inject(this.logBox,"top"),this.closeButton=new Element("div",{html:"close",class:"close"}).inject(this.logBox,"top"),this.clearButton=new Element("div",{html:"clear",class:"clear"}).inject(this.logBox,"top"),this.hiddenButton=new Element("div",{id:"_logbutton"}).inject(this.logBox,"after"),this.hiddenButton.setStyles({position:"absolute",top:5,left:5,width:30,height:30,"z-index":9999999998}),this.logBox.setStyles({position:"absolute",top:40,left:5,width:"80%",height:"80%",border:"1px solid black","background-color":"#fff",color:"000","z-index":9999999999,"-webkit-transform":"translateX(0)",transform:"translateX(0)",display:"none"}),this.logsBox.setStyles({width:"100%",height:"100%",padding:10,overflow:"scroll","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),this.clearButton.setStyles({position:"absolute",top:10,right:80,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.setStyles({position:"absolute",top:10,right:30,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.addEvent(Affinity.events.click,this.close),this.clearButton.addEvent(Affinity.events.click,this.clear),this.hiddenButton.addEvent(Affinity.events.click,this.open),this.log("// log started "+new Date),window.log=this.log,this.enabled=!0,window.fireEvent("LogReady")},enable:function(){this.destroy(),this.build(),this.open()},disable:function(){this.destroy()},log:function(e){if(this.enabled){var t="object"===typeOf(e)||"array"===typeOf(e)?JSON.stringify(e,null,2):"element"===typeOf(e)?"element type: "+e.get("tag")+"\r\n"+JSON.stringify(e.getProperties("id","class","style","src","title","alt"),null,2):e;this.logsBox.adopt(new Element("<pre>",{html:t}))}},clear:function(){this.enabled&&(this.logsBox.empty(),this.log("// log cleared "+new Date))},open:function(){this.enabled&&("none"===this.logBox.getStyle("display")?this.logBox.setStyle("display","block"):this.logBox.setStyle("display","none"))},close:function(){this.enabled&&("block"===this.logBox.getStyle("display")?this.logBox.setStyle("display","none"):this.logBox.setStyle("display","block"))},destroy:function(){window.removeEvent("UiReady",this.build),this.enabled=!1,this.closeButton&&this.closeButton.remveEvents(),this.clearButton&&this.clearButton.remveEvents(),this.hiddenButton&&this.hiddenButton.remveEvents(),this.logBox&&this.logBox.destroy(),window.log=function(){}}}),Affinity.SmartClose=new Class({Binds:["isActive","checkActive","isOver","setClose","overAll","outAll","windowClick"],over:!1,isOverCheckTimer:!1,initialize:function(e,t){if(Affinity.mobile)return"is mobile";this.class="smart-close-"+String.uniqueID(),this.element=e,this.element.addClass(this.class),this.element.isOver=this.isOver,this.element.addEvent(Affinity.events.overAll,this.overAll),this.element.addEvent(Affinity.events.outAll,this.outAll),this.element.addEvent("focus",this.setClose)},isActive:function(){return!!document.activeElement&&(document.activeElement===this.element||(document.activeElement.getParent("."+this.class),this.element),!0)},checkActive:function(){this.isActive()||(this.over=!1,this.windowClick())},isOver:function(){return this.isActive()||(this.over=!1),this.over},setClose:function(){window.removeEvent(Affinity.events.click,this.windowClick),window.addEvent(Affinity.events.click,this.windowClick)},overAll:function(){clearTimeout(this.isOverCheckTimer),this.setClose(),this.over=!0,this.isOverCheckTimer=this.checkActive.delay(1e3,this)},outAll:function(){clearTimeout(this.isOverCheckTimer),this.over=!1},windowClick:function(){this.over||(this.element.fireEvent("SmartClose"),window.removeEvent(Affinity.events.click,this.windowClick))}}),Affinity.UI.mobileZooming=!1,Affinity.mobile&&window.addEvents({touchmove:function(e){2===e.touches.length&&(Affinity.UI.mobileZooming=!0)},touchend:function(e){if(Affinity.UI.mobileZooming){var t=document.createEvent("HTMLEvents");t.initEvent("resize",!0,!1),window.dispatchEvent(t)}Affinity.UI.mobileZooming=!1}}),Affinity.GetCacheSafePath=function(e){return Affinity.isie&&"string"===typeOf(e)?e+(e.contains("?")?"&ran=":"?ran=")+String.uniqueID()+"-"+Date.parse(new Date).format("%s"):e},Locale.define("en-NZ","Date",{dateOrder:["date","month","year","/"],shortDate:"%D/%M/%Y",shortTime:"%I:%M%p",AM:"am",PM:"pm"}).inherit("en-US","Date"),Locale.define("en-AU").inherit("en-NZ","Date"),Locale.use("en-NZ"),Date.implement({toZelos:function(){return Date.parse(this.format("%d/%m/%Y %H:%M:%S")).format("%Y-%m-%dT%H:%M:%S")},toTime:function(){try{return this.format("%k:%M:%S")}catch(e){return"Invalid Date"}},toTime24:function(){this.toTime()},toTime12:function(){try{return this.format("%l:%M:%S %p").toLowerCase()}catch(e){return"Invalid Date"}},toSimple:function(){try{return this.format("%d-%m-%Y")}catch(e){return"Invalid Date"}},toSimpleDateTime:function(){try{return this.format("%d-%m-%Y %k:%M:%S")}catch(e){return"Invalid Date"}},toServer:function(){try{return this.format("%d.%m.%Y %k:%M:%S %z")}catch(e){return"Invalid Date"}},toFriendly:function(){try{return this.format("%A %B %e%o %Y").replace(/  /gi," ")}catch(e){return"Invalid Date"}},toFriendlyShort:function(){try{return this.format("%a %b %e%o %Y").replace(/  /gi," ")}catch(e){return"Invalid Date"}},toWords:function(){try{return this.timeDiffInWords()}catch(e){return"Invalid Date"}},toWordsShort:function(){try{return this.timeDiffInWords().replace(/year/g,"yr").replace(/month/g,"mnth").replace(/hour/g,"hr").replace(/minute/g,"min").replace(/second/g,"sec").replace(/about/g,"")}catch(e){return"Invalid Date"}},matches:function(e,t,i){if("null"!==typeOf(e)){var n=Date.parse(this),s=Date.parse(e);if(n&&s&&"date"==typeOf(n)&&"date"===typeOf(s)&&n.isValid()&&s.isValid()&&("boolean"===typeOf(t)&&t&&(n=n.setSeconds(0),s=s.setSeconds(0)),"boolean"===typeOf(i)&&i&&(n=n.setMilliseconds(0),s=s.setMilliseconds(0)),(n=n.getTime())===(s=s.getTime())))return!0}return!1},sameDay:function(e){if("null"!==typeOf(e)){var t=Date.parse(this),i=Date.parse(e);if(t&&i&&"date"==typeOf(t)&&"date"===typeOf(i)&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime())===(i=i.clearTime().getTime()))return!0}return!1}}),Date.defineFormat("zelos",(function(e){return e.toZelos()})),Date.CurentYear=(new Date).get("year"),Date.FormatStrings=[["christmas","12.25."+(Date.CurentYear+1)],["xmas","12.25."+(Date.CurentYear+1)],["newyear","1.1."+(Date.CurentYear+1)],["new year","1.1."+(Date.CurentYear+1)]],Date.TimeTravel=[["second",/(\+|\-)\s*[0-9]+( )*(seconds|second|sec|s)/],["minute",/(\+|\-)\s*[0-9]+( )*(minutes|minute|min|m)/],["hour",/(\+|\-)\s*[0-9]+( )*(hours|hour|h)/],["day",/(\+|\-)\s*[0-9]+( )*(days|day|d)/],["week",/(\+|\-)\s*[0-9]+( )*(weeks|week|w)/],["month",/(\+|\-)\s*[0-9]+( )*(months|month)/],["year",/(\+|\-)\s*[0-9]+( )*(years|year|y)/]],String.implement({toDate:function(){var e,t,i,n;if(Locale.use("en-GB"),s=this.toLowerCase().trim(),"now"===s)return new Date;for(s.contains("now ")&&(s=s.replace(/(now |today )/,(new Date).format("%k:%H:%S "))),/^\d+$/.test(s)&&s.length>=6&&(s=s.length>8?1e3*parseInt(s,10)+"":s.substr(0,2)+"."+s.substr(2,2)+"."+s.substr(4)),e=0;e<Date.FormatStrings.length;e++)if(s.contains(Date.FormatStrings[e][0])){s=s.replace(Date.FormatStrings[e][0],Date.FormatStrings[e][1]);break}for(e=0;e<Date.TimeTravel.length;e++)s.test(Date.TimeTravel[e][1])&&(i=(t=s.match(Date.TimeTravel[e][1])[0]).match(/[0-9]+/)[0],t.indexOf("+")&&(n=Date.parse(s.replace(t,"").trim()).decrement(Date.TimeTravel[e][0],parseFloat(i))),t.indexOf("-")&&(n=Date.parse(s.replace(t,"").trim()).increment(Date.TimeTravel[e][0],parseFloat(i))));n=null==n?Date.parse(s):n;try{return 0==n.format("%s")?"Invalid Date":n}catch(e){return"Invalid Date"}}}),Object.valueFromKeyString=function(e,t){for(var i=(t=(t=t.replace(/\[(\w+)\]/g,".$1")).replace(/^\./,"")).split("."),n=0,s=i.length;n<s;++n){var o=i[n];if(!(o in e))return!1;e=e[o]}return e},JSON.Unauthorized=function(e,t){var i=!1,n=typeOf(e);return"object"!==n&&"array"!==n||(e=JSON.encode(e),n="string"),"string"===n&&(e.test("unauthorized","gi")||e.test("unauthorised","gi")||e.test("/(401/)","gi")||e.test("/(403/)","gi"))&&(log("&#x270B; json response is unauthorized"+(null!==typeOf(t)?" ("+unescape(t)+")":"")+" &#x270B;"),window.prompts&&Affinity.prompts.hide(),window.fireEvent("unauthorized"),i=!0),e=null,i},Element.implement({hasWidget:function(e){return!!this.retrieve(e)},getWidget:function(e){return this.retrieve(e)?this.retrieve(e):!!this.retrieve("widget")&&this.retrieve("widget")},destroyWidget:function(e){var t=this.getWidget(e);return t&&"destroy"in t&&t.destroy(),delete t,null},exists:function(){try{if(document.contains(this))return this}catch(e){}return!1}}),DOMEvent.implement({getTarget:function(e){return this.target.hasClass(e)||this.target.get("id")===e?this.target:this.target.getParent("."+e)?this.target.getParent("."+e):this.target.getParent("#"+e)?this.target.getParent("#"+e):this.target}}),Element.implement({hasEvent:function(e,t){var i=this.retrieve("events");switch(i&&i[e]&&(null==t||i[e].keys.contains(t))){case null:case!1:case void 0:case 0:return!1;default:return!0}}}),Affinity.FormElement=new Class({Implements:[Options,Events],Binds:["clearEvents","setEvents","setValue","getValue","getDisplayValue","checkChanged","lookup","lookupComplete","destroy"],options:{},element:!1,dynamicContents:!1,dynamicFirstLoad:!0,defaultValue:"",changed:!1,initialize:function(e,t){this.setOptions(t),this.element=e,e.retrieve("defaultValue")||(this.element=e,this.setEvents(),this.defaultValue=e.value,this.element.store("defaultValue",this.defaultValue)),this.element.store("widget",this),this.element.store("elementWidget",this),this.element.addClass("widget"),this.lastValue=this.element.value},clearEvents:function(){this.element.removeEvent("input",this.checkChanged),this.element.removeEvent("lookup",this.lookup),this.element.removeEvent("lookupComplete",this.lookupComplete),this.element.removeEvent("change",this.checkChanged),this.element.removeEvent("blur",this.checkChanged)},setEvents:function(){this.clearEvents(),this.element.get("list")?this.element.addEvent("input",this.checkChanged):(this.element.addEvent("lookup",this.lookup),this.element.addEvent("lookupComplete",this.lookupComplete),this.element.addEvent("change",this.checkChanged),this.element.addEvent("blur",this.checkChanged))},getValue:function(){return this.element.value},setValue:function(e){this.element.value=e,this.defaultValue=this.element.value,this.lastValue=this.element.value,this.element.store("defaultValue",this.defaultValue),this.changed=!1},getDisplayValue:function(){return this.element.value},checkChanged:function(e){return("null"!==typeOf(e)&&"null"!==typeOf(e.target)?e.target.value:this.element.value)+""!=this.defaultValue+""?(this.changed=!0,(this.lastValue=this.element.value)&&this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:e}),this.lastValue=this.element.value):(this.changed=!1,this.element.fireEvent("restored",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"restored",originalEvent:e}),this.lastValue=this.element.value),this.changed},lookup:function(){this.dynamicContents=!0},lookupComplete:function(e){this.dynamicFirstLoad&&(this.defaultValue=e.defaultValue,this.element.store("defaultValue",this.defaultValue),this.dynamicFirstLoad=!1),this.checkChanged({target:this.element})},destroy:function(){this.clearEvents(),this.element.eliminate("defaultValue"),this.element.eliminate("elementWidget")}}),Element.implement({makeFormElement:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.FormElement(this),this}}),Affinity.ElementValueTracker=new Class({Implements:[Options,Events],Binds:["__removeEvents","__addEvents","__elementChanged","__elementBlured","__doChangeCheck","__doChangeCheckThrottled","addElement","removeElement","setValue","hasChanged","hasRestored","getValue","getDefault","getLast","changeStatus"],options:{},elements:[],values:[],valuesDefault:[],valuesLast:[],id:!1,initialize:function(e){this.id=String.uniqueID(),e&&!e.hasClass("has-change-tracker")&&this.addElement(e)},__removeEvents:function(e){e.removeEvent("change",this.__elementChanged),e.removeEvent("blur",this.__elementBlured)},__addEvents:function(e){e.addEvent("change",this.__elementChanged),e.addEvent("blur",this.__elementBlured)},__cloneValue:function(e){var t="number"===typeOf(e),i=(e+"").trim();return t?parseFloat(i):i},__sanatiseValue:function(e){try{return null==e||""===e.trim()?"":e}catch(t){return e}},__isSame:function(e,t){return(e+"").trim().toLowerCase()===(t+"").trim().toLowerCase()},__doChangeCheck:function(e){clearTimeout(this.__doChangeCheckThrottle),this.__doChangeCheckThrottle=this.__doChangeCheckThrottled.delay(100,this,[e])},__doChangeCheckThrottle:!1,__doChangeCheckThrottled:function(e){var t,i;e&&["object","event","domevent"].contains(typeOf(e))&&"target"in e&&this.elements.indexOf(e.target)>-1&&Array.each(this.elements,function(e,n){t=i=!1,this.values[n]=this.__sanatiseValue(e.value),this.__isSame(this.values[n],this.valuesDefault[n])?i=!0:t=!0,t&&(e.removeClass("value-restored").addClass("value-changed"),e.fireEvent("ElementChanged",{value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]}),this.fireEvent("ElementChanged",{value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]}),window.fireEvent("AnElementChanged",{target:this.elements[n],value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]})),i&&(e.removeClass("value-changed").addClass("value-restored"),e.fireEvent("ElementRestored",{value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]}),this.fireEvent("ElementRestored",{value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]}),window.fireEvent("AnElementRestored",{target:this.elements[n],value:this.values[n],last:this.valuesLast[n],default:this.valuesDefault[n]})),this.valuesLast[n]=this.values[n]}.bind(this))},__elementChanged:function(e){this.__doChangeCheck(e)},__elementBlured:function(e){this.__doChangeCheck(e)},addElement:function(e){if(!e.retrieve("changetracker")){var t="value"in e?e.value:"",i=e.get("data-default-value")?e.get("data-default-value"):t;-1===this.elements.indexOf(e)?(this.elements.push(e),this.values.push(t),this.valuesDefault.push(i),this.valuesLast.push(t),this.__removeEvents(e),this.__addEvents(e),e.addClass("has-change-tracker"),e.store("changetracker",this)):this.setValue(e,t)}},removeElement:function(e){if(-1!==this.elements.indexOf(e)){var t=this.elements.indexOf(e);this.elements.splice(t,1),this.values.splice(t,1),this.valuesLast.splice(t,1),this.valuesDefault.splice(t,1),this.__removeEvents(e),e.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),e.eliminate("changetracker")}},setValue:function(e,t){if(-1!==this.elements.indexOf(e)){var i=this.elements.indexOf(e);e.value=t,e.removeClass("value-restored").removeClass("value-changed"),this.values[i]=t,this.valuesDefault[i]=t,this.valuesLast[i]=t,this.__removeEvents(e),this.__addEvents(e)}else this.addElement(e)},hasChanged:function(){var e=!1;return Array.each(this.elements,function(t,i){t.hasClass("value-changed")&&(e=!0),this.__isSame(this.values[i],this.valuesDefault[i])||(e=!0)}.bind(this)),e},hasRestored:function(){var e=!1;return Array.each(this.elements,function(t){t.hasClass("value-restored")&&(e=!0)}.bind(this)),e},getValue:function(e){var t=this.elements.indexOf(e);if(-1!==t)return this.values[t];throw new Error("Target element not tracked")},getDefault:function(e){var t=this.elements.indexOf(e);if(-1!==t)return this.valuesDefault[t];throw new Error("Target element not tracked")},getLast:function(e){var t=this.elements.indexOf(e);if(-1!==t)return this.valuesLast[t];throw new Error("Target element not tracked")},changeStatus:function(){return{changed:this.hasChanged(),restored:this.hasRestored(),values:this.values,last:this.valuesLast,defaults:this.valuesDefault}},destroy:function(){Array.each(this.elements,function(e){this.__removeEvents(e),e.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),e.eliminate("changetracker")}.bind(this))}}),Element.implement({addChangeTracker:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.ElementValueTracker(this),this},hasChanged:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").hasChanged()},getTrackedValue:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getValue(this)},getTrackedDefault:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getDefault(this)},getTrackedLast:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getLast(this)},fireTrackedChange:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").__elementChanged({target:this}),this.retrieve("changetracker").getValue(this)}}),Element.implement({exists:function(){try{if(document.body.contains(this)||this.ownerDocument&&this.ownerDocument.body.contains(this))return this}catch(e){return!1}return!1}}),Element.Events.added={onAdd:function(){this.exists()?this.fireEvent("exists",this):(this.store("_exists_method",(function(){this.exists()&&(clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method"),this.fireEvent("exists",this))})),this.store("_exists_timer",this.retrieve("_exists_method").periodical(100,this)))},onRemove:function(){clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method")}},Element.Events.removed={onAdd:function(){this.exists()?(this.store("_not_exists_method",(function(){this.exists()||(clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_timer"),this.eliminate("_not_exists_method"),this.fireEvent("notexists",!0))})),this.store("_not_exists_timer",this.retrieve("_not_exists_method").periodical(1e3,this))):this.fireEvent("notexists",!0)},onRemove:function(){clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_method"),this.eliminate("_not_exists_method")}},MooTools&&"version"in MooTools&&parseFloat(MooTools.version)>=1.4&&parseFloat(MooTools.version)<1.5){var Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,preventDefault:!1,stopPropagation:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var e=Array.link(arguments,{options:Type.isObject,element:function(e){return null!=e}});this.element=document.id(e.element),this.document=this.element.getDocument(),this.setOptions(e.options||{});var t=typeOf(this.options.handle);this.handles=("array"==t||"collection"==t?$$(this.options.handle):document.id(this.options.handle))||this.element,this.mouse={now:{},pos:{}},this.value={start:{},now:{}},this.selection=Browser.ie?"selectstart":Affinity.events.start,Browser.ie&&!Drag.ondragstartFixed&&(document.ondragstart=Function.from(!1),Drag.ondragstartFixed=!0),this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(!1)},this.attach()},attach:function(){return this.handles.addEvent(Affinity.events.start,this.bound.start),this},detach:function(){return this.handles.removeEvent(Affinity.events.start,this.bound.start),this},start:function(e){var t=this.options;if(!e.rightClick){t.preventDefault&&e.preventDefault(),t.stopPropagation&&e.stopPropagation(),this.mouse.start=e.page,this.fireEvent("beforeStart",this.element);var i,n,s=t.limit;for(i in this.limit={x:[],y:[]},t.modifiers)if(t.modifiers[i]){var o=this.element.getStyle(t.modifiers[i]);if(o&&!o.match(/px$/)&&(n||(n=this.element.getCoordinates(this.element.getOffsetParent())),o=n[t.modifiers[i]]),t.style?this.value.now[i]=(o||0).toInt():this.value.now[i]=this.element[t.modifiers[i]],t.invert&&(this.value.now[i]*=-1),this.mouse.pos[i]=e.page[i]-this.value.now[i],s&&s[i])for(var a=2;a--;){var r=s[i][a];(r||0===r)&&(this.limit[i][a]="function"==typeof r?r():r)}}"number"==typeOf(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});var l={};l[Affinity.events.move]=this.bound.check,l[Affinity.events.end]=this.bound.cancel,l[this.selection]=this.bound.eventStop,this.document.addEvents(l)}},check:function(e){if((!Affinity.mobile||!Affinity.UI.scrolling)&&(this.options.preventDefault&&e.preventDefault(),Math.round(Math.sqrt(Math.pow(e.page.x-this.mouse.start.x,2)+Math.pow(e.page.y-this.mouse.start.y,2)))>this.options.snap||Affinity.mobile)){this.cancel();var t={};t[Affinity.events.move]=this.bound.drag,t[Affinity.events.end]=this.bound.stop,this.document.addEvents(t),this.fireEvent("start",[this.element,e]).fireEvent("snap",this.element)}},drag:function(e){if(Affinity.UI.drageventFired=!0,!Affinity.mobile||!Affinity.UI.scrolling){var t=this.options;for(var i in t.preventDefault&&e.preventDefault(),this.mouse.now=e.page,t.modifiers)t.modifiers[i]&&(this.value.now[i]=this.mouse.now[i]-this.mouse.pos[i],t.invert&&(this.value.now[i]*=-1),t.limit&&this.limit[i]&&((this.limit[i][1]||0===this.limit[i][1])&&this.value.now[i]>this.limit[i][1]?this.value.now[i]=this.limit[i][1]:(this.limit[i][0]||0===this.limit[i][0])&&this.value.now[i]<this.limit[i][0]&&(this.value.now[i]=this.limit[i][0])),t.grid[i]&&(this.value.now[i]-=(this.value.now[i]-(this.limit[i][0]||0))%t.grid[i]),t.style?this.element.setStyle(t.modifiers[i],this.value.now[i]+t.unit):this.element[t.modifiers[i]]=this.value.now[i]);this.fireEvent("drag",[this.element,e])}},cancel:function(e){this.document.removeEvent(Affinity.events.move,this.bound.check),this.document.removeEvent(Affinity.events.end,this.bound.cancel),e&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(e){var t={};t[Affinity.events.move]=this.bound.drag,t[Affinity.events.end]=this.bound.stop,t[this.selection]=this.bound.eventStop,this.document.removeEvents(t),e&&this.fireEvent("complete",[this.element,e])}});Element.implement({makeResizable:function(e){var t=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},e));return this.store("resizer",t),t.addEvent("drag",function(){this.fireEvent("resize",t)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(e,t){if(this.parent(e,t),e=this.element,this.droppables=$$(this.options.droppables),this.container=document.id(this.options.container),this.container&&"element"!=typeOf(this.container)&&(this.container=document.id(this.container.getDocument().body)),this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var i=e.getOffsetParent(),n=e.getStyles("left","top");!i||"auto"!=n.left&&"auto"!=n.top||e.setPosition(e.getPosition(i))}"static"==e.getStyle("position")&&e.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0),this.overed=null},start:function(e){this.container&&(this.options.limit=this.calculateLimit()),this.options.precalculate&&(this.positions=this.droppables.map((function(e){return e.getCoordinates()}))),this.parent(e)},calculateLimit:function(){var e=this.element,t=this.container,i=document.id(e.getOffsetParent())||document.body,n=t.getCoordinates(i),s={},o={},a={},r={},l={};["top","right","bottom","left"].each((function(n){s[n]=e.getStyle("margin-"+n).toInt(),o[n]=e.getStyle("border-"+n).toInt(),a[n]=t.getStyle("margin-"+n).toInt(),r[n]=t.getStyle("border-"+n).toInt(),l[n]=i.getStyle("padding-"+n).toInt()}),this);var h=e.offsetWidth+s.left+s.right,d=e.offsetHeight+s.top+s.bottom,c=0,u=0,m=n.right-r.right-h,p=n.bottom-r.bottom-d;if(this.options.includeMargins?(c+=s.left,u+=s.top):(m+=s.right,p+=s.bottom),"relative"==e.getStyle("position")){var f=e.getCoordinates(i);f.left-=e.getStyle("left").toInt(),f.top-=e.getStyle("top").toInt(),c-=f.left,u-=f.top,"relative"!=t.getStyle("position")&&(c+=r.left,u+=r.top),m+=s.left-f.left,p+=s.top-f.top,t!=i&&(c+=a.left+l.left,u+=(Browser.ie6||Browser.ie7?0:a.top)+l.top)}else c-=s.left,u-=s.top,t!=i&&(c+=n.left+r.left,u+=n.top+r.top);return{x:[c,m],y:[u,p]}},getDroppableCoordinates:function(e){var t=e.getCoordinates();if("fixed"==e.getStyle("position")){var i=window.getScroll();t.left+=i.x,t.right+=i.x,t.top+=i.y,t.bottom+=i.y}return t},checkDroppables:function(){var e=this.droppables.filter((function(e,t){e=this.positions?this.positions[t]:this.getDroppableCoordinates(e);var i=this.mouse.now;return i.x>e.left&&i.x<e.right&&i.y<e.bottom&&i.y>e.top}),this).getLast();this.overed!=e&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),e&&this.fireEvent("enter",[this.element,e]),this.overed=e)},drag:function(e){this.parent(e),this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(e){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,e]),this.overed=null,this.parent(e)}}),Element.implement({makeDraggable:function(e){var t=new Drag.Move(this,e);return this.store("dragger",t),t}});var Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(e){this.setKnobPosition(e)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(e,t,i){this.setOptions(i),i=this.options,this.element=document.id(e),t=this.knob=document.id(t),this.previousChange=this.previousEnd=this.step=-1;var n={},s={x:!1,y:!1};switch(i.mode){case"vertical":this.axis="y",this.property="top",this.offset="offsetHeight";break;case"horizontal":this.axis="x",this.property="left",this.offset="offsetWidth"}this.setSliderDimensions(),this.setRange(i.range),"static"==t.getStyle("position")&&t.setStyle("position","relative"),t.setStyle(this.property,-i.offset),s[this.axis]=this.property,n[this.axis]=[-i.offset,this.full-i.offset];var o={snap:0,limit:n,modifiers:s,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1,this.draggedKnob(),this.end()}.bind(this)};i.snap&&this.setSnap(o),this.drag=new Drag(t,o),this.attach(),null!=i.initialStep&&this.set(i.initialStep)},attach:function(){return this.element.addEvent("mousedown",this.clickedElement),this.options.wheel&&this.element.addEvent("mousewheel",this.scrolledElement),this.drag.attach(),this},detach:function(){return this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement),this.drag.detach(),this},autosize:function(){return this.setSliderDimensions().setKnobPosition(this.toPosition(this.step)),this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset],this.options.snap&&this.setSnap(),this},setSnap:function(e){return e||(e=this.drag.options),e.grid=Math.ceil(this.stepWidth),e.limit[this.axis][1]=this.full,this},setKnobPosition:function(e){return this.options.snap&&(e=this.toPosition(this.step)),this.knob.setStyle(this.property,e),this},setSliderDimensions:function(){return this.full=this.element.measure(function(){return this.half=this.knob[this.offset]/2,this.element[this.offset]-this.knob[this.offset]+2*this.options.offset}.bind(this)),this},set:function(e){return this.range>0^e<this.min||(e=this.min),this.range>0^e>this.max||(e=this.max),this.step=Math.round(e),this.checkStep().fireEvent("tick",this.toPosition(this.step)).end()},setRange:function(e,t){return this.min=Array.pick([e[0],0]),this.max=Array.pick([e[1],this.options.steps]),this.range=this.max-this.min,this.steps=this.options.steps||this.full,this.stepSize=Math.abs(this.range)/this.steps,this.stepWidth=this.stepSize*this.full/Math.abs(this.range),e&&this.set(Array.pick([t,this.step]).floor(this.min).max(this.max)),this},clickedElement:function(e){if(!this.isDragging&&e.target!=this.knob){var t=this.range<0?-1:1,i=e.page[this.axis]-this.element.getPosition()[this.axis]-this.half;i=i.limit(-this.options.offset,this.full-this.options.offset),this.step=Math.round(this.min+t*this.toStep(i)),this.checkStep().fireEvent("tick",i).end()}},scrolledElement:function(e){var t="horizontal"==this.options.mode?e.wheel<0:e.wheel>0;this.set(this.step+(t?-1:1)*this.stepSize),e.stop()},draggedKnob:function(){var e=this.range<0?-1:1,t=this.drag.value.now[this.axis];t=t.limit(-this.options.offset,this.full-this.options.offset),this.step=Math.round(this.min+e*this.toStep(t)),this.checkStep()},checkStep:function(){var e=this.step;return this.previousChange!=e&&(this.previousChange=e,this.fireEvent("change",e)),this},end:function(){var e=this.step;return this.previousEnd!==e&&(this.previousEnd=e,this.fireEvent("complete",e+"")),this},toStep:function(e){var t=(e+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(t-=t%this.stepSize):t},toPosition:function(e){return this.full*Math.abs(this.min-e)/(this.steps*this.stepSize)-this.options.offset}}),Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{}},initialize:function(e,t){this.setOptions(t),this.elements=[],this.lists=[],this.idle=!0,this.addLists($$(document.id(e)||e)),this.options.clone||(this.options.revert=!1),this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each((function(e){this.elements.push(e);var t=e.retrieve("sortables:start",function(t){this.start.call(this,t,e)}.bind(this));(this.options.handle&&e.getElement(this.options.handle)||e).addEvent(Affinity.events.start,t)}),this),this},addLists:function(){return Array.flatten(arguments).each((function(e){this.lists.include(e),this.addItems(e.getChildren())}),this),this},removeItems:function(){return $$(Array.flatten(arguments).map((function(e){this.elements.erase(e);var t=e.retrieve("sortables:start");return(this.options.handle&&e.getElement(this.options.handle)||e).removeEvent(Affinity.events.start,t),e}),this))},removeLists:function(){return $$(Array.flatten(arguments).map((function(e){return this.lists.erase(e),this.removeItems(e.getChildren()),e}),this))},getClone:function(e,t){if(!this.options.clone)return new Element(t.tagName).inject(document.body);if("function"==typeOf(this.options.clone))return this.options.clone.call(this,e,t,this.list);var i=t.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:t.getStyle("width")}).addEvent(Affinity.events.start,(function(e){t.fireEvent(Affinity.events.start,e)}));return i.get("html").test("radio")&&i.getElements("input[type=radio]").each((function(e,i){e.set("name","clone_"+i),e.get("checked")&&t.getElements("input[type=radio]")[i].set("checked",!0)})),i.inject(this.list).setPosition(t.getPosition(t.getOffsetParent()))},getDroppables:function(){var e=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||e.append(this.lists).erase(this.list),e},insert:function(e,t){var i="inside";this.lists.contains(t)?(this.list=t,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(t)?"before":"after",this.element.inject(t,i),this.fireEvent("sort",[this.element,this.clone])},start:function(e,t){!this.idle||e.rightClick||["button","input","a","textarea"].contains(e.target.get("tag"))||(Affinity.mobile&&(e.preventDefault(),e.stopPropagation()),this.idle=!1,this.element=t,this.opacity=t.getStyle("opacity"),this.list=t.getParent(),this.clone=this.getClone(e,t),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){e.stop(),this.clone.setStyle("visibility","visible"),this.element.setStyle("opacity",this.options.opacity||0),this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(e))},end:function(){if(this.drag.detach(),this.element.setStyle("opacity",this.opacity),this.effect){var e=this.element.getStyles("width","height"),t=this.clone,i=t.computePosition(this.element.getPosition(this.clone.getOffsetParent())),n=function(){this.removeEvent("cancel",n),t.destroy()};this.effect.element=t,this.effect.start({top:i.top,left:i.left,width:e.width,height:e.height,opacity:.25}).addEvent("cancel",n).chain(n)}else this.clone.destroy();this.reset()},reset:function(){this.idle=!0,this.fireEvent("complete",this.element)},serialize:function(){var e=Array.link(arguments,{modifier:Type.isFunction,index:function(e){return null!=e}}),t=this.lists.map((function(t){return t.getChildren().map(e.modifier||function(e){return e.get("id")},this)}),this),i=e.index;return 1==this.lists.length&&(i=0),(i||0===i)&&i>=0&&i<this.lists.length?t[i]:t}})}if(String.prototype.soundex=function(e,t){var n,s,o,a,r,l=this,h="";for("H"!=(r=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=(h=l=l.toUpperCase()).replace(/[^A-Z]/gi," ")).replace(/^\s*/g,"")).replace(/\s*$/g,"")).replace(/^GH/g,"G")).replace(/DG/g,"G")).replace(/GH/g,"H")).replace(/GN/g,"N")).replace(/KN/g,"N")).replace(/PH/g,"F")).replace(/MP([STZ])/g,"M$1")).replace(/^PS/g,"S")).replace(/^PF/g,"F")).replace(/MB/g,"M")).replace(/TCH/g,"CH")).substr(0,1))&&"W"!=r||(h="-"+h.substr(1)),a=(h=(h=(h=(h=(h=(h=(h=h.replace(/[AEIOUYHW]/g,"0")).replace(/[BPFV]/g,"1")).replace(/[CSGJKQXZ]/g,"2")).replace(/[DT]/g,"3")).replace(/[L]/g,"4")).replace(/[MN]/g,"5")).replace(/[R]/g,"6")).length,o="",n="",i=0;i<a;i++)(s=h.charAt(i))==o?n+=" ":(n+=s,o=s);return h=(h=(h=(h=n).substr(1)).replace(/\s/g,"")).replace(/0/g,""),(h=r+(h+="0000000000")).substr(0,5)},String.prototype.distance=function(e){var t=this.toLowerCase(),i=e.toLowerCase();if(0===t.length)return i.length;if(0===i.length)return t.length;var n,s,o=[];for(n=0;n<=i.length;n++)o[n]=[n];for(s=0;s<=t.length;s++)o[0][s]=s;for(n=1;n<=i.length;n++)for(s=1;s<=t.length;s++)i.charAt(n-1)==t.charAt(s-1)?o[n][s]=o[n-1][s-1]:o[n][s]=Math.min(o[n-1][s-1]+1,Math.min(o[n][s-1]+1,o[n-1][s]+1));return o[i.length][t.length]},"null"==typeOf(File))var File={};if("null"==typeOf(Request))var File={};File.Upload=new Class({Implements:[Options,Events],options:{onComplete:function(){}},initialize:function(e){var t=this;this.setOptions(e),this.uploadReq=new Request.File({onComplete:function(){t.fireEvent("complete",arguments),this.reset()}}),this.options.data&&this.data(this.options.data),this.options.images&&this.addMultiple(this.options.images)},data:function(e){var t=this;this.options.url.indexOf("?")<0&&(this.options.url+="?"),Object.each(e,(function(e,i){"?"!=t.options.url.charAt(t.options.url.length-1)&&(t.options.url+="&"),t.options.url+=encodeURIComponent(i)+"="+encodeURIComponent(e)}))},addMultiple:function(e){var t=this;e.each((function(e){t.add(e)}))},add:function(e){if("null"!==typeOf(e)){(e=document.id(e)).get("name");var t=e.files[0];this.uploadReq.append("fileData",t)}},addPostData:function(e){this.uploadReq.addPostData(e)},send:function(e){e&&this.add(e),this.uploadReq.send({url:this.options.url})}}),Request.File=new Class({Extends:Request,options:{emulation:!1,urlEncoded:!1},initialize:function(e){this.xhr=new Browser.Request,this.formData=new FormData,this.setOptions(e),this.headers=this.options.headers},append:function(e,t){return this.formData.append(e,t),this.formData},addPostData:function(e){var t=this;Object.each(e,(function(e,i){t.formData.append(i,e)}))},reset:function(){this.formData=new FormData},send:function(e){var t=e.url||this.options.url;this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0;var i=this.xhr;return i.open("POST",t,!0),i.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,(function(e,t){try{i.setRequestHeader(t,e)}catch(i){this.fireEvent("exception",[t,e])}}),this),this.fireEvent("request"),i.send(this.formData),this.options.async||this.onStateChange(),this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)),this}}),Affinity.Shake=new Class({Implements:Options,options:{distance:4,duration:50,transition:Fx.Transitions.Sine.easeInOut,loops:2},initialize:function(e,t){this.setOptions(t),this.element=e,this.tween=new Fx.Tween(this.element,{link:"chain",duration:this.options.duration,transition:this.options.transition,property:"margin-left"})},shake:function(){var e=this.options.distance;for(this.loops=0;this.loops<this.options.loops;this.loops++)this.tween.start("left",e).start("left",-e),this.tween.start("left",e).start("left",0);delete e},stop:function(){this.loops=this.options.loops,this.tween.cancel(),this.element.setStyle("margin-left",0)}}),window.addEvent("UiReady",(function(){Affinity.oldess&&Affinity.oldessFrame&&Affinity.agent.contains("Chrome")&&Affinity.agent.contains("Windows NT 6.2")&&window.addEvent("click",(function(){document.getElement("body").className.contains("redraw")?(document.getElement("body").setStyle("width","100%"),document.getElement("body").className="newui"):(document.getElement("body").setStyle("width","99.9%"),document.getElement("body").className="newui redraw")})),void 0!==window.masterMessage&&Affinity.isie&&Affinity.ieversion<9&&masterMessage({message:'<strong class="color red large">Warning!</strong><br /><br />We do not support Internet Explorer 8 and less<br />Some functionality may not work.<br /><br />We recommend <a href="https://www.google.com/chrome/browser/desktop/" target="_blank" class="color green">Chrome</a> or updating to at least IE9.<br /><br />Continue at your own risk.',okText:"Accept and Continue"})})),Affinity.PageReady=function(){window.removeEvent("PageReady",Affinity.PageReady),Affinity.apiversion>1?(Affinity.zelosroot=Affinity.apiroot,Affinity.lookupapi=Affinity.apiroot+"/api/Lookup/Get"):Affinity.lookupapi=Affinity.zelosroot+"/api/Lookup/Get",document.documentMode&&8==document.documentMode&&document.getElement("body").addClass("ie8"),Affinity.mobile;var e=document.getElement("body").get("class").toLowerCase();Affinity.ismac=!!e.contains("mac"),Affinity.isie=!!e.contains("ie"),Affinity.isie&&(Affinity.ieversion=parseInt(String(e.match(/ie[0-9]+/i)[0]).substr(2))),Affinity.isie&&(Affinity.iedocmode=!!document.documentMode&&document.documentMode),Affinity.ismobile=!!e.contains("mobile"),Affinity.mobile&&(Affinity.ismobile=!0),Affinity&&Affinity.isie&&Affinity.ieversion<9&&document.addEvent("keydown",(function(e){8!=e.key&&"backspace"!==e.key||(e.target.get("tag").test("select","gi")||e.target.disabled||e.target.readOnly)&&e.preventDefault()})),Affinity.refreshControll={},Affinity.refreshControll.initialLoad=!0,Affinity.refreshControll.lastRefresh=(new Date).getTime(),window.addEvent("keydown",(function(e){if("f5"===e.key||"F5"===e.key||e.control&&("r"===e.key||"R"===e.key)){var t=(new Date).getTime(),i=Affinity.refreshControll.initialLoad?1e4:5e3;t-Affinity.refreshControll.lastRefresh<i&&(e.stop(),uialert({message:"Refreshing this often can slow things down.<br />If you believe the page is not responding,<br />please contact Affinity Help desk.",showButtons:!0})),Affinity.refreshControll.lastRefresh=(new Date).getTime(),Affinity.refreshControll.initialLoad=!1}})),window.addEvent("userComplete",(function(e){document.getElements(".displayname").set("html",e.commonName?e.commonName:e.displayName?e.displayName:"")})),Affinity.essmessage="",window.Affinity.oldess=!1,function(){var e=new URI(window.location.href),t=e&&"object"===typeOf(e)&&"null"===typeOf(e.parsed.query)?{}:e.parsed.query.parseQueryString();if("sessionKey"in t||"isEss"in t)window.Affinity.oldess=!0,"iframe"in t&&(window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent),"external"in t&&(window.Affinity.oldessLaunched=!0,window.Affinity.oldessFrame=!1,window.Affinity.oldessWindow=window.opener),window.Affinity.oldess&&!1 in t&&!1 in t&&window.addEvent("UiReady",(function(){"cleverforms"===window.Affinity.appname?(window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent):(window.Affinity.oldessLaunched=!0,window.Affinity.oldessFrame=!1,window.Affinity.oldessWindow=window.opener)}));else try{parent&&"parentFrameResize"in parent&&(window.Affinity.oldess=!0,window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent)}catch(e){log("!!! old ess check try failed")}}();try{window.Affinity.oldessFrame&&(window.addEvent("ResizeFrame",(function(){if(document.getElement(".content")){var e=document.getElement(".content").getScrollSize();if(Affinity.oldessFrame&&"parentFrameResize"in parent){var t=window.parent.window.innerWidth?window.parent.window.innerWidth-70:window.parent.window.document.body.offsetWidth-70;e.x=t&&t>0?t:1e3,parent.parentFrameResize({x:e.x,y:e.y+100})}}})),window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500))}catch(e){}},window.addEvent("PageReady",Affinity.PageReady),Affinity.disableAutoPageReady=!1,window.addEvent("load",(function(){(function(){Affinity.disableAutoPageReady||Affinity.uiready||window.fireEvent("PageReady")}).delay(1e3,this)})),Affinity.log=!0,Affinity.prettyuploads=!0,Affinity.selectToAutoNum=0,Affinity.selectmax=1e3,Affinity.enableSelectLimit=!0,Affinity.logger.enable(),window.config=document.config=Affinity;var UIAddress=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),window.googleAddressAutocompletes||(window.googleAddressAutocompletes={},window.googleAddressApiScripts=!1,window.googleAddressWidgetCount=0),window.googleAddressStartTime=(new Date).getTime(),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-address"),this.process)},process:function(e){(function(){e.removeClass("ui-address"),new UIAddressWidget({element:e,index:window.googleAddressWidgetCount}),window.googleAddressWidgetCount++}).delay(250*window.googleAddressWidgetCount)}}),UIAddressWidget=new Class({Implements:[Options,Events],Binds:["revert","destroy","findComponent","getCityFromLatLong","getClosestLocation","clearValues","updatePropertyValue","fillInAddress","loadScript","addressInit","getPlaceFromValue","setPlaceValues","mainAddressFocus","mainAddressBlur","checkForError","setPlaceValuesEvent","getCityFromLatLongEvent","fireCityFromLatLong"],options:{element:null,index:0},element:null,index:0,type:"address",uuid:"",place:!1,initialize:function(e){if(this.setOptions(e),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.apikey="AIzaSyDX7vRyaNWfkZQfj0xx9Kthii3HBXk5DGc",this.originalElement=this.options.element,this.disabled=!!this.originalElement.get("disabled"),this.uuid=String.uniqueID(),this.index=this.options.index,this.element=new Element("div",{class:"addressbox ui-validate","data-validate-method":"address"}).inject(this.options.element,"before"),window.googleAddressAutocompletes["address_"+this.uuid]=this,this.options.element.removeClass("ui-address").addClass("ui-address-done full-address"),this.addressinput=new Element("input",{class:"googleAddress",type:"text",id:"googleAddress_"+this.uuid,placeholder:"Enter your address to fill the fields below"}).inject(this.element,"top"),this.errorIcon=new Element("span",{class:"addressbox-error-icon icon-warning ui-has-tooltip hidden","data-tooltip":"This is not a valid Address"}).inject(this.element),this.addressComponentWrapper=new Element("div").set("reveal",{duration:250,transition:Fx.Transitions.Sine.easeInOut}).inject(this.element).toggle(),this.addressNumber=new Element("input",{class:"number",type:"text",id:"street_number_"+this.uuid,placeholder:"Number",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Number"'}).inject(this.addressComponentWrapper),this.addressStreet=new Element("input",{class:"street",type:"text",id:"street_address_"+this.uuid,placeholder:"Street",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Street"'}).inject(this.addressComponentWrapper),this.addressSuburb=new Element("input",{class:"suburb",type:"text",id:"suburb_"+this.uuid,placeholder:"Suburb",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Suburb"'}).inject(this.addressComponentWrapper),this.addressCity=new Element("input",{class:"city",type:"text",id:"city_"+this.uuid,placeholder:"City",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "City"'}).inject(this.addressComponentWrapper),this.addressState=new Element("input",{class:"state",type:"text",id:"state_"+this.uuid,placeholder:"State",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "State"'}).inject(this.addressComponentWrapper),this.addressCountry=new Element("input",{class:"country",type:"text",id:"country_"+this.uuid,placeholder:"Country",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Country"'}).inject(this.addressComponentWrapper),this.addressPostcode=new Element("input",{class:"postcode",type:"text",id:"postal_code_"+this.uuid,placeholder:"Postcode",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Postcode"'}).inject(this.addressComponentWrapper),this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.subhiddenaddress1=new Element("input",{class:"address1 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress2=new Element("input",{class:"address2 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress3=new Element("input",{class:"address3 validate ui-address-done"}).inject(this.hiddenWrapper),this.subhiddenaddress4=new Element("input",{class:"address4 validate ui-address-done"}).inject(this.hiddenWrapper),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before"),this.loadScript(),this.disabled?this.addressinput.addClass("hidden"):(this.addressNumber.addEvent("keyup",this.updatePropertyValue),this.addressStreet.addEvent("keyup",this.updatePropertyValue),this.addressSuburb.addEvent("keyup",this.updatePropertyValue),this.addressCity.addEvent("keyup",this.updatePropertyValue),this.addressState.addEvent("keyup",this.updatePropertyValue),this.addressCountry.addEvent("keyup",this.updatePropertyValue),this.addressPostcode.addEvent("keyup",this.updatePropertyValue),this.addressinput.addEvent("focus",this.mainAddressFocus),this.addressinput.addEvent("blur",this.mainAddressBlur)),Affinity.tooltips.processNew()},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.addressNumber.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressStreet.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressSuburb.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressCity.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressState.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressCountry.removeEvent("keyup",this.updatePropertyValue).destroy(),this.addressPostcode.removeEvent("keyup",this.updatePropertyValue).destroy(),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()},findComponent:function(e,t){for(var i=!1,n=0;n<e.length;n++)if("address_components"in e[n])for(var s=0;s<e[n].address_components.length;s++)if(e[n].address_components[s].types.contains(t)){i=e[n].address_components[s];break}return i},getLatLong:function(e){var t=[];return Object.each(e,function(e,i){"function"===typeOf(e)?t.push(this.place.geometry.location[i]()):typeOf("object"!==e)&&t.push(e)}.bind(this)),t.slice(0,2)},fireCityFromLatLong:function(e,t){(new google.maps.Geocoder).geocode({latLng:new google.maps.LatLng(e,t)},function(i,n){n==google.maps.GeocoderStatus.OK?this.fireEvent("gotCity",{uuid:this.uuid,city:this.findComponent(i,"colloquial_area")}):"OVER_QUERY_LIMIT"==n&&("warn"in console&&console.warn(this.index+' received google status in "fireCityFromLatLong" with "'+n+'"'),this.fireCityFromLatLong.delay(500,this,[e,t]))}.bind(this))},getCityFromLatLong:function(e,t){this.addEvent("gotCity",this.getCityFromLatLongEvent),this.fireCityFromLatLong(e,t)},getCityFromLatLongEvent:function(e){e.uuid===this.uuid&&(this.removeEvent("gotCity",this.getCityFromLatLongEvent),this.place.address_components.push(e.city),this.setPlaceValues())},getPlaceFromValue:function(e){var t;try{if((t=JSON.parse(e)).street){var i=t.street.indexOf(" ");this.addressNumber.value=t.street.substring(0,i),this.addressStreet.value=t.street.substring(i+1,t.street.length)}this.addressSuburb.value=t.suburb?t.suburb:"",this.addressCity.value=t.city?t.city:"",this.addressState.value=t.state?t.state:"",this.addressCountry.value=t.country?t.country:"",this.addressPostcode.value=t.postcode?t.postcode:""}catch(n){i=(t=e.split(","))[0].indexOf(" "),this.addressNumber.value=t[0].substring(0,i),this.addressStreet.value=t[0].substring(i+1,t[0].length),this.addressSuburb.value=t[1],this.addressCountry.value=t[4]?t[4]:"",this.addressPostcode.value=t[3],"Australia"===this.addressCountry.value?this.addressState.value=t[2]:this.addressCity.value=t[2]}},clearValues:function(){this.addressNumber.value="",this.addressStreet.value="",this.addressSuburb.value="",this.addressCity.value="",this.addressState.value="",this.addressCountry.value="",this.addressPostcode.value=""},setPlaceValues:function(){this.values={},Array.each(this.place.address_components,function(e){try{this.values[e.types[0]]={},this.values[e.types[0]].long=e.long_name,this.values[e.types[0]].short=e.short_name}catch(e){}}.bind(this)),this.countryCode=!1;var e=this.findComponent([this.place],"country");if(e&&(this.countryCode=e.short_name),this.countryCode&&""!=this.countryCode){var t=this.getLatLong(this.place.geometry.location);t.length>=2&&!isNaN(t[0])&&!isNaN(t[1])&&(this.addEvent("gotCity",this.setPlaceValuesEvent),this.fireCityFromLatLong(t[0],t[1]))}},setPlaceValuesEvent:function(e){if(e.uuid===this.uuid){if(this.removeEvent("gotCity",this.setPlaceValuesEvent),e&&"city"in e)try{this.values[e.city.types[0]]={},this.values[e.city.types[0]].long=e.city.long_name,this.values[e.city.types[0]].short=e.city.short_name}catch(e){}switch(this.countryCode){case"AU":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.locality?this.values.locality.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.colloquial_area?this.values.colloquial_area.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"NZ":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value="",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"GB":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value=this.values.administrative_area_level_2?this.values.administrative_area_level_2.long:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code_prefix?this.values.postal_code_prefix.long:"";break;case"US":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"",this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;default:this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:""),this.addressStreet.value=this.values.route?this.values.route.long:"",this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"",this.addressCity.value=this.values.locality?this.values.locality.long:"",this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"",this.addressCountry.value=this.values.country?this.values.country.long:"",this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:""}this.updatePropertyValue()}},mainAddressFocus:function(e){this.addressinput.set("placeholder","")},mainAddressBlur:function(e){this.addressinput.set("placeholder","Enter your address to fill the fields below"),this.checkForError()},checkForError:function(){var e=[this.addressNumber.value+" "+this.addressStreet.value,this.addressSuburb.value],t=[this.addressCity.value,this.addressState.value,this.addressCountry.value,this.addressPostcode.value];""===Array.clone(e).combine(Array.clone(t)).join("").trim()||""===e.join("").trim()?this.errorIcon.removeClass("hidden"):this.errorIcon.addClass("hidden")},addressInit:function(){if(!document.id("googleAddress_"+this.uuid))throw"target google autocomplete input can not be found";if(!("google"in window)||!("maps"in window.google))throw"google maps implementation cannot be found";if("maps"in Affinity.UI||(Affinity.UI.maps={}),!("autocompleteBounds"in Affinity.UI.maps)){Affinity.UI.maps.autocompleteBounds=!1;var e=new google.maps.LatLng(-36.847605,174.7485493),t=new google.maps.Circle({center:e,radius:15});Affinity.UI.maps.autocompleteBounds=t.getBounds()}var i;this.disabled||document.id("googleAddress_"+this.uuid).set("disabled",null),this.addressComponentWrapper.reveal(),document.config.ismobile||(document.id("googleAddress_"+this.uuid).set("autocomplete","off"),new Element("input",{type:"text",name:"address_fake_"+this.uuid,id:"address_fake_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before"),new Element("input",{type:"text",name:"prevent_autofill_"+this.uuid,id:"prevent_autofill_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before")),i=new google.maps.places.Autocomplete(document.id("googleAddress_"+this.uuid),{types:["geocode"],componentRestrictions:{country:["nz","au"]}}),"null"!==typeOf(window.autocompleteBounds)&&i.setBounds(Affinity.UI.maps.autocompleteBounds),google.maps.event.addListener(i,"place_changed",function(){this.clearValues(),this.place=i.getPlace();var e=document.id("googleAddress_"+this.uuid).value.trim();axios.get("https://maps.googleapis.com/maps/api/geocode/json?address="+e+"&key="+this.apikey).then(function(e){e.hasOwnProperty("data")&&e.data.hasOwnProperty("results")&&(this.place=e.data.results[0],this.setPlaceValues())}.bind(this)).catch((function(e){console.log(e)}))}.bind(this));var n=document.id("subhidden_"+this.uuid).getElement(".full-address").value;"null"!==typeOf(n)&&"string"===typeOf(n)&&""!==n.trim()&&this.getPlaceFromValue(n),this.updatePropertyValue()},updatePropertyValue:function(){var e=JSON.stringify({street:this.addressNumber.value+" "+this.addressStreet.value,suburb:this.addressSuburb.value,city:this.addressCity.value,state:this.addressState.value,country:this.addressCountry.value,postcode:this.addressPostcode.value});document.id("subhidden_"+this.uuid).getElement(".full-address").value=e,this.checkForError()},isGoogleApiready:function(){return"google"in window&&"object"===typeOf(google)&&"maps"in google&&"object"===typeOf(google.maps)&&"places"in google.maps&&"object"===typeOf(google.maps.places)&&"Autocomplete"in google.maps.places&&"function"===typeOf(google.maps.places.Autocomplete)},maybeLoadTimer:!1,loadScript:function(){if(this.isGoogleApiready())this.addressInit();else if(window.googleAddressApiScripts)this.maybeLoadTimer=function(){this.isGoogleApiready()&&(clearInterval(this.maybeLoadTimer),this.addressInit())}.periodical(500,this);else{window.googleAddressApiScripts=!0;var e="window.googleAddressAutocompletes.address_"+this.uuid+".addressInit";new Element("script",{src:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&callback="+e+"&key="+this.apikey}).inject(document.getElement("head"),"bottom")}}}),UIAutoComplete=new Class({Version:"1.0.9.2",File:"ui.autocomplete.js",Notes:"Position including scroll",Implements:[Options],Binds:["processNew","doAutoComplete","hideAll"],options:{},widgets:{},initialize:function(e){this.setOptions(e),Affinity.UI.autocomplete||(Affinity.UI.autocomplete={}),Affinity.UI.lastAutoKill={},"null"===typeOf(Affinity.UI.ghostFocus)&&(Affinity.UI.ghostFocus=new Element("input",{type:"text"}),new Element("div",{class:"subhidden"}).adopt(Affinity.UI.ghostFocus).inject(document.body,"bottom")),window.autocompletes=this,this.processNew()},processNew:function(){Array.each(document.getElements(".ui-autocomplete"),function(e){e.hasClass("has-lookup")||e.hasClass("lookup-loading")||(e.removeClass("ui-autocomplete"),Affinity.mobile&&"UIAutoCompleteMobileWidget"in window?ac=new UIAutoCompleteMobileWidget({selectElement:e}):ac=new UIAutoCompleteWidget({selectElement:e}),this.widgets[ac.uuid]||(this.widgets[ac.uuid]=ac))}.bind(this))},doAutoComplete:function(e){var t=new UIAutoCompleteWidget({selectElement:e});this.widgets[t.uuid]||(this.widgets[t.uuid]=t)},hideAll:function(e){Object.each(this.widgets,function(t){"null"!==typeOf(e)&&e.uuid?t.uuid!==e.uuid&&t.hide("master hide all"):t.hide("master hide all")}.bind(this))}}),UIAutoCompleteWidget=new Class({debug:!1,Implements:[Options,Events],Binds:["fuzzyWorkerComplete","cleanDisplay","processOptions","updateOptions","stopEvent","getValue","setValue","getDisplayValue","position","windowClickStart","windowClickEnd","listOver","listOut","elementOver","elementOut","doFocus","doClick","doKeyUp","doKeyDown","fuzzySearch","continueWithFuzzySearch","itemClicked","escapeRegExp","obscure","reveal","hide","show","clearList","revert","destroy","searchMode_fireChangeEvents","searchMode_valueToOption","searchMode_iconClicked","searchMode_displayBlur"],options:{stopInitialChange:!1,selectElement:null},webworkerpath:"./scripts/common/ui.autocomplete.web.worker.js",list:[],selectElement:null,listElement:null,displayElement:null,changed:!1,defaultChangeValue:null,center:!1,autowidth:!1,uuid:"",killid:"",type:"autocomplete",initialize:function(e){if(Affinity.mobile&&"UIAutoCompleteMobileWidget"in window)return new UIAutoCompleteMobileWidget(e);this.setOptions(e),this.useWebWorkers=!!Affinity.useWebWorkers&&"undefined"!=typeof Worker,this.useWebWorkers&&(this.fuzzyWorker=new Worker(this.webworkerpath),this.fuzzyWorker.onmessage=this.fuzzyWorkerComplete),this.searchMode=!1,Affinity&&Affinity.mobile&&(this.searchMode=!0),this.icons={},this.icons.search=Affinity.icons.Search,this.selectElement=this.options.selectElement,this.selectElement.hasClass("ui-autocomplete-center")&&(this.center=!0),this.selectElement.hasClass("ui-autocomplete-autowidth")&&(this.autowidth=!0),this.bestguess=null,this.selectElement.set("tabindex",5e3),this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.selectElement,"after"),this.selectElement.inject(this.hiddenWrapper),this.uuid=null==this.selectElement.get("id")?String.uniqueID():this.selectElement.get("id"),this.killid="ac-destroy-"+String.uniqueID(),window.autocompletes.widgets[this.uuid]||(window.autocompletes.widgets[this.uuid]=this),this.selectElement.set("id",this.uuid),this.processOptions.delay(100,this),this.selectElement.store("widget",this),this.selectElement.retrieve("changetracker")?this.valuetracker=this.selectElement.retrieve("changetracker"):this.valuetracker=new Affinity.ElementValueTracker,this.valuetracker.addElement(this.selectElement),document.addEvent("scroll",this.position),document.addEvent("resize",this.position)},fuzzyWorkerComplete:function(e){var t=e.data;switch(t.job){case"getOptions":this.searchMode&&(this.massiveSelect.innerHTML=t.html,Affinity.prompts.adopt(this.massiveSelect),this.massiveSelect.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:this.massiveSelect,onComplete:function(e){this.massiveLoader.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position()}.bind(this)}));break;case"getList":var i=null;this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),t.data.defaultID&&(i=this.listElement.getElement("#"+e.data.data.defaultID),this.defaultValue=i,this.lastSelected=i,this.defaultChangeValue=i.get("data-value")),this.continueProcessOptsions(i);break;case"resetList":this.listElement.innerHTML=t.html,this.iconElement&&this.iconElement.removeClass("working"),t.select&&(this.lastSelected=document.id(t.select),this.defaultValue=document.id(t.select),this.bestguess=document.id(t.select),this.selectElement.value=""),this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.defaultValue.value,this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),window.fireEvent("elementChanged",{element:this.selectElement});break;case"doSearch":this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,t.bestguess&&(this.bestguess=document.id(t.bestguess)),this.iconElement&&this.iconElement.removeClass("working"),this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked)}},cleanDisplay:function(e){return"string"===typeOf(e)&&""!==e.trim()?e.split(",").filter((function(e){return""!==e})).join(", ").trim().replace(/&amp;/gi,"&"):e},getValue:function(){return this.selectElement.value},setValue:function(e,t){if(t=t||!0,e=this.cleanDisplay(e),"null"!==typeOf(this.listElement))if(this.searchMode)this.datalistElement.getElement("option[value="+e+"]")&&(this.displayElement.value=e,this.mobileChange());else{if(!e||""===e||"null"===typeOf(this.fuzzySearchItems)||!1===this.fuzzySearchItems)return void this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t});for(var i=!1,n=0;n<this.fuzzySearchItems.length;n++)if(this.fuzzySearchItems[n].value+""==e+""){i=document.id(this.fuzzySearchItems[n].id);break}i?this.itemClicked({target:i,fireEvents:t}):this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t})}},getDisplayValue:function(){return this.cleanDisplay(this.displayElement.value)},status:"closed",searchMode_firstPass:!0,searchMode_lastKnownValue:"",searchMode_fireChangeEvents:function(e){this.changed="boolean"===typeOf(e)&&!0===e,this.defaultChangeValue!==this.selectElement.value&&(this.defaultChangeValue=this.selectElement.value,this.changed=!0),!this.searchMode_firstPass&&this.changed&&this.searchMode_lastKnownValue===this.selectElement.value&&(this.changed=!1),this.changed&&(this.defaultChangeValue=this.selectElement.value,this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete search mode"})),this.searchMode_firstPass=!1},searchMode_valueToOption:function(e,t,i){if(i=i||!1,this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.selectElement.empty(),new Element("option",{value:e,html:t}).inject(this.selectElement),this.selectElement.value=e,this.selectElement.selectedIndex=0;else{this.selectElement.value=e;for(var n=this.selectElement.getElements("options"),s=0;s<n.length;s++)if(n[s].value===e){this.selectElement.selectedIndex=s;break}}this.displayElement.value=e,this.displayElement.store("data-search-value",e),this.searchMode_fireChangeEvents(i)},searchMode_iconClicked:function(){var e=this.cleanDisplay(this.displayElement.value);if(!Affinity.mobile&&""!==e.trim()&&e.length>1||Affinity.mobile){var t=new Element("select",{class:"override ui-autocomplete-center hidden"}),i=new Element("span",{html:'Loading list <img src="'+Affinity.loaders.dark+'" />'});uialert({message:"Set Value<br /><br />",showButtons:!0,showCancel:!0,canClose:!Affinity.mobile,position:{position:"fixed",top:10},onOk:function(){var e=document.id("UIPromtBox").getElement("select"),t=e.selectedIndex||0,i=e.getElements("option")[t];i.get("value"),this.searchMode_valueToOption(i.get("value"),i.get("html"),!0),e.getWidget()&&e.getWidget().destroy(),e.destroy()}.bind(this),onCancel:function(){t.getWidget()&&t.getWidget().destroy(),t.destroy()},onClose:function(){t.getWidget()&&t.getWidget().destroy(),t.destroy()}}),Affinity.prompts.adopt(i),Affinity.prompts.hideButtons(),function(){if(this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")){var n,s=this.selectElement.retrieve("data-store"),o=this.selectElement.retrieve("data-key"),a=Affinity.UI[s][o].api;a=a.contains("limit")?a.substr(0,a.indexOf("limit")-1):a,0===Affinity.UI[s][o].data.length?new Request.JSONP({callbackKey:"jsoncallback",url:a,method:"get",timeout:3e4,onComplete:function(a){JSON.Unauthorized(a,Affinity.UI[s][o].id+", lookup massive loader")||("error"in a?i.set("html","Failed loading list. Please refresh and try again."):"array"===typeOf(a)&&a.length>0&&(Affinity.UI[s][o].data=a,Affinity.UI[s][o].loaded=!0,this.useWebWorkers?(this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[s][o].data,searchFor:e,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[s][o].data,function(i){(i.Value.toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(n=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(t),i.Value===e&&n.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))))}.bind(this),onError:function(e){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onFailure:function(e){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onTimeout:function(){i.set("html","List loader timed out. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this)}).send():this.useWebWorkers?(this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[s][o].data,searchFor:e,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[s][o].data,function(i){(i.Value.toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(n=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(t),i.Value===e&&n.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))}else this.useWebWorkers?(this.massiveSelect=t,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[s][o].data,searchFor:e,ismobile:Affinity.mobile})):(Array.each(this.selectElement.getElements("option"),function(i){(i.get("html").stripTags().toLowerCase().indexOf(e.toLowerCase())>-1||Affinity.mobile)&&(i=new Element("option",{value:i.get("value")?i.get("value"):i.get("html").stripTags(),html:this.cleanDisplay(i.get("html"))}).inject(t)).get("html")===e&&i.set("selected","selected")}.bind(this)),Affinity.prompts.adopt(t),t.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:t,onComplete:function(e){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),e.position(),Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))}.delay(300,this)}else""!==e.trim()&&1===e.length?uialert({message:"You must enter more than 1 character",showButtons:!0}):uialert({message:"You must enter a search term",showButtons:!0})},searchMode_displayBlur:function(){var e=this.cleanDisplay(this.displayElement.value),t=this.displayElement.retrieve("data-search-value");""!==t&&e===t||(t=e),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.selectElement.empty(),this.searchMode_valueToOption(t,e))},updateOptions:function(){this.clearList(),this.processOptions()},processCount:0,processOptions:function(){if("null"!==typeOf(this.selectElement)&&this.selectElement&&"getElements"in this.selectElement){var e=this.selectElement.getElements("option");(e.length>Affinity.selectmax||this.selectElement.hasClass("massive"))&&(this.searchMode=!0),this.searchMode&&this.selectElement.hasClass("override")&&(this.searchMode=!1);var t,i=!0,n=!0;if(this.searchMode){if(t=this.uuid,Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display").inject(this.hiddenWrapper,"before"),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),i=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),i&&(this.displayElement=new Element("input",{type:"text",class:"ui-autocomplete-display",id:t+"-Display"}).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.killid),t=this.uuid+"_icon",Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),n=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),n&&(this.iconElement=new Element("span",{class:"ui-autocomplete-display-icon searchmode",id:t+"-Display-Icon",html:Affinity.icons.Search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.selectElement.hasClass("massive")&&this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"))),!this.selectElement.hasClass("massive"))if(this.selectElement.addClass("massive"),this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"));else if(e.length>0){var s=this.selectElement.selectedIndex&&this.selectElement.selectedIndex>0?this.selectElement.selectedIndex:0;this.searchMode_valueToOption(e[s].get("value")||"",e[s].get("html"))}this.selectElement.set("data-display-id",this.uuid+"-Display"),this.fireEvent("complete",this)}else{var o,a;this.displayElement?this.listElement.empty():(t=this.uuid,Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid),this.displayElement.removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display").cloneEvents(this.selectElement),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),i=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),i&&(this.displayElement=new Element("input",{type:"text",class:"ui-autocomplete-display",id:this.uuid+"-Display"}).cloneEvents(this.selectElement).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.selectElement.get("class")),this.displayElement.addClass(this.killid),t=this.uuid+"_icon",Affinity.UI.lastAutoKill[t]&&(document.getElement("."+Affinity.UI.lastAutoKill[t].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[t].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[t].killid).removeClass(Affinity.UI.lastAutoKill[t].killid).set("id",t+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),n=!1),Affinity.UI.lastAutoKill[t]=null,delete Affinity.UI.lastAutoKill[t]),n&&(this.iconElement=new Element("span",{class:"ui-autocomplete-display-icon",id:t+"-Display-Icon",html:this.icons.search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.displayElement.makeFormElement(),this.displayElement.addClass("widget"),this.displayElement.store("widget",this),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.displayElement.set("autocomplete","off"),this.selectElement.hasClass("has-message-icon")&&this.displayElement.addClass("has-message-icon"),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.listElement=new Element("ul",{class:"ui-autocomplete-list",id:this.domid}).inject(document.body,"bottom"),this.autowidth&&this.listElement.addClass("auto-width"),Affinity.mobile?window.addEvent("mobileback",function(){this.hide()}.bind(this)):(new Affinity.SmartClose(this.displayElement),new Affinity.SmartClose(this.listElement),this.displayElement.addEvent("SmartClose",function(){this.listElement.isOver()||this.hide()}.bind(this)),this.listElement.addEvent("SmartClose",function(){this.displayElement.isOver()||this.hide()}.bind(this))),(this.displayElement.hasClass("width-auto")||this.displayElement.hasClass("width-full"))&&this.listElement.setStyle("width",this.displayElement.getSize().x),this.listElement.set("tween",{duration:100}),this.listElement.fade("hide"),this.displayElement.addEvent("focus",this.doFocus),this.listElement.set("tween",{duration:100,onComplete:function(e){0===e.getStyle("opacity")?e.addClass("hidden"):e.removeClass("hidden")}}),this.listElement.fade("hide")),this.items=[],this.fuzzySearchItems=[];var r=null;this.defaultValue=null,this.useWebWorkers?(this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"getList",html:this.selectElement.innerHTML,defaultValue:this.selectElement.get("data-default-value")||!1,uuid:this.uuid})):(Array.each(this.selectElement.getElements("option"),function(e,t){o=this.cleanDisplay(e.get("html")),value=e.get("value"),(a=new Element("li",{html:o,"data-value":value,class:"visible",id:this.uuid+"-li-"+t})).set("data-index",t),a.set("data-value",value),a.addEvent(Affinity.events.click,this.itemClicked),a.inject(this.listElement),e.selected&&(r=a,this.defaultValue=a,a.addClass("selected"),this.lastSelected=a,this.defaultChangeValue=e.value),this.items.push(a),this.fuzzySearchItems.push({id:this.uuid+"-li-"+t,html:o,klass:"visible",searchstr:o,value:e.value})}.bind(this)),this.continueProcessOptsions(r))}}},continueProcessOptsions:function(e){this.searchMode||(this.useWebWorkers||(this.fuzzySearchItemsTotal=this.fuzzySearchItems.length),this.iconElement&&this.iconElement.removeClass("working"),this.fuzzySearchLargeDataDelay=!1,this.fuzzySearchLargeDataDelay=100,this.fuzzySearchItemsTotal>=2e3&&this.fuzzySearchItemsTotal<3e3&&(this.fuzzySearchLargeDataDelay=250),this.fuzzySearchItemsTotal>=3e3&&this.fuzzySearchItemsTotal<5e3&&(this.fuzzySearchLargeDataDelay=500),this.fuzzySearchItemsTotal>=5e3&&(this.fuzzySearchLargeDataDelay=1e3),Affinity.isie&&11===Affinity.ieversion&&(this.fuzzySearchLargeDataDelay=1001),null===this.defaultValue&&(this.defaultValue=this.listElement.getElement("li")),this.keyHeldCheck=!1,this.keyHeld=!1,this.keyHeldDelay=null,this.displayElement.addEvent("keyup",this.doKeyUp),this.displayElement.addEvent("keydown",this.doKeyDown),null!==e&&this.defaultSelected({target:e}),this.fireEvent("complete",this),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,this.options.stopInitialChange&&this.selectElement.fireEvent("change",{target:this.selectElement}),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this)),this.displayElement&&this.valuetracker.addElement(this.displayElement)},stopEvent:function(e){e.stop()},reset:function(){if(!this.searchMode){var e=!1;"null"!==typeOf(this.defaultValue)&&this.defaultValue&&"li"===this.defaultValue.get("tag")&&(e=this.defaultValue),"null"!==typeOf(this.lastSelected)&&this.lastSelected&&"li"===this.lastSelected.get("tag")&&(e=this.lastSelected),Array.each(this.items,function(t,i){t.inject(this.listElement),t.removeClass("selected"),t.removeClass("hidden"),t.addClass("visible"),this.fuzzySearchLargeDataDelay||t.set("html",this.cleanDisplay(t.get("html").stripTags())),e&&t===e&&(t.addClass("selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5),this.displayElement.value=this.cleanDisplay(e.get("html").stripTags()))}.bind(this))}},checkExists:function(){document.contains(this.selectElement)||(clearInterval(this.checkExistsPeriodical),this.destroy())},doFocusDelay:!1,doFocus:function(){clearTimeout(this.doFocusDelay),this.doFocusDelay=function(){"closed"==this.status&&this.show("displayElement focus")}.delay(100,this),Affinity.mobile&&(this.displayElement.selectionStart=0,this.displayElement.selectionEnd=999999)},doClick:function(e){this.stopEvent(e),this.displayElement.select()},doKeyUp:function(e){"tab"==e.key||e.shift||("tab"==e.key&&this.hide("on key up tab"),clearTimeout(this.keyHeldDelay),this.keyHeld||this.elementKeyUp(e),this.keyHeld=!1,this.keyHeldCheck=!1)},doKeyDown:function(e){if("tab"==e.key&&this.hide("on key down tab"),"tab"!=e.key)if("enter"!=e.key){if("down"==e.key||"up"==e.key){if(this.keyHeldCheck||this.keyHeld)return void this.stopEvent(e);this.keyHeldCheck||this.keyHeld||(this.keyHeldCheck=!0,this.keyHeldDelay=this.elementKeySetHeld.delay(500,this,[e]))}}else this.stopEvent(e)},elementKeySetHeld:function(e){this.keyHeld=!0,this.elementKeyUp(e)},getTopVisibleElement:function(){var e,t,i=this.listElement.getElements("li.visible");for(e=0;e<i.length;e++)if((t=i[e]).getPosition(this.listElement).y>0)return t},getBottomVisibleElement:function(){var e,t,i=this.listElement.getSize().y,n=this.listElement.getElements("li.visible");for(e=n.length-1;e>0;e--)if((t=n[e]).getPosition(this.listElement).y<i)return t},scrollToTop:function(e){var t=this.listElement.getScroll().y,i=e.getPosition(this.listElement).y,n=e.getSize().y;i<0&&this.listElement.scrollTo(0,t+i-n+10)},scrollToBottom:function(e){var t=this.listElement.getScroll().y,i=this.listElement.getSize().y,n=e.getPosition(this.listElement).y,s=e.getSize().y;n>i-s&&this.listElement.scrollTo(0,t+(n-i)+s+5)},escapeRegExp:function(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},fuzzyRunning:!1,fuzzySearch:function(e,t,i,n){if(!this.fuzzyRunning){this.fuzzyRunning=!0;var s=[];if(this.useWebWorkers)this.fuzzyDoSearchData={searchData:e,target:n},this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"doSearch",data:e,searchKey:t,searchFor:i,perfDelay:this.fuzzySearchLargeDataDelay});else{var o,a,r,l,h,d,c,u,m,p,f,g,v,y,b=[];isNaN(i)?Array.each(e,function(e,n){a=document.id(e.id),r=0,i=i.toLowerCase(),h=e[t].toLowerCase().trim(),d=i===h,c=h.indexOf(i)>-1,p=i.split(" "),u=p.length,d?(m=u,l=99999,r=99999,this.fuzzySearchLargeDataDelay?a.removeClass("hidden").addClass("visible"):(y="<strong>"+this.cleanDisplay(a.get("html").stripTags())+"</strong>",a.set("html",y).removeClass("hidden").addClass("visible"))):!d&&c?(m=h.split(i).length-1||0,r=(l=m)+100,this.fuzzySearchLargeDataDelay?a.removeClass("hidden").addClass("visible"):(y=this.cleanDisplay(a.get("html").stripTags()).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1</strong>"),a.set("html",y).removeClass("hidden").addClass("visible"))):this.fuzzySearchLargeDataDelay<1001&&(f=h.split(" "),m=0,Array.each(p,(function(e){Array.each(f,(function(t){" "!=e&&""!=e&&(g=e.soundex(),v=t.soundex(),0==g.distance(v)&&(m+=1))}))})),r=m,l=Number.round(m/u,2)||0,r>=0&&(this.fuzzySearchLargeDataDelay?a.removeClass("hidden").addClass("visible"):(y=this.cleanDisplay(a.get("html").stripTags()),a.set("html",y).removeClass("hidden").addClass("visible")))),o={originalIndex:n,score:r,wordScore:l},b.push(o)}.bind(this)):Array.each(e,(function(e,n){a=document.id(e.id),e[t].contains(i)?(l=e[t].split(i).length-1||0,f=e[t].split(" "),b.push({originalIndex:n,score:l,wordScore:l/f}),a.removeClass("hidden").addClass("visible")):a.addClass("hidden").removeClass("visible")})),b.sort((function(e,t){return parseFloat(e.score)===parseFloat(t.score)?parseFloat(e.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(e.score)<parseFloat(t.score)?1:-1}));var A=!1;Array.each(b,(function(t){(o=e[t.originalIndex]).score=t.score,o.wordScore=t.wordScore,s.push(o),a=document.id(o.id),t.score>0?(a.inject(n),A=!0):a.addClass("hidden").removeClass("visible")})),!A&&b.length>0&&b[0].originalIndex&&e[b[0].originalIndex]&&e[b[0].originalIndex].id&&(this.bestguess=document.id(e[b[0].originalIndex].id))}return this.fuzzyRunning=!1,s}},elementKeyUp:function(e){var t=this.cleanDisplay(this.displayElement.value.toLowerCase()),i=this.listElement.getElement("li.visible.selected")||!1;return"enter"==e.key&&i?(this.stopEvent(e),void this.itemClicked({target:i})):"down"==e.key||"up"==e.key?("closed"==this.status&&this.show(),e.preventDefault(),"down"==e.key&&this.elementDown(e),"up"==e.key&&this.elementUp(e),void(this.keyHeld&&this.elementKeyUp.delay(50,this,[e]))):void((8===e.code||16===e.code||32===e.code||46===e.code||e.code>=48&&e.code<=57||e.code>=65&&e.code<=90||e.code>=96&&e.code<=105)&&("closed"==this.status&&this.show(),""!==t?(this.listElement.getElements("li").removeClass("selected"),this.listElement.scrollTo(0,0),i&&(this.lastSelected=i),this.fuzzySearchLargeDataDelay?(clearTimeout(this.fuzzySearchDelay),this.fuzzySearchDelay=this.continueWithFuzzySearch.delay(this.fuzzySearchLargeDataDelay,this)):this.continueWithFuzzySearch(),this.position()):this.useWebWorkers?this.fuzzyWorker.postMessage({job:"resetList"}):(Array.each(this.items,function(e,t){e.inject(this.listElement),e.set("html",this.cleanDisplay(e.get("html").stripTags())),e.removeClass("selected").removeClass("hidden").addClass("visible"),""===e.get("html").trim()&&(e.addClass("selected"),i!==e&&(this.changed=!0),this.lastSelected=e,this.defaultValue=e,this.selectElement.value="",this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.selectElement.getElements("option")[0].value)}.bind(this)),this.bestguess=this.defaultValue,window.fireEvent("elementChanged",{element:this.selectElement}))))},continueWithFuzzySearch:function(){this.fuzzySearch(this.fuzzySearchItems,"searchstr",this.cleanDisplay(this.displayElement.value.toLowerCase()),this.listElement),this.position()},elementUp:function(){if(0!==this.listElement.getElements("li.visible").length){var e=this.listElement.getElement("li.visible.selected"),t=this.getTopVisibleElement(),i=this.getBottomVisibleElement(),n=-1,s=this.listElement.getElements("li.visible");e&&(n=s.indexOf(e),e.removeClass("selected")),n>s.indexOf(i)?i&&"addClass"in i&&i.addClass("selected"):n>0?s[n-1]&&"addClass"in s[n-1]&&(s[n-1].addClass("selected"),this.scrollToTop(s[n-1])):this.listElement.scrollHeight==this.listElement.clientHeight?i&&"addClass"in i&&i.addClass("selected"):t&&"addClass"in t&&t.addClass("selected"),window.fireEvent("elementChanged",{element:this.selectElement})}else this.hide("elementUp with empty list")},elementDown:function(){if(0!==this.listElement.getElements("li.visible").length){var e=this.listElement.getElement("li.visible.selected"),t=this.getTopVisibleElement(),i=this.getBottomVisibleElement(),n=-1,s=this.listElement.getElements("li.visible");e&&"addClass"in e&&(n=s.indexOf(e),e.removeClass("selected")),n<s.indexOf(t)?t&&"addClass"in t&&t.addClass("selected"):n<s.length-1?s[n+1]&&"addClass"in s[n+1]&&(s[n+1].addClass("selected"),this.scrollToBottom(s[n+1])):this.listElement.scrollHeight==this.listElement.clientHeight?t&&"addClass"in t&&t.addClass("selected"):i&&"addClass"in i&&i.addClass("selected")}else this.hide("elementDown with empty list")},defaultSelected:function(e){var t=this.cleanDisplay(e.target.get("html").stripTags());this.listElement.getElements("li").removeClass("selected"),e.target.addClass("selected"),this.displayElement.value=t,this.selectElement.selectedIndex=e.target.get("data-index"),this.selectElement.value=e.target.get("data-value")},itemClicked:function(e){this.hide("item clicked");var t="li"==e.target.get("tag")?e.target:e.target.getParent("li"),i=!e.hasOwnProperty("fireEvents")||!1!==e.fireEvents;this.listElement.getElements("li").removeClass("selected"),t.addClass("selected"),this.lastSelected=t,this.displayElement.value=this.cleanDisplay(t.get("html").stripTags()),this.selectElement.selectedIndex=t.get("data-index"),this.selectElement.value=t.get("data-value"),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,i&&(this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete itemClicked"}),this.fireEvent("elementChanged",this.selectElement.value))},position:function(){if(this.displayElement&&this.listElement)try{var e=Affinity.mobile?this.displayElement.getBoundingClientRect():this.displayElement.getPosition(),t=this.displayElement.measure((function(){return this.getSize()})),i=window.getSize(),n=document.body.scrollTop||0,s=e.y+t.y+n+5,o=e.x,a=this.listElement.measure((function(){return this.getSize()}));this.center&&(o=e.x+t.x/2-a.x/2),i.y-e.y<a.y&&(s=e.y-a.y-5+n),e.x+a.x>i.x&&(o=i.x-a.x-5),this.listElement.setStyles({position:Affinity.mobile?"fixed":"absolute",top:s,left:o})}catch(e){}},obscure:function(){this.hide(),this.iconElement&&this.iconElement.addClass("hidden"),this.displayElement&&this.displayElement.addClass("hidden")},reveal:function(){this.iconElement&&this.iconElement.removeClass("hidden"),this.displayElement.removeClass("hidden")},hide:function(e){if("closed"!==this.status){clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay);var t=this.listElement;t.fade("out"),this.status="closed",function(){t.addClass("hidden"),this.listElement&&"getElement"in this.listElement&&!this.listElement.getElement("li.visible.selected")&&(this.lastSelected=this.listElement.getElement("li.visible.selected")),this.reset()}.delay(250,this)}},show:function(e){if("open"!==this.status&&this.listElement&&"getElements"in this.listElement&&this.listElement.getElements("li.visible").length>0){window.autocompletes.hideAll(this),clearTimeout(this.doFocusDelay);var t=this.listElement;if(t.removeClass("hidden"),this.position(),t.fade("in"),this.status="open",this.position.delay(250,this),this.listElement&&"getElement"in this.listElement&&this.listElement.getElement("li.visible.selected")){var i=this.listElement.getElement("li.visible.selected");this.listElement.scrollTo(0,i.getPosition(this.listElement).y-5)}}},clearList:function(){this.listElement&&(Array.each(this.listElement.getElements("li"),function(e){e.removeEvents()}.bind(this)),this.listElement.empty())},revert:function(e){var t="null"!==typeOf(e)&&e;return this.useWebWorkers&&this.fuzzyWorker&&"terminate"in this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1),clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay),clearInterval(this.checkExistsPeriodical),this.doFocusDelay=null,this.fuzzySearchDelay=null,this.checkExistsPeriodical=null,this.displayElement&&(Affinity.UI.lastAutoKill[this.uuid]={},Affinity.UI.lastAutoKill[this.uuid].id=this.uuid+"",Affinity.UI.lastAutoKill[this.uuid].killid=this.killid+"",Affinity.UI.lastAutoKill[this.uuid].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"",this.killid+""]),this.iconElement&&(this.iconElement.addClass("loading"),Affinity.UI.lastAutoKill[this.uuid+"_icon"]={},Affinity.UI.lastAutoKill[this.uuid+"_icon"].id=this.uuid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].killid=this.killid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"_icon",this.killid+"_icon"]))),Affinity.mobile||(document.removeEvent("scroll",this.position),document.removeEvent("resize",this.position)),this.listElement&&(this.listElement.set("tween",null),this.listElement.removeEvents(),this.clearList(),this.listElement.destroy()),this.displayElement&&(this.displayElement.removeEvents(),this.displayElement.getWidget("elementWidget")&&this.displayElement.getWidget("elementWidget").destroy(),this.searchMode&&this.displayElement.eliminate("value")),this.selectElement&&(this.selectElement.inject(this.hiddenWrapper,"before"),this.selectElement.eliminate("widget"),t&&(this.selectElement.retrieve("changetracker")&&this.selectElement.retrieve("changetracker").destroy(),this.selectElement.destroy())),this.hiddenWrapper&&this.hiddenWrapper.destroy(),window.autocompletes.widgets[this.uuid]&&(window.autocompletes.widgets[this.uuid]=null,delete window.autocompletes.widgets[this.uuid]),Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this)),!0},destroy:function(){this.useWebWorkers&&this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1),this.revert(!0)}}),UIBankNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-banknumber"),this.process)},process:function(e){e.removeClass("ui-banknumber"),new UIBankNumberWidget({element:e})}}),UIBankNumberWidget=new Class({Implements:[Options,Events],Binds:["bankFieldChange","currentLocation","bankFields","buildNZBank","buildAUBank","bankValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy","padLeft"],options:{element:null,hasPayPoint:!0},element:null,type:"banknumber",initialize:function(e){if(this.setOptions(e),this.uuid=String.uniqueID(),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{class:"countryselector"}).inject(this.options.element,"before"),this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown="True"===t?new Element("select",{class:"selector validate","data-validate-method":"bankNumberCountry"}).inject(this.dropdownDiv):new Element("select",{class:"selector"}).inject(this.dropdownDiv),this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown),this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdown),this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after"),this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(e){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden"),this.disabled?(this.countrySelectEl=new Element("input",{type:"text",class:"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.bankFieldChange,window.addEvent("bankValidationReturned",this.processValidation)),this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country"),this.bankFields(this.currentLocation())},bankFieldChange:function(){null!=this.element&&this.element.destroy(),this.bankFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?"select"===this.countrySelectEl.get("tag")&&"-1"!=this.countrySelectEl.selectedIndex?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},bankFields:function(e){"NZ"===e?(this.buildNZBank(),this.originalElement.removeClass("hidden")):"AU"===e?(this.buildAUBank(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("bankValidationError",{target:this.originalElement,silent:!0}))},buildNZBank:function(){this.element=new Element("div",{class:"banknumberbox ui-validate nz","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.bankNumberPart1=new Element("input",{class:"bank",id:"bank",type:"text",maxlength:"2"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart2=new Element("input",{class:"branch",id:"branch",type:"text",maxlength:"4"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart3=new Element("input",{class:"account",id:"account",type:"text",maxlength:"7"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart4=new Element("input",{class:"suffix",id:"suffix",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.name=new Element("span",{class:"names"}).inject(this.element),this.bankname=new Element("span",{class:"bankname"}).inject(this.name),this.branchname=new Element("span",{class:"branchname"}).inject(this.name),this.hiddenWrapper||(this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element)),this.element.inject(this.hiddenWrapper,"before"),this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.bankNumberPart4.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.bankNumberPart3.onblur=this.padLeft,this.bankNumberPart4.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},buildAUBank:function(){this.element=new Element("div",{class:"banknumberbox ui-validate au","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.bankNumberPart1=new Element("input",{class:"bank",id:"bank",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart2=new Element("input",{class:"branch",id:"branch",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:"-"}).inject(this.element),this.bankNumberPart3=new Element("input",{class:"account",id:"account",type:"text",maxlength:"14"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.name=new Element("span",{class:"names"}).inject(this.element),this.bankname=new Element("span",{class:"bankname"}).inject(this.name),this.branchname=new Element("span",{class:"branchname"}).inject(this.name),this.hiddenWrapper||(this.hiddenWrapper=new Element("div",{class:"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element)),this.element.inject(this.hiddenWrapper,"before"),this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden(),this.bankValidation()},padLeft:function(){this.bankNumberPart3&&""!==this.bankNumberPart3.value&&(this.bankNumberPart3.value=this.bankNumberPart3.value.padStart(7,"0"))},setFromInitialValue:function(){var e=this.hiddenWrapper.getElement("input").value.split("-");"NZ"==this.currentLocation()?(this.bankNumberPart1.value=e[0]?e[0].length>2?e[0].substring(0,2):e[0]:"",this.bankNumberPart2.value=e[1]?e[1]:"",this.bankNumberPart3.value=e[2]?e[2]:"",this.bankNumberPart4&&(e[2]&&e[2].length>7?(this.bankNumberPart3.value=e[2].substring(0,7),this.bankNumberPart4.value=e[2].substring(7,e[2].length)):this.bankNumberPart4.value=e[3]?e[3]:"")):"AU"==this.currentLocation()?(this.bankNumberPart1.value=e[0]?e[0]:"",this.bankNumberPart2.value=e[1]?e[1]:"",this.bankNumberPart3.value=(e[2]?e[2]:"")+(e[3]?e[3]:"")):(this.bankNumberPart1.value="",this.bankNumberPart2.value="",this.bankNumberPart3.value="",this.bankNumberPart4&&(this.bankNumberPart4.value="")),this.bankValidation()},copyToHidden:function(){var e="";"NZ"==this.currentLocation()?e=(""!=this.bankNumberPart1.value?this.bankNumberPart1.value+"-":"")+(""!=this.bankNumberPart2.value?this.bankNumberPart2.value+"-":"")+(""!=this.bankNumberPart3.value?this.bankNumberPart3.value+"-":"")+(""!=this.bankNumberPart4.value?this.bankNumberPart4.value:""):"AU"==this.currentLocation()&&(e=(""!=this.bankNumberPart1.value?this.bankNumberPart1.value+"-":"")+(""!=this.bankNumberPart2.value?this.bankNumberPart2.value+"-":"")+(""!=this.bankNumberPart3.value?this.bankNumberPart3.value:"")),this.hiddenWrapper.getElement("input").value=e,this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},bankValidationDelay:!1,bankValidation:function(){clearTimeout(this.bankValidationDelay),this.bankValidationDelay=function(){var e=this.hiddenWrapper.getElement("input"),t=e.getParent("form");null!=t&&t.retrieve("validation")&&t.retrieve("validation").validateBankNumber(e,this.currentLocation(),e.get("name"))}.delay(500,this)},processValidation:function(e){var t=e.el,i=e.data;t===this.originalElement&&(this.bankname.set("html",i.bankName),this.branchname.set("html",i.branchName),i.success?this.success():t.value?this.failed():(window.fireEvent("bankValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Tick),t.removeClass("red").addClass("green")},failed:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Cross),t.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()}}),UIDateCalendar=new Class({Version:"1.0.0.0",File:"ui.date.calendar.js",Implements:[Options,Events],Binds:["processNew","processDateInput","hideAll"],options:{outputFormat:"%d.%m.%Y",displayFormat:"%a the %e%o of %b %Y"},widgets:{},initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.calendars=this,this.processNew()},processNew:function(){Array.each(document.getElements("input.uidate-calendar"),this.processDateInput)},processDateInput:function(e){if(!e.hasClass("uidone")){e.addClass("uidone");var t={target:e,postName:e.get("name")||"",postId:e.get("id")||"",startDate:e.get("data-start-date")||new Date,validationMethods:e.get("data-validate-method")||"",validationErrorStr:e.get("data-validate-error-str")||"",showInline:!!e.hasClass("show-inline"),nullable:!1};switch(e.get("data-calendar-type")){default:t.showCalendar=!0,t.showTime=!1;break;case"time":t.showCalendar=!1,t.showTime=!0;break;case"datetime":t.showCalendar=!0,t.showTime=!0;break;case"hoursmins":t.showCalendar=!0,t.showTime=!0,t.hoursmins=!0}e.get("data-calendar-display-format")&&(t.displayFormat=e.get("data-calendar-display-format")),e.get("data-calendar-return-format")&&(t.outputFormat=e.get("data-calendar-return-format")),e.get("data-calendar-nullable")&&(t.nullable="true"===e.get("data-calendar-nullable").trim().toLowerCase()),e.get("data-calendar-hoursmins")&&(t.hoursmins="true"===e.get("data-calendar-hoursmins").trim().toLowerCase()),e.hasClass("preserve-original-input")&&(t.preserveOriginalInput=!0),t.hoursmins&&!e.get("data-start-date")&&(t.startDate.setMinutes(0),t.startDate.setHours(0),t.startDate.setSeconds(0),t.startDate.setMilliseconds(0));var i=new UIDateTimeWidget(t);this.widgets[i.uuid]||(this.widgets[i.uuid]=i),delete i,delete t}},hideAll:function(e){Object.each(this.widgets,function(t){"null"!==typeOf(e)&&e.uuid?t.uuid!==e.uuid&&t.hide():t.hide()}.bind(this))}}),UIDateTimeWidget=new Class({Implements:[Options,Events],options:{target:null,preserveOriginalInput:!1,outputFormat:"%d.%m.%Y",displayFormat:"%a %e %b %Y",showCalendar:!0,showTime:!1,startDate:null,labelName:"",postId:"",postName:"",validationMethods:"",validationErrorStr:"",cssPosition:"absolute",watchOutput:!1,nullable:!1,hoursmins:!1,showInline:!1},Binds:["getDate","getDateObject","getValue","getDisplayValue","documentClick","calendarClick","calendarEnter","calendarLeave","monthElementClicked","yearElementClicked","monthSelectorClicked","yearSelectorClicked","lastMonth","nextMonth","resetCalendar","nextMonthDown","lastMonthDown","dayClicked","timeChanged","setCalendarDate","changeMonth","changeYear","attemptParse","setToday","setNone","externalShow","watchOutputChanges","obscure","reveal","show","hide","destroy"],row:null,date:null,__uiDate:null,__selectedDate:null,getValue:function(){return this.date.format(this.options.displayFormat)},getDisplayValue:function(){return this.date.format(this.options.outputFormat)},initialize:function(e){this.setOptions(e),this.showDefault="none"!=this.options.startDate;var t,i=new Date;if(this.__uiDate=i.clone(),this.__selectedDate=this.date=!1,"none"==this.options.startDate?this.options.target&&"value"in this.options.target&&""!==this.options.target.value.trim()&&Date.parse(this.options.target.value).isValid()?(this.__uiDate=Date.parse(this.options.target.value),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone(),this.showDefault=!0):this.showDefault=!1:"today"==this.options.startDate?(this.__uiDate=i.clone(),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()):this.options.startDate&&null!==this.options.startDate&&Date.parse(this.options.startDate).isValid()&&(this.__uiDate=Date.parse(this.options.startDate),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.hoursmins&&i.getTime()===this.__uiDate.getTime()&&(this.__uiDate.setMinutes(0),this.__uiDate.setHours(0),this.__uiDate.setSeconds(0),this.__uiDate.setMilliseconds(0),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.nullable&&(this.showDefault=!1),this.id=null!=this.options.target&&this.options.target.get("id")?this.options.target.get("id"):String.uniqueID(),this.uuid=this.id,Affinity.UI.calendars.widgets[this.uuid]||(Affinity.UI.calendars.widgets[this.uuid]=this),this.display=new Element("input",{type:"text",class:"ui-calendar-display data-hj-whitelist widget",id:this.id+"-Display"}).store("widget",this),this.output=new Element("input",{type:"hidden",name:this.options.postName,id:this.options.postId,"data-display-id":this.id+"-Display"}),Affinity.mobile&&this.display.set("readonly","true"),""!=this.options.validationMethods&&(this.output.addClass("validate"),this.output.set("data-validate-method",this.options.validationMethods),this.options.validationErrorStr&&this.output.set("data-validate-error-str",this.options.validationErrorStr)),this.watch=this.options.watchOutput||!1,"null"!==typeOf(this.options.target)&&this.options.target.hasClass("uidate-watch")&&(this.watch=!0),this.watch&&(this.watchTimer=this.watchOutputChanges.periodical(500,this)),this.reuse=this.options.preserveOriginalInput||!1,"null"!==typeOf(this.options.target)&&this.options.target.hasClass("uidate-preserve")&&(this.reuse=!0),this.reuse)if("null"===typeOf(this.options.target))this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{class:"hidden"}).inject(this.label,"after");else{this.row=this.options.target.getParent(".form-row")||!1,this.target=this.options.target,this.output=this.target;var n=new Element("div",{class:"subhidden"});this.target.store("widget",this),this.row?(n.inject(this.row,"top"),this.display.inject(this.row,"bottom")):(n.inject(this.output,"before"),this.display.inject(this.output,"after")),this.output.inject(n)}else null==this.options.target?(this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{class:"hidden"}).inject(this.label,"after")):(this.target=new Element("div",{class:"hidden"}).inject(this.options.target,"after"),this.options.target.value&&(t=Date.parse(this.options.target.value)).isValid()&&(this.options.startDate=t),this.row=this.options.target.getParent(".form-row"),this.options.postId=this.options.target.get("id"),""==this.options.postName&&(this.options.postName=this.options.target.get("name"),this.output.set("name",this.options.postName)),this.display.cloneEvents(this.options.target),this.options.target.set("id","__"+this.options.target.get("id")),this.options.target.set("name",null),this.options.target.removeEvents(),this.options.target.store("widget",this).addClass("hidden")),null!==this.row&&this.row.set("class","form-row ui-calendar-row "+this.id),this.display.inject(this.target,"after"),this.output.inject(this.target,"after"),this.target.destroy();this.icons={},this.icons.Open=Affinity.icons.Popup||"&#xe012;",this.icons.Today=Affinity.icons.Calendar||"&#xe02e;",this.icons.Clear=Affinity.icons.Cross||"&#xe067;",this.icons.Tick=Affinity.icons.Tick,this.dontClose=!1,this.calendarOver=!1,this.buttons=new Element("span",{class:"ui-calendar-buttons"}).inject(this.display,"after"),this.showbutton=new Element("span",{class:"ui-calendar-button button w-icon-only blue ui-has-tooltip",html:"<span>"+this.icons.Open+"</span>","data-calendar":this.id,"data-tooltip":"Open","data-tooltip-dir":"top"}).inject(this.buttons),this.todaybutton=new Element("span",{class:"ui-calendar-button button w-icon-only green ui-has-tooltip",html:"<span>"+this.icons.Today+"</span>","data-calendar":this.id,"data-tooltip":"Set date to today","data-tooltip-dir":"top"}).inject(this.buttons),this.clearbutton=new Element("span",{class:"ui-calendar-button button w-icon-only orange ui-has-tooltip",html:"<span>"+this.icons.Clear+"</span>","data-calendar":this.id,"data-tooltip":"Clear the date","data-tooltip-dir":"top"}).inject(this.buttons),this.calendarBox=new Element("div",{class:"ui-calendar",id:this.domid}).inject(document.body),this.calendarBox.set("reveal",{duration:250}),this.options.showInline||this.calendarBox.addEvent(Affinity.events.click,this.calendarClick),Affinity.mobile&&this.options.showInline||(this.calendarBox.addEvent(Affinity.events.overAll,this.calendarEnter),this.calendarBox.addEvent(Affinity.events.outAll,this.calendarLeave)),this.options.showInline||(this.display.addEvent(Affinity.events.click,this.externalShow),this.showbutton.addEvent(Affinity.events.click,this.externalShow),this.display.addEvent("blur",this.attemptParse),document.addEvent(Affinity.events.click,this.documentClick),this.todaybutton.addEvent(Affinity.events.click,this.setToday),this.clearbutton.addEvent(Affinity.events.click,this.setNone)),this.output&&this.date&&"element"===typeOf(this.output)&&"date"===typeOf(this.date)&&this.options.outputFormat&&this.output.store("defaultValue",this.date.format(this.options.outputFormat)),this.printField=!1,this.display.getParent(".ui-calendar-row")&&this.display.getParent(".ui-calendar-row").getElement(".print-field")&&(this.printField=this.display.getParent(".ui-calendar-row").getElement(".print-field")),this.buildCalendar(),window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this)),Affinity.mobile&&(window.addEvent("mobileback",this.documentClick),"onorientationchange"in window&&window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this))),this.valuetracker=new Affinity.ElementValueTracker,this.display&&this.valuetracker.addElement(this.display),this.output&&this.valuetracker.addElement(this.output),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this),this.options.showInline&&(this.buttons.addClass("hidden"),this.display.addClass("hidden"),this.calendarBox.addClass("inline"),this.calendarBox.inject(this.display.getParent(),"bottom"),this.show())},checkExists:function(){document.contains(this.output)||(clearInterval(this.checkExistsPeriodical),this.destroy())},documentClick:function(e){"open"==this.status&&this.hide(null,"doc "+this.id)},calendarClick:function(e){e.stopPropagation(),e.preventDefault()},calendarEnter:function(e){this.calendarOver=!0},calendarLeave:function(e){this.calendarOver=!1},monthElementClicked:function(e){this.calendarContainer.reveal(),this.monthbox.dissolve(),this.changeMonth(e.target.get("data-value")),this.monthbox.getElements(".active").removeClass("active"),e.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},yearElementClicked:function(e){this.calendarContainer.reveal(),this.yearbox.dissolve(),this.changeYear(e.target.get("data-value")),this.yearbox.getElements(".active").removeClass("active"),e.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},monthSelectorClicked:function(e){this.monthbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve()},yearSelectorClicked:function(e){this.yearbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve(),function(){var e=this.yearbox.getElement(".active").getPosition(this.yearbox).y;this.yearbox.scrollTo(0,e-5)}.delay(500,this)},nextMonthDown:function(e){e.preventDefault(),e.stopPropagation()},lastMonthDown:function(e){e.preventDefault(),e.stopPropagation()},getHumanHour:function(e){return 0==e?"Midnight":e<12?e+" am":e>12?e-12+" pm":"Midday"},buildCalendar:function(){var e,t,i=new Date;if(this.options.showCalendar){this.calendarContainer=new Element("div").inject(this.calendarBox),this.lastButton=new Element("span",{html:"&#9668;",class:"ui-calendar-nextlast"}).inject(this.calendarContainer);var n=new Element("span",{html:"",class:"ui-calendar-monthyear"}).inject(this.calendarContainer);for(this.nextButton=new Element("span",{html:"&#9658;",class:"ui-calendar-nextlast"}).inject(this.calendarContainer),this.monthButton=new Element("span",{class:"ui-calendar-month"}).inject(n),this.yearButton=new Element("span",{class:"ui-calendar-year"}).inject(n),this.monthbox=new Element("div",{class:"ui-calendar-monthbox"}).inject(this.calendarBox),this.monthbox.set("reveal",{duration:250}),this.monthbox.toggle(),this.yearbox=new Element("div",{class:"ui-calendar-yearbox"}).inject(this.calendarBox),this.yearbox.set("reveal",{duration:250}),this.yearbox.toggle(),e=0;e<12;e++)this.monthbox.adopt(new Element("span",{class:"m"+e+(e===i.getMonth()?" today":""),html:i.clone().set("month",e).format("%b"),"data-value":e}).addEvent(Affinity.events.click,this.monthElementClicked));var s=i.clone();for(e=s.getFullYear()-100;e<s.getFullYear()+50;e++)new Element("span",{class:"y"+e+(e===i.getFullYear()?" today":""),html:e,"data-value":e}).addEvent(Affinity.events.click,this.yearElementClicked).inject(this.yearbox,"top");for(e=0;e<7;e++)i.set("day",e),new Element("span",{html:i.format("%a"),class:"ui-calendar-daylabel"}).inject(this.calendarContainer);for(e=0;e<42;e++)t=new Element("span",{class:"ui-calendar-day"}).adopt(new Element("span")).inject(this.calendarContainer),this.setupClickable(t);this.nextButton.addEvent(Affinity.events.click,this.nextMonth),this.lastButton.addEvent(Affinity.events.click,this.lastMonth),this.monthButton.addEvent(Affinity.events.click,this.monthSelectorClicked),this.yearButton.addEvent(Affinity.events.click,this.yearSelectorClicked),Affinity.mobile||(this.nextButton.addEvent("mousedown",this.nextMonthDown),this.lastButton.addEvent("mousedown",this.lastMonthDown))}if(this.options.showTime){var o=150;this.options.showCalendar&&(this.calendarContainer.set("reveal",{duration:250}),o=this.calendarContainer.measure((function(){return this.getSize()})).x-20);var a=!!this.__selectedDate&&this.__selectedDate.clone();this.timeWidget=new UITimePickerWidget({target:this.calendarBox,displayInput:this.display,timeonly:!this.options.showCalendar,date:a,hoursmins:this.options.hoursmins,dateWidget:this,onTimeSet:function(e){"date"===typeOf(e)&&e.isValid()&&(this.__selectedDate?e.getTime()!==this.__selectedDate.getTime()&&(this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__selectedDate=this.date.clone(),this.__uiDate=this.date.clone(),this.setCalendarDate()):this.date?e.getTime()!==this.date.getTime()&&(this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):this.options.nullable&&this.options.showCalendar||(this.date=e,this.date.setHours(e.getHours()),this.date.setMinutes(e.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()))}.bind(this),onOpen:function(){this.options.showCalendar&&this.calendarContainer.dissolve()}.bind(this),onDone:function(e){this.options.showCalendar?this.calendarContainer.reveal():this.hide(e,"timeWidget"),this.output.fireEvent("change",{target:this.output})}.bind(this),width:o})}this.setupCalendar(null!=this.options.startDate)},setupCalendar:function(e){var t="null"!==typeOf(e)&&e,i=new Date;if(this.options.showCalendar){var n,s=1,o=this.__uiDate.get("month"),a=this.__uiDate.get("year"),r=this.__uiDate.get("lastdayofmonth"),l=this.__uiDate.clone().set("date",1).get("day");this.calendarBox.getElement(".ui-calendar-month").set("html",this.__uiDate.format("%B")),this.calendarBox.getElement(".ui-calendar-year").set("html",this.__uiDate.getFullYear()),this.calendarBox.getElements(".ui-calendar-day").removeClass("today").removeClass("selected").removeClass("active"),Array.each(this.calendarBox.getElements(".ui-calendar-day"),function(e,t){e.set("class","ui-calendar-day"),e.getElement("span").set("html","&nbsp;"),t>=l&&t<l+r&&s==i.get("date")&&o==i.get("month")&&a==i.get("year")&&e.addClass("today"),t>=l&&t<l+r&&s==this.__uiDate.get("date")&&o==this.__uiDate.get("month")&&a==this.__uiDate.get("year")&&e.addClass("selected"),t>=l&&t<l+r&&(n=this.__uiDate.clone().set("date",s).format("%b%d%Y"),e.getElement("span").set("html",s),e.addClass(n),e.addClass("active"),e.store("date",this.__uiDate.clone().set("date",s)),s++)}.bind(this)),this.monthbox.getElements(".active").removeClass("active"),this.monthbox.getElement(".m"+this.__uiDate.getMonth()).addClass("active"),this.yearbox.getElements(".active").removeClass("active"),this.yearbox.getElement(".y"+this.__uiDate.getFullYear()).addClass("active")}this.options.showTime&&this.timeWidget.setTime(this.__uiDate),t&&this.setCalendarDate()},setupClickable:function(e){e.addEvent(Affinity.events.click,this.dayClicked)},dayClicked:function(e){var t,i=e.target.hasClass("ui-calendar-day")?e.target:e.target.getParent(".ui-calendar-day");i.hasClass("active")&&(this.calendarBox.getElements(".ui-calendar-day.selected").removeClass("selected"),t=i.retrieve("date"),this.date=t.clone(),this.__uiDate=t.clone(),this.__selectedDate=t.clone(),i.addClass("selected"),this.setCalendarDate(),this.fireEvent("dateClicked",this.date),this.options.showTime||this.hide())},nextMonth:function(e){var t=this.__uiDate.get("month");t=t+1>11?0:t+1,this.changeMonth(t),0===t&&this.changeYear(this.__uiDate.get("year")+1)},lastMonth:function(e){var t=this.__uiDate.get("month");t=t-1<0?11:t-1,this.changeMonth(t),11===t&&this.changeYear(this.__uiDate.get("year")-1)},changeMonth:function(e){this.doEvent=!1;var t=this.__uiDate.clone().set("date",1).set("month",e).get("lastdayofmonth"),i=this.__uiDate.get("date");i=i>t?t:i,this.__uiDate.set("date",1).set("month",e).set("date",i),this.setupCalendar(),this.setCalendarDate()},changeYear:function(e){this.doEvent=!1;var t=this.__uiDate.clone().set("date",1).set("month",e).get("lastdayofmonth"),i=this.__uiDate.get("date");i=i>t?t:i,this.__uiDate.set("date",1).set("year",e).set("date",i),this.setupCalendar(),this.setCalendarDate()},doEvent:!0,setCalendarDate:function(){var e=!1;return this.__selectedDate&&(this.__selectedDate.format(this.options.outputFormat)!==this.output.value&&(e=!0),this.display.value=this.__selectedDate.format(this.options.displayFormat),this.output.value=this.__selectedDate.format(this.options.outputFormat),this.printField&&this.printField.set("html",this.display.value)),this.doEvent&&(e&&window.fireEvent("formElementChanged",{element:this.output}),this.fireEvent("dateChanged",this.date),window.fireEvent("elementChanged",{element:this.output}),this.output.fireEvent("change",{target:this.output})),this.doEvent=!0,!0},getDate:function(){var e=this.getDateObject();return!!e&&e.format(this.options.outputFormat)},getDateObject:function(){if(this.__selectedDate)return this.__selectedDate;if(!this.options.nullable){if(this.date)return this.date;if(this.__uiDate)return this.__uiDate}return!1},getRawDate:function(){if(!this.__selectedDate)return!1;if(""===this.output.value)return!1;var e=Date.parse(this.output.value);return!(null===e||!typeOf(e)||!e.isValid())&&e},setDate:function(e,t){if(e&&"date"!==typeOf(e))try{e=Date.parse(e)}catch(e){return}e&&"date"===typeOf(e)&&e.isValid()?("boolean"===typeOf(t)&&!1===t&&(this.doEvent=!1),this.date=e,this.__uiDate=e.clone(),this.__selectedDate=e.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0):this.options.nullable?("boolean"===typeOf(t)&&!1===t&&(this.doEvent=!1),this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.setupCalendar(),this.output.value="",this.display.value="",this.doEvent=!0):(this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0)},setToday:function(e){this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.dontClose=!1,this.setupCalendar(!0)},setNone:function(e){this.date=this.__uiDate=new Date,this.__selectedDate=!1,this.output.value="",this.display.value="",this.showDefault=!1,this.dontClose=!1,this.output.fireEvent("change",{target:this.output})},attemptParse:function(e){if("null"===typeOf(e)||!e.type||"blur"!==e.type||"open"!==this.status||!this.calendarOver)if(!this.options.showCalendar&&this.options.showTime&&this.timeWidget);else{var t=this.display.value,i=!1;try{i=Date.parse(t)}catch(e){console.log(e)}if(i&&"date"==typeOf(i))if(i.isValid()){var n=!!this.__selectedDate&&this.__selectedDate.clone();this.date=i,this.__uiDate=i.clone(),this.__selectedDate=i.clone(),"null"!==typeOf(e)?this.setupCalendar(!0):this.setupCalendar(),n&&i.setMilliseconds(0)===this.date.setMilliseconds(0)||(this.setCalendarDate(),this.output.fireEvent("change",{target:this.output}))}else this.__selectedDate=!1,this.display.value="Invalid Date. No date set.",this.output.value="",this.output.fireEvent("change",{target:this.output});else this.options.nullable?(this.output.value="",this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.output.fireEvent("change",{target:this.output})):(this.__selectedDate?this.display.value=this.__selectedDate.format(this.options.displayFormat):this.display.value=this.__uiDate.format(this.options.displayFormat),this.printField&&this.printField.set("html",this.display.value));this.hide(null,"attemptParse "+this.id)}},positionOverride:!1,position:function(){var e,t,i=this.positionOverride?this.positionOverride.getPosition():this.display.getPosition(),n=this.positionOverride?this.positionOverride.getSize():this.display.getSize(),s=window.getSize(),o=i.y+n.y+5,a=i.x,r=this.options.cssPosition,l=this.calendarBox.measure((function(){return this.getSize()}));Affinity.mobile?this.calendarBox.hasClass("scaled")||(a=0,n=l,(s=parent.getSize()).x-=40,s.y-=40,e=n.x>n.y?Number(s.x/n.x).round(2):Number(s.y/n.y).round(2),n.y*e>s.y&&(e=Number(s.y/n.y).round(2)),n.x*e>s.x&&(e=Number(s.x/n.x).round(2)),s.x+40>n.x*e&&(a=(s.x+40-n.x*e)/2),t={position:"fixed",top:a,left:a,"-webkit-transform":"scale("+e+")","-webkit-transform-origin":"0 0",transform:"scale("+e+")","transform-origin":"0 0"},this.calendarBox.setStyles(t),this.calendarBox.addClass("scaled")):(s.y-(i.y-window.getScroll().y)<l.y&&(o=i.y-l.y-5),i.x-window.getScroll().x+l.x>s.x&&(a=s.x-l.x-5),"fixed"===r&&(o-=window.getScroll().y),t={position:r,top:o,left:a},this.calendarBox.setStyles(t),this.delayedRePosition&&clearTimeout(this.delayedRePosition),this.delayedRePosition=setTimeout(function(){this.calendarBox.setStyles(t)}.bind(this),500))},watchOutputChanges:function(){var e=this.output.value,t=Date.parse(e);t&&t.hasOwnProperty("isValid")&&t.isValid()&&t!==this.date&&this.setDate(t,!1)},externalShow:function(e){e.stopPropagation(),Affinity.UI.calendars.hideAll(this),Affinity.mobile&&this.display.blur(),this.show()},obscure:function(){this.hide(),this.showbutton&&this.showbutton.addClass("hidden"),this.todaybutton&&this.todaybutton.addClass("hidden"),this.clearbutton&&this.clearbutton.addClass("hidden"),this.display&&this.display.addClass("hidden")},reveal:function(){this.showbutton&&this.showbutton.removeClass("hidden"),this.todaybutton&&this.todaybutton.removeClass("hidden"),this.clearbutton&&this.clearbutton.removeClass("hidden"),this.display&&this.display.removeClass("hidden")},show:function(e){this.options.showInline||(Affinity.UI.calendars.hideAll(this),this.position()),this.calendarBox.reveal(),this.status="open"},hide:function(e,t){this.options.showInline||this.dontClose||(this.monthbox&&this.monthbox.dissolve(),this.yearbox&&this.yearbox.dissolve(),this.calendarContainer&&this.calendarContainer.reveal(),this.calendarBox&&this.calendarBox.dissolve(),this.status="closed")},destroy:function(){if(clearInterval(this.checkExistsPeriodical),this.showbutton&&this.showbutton.removeEvents(),this.todaybutton&&this.todaybutton.removeEvents(),this.clearbutton&&this.clearbutton.removeEvents(),this.display&&this.display.removeEvents(),document.removeEvent(Affinity.events.click,this.documentClick),this.options.showCalendar&&(this.calendarContainer&&(Array.each(this.calendarContainer.getElements(".ui-calendar-day"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.calendarContainer.set("reveal",null),this.calendarContainer.set("tween",null),this.calendarContainer.removeEvents()),this.monthbox&&(Array.each(this.monthbox.getElements("span"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.monthbox.set("reveal",null),this.monthbox.set("tween",null),this.monthbox.removeEvents()),this.yearbox&&(Array.each(this.yearbox.getElements("span"),function(e){e.removeEvents(),e.destroy()}.bind(this)),this.yearbox.set("reveal",null),this.yearbox.set("tween",null),this.yearbox.removeEvents()),this.nextButton&&this.nextButton.removeEvents(),this.lastButton&&this.lastButton.removeEvents(),this.yearButton&&this.yearButton.removeEvents(),this.monthButton&&this.monthButton.removeEvents()),this.options.showTime&&this.timeWidget.destroy(),Affinity.UI.calendars.widgets[this.uuid]&&(Affinity.UI.calendars.widgets[this.uuid]=null,delete Affinity.UI.calendars.widgets[this.uuid]),this.buttons&&(this.buttons.empty(),this.buttons.destroy()),this.display&&this.display.destroy(),this.output&&this.output.destroy(),this.calendarBox&&(this.calendarBox.set("reveal",null),this.calendarBox.set("tween",null),this.calendarBox.removeEvents(),this.calendarBox.empty(),this.calendarBox.destroy()),this.options.target)try{this.options.target.eliminate("widget"),this.options.target.destroy()}catch(e){}Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this))}}),UIDateDropDowns=new Class({Implements:[Options],Binds:["processDates","setDate"],options:{dateMooFormat:"%d.%m.%Y"},initialize:function(e){this.setOptions(e),this.days=["sun","mon","tue","wed","thu","fri","sat"],this.months=["january","february","march","april","may","june","july","august","september","october","november","december"],this.today=new Date,this.dateInputs=document.getElements("input.date-drops"),Array.each(this.dateInputs,this.processDates)},processDates:function(e){var t,i,n;e.set("type","hidden"),""!=e.value&&(n=Date.parse(e.value)).isValid()&&(this.today=n);var s=new Element("div",{class:"datepicker"}).inject(e,"before"),o=new Element("select",{class:"date-day"}).inject(s),a=new Element("select",{class:"date-month"}).inject(s),r=new Element("select",{class:"date-year"}).inject(s);new Element("br").inject(s),new Element("span").inject(s),s.adopt(e);var l=!1;for(""!=s.getElement("input").value&&null===(l=Date.parse(s.getElement("input").value))&&(l=!1),new Element("option",{value:"",html:""}).inject(o),t=0;t<31;t++)new Element("option",{value:t+1,html:t+1}).inject(o);for(l&&(o.value=parseInt(this.today.format("%e"),10)),new Element("option",{value:"",html:""}).inject(a),t=0;t<12;t++)new Element("option",{value:t,html:this.months[t].capitalize()}).inject(a);for(l&&(a.value=parseInt(this.today.format("%m"),10)-1),new Element("option",{value:"",html:""}).inject(r),t=(i=parseInt(this.today.format("%Y"),10))-100;t<i+10;t++)new Element("option",{value:t,html:t}).inject(r);l&&(r.value=i),o.addEvent("change",this.setDate),a.addEvent("change",this.setDate),r.addEvent("change",this.setDate),this.setDate(null,s)},setDate:function(e,t){null!=e&&(t=e.target.getParent());var i=t.getElements("select");if(""===i[0].value||""===i[1].value||""===i[2].value)return t.getElement("input").value="",void t.getElement("span").set("html","");var n=(new Date).set("year",i[2].value).set("month",i[1].value).set("date",i[0].value).set("hr",0).set("min",0).set("sec",0).set("ms",0);n.isValid()&&(t.getElement("input").value=n.format(this.options.dateMooFormat),t.getElement("span").set("html",n.format("%A the %e%o of %B %Y"))),delete n,delete i}}),UIDisplayLookup=new Class({Version:"1.0.2.0",File:"ui.display.lookup.js",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","setValue","refreshQueue","cancelQueue","processQueue"],options:{jsonp:!1},enabled:!1,initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.displaylookups||(Affinity.UI.displaylookups={}),Affinity.UI.displaylookupLoaders=[],window.addEvent("refreshQueues",this.refreshQueue),window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this)),this.processNew()},processNew:function(e){this.setOptions(e);var t=document.getElements(".has-display-lookup");Array.each(t,this.processLookup),this.processQueue(),delete t},processLookup:function(e){var t,i;e.get("data-lookup-api")&&(e.removeClass("has-display-lookup"),""!==e.get("data-lookup-api")&&(t=e.get("data-lookup-api"),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.displaylookups[i]?Affinity.UI.displaylookups[i].elements.contains[e]||Affinity.UI.displaylookups[i].elements.push(e):Affinity.UI.displaylookups[i]={api:t,id:"dis_lookup_"+String.uniqueID(),type:"display",loaded:!1,elements:[e]}))},getApiKey:function(e){var t,i=new URI(e.toLowerCase()).get("query").parseQueryString(),n=[],s=[],o=!1,a="";return Object.each(i,(function(e,t){"ran"!==t.toLowerCase()&&("parameters"!==t?n.push(t+"-"+e):o=JSON.parse(e))})),n=n.sort(),o&&"object"===typeOf(o)&&"parameter"in o&&"array"===typeOf(o.parameter)&&(Array.each(o.parameter,(function(e){t=[],Object.each(e,(function(e,i){"ran"!==i.toLowerCase()&&t.push(i+"-"+e)})),t.sort(),s.push(t.join("|"))})),s.sort(),a="|parameters|"+s.join("||")),"display-"+(n.join("|")+a).replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,(function(e){"cancel"in e&&e.cancel(),e.removeEvents(),e=null})),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,(function(e,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null})),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){log("&#171; CANCEL AND CLEAR ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,(function(e){"cancel"in e&&e.cancel(),"removeEvents"in e&&e.removeEvents(),e=null})),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,(function(e,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null,Affinity.UI.displaylookups[t].elements=[],Affinity.UI.displaylookups[t]=null,delete Affinity.UI.displaylookups[t]})),Affinity.UI.displaylookups={}},processQueue:function(){var e,t;try{Object.each(Affinity.UI.displaylookups,function(i,n){if(!this.enabled)throw log("! display lookup queue disabled - process stooped !"),"break Object.each";!0===Affinity.UI.displaylookups[n].loaded&&this.setElements(n),!1===Affinity.UI.displaylookups[n].loaded&&((t=Affinity.UI.displaylookups[n].api).contains("ran=")||(t=t.contains("?")?t+="&ran="+String.uniqueID():t+="?ran="+String.uniqueID()),Affinity.UI.displaylookups[n].loaded="loading...",(e=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:t,method:"get",noCache:!0,onComplete:function(e){JSON.Unauthorized(e,Affinity.UI.displaylookups[n].id)||(Affinity.UI.displaylookups[n].data=e,"null"!==typeOf(e.success)&&!1===e.success?this.setError(n,e.error&&""!==e.error?e.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[n].loaded=!0,this.setElements(n)))}.bind(this)}):new Request.JSON({url:t,method:"get",noCache:!0,onSuccess:function(e){JSON.Unauthorized(e,Affinity.UI.displaylookups[n].id)||(Affinity.UI.displaylookups[n].data=e,"null"!==typeOf(e.success)&&!1===e.success?this.setError(n,e.error&&""!==e.error?e.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[n].loaded=!0,this.setElements(n)))}.bind(this)}))&&(Affinity.UI.displaylookupLoaders.push(e),e.send()))}.bind(this))}catch(e){}},setError:function(e,t){Array.each(Affinity.UI.displaylookups[e].elements,function(e){new Element("span",{class:"errorstr inplace-of-input",html:t}).inject(e,"after"),e.addClass("hidden")}.bind(this))},setElements:function(e){Array.each(Affinity.UI.displaylookups[e].elements,function(t){"null"!==typeOf(t)&&"function"===typeOf(t.get)&&t.get("data-lookup-api")&&this.setValue(Affinity.UI.displaylookups[e].data,t)}.bind(this))},setValue:function(e,t){if("array"===typeOf(e)&&e.length>0&&"null"!==typeOf(e[0].Value)&&""!==e[0].Value){var i=e[0].Value.trim();"cleverforms"!==Affinity.appname&&(i=e[0].Value.split(",").sort((function(e,t){return t.length-e.length}))[0].trim()),t.getElement(".display")||t.hasClass("display")?(t.getElement(".display")&&t.getElement(".display").set("html",i),t.hasClass("display")&&t.set("html",i)):"value"in t?t.value=i:t.set("html",i),t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t}),delete i}}}),UIDrawPanels=new Class({Version:"1.0.0.0",File:"ui.drawpanel.js",Implements:[Options],Binds:["init","processDrawPad"],options:{},initialize:function(e){this.setOptions(e),this.init()},canvasSupported:function(){if(Browser.IE&&Borwser.version<9)return!1;var e=document.createElement("canvas");return void 0===e.getContext||"undefined"==typeOf(e.getContext("2d"))?(delete e,!1):(e.destroy(),delete e,!0)},processNew:function(){this.init()},init:function(){this.canvasSupported()&&Array.each(document.getElements(".ui-drawpad"),this.processDrawPad)},processDrawPad:function(e,t){e.removeClass("ui-drawpad");var i="",n="",s="",o=[];null!=e.get("data-bg-image")&&""!=e.get("data-bg-image")&&(bgnames=e.get("data-bg-name").split("||"),i=e.get("data-bg-image").split("||"),n=e.get("data-bg-image-width").split("||"),s=e.get("data-bg-image-height").split("||"),Array.each(i,(function(e,t){o.push({name:bgnames[t],image:i[t],width:n[t],height:s[t]})}))),new UIDrawPanel({element:e,bgImageData:o})}}),UIDrawPanel=new Class({Implements:[Options],Binds:["changeBgImage","canvasDown","canvasUp","setData","clear"],options:{element:null,bgImageData:[]},initialize:function(e){if(this.setOptions(e),this.icons={},this.icons.clear=Affinity.icons.CrossRound||"@Html.Raw(Affinity.UIFramework.Icons.CrossRound)",null==this.options.element)throw new Error("element must be set in options.");var t=this.options.element.get("name"),i=this.options.element.get("id"),n=this.options.element.value;this.element=new Element("input",{type:"hidden",value:n}).inject(this.options.element,"after"),this.options.element.destroy(),delete this.options.element,t&&this.element.set("name",t),i&&this.element.set("id",i);var s=500,o=Affinity.mobile?250:120;this.options.bgImageData.length>0&&(s=this.options.bgImageData[0].width,o=this.options.bgImageData[0].height),this.canvas=new Element("canvas",{class:"uidrawpanel",width:s,height:o}).inject(this.element,"after"),this.canvas.width=s,this.canvas.height=o,this.canvas.style.width=s+"px",this.canvas.style.height=o+"px",this.drawPanel=new SignaturePad(this.canvas,{}),this.canvas.addEventListener("CanvasReady",this.setData),this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(new Element("br").inject(this.canvas,"before"),new Element("label",{html:"Select Background"}).inject(this.canvas,"before"),this.imageSelect=new Element("select").addEvent("change",this.changeBgImage).inject(this.canvas,"before"),Array.each(this.options.bgImageData,function(e,t){this.imageSelect.adopt(new Element("option",{html:e.name,value:t}))}.bind(this)),this.imageSelect.adopt(new Element("option",{html:"No Image",value:-1}))),this.changeBgImage({target:{value:0}})),this.clearButton=new Element("span",{html:"<span>"+this.icons.clear+"</span>Clear",class:"button orange w-icon"}).inject(this.canvas,"after"),new Element("br").inject(this.element,"before"),new Element("br").inject(this.canvas,"before"),new Element("br").inject(this.canvas,"after"),this.clearButton.addEvent(Affinity.events.click,this.clear),this.canvas.addEvent(Affinity.events.start,this.canvasDown),this.canvas.addEvent(Affinity.events.end,this.canvasUp),document.addEvent(Affinity.events.end,this.canvasUp)},changeBgImage:function(e){var t=this.options.bgImageData[e.target.value];null==t&&(t={width:500,height:Affinity.mobile?250:120,image:null}),this.drawPanel.clear(),this.element.value="",this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",null!==t.image&&this.drawPanel.fromDataURL(t.image)},canvasDown:function(){this.eventIsDown=!0},canvasUp:function(){this.eventIsDown&&(this.eventIsDown=!1,this.setData())},setData:function(){this.element.value=this.drawPanel.toDataURL()},clear:function(){this.drawPanel.clear(),this.element.value="";var e={value:0};this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(e=this.imageSelect),this.changeBgImage({target:e}))}}),SignaturePad=function(e){"use strict";var t=function(e,t){var i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this._canvas=e,this._ctx=e.getContext("2d"),this.clear(),this._handleMouseEvents(),this._handleTouchEvents()};t.prototype.clear=function(){var e=this._ctx,t=this._canvas;e.fillStyle=this.backgroundColor,e.clearRect(0,0,t.width,t.height),e.fillRect(0,0,t.width,t.height),this._reset()},t.prototype.toDataURL=function(e,t){var i=this._canvas;return i.toDataURL.apply(i,arguments)},t.prototype.fromDataURL=function(e){var t=this,i=new Image;this._reset(),i.src=e,i.onload=function(){t._ctx.drawImage(i,0,0,t._canvas.width,t._canvas.height),t._canvas.dispatchEvent(new CustomEvent("CanvasReady"))},this._isEmpty=!1},t.prototype._strokeUpdate=function(e){var t=this._createPoint(e);this._addPoint(t)},t.prototype._strokeBegin=function(e){this._reset(),this._strokeUpdate(e)},t.prototype._strokeDraw=function(e){var t=this._ctx,i="function"==typeof this.dotSize?this.dotSize():this.dotSize;t.beginPath(),this._drawPoint(e.x,e.y,i),t.closePath(),t.fill()},t.prototype._strokeEnd=function(e){var t=this.points.length>2,i=this.points[0];!t&&i&&this._strokeDraw(i)},t.prototype._handleMouseEvents=function(){var t=this;this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",(function(e){1===e.which&&(t._mouseButtonDown=!0,t._strokeBegin(e))})),this._canvas.addEventListener("mousemove",(function(e){t._mouseButtonDown&&t._strokeUpdate(e)})),e.addEventListener("mouseup",(function(e){1===e.which&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(e))}))},t.prototype._handleTouchEvents=function(){var t=this;this._canvas.addEventListener("touchstart",(function(e){var i=e.changedTouches[0];t._strokeBegin(i)})),this._canvas.addEventListener("touchmove",(function(e){e.preventDefault();var i=e.changedTouches[0];t._strokeUpdate(i)})),e.addEventListener("touchend",(function(e){e.target===t._canvas&&t._strokeEnd()}))},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(e){var t=this._canvas.getBoundingClientRect();return new i(e.clientX-t.left,e.clientY-t.top)},t.prototype._addPoint=function(e){var t,i,s,o=this.points;o.push(e),o.length>2&&(3===o.length&&o.unshift(o[0]),t=this._calculateCurveControlPoints(o[0],o[1],o[2]).c2,i=this._calculateCurveControlPoints(o[1],o[2],o[3]).c1,s=new n(o[1],t,i,o[2]),this._addCurve(s),o.shift())},t.prototype._calculateCurveControlPoints=function(e,t,n){var s=e.x-t.x,o=e.y-t.y,a=t.x-n.x,r=t.y-n.y,l=(e.x+t.x)/2,h=(e.y+t.y)/2,d=(t.x+n.x)/2,c=(t.y+n.y)/2,u=Math.sqrt(s*s+o*o),m=Math.sqrt(a*a+r*r),p=m/(u+m),f=d+(l-d)*p,g=c+(h-c)*p,v=t.x-f,y=t.y-g;return{c1:new i(l+v,h+y),c2:new i(d+v,c+y)}},t.prototype._addCurve=function(e){var t,i,n=e.startPoint;t=e.endPoint.velocityFrom(n),t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(t),this._drawCurve(e,this._lastWidth,i),this._lastVelocity=t,this._lastWidth=i},t.prototype._drawPoint=function(e,t,i){var n=this._ctx;n.moveTo(e,t),n.arc(e,t,i,0,2*Math.PI,!1),this._isEmpty=!1},t.prototype._drawCurve=function(e,t,i){var n,s,o,a,r,l,h,d,c,u,m,p=this._ctx,f=i-t;for(n=Math.floor(e.length()),p.beginPath(),o=0;o<n;o++)l=(r=(a=o/n)*a)*a,u=(c=(d=(h=1-a)*h)*h)*e.startPoint.x,u+=3*d*a*e.control1.x,u+=3*h*r*e.control2.x,u+=l*e.endPoint.x,m=c*e.startPoint.y,m+=3*d*a*e.control1.y,m+=3*h*r*e.control2.y,m+=l*e.endPoint.y,s=t+l*f,this._drawPoint(u,m,s);p.closePath(),p.fill()},t.prototype._strokeWidth=function(e){return Math.max(this.maxWidth/(e+1),this.minWidth)};var i=function(e,t,i){this.x=e,this.y=t,this.time=i||(new Date).getTime()};i.prototype.velocityFrom=function(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1},i.prototype.distanceTo=function(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))};var n=function(e,t,i,n){this.startPoint=e,this.control1=t,this.control2=i,this.endPoint=n};return n.prototype.length=function(){var e,t,i,n,s,o,a,r,l=0;for(e=0;e<=10;e++)t=e/10,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),n=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),e>0&&(a=i-s,r=n-o,l+=Math.sqrt(a*a+r*r)),s=i,o=n;return l},n.prototype._point=function(e,t,i,n,s){return t*(1-e)*(1-e)*(1-e)+3*i*(1-e)*(1-e)*e+3*n*(1-e)*e*e+s*e*e*e},t}(document),saveAs=saveAs||"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(e){"use strict";if("undefined"==typeof navigator||!/MSIE [1-9]\./.test(navigator.userAgent)){var t=e.document,i=function(){return e.URL||e.webkitURL||e},n=t.createElementNS("http://www.w3.org/1999/xhtml","a"),s=!e.externalHost&&"download"in n,o=e.webkitRequestFileSystem,a=e.requestFileSystem||o||e.mozRequestFileSystem,r=function(t){(e.setImmediate||e.setTimeout)((function(){throw t}),0)},l="application/octet-stream",h=0,d=[],c=function(){for(var e=d.length;e--;){var t=d[e];"string"==typeof t?i().revokeObjectURL(t):t.remove()}d.length=0},u=function(e,t,i){for(var n=(t=[].concat(t)).length;n--;){var s=e["on"+t[n]];if("function"==typeof s)try{s.call(e,i||e)}catch(e){r(e)}}},m=function(r,c){var m,p,f,g,v,y=this,b=r.type,A=!1,E=function(){var e=i().createObjectURL(r);return d.push(e),e},w=function(){u(y,"writestart progress write writeend".split(" "))},C=function(){!A&&m||(m=E()),p?p.location.href=m:window.open(m,"_blank"),y.readyState=y.DONE,w()},x=function(e){return function(){if(y.readyState!==y.DONE)return e.apply(this,arguments)}},k={create:!0,exclusive:!1};if(y.readyState=y.INIT,c||(c="download"),s)return m=E(),n.href=m,n.download=c,g=n,(v=t.createEvent("MouseEvents")).initMouseEvent("click",!0,!1,e,0,0,0,0,0,!1,!1,!1,!1,0,null),g.dispatchEvent(v),y.readyState=y.DONE,void w();e.chrome&&b&&b!==l&&(f=r.slice||r.webkitSlice,r=f.call(r,0,r.size,l),A=!0),o&&"download"!==c&&(c+=".download"),(b===l||o)&&(p=e),a?(h+=r.size,a(e.TEMPORARY,h,x((function(e){e.root.getDirectory("saved",k,x((function(e){var t=function(){e.getFile(c,k,x((function(e){e.createWriter(x((function(t){t.onwriteend=function(t){p.location.href=e.toURL(),d.push(e),y.readyState=y.DONE,u(y,"writeend",t)},t.onerror=function(){var e=t.error;e.code!==e.ABORT_ERR&&C()},"writestart progress write abort".split(" ").forEach((function(e){t["on"+e]=y["on"+e]})),t.write(r),y.abort=function(){t.abort(),y.readyState=y.DONE},y.readyState=y.WRITING})),C)})),C)};e.getFile(c,{create:!1},x((function(e){e.remove(),t()})),x((function(e){e.code===e.NOT_FOUND_ERR?t():C()})))})),C)})),C)):C()},p=m.prototype,f=function(e,t){return new m(e,t)};return p.abort=function(){var e=this;e.readyState=e.DONE,u(e,"abort")},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,e.addEventListener("unload",c,!1),f.unload=function(){c(),e.removeEventListener("unload",c,!1)},f}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content);"undefined"!=typeof module&&null!==module?module.exports=saveAs:"undefined"!=typeof define&&null!==define&&null!=define.amd&&define([],(function(){return saveAs})),String.prototype.endsWithAny=function(){for(var e=Array.prototype.slice.call(arguments),t=this.toLowerCase().toString(),i=0;i<e.length;i++)if(-1!==t.indexOf(e[i],t.length-e[i].length))return!0;return!1};var saveTextAs=saveTextAs||function(e,t,i){if(t=t||"download.txt",i=i||"utf-8",e=(e||"").replace(/\r?\n/g,"\r\n"),saveAs&&Blob){var n=new Blob([e],{type:"text/plain;charset="+i});return saveAs(n,t),!0}var s=window.frames.saveTxtWindow;if(!s&&((s=document.createElement("iframe")).id="saveTxtWindow",s.style.display="none",document.body.insertBefore(s,null),!(s=window.frames.saveTxtWindow)&&!(s=window.open("","_temp","width=100,height=100"))))return window.alert("Sorry, download file could not be created."),!1;var o=s.document;o.open("text/plain","replace"),o.charset=i,t.endsWithAny(".htm",".html")?(o.close(),o.body.innerHTML="\r\n"+e+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),o.write(e),o.close());var a=o.execCommand("SaveAs",null,t);return s.close(),a},UIFormatDate=new Class({Implements:[Options],Binds:["init","processDate"],options:{},initialize:function(e){this.setOptions(e),this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-format-date"),this.processDate)},processDate:function(e){var t,i,n,s=!1;t="%I:%M:%S %p, %A %B %e%o %Y",e.get("data-date-format")&&""!==e.get("data-date-format").trim()&&(t=e.get("data-date-format").trim()),i=e.get("html").trim(),document.config.isie&&i.toLowerCase().contains("gmt")&&(i=i.replace(/GMT/gi,"UTC")),i.toLowerCase().contains(".")&&(i=i.replace(/\./gi,"/")),new RegExp("[0-9]T[0-9]","i").test(i)&&(i=i.replace(/(.*[0-9])t([0-9].*)/i,"$1 $2")),new RegExp("[0-9]Z","i").test(i)&&(i=i.replace(/(.*[0-9])Z/i,"$1 UTC")),i.toLowerCase().contains("utc")&&(i=i.trim().replace(/(.*[0-9]) UTC/i,"$1"),s=!0),n=new Date(Date.parse(i)),s&&(n=new Date(n.getTime()-60*n.getTimezoneOffset()*1e3)),n.isValid()&&e.set("html",n.format(t))}}),UIDynamicGrid=new Class({Implements:[Options],Binds:["init","moveUp","moveDn","delRow","newRow","inputReplace","inputReturn","setOutputData","returnData","handleCSVFile","saveCSV"],options:{container:null},tables:{},initialize:function(e){this.setOptions(e),this.docsv=!1,this.iemode=!1,document.config&&document.config.isie&&document.config.ieversion&&document.config.ieversion>10?window.encodeURIComponent&&window.FileReader&&(this.docsv=!0,this.iemode=!0):window.encodeURIComponent&&window.FileReader&&(this.docsv=!0),this.focused=null,this.input=new Element("input",{type:"text",events:{focus:function(e){this.focused=e.target}.bind(this),blur:function(e){this.focused=null,this.inputReturn(e.target)}.bind(this)}}),this.input.addEvent("keydown",function(e){13==e.event.keyCode&&(e.stopPropagation(),e.preventDefault(),this.focused==e.target&&this.focused.blur())}.bind(this)),this.init()},init:function(){null==this.options.container&&(this.options.container=document.body),Array.each(document.getElements("table.dynamic"),function(e){var t=e,i=t.get("id");null==i&&(i=String.uniqueID(),t.set("id",i)),this.tables[i]||(this.tables[i]=t,this.docsv&&(this.csvUploader=new Element("input",{type:"file",accept:".csv"}).store("id",i).addEvent("change",this.handleCSVFile),this.iemode?new Element("span",{class:"csvdrop-ie button green",html:"Load CSV"}).adopt(this.csvUploader).inject(t.getElement(".new"),"before"):new Element("span",{class:"csvdrop ui-has-tooltip","data-tooltip":"Drop CSV file here","data-tooltip-dir":"top",html:Affinity.icons.Upload2}).adopt(this.csvUploader).inject(t.getElement(".new"),"before")),document.id("listdata")?this.outputdatafield=document.id("listdata"):(this.outputdatafield=new Element("input",{id:"listdata",name:"listdata",type:"hidden"}),this.outputdatafield.inject(t,"after")),Array.each(t.getElements("td.dynamic"),function(e){e.addEvent("click",this.inputReplace)}.bind(this))),this.docsv&&new Element("span",{class:"button w-icon green save"}).adopt(new Element("span",{html:Affinity.icons.Save}),new Element("span",{html:"Save list as CSV file"})).store("id",i).addEvent("click",this.saveCSV).inject(t.getParent(),"after"),Affinity.tooltips.processNew(),this.zebra(t),this.setOutputData(t)}.bind(this)),Array.each(document.getElements("table.dynamic .new, table.dynamic .del, table.dynamic .up, table.dynamic .dn"),function(e){e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow),e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn)}.bind(this))},inputReplace:function(e,t){if(null!==e?(element="td"==e.target.get("tag")?e.target:e.target.getParent("td"),e.preventDefault(),e.stopPropagation()):element=t,element.getElement("input"))this.input.focus();else{var i=element.get("html").stripTags().trim();element.empty();var n=element.getComputedSize();this.input.setStyles({width:n.width-10,height:n.height-2}),this.input.inject(element),i="Enter a value"==i?"":i,this.input.value=i,this.input.focus(),element.setStyles({width:n.width,height:n.height}),delete i,delete n}},inputReturn:function(e){if(e&&"input"==e.get("tag")){var t=e.getParent(),i=e.getParents("table")[0],n=e.value.stripTags().trim();n=""==n?"Enter a value":n,t.empty(),t.set("html",n),this.setOutputData(i),delete n,delete t,delete i}},moveUp:function(e){e.preventDefault();var t=e.target.getParent("table"),i=t.getElement("tbody"),n=t.getElement(".template").clone();t.getElement(".template").destroy();var s=e.target.getParent("tr"),o=i.getElements("tr"),a=o.indexOf(s);a>1&&s.inject(o[a-1],"before"),this.setOutputData(t),this.zebra(s.getParent("table")),n.inject(i),delete t,delete i,delete n,delete s,delete o,delete a},moveDn:function(e){e.preventDefault();var t=e.target.getParent("table"),i=t.getElement("tbody"),n=t.getElement(".template").clone();t.getElement(".template").destroy();var s=e.target.getParent("tr"),o=i.getElements("tr"),a=o.indexOf(s);a<o.length-1&&s.inject(o[a+1],"after"),this.setOutputData(t),this.zebra(s.getParent("table")),n.inject(i),delete t,delete i,delete n,delete s,delete o,delete a},delRow:function(e){e.preventDefault();var t=e.target.getParents("table")[0];e.target.getParents("tr")[0].destroy(),this.setOutputData(t),this.zebra(t),delete t},newRow:function(e){try{e.preventDefault()}catch(e){}var t,i,n=e.target.getParents("table")[0],s=n.getElement(".template").clone();e.target.getParents("th")[0]?(t=n,i="bottom"):(t=e.target.getParents("tr")[0],i="after"),s.removeClass("template"),s.removeClass("hidden"),s.inject(t,i),Array.each(s.getElements(".new,.del,.up,.dn"),function(e){e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn),e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this)),Array.each(s.getElements("td.dynamic"),function(e){e.empty(),e.addEvent("click",this.inputReplace)}.bind(this)),this.inputReplace(null,s.getElement("td.dynamic")),this.zebra(n)},zebra:function(e){Array.each(e.getElements("tr"),function(e,t){t>0&&(e.addClass("odd"),t%2==0&&e.removeClass("odd"))}.bind(this))},setOutputData:function(e){var t=this.returnData(e,!0);return this.outputdatafield.value=t,t},returnData:function(e,t){var i;t=void 0!==t&&t;var n,s=[],o=e.getElements("tr th.has-data-name");return o.length>1?Array.each(e.getElements("tr"),function(e,t){t>0&&(i={},Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(n=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=n&&(i[o[t].get("data-name")]=escape(n))}.bind(this)),Object.getLength(i)>0&&s.push(i))}.bind(this)):Array.each(e.getElements("tr"),function(e,t){Array.each(e.getElements("td"),function(e,t){e.hasClass("dynamic")&&""!=(n=e.getElement("input")?e.getElement("input").value.trim():e.get("html").trim())&&"Enter a value"!=n&&s.push(escape(n))}.bind(this))}.bind(this)),t&&(s=JSON.stringify(s)),s},handleCSVFile:function(e){var t=e.target,i=t.retrieve("id"),n=this.tables[i],s=n.getElement("tbody");Affinity.prompts.hide();var o=new FileReader;o.readAsText(t.files[0]),o.onload=function(e){var i,o,a=e.target.result.split(/\r\n|\n/);for(i=0;i<a.length;i++)""!=a[i]&&(o=n.getElement(".template").clone().removeClass("template").removeClass("hidden").inject(s,"bottom"),Array.each(o.getElements(".new,.del,.up,.dn"),function(e){e.hasClass("up")&&e.addEvent("click",this.moveUp),e.hasClass("dn")&&e.addEvent("click",this.moveDn),e.hasClass("new")&&e.addEvent("click",this.newRow),e.hasClass("del")&&e.addEvent("click",this.delRow)}.bind(this)),Array.each(o.getElements("td.dynamic"),function(e){e.set("html",a[i]),e.addEvent("click",this.inputReplace)}.bind(this)));this.zebra(n),t.files=[],t.value="",this.setOutputData(n)}.bind(this),o.onerror=function(e){"NotReadableError"==e.target.error.name&&console.log("Can't read file!")}.bind(this)},saveCSV:function(e){var t=(e.target.hasClass("save")?e.target:e.target.getParent(".button.save")).retrieve("id"),i=this.tables[t],n=(i.getElement("tbody"),this.setOutputData(i)),s=unescape(n).replace("[","").replace("]","").split(",").join("\r\n");uiprompt({message:"Please enter a name for your file",onOk:function(e){if(this.iemode)saveTextAs(s,e+".csv");else{var t=new Blob([s],{type:"text/plain;charset=utf-8"});saveAs(t,e+".csv")}}.bind(this)})}}),UIGrid=new Class({Version:"1.0.0.0",File:"ui.grid.js",Implements:[Options],Binds:["processTables","setupTable","zebra"],options:{},tables:{},initialize:function(e){this.setOptions(e),this.processTables(),Affinity.UI.Grids={},Affinity.UI.Grids.Zebra=this.zebra},processTables:function(e,t){var i;null==e?Array.each(document.getElements("table.ui-grid"),function(e){i=""==e.get("id")?String.uniqueID():e.get("id"),"null"==typeOf(this.tables[i])?(this.tables[i]=e,this.setupTable(e,t)):this.zebra(e,t)}.bind(this)):e.hasClass("ui-grid")&&(i=""==e.get("id")?String.uniqueID():e.get("id"),"null"==typeOf(this.tables[i])?(this.tables[i]=e,this.setupTable(e,t)):this.zebra(e,t)),delete i},setupTable:function(e,t){this.zebra(e,t)},zebra:function(e,t){var i="tr";void 0!==t&&"string"==typeof t&&(i="tr."+t);var n=null==e?document.getElements("table.ui-grid"):[e],s=0;Array.each(n,function(e){s=0,"getElements"in e&&(e.getElements(i).removeClass("odd"),Array.each(e.getElements("tbody "+i),function(e,t){e.hasClass("hidden")||(e.addClass(s%2==0?"":"odd"),s++)}.bind(this)))}.bind(this)),delete s}}),UISortableGrid=new Class({Version:"1.0.0.0",File:"ui.grid.sortable.js",Implements:[Options,Events],Binds:["checkTables","processTable","multisort","sortColumn"],options:{},tables:{},initialize:function(e){if(this.setOptions(e),"class"!=typeOf(UIGrid)||"null"==typeOf(Affinity.uiGrid))throw new Error({"Missing Component":"UISortableGrid requires UIGrid"});this.icons={},this.icons.unsorted=Affinity.icons.ArrowheadUpDown||"&#xe0cc;",this.icons.sortup=Affinity.icons.ArrowheadUp||"&#xe0ba;",this.icons.sortdn=Affinity.icons.ArrowheadDown||"&#xe0b9;",Array.each(document.getElements("table"),this.checkTables)},checkTables:function(e){e.getElements("thead th.sort-on").length>0&&this.processTable(e)},processTable:function(e,t){this.headers=e.getElements("thead th");var i=e.getElements("tbody tr"),n=e.get("id")?e.get("id"):String.uniqueID();e.get("data-icon")&&(this.icons.unsorted=e.get("data-icon")),e.get("data-up-icon")&&(this.icons.sortup=e.get("data-up-icon")),e.get("data-down-icon")&&(this.icons.sortdn=e.get("data-down-icon")),e.set("id",n),this.tables[n]={},this.tables[n].table=e,this.tables[n].columns={};var s=0;if(Array.each(this.headers,function(e,t){e.hasClass("sort-on")&&(e.getElement("div.icon")||(e.adopt(new Element("div",{class:"icon",html:this.icons.unsorted})),e.addEvent("mousedown",(function(e){e.preventDefault()})),e.addEvent("click",this.sortColumn)),this.tables[n].columns["h"+t]={method:e.get("data-sort-method"),direction:-1,sortables:[]})}.bind(this)),Array.each(i,function(e,t){Array.each(e.getElements("td"),function(e,t){this.tables[n].columns["h"+t]&&("string"===this.tables[n].columns["h"+t].method&&this.tables[n].columns["h"+t].sortables.push([e.get("html"),e]),"date"===this.tables[n].columns["h"+t].method&&(""==e.get("html")?this.tables[n].columns["h"+t].sortables.push([Date.parse(0).format("%s"),e]):this.tables[n].columns["h"+t].sortables.push([Date.parse(e.get("html")).format("%s"),e])),"float"!==this.tables[n].columns["h"+t].method&&"integer"!==this.tables[n].columns["h"+t].method||(""==e.get("html")?this.tables[n].columns["h"+t].sortables.push(0,e):this.tables[n].columns["h"+t].sortables.push([Number.from(e.get("html").replace(/[\s,$]/g,"")),e]))),s++}.bind(this))}.bind(this)),this.tables[n].total=s,e.set("tween",{duration:250}),Affinity.uiGrid.zebra(e,t),Affinity.hasOwnProperty("pageId")){var o,a="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId,r=Affinity.CookieMonster.Read(a),l=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase();r&&(r=JSON.parse(r),o=Date.parse(r.date),r.href===l&&(new Date).getTime()-o.getTime()<18e5&&(this.tables[e.get("id")].columns["h"+r.columnIndex].direction=-1*r.direction,this.sortColumn({target:e.getElements("th")[r.columnIndex]})),(new Date).getTime()-o.getTime()>18e5&&Affinity.CookieMonster.Delete(a))}},multisort:function(e,t){return e[0]==t[0]?0:e[0]<t[0]?-1:1},sortColumn:function(e){this.tables[e.target.getParent("table").get("id")].total>5e3?(e.target.getParent("table").fade(.25),this.continueSort.delay(500,this,[e])):this.continueSort(e)},continueSort:function(e){var t="th"===e.target.get("tag")?e.target:e.target.getParent("th"),i=t.getParent("table"),n=i.getElement("tbody"),s=this.tables[i.get("id")].columns["h"+i.getElements("th").indexOf(t)];if(Array.each(i.getElements("thead th"),function(e){e.getElement(".icon")&&e.getElement(".icon").set("html",this.icons.unsorted)}.bind(this)),s.direction*=-1,s.sortables.sort(this.multisort),s.direction<0&&s.sortables.reverse(),t.getElement(".icon").set("html",s.direction>0?this.icons.sortup:this.icons.sortdn),Array.each(s.sortables,function(e){e[1].getParent("tr").inject(n,"top")}.bind(this)),Affinity.uiGrid.zebra(i),i.fade(1),Affinity.hasOwnProperty("pageId")){var o,a={};a.date=new Date,a.href=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase(),a.direction=s.direction,a.columnIndex=i.getElements("th").indexOf(t),o=JSON.stringify(a);var r="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId;Affinity.CookieMonster.Write(r,o)}delete t,delete i,delete n,delete s},returnData:function(e,t){var i;t=void 0!==t&&t;var n=[],s=e.getElements("tr th");return Array.each(e.getElements("tr"),function(e){i={},Array.each(e.getElements("td"),function(e,t){i[s[t].get("data-name")]=e.get("html")}.bind(this)),Object.getLength(i)>0&&n.push(i)}.bind(this)),t?JSON.stringify(n):n}}),UIHelpBubble=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:["populate","alignTo","position","hide","show"],options:{fadeTime:100},initialize:function(e){this.setOptions(e),document.getElement(".helpBubble.float")||(this.helpBubble=new Element("div",{class:"helpBubble right float"}).inject(document.body,"bottom"),this.helpBubble.set("tween",{duration:this.options.fadeTime}),this.helpBubble.fade("hide"))},populate:function(e){this.helpBubble&&(this.helpBubble.empty(),"element"==typeOf(e)&&this.helpBubble.adopt(e),"string"==typeOf(e)&&this.helpBubble.set("html",e),this.addClass("right"),this.setDirection("left"))},alignTo:function(e){var t=e.getPosition(),i=e.getSize();this.position({x:t.x+i.x+5,y:t.y+i.y/2-15})},setDirection:function(e){if(this.helpBubble){e=e.toLowerCase().trim()||"left";var t=["top","left","right","bottom","bottom-right","top-right"];t.contains(e)&&(Array.each(t,function(e){this.helpBubble.removeClass(e)}.bind(this)),this.addClass(e))}},addClass:function(e){this.helpBubble&&this.helpBubble.addClass(e)},position:function(e){this.helpBubble&&this.helpBubble.setStyles({top:e.y,left:e.x})},show:function(e){this.helpBubble&&(e&&!0===e&&(this.helpBubble.addEvent(Affinity.events.outAll,this.hide),this.helpBubble.addEvent(Affinity.events.overAll,this.show)),this.helpBubble.fade("in"))},hide:function(){this.helpBubble&&(this.helpBubble.removeEvents(),this.helpBubble.fade("out"))},getSize:function(){if(this.helpBubble)return this.helpBubble.measure((function(){return this.getSize()}))}}),UIHelpIcon=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:[],options:{},initialize:function(e){if(this.setOptions(e),!Affinity.tooltips)throw"UI Help Icon requires UI Tooltips";Array.each(document.getElements(".indicator.help"),function(e){e.get("data-help")&&(e.set("data-tooltip",e.get("data-help")),e.addClass("ui-has-tooltip"),e.erase("data-help"))}.bind(this)),Affinity.tooltips.init()}}),UIHidables=new Class({Version:"1.0.0.0",File:"ui.hidables.js",Implements:[Options],Binds:["processNew","process","processTriggers","processEachTrigger","triggerClicked"],options:{},initialize:function(e){this.setOptions(e),this.hidableFxs={},this.processTriggers()},processNew:function(){this.processTriggers()},processTriggers:function(){var e=document.getElements(".has-hidable");e.length>0&&Array.each(e,this.processEachTrigger)},process:function(e){this.processEachTrigger(e)},processEachTrigger:function(e,t){var i,n=e.get("data-hidable-trigger-id");document.id(n)&&((i=document.id(e.get("data-hidable-trigger-id"))).store("hidableFx",new Fx.Reveal(i,{duration:250,mode:"vertical"})),e.addEvent("click",this.triggerClicked),i.setStyle("display","none"),i.removeClass("hidden"),i.hasClass("auto-hide")||i.retrieve("hidableFx").reveal())},triggerClicked:function(e){var t=!0,i=(e.target,document.id(e.target.get("data-hidable-trigger-id")));"checkbox"!=e.target.get("type")||e.target.checked||(t=!1),t?(i.retrieve("hidableFx").reveal(),e.target.get("name")&&Array.each(document.getElements("input[name="+e.target.get("name")+"]"),function(t){t!=e.target&&document.id(t.get("data-hidable-trigger-id")).retrieve("hidableFx").dissolve()}.bind(this))):i.retrieve("hidableFx").dissolve()}}),UIHideToggle=new Class({Implements:[Options],Binds:["init","processNew","processToggle"],options:{},initialize:function(e){this.setOptions(e),this.init()},init:function(){this.processNew()},processNew:function(){Array.each(document.getElements(".ui-hide-toggle"),this.processToggle)},processToggle:function(e,t){e.hasClass("ui-hide-toggle")&&(e.removeClass("ui-hide-toggle"),new UIHideToggleWidget({element:e}))}}),UIHideToggleWidget=new Class({Implements:[Options],Binds:["childFocus","toggle","hide","show"],options:{element:null},isHidden:!1,initialize:function(e){this.setOptions(e),this.element=this.options.element,this.toggleid=this.element.get("data-hide-toggle-id"),this.togglelement=document.id(this.toggleid),this.icons={},this.icons.hide=Affinity.icons.ResizeShrink||"&#xe0b4;",this.icons.show=Affinity.icons.ResizeEnlarge||"&#xe0b3;",this.togglelement&&(this.element.set("reveal",{duration:250,onHide:function(e){e.addClass("subhidden")}.bind(this)}),this.togglelement.set("html",this.icons.hide),this.togglelement.addEvent("click",this.toggle),Array.each(this.element.getElements("input,textarea,select"),function(e){e.addEvent("focus",this.childFocus)}.bind(this)));var t=this.element.get("data-hide-toggle-state");t&&"hidden"==t&&(this.element.addClass("subhidden"),this.element.setStyle("display","none"),this.isHidden=!0,this.togglelement.set("html",this.icons.show)),this.element.removeClass("hidden")},childFocus:function(e){this.isHidden&&this.element.contains(e.target)&&this.show()},toggle:function(){this.isHidden?this.show():this.hide()},hide:function(){this.isHidden=!0,this.togglelement.set("html",this.icons.show),this.element.dissolve()},show:function(){this.element.removeClass("subhidden"),this.isHidden=!1,this.togglelement.set("html",this.icons.hide),this.element.reveal()}}),UIInbox=new Class({Implements:[Options,Events],Binds:["processBox","selectBox","rowClicked","refreshInbox","refresh","setError"],options:{},initialize:function(e){this.setOptions(e),Array.each(document.getElements(".ui-inbox"),function(e){var t=new Element("div",{class:"hidden",html:"no errors",styles:{position:"absolute",top:"10px",right:"10px",padding:"10px",background:"white",border:"5px solid black","border-radius":"10px","z-index":"9999999999"}}).inject(e,"after");e.store("errors",t),e.getElement(".ui-inbox-labels h2").addEvent(Affinity.events.click,(function(){t.toggleClass("hidden")}));var i=e.get("id")||String.uniqueID(),n=e.get("data-tab-api"),s=e.get("data-refresh-frequency");s&&(s=(s=parseFloat(s)||5)<.5?.5:s);var o=e.getElements(".ui-inbox-labels li"),a=e.getElements(".ui-inbox-box"),r=e.getElement(".ui-inbox-readpane"),l={};e.set("id",i),l.tabApi=n||!1,l.tabIndex=Cookie.read("uiInboxIndex")||0,l.frequency=s,l.element=e,l.stoprefresh=!1,a.addClass("hidden"),Array.each(o,function(e,t){e.store("box",a[t]),this.processBox(a[t]),e.addEvent(Affinity.events.click,function(e){var t="li"==e.target.get("tag")?e.target:e.target.getParent("li");this.selectBox(t),delete t}.bind(this))}.bind(this)),e.getElement(".ui-inbox-labels li").addClass("selected"),e.getElement(".ui-inbox-box").removeClass("hidden"),new Fx.Reveal(r,{duration:250,mode:"vertical"}),r.setStyle("display","none"),r.removeClass("hidden"),n&&(l.refreshRequest=new CFRequest.JSON({url:n,onSuccess:function(e){this.refreshInbox(l,e)}.bind(this),onError:function(t){this.setError(e,t)}.bind(this),onFailure:function(t){this.setError(e,t)}.bind(this)}),e.getElement(".ui-inbox-loader")&&e.getElement(".ui-inbox-loader").removeClass("hidden"),e.hasClass("ui-inbox-requires-login")?window.addEvent("loggedin",function(){l.refreshRequest.send()}.bind(this)):l.refreshRequest.send()),e.store("inboxObj",l)}.bind(this))},selectBox:function(e){var t=e.getParent(".ui-inbox"),i=t.retrieve("inboxObj");i.tabIndex=t.getElements(".ui-inbox-labels li").indexOf(e),t.store("inboxObj",i),t.getElements(".ui-inbox-labels li").removeClass("selected"),t.getElements(".ui-inbox-box").addClass("hidden"),e.retrieve("box").removeClass("hidden"),e.addClass("selected"),i.tabApi&&this.startRefresh(t),window.fireEvent("inboxSelected",{menuItem:e,box:e.retrieve("box")})},processBox:function(e){Array.each(e.getElements("tbody tr"),function(e){e.get("data-itemdata")&&e.addEvent(Affinity.events.click,this.rowClicked)}.bind(this))},rowClicked:function(e){var t="tr"==e.target.get("tag")?e.target:e.target.getParent("tr"),i=JSON.parse(t.get("data-itemdata").replace(/'/g,'"')),n=t.getParent(".ui-inbox").getElement(".ui-inbox-readpane");n.getElement(".ui-inbox-date-display").set("html",i.date?unescape(i.date):""),n.getElement(".ui-inbox-from").set("html",i.from?unescape(i.from):""),n.getElement(".ui-inbox-subject").set("html",i.subject?unescape(i.subject):""),n.getElement(".ui-inbox-message").set("html",i.details?unescape(i.details):""),n.reveal(),delete t,delete i,delete n},stopRefresh:function(e){if(e){var t=e.retrieve("inboxObj");t&&(t.stoprefresh=!0,t.refreshRequest.isRunning()&&t.refreshRequest.cancel())}},startRefresh:function(e){if(e){var t=e.retrieve("inboxObj");t&&(e.getElement(".ui-inbox-loader")&&e.getElement(".ui-inbox-loader").removeClass("hidden"),t.stoprefresh=!1,t.refreshRequest.isRunning()&&t.refreshRequest.cancel(),t.refreshRequest.send())}},refreshInbox:function(e,t){this.fireEvent("refresh"),e.element&&e.element.getElement(".ui-inbox-loader")&&e.element.getElement(".ui-inbox-loader").addClass("hidden"),e.stoprefresh||(window.fireEvent("inboxUpdated",{elementid:e.element.get("id"),inbox:e,data:t}),e.frequency&&function(){e.element&&e.element.getElement(".ui-inbox-loader")&&e.element.getElement(".ui-inbox-loader").removeClass("hidden"),e.refreshRequest.send()}.delay(60*e.frequency*1e3,this))},refresh:function(){var e,t,i,n;Array.each(document.getElements(".ui-inbox"),function(s){lables=s.getElements(".ui-inbox-labels li"),n=s.getElements(".ui-inbox-boxes .ui-inbox-box"),Array.each(lables,function(s,o){e=n[o],t=e.getElements("tbody tr"),i=t.length,e.getElement("tbody tr.empty")&&0==--i&&e.getElement("tbody tr.empty").removeClass("hidden"),s.getElement(".indicator").set("html",i)}.bind(this))}.bind(this)),delete n,delete lables,delete i,delete t,delete e},setError:function(e,t){var i;i="object"===typeOf(t)||"array"===typeOf(t)?JSON.stringify(t,null,2):t,e.retrieve("errors").set("html","<pre>"+i+"</pre>"),this.fireEvent("error",i)}});Locale.define("en-NZ","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["date","month","year","/"],ordinal:function(e){return e>3&&e<21?"th":["th","st","nd","rd","th"][Math.min(e%10,4)]},AM:"am",PM:"pm"}),Locale.use("en-NZ"),window.components=[["UIHelpBubble","helpbubble"],["UIGrid"],["UISortableGrid"],["UIDynamicGrid"],["UIScrollableGrid"],["UITabs"],["UIInbox"],["UIHidables"],["UIFormHideables","formhideables"],["UISectionHideables","sectionHidables"],["UIHideToggle","hidetoggle"],["UIUplaoders"],["UIUplaodersMulti","uploaders"],["UIReplaceArrows","arrows"],["UIValidation"],["UISanitise"],["UIDateDropDowns"],["UISelectLookup","lookups"],["UIDisplayLookup","displaylookups"],["UIDateCalendar"],["UIListBuilder"],["UIDateCleverInput"],["UIAutoComplete"],["UIQuickSearch"],["UIModal","modal"],["UIDrawPanels"],["UITooltips","tooltips"],["UIHelpIcon","helpicon"],["UIPompts","prompts"],["UIFormatDate"],["UIBankNumber","banknumber"],["UITaxNumber","taxnumber"],["UIMasterMessage","masterMessage"],["UIAddress","address"],["UIPager"],["UITextareaAutoSize","textAutoSize"]];var mybasepath=window.basepath||"";window.addEvent("PageReady",(function(){if("Affinity"in window||(window.Affinity={}),!Affinity.uiready){for(var e,t=0;t<window.components.length;t++)if(e=window.components[t],void 0!==window[e[0]]&&"class"===typeOf(window[e[0]])){var i,n=e[0].replace("UI","ui");if(n in Affinity)console.log('name collision in Affinity for "'+n+'"');else if(Affinity[n]=new window[e[0]],Affinity.Components[n]={},Affinity.Components[n].Version=Affinity[n].Version||"",Affinity.Components[n].Name=Affinity[n].Name||e[0].replace(new RegExp("UI","gi"),"").split(/(?=[A-Z])/).join(" "),Affinity.Components[n].File=Affinity[n].File||"",Affinity.Components[n].Jira=Affinity[n].Jira||"",e.length>1)for(var s=1;s<e.length;s++)(i=e[s])in Affinity?console.log('name collision in Affinity for "'+i+'"'):Affinity[i]=Affinity[n]}n=null,i=null,e=null,Affinity.useWebWorkers=!(Affinity.isie&&Affinity.ieversion<=11)&&Affinity.useWebWorkers,Affinity.uiready=!0,window.fireEvent("UiReady")}}));var UIModal=new Class({Version:"1.0.0.0",File:"ui.modal.js",Implements:[Options],Binds:["setElement","setString","adopt","position","clear","closeButtonCloser","backgroundCloser","show","hide"],Options:{},backgroundCloses:!0,initialize:function(e){this.setOptions(e),this.icons={},this.icons.del=Affinity.icons.CrossRound,document.id("uimodalbg")||(this.modalbg=new Element("div",{id:"uimodalbg",class:"white hidden"}).inject(document.body,"bottom")),document.id("uimodal")||(this.modal=new Element("div",{id:"uimodal",class:"shadow hidden"}).inject(document.body,"bottom"),this.modalclose=new Element("div",{class:"uimodalclose"}).inject(this.modal),new Element("span",{class:"icon-cross"}).inject(this.modalclose),this.modalbody=new Element("div",{class:"uimodalbody"}).inject(this.modal)),this.modalbg=document.id("uimodalbg"),this.modal=document.id("uimodal"),this.modalbg.set("tween",{duration:250}),this.modal.set("tween",{duration:250}),this.modalclose=this.modal.getElement(".uimodalclose"),this.modalbody=this.modal.getElement(".uimodalbody"),this.modalbg.addEvent("click",this.backgroundCloser),this.modalclose.addEvent("click",this.closeButtonCloser),this.modalbg.removeClass("hidden").fade("hide"),this.modal.removeClass("hidden").fade("hide"),window.addEvent("resize",function(e){this.position()}.bind(this)),this.position(),this.scroll={},this.scroll.enable=function(){this.modal.addClass("scroll")}.bind(this),this.scroll.disable=function(){this.modal.removeClass("scroll")}.bind(this),this.close={},this.close.enable=function(){this.modalclose.removeClass("hidden")}.bind(this),this.close.disable=function(){this.modalclose.addClass("hidden")}.bind(this)},getCalculatedTop:function(){if(Affinity.oldess&&Affinity.oldessFrame){var e=window.parent.window,t=e.document.documentElement,i=e.document.body,n=t&&t.scrollTop||i&&i.scrollTop||0,s=0,o=window.parent.document.getElementById("ctl00_MainPanel");o&&(s=document.documentMode&&document.documentMode<9?o.querySelectorAll(".ContentBody")[0].offsetTop:o.getElementsByClassName("ContentBody")[0].offsetTop);var a=n-s;return a<10&&(a=10),a+10}return 10},position:function(){var e=window.getSize();this.modalbg.setStyles({width:e.x,height:e.y}),this.modal.setStyles({left:e.x/2-this.modal.getDimensions().width/2,top:this.getCalculatedTop()}),this.modalbody.setStyles({"max-height":e.y-60}),delete e},setElement:function(e){this.modalbody.empty(),e.inject(this.modalbody),this.position(),this.close.enable(),this.scroll.enable()},adopt:function(e){this.setElement(e)},setString:function(e){this.modalbody.empty(),this.modalbody.set("html",e),this.position(),this.close.enable(),this.scroll.enable()},backgroundCloser:function(e){this.closeButtonCloser(e)},closeButtonCloser:function(e){window.fireEvent("leaveEditDetailCloses"),this.backgroundCloses&&this.hide()},hide:function(){"beforeClose"in this&&"function"===typeOf(this.beforeClose)&&(this.beforeClose(),this.beforeClose=null,delete this.beforeClose),document.body.removeClass("uimodal-open"),this.modalbg.fade("out"),this.modal.fade("out"),this.clear.delay(500,this)},show:function(e){null==e?(e=!0,this.modalclose.fade("show")):this.modalclose.fade("hide"),this.backgroundCloses=e,document.body.addClass("uimodal-open"),this.modalbg.fade("in"),this.modal.fade("in")},clear:function(){this.modalbody.empty()}}),UIPromptPositionObject={position:"absolute",top:!1,left:!1},UILoaderObject={message:"Loading",onClose:function(){},timeout:null,position:{},showButtons:!1,showLoader:!0,noClose:!0,cssSelector:""},UIMessageObject={message:"Message!",onClose:function(){},timeout:null,position:{},cssSelector:""},UIAlertObject={message:"Alert!",messageAlign:"center",okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},showButtons:!0,showCancel:!1,noClose:!1,showLoader:!1,append:!1,position:{},cssSelector:"",showHiddenInfo:!1,hiddenInfoMessage:"",hiddenInfoButtonText:""},UIConfirmObject={message:"Yes or No?",messageAlign:"center",okText:"Yes",okIcon:"",okColor:"green",cancelText:"No",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPromptObject={message:"Enter text",messageAlign:"center",lines:1,okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",value:"",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPompts=new Class({Version:"1.0.4.0",Sequence:1050,Name:"Prompts",File:"ui.prompts.js",Jira:"",Notes:"Added value for TS Favs edit",Implements:[Options],Binds:["returnOptionsObject","message","alert","prompt","confirm","loader","center","show","escape","hide","hideDelay","clearHideDelay","okKeyUp"],options:{},status:"closed",message:"",currentObj:!1,container:!1,currentType:"",initialize:function(e){if(this.setOptions(e),document.id("UIPromtBoxBG")?this.promptBoxBG=document.id("UIPromtBoxBG"):this.promptBoxBG=new Element("div",{id:"UIPromtBoxBG",class:"UIPromtBoxBG"}).inject(document.body,"bottom"),this.promptBoxBG.set("tween",{duration:250}),this.promptBoxBG.fade("hide"),document.id("UIPromtBox"))this.promptBox=document.id("UIPromtBox");else{var t=new Element("div",{class:"mobile-wrap"}).inject(document.body,"bottom");this.promptBox=new Element("div",{id:"UIPromtBox",class:"UIPromtBox"}).inject(t)}this.promptBox.set("tween",{duration:250}),this.promptBox.fade("hide"),this.container=this.promptBox,this.trueButton=new Element("span",{class:"button true-button w-icon",tabindex:9999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{class:"label",html:""})),this.falseButton=new Element("span",{class:"button false-button w-icon",tabindex:9999999}).adopt(new Element("span",{html:Affinity.icons.Cancel||"&#xe070;"}),new Element("span",{class:"label",html:""})),this.promptBoxBG.removeEvents(),this.promptBoxBG.addEvent("keyup",function(e){e.stop(),this.obj.noClose||"esc"!=e.key?"enter"==e.key&&this.obj.onOk():this.hide()}.bind(this)),Affinity.mobile&&(window.removeEvent("mobileback",this.escape),window.addEvent("mobileback",this.escape)),window.prompts=this,window.uimessage=this.message,window.uialert=this.alert,window.uiconfirm=this.confirm,window.uiprompt=this.prompt,window.uiloader=this.loader},returnOptionsObject:function(e){var t=Object.clone(e);return Object.merge({},t)},message:function(e){var t=this.returnOptionsObject(UIMessageObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.timeout=e.timeout?e.timeout:t.timeout,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,class:"content align"+t.messageAlign})),this.center(),this.show(),null!==t.timeout&&this.hide.delay(t.timeout,this)},addLargeMessage:function(e){var t=new Element("div",{html:e,styles:{width:"100%","max-height":150,overflow:"auto","text-align":"left",margin:"10px 0"}});this.promptBox.getElement(".promptButtons")?t.inject(this.promptBox.getElement(".promptButtons"),"before"):t.inject(this.promptBox),this.center(),t=null},adopt:function(){for(var e=this.promptBox.getElement(".content"),t=0;t<arguments.length;t++)e.adopt(arguments[t]);t=e=null,this.center()},alert:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UIAlertObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,t.okColor=e.okColor?e.okColor:t.okColor,t.cancelText=e.cancelText?e.cancelText:t.cancelText,t.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,t.cancelColor=e.cancelColor?e.cancelColor:t.cancelColor,t.onOk=e.onOk?e.onOk:t.onOk,t.onCancel=e.onCancel?e.onCancel:t.onCancel,t.showButtons="boolean"===typeOf(e.showButtons)?e.showButtons:t.showButtons,t.showCancel="boolean"===typeOf(e.showCancel)?e.showCancel:t.showCancel,t.noClose="boolean"===typeOf(e.noClose)?e.noClose:t.noClose,t.showLoader="boolean"===typeOf(e.showLoader)?e.showLoader:t.showLoader,t.append=e.append?e.append:t.append,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.showHiddenInfo="boolean"===typeOf(e.showHiddenInfo)?e.showHiddenInfo:t.showHiddenInfo,t.hiddenInfoMessage=e.hiddenInfoMessage?e.hiddenInfoMessage:t.hiddenInfoMessage,t.hiddenInfoButtonText=e.hiddenInfoButtonText?e.hiddenInfoButtonText:t.hiddenInfoButtonText,void 0!==e.isCloseOnClick&&(t.isCloseOnClick=e.isCloseOnClick),t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){t.onOk(),this.hide()}.bind(this),this.onCancelMethod=function(){t.onCancel(),this.hide()}.bind(this);var i=this.falseButton.clone().removeEvents().addClass(t.cancelColor).addClass("hidden").addEvent("click",this.onCancelMethod);i.getElement("span").set("html",t.cancelIcon),i.getElement(".label").set("html",t.cancelText);var n=new Element("span",{html:"&nbsp;",class:"hidden"});if(this.message=t.append?this.message+(""!==this.message?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,class:"content align"+t.messageAlign})),t.showHiddenInfo){var s=new Element("div",{class:"hiddenInfoContainer",style:"display: none;",html:"<br />"+t.hiddenInfoMessage}).inject(this.promptBox),o=new Element("div",{class:"tooltip-view ui-has-tooltip more-button tile-more-button",style:"text-align: center;",html:'<br /><span class="button more w-icon more-info-button"><span class="icon-info"></span><span class="btn-tag tile-more">'+t.hiddenInfoButtonText+"</span></span>"}).inject(this.promptBox),a=new Element("div",{style:"text-align: center;",class:"tooltip-view ui-has-tooltip more-button tile-more-button",html:'<span class="button more w-icon more-info-button"><span></span><span class="btn-tag tile-more">Hide</span></span>'}).inject(s);o.addEvent(Affinity.events.click,function(e){s.style.display="block",o.style.display="none"}.bind(this)),a.addEvent(Affinity.events.click,function(e){s.style.display="none",o.style.display="block"}.bind(this))}return t.showLoader?(this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader")):this.promptBox.removeClass("loader"),t.noClose?this.promptBox.getElement("promptButtons")&&this.promptBox.getElement("promptButtons").destroy():t.showButtons&&(this.promptBox.adopt(new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),n,i)),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText)),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.showButtons||t.noClose?t.showCancel&&(n.removeClass("hidden"),i.removeClass("hidden")):this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.center(),this.show(),this},prompt:function(e){this.currentType=e.type||"";var t,i=this.returnOptionsObject(UIPromptObject);return i.message=e.message?e.message:i.message,i.messageAlign=e.messageAlign?e.messageAlign:i.messageAlign,i.value=e.value?e.value:i.value,i.lines=e.lines?e.lines:i.lines,i.okText=e.okText?e.okText:i.okText,i.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,i.okColor=e.okColor?e.okColor:i.okColor,i.onOk=e.onOk?e.onOk:i.onOk,i.cancelText=e.cancelText?e.cancelText:i.cancelText,i.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,i.cancelColor=e.cancelColor?e.cancelColor:i.cancelColor,i.onCancel=e.onCancel?e.onCancel:i.onCancel,i.noClose="boolean"===typeOf(e.noClose)?e.noClose:i.noClose,i.cssSelector=e.cssSelector?e.cssSelector:i.cssSelector,window.onPromptClose=e.onClose?e.onClose:i.onClose,i.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(i.position.position=e.position.position?e.position.position:i.position.position,i.position.top=e.position.top?e.position.top:i.position.top,i.position.left=e.position.left?e.position.left:i.position.left),this.currentObj=i,""!==i.cssSelector?this.promptBox.className="UIPromtBox "+i.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){var e=document.id("UIPromtBox").getElement(".promptinput").value;this.hide(),i.onOk(e)}.bind(this),this.onCancelMethod=function(){var e=document.id("UIPromtBox").getElement(".promptinput").value;this.hide(),i.onCancel(e)}.bind(this),(t=i.lines<2?new Element("input",{type:"text",class:"promptinput data-hj-whitelist",tabindex:9999997}):new Element("textarea",{rows:i.lines,class:"promptinput data-hj-whitelist",tabindex:9999997})).value=i.value,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:i.message,class:"content align"+i.messageAlign}),new Element("div",{class:"promptButtons"}).adopt(t),new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(i.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(i.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),i.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",i.okIcon),this.promptBox.getElement(".true-button .label").set("html",i.okText),this.promptBox.getElement(".false-button span").set("html",i.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",i.cancelText),this.center(),this.show(),this.promptBox.getElement(".promptinput").focus(),this},confirm:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UIConfirmObject);return t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.okText=e.okText?e.okText:t.okText,t.okIcon=e.okIcon?e.okIcon:Affinity.icons.Tick,t.okColor=e.okColor?e.okColor:t.okColor,t.onOk=e.onOk?e.onOk:t.onOk,t.cancelText=e.cancelText?e.cancelText:t.cancelText,t.cancelIcon=e.cancelIcon?e.cancelIcon:Affinity.icons.Cancel,t.cancelColor=e.cancelColor?e.cancelColor:t.cancelColor,t.onCancel=e.onCancel?e.onCancel:t.onCancel,t.noClose="boolean"===typeOf(e.noClose)?e.noClose:t.noClose,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.onEnterMethod=function(){this.hide(),t.onOk(!0)}.bind(this),this.onCancelMethod=function(){this.hide(),t.onCancel(!1)}.bind(this),this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,class:"content align"+t.messageAlign}),new Element("div",{class:"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),this.currentObj=t,window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this},loader:function(e){this.currentType=e.type||"";var t=this.returnOptionsObject(UILoaderObject);t.message=e.message?e.message:t.message,t.messageAlign=e.messageAlign?e.messageAlign:t.messageAlign,t.cssSelector=e.cssSelector?e.cssSelector:t.cssSelector,window.onPromptClose=e.onClose?e.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),e.position&&(t.position.position=e.position.position?e.position.position:t.position.position,t.position.top=e.position.top?e.position.top:t.position.top,t.position.left=e.position.left?e.position.left:t.position.left),this.currentObj=t,""!==t.cssSelector?this.promptBox.className="UIPromtBox "+t.cssSelector:this.promptBox.className="UIPromtBox",this.message=t.append?this.message+(""!==this.message?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,class:"content align"+t.messageAlign})),this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader"),window.removeEvent("keyup",this.okKeyUp),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.center(),this.show()},getCalculatedTop:function(){if(Affinity.oldess&&Affinity.oldessFrame){var e=this.promptBox.getSize().y/2,t=window.parent.window,i=t.document.documentElement,n=t.document.body,s=i&&i.scrollTop||n&&n.scrollTop||0,o=t.innerHeight||t.document.documentElement.clientHeight,a=0,r=window.parent.document.getElementById("ctl00_MainPanel");if(r&&(a=document.documentMode&&document.documentMode<9?r.querySelectorAll(".ContentBody")[0].offsetTop:r.getElementsByClassName("ContentBody")[0].offsetTop),"fixed"===this.promptBox.getStyle("position"))return o/2-a;var l=s+o/2-a;return l<e+10&&(l=e+10),l+10}var h=document.getSize();if("fixed"===this.promptBox.getStyle("position"))return h.y/2;var d=document.getScroll();return h.y/2+d.y},center:function(){if(!Affinity.mobile){var e=this.promptBox.getSize(),t=this.getCalculatedTop(),i="50%",n=0-e.y/2,s=0-e.x/2,o="absolute";if("null"!==typeOf(this.currentObj)&&"null"!==typeOf(this.currentObj.position)){var a=this.currentObj.position;o=a.position?a.position:"absolute",t=a.top?a.top:t,i=a.left?a.left:i,n=a.top?0:n,s=a.left?0:s}this.promptBox.setStyles({position:o,top:t,left:i,margin:n+"px 0 0 "+s+"px"})}},okKeyUp:function(e){"enter"==e.key&&"open"==this.status&&(this.promptBox.getElement(".promptinput")?this.promptBox.getElement(".promptinput")!=document.activeElement&&this.onEnterMethod():this.onEnterMethod())},showButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").removeClass("hidden"),this.promptBoxBG&&(this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.promptBoxBG.addEvent(Affinity.events.click,this.hide)))},hideButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").addClass("hidden"),this.promptBoxBG&&this.promptBoxBG.removeEvent(Affinity.events.click,this.hide))},show:function(){document.body.addClass("uiprompt-open"),this.promptBoxBG.fade("in"),this.promptBox.fade("in"),this.status="open"},escape:function(){this.currentOb&&!this.currentOb.noClose&&this.hide()},clearOnClose:function(){window.onPromptClose=function(){}},hide:function(e){if("string"!=typeof e||""===e||e===this.currentType){"onPromptClose"in window&&window.onPromptClose(),this.clearOnClose(),document.body.removeClass("uiprompt-open"),this.promptBoxBG.fade("out"),this.promptBox.fade("out"),this.status="closed",this.message="",window.removeEvent("keyup",this.okKeyUp);try{this.promptBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(e){}this.currentObj=!1,this.currentType=""}},hideDelayTimer:!1,hideDelay:function(e){this.clearHideDelay(),this.hideDelayTimer=this.hide.delay(e)},clearHideDelay:function(){clearTimeout(this.hideDelayTimer)}}),UIReplaceArrows=new Class({Implements:[Options],Binds:["processArrows","processInlineArrows"],Options:{},initialize:function(e){this.setOptions(e),this.processArrows()},processArrows:function(){var e,t,i,n,s,o=0;Array.each(document.getElements(".ui-replace-arrows td").combine(document.getElements(".ui-replace-arrows th")),(function(a,r){0==a.getElements(".button,button").length&&(e=a.get("html").split(","),a.empty(),Array.each(e,(function(r,l){r.contains("-&gt;")||r.contains("->")?(r.contains("-&gt;")&&(t=r.split("-&gt;")),r.contains("->")&&(t=r.split("->")),i=new Element("table",{class:"arrow-table"}).inject(a),n=new Element("tr").inject(i),s=new Element("span",{html:t[0].trim()}).inject(new Element("td",{class:"left"}).inject(n)),new Element("span",{class:"smicon arrow"}).inject(new Element("td",{class:"arrow"}).inject(n)),new Element("td",{html:t[1].trim()}).inject(n),w=s.getSize().x,o=w>o?o=w:o):(new Element("span",{html:r.trim()}).inject(a),e.length>1&&new Element("br").inject(a))})))})),o>0&&document.getElements("td.left").setStyle("width",o),delete e,delete t,delete i,delete n,delete s},processInlineArrows:function(){var e=[];e.combine(document.getElements(".ui-replace-arrows td")),e.combine(document.getElements(".ui-replace-arrows li")),Array.each(e,(function(e,t){("td"==e.get("tag")&&0==e.getElements(".button,button").length||"td"!=e.get("tag"))&&(e.get("html").contains("-&gt;")&&e.set("html",e.get("html").replace(/-&(gt);/g,'<span class="smicon arrow"></span>')),e.get("html").contains("->")&&e.set("html",e.get("html").replace(/->/g,'<span class="smicon arrow"></span>')))})),e=null,delete e}}),UISelectLookup=new Class({Version:"1.0.4.0",File:"ui.select.lookups.js",Notes:"remove superfluous logging",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","refreshQueue","cancelQueue","processQueue","removeFromQueue","addToQueue","addDefaultOption","addFilterOption"],options:{jsonp:!1},enabled:!1,initialize:function(e){this.setOptions(e),Affinity.UI||(Affinity.UI={}),Affinity.UI.lookups||(Affinity.UI.lookups={}),Affinity.UI.lookups.processLookup=this.processLookup,Affinity.UI.lookupLoaders=[],window.addEvent("refreshQueues",this.refreshQueue),Affinity.login?(window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this))):(this.enabled=!0,this.processNew())},processNew:function(e){this.setOptions(e);var t=document.getElements("select.has-lookup");Array.each(t,this.processLookup),this.processQueue(),delete t},processLookup:function(e){if(e.removeClass("has-lookup").addClass("was-lookup"),!e.hasClass("has-dependencies")&&(e.addClass("lookup-loading"),e.get("data-lookup-api"))){var t,i;if(e.get("data-lookup-api")&&(e.removeClass("has-display-lookup"),""!==e.get("data-lookup-api")&&(t=e.get("data-lookup-api"),e.retrieve("original-lookup-url")||e.store("original-lookup-url",t),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.lookups[i]?Affinity.UI.lookups[i].elements.contains[e]||Affinity.UI.lookups[i].elements.push(e):Affinity.UI.lookups[i]={api:t,id:"lookup_"+String.uniqueID(),type:"select",loaded:!1,massive:!1,elements:[e]})),e.addClass("hidden"),!e.getParent().getElement(".lookup-spinner")){var n=new Element("span",{html:'<img src="'+Affinity.loaders.light+'" />',class:"lookup-spinner hidden"}).inject(e,"after");e.store("spinner",n),e.getParent().getElement(".ui-autocomplete-display")||n.removeClass("hidden")}if(!e.getParent().getElement(".errorstr")){var s=new Element("span",{class:"errorstr inplace-of-input hidden"}).inject(e,"after");e.store("error",s)}window.fireEvent("lookupComplete",e),e.addChangeTracker(),e.fireEvent("lookup")}},getApiKey:function(e){var t,i=new URI(e.toLowerCase()).get("query").parseQueryString(),n=[],s=[],o=!1,a="";return Object.each(i,(function(e,t){"ran"!==t.toLowerCase()&&("parameters"!==t?n.push(t+"-"+e):o=JSON.parse(e))})),n=n.sort(),o&&"object"===typeOf(o)&&"parameter"in o&&"array"===typeOf(o.parameter)&&(Array.each(o.parameter,(function(e){t=[],Object.each(e,(function(e,i){"ran"!==i.toLowerCase()&&t.push(i+"-"+e)})),t.sort(),s.push(t.join("|"))})),s.sort(),a="|parameters|"+s.join("||")),"display-"+(n.join("|")+a).replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,(function(e){"cancel"in e&&e.cancel(),e.removeEvents(),e=null})),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,(function(e,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null})),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){return this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,(function(e){"cancel"in e&&e.cancel(),"removeEvents"in e&&e.removeEvents(),e=null})),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,(function(e,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null,Affinity.UI.lookups[t].elements=[],Affinity.UI.lookups[t]=null,delete Affinity.UI.lookups[t]})),Affinity.UI.lookups={},!0},processQueue:function(){var e,t;try{Object.each(Affinity.UI.lookups,function(i,n){this.enabled&&(!0===Affinity.UI.lookups[n].loaded&&this.setElements(n),!1===Affinity.UI.lookups[n].loaded&&(t=Affinity.UI.lookups[n].api,Affinity.UI.lookups[n].loaded="loading...",(e=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:t,method:"get",timeout:6e4,onComplete:function(e){JSON.Unauthorized(e,Affinity.UI.lookups[n].id)||(Affinity.UI.lookups[n].data=e,"error"in e?e.error.test("limit","gi")?(Affinity.UI.lookups[n].data=[],Affinity.UI.lookups[n].massive=!0,Affinity.UI.lookups[n].loaded=!0,this.setElements(n)):(this.setError(n,e.error&&""!==e.error?e.error:"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1):"array"===typeOf(e)&&e.length>0?(Affinity.UI.lookups[n].loaded=!0,this.setElements(n)):(Affinity.UI.lookups[n].loaded=!1,this.hideLoader(n),this.setError(n,"Data returned as empty array"),Array.each(Affinity.UI.lookups[n].elements,function(e){e.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(e){this.setError(n,"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1}.bind(this),onFailure:function(e){this.setError(n,"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1}.bind(this),onTimeout:function(){this.setError(n,"lookup timed out"),Affinity.UI.dependancies[n].loaded=!1}.bind(this)}):new Request.JSON({url:t,method:"get",timeout:6e4,onSuccess:function(e){JSON.Unauthorized(e,Affinity.UI.lookups[n].id)||(Affinity.UI.lookups[n].data=e,"error"in e?e.error.test("limit","gi")?(Affinity.UI.lookups[n].data=[],Affinity.UI.lookups[n].massive=!0,Affinity.UI.lookups[n].loaded=!0,this.setElements(n)):(this.setError(n,e.error&&""!==e.error?e.error:"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1):"array"===typeOf(e)&&e.length>0?(Affinity.UI.lookups[n].loaded=!0,this.setElements(n)):(Affinity.UI.lookups[n].loaded=!1,this.hideLoader(n),this.setError(n,"Data returned as empty array"),Array.each(Affinity.UI.lookups[n].elements,function(e){e.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(e){this.setError(n,"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1}.bind(this),onFailure:function(e){this.setError(n,"There was an error retrieving this data"),Affinity.UI.lookups[n].loaded=!1}.bind(this),onTimeout:function(){this.setError(n,"lookup timed out"),Affinity.UI.dependancies[n].loaded=!1}.bind(this)}))&&(Affinity.UI.lookupLoaders.push(e),e.send())))}.bind(this))}catch(e){}},removeFromQueue:function(e,t,i){var n,s;return t&&t.getWidget()&&(n=t.getWidget()).hasOwnProperty("revert")&&(n.revert(),"boolean"===typeOf(i)&&!0===i&&("empty"in t&&t.empty(),"value"in t&&(t.value=""))),t.retrieve("spinner")&&(spinner=t.retrieve("spinner"),spinner&&"destroy"in spinner&&spinner.destroy()),t.retrieve("error")&&(error=t.retrieve("error"),error&&"destroy"in error&&error.destroy()),Array.each(Affinity.UI.lookups,(function(e,i){e.elements.contains(t)&&(s=e.elements.indexOf(t),array.splice(s,1))})),!0},addFilterOption:function(e,t){return e.set("filter-option",t),!0},addDefaultOption:function(e,t){if(t)e.adopt(t);else{var i=new Element("option",{value:"",html:"None"});e.adopt(i)}},addToQueue:function(e,t){return t.set("data-lookup-api",e),this.processLookup(t),!0},hideLoader:function(e){Array.each(Affinity.UI.lookups[e].elements,function(e){e.retrieve("spinner")&&e.retrieve("spinner").addClass("hidden")}.bind(this))},setError:function(e,t){Array.each(Affinity.UI.lookups[e].elements,function(e){e.retrieve("spinner")&&e.retrieve("spinner").addClass("hidden"),e.retrieve("error")&&(e.get("data-lookup-error-str")&&""!==e.get("data-lookup-error-str").trim()?e.retrieve("error").set("html",e.get("data-lookup-error-str").trim()).removeClass("hidden"):e.retrieve("error").set("html",t).removeClass("hidden"))}.bind(this))},setElements:function(e){Array.each(Affinity.UI.lookups[e].elements,function(t){if("null"!==typeOf(t)&&"function"===typeOf(t.get)&&t.get("data-lookup-api")){var i=this.filterSelect(t,Affinity.UI.lookups[e].data);this.populateSelect(t,i,e),t.erase("data-lookup-api")}}.bind(this))},filterSelect:function(e,t){var i=e.get("filter-option");return i?t.filter((function(e){return e.Value.indexOf(i)>-1})):t},populateSelect:function(e,t,i){var n,s,o=!1,a=e.get("data-default-value")||"",r=e.get("data-lookup-rules")?e.get("data-lookup-rules").split(","):[],l=e.getElements("option").length>0&&""!==e.getElements("option")[0].get("html").trim();if("array"===typeOf(t)){var h="null"!==typeOf(t[0])?t[0].Value:"";if(e.removeClass("lookup-loading"),Affinity.UI.lookups[i].massive||t.length>Affinity.selectmax)e.addClass("massive").store("data-store","lookups").store("data-key",i).store("data-value",a).store("data-label",a);else{var d={},c=e.getElements("option");c&&c.length>0&&Array.each(c,(function(e){d[e.get("value")]=e})),c=null,Array.each(t,(function(t,i){n=!1,s=t.Value,d[t.Key]?n=d[t.Key]:r.contains("hasValue")?""!==t.Value.trim()&&(n=new Element("option",{value:t.Key,html:s})):n=new Element("option",{value:t.Key,html:s}),n&&(t.Key==a?(n.set("selected","selected"),h=a,o=!0):r.contains("hasValue")&&""===a&&0===i&&(a=t.Key,n.set("selected","selected"),e.set("data-default-value",a),h=a,o=!0),e.adopt(n))}))}var u="UIAutoComplete"in window&&"class"==typeOf(window.UIAutoComplete),m="UIAutoCompleteWidget"in window&&"class"==typeOf(window.UIAutoCompleteWidget);!o&&""==a&&"array"==typeOf(t)&&t.length>0&&(o=!0),e.retrieve("spinner")&&e.retrieve("spinner").destroy(),e.removeClass("hidden"),t.length>=Affinity.selectToAutoNum&&u&&e.addClass("ui-autocomplete"),e.hasClass("ui-autocomplete")&&m&&(e.removeClass("ui-autocomplete"),new UIAutoCompleteWidget({selectElement:e})),!l&&e.retrieve("changetracker")&&e.retrieve("changetracker").setValue(e,a),o&&(e.get("onChange")||e.get("onchange")?e.onChange():e.fireEvent("change",{target:e})),e.fireEvent("lookupComplete",{defaultValue:a,value:h,target:e})}delete o,delete n,delete a}}),UITabs=new Class({Version:"1.0.0.0",File:"ui.tabs.js",Implements:[Options],Binds:["init","processNew"],options:{},initialize:function(e){this.setOptions(e),this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-tab-container"),function(e){if(!e.hasClass("ui-done")){e.addClass("ui-done");var t=e.getElements(".ui-tab");t.addClass("hidden"),Array.each(e.getElements(".ui-tab-title"),function(e,i){e.store("tab",t[i]),e.addEvents({click:function(e){var t=e.target.hasClass("ui-tab-title")?e.target:e.target.getParent(".ui-tab-title");t.getParent(".ui-tab-container").getElements(".ui-tab-title").removeClass("selected"),t.getParent(".ui-tab-container").getElements(".ui-tab").addClass("hidden"),t.retrieve("tab").removeClass("hidden"),t.addClass("selected")}})}.bind(this)),e.getElement(".ui-tab-title").addClass("selected"),e.getElement(".ui-tab").removeClass("hidden")}}.bind(this))}}),UITaxNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-taxnumber"),this.process)},process:function(e){e.removeClass("ui-taxnumber"),new UITaxNumberWidget({element:e})}}),UITaxNumberWidget=new Class({Implements:[Options,Events],Binds:["taxFieldChange","currentLocation","taxFields","buildNZTax","buildAUTax","taxValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy"],options:{element:null,hasPayPoint:!0},element:null,type:"taxnumber",initialize:function(e){if(this.setOptions(e),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{class:"countryselector"}).inject(this.originalElement,"before"),this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown="True"===t?new Element("select",{class:"selector validate","data-validate-method":"taxNumberCountry"}).inject(this.dropdownDiv):new Element("select",{class:"selector"}).inject(this.dropdownDiv),this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown),this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdownoption1,"after"),this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after"),this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(e){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden"),this.disabled?(this.countrySelectEl=new Element("input",{type:"text",class:"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.taxFieldChange,window.addEvent("taxValidationReturned",this.processValidation)),this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country"),this.taxFields(this.currentLocation())},taxFieldChange:function(){var e,t,i,n,s,o,a;null!=this.element&&this.element.destroy(),this.dropdown.getParent("form")&&(e=this.dropdown.getParent("form"),t=[],Array.each(e.getElements("input, select, textarea"),function(e){e.get("name")&&e.get("name").contains("TaxCode")&&t.push(e)}.bind(this)),t.length>0&&Array.each(t,function(e){e.get("data-display-id"),i=e.retrieve("original-lookup-url"),a=e.options[e.selectedIndex],Affinity.lookups.cancelQueue(),Affinity.lookups.removeFromQueue(i,e,!0),o=this.dropdown.value,-1===a.text.indexOf("- "+o)&&(a=null),n=new URI(i),(s=n.parsed.query.parseQueryString()).payPointCountry=o,n.parsed.query=Object.toQueryString(s),i=n.toString(),Affinity.lookups.addDefaultOption(e,a),Affinity.lookups.addFilterOption(e,"- "+o),Affinity.lookups.addToQueue(i,e),Affinity.lookups.refreshQueue(),Affinity.lookups.processQueue()}.bind(this))),this.taxFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?"select"===this.countrySelectEl.get("tag")?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},taxFields:function(e){"NZ"===e?(this.buildNZTax(),this.originalElement.removeClass("hidden")):"AU"===e?(this.buildAUTax(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("taxValidationError",{target:this.originalElement,silent:!0}))},buildNZTax:function(){this.element=new Element("div",{class:"taxnumberbox ui-validate nz","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.taxNumberPart1=new Element("input",{class:"tax1",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart2=new Element("input",{class:"tax2",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart3=new Element("input",{class:"tax3",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.hiddenWrapper||(this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement)),this.element.inject(this.hiddenWrapper,"before"),this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},buildAUTax:function(){this.originalElement.get("disabled"),this.element=new Element("div",{class:"taxnumberbox ui-validate au","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after"),this.element.set("tabindex",5e3),this.taxNumberPart1=new Element("input",{class:"tax1",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart2=new Element("input",{class:"tax2",type:"text",maxlength:"3"}).inject(this.element),new Element("span",{html:" - "}).inject(this.element),this.taxNumberPart3=new Element("input",{class:"tax3",type:"text",maxlength:"3"}).inject(this.element),this.tickcross=new Element("span",{class:"tickcross font-icons color"}).inject(this.element),this.hiddenWrapper||(this.hiddenWrapper=new Element("div",{class:"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement)),this.element.inject(this.hiddenWrapper,"before"),this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked)),this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden(),this.taxValidation()},setFromInitialValue:function(){var e=this.hiddenWrapper.getElement("input").value;this.taxNumberPart3.value=e.substr(e.length-3),this.taxNumberPart2.value=e.substr(e.length-6,3),this.taxNumberPart1.value=e.replace(e.substr(e.length-6),""),this.taxValidation()},copyToHidden:function(){var e=(""!=this.taxNumberPart1.value?this.taxNumberPart1.value:"")+(""!=this.taxNumberPart2.value?this.taxNumberPart2.value:"")+(""!=this.taxNumberPart3.value?this.taxNumberPart3.value:"");this.hiddenWrapper.getElement("input").value=e,this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},taxValidationDelay:!1,taxValidation:function(){clearTimeout(this.taxValidationDelay),this.taxValidationDelay=function(){var e=this.hiddenWrapper.getElement("input"),t=e.getParent("form");null!=t&&t.retrieve("validation")&&t.retrieve("validation").validateTaxNumber(e,this.currentLocation(),e.get("name"))}.delay(500,this)},processValidation:function(e){var t=e.el,i=e.data;t===this.originalElement&&(i.success?this.success():t.value?this.failed():(window.fireEvent("taxValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Tick),t.removeClass("red").addClass("green")},failed:function(e){var t=this.tickcross;t.set("html",Affinity.icons.Cross),t.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy()),this.selectElement.inject(this.hiddenWrapper,"before"),this.hiddenWrapper.destroy(),this.selectElement.eliminate("widget");var e=this.selectElement;return Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this)),e},destroy:function(){clearTimeout(this.checkExistsPeriodical),this.revert().destroy()}}),UITextareaAutoSize=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},initialize:function(e){this.setOptions(e),this.processNew()},processNew:function(){Array.each(document.getElements(".ui-textarea-autosize"),this.process)},process:function(e){e.removeClass("ui-textarea-autosize"),new UITextareaAutoSizeWidget({element:e})}}),UITextareaAutoSizeWidget=new Class({Implements:[Options,Events],Binds:["checkContent","hasContent","resize","revert","destroy"],options:{element:null},element:null,initialContent:!1,initialContentInterval:!1,initialize:function(e){if(this.setOptions(e),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=!!this.originalElement.get("disabled"),null===this.options.element||"element"!==typeOf(this.options.element))throw"No valid element passed in, dummy";""===this.originalElement.value?this.initialContentInterval=this.checkContent.periodical(100,this):this.hasContent()},checkContent:function(){""!==this.originalElement.value&&(clearInterval(this.initialContentInterval),this.hasContent())},hasContent:function(){clearInterval(this.initialContentInterval),this.initialHeight=this.originalElement.getSize().y,this.originalElement.addEvent("keyup",this.resize),this.resize()},resize:function(){var e=this.originalElement.getSize().y,t=this.originalElement.getScrollSize().y;t>e&&t>this.initialHeight&&this.originalElement.setStyle("height",t)},revert:function(){clearInterval(this.initialContentInterval),this.originalElement.removeEvent("keyup",this.resize),Object.each(this,function(e,t){this[e]=null,delete this[e]}.bind(this))},destroy:function(){this.revert()}}),UITimePickerWidget=new Class({Version:"1.0.0.0",File:"ui.time.picker.js",Implements:[Options,Events],options:{target:null,displayInput:!1,timeonly:!0,date:null,dateWidget:null,width:150,hoursmins:!1},Binds:["swapHours","swapMinutes","setAMPM","setAM","setPM","done","tileOver","tileOut","setMinute","swapHours","setHour","swapMinutes","setLastValue","attemptParse"],row:null,initialize:function(e){this.setOptions(e),this.options.width<150&&(this.options.width=150),this.icons={},this.icons.done=Affinity.icons.Tick,this.target=this.options.target,this.timeTarget=new Element("div",{class:"ui-calendar-time"}).setStyles({width:this.options.width}).inject(this.target),this.displayTarget=new Element("div",{class:"ui-calendar-time-display",html:"<span></span>:<span></span> <span></span>"}).inject(this.timeTarget),this.displayTarget.set("reveal",{duration:250}),this.containerBox=new Element("div",{class:"ui-calendar-time-container"}).setStyles({width:this.options.width}).inject(this.timeTarget),this.containerBox.set("reveal",{duration:250}),this.hoursTarget=new Element("div",{class:"ui-calendar-time-circle hours"}).inject(this.containerBox),this.minutesTarget=new Element("div",{class:"ui-calendar-time-circle minutes"}).inject(this.containerBox),this.hoursTarget.set("reveal",{duration:250}),this.minutesTarget.set("reveal",{duration:250}),this.minutesTarget.toggle();var t=this.displayTarget.getElements("span");this.hourDisplay=t[0],this.minDisplay=t[1],this.ampmDisplay=t[2],delete t,this.doneButton=new Element("div",{class:"button green w-icon done",html:"<span>"+this.icons.done+"</span> Done"}).inject(this.containerBox),this.amButton=new Element("div",{class:"am",html:"am"}).inject(this.containerBox),this.pmButton=new Element("div",{class:"pm",html:"pm"}).inject(this.containerBox),this.hourDisplay.addEvent(Affinity.events.click,this.swapHours),this.minDisplay.addEvent(Affinity.events.click,this.swapMinutes),this.options.hoursmins?(this.amButton.addClass("hidden"),this.pmButton.addClass("hidden"),this.ampmDisplay.addClass("hidden")):(this.ampmDisplay.addEvent(Affinity.events.click,this.setAMPM),this.amButton.addEvent(Affinity.events.click,this.setAM),this.pmButton.addEvent(Affinity.events.click,this.setPM)),this.doneButton.addEvent(Affinity.events.click,this.done),this.size={x:170,y:170},this.width=this.size.x-50,this.height=this.width,this.radius=this.width/2,this.center=new Element("div",{class:"circle-center"}).setStyles({top:this.size.x/2-15,left:this.options.width>150?this.size.x/2-15+(this.options.width-150)/2:this.size.x/2-15}).inject(this.containerBox,"top"),this.marker=new Element("div",{class:"circle-hover-marker"}).inject(this.containerBox,"top"),this.marker.set("tween",{duration:250}),this.marker.fade("hide"),this.canvasOK=!0,this.canvas=new Element("canvas",{width:150,height:150}).setStyles({position:"absolute",top:0,left:this.options.width>150?(this.options.width-150)/2:0,width:150,height:150}).inject(this.containerBox,"top");try{this.canvasContext=this.canvas.getContext("2d")}catch(e){this.canvasOK=!1}this.canvasOK?(this.canvasContext.lineWidth=2,this.canvasContext.strokeStyle=this.center.getStyle("background-color")):this.canvas.destroy();var i=new Element("div",{class:"ui-calendar-time-circle-bg"}).inject(this.containerBox,"top");this.options.width>150&&i.setStyle("left",(this.options.width-150)/2),this.fireSet=!0,null===this.options.date||!1===this.options.date?(this.fireSet=!1,this.date=new Date,this.date.setSeconds(0),this.date.setMilliseconds(0)):this.date=this.options.date.clone(),this.hour=this.date.getHours(),this.minunte=this.date.getMinutes(),this.ampm=this.hour>=12?"pm":"am",this.hoursTargetStatus="closed",this.minutesTargetStatus="closed",this.buildTimeElements(),this.hide(),this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.addEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.addEvent("focus",this.setLastValue),this.options.displayInput.addEvent("blur",this.attemptParse))},buildTimeElements:function(){var e,t,n=0,s=this.hoursTarget;for(t=3,i=0;i<12;i++)new Element("div",{html:t,class:"time-circle-tile h-"+t}).inject(s),++t>=13&&(t=1),this.options.hoursmins&&12===t&&(t=0);for(e=this.hoursTarget.getElements("div"),n=0,step=2*Math.PI/e.length,Array.each(e,function(e){e.getSize();var t=Math.round(this.width/2+this.radius*Math.cos(n)-10)+15,i=Math.round(this.height/2+this.radius*Math.sin(n)-10)+15;e.setStyles({left:t+"px",top:i+"px"}),n+=step,e.addEvent(Affinity.events.overAll,this.tileOver),e.addEvent(Affinity.events.outAll,this.tileOut),e.addEvent(Affinity.events.click,this.setHour),e.addEvent(Affinity.events.click,this.swapMinutes)}.bind(this)),s=this.minutesTarget,t=15,i=0;i<60;i++)new Element("div",{html:t,class:"time-circle-tile m-"+t}).inject(s),i+=4,(t+=5)>=60&&(t=0);e=this.minutesTarget.getElements("div"),n=0,step=2*Math.PI/e.length,Array.each(e,function(e){var t=Math.round(this.width/2+this.radius*Math.cos(n)-10)+15,i=Math.round(this.height/2+this.radius*Math.sin(n)-10)+15;e.setStyles({left:t+"px",top:i+"px"}),n+=step,e.addEvent(Affinity.events.overAll,this.tileOver),e.addEvent(Affinity.events.outAll,this.tileOut),e.addEvent(Affinity.events.click,this.setMinute),e.addEvent(Affinity.events.click,this.swapHours)}.bind(this))},setDisplayTime:function(){this.options.hoursmins?(this.hourDisplay.set("html",this.date.format("%H")),this.minDisplay.set("html",this.date.format("%M"))):(this.hourDisplay.set("html",this.date.format("%l")),this.minDisplay.set("html",this.date.format("%M")),this.ampmDisplay.set("html",this.date.format("%p").toLowerCase())),this.fireSet&&this.fireEvent("timeSet",this.date),this.fireSet=!0,this.options.timeonly&&this.displayTarget},setHour:function(e){this.hour=parseInt(e.target.get("html")),this.date.setHours(this.hour),this.setDisplayTime(),this.hoursTarget.getElements(".active").removeClass("active"),e.target.addClass("active")},setMinute:function(e){this.minunte=parseInt(e.target.get("html")),this.date.setMinutes(this.minunte),this.setDisplayTime(),this.minutesTarget.getElements(".active").removeClass("active"),e.target.addClass("active")},setAMPM:function(){this.containerBox.reveal(),this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),"am"==this.ampm?this.setPM():this.setAM()},setAM:function(e){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="am",this.date.getHours()>=12&&this.date.setHours(this.date.getHours()-12),this.setDisplayTime()},setPM:function(e){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="pm",this.date.getHours()<12&&this.date.setHours(this.date.getHours()+12),this.setDisplayTime()},swapMinutes:function(e){this.show(),this.hourDisplay.removeClass("active"),this.minDisplay.addClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="closed",this.minutesTargetStatus="open",this.hoursTarget.dissolve(),this.minutesTarget.reveal(),this.marker.fade("out"),function(){this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))}.delay(300,this)},swapHours:function(e){this.show(),this.hourDisplay.addClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="open",this.minutesTargetStatus="closed",this.hoursTarget.reveal(),this.minutesTarget.dissolve(),this.marker.fade("out"),function(){this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active"))}.delay(300,this)},positionMarker:function(e){var t=e.getPosition(this.containerBox);this.marker.setPosition({x:t.x-4,y:t.y-4}),this.marker.fade("in"),delete t},tileOver:function(e){if(this.canvasOK){var t=this.center.getPosition(this.canvas),i=e.target.getPosition(this.canvas);this.canvasContext.clearRect(0,0,150,150),this.canvasContext.beginPath(),this.canvasContext.moveTo(t.x+5,t.y+5),this.canvasContext.lineTo(i.x+10,i.y+10),this.canvasContext.stroke(),delete t,delete i}},tileOut:function(e){this.canvasOK&&this.canvasContext.clearRect(0,0,150,150),this.marker.fade("out"),"open"==this.hoursTargetStatus&&this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active")),"open"==this.minutesTargetStatus&&this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))},show:function(){clearTimeout(this.autoHideDelay),this.options.hoursmins||(this.containerBox.reveal(),this.showDisplay(),this.fireEvent("open",this.date))},hide:function(){if(this.hourDisplay&&this.hourDisplay.removeClass("active"),this.minDisplay&&this.minDisplay.removeClass("active"),this.ampmDisplay&&this.ampmDisplay.removeClass("active"),this.options.timeonly){if(this.options.dateWidget)try{this.options.dateWidget.hide()}catch(e){}}else this.containerBox.dissolve()},showDisplay:function(){this.displayTarget.reveal()},hideDisplay:function(){this.displayTarget.dissolve()},done:function(){this.hide(),this.fireEvent("timeSet",this.date),this.fireEvent("done",this.date)},setTime:function(e){this.date=e.clone(),this.setDisplayTime()},getTime:function(){return this.date},lastValue:!1,setLastValue:function(){this.options.displayInput&&"input"===this.options.displayInput.get("tag")&&(this.lastValue=this.options.displayInput.value)},autoHideDelay:null,attemptParse:function(e){if(clearTimeout(this.autoHideDelay),this.options.displayInput&&"input"===this.options.displayInput.get("tag")){var t,i,n,s=this.options.displayInput.value,o=!1,a=!1,r=!1;if(s=s.trim(),this.options.timeonly&&this.options.hoursmins){(t=(t=s.toLowerCase().replace(/m/," m ").replace(/h/," h ").split(/[^0-9mh]/i)).filter((function(e){return"h"===e||"m"===e?e:!isNaN(parseFloat(e,10))}))).contains("m")&&!isNaN(t[t.indexOf("m")-1])&&(r=parseFloat(t[t.indexOf("m")-1],10),t.splice(t.indexOf("m"),1)),t.contains("h")&&!isNaN(t[t.indexOf("h")-1])&&(a=parseFloat(t[t.indexOf("h")-1],10),t.splice(t.indexOf("h"),1)),r||a?(t=[],a?t.push(a):t.push(0),r?t.push(r):t.push(0)):(":"!==s.charAt(0)&&"."!==s.charAt(0)||t.unshift(0),1===t.length&&(t[1]="0")),a=parseInt(t[0],10),r=parseInt(t[1],10),parseInt(a,10)>11&&(a="11"),s.contains(".")&&(r=Math.round(60*parseFloat("0."+r))),parseInt(r,10)>59&&(a="59"),s=(a+"").pad(2,"0","left")+":"+(r+"").pad(2,"0","left");try{o=Date.parse(s)}catch(e){o=!1}o&&"date"===typeOf(o)&&o.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=s),this.setTime(o))}else if(this.options.timeonly&&(s=s.replace(new RegExp(/[^0-9.\:]/gi),"")),""!==s){if(s.contains(":")?(i=(t=s.split(":"))[0],parseInt(i,10)>24&&(i="24"),parseInt(i,10)<0&&(i="00"),i=i.pad(2,"0","left"),n=t[1].pad(2,"0","right"),parseInt(n,10)>60&&(i="00"),parseInt(i,10)<0&&(i="00"),s=i+":"+n):s.contains(".")?(i=(t=s.split("."))[0],parseInt(i,10)>24&&(i="24"),parseInt(i,10)<0&&(i="00"),i=i.pad(2,"0","left"),n=t[1].pad(2,"0","right"),(r=parseInt(n,10))>99&&(r=0),r<0&&(r=0),s=i+":"+(n=(Math.round(.6*r)+"").pad(2,"0","left"))):4===s.length?s=s.substring(0,2)+":"+s.substring(2):s.length>4?s=s.substring(0,2)+":"+s.substring(2,2):s.length<4&&(1===s.length&&(s="0"+s+"00"),2===s.length&&(s+="00"),3===s.length&&(s="0"+s),s=s.substring(0,2)+":"+s.substring(2)),this.options.timeonly){var l=parseInt(s.split(":")[0],10),h=parseInt(s.split(":")[1],10);h=h>59?0:h,s=((l=l>24?0:l)+"").pad(2,"0","left")+":"+(h+"").pad(2,"0","left")}try{o=Date.parse(s)}catch(e){o=!1}o&&"date"===typeOf(o)&&o.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=s),this.setTime(o))}else this.lastValue&&(this.options.displayInput.value=this.lastValue)}e&&("object"===typeOf(e)||"domevent"===typeOf(e))&&"type"in e&&"blur"===e.type&&(this.autoHideDelay=this.hide.delay(250,this))},destroy:function(){this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.removeEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.removeEvent("focus",this.setLastValue),this.options.displayInput.removeEvent("blur",this.attemptParse)),this.hourDisplay.removeEvents(),this.minDisplay.removeEvents(),this.ampmDisplay.removeEvents(),this.amButton.removeEvents(),this.pmButton.removeEvents(),this.doneButton.removeEvents(),this.displayTarget.set("reveal",null),this.displayTarget.set("tween",null),this.containerBox.set("reveal",null),this.containerBox.set("tween",null),this.hoursTarget.set("reveal",null),this.hoursTarget.set("tween",null),this.minutesTarget.set("reveal",null),this.minutesTarget.set("tween",null),this.hourDisplay.destroy(),this.minDisplay.destroy(),this.ampmDisplay.destroy(),this.amButton.destroy(),this.pmButton.destroy(),this.doneButton.destroy(),this.canvasOK&&(this.canvas.destroy(),this.canvasContext=null),Array.each(this.hoursTarget.getElements("div"),function(e){e.removeEvents()}.bind(this)),this.hoursTarget.empty(),this.hoursTarget.destroy(),Array.each(this.minutesTarget.getElements("div"),function(e){e.removeEvents()}.bind(this)),this.minutesTarget.empty(),this.minutesTarget.destroy(),this.displayTarget.empty(),this.displayTarget.destroy(),Object.each(this,function(e,t){this[t]=null,delete this[t]}.bind(this))}}),UITooltips=new Class({Version:"1.0.2.0",File:"ui.tooltip.js",Implements:[Options],Binds:["processNew","init","processTooltip","removeTooltip","itemOver","itemOut"],options:{},initialize:function(e){this.setOptions(e),Affinity.UI.Tooltips={},Affinity.UI.Tooltips.Process=this.processNew,Affinity.UI.Tooltips.Remove=this.removeTooltip,Affinity.UI.Tooltips.Hide=this.hideAll,this.init()},processNew:function(){this.init()},init:function(){if(!Affinity.helpbubble)throw"UI Tooltips requires UI Help Bubble";Array.each(document.getElements(".ui-has-tooltip"),this.processTooltip.bind(this))},processTooltip:function(e,t,i){e.get("data-tooltip")&&(e.hasEvent(Affinity.events.overAll,this.itemOver)||(e.addEvent(Affinity.events.overAll,this.itemOver),e.addEvent(Affinity.events.outAll,this.itemOut),"input"===e.get("tag")&&e.addEvent("blur",this.itemOut)),"boolean"===typeOf(t)&&t&&this.itemOver({target:e}))},removeTooltip:function(e){e.removeClass("ui-has-tooltip"),e.erase("data-tooltip"),e.erase("data-tooltip-dir"),e.removeEvent(Affinity.events.overAll,this.itemOver),e.removeEvent(Affinity.events.outAll,this.itemOut),"input"===e.get("tag")&&e.removeEvent("blur",this.itemOut)},itemOver:function(e){var t=e.target.hasClass("ui-has-tooltip")?e.target:e.target.getParent("ui-has-tooltip");if(t){Affinity.helpbubble.populate(t.get("data-tooltip"));var i=Affinity.helpbubble.getSize();if("object"===typeOf(i)&&"y"in i){var n,s=t.get("data-tooltip-dir")?t.get("data-tooltip-dir").toLowerCase().trim():"right",o=document.getScrollSize(),a=t.getPosition(),r=t.getSize(),l=(document.getScroll(),{x:0,y:0});switch(s){case"top":case"top,right":case"top,center":n="bottom",l.x=a.x,l.y=a.y-i.y-10;break;case"bottom":case"bottom,center":n="top",l.x=a.x,l.y=a.y+i.y-5;break;case"right":n="left",l.x=a.x+r.x+5,l.y=a.y+r.y/2-20;break;case"left":n="right",l.x=a.x-i.x-5,l.y=a.y+r.y/2-20;break;case"top,left":n="bottom-right",l.x=a.x+r.x-i.x,l.y=a.y-i.y-10;break;case"bottom,left":n="top-right",l.x=a.x+r.x-i.x,l.y=a.y+i.y;break;case"bottom,right":n="top",l.x=a.x,l.y=a.y+i.y}Affinity.helpbubble.setDirection(n),l.x+i.x>o.x&&(l.x=o.x-i.x-5),l.y+i.y>o.y&&(l.y=o.y-i.y-5),Affinity.helpbubble.position(l),Affinity.helpbubble.show(!!t.hasClass("ui-tooltip-selectable"))}}},itemOut:function(){Affinity.helpbubble.hide()},hideAll:function(){Affinity.helpbubble.hide()}}),UIUplaoders=new Class({Implements:[Options],Binds:["processUploaders","setFakeLabel"],options:{},uploaders:{},initialize:function(e){this.setOptions(e),this.processUploaders()},processNew:function(){processUploaders()},processUploaders:function(){if(this.ignoreUpload=!1,document.config.prettyuploads){var e=document.getElements(".upload");Array.each(e,function(e){if(!e.hasClass("uidone")){e.addClass("uidone");var t=e.getElement("input");t.fade("hide");var i=new Element("label").inject(e);i.adopt(t),new Element("span",{class:"button blue",html:"Choose File"}).inject(i),new Element("span",{html:"",class:"uploadlabel hidden"}).inject(i),new Element("i",{html:" ",class:""}).inject(i,"after"),e.get("data-show-delete")&&"true"==e.get("data-show-delete")&&new Element("span",{class:"button red",html:"Delete"}).inject(e).addEvent(Affinity.events.click,this.deleteFile);var n=new Element("div",{html:"",class:"currentFileLabel"}).inject(e);e.getElement("input").addEvent("change",this.setFakeLabel),e.getElement("input").get("data-default-file-name")&&(e.getElement("input").get("data-default-file-path")?(n.set("html","Current File: "),new Element("a",{href:e.getElement("input").get("data-default-file-path"),html:e.getElement("input").get("data-default-file-name")}).inject(n)):n.set("html","Current File: "+e.getElement("input").get("data-default-file-name")))}}.bind(this)),delete button}},deleteFile:function(e){document.getElements(".uploadlabel").set("html",""),document.getElements(".currentFileLabel").set("html",""),document.getElementById("hiddenDeleteAttachment").set("value","true"),document.getElementById("files").set("value","")},setFakeLabel:function(e){var t=e.target.value;t.contains("fakepath")&&(t=t.substring(e.target.value.indexOf("fakepath")+9)),e.target.getParent().getLast("span").set("html",t)}}),UIUplaodersMulti=new Class({Version:"1.0.0.0",File:"ui.upload.multi.js",Implements:[Options,Events],Binds:["processNew","processUploader","addFile","addFileCont","addFileRow","deleteFile"],options:{auto:!0,maxsize:20971520,samenames:!0},uploaders:{},initialize:function(e){this.setOptions(e),this.icons={},this.icons.del=Affinity.icons.CrossRound||"&#xe06d;",Affinity.prettyuploads&&this.options.auto&&Array.each(document.getElements(".uploadmulti"),this.processUploader)},processNew:function(){Array.each(document.getElements(".uploadmulti"),this.processUploader)},processUploader:function(e){if(Affinity.prettyuploads&&!e.hasClass("uidone")){e.store("count",1);var t=new HtmlTable({properties:{class:"ui-grid"},headers:["File",""],rows:[]});new Element("div",{class:"upload-table hidden"}).adopt(t.element).inject(e),e.addClass("uidone"),e.hasClass("isrequired");var i=new Element("label").inject(e),n=e.get("data-question-name")+"_file0";e.getElement("input").set("name",n).set("id",n).addEvent("change",this.addFile).inject(i).fade("hide"),new Element("span",{class:"button blue"}).adopt(new Element("span",{class:"icon-add-to-list"}),new Element("span",{html:"Add&nbsp;File"})).inject(i),new Element("span",{html:"",class:"uploadlabel"}).inject(i);var s=e.getElement(".initialValues");if(s){var o=s.value.trim();if(""!==o){var a=o.split(",");Array.each(a,function(e){this.addFileRow(t.element,e,e)}.bind(this)),window.fireEvent("multiFileDefaults",{initialValues:o,table:t.element})}}delete t,delete i,delete n,delete o,Affinity.uiGrid.processTables(t.element)}},addFile:function(e){e.stop();var t={};if(t.uploadInput=e.target,t.uploader=t.uploadInput.getParent(".uploadmulti"),t.table=t.uploader.getElement("table"),t.questionName=t.uploader.get("data-question-name"),t.filePath=t.uploadInput.value,t.fileName=t.filePath,t.count=t.uploader.retrieve("count")+1,t.inputId=t.questionName+"_file"+t.count,t.fileEventData={fileElement:t.uploadInput,questionName:t.questionName,table:t.table},""!==t.filePath&&"null"!=typeOf(t.filePath))if(t.uploadInput.files&&t.uploadInput.files[0].size>this.options.maxsize){window.fireEvent("multiFileTooLarge",{fileElement:t.uploadInput,maxsize:this.options.maxsize,size:t.uploadInput.files[0].size,table:t.table}),t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}delete t}else{t.fileName.contains("fakepath")&&(t.fileName=t.fileName.substring(t.uploadInput.value.indexOf("fakepath")+9)),t.fileName.contains("/")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("/")+1)),t.fileName.contains("\\")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("\\")+1));var i=!1;if(Array.each(t.table.getElements("tr"),(function(e){e.retrieve("fileName")&&e.retrieve("fileName").trim()===t.fileName.trim()&&(i=!0)})),i){if(!this.options.samenames){uialert({message:"Filenames must be different.<br />You already have a file with name '"+t.fileName+"'."}),t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}return void delete t}uiconfirm({message:"You already have a file named '"+t.fileName+"'.<br />Would you like to continue anyway?",onOk:function(){this.addFileCont(e,t)}.bind(this),onCancel:function(){t.uploadInput.value="";try{delete t.uploadInput.files}catch(e){}delete t}.bind(this)})}else this.addFileCont(e,t)}else delete t},addFileCont:function(e,t){e.stop(),this.addFileRow(t.table,t.fileName,null,t.inputId);var i=t.table.getParent(".uploadmulti");t.uploadInput.set("class","").addClass("subhidden").set("name",t.inputId).set("id",t.inputId).removeEvents(),function(){t.uploadInput=t.uploadInput.clone().set("name",t.questionName+"_file0").set("id",t.questionName+"_file0").set("class","").addClass("new-master").inject(t.uploadInput,"before").fade("hide"),t.uploadInput.removeEvents(),t.uploadInput.addEvent("change",this.addFile),t.uploadInput.value="",t.uploader.store("count",t.count),window.fireEvent("multiFileAdded",t.fileEventData),i.fireEvent("multiFileAdded",t.fileEventData)}.delay(50,this),delete t},addFileRow:function(e,t,i,n,s){var o,a;o=null!==i?'<span class="button orange delete w-icon-only"><span>'+this.icons.del+"</span></span>":'<span class="button orange delete new w-icon-only"><span>'+this.icons.del+"</span></span>",e.retrieve("HtmlTable").push([t,o]),(a=e.getElements("tbody tr").getLast()).store("fileName",t),null!==i&&(a.store("fileId",i),a.addEvent("click",this.downloadFile.bind(this)),a.addClass("saved")),s&&(a.removeEvents(),a.getElement("td").empty(),new Element("a",{href:s,target:"_blank",html:t}).inject(a.getElement("td"))),null!==n&&a.store("inputId",n),a.getElements(".delete").addEvent("click",this.deleteFile),Affinity.uiGrid.zebra(e),e.getParent().removeClass("hidden"),delete o,delete a},deleteFile:function(e){e.stop();var t=!1,i=e.target.hasClass("button")?e.target:e.target.getParent(".button"),n=e.target.getParent(".uploadmulti"),s=e.target.getParent("tr"),o=s.getParent("table"),a=n.get("data-question-name"),r=!1;if(s.retrieve("fileId")&&(r=s.retrieve("fileId")),i.hasClass("new")){var l=s.retrieve("inputId");n.getElement("#"+l)&&n.getElement("#"+l).destroy()}else if(window.fireEvent("validateMultiFileDelete",{row:s,table:o,deletionTarget:{deleteName:h,deletedId:r,questionName:a,table:o}}),n.fireEvent("validateMultiFileDelete",{row:s,table:o,deletionTarget:{deleteName:h,deletedId:r,questionName:a,table:o}}),!(t=s.hasClass("preventDeletion"))){s.retrieve("fileId")&&(r=s.retrieve("fileId"));var h=s.getElement("td").get("html");window.fireEvent("multiFileDeleted",{deleteName:h,deletedId:r,questionName:a,table:o}),n.fireEvent("multiFileDeleted",{deleteName:h,deletedId:r,questionName:a,table:o}),delete r,delete h}t?s.removeClass("preventDeletion"):(s.destroy(),Affinity.uiGrid.zebra(o),0==o.getElements("tbody tr").length&&o.getParent().addClass("hidden"),delete i,delete n,delete s,delete o,delete a)},downloadFile:function(e){e.stop();var t="td"==e.target.get("tag")?e.target:e.target.getParent("td"),i=t.getParent("tr").retrieve("fileId"),n=t.getParent("tr").retrieve("dowloadUrl");i&&n&&window.open(n+"?documentId="+i,"_blank")},setMaxSize:function(e){this.options.maxsize=e},reset:function(e){var t=!1,i=!1;if("element"===typeOf(e)&&(e.hasClass("uploadmulti")&&(t=e),"element"!==typeOf(e)||!e.get("type")||"input"!==e.get("type")&&"file"!==e.get("type")||(t=e.getParent(".uploadmulti"))),t&&t.getElement("label input")&&(i=t.getElement("label input")),t){var n=t.getElement("table"),s=t.get("data-question-name");if(Array.each(t.getElements("label input"),(function(e){e!==i&&e.destroy()})),t.store("count",1),i&&(i.set("name",s+"_file0").set("id",s+"_file0").set("class",null).set("type","file").removeEvents().addEvent("change",this.addFile.bind(this)).fade("hide"),i.value="","files"in i))try{i.files=[]}catch(e){}n.getElement("tbody").empty(),n.getParent().addClass("hidden")}}}),UIValidation=new Class({Version:"1.0.2.0",File:"ui.validation.js",Notes:"API Structure change",initialize:function(e){if("object"===typeOf(e)&&("element"==typeOf(e.target)||"form"==typeOf(e.target)))return new UIFormValidation(e);this.processNew()},processNew:function(){Array.each(document.getElements("form.validate-form"),function(e){e.retrieve("validation")||new UIFormValidation({target:e})}.bind(this))}}),UIFormValidation=new Class({Implements:[Options],Binds:["disable","enable","ignoreRequired","doRequired","submitButtonMouseDown","validateForm","validate","processForm","validateForm","processErrors","validateElement","processError","validateHasvalue","validateSentence","validateString","validateNumber","validateInt","validateFloat","validateCurrency","validateEmail","validateChecked","validateMultiChecked","validateRadioSelected","validateLength","validateRange","validateDate","validateLinked","validateNomatch","validateUrl","validateFile","checkNum","validateBankNumber","validateTaxCode","validateTaxNumber","validateTaxNumberCountry","validateBankNumberCountry"],options:{target:null,onPost:null,onValidateCallback:null,onValidateFailCallback:null},approvedElements:["input","textarea","select"],approvedValidations:["file","banknumber","bankNumber","taxcode","taxnumber","taxNumber"],initialize:function(e){this.setOptions(e),this.options.target.retrieve("validation")&&this.options.target.retrieve("validation").destroy(),this.options.target.store("validation",this),this.options.target.addEvent("submit",this.validateForm),Array.each(this.options.target.getElements('*[type="submit"]'),function(e){e.addEvent(Affinity.events.start,this.submitButtonMouseDown)}.bind(this)),this.taxValidationRequests={},this.banknumValidationRequests={}},ignoreHasValue:!1,disaabled:!1,disable:function(){this.disaabled=!0},enable:function(){this.disaabled=!1},ignoreRequired:function(){this.ignoreHasValue=!0},doRequired:function(){this.ignoreHasValue=!1},destroy:function(){this.options.target.removeEvent("submit",this.validateForm),this.options.target.eliminate("validation"),this.options=null},submitButtonMouseDown:function(e){var t=e.target.hasClass(".button")||"button"===e.target.get("tag")?e.target:e.target.getParent(".button")?e.target.getParent(".button"):!!e.target.getParent("button")&&e.target.getParent("button");this.ignoreHasValue=!1,t&&t.hasClass("ignore-required")&&(this.ignoreHasValue=!0)},validateForm:function(e){this.disaabled||(e.preventDefault(),e.stopPropagation(),e.stop(),this.validate())},validate:function(){if(null===this.options.target)throw"Can not validate on no form";document.getElements(".error").removeClass("error"),document.getElements(".errorstr").destroy(),this.options.onPost&&"function"===typeOf(this.options.onPost)&&this.options.onPost(),this.errors=[],Array.each(this.options.target.getElements(".validate"),this.validateElement),document.getElements(".validated").removeClass("validated"),this.errors.length>0?this.processErrors():this.options.onValidateCallback&&"function"==typeOf(this.options.onValidateCallback)?this.options.onValidateCallback():this.options.target.submit()},processErrors:function(){var e;Array.each(this.errors,function(t,i){e=t[0],this.approvedElements.contains(e.get("tag"))&&e.addClass("error"),t[0].getPrevious("label")&&(e=t[0].getPrevious("label")),t[0].getParent().hasClass("currencybox")&&(e=t[0].getParent().getPrevious("label")),t[0].getParent().hasClass("countryselector")&&(e=t[0].getParent().getPrevious("label")),t[0].getParent().hasClass("subhidden")&&(e=t[0].getParent().getPrevious("label")),new Element("div",{class:"errorstr",html:t[1]}).inject(e,"before"),t[0].getParent(".form-row")&&t[0].getParent(".form-row").removeClass("valid").addClass("invalid")}.bind(this)),this.options.onValidateFailCallback&&"function"==typeOf(this.options.onValidateFailCallback)&&this.options.onValidateFailCallback(this.errors),delete e},processError:function(e,t){t.getAttribute("data-validate-error-str")&&(e=e+"<br />"+t.getAttribute("data-validate-error-str")),t.get("data-display-id")&&(t=document.id(t.get("data-display-id"))),this.errors.contains([t,e])||this.errors.push([t,e])},validateElement:function(e,t){if(e.getAttribute("data-validate-method")&&(this.approvedElements.contains(e.get("tag"))||this.approvedValidations.contains(e.get("data-validate-method")))){var i,n=e.getAttribute("data-validate-method").split(",");Array.each(n,function(t,n){i="validate"+t.capitalize(),"function"==typeOf(this[i])&&(e.getParent(".form-row")&&e.getParent(".form-row").removeClass("invalid").addClass("valid"),"validateTaxNumber"===i||"validateBankNumber"===i||this[i](e))}.bind(this))}},validateHasvalue:function(e){if(!this.ignoreHasValue&&"element"==typeOf(e)){if(e.hasClass("hidden"))return;if("null"!==typeOf(e.value)){if(""!=e.value&&""!==e.value.trim())return;this.processError("This must have a value",e)}}},validateSentence:function(e){var t=new RegExp(/^[a-zA-Z0-9_\-.,:;'\"!?@#$%\*\/\\|()\s]*$/g);if(e.value.length>0&&!t.test(e.value)){var i=255;i=e.getAttribute("data-validate-length")?e.getAttribute("data-validate-length"):i,i=e.getAttribute("data-validate-max")?e.getAttribute("data-validate-max"):i,i=parseInt(i)||255,e.value.length>i?this.processError("The text is too large. The maximum length allowed is 255 characters.",e):this.processError("Some of the symbols used are invalid (ok symbols: . , _ - ; : ( ) ? $ * % @ # ! \\ ' \" )",e)}},validateString:function(e){var t=new RegExp(/^[A-Za-z0-9_\-.]+$/g);e.value.length>0&&(t.test(e.value)||this.processError("This may not have spaces and can only have numbers, letters and some symbols (ok symbols: _ - . )",e))},validateNumber:function(e){var t=2147483647,i=new RegExp(/^[-+]?[0-9,.]+$/g);if(e.value.length>0){if(parseInt(e.value.replace(/[^0-9.]/g,""))>t)return void this.processError("Number values can be no greater than "+t,e);i.test(e.value)||this.processError("This must only be numbers and may have commas and points",e)}},validateInt:function(e){var t=2147483647,i=-2147483647,n=new RegExp(/^[-+]?[0-9]+$/g);if(e.value.length>0){if(parseInt(e.value)>t)return void this.processError("Int values can be no greater than "+t,e);if(parseInt(e.value)<i)return void this.processError("Int values can be no smaller than "+i,e);n.test(e.value)||this.processError("This must be an integer value",e)}},validateFloat:function(e){var t=2147483647,i=-2147483647,n=new RegExp(/^[-+]?[0-9]*\.?[0-9]+$/g);if(e.value.length>0){if(parseFloat(e.value)>t)return void this.processError("Float values can be no greater than "+t,e);if(parseFloat(e.value)<i)return void this.processError("Float values can be no smaller than "+i,e);n.test(e.value)||this.processError("This must be a float value with maximum 5 decimal places",e)}},validateAlphanumeric:function(e){var t=new RegExp(/^[a-zA-Z0-9_\-.,:'!?$%\*\/\\|\s]+$/g);if(e.value.length>0){if(""===e.value.replace(/[^a-zA-Z]+/g,""))return void this.processError("This must have letters",e);t.test(e.value)||this.processError("This must have letters and can have numbers, spaces and some symbols . , _ - : ? $ * % ! \\ / ' |",e)}},validateCurrency:function(e){var t=2147483647,i=-2147483647,n=new RegExp(/^\-?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1,5})?|(?:,[0-9]{3})*(?:\.[0-9]{1,5})?|(?:\.[0-9]{3})*(?:,[0-9]{1,5})?)$/g);if(e.value=e.value.replace(/\$|\s/gi,""),e.value.length>0){if(parseFloat(e.value.replace(/[^0-9.]/g,""))>t)return void this.processError("Currency values can be no greater than "+t,e);if(parseFloat(e.value.replace(/[^0-9.-]/g,""))<i)return void this.processError("Currency values can be no smaller than "+i,e);n.test(e.value)||this.processError("This must be a valid currency value (without the currency symbol). Eg:<br />123,456,789.12<br />OR<br />123456789.12<br />Mind your commas and decimals!<br />Up to 5 decimal places is permitted.",e)}},validateEmail:function(e){var t=new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);e.value.length>0&&(t.test(e.value)||this.processError("This must be a valid email address",e))},validateChecked:function(e){this.ignoreHasValue||"checkbox"!=e.get("type")||e.checked||this.processError("This must be checked",e)},validateMultiChecked:function(e){this.ignoreHasValue||!e.hasClass("validated")&&"checkbox"==e.get("type")&&e.get("data-validation-multicheck-id")&&(e.checked||(checked=!1,Array.each(e.getParents("form")[0].getElements("input[type=checkbox]"),function(t){t.get("data-validation-multicheck-id")==e.get("data-validation-multicheck-id")&&t.checked&&(checked=!0),t.addClass("validated")}.bind(this)),0==checked&&this.processError("One of these must be checked",e)))},validateRadioSelected:function(e){this.ignoreHasValue||!e.hasClass("validated")&&"radio"==e.get("type")&&e.get("name")&&(e.checked||(checked=!1,Array.each(e.getParents("form")[0].getElements("input[name="+e.get("name")+"]"),function(e){e.checked&&(checked=!0),e.addClass("validated")}.bind(this)),0==checked&&this.processError("One of these must be selected",e)))},validateLength:function(e){if(e.value.length>0){var t=!!e.getAttribute("data-validate-length")&&e.getAttribute("data-validate-length"),i=!!e.getAttribute("data-validate-max")&&e.getAttribute("data-validate-max"),n=!!e.getAttribute("data-validate-min")&&e.getAttribute("data-validate-min");n&&e.value.length<parseInt(n)&&this.processError("This must be longer than "+n+"character(s)",e),i&&e.value.length>parseInt(i)&&this.processError("This must be shorter than "+i+" character(s)",e),t&&e.value.length<parseInt(t)&&this.processError("This must be at least "+t+" character(s)",e)}},validateRange:function(e){if(e.value.length>0){var t=!!e.getAttribute("data-validate-max")&&e.getAttribute("data-validate-max"),i=!!e.getAttribute("data-validate-min")&&e.getAttribute("data-validate-min");if(isNaN(e.value))return void this.processError("This must be a number",e);t&&parseFloat(e.value)>parseFloat(t)&&this.processError("This must be less than or equal to "+t,e),i&&parseFloat(e.value)<parseFloat(i)&&this.processError("This must be greater than or equal to "+i,e)}},validateDate:function(e){e.value.length>0&&(Date.parse(e.value).isValid()||this.processError("This must be a valid date",e))},validateLinked:function(e){},validateNomatch:function(e){var t,i,n,s=e.getParent(".default-form");e.get("data-validate-match")&&s.getElement("."+e.get("data-validate-match"))&&(t=e.value,i=s.getElement("."+e.get("data-validate-match")).value,n=s.getElement("."+e.get("data-validate-match")).getParent(".form-row").getElement("label"),t===i&&this.processError("This must not match "+n.get("html").stripTags(),e))},validateUrl:function(e){if(e.value.startsWith("mailto:"))return e.value=e.value.substring(7),this.validateEmail(e),void(e.value="mailto:"+e.value);var t=new RegExp(/(http|ftp|https|ftps):\/\/+([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?/);e.value.length>0&&(t.test(e.value)||this.processError("This must be a valid URL (try adding http:// to the start of the url)",e))},validateFile:function(e){if(!this.ignoreHasValue){var t,i=!1;if("element"==typeOf(e)){var n=e.getElements("input[type=file]");if(n.length>0)for(t=0;t<n.length;t++)if(""!==n[t].value){i=!0;break}var s=e.getElements("input.initialValues");try{if(s)if("string"===typeOf(s))""!==s.trim()&&(i=!0);else if(s.length>0)for(t=0;t<s.length;t++)if(null!==s[t].value&&""!==s[t].value){i=!0;break}}catch(e){}}i||this.processError("You must upload a file",e)}},checkNum:function(e){if(isNaN(e))return!1},validateBankNumber:function(e,t,i){if(!this.ignoreHasValue){var n=this.banknumValidationRequests[i];n&&n.isRunning()&&n.cancel(),this.banknumValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateBankNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("bankValidationSuccess"):window.fireEvent("bankValidationError"),window.fireEvent("bankValidationReturned",{el:e,data:t})},onError:function(){window.fireEvent("bankValidationError")},onFailure:function(){window.fireEvent("bankValidationError")}}).post({BankNumber:e.value,CountryCode:t})}},validateTaxNumberCountry:function(e){if(!this.ignoreHasValue)return""===e.value.trim()?(this.processError("You must select a country",e),!1):void 0},validateBankNumberCountry:function(e){if(!this.ignoreHasValue)return""===e.value.trim()?(this.processError("You must select a country",e),!1):void 0},validateTaxNumber:function(e,t,i){if(!this.ignoreHasValue){var n=this.taxValidationRequests[i];n&&n.isRunning()&&n.cancel(),this.taxValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateTaxNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("taxValidationSuccess"):window.fireEvent("taxValidationError"),window.fireEvent("taxValidationReturned",{el:e,data:t})},onError:function(){window.fireEvent("taxValidationError")},onFailure:function(){window.fireEvent("taxValidationError")}}).post({TaxNumber:e.value,CountryCode:t})}},validateText:function(e){var t=new RegExp(/^[a-zA-Z0-9_\-.,;'\"!?@#$\\|()\s]*$/g);if(e.value.length>0&&!t.test(e.value)){var i=255;i=e.getAttribute("data-validate-length")?e.getAttribute("data-validate-length"):i,i=e.getAttribute("data-validate-max")?e.getAttribute("data-validate-max"):i,i=parseInt(i)||255,e.value.length>i?this.processError("The text is too large. The maximum length allowed is 255 characters.",e):this.processError("You can only use these symbols: . , _ - ; ( ) ? $ @ # ! \\ ' \"",e)}}}),CFContentsTable=new Class({Implements:[Options],Binds:["processSection"],options:{},initialize:function(e){new Element("a",{name:"#top"}).inject(document.body,"top"),Array.each(document.getElements(".cf-contents-table.hidden"),(function(e){new CFContentsTableComponent({element:e})}))}}),CFContentsTableComponent=new Class({Implements:[Options],Binds:["processSection"],options:{element:null},initialize:function(e){this.setOptions(e),this.element=this.options.element,this.element.removeClass("hidden"),this.sectionlist=this.element.getElement("ul"),this.allrows=document.getElements(".form-row, .title-row"),this.rowindex=this.allrows.indexOf(this.element),Array.each(document.getElements(".section"),this.processSection)},cleanName:function(e){return":"===(e=e.stripTags("span",!0).stripTags("div",!0).stripTags("a",!0).trim()).charAt(e.length-1)&&(e=e.substring(0,e.length-1)),e},processSection:function(e){var t,i,n,s=e.getElements(".form-row, .title-row");s.length>0&&(Array.each(s,function(e,s){this.allrows.indexOf(e)>this.rowindex&&(t=String.uniqueID(),e.hasClass("title-row")&&(null==i&&(i=new Element("ul")),new Element("a",{html:"Top",href:"#top",class:"anchor"}).inject(e),new Element("a",{name:t}).inject(e,"top"),i.adopt(new Element("a",{href:"#"+t,class:"ui-contents-title"}).adopt(new Element("li",{html:this.cleanName(e.get("html"))})))),e.hasClass("form-row")&&(!(n=e.getElement("label,.label"))||n.hasClass("checkbox")||n.hasClass("radio")||(null==i&&(i=new Element("ul")),new Element("a",{name:t}).inject(e,"top"),i.adopt(new Element("a",{href:"#"+t}).adopt(new Element("li",{html:this.cleanName(n.get("html"))}))))))}.bind(this)),null!=i&&(t=String.uniqueID(),this.sectionlist.adopt(new Element("li").adopt(new Element("a",{href:"#"+t,class:"ui-contents-section-title"}).adopt(new Element("li",{html:e.getElement(".section-header span").get("html")})),i)),new Element("a",{html:"Top",href:"#top",class:"anchor"}).inject(e.getElement(".section-header")),new Element("a",{name:t}).inject(e.getElement(".section-header")))),delete i,delete t,delete n,delete s}}),CFFormEdit=new Class({Implements:[Options],Binds:["onPost","validationFailed","taxValidationFail","taxValidationSuccess","bankValidationSuccess","bankValidationFail"],options:{instanceId:"",addFileApi:"",deleteFileApi:"",getFileNamesApi:"",downloadFileApi:""},taxFail:!1,bankFail:!1,initialize:function(e){var t,i;this.setOptions(e),this.form=document.getElement("form"),this.formMethod=this.form.get("method").toLowerCase(),this.formAction=this.form.get("action"),this.buttons=this.form.getElement(".buttons"),this.loader=new Element("div",{class:"formloader hidden"}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'}),new Element("span",{html:"Processing..."})).inject(this.buttons,"after"),this.errorScroll=new Fx.Scroll(window),window.addEvent("taxValidationError",this.taxValidationFail),window.addEvent("taxValidationSuccess",this.taxValidationSuccess),window.addEvent("bankValidationError",this.bankValidationFail),window.addEvent("bankValidationSuccess",this.bankValidationSuccess),this.validation=new UIValidation({target:this.form,onPost:this.onPost,onValidateFailCallback:this.validationFailed.bind(this),onValidateCallback:this.submit.bind(this)}),Array.each(document.getElements("input[type=text],button[type=password],textarea"),function(e){""==e.value&&"NULL"!=e.value||(e.addClass("isnullable"),e.addEvent("blur",(function(e){""==this.value?this.addClass("isnull"):this.removeClass("isnull")})),"NULL"==this.value&&(this.value="",this.addClass("isnull")))}.bind(this)),new CFMulitFileUploaders({instanceId:this.options.instanceId,addApi:this.options.addFileApi,deleteApi:this.options.deleteFileApi,getNamesApi:this.options.getFileNamesApi,downloadFileApi:this.options.downloadFileApi}),this.submitvalue=new Element("input",{type:"hidden"}).inject(document.getElement("form")),Array.each(document.getElements("input[type=submit],button[type=submit]"),function(e){this.submitvalue.set("name",e.name),t=new Element("span",{"data-value":e.get("value"),html:e.get("html")}).addEvent(Affinity.events.click,function(e){var t=e.target;this.submitvalue.value=t.get("data-value")?t.get("data-value"):t.getParent("span").get("data-value"),this.buttons.addClass("hidden"),this.loader.removeClass("hidden"),"Save Form"==this.submitvalue.value?(this.validation.ignoreRequired(),this.validation.validate()):(this.validation.doRequired(),this.validation.validate())}.bind(this)).inject(e,"after"),i=e.getProperties("id","class","name","data-tooltip","data-tooltip-dir"),e.destroy(),t.setProperties(i),t.addClass("button")}.bind(this)),delete t,delete i,new CFContentsTable,window.addEvent("UiReady",(function(){window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500)}))},onPost:function(){document.getElements(".upload-table .notsaved").removeClass("notsaved"),this.buttons.addClass("hidden"),this.loader.removeClass("hidden")},validationFailed:function(){(function(){this.buttons.removeClass("hidden"),this.loader.addClass("hidden"),this.errorScroll.toElement(document.getElement(".errorstr").getParent(".form-row"))}).delay(1e3,this)},submit:function(){var e=!1;if(Array.each(Affinity.UI.lookupLoaders,function(t){e=e||t.running}.bind(this)),e)return uialert({message:"You can't save or submit until all fields that auto-load data into the form have finished loading.",showButtons:!0}),this.buttons.removeClass("hidden"),void this.loader.addClass("hidden");var t="Click OK to submit this form instance.",i="MyDetails"===Affinity.app;i?t="OK, got that. Your changes will be visible soon. Check back later.":"Save Form"===this.submitvalue.value&&(t="Your form will be saved for later editing, but will not be submitted."),uialert({message:t,okText:"Ok",cancelText:"Cancel",showCancel:!i,onOk:function(){this.loader.removeClass("hidden"),this.form.submit()}.bind(this),onCancel:function(){this.buttons.removeClass("hidden"),this.loader.addClass("hidden")}.bind(this)})},taxValidationFail:function(e){this.taxFail=!0},taxValidationSuccess:function(){this.taxFail=!1},bankValidationFail:function(e){this.bankFail=!0},bankValidationSuccess:function(){this.bankFail=!1}}),CFFormTemplateCreate=new Class({Implements:[Options,Events],Binds:["areaSuccess","areaChanged","categorySuccess"],options:{getAreaApi:"",getCategoryApi:""},initialize:function(e){this.setOptions(e),new CFNameCreator({nameInput:document.getElement("#name"),fromInput:document.getElement("#desc")}),this.areaDrop=document.id("cleverformAreaDrop"),this.categoryDrop=document.id("cleverformCategoryDrop"),this.areaDrop&&this.categoryDrop&&(this.areaDrop.addEvent("change",this.areaChanged),this.areaRequest=new CFRequest.JSON({url:this.options.getAreaApi,onSuccess:this.areaSuccess}).send(),this.categoryRequest=new CFRequest.JSON({url:this.options.getCategoryApi,onSuccess:this.categorySuccess})),window.fireEvent("ResizeFrame")},areaChanged:function(e){this.categoryRequest.get({area:this.areaDrop.value})},areaSuccess:function(e){var t,i=document.id("cleverformAreaDrop").get("data-default-value"),n=!1;Array.each(e,function(e){t=new Element("option",{html:e,value:e}),e==i&&(t.set("selected","selected"),n=!0),this.areaDrop.adopt(t)}.bind(this)),n&&this.areaDrop.fireEvent("change"),delete i,delete t,delete n},categorySuccess:function(e){var t,i=document.id("cleverformCategoryDrop").get("data-default-value");this.categoryDrop.empty(),this.categoryDrop.adopt(new Element("option",{html:"Make a selection",value:""})),Array.each(e,function(e){t=new Element("option",{html:e,value:e}),e==i&&t.set("selected","selected"),this.categoryDrop.adopt(t)}.bind(this)),this.categoryDrop.removeClass("hidden"),delete i,delete t}}),CFFormTemplateEdit=new Class({Implements:[Options,Events],Binds:["sortStart","sortSorted","sortComplete"],Options:{},initialize:function(e){this.startlist=null,this.sortableSections=new Sortables([document.getElement(".from"),document.getElement(".to")],{clone:!0,handle:".grey",onStart:this.sortStart,onSort:this.sortSorted,onComplete:this.sortComplete}),new CFNameCreator({nameInput:document.id("Name"),fromInput:document.id("Description")}),window.fireEvent("ResizeFrame")},sortStart:function(e){this.startlist=e.getParent()},sortSorted:function(e,t){if(e.getParent()!=this.startlist){var i=e.getParent()==document.getElement(".from")?document.getElement(".to"):document.getElement(".from");if(!i.getElement(".temp")){var n=e.clone().inject(i);n.addClass("temp"),n.removeProperty("style"),n.setStyle("opacity",.5)}e.addClass("hidden")}},sortComplete:function(e){e.removeClass("hidden"),document.getElement(".from .temp")&&document.getElement(".from .temp").destroy(),document.getElement(".to .temp")&&document.getElement(".to .temp").destroy()}}),CFFormView=new Class({Implements:[Options],Binds:[],options:{instanceId:"",addFileApi:"",deleteFileApi:"",getFileNamesApi:"",downloadFileApi:""},initialize:function(e){this.setOptions(e),new CFMulitFileUploaders({instanceId:this.options.instanceId,addApi:null,deleteApi:null,getNamesApi:this.options.getFileNamesApi,downloadFileApi:this.options.downloadFileApi}),new CFContentsTable,window.addEvent("UiReady",(function(){window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500)}))}}),CFformsAdminDelete=new Class({Implements:[Options,Events],Binds:["deleteClicked","processButton"],Options:{nameMaxLength:100},initialize:function(e){this.setOptions(e),this.processButton();var t=!1;Array.each(document.getElements("table .form-desc"),function(e){var i=e.get("html");i.length>this.options.nameMaxLength&&(e.set("data-tooltip",i),e.set("data-tooltip-dir","top"),e.set("html",i.substr(0,30)+" ..."),e.addClass("ui-has-tooltip"),t=!0)}.bind(this)),t&&Affinity.tooltips.processNew(),Array.each(document.getElements("table .form-workflow"),function(e){var t=e.get("html");""==t?e.set("html","No Workflow"):e.set("html",t.split(",").join(", "))}.bind(this))},deleteClicked:function(e){uiconfirm({message:"Are you sure you would like to delete this form instance?",onOk:function(){var t=e.target.hasClass("button")?e.target:e.target.getParent(".button"),i=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"instanceId",value:t.get("data-instanceId")}).inject(i),i.submit()}.bind(this)})},processButton:function(){Array.each(document.getElements(".button.delete"),function(e){e.addEvent(Affinity.events.click,this.deleteClicked)}.bind(this))}}),CFFormDesigner=new Class({Implements:[Options,Events],Binds:["itemPressed","itemOver","itemOut","draggerStart","onDragCalcIndex","draggerDroppped","draggerEnter","draggerLeave","dragCanceled","addNewSection","addSection","editSection","deleteSection","addNewItem","addItem","editItem","deleteItem","loadTemplate","templateLoaded","returnRankData","postRank","updateDashboardTemplateFlag"],singleUseElementTypes:["effectivedate"],options:{templateid:null,rankApi:null,itemDeleteApi:null,sectionDeleteApi:null,updateDashboardTemplateFlagUrl:null},dragger:null,sectionCount:0,initialize:function(e){var t;this.setOptions(e),this.droppables=[],this.sections=document.getElements("#selectedFormItems .form-section"),this.itemLists=document.getElements("#selectedFormItems .dragto"),this.items=document.getElements("#selectedFormItems .form-item"),this.droppables.combine(this.sections),this.droppables.combine(this.itemLists),this.templateId=document.id("TemplateId"),this.dashboardTemplate=document.id("DashboardTemplate"),this.dashboardTemplate.addEvent("change",this.updateDashboardTemplateFlag),Array.each(document.getElements("#availableFormItems .form-element"),function(e,i){t=e.getElement(".form-element-title"),window.mobile?e.addEvent(Affinity.events.start,this.itemPressed):e.getElements(".grey").addEvent(Affinity.events.start,this.itemPressed),window.mobile&&(e=t),e.addEvent(Affinity.events.overAll,this.itemOver),e.addEvent(Affinity.events.outAll,this.itemOut)}.bind(this)),window.mobile?(this.sortableSections=new Sortables(document.id("selectedFormItems"),{clone:!0,handle:".grey",onStart:function(e,t){t.empty(),t.set("class","form-element form-section draggable dragger"),e.getElement(".blue").clone().inject(t),t.setStyles({"margin-left":e.getElement(".grey").getPosition(e).x,"margin-top":e.getElement(".grey").getPosition(e).y})},onComplete:this.postRank}),this.sortableItems=new Sortables(this.sections.getElements(".section-list"),{clone:!0,onStart:function(e,t){t.empty(),t.set("class","form-element form-item draggable dragger"),e.getElement(".blue").clone().inject(t),t.setStyles({"margin-left":e.getElement(".grey").getPosition(e).x,"margin-top":e.getElement(".grey").getPosition(e).y})},onComplete:function(e){e.removeClass("overtop"),this.postRank()}.bind(this)})):(this.sortableSections=new Sortables(document.id("selectedFormItems"),{clone:!0,handle:".grey",onComplete:this.postRank,onStart:function(e,t){t.addClass("dragger")}}),this.sortableItems=new Sortables(this.sections.getElements(".section-list"),{clone:!0,handle:".grey",onStart:function(e,t){e.addClass("overtop"),t.setStyle("opacity",.5),t.addClass("dragger")},onComplete:function(e){e.removeClass("overtop"),this.postRank()}.bind(this)}),Array.each(this.itemLists.getElements(".grid-list"),function(e){new Sortables(e,{clone:!0,handle:".grey",onStart:function(e,t){e.addClass("overtop"),t.setStyle("opacity",.5),t.addClass("dragger")},onComplete:function(e){e.removeClass("overtop"),this.postRank()}.bind(this)})}.bind(this))),Array.each(this.items,function(e){e.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editItem),e.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteItem),e.set("data-form-label",e.getElement(".form-element-title").get("html")),e.set("data-form-name",e.getElement(".form-element-title").get("html").replace(/ /g,"").toLowerCase()),this.sortableItems.addItems(e),this.singleUseElementTypes.contains(e.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+e.get("data-type").toLowerCase().trim()).addClass("disabled")}.bind(this)),Array.each(this.sections,function(e){e.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editSection),e.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteSection),e.set("data-form-label",e.getElement(".form-element-title").get("html")),e.set("data-form-name",e.getElement(".form-element-title").get("html").replace(/ /g,"").toLowerCase()),this.sortableItems.addItems(e)}.bind(this)),this.templateRequest=new CFRequest.HTML({method:"get",onSuccess:this.templateLoaded}),this.itemDeleteRequest=new CFRequest({url:this.options.itemDeleteApi,method:"post",onRequest:function(){},onSuccess:function(e){},onFailure:function(){}}),this.sectionDeleteRequest=new CFRequest({url:this.options.sectionDeleteApi,method:"post",onRequest:function(){},onSuccess:function(e){},onFailure:function(){}}),this.sendOrderRequest=new CFRequest({urlEncoded:!1,url:this.options.rankApi,method:"post",onRequest:function(){},onSuccess:function(e){},onFailure:function(){}}),this.sendOrderRequest.options.headers={"Content-type":"application/json; charset=utf-8"},this.sendOrderRequest.headers=this.sendOrderRequest.options.headers,this.sendOrderRequest.options.urlEncoded=!1,document.getElement(".col2 .section-list").setStyles({"min-height":document.getElement(".col1 .section-list").getSize().y-14}),window.fireEvent("ResizeFrame")},itemOver:function(e){var t=e.target.hasClass("form-element")?e.target:e.target.getParents(".form-element")[0],i=t.getPosition();Affinity.helpbubble.populate(t.get("data-helptext")),Affinity.helpbubble.position({y:i.y+4,x:i.x+t.getSize().x+10}),Affinity.helpbubble.show()},itemOut:function(e){Affinity.helpbubble.hide()},itemPressed:function(e){e.preventDefault(),e.stopPropagation(),this.dragger=null,document.getElements("drag-form-item")&&document.getElements("drag-form-item").destroy();var t=e.target.hasClass("draggable")?e.target:e.target.getParent(".draggable");if(t.hasClass("disabled"))uialert({message:"This element can no longer be used.<br />This may be a single use element only and may already be in your form.",showButtons:!0,showLoader:!1});else{if(window.mobile)this.dragger=t.getElement(".blue").clone().setStyles({position:"absolute",top:e.page.y-15,left:e.page.x-15}).inject(document.getElement("#availableFormItems")),this.dragger.addClass(t.get("class")+" dragger"),this.dragger.removeClass("light-shadow"),this.dragger.store("reference",t);else{this.dragger=t.clone().setStyles(t.getCoordinates()).setStyles({position:"absolute",opacity:.5}).inject(document.getElement("#availableFormItems")),this.dragger.addClass("drag-form-item dragger");var i=this.dragger.getSize();this.dragger.setStyles({width:i.x-4+"px",height:i.y-4+"px"}),delete i}window.drageventFired=!0;var n=this.dragger.hasClass("form-section")?".section-column.col2":this.droppables,s=window.mobile?function(e,t){window.mobileDragY=t.page.y}.bind(this):this.onDragCalcIndex;this.dropwhere="before",this.droppable=null,this.dropablelastindex=-1,this.droppableoffset=0,this.draggerrank=0,new Drag.Move(this.dragger,{droppables:n,onStart:this.draggerStart,onEnter:this.draggerEnter,onLeave:this.draggerLeave,onDrop:this.draggerDroppped,onCancel:this.dragCanceled,onDrag:s}).start(e)}},draggerStart:function(e,t){},draggerEnter:function(e,t){this.dragger&&t&&(t.getElement("ul").addClass("godrop"),this.droppable=t,this.indexMax=this.droppable.getElements(".form-element").length-1,"section"==e.get("data-type")?(this.droppableoffset=document.id("selectedFormItems").getPosition().y,this.draggertype="section",this.sectionPositions=[],Array.each(this.sections,function(e){this.sectionPositions.push({y:e.getPosition().y-this.droppableoffset,h:e.getSize().y,el:e})}.bind(this))):(this.draggertype="item",this.droppableoffset=t.getPosition().y))},onDragCalcIndex:function(e,t){var i,n,s;null!=this.droppable&&("item"==this.draggertype?(i=window.mobile?window.mobileDragY-this.droppableoffset-55:t.page.y-this.droppableoffset-55,s=i/40,(s=(s=(s=Math.floor(s))>this.indexMax?this.indexMax:s)<0?0:s)>=0&&(s!=this.dropablelastindex||0==s)&&(this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop")),this.dropEl=this.droppable.getElements(".form-element")[s],this.dropEl&&(i<=20?(this.dropEl.addClass("overtop"),this.dropwhere="before",this.draggerrank=0):i>20&&(this.dropEl.addClass("over"),this.dropwhere="after",this.draggerrank=s+1),this.dropablelastindex=s))):"section"==this.draggertype&&(this.sectionPositions&&"array"==typeOf(this.sectionPositions)&&this.sectionPositions.length>0&&(n=this.sectionPositions[this.sectionPositions.length-1].h+this.sectionPositions[this.sectionPositions.length-1].y,(i=t.page.y-this.droppableoffset)>0&&i<n&&i%5==0?Array.each(this.sectionPositions,function(e,t){e.el.removeClass("over"),e.el.removeClass("overtop"),i>=e.y&&i<e.y+e.h/2?(this.dropEl=e.el,s=t,this.dropEl.addClass("overtop"),this.dropwhere="before",this.draggerrank=s):i>=e.y&&i<e.y+e.h&&(this.dropEl=e.el,s=t,this.dropEl.addClass("over"),this.dropwhere="after",this.draggerrank=s+1),this.dropablelastindex=this.draggerrank}.bind(this)):null!=this.droppable&&i<0?(s=this.draggerrank=this.dropablelastindex=0,this.dropEl=this.sectionPositions[s].el,this.dropwhere="before",this.dropEl.addClass("overtop")):null!=this.droppable&&i>n&&(s=this.draggerrank=this.dropablelastindex=this.sectionPositions.length-1,this.dropEl=this.sectionPositions[s].el,this.dropwhere="after",this.dropEl.addClass("over"))),delete i,delete n,delete s))},draggerDroppped:function(e,t,i){window.mobile&&this.onDragCalcIndex(e,i),this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop")),null!==t&&(e.hasClass("form-section")&&this.addNewSection(this.dragger),e.hasClass("form-item")&&(this.addNewItem(this.dragger,t.getElement("ul")),this.singleUseElementTypes.contains(this.dragger.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+this.dragger.get("data-type").toLowerCase().trim()).addClass("disabled")),t.getElement("ul").removeClass("godrop")),this.dragCanceled(e,null)},draggerLeave:function(e,t){this.draggertype=null,this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop")),t&&(t.getElement("ul").removeClass("godrop"),this.droppable=null,this.droppableoffset=0)},dragCanceled:function(e,t){this.draggertype=null,e.destroy(),this.dragger=null,document.getElements("drag-form-item")&&document.getElements("drag-form-item").destroy()},addNewSection:function(e,t){t=this.dropEl?this.dropEl:t||document.id("selectedFormItems");var i=e.clone().removeProperty("style").removeClass("drag-form-item");this.dropEl?i.inject(this.dropEl,this.dropwhere):i.inject(t),this.sectionCount++,i.getElement(".form-element-title").set("html",i.getElement(".form-element-title").get("html")+" "+this.sectionCount),i.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editSection),i.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteSection),this.sortableSections.addItems(i),this.droppables.push(i),this.sortableItems.addLists(i.getElement(".section-list")),this.addSection(i),delete i},addSection:function(e){e=e.hasClass("form-section")?e:e.getParents(".form-section")[0];var t=new Element("div",{class:"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(t),delete t,Affinity.modal.show(!1),document.callerElement=e,this.loadTemplate(e,!0,!0),window.fireEvent("ResizeFrame")},editSection:function(e){var t=e.target;t=t.hasClass("form-item")?t:t.getParents(".form-section")[0];var i=new Element("div",{class:"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(i),delete i,Affinity.modal.show(!1),document.callerElement=t,this.loadTemplate(t,!1,!0)},deleteSection:function(e,t){var i=null!=e?e.target:t;i.hasClass("form-section")||(i=i.getParents(".form-section")[0]);var n=i.getElements("li"),s=[];Array.each(n,(function(e,t){s.push(e.getElement(".form-element-title").get("html").trim())})),s.length>5&&(s=s.slice(0,5)).push("..."),s=s.length>0?"This will delete all "+n.length+" elements in this section:<br /><br />"+s.join("<br />")+"<br /><br />":"This will delete this section. ",uiconfirm({message:s+"Continue?",onOk:function(){var e={};e.templateid=this.options.templateid,e.sectionname=i.get("data-item-name"),i.getElements(".form-element").destroy(),i.destroy(),this.sectionDeleteRequest.post(e),delete e}.bind(this)})},addNewItem:function(e,t){var i;"null"!==typeOf(this.dropEl)&&(t=this.dropEl),i=e.retrieve("reference")?e.retrieve("reference").clone():e.clone().removeProperty("style").removeClass("drag-form-item"),this.dropEl?i.inject(this.dropEl,this.dropwhere):i.inject(t),i.hasClass("dragto")&&(this.droppables.push(i),this.sortableItems.addLists(i.getElement(".grid-list"))),this.sortableItems.addItems(i),i.getElement(".form-element-title").set("html","???"),i.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editItem),i.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteItem),this.addItem(i),delete i},addItem:function(e){e=e.hasClass("form-item")?e:e.getParents(".form-item")[0];var t=new Element("div",{class:"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(t),delete t,Affinity.modal.show(!1),document.callerElement=e,this.loadTemplate(e,!0,!1),window.fireEvent("ResizeFrame")},editItem:function(e){var t=e.target;t=t.hasClass("form-item")?t:t.getParents(".form-item")[0];var i=new Element("div",{class:"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(i),delete i,Affinity.modal.show(!1),document.callerElement=t,this.loadTemplate(t,!1,!1)},deleteItem:function(e,t){var i=null!=e?e.target:t;i.hasClass("form-item")||(i=i.getParents(".form-item")[0]),uiconfirm({message:"Are you sure you want to delete this item?",onOk:function(){var e={};e.templateid=this.options.templateid,e.elementname=i.get("data-item-name"),this.singleUseElementTypes.contains(i.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+i.get("data-type").toLowerCase().trim()).removeClass("disabled"),this.itemDeleteRequest.post(e),i.destroy(),delete e}.bind(this)})},loadTemplate:function(e,t,i){var n=t?e.get("data-template-load-create"):e.get("data-template-load-edit");i?n+="&sectionName="+e.get("data-item-name"):(t||(n+="&name="+e.get("data-item-name")),n+="&section="+e.getParents(".form-section")[0].get("data-item-name")),"null"!==typeOf(this.draggerrank)&&(n+="&rank="+this.draggerrank),n+="&ran="+(new Date).format("%s"),this.templateItemName=e.get("data-template-type"),this.templateRequest.options.url=n,this.templateRequest.send()},templateLoaded:function(e){Affinity.modal.setElement(new Element("div").adopt(e)),Affinity.modal.show(!1),function(){document.uiHideToggle&&(document.uiHideToggle.processNew(),function(){Affinity.modal.position()}.delay(500)),window.fireEvent("TemplateReady",{type:this.templateItemName})}.bind(this).delay(1e3,this)},returnRankData:function(){var e,t={};return t.TemplateId=this.options.templateid,t.Sections={},Array.each(document.getElements("#selectedFormItems .form-section"),function(i,n){t.Sections[i.get("data-item-name")]=[],e=t.Sections[i.get("data-item-name")],Array.each(i.getElements(".section-list .form-item"),function(t,i){e.push(t.get("data-item-name"))}.bind(this))}.bind(this)),delete e,JSON.stringify(t)},postRank:function(){this.sendOrderRequest.post(this.returnRankData())},updateDashboardTemplateFlag:function(){new CFRequest.JSON({url:this.options.updateDashboardTemplateFlagUrl,method:"POST",onSuccess:function(e){},onError:function(e){uialert({message:"Sorry, an error occurred while processing your request.",showLoader:!1,showButtons:!0,noClose:!1})}}).post({templateId:this.templateId.value,dashboardTemplate:this.dashboardTemplate.get("checked")})}}),CFInbox=new Class({Implements:[Options,Events],Binds:["updateInbox","selectInbox","deleteForm","startNewForm","formSelected"],options:{editUrl:"/Instance/Edit/",deleteUrl:"/Inbox/Delete/",viewUrl:"/Instance/View/",expireTabCookie:!1,expireTabMins:10},initialize:function(e){this.setOptions(e),this.icons={},this.icons.edit=Affinity.icons.Pencil||"&#xe0fd;",this.icons.del=Affinity.icons.CrossRound||"&#xe06d;",this.icons.view=Affinity.icons.Page||"&#xe086;",this.labels={edit:"Edit",view:"View",delete:"Are you sure you want to delete this form?",deleting:"Deleting form. Please wait"},this.options.hasOwnProperty("labels")&&Object.each(this.options.labels,function(e,t){this.labels[t]=e}.bind(this)),document.getElement(".button.startnew").addEvent(Affinity.events.click,this.startNewForm),Array.each(document.getElements(".delete"),function(e){e.addEvent(Affinity.events.click,this.deleteForm)}.bind(this)),this.inbox=document.getElement(".ui-inbox"),this.inboxid=this.inbox.get("id");var t=this.inbox.getElements(".ui-inbox-box");this.toActionBox=t[0],this.inProgressBox=t[1],this.completedBox=t[2];var i=this.inbox.getElements(".ui-inbox-labels .indicator");this.toActionIndicator=i[0],this.inProgressIndicator=i[1],this.completedIndicator=i[2];var n=parseInt(Cookie.read("uiInboxIndex"));n&&Affinity.uiInbox.selectBox(this.inbox.getElements(".ui-inbox-labels ul li")[n]),window.addEvent("inboxUpdated",this.updateInbox),window.addEvent("inboxSelected",this.selectInbox),window.fireEvent("ResizeFrame")},lastdata:{},updateInbox:function(e){var t,i,n,s=[];e.elementid==this.inboxid&&("null"===typeOf(this.lastdata.ToAction)&&(this.lastdata.ToAction={}),this.toActionIndicator.set("html",e.data.ToActionCount),this.lastdata.ToAction!=e.data.ToAction&&(0==e.data.ToActionCount?(this.toActionBox.getElement(".empty").removeClass("hidden"),this.toActionBox.getElements(".form").destroy()):(this.toActionBox.getElement(".empty").addClass("hidden"),this.toActionBox.getElements(".form").addClass("checking"),Array.each(e.data.ToAction,function(e,t){this.toActionBox.getElement("#"+e.InstanceId)?(i=this.toActionBox.getElement("#"+e.InstanceId),(s=i.getElements("td"))[1].set("html",e.StateName),s[2].set("html",e.StateEnteredAt),i.removeClass("checking")):(e.DisplayName+=null!=e.ShareOrDelegate?'<span class="tag '+e.ShareOrDelegate.toLowerCase()+'">'+e.SharedBy+"</span>":"",n=e.IsStarted?new Element("td",{class:"ui-inbox-actions buttons",html:'<a href="'+this.options.editUrl+"/"+e.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.edit+"</span>"+this.labels.edit+'</span></a><span class="button red w-icon-only delete" data-delete-action="'+this.options.deleteUrl+"/"+e.InstanceId+'"><span>'+this.icons.del+"</span></span>"}):new Element("td",{class:"ui-inbox-actions buttons",html:'<a href="'+this.options.editUrl+"/"+e.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.edit+"</span>"+this.labels.edit+"</span></a>"}),i=new Element("tr",{id:e.InstanceId,class:"form"}).adopt(new Element("td",{class:"indicate none sort-by",html:e.DisplayName}),new Element("td",{class:"sort-by",html:e.StateName}),new Element("td",{class:"ui-inbox-date sort-by ui-format-date",html:e.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),n).inject(this.toActionBox.getElement("tbody")),e.IsStarted&&i.getElement(".delete").addEvent(Affinity.events.click,this.deleteForm))}.bind(this)),this.toActionBox.getElements(".checking").destroy()),t=this.toActionBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(t),Affinity.uiGrid&&Affinity.uiGrid.zebra(t),this.lastdata.ToAction=e.data.ToAction),"null"===typeOf(this.lastdata.InProgress)&&(this.lastdata.InProgress={}),this.inProgressIndicator.set("html",e.data.InProgressCount),this.lastdata.InProgress!=e.data.InProgress&&(0==e.data.InProgressCount?(this.inProgressBox.getElement(".empty").removeClass("hidden"),this.inProgressBox.getElements(".form").destroy()):(this.inProgressBox.getElement(".empty").addClass("hidden"),this.inProgressBox.getElements(".form").addClass("checking"),Array.each(e.data.InProgress,function(e,t){this.inProgressBox.getElement("#"+e.InstanceId)?(i=this.inProgressBox.getElement("#"+e.InstanceId),(s=i.getElements("td"))[1].set("html",e.StateName),s[2].set("html",e.StateAssigneeName),s[3].set("html",e.StateEnteredAt),i.removeClass("checking")):(e.DisplayName+=null!=e.ShareOrDelegate?'<span class="tag '+e.ShareOrDelegate.toLowerCase()+'">'+e.SharedBy+"</span>":"",i=new Element("tr",{id:e.InstanceId,class:"form"}).adopt(new Element("td",{class:"indicate none sort-by",html:e.DisplayName}),new Element("td",{class:"sort-by",html:e.StateName}),new Element("td",{class:"ui-inbox-date sort-by",html:e.StateAssigneeName}),new Element("td",{class:"ui-inbox-date sort-by ui-format-date",html:e.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),new Element("td",{class:"ui-inbox-actions buttons",html:'<a href="'+this.options.viewUrl+"/"+e.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.view+"</span>"+this.labels.view+"</span></a>"})).inject(this.inProgressBox.getElement("tbody")))}.bind(this)),this.inProgressBox.getElements(".checking").destroy()),t=this.inProgressBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(t),Affinity.uiGrid&&Affinity.uiGrid.zebra(t),this.lastdata.InProgress=e.data.InProgress),"null"===typeOf(this.lastdata.Completed)&&(this.lastdata.Completed={}),this.completedIndicator.set("html",e.data.CompletedCount>99?"99+":e.data.CompletedCount),this.lastdata.Completed!=e.data.Completed&&(0==e.data.CompletedCount?(this.completedBox.getElement(".empty").removeClass("hidden"),this.completedBox.getElements(".form").destroy()):(this.completedBox.getElement(".empty").addClass("hidden"),this.completedBox.getElements(".form").addClass("checking"),Array.each(e.data.Completed,function(e,t){this.completedBox.getElement("#"+e.InstanceId)?(i=this.completedBox.getElement("#"+e.InstanceId),(s=i.getElements("td"))[1].set("html",e.StateName),s[2].set("html",e.CompletedBy),s[3].set("html",e.StateEnteredAt),i.removeClass("checking")):(e.DisplayName+=null!=e.ShareOrDelegate?'<span class="tag '+e.ShareOrDelegate.toLowerCase()+'">'+e.SharedBy+"</span>":"",i=new Element("tr",{id:e.InstanceId,class:"form"}).adopt(new Element("td",{class:"indicate none sort-by",html:e.DisplayName}),new Element("td",{class:"sort-by",html:e.StateName}),new Element("td",{class:"sort-by",html:e.CompletedBy}),new Element("td",{class:"ui-inbox-date sort-by ui-format-date",html:e.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),new Element("td",{class:"ui-inbox-actions buttons",html:'<a href="'+this.options.viewUrl+"/"+e.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.view+"</span>"+this.labels.view+"</span></a>"})).inject(this.completedBox.getElement("tbody")))}.bind(this)),this.completedBox.getElements(".checking").destroy()),Affinity.uiFormatDate.processNew(),t=this.completedBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(t),Affinity.uiGrid&&Affinity.uiGrid.zebra(t),this.lastdata.Completed=e.data.Completed),delete t),window.fireEvent("ResizeFrame")},selectInbox:function(e){var t=this.inbox.getElements(".ui-inbox-labels ul li").indexOf(e.menuItem);this.boxCookie=Cookie.write("uiInboxIndex",t,{duration:this.options.expireTabCookie?1/24/60*this.options.expireTabMins:1}),this.tabIndex=t,window.fireEvent("ResizeFrame")},deleteForm:function(e){var t=e.target.hasClass("button")?e.target:e.target.getParent(".button"),i=t.get("data-delete-action"),n=t.getParent("tr"),s=this.labels.delete,o=this.labels.deleting;uiconfirm({message:s,onOk:function(){window.uialert({message:o,showLoader:!0,noClose:!0}),new CFRequest({method:"post",url:i,onSuccess:function(){Affinity.prompts.hide(),n.destroy(),Affinity.uiGrid.zebra(),Affinity.uiInbox.refresh()}}).send()}})},startNewForm:function(){if(Affinity.modal.setElement(document.getElement(".start-template").clone().removeClass("hidden")),Affinity.modal.modalbody.getElement(".cancel").addEvent(Affinity.events.click,(function(){Affinity.modal.hide()})),Affinity.modal.modalbody.getElement(".start").addEvent(Affinity.events.click,(function(){Affinity.modal.modalbody.getElement(".start").addClass("hidden"),new Element("img",{src:document.config.loaders.light,style:"display: inline-block; margin-right:20px;"}).inject(Affinity.modal.modalbody.getElement(".start"),"after")})),Affinity.modal.scroll.disable(),Affinity.modal.close.disable(),Affinity.modal.show(),Affinity.modal.modalbody.getElement(".do-autocomplete")){var e=Affinity.modal.modalbody.getElement(".do-autocomplete");e.removeClass("do-autocomplete");var t=new UIAutoCompleteWidget({selectElement:e,onComplete:function(){t.displayElement.focus()}})}},formSelected:function(){document.getElement(".content select").selectedIndex=Affinity.modal.modalbody.getElement("select").selectedIndex,Affinity.modal.hide()}}),CFMulitFileUploaders=new Class({Implements:[Options,Events],Binds:["fileAdded","fileDeleted","fileDefaultsLoaded","fileAddedComplete","fileTooLarge","deleteNotSaved"],options:{instanceId:null,addApi:"/document/Add",deleteApi:"/document/Delete",getNamesApi:"/document/GetFileIdNamePairs",downloadFileApi:"/document/Download"},initialize:function(e){this.setOptions(e),this.deleteMessage="Deleting File. Please wait...",window.addEvent("multiFileAdded",this.fileAdded),window.addEvent("multiFileTooLarge",this.fileTooLarge),window.addEvent("multiFileDeleted",this.fileDeleted),window.addEvent("multiFileDefaults",this.fileDefaultsLoaded)},fileTooLarge:function(e){var t=(e.maxsize/1024/1024).round(2),i=(e.size/1024/1024).round(2);window.uialert({message:"This file is too large. The maximum size is "+t+"MB and this file is "+i+"MB."})},fileAdded:function(e){},fileDefaultsLoaded:function(e){this.table=e.table,new CFRequest.JSON({url:this.options.getNamesApi,onSuccess:function(t){var i=t;"string"==typeOf(i)&&(i=JSON.parse(i)),Array.each(e.table.getElements("tbody tr"),function(e){i.data[e.retrieve("fileId")]&&(e.getElement("td").set("html",i.data[e.retrieve("fileId")]),e.store("dowloadUrl",this.options.downloadFileApi))}.bind(this)),""!=this.options.deleteApi&&null!=this.options.deleteApi||(Array.each(e.table.getElements("tbody tr"),(function(e){e.getElements("td").getLast().destroy()})),Array.each(e.table.getElements("thead tr"),(function(e){e.getElements("th").getLast().destroy()}))),""!=this.options.addApi&&null!=this.options.addApi||e.table.getParent(".uploadmulti").getElement(".button.green").destroy()}.bind(this)}).post({fileIds:e.initialValues})},fileDeleted:function(e){window.uialert({message:this.deleteMessage,noClose:!0}),this.table=e.table,new CFRequest.JSON({url:this.options.deleteApi,onSuccess:function(t){this.posting=!1,Affinity.prompts.hide(),t.Success?e.row&&e.row.destroy():window.uialert({message:"You are not allowed to delete this file."})}}).post({fileId:e.deletedId,questionName:e.questionName,instanceId:this.options.instanceId,isAuto:!1})}}),CFNameCreator=new Class({Implements:[Options],Binds:["createName"],options:{nameInput:null,fromInput:null,maxLength:64,suffix:"",extraEntropy:!1,camelCase:!0,onComplete:function(){}},initialize:function(e){this.setOptions(e),this.options.nameInput&&""==this.options.nameInput.value&&(this.options.fromInput.addEvent("keyup",this.createName),this.options.fromInput.addEvent("blur",this.createName))},createName:function(){var e=this.options.maxLength;e-=8;var t=this.options.fromInput.value.replace(/[^\w\d ]/g,"").trim();t=t.length>e?t.lastIndexOf(" ",e)>-1?t.substring(0,t.lastIndexOf(" ",e)):t.substring(0,e):t,t+=this.options.suffix,t=this.options.camelCase?t.replace(/(?:^\w|[A-Z]|\b\w)/g,(function(e,t){return 0==t?e.toLowerCase():e.toUpperCase()})).replace(/\s+/g,"").trim():t.replace(/\s+/g,"").trim(),this.options.extraEntropy&&(t+="_"+String.uniqueID()+"_"+(new Date).getTime()),this.options.nameInput.value=t,this.options.onComplete(t)}}),CFTemplateBase=new Class({Implements:[Options],Binds:["killPopup","initted","toggleExample","validationFailed","postForm","postSuccess","postError"],options:{templateCssClass:null,autoGenerateName:!0,nativePost:!1},popupElement:null,form:null,formMethod:null,formAction:null,callerItem:null,section:null,initialize:function(e){if(this.setOptions(e),null!=this.options.templateCssClass)if(document.callerElement)if(this.popupElement=document.getElement(".question-content."+this.options.templateCssClass),this.popupElement)if(this.popupElement.getParent("form")){if(this.form=this.popupElement.getParent("form"),this.formMethod=this.form.get("method").toLowerCase(),this.formAction=this.form.get("action"),this.options.nativePost?this.form.adopt(new Element("input",{type:"hidden",name:"ReturnPath",value:"referrer"})):(this.formPost=new CFRequest({url:this.formAction,method:this.formMethod,onSuccess:this.postSuccess,onError:this.postError,onFailure:this.postError}),this.formPost.setHeader("Accept","Accept:text/javascript, text/html, application/xml, text/xml, */*"),this.form.adopt(new Element("input",{type:"hidden",name:"ReturnPath",value:"default"}))),this.callerItem=document.callerElement,this.section=this.callerItem.getParents(".form-section")[0],this.creating=this.formAction.toLowerCase().indexOf("create")>-1,this.form.getElement(".cancel")&&this.form.getElement(".cancel").addEvent("click",function(e){e.preventDefault(),Affinity.modal.hide(),this.creating&&this.callerItem&&(document.getElement("#availableFormItems .master-"+this.callerItem.get("data-type").toLowerCase().trim()).removeClass("disabled"),this.callerItem.destroy())}.bind(this)),this.save=this.form.getElement("button.save"),this.cancel=this.form.getElement("button.cancel"),this.loader=new Element("div",{class:"loader hidden"}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'}),new Element("span",{html:"Saving..."})).inject(this.cancel,"after"),this.save.addEvent(Affinity.events.click,function(){this.save.addClass("hidden"),this.cancel.addClass("hidden"),this.loader.removeClass("hidden")}.bind(this)),this.section&&(this.form.getElement("#hiddenSectionName").value=this.section.get("data-item-name")),this.form.getElement(".hideshowpreview")&&(this.form.getElement(".hideshowpreview").addEvent(Affinity.events.click,this.toggleExample),this.exampleFx=new Fx.Reveal(this.form.getElement(".preview"),{duration:250,mode:"vertical"}),this.form.getElement(".preview").setStyle("display","none"),this.form.getElement(".preview").removeClass("hidden")),this.options.autoGenerateName){var t="";this.options.templateCssClass.test("fielddisplay","gi")&&(t="-display"),this.options.templateCssClass.test("fieldedit","gi")&&(t="-edit"),new CFNameCreator({nameInput:this.form.getElement("#name"),fromInput:this.form.getElements("#text,#shorttext,#title")[0],suffix:t})}new UIFormValidation({target:this.form,onValidateCallback:this.postForm,onValidateFailCallback:this.validationFailed}),this.form&&this.save&&this.save.removeClass("hidden"),this.initted()}else this.killPopup('You can not use this component in this form.\r\n\x3c!--\r\nFound no form in popup content with class "question-content '+this.options.templateCssClass+'".\r\nPlease check Requests for 500 errors fetching element content.\r\n--\x3e');else this.killPopup('You can not use this component in this form.\r\n\x3c!--\r\nFound no popup content with class "question-content '+this.options.templateCssClass+'".\r\nPlease check Requests for 500 errors fetching element content.\r\n--\x3e');else this.killPopup("There was an error adding this element type to the form.\r\n\x3c!--\r\nNo selected item was specified (document.callerElement).\r\n--\x3e");else this.killPopup("There was an error adding this element type to the form.\r\n\x3c!--\r\nNo templateCssClass was specified.\r\n--\x3e")},killPopup:function(e){uialert({message:e,showButtons:!0,noClose:!1}),document.callerElement&&"element"===typeOf(document.callerElement)&&document.callerElement.destroy(),Affinity.modal.clear(),Affinity.modal.hide()},initted:function(){},toggleExample:function(e){e.preventDefault(),this.exampleFx.toggle();var t=document.getElement("#preview-toggle-icon");t.hasClass("icon-arrow-line-down")?(t.addClass("icon-arrow-line-up"),t.removeClass("icon-arrow-line-down")):t.hasClass("icon-arrow-line-up")&&(t.addClass("icon-arrow-line-down"),t.removeClass("icon-arrow-line-up"))},validationFailed:function(){this.save.removeClass("hidden"),this.cancel.removeClass("hidden"),this.loader.addClass("hidden")},postForm:function(){var e={},t=this.form.getElements("input,select,textarea");Array.each(t,function(t,i){if(t.get("name"))if("checkbox"==t.get("type"))e[t.get("name")]=t.checked;else if("radio"==t.get("type")){var n=this.form.getElements("input[name="+t.get("name")+"]"),s=null;Array.each(n,function(e,t){e.checked&&(s=e)}.bind(this)),null!==s&&(e[s.get("name")]=s.value)}else e[t.get("name")]=t.value}.bind(this)),void 0!==e.type&&("FieldEdit"===e.type&&e.name.lastIndexOf("_")!==e.name.length-1?e.name=e.name+"_":"FieldEdit"!==e.type&&"FieldDisplay"!==e.type&&e.name.lastIndexOf("_")!==e.name.length-1&&(e.name=e.name+String.uniqueID()+"_")),this.name=e.name,this.options.nativePost?(this.form.getElement("#name").value=this.name,this.form.submit()):"get"==this.formMethod?this.formPost.get(e):this.formPost.post(e),delete e},postSuccess:function(e){this.form.getElement("#title")?(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#title").value),this.form.getElement("#title").value):this.form.getElement("#shorttext")?(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#shorttext").value),this.form.getElement("#shorttext").value):this.form.getElement("#text")&&(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#text").value),this.form.getElement("#text").value),this.callerItem.set("data-item-name",this.name),this.loader.addClass("hidden"),Affinity.modal.hide()},postError:function(e){var t=!1,i="Something went wrong. This is most likely due to a naming conflict. Try changing the 'short display text'.";if("string"==typeOf(e.response))try{t=JSON.decode(e.response)}catch(e){}else if("string"==typeOf(e.responseText))try{t=JSON.decode(e.responseText)}catch(e){}"string"==typeOf(t.message)&&""!==t.message&&(i=t.message),"string"==typeOf(t.systemMessage)&&""!==t.systemMessage&&(i=t.systemMessage),window.uialert({message:i}),this.save.removeClass("hidden"),this.cancel.removeClass("hidden"),this.loader.addClass("hidden")}});window.cfTemplateTypes={},window.addEvent("TemplateReady",(function(e){null!==window.cfTemplateTypes[e.type]&&"class"===typeOf(window.cfTemplateTypes[e.type].object)&&(window.cfCurrentTemplateObject=new window.cfTemplateTypes[e.type].object({templateCssClass:window.cfTemplateTypes[e.type].name}),Affinity.tooltips.processNew())}));var CFindex=new Class({Implements:[Options,Events],Binds:["archiveClicked","archiveDeleteClicked","undoArchiveClicked"],Options:{nameMaxLength:100},initialize:function(e){this.setOptions(e),Array.each(document.getElements(".button.archive"),function(e){e.addEvent(Affinity.events.click,this.archiveClicked)}.bind(this)),Array.each(document.getElements(".button.archivedelete"),function(e){e.addEvent(Affinity.events.click,this.archiveDeleteClicked)}.bind(this)),Array.each(document.getElements(".button.undoarchive"),function(e){e.addEvent(Affinity.events.click,this.undoArchiveClicked)}.bind(this));var t=!1;Array.each(document.getElements("table .form-desc"),function(e){var i=e.get("html");i.length>this.options.nameMaxLength&&(e.set("data-tooltip",i),e.set("data-tooltip-dir","top"),e.set("html",i.substr(0,30)+" ..."),e.addClass("ui-has-tooltip"),t=!0)}.bind(this)),t&&Affinity.tooltips.processNew(),Array.each(document.getElements("table .form-workflow"),function(e){var t=e.get("html");""==t?e.set("html","No Workflow"):e.set("html",t.split(",").join(", "))}.bind(this)),document.getElements(".button.locked").addEvent(Affinity.events.click,this.unlock);var i=Affinity.CookieMonster.Read("undo-archive")||!1;i&&(Affinity.CookieMonster.Delete("undo-archive"),document.id(i)&&window.scrollTo(0,document.id(i).getPosition().y)),window.fireEvent("ResizeFrame")},unlock:function(e){if(e.control){var t=e.target.getParent("tr");if(t){var i=t.getElement(".button.locked"),n=t.getElement(".button.archive");i&&n&&(i.addClass("hidden"),n.removeClass("hidden"),function(){n.addClass("hidden"),i.removeClass("hidden")}.delay(2e3))}}},archiveClicked:function(e){uiconfirm({message:"Are you sure you would like to archive this form?",onOk:function(){var t=e.target.hasClass("button")?e.target:e.target.getParent(".button"),i=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-templateId")}).inject(i),i.submit()}.bind(this)})},undoArchiveClicked:function(e){var t=e.target.hasClass("button")?e.target:e.target.getParent(".button"),i=t.getParent(),n=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(i,"bottom");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-templateId")}).inject(n),uialert({message:"Restoring...",showLoader:!0,showButtons:!1}),Affinity.CookieMonster.Write("undo-archive",t.get("data-templateId")),n.submit()},archiveDeleteClicked:function(e){uiconfirm({message:"Are you sure you would like to delete this archived form?",onOk:function(){var t=e.target.hasClass("button")?e.target:e.target.getParent(".button"),i=new Element("form",{action:t.get("data-delete-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-delete-id")}).inject(i),i.submit()}.bind(this)})}}),CFInit=new Class({Implements:[Options,Events],Binds:["init"],Options:{},isProperBrowser:!0,parentWindow:null,initialize:function(e){this.setOptions(e),Browser.ie&&Browser.version<8&&(this.isProperBrowser=!1),this.isProperBrowser&&(this.parentWindow=window.parent.document)}});window.addEvent("PageReady",(function(){document.cwInit=new CFInit})),function(){var e=function(e,t){"401 Unauthorized"==e?window.location.href="/Authentication/SignOut":t.parent(e)};window.CFRequest=new Class({Extends:Request,success:function(t){e(t,this)},failure:function(t){e(t,this)}}),CFRequest.HTML=new Class({Extends:Request.HTML,success:function(t){e(t,this)},failure:function(t){e(t,this)}}),CFRequest.JSON=new Class({Extends:Request.JSON,success:function(t){e(t,this)},failure:function(t){e(t,this)}}),CFRequest.JSONP=new Class({Extends:Request.JSON,success:function(t){e(t,this)},failure:function(t){e(t,this)}})}();var CFTemplateAddress=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e),Affinity.address.processNew()}});window.cfTemplateTypes.address={name:"address",objectname:"CFTemplateAddress",object:CFTemplateAddress};var CFTemplateAttachInstructions=new Class({Extends:CFTemplateBase,Implements:[Options],options:{nativePost:!0},initialize:function(e){this.parent(e)},initted:function(){new UIUplaoders}});window.cfTemplateTypes.attachinstructions={name:"attachinstructions",objectname:"CFTemplateAttachInstructions",object:CFTemplateAttachInstructions};var CFTemplateBankNumber=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e),Affinity.banknumber.processNew()}});window.cfTemplateTypes.banknumber={name:"banknumber",objectname:"CFTemplateBankNumber",object:CFTemplateBankNumber};var CFTemplateCheckbox=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.checkbox={name:"checkbox",objectname:"CFTemplateCheckbox",object:CFTemplateCheckbox};var CFTemplateContentsTable=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){}});window.cfTemplateTypes.contentstable={name:"contentstable",objectname:"CFTemplateContentsTable",object:CFTemplateContentsTable};var CFTemplateCurrency=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.currency={name:"currency",objectname:"CFTemplateCurrency",object:CFTemplateCurrency};var CFTemplateDatePicker=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){new UIDateCalendar({dateMooFormat:"%d.%m.%Y"}),document.id("showcalendar").addEvent(Affinity.events.click,this.setDateTimeType.bind(this)),document.id("showtime").addEvent(Affinity.events.click,this.setDateTimeType.bind(this)),document.id("setdefault").addEvent(Affinity.events.click,this.doSetDefaultValue.bind(this)),this.doSetDefaultValue()},setDateTimeType:function(){var e="";document.id("showcalendar").checked&&(e+="date"),document.id("showtime").checked&&(e+="time"),""==e&&(e="date",document.id("showcalendar").checked=!0),document.id("DateTimeType").value=e},doSetDefaultValue:function(e){document.id("setdefault").checked?document.id("SetDefaultvalue").value="true":document.id("SetDefaultvalue").value="false"}});window.cfTemplateTypes.date={name:"date",objectname:"CFTemplateDatePicker",object:CFTemplateDatePicker};var CFTemplateDrawPanel=new Class({Extends:CFTemplateBase,options:{nativePost:!0},initialize:function(e){this.parent(e),Affinity.uiDrawPanels.processNew()},initted:function(){new UIUplaoders}});window.cfTemplateTypes.drawpanel={name:"drawpanel",objectname:"CFTemplateDrawPanel",object:CFTemplateDrawPanel};var CFTemplateEffectiveDate=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e),Affinity.uiDateCalendar.processNew()}});window.cfTemplateTypes.effectivedate={name:"effectivedate",objectname:"CFTemplateEffectiveDate",object:CFTemplateEffectiveDate};var CFTemplateEmail=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.email={name:"email",objectname:"CFTemplateEmail",object:CFTemplateEmail};var CFTemplateExplanation=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){this.form.getElement("select")&&this.form.getElement(".helpBubble.explain")&&this.form.getElement("select").addEvent("change",(function(){this.form.getElement(".helpBubble.explain").removeClass("top"),this.form.getElement(".helpBubble.explain").removeClass("left"),this.form.getElement(".helpBubble.explain").removeClass("bottom"),this.form.getElement(".helpBubble.explain").removeClass("right"),"none"!=this.form.getElement("select").value&&this.form.getElement(".helpBubble.explain").addClass(this.form.getElement("select").value)}))}});window.cfTemplateTypes.explanation={name:"explanation",objectname:"CFTemplateExplanation",object:CFTemplateExplanation};var CFTemplateFielddisplay=new Class({Extends:CFTemplateBase,Binds:["populateFieldDisplayFields","getFieldEditFields","setFieldName"],options:{autoGenerateName:!0},area:null,category:null,initialize:function(e){this.parent(e)},initted:function(){this.area=document.area,this.category=document.category,this.fieldDisplayFieldsLoader=document.id("fieldDisplayFieldsLoader"),new Element("span",{html:'<img src="'+document.config.loaders.light+'" />'}).inject(this.fieldDisplayFieldsLoader),this.fieldDisplayFields=document.id("fieldDisplayFields"),this.fieldDisplayFields.addClass("hidden"),this.fieldDisplayFields.addEvent("change",this.setFieldName),this.getDisplayFieldsRequest=new CFRequest.JSON({url:this.fieldDisplayFields.get("data-lookup-method")+"?area="+this.area+"&category="+this.category+"&parameter=",onSuccess:this.populateFieldDisplayFields}).send()},keywordDict:{Double:"float number (allows decimals and comas)",Float:"float number (allows decimals and comas)",DateTime:"date",Int:"int number (no decimals)",Lookup:"dropdown box of choices"},getKeyword:function(e){return this.keywordDict[e]?this.keywordDict[e]:e},populateFieldDisplayFields:function(e){if(e.error){this.fieldDisplayFieldsLoader.destroy();var t;return t=e.error.test(/.*area.*category.*not found/)?"The area and category were not found. Please try again.\x3c!--"+e.error+"--\x3e":"We could not fetch the required values. Please try again.\x3c!--"+e.error+"--\x3e",void uialert({message:t})}var i,n,s,o=this.fieldDisplayFields.get("data-default-value");Array.each(e.Properties,function(e){(i=[]).push(e.PropertyName?e.PropertyName:""),i.push(e.ModelName?e.ModelName:","),i.push(e.Attribute.PropertyType?e.Attribute.PropertyType:""),i.push(e.Attribute.DataType?e.Attribute.DataType:""),i.push(e.Attribute.FieldDecimal?e.Attribute.FieldDecimal:""),i.push(e.Attribute.FieldPrecision?e.Attribute.FieldPrecision:""),n=i.join(","),s=new Element("option",{value:n,html:e.DisplayLabel+" ("+e.PropertyName+" from "+e.ModelName+")"}),""!==o&&""!==n&&0===n.indexOf(o)&&s.set("selected","selected"),this.fieldDisplayFields.adopt(s)}.bind(this)),e.Properties.length>20&&"class"==typeOf(UIAutoComplete)&&(this.fieldDisplayFields.addClass("ui-autocomplete"),Affinity.uiAutoComplete.processNew()),this.fieldDisplayFields.removeClass("hidden"),this.fieldDisplayFieldsLoader.destroy(),this.setFieldName(null),delete i,delete n,delete s},setFieldName:function(e){if(""!=this.fieldDisplayFields.value){var t=this.fieldDisplayFields.value.split(",");this.form.getElement("#name").value=t[0],this.form.getElement("#FieldName").value=t[0],this.form.getElement("#ModelName").value=t[1],this.form.getElement("#PropertyType").value=t[2],this.form.getElement("#DataType").value=t[3],this.form.getElement("#FieldDecimal").value=t[4],this.form.getElement("#FieldPrecision").value=t[5],delete t}}});window.cfTemplateTypes.fielddisplay={name:"fielddisplay",objectname:"CFTemplateFielddisplay",object:CFTemplateFielddisplay};var CFTemplateFieldEdit=new Class({Extends:CFTemplateBase,Binds:["populateFieldEditTables","getFieldEditFields","setFieldName"],options:{autoGenerateName:!1},area:null,category:null,initialize:function(e){this.parent(e)},initted:function(){this.area=document.area,this.category=document.category,this.explainBox=this.form.getElement(".explaination"),this.fieldEditFieldsLoader=document.id("fieldEditFieldsLoader"),new Element("span",{html:'<img src="'+document.config.loaders.light+'" />'}).inject(this.fieldEditFieldsLoader),this.fieldEditFields=document.id("fieldEditFields"),this.fieldEditFields.addClass("hidden"),this.fieldEditFields.addEvent("change",this.setFieldName),this.getTablesRequest=new CFRequest.JSON({url:this.fieldEditFields.get("data-lookup-method")+"?area="+this.area+"&category="+this.category+"&parameter=editable",onSuccess:this.populateFieldEditTables}).send()},keywordDict:{Double:"float number (allows decimals and comas)",Float:"float number (allows decimals and comas)",DateTime:"date",Int:"int number (no decimals)",Lookup:"dropdown box of choices",BankNumber:"set of bank number fields",Address:"set of address fields with Google Address lookup"},getKeyword:function(e){return this.keywordDict[e]?this.keywordDict[e]:e},populateFieldEditTables:function(e){if(e.error)return this.fieldEditFieldsLoader.destroy(),void uialert({message:"We could not fetch the required values. Please try again.\x3c!--"+e.error+"--\x3e"});var t,i,n,s=this.fieldEditFields.get("data-default-value");Array.each(e.Properties,function(e){(t=[]).push(e.PropertyName?e.PropertyName:""),t.push(e.ModelName?e.ModelName:","),t.push(e.Attribute.PropertyType?e.Attribute.PropertyType:""),t.push(e.Attribute.MinValue?e.Attribute.MinValue:""),t.push(e.Attribute.MaxValue?e.Attribute.MaxValue:""),t.push(e.Attribute.MinLength?e.Attribute.MinLength:""),t.push(e.Attribute.MaxLength?e.Attribute.MaxLength:""),t.push(e.Attribute.IsRequired?e.Attribute.IsRequired:""),t.push(e.Attribute.DataType?e.Attribute.DataType:""),t.push(e.Attribute.IsKeyField?e.Attribute.IsKeyField:""),t.push(e.Attribute.FieldDecimal?e.Attribute.FieldDecimal:""),t.push(e.Attribute.FieldPrecision?e.Attribute.FieldPrecision:""),i=t.join(","),n=new Element("option",{value:i,html:e.DisplayLabel+" ("+e.PropertyName+" from "+e.ModelName+")"}),""!==s&&""!==i&&0===i.indexOf(s)&&n.set("selected","selected"),this.fieldEditFields.adopt(n)}.bind(this)),this.fieldEditFields.removeClass("hidden"),this.fieldEditFieldsLoader.destroy(),e.Properties.length>20&&"class"==typeOf(UIAutoComplete)&&(this.fieldEditFields.addClass("ui-autocomplete"),Affinity.uiAutoComplete.processNew()),this.setFieldName(null),delete t,delete i,delete n},setExplaination:function(){var e="";"true"===this.form.getElement("#IsRequired").value?(this.form.getElement("#required").set("checked","checked"),this.form.getElement("#required").set("disabled","disabled"),e+="This field must have a value and has been set as required above.<br /><br />"):this.form.getElement("#required").erase("disabled"),e+="This field will be displayed as a "+this.getKeyword(this.form.getElement("#PropertyType").value)+".",this.explainBox.set("html",e)},setFieldName:function(e){if(this.explainBox.set("html",""),""!=this.fieldEditFields.value){var t=this.fieldEditFields.value.split(",");this.form.getElement("#name").value=t[0],this.form.getElement("#FieldName").value=t[0],this.form.getElement("#ModelName").value=t[1],this.form.getElement("#PropertyType").value=t[2],this.form.getElement("#MinValue").value=t[3],this.form.getElement("#MaxValue").value=t[4],this.form.getElement("#MinLength").value=t[5],this.form.getElement("#MaxLength").value=t[6],this.form.getElement("#IsRequired").value=t[7]||t[9]||!1,this.form.getElement("#DataType").value=t[8],this.form.getElement("#FieldDecimal").value=t[10],this.form.getElement("#FieldPrecision").value=t[11],this.setExplaination(),delete t}}});window.cfTemplateTypes.fieldedit={name:"fieldedit",objectname:"CFTemplateFieldEdit",object:CFTemplateFieldEdit};var CFTemplateFileUpload=new Class({Extends:CFTemplateBase,Binds:["loadDropTwoValues","secondDropSuccess"],initialize:function(e){this.parent(e)},initted:function(){new UIUplaoders,this.dropOne=this.form.getElement("#DocumentCategory"),this.dropTwo=this.form.getElement("#DocumentType"),this.spinbox=new Element("div",{class:"formloader hidden",styles:{display:"inline-block",margin:"0 0 0 10px"}}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'})).inject(this.dropTwo,"after"),this.dropRequest=new CFRequest.JSON({url:this.dropOne.getAttribute("data-secondary-select-lookup"),method:null==this.dropOne.getAttribute("data-secondary-select-lookup-method")?"get":this.dropOne.getAttribute("data-secondary-select-lookup-method").toLowerCase(),onSuccess:this.secondDropSuccess,onError:function(e){},onFailure:function(e){}}),this.dropOne.addEvent("change",this.loadDropTwoValues),this.loadDropTwoValues(),Affinity.uiHidables.processTriggers()},loadDropTwoValues:function(e){this.dropTwo.addClass("hidden"),this.spinbox.removeClass("hidden"),"post"==this.dropRequest.options.method?this.dropRequest.post({DocumentCategory:this.dropOne.value}):this.dropRequest.get({DocumentCategory:this.dropOne.value})},secondDropSuccess:function(e){this.dropTwo.empty(),this.dropTwo.removeClass("hidden"),this.dropTwo.erase("disabled"),this.spinbox.addClass("hidden");var t="null"!=typeOf(this.dropOne.getAttribute("data-secondary-select-default"))?this.dropOne.getAttribute("data-secondary-select-default"):null;0==e.length?this.dropTwo.set("disabled","disabled"):(new Element("option",{value:"",html:"Any"}).inject(this.dropTwo),Array.each(e,function(e,i){option=new Element("option",{value:e.ID,html:e.Name}).inject(this.dropTwo),null!=t&&t==e.ID&&option.set("selected","selected")}.bind(this)))}});window.cfTemplateTypes.fileupload={name:"fileupload",objectname:"CFTemplateFileUpload",object:CFTemplateFileUpload};var CFTemplateFileUploadMulti=new Class({Extends:CFTemplateBase,Binds:["fileAdded","fileDeleted","loadDropTwoValues","secondDropSuccess"],initialize:function(e){this.parent(e)},initted:function(){new UIUplaodersMulti,this.dropOne=this.form.getElement("#DocumentCategory"),this.dropTwo=this.form.getElement("#DocumentType"),this.spinbox=new Element("div",{class:"formloader hidden",styles:{display:"inline-block",margin:"0 0 0 10px"}}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'})).inject(this.dropTwo,"after"),this.dropRequest=new CFRequest.JSON({url:this.dropOne.getAttribute("data-secondary-select-lookup"),method:null==this.dropOne.getAttribute("data-secondary-select-lookup-method")?"get":this.dropOne.getAttribute("data-secondary-select-lookup-method").toLowerCase(),onSuccess:this.secondDropSuccess,onError:function(e){},onFailure:function(e){}}),this.dropOne.addEvent("change",this.loadDropTwoValues),this.loadDropTwoValues(),Affinity.uiHidables.processTriggers()},loadDropTwoValues:function(e){this.dropTwo.addClass("hidden"),this.spinbox.removeClass("hidden"),"post"==this.dropRequest.options.method?this.dropRequest.post({DocumentCategory:this.dropOne.value}):this.dropRequest.get({DocumentCategory:this.dropOne.value})},secondDropSuccess:function(e){this.dropTwo.empty(),this.dropTwo.removeClass("hidden"),this.dropTwo.erase("disabled"),this.spinbox.addClass("hidden");var t="null"!=typeOf(this.dropOne.getAttribute("data-secondary-select-default"))?this.dropOne.getAttribute("data-secondary-select-default"):null;0==e.length?this.dropTwo.set("disabled","disabled"):(new Element("option",{value:"",html:"Any"}).inject(this.dropTwo),Array.each(e,function(e,i){option=new Element("option",{value:e.ID,html:e.Name}).inject(this.dropTwo),null!=t&&t==e.ID&&option.set("selected","selected")}.bind(this)))}});window.cfTemplateTypes.fileuploadmulti={name:"fileuploadmulti",objectname:"CFTemplateFileUploadMulti",object:CFTemplateFileUploadMulti};var CFTemplateFloat=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.float={name:"float",objectname:"CFTemplateFloat",object:CFTemplateFloat};var CFTemplateGridFields=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.gridfields={name:"gridfields",objectname:"CFTemplateGridFields",object:CFTemplateGridFields};var CFTemplateInteger=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.integer={name:"integer",objectname:"CFTemplateInteger",object:CFTemplateInteger};var CFTemplateLink=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.link={name:"link",objectname:"CFTemplateLink",object:CFTemplateLink};var CFTemplateMemo=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){Affinity.textAutoSize.processNew()}});window.cfTemplateTypes.memo={name:"memo",objectname:"CFTemplateMemo",object:CFTemplateMemo};var CFTemplateMultiselect=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){Affinity.uiDynamicGrid.init({container:this.form}),Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.multiselect={name:"multiselect",objectname:"CFTemplateMultiselect",object:CFTemplateMultiselect};var CFTemplateParagraph=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){}});window.cfTemplateTypes.paragraph={name:"paragraph",objectname:"CFTemplateParagraph",object:CFTemplateParagraph};var CFTemplateSection=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.formsection={name:"formsection",objectname:"CFTemplateSection",object:CFTemplateSection};var CFTemplateSeparator=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){""===this.form.getElement("#name").value&&(this.form.getElement("#name").value="seperator_"+String.uniqueID()+"_"+(new Date).getTime())}});window.cfTemplateTypes.separator={name:"separator",objectname:"CFTemplateSeparator",object:CFTemplateSeparator};var CFTemplateDropdown=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){Affinity.uiDynamicGrid.init(),Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.singleselectdropdown={name:"singleselectdropdown",objectname:"CFTemplateDropdown",object:CFTemplateDropdown};var CFTemplateRadioButton=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)},initted:function(){Affinity.uiDynamicGrid.init(),Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.singleselectradio={name:"singleselectradio",objectname:"CFTemplateRadioButton",object:CFTemplateRadioButton};var CFTemplateTaxNumber=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e),Affinity.taxnumber.processNew()}});window.cfTemplateTypes.taxnumber={name:"taxnumber",objectname:"CFTemplateTaxNumber",object:CFTemplateTaxNumber};var CFTemplateText=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.text={name:"text",objectname:"CFTemplateText",object:CFTemplateText};var CFTemplateTitle=new Class({Extends:CFTemplateBase,initialize:function(e){this.parent(e)}});window.cfTemplateTypes.title={name:"title",objectname:"CFTemplateTitle",object:CFTemplateTitle};var CFTemplateYoutube=new Class({Extends:CFTemplateBase,Binds:["processYoutubeId","returnYoutbeId","returnYoutubeEmbed","testEmbed"],initialize:function(e){this.parent(e)},youtubeWidth:446,youtubeHeight:251,initted:function(){document.id("youtubeUrl")&&document.id("testYoutubeEmbed")&&document.id("youtubeId")&&(document.id("youtubeUrl").addEvent("keyup",function(e){document.id("youtubeId").value=this.processYoutubeId(document.id("youtubeUrl"),document.id("testYoutubeEmbed"))}.bind(this)),""!=document.id("youtubeId").value&&(document.id("youtubeUrl").value="http://www.youtube.com/watch?v="+document.id("youtubeId").value,this.processYoutubeId(document.id("youtubeUrl"),document.id("testYoutubeEmbed"))))},processYoutubeId:function(e,t){var i=this.returnYoutbeId(e.value);if(i){var n=this.returnYoutubeEmbed(i);return this.testEmbed(t,n),i}return""},returnYoutbeId:function(e){if(""==e)return!1;var t=e.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return!!(t&&t[7].length>=11)&&t[7]},returnYoutubeEmbed:function(e){return new Element("iframe",{width:this.youtubeWidth,height:this.youtubeHeight,src:"//www.youtube.com/embed/"+e+"?autoplay=0&controls=1&rel=0&showinfo=0&theme=light&modestbranding=1",frameborder:0,allowfullscreen:!1})},testEmbed:function(e,t){e.empty(),e.adopt(t)}});function ZelosError(e){this.name="ZelosError",this.message=e||""}window.cfTemplateTypes.video={name:"video",objectname:"CFTemplateYoutube",object:CFTemplateYoutube},Affinity.Components=Affinity.Components||{},Affinity.Components.ZelosInit={Version:"1.0.0.0",Name:"Zelos Init",File:"ui.zelos.init.js",Jira:""},!1 in window&&(window.Affinity={}),Affinity.zelos={},Affinity.zelos.Elements={},ZelosError.prototype=Error.prototype;var ZelosInit=new Class({Implements:[Options,Events],Binds:["loadHtmlTemplate","htmlTemplateLoadError","htmlTemplayeLoaded"],options:{htmlTemplateUrl:"/Content/html/ZelosHtmlTemplates.html",requiredUiComponenets:["UITabs","UIGrid","UIHelpBubble","UIHelpIcon","UITooltips","UIDrawPanels","UIModal","UIPompts","UISelectLookup","UIUplaodersMulti","UIDateCalendar","UIValidation","UIHidables"],requiredZelosComponenets:["ZelosTemplateLoad","ZelosTemplateProcess"]},initialize:function(e){this.setOptions(e);var t=this.options.requiredUiComponenets.combine(this.options.requiredZelosComponenets),i=[];if(Array.each(t,(function(e){"class"!=typeOf(window[e])&&i.push(e)})),i.length>0)throw new ZelosError("There are components missing that are required for Zelos to run:\n"+i.join("\n")+"\nPlease refer to 'Setting up Zelos UI' in documentation.");delete t,delete i,Affinity.zelos.getElement=this.getElement,Affinity.zelos.getElementFromData=this.getElementFromData,this.loadHtmlTemplate()},loadHtmlTemplate:function(){this.fireEvent("request",mybasepath+this.options.htmlTemplateUrl),new Request.HTML({url:mybasepath+this.options.htmlTemplateUrl,evalScripts:!1,onFailure:this.htmlTemplateLoadError,onError:this.htmlTemplateLoadError,onSuccess:this.htmlTemplayeLoaded}).get()},htmlTemplateLoadError:function(){ga&&ga("send","event","Zelos","HtmlTemplate","load failed ("+mybasepath+this.options.htmlTemplateUrl+")"),Affinity.prompts.hide(),this.fireEvent("error",'"'+mybasepath+this.options.htmlTemplateUrl+'" must exist in your project.')},htmlTemplayeLoaded:function(e){Array.each(e,(function(e){"element"!=typeOf(e)&&"table"!=typeOf(e)||e.get("data-form-element")&&""!=e.get("data-form-element")&&(e.hasClass("get-tr")?Affinity.zelos.Elements[e.get("data-form-element")]=e.getElement("tr"):Affinity.zelos.Elements[e.get("data-form-element")]=e)})),this.fireEvent("complete")},setTemplateElement:function(e,t){Affinity.zelos.Elements[e]=t},getElement:function(e){return!!Affinity.zelos.Elements[e]&&Affinity.zelos.Elements[e].clone()},getElementFromData:function(e){if("null"!==typeOf(e)){var t=e.ElementType?e.ElementType:e.InputType;if(e.ElementType,"class"===typeOf(Affinity.zelos.Elements[t]))return Affinity.zelos.Elements[t];if("FieldEdit"==e.ElementType||"FieldDisplay"==e.ElementType)return"Currency"===e.InputType&&Affinity.zelos.Elements.CurrencyInput?Affinity.zelos.Elements.CurrencyInput.clone():Affinity.zelos.Elements[t].clone();if(Affinity.zelos.Elements[t])return Affinity.zelos.Elements[t].clone()}return!1}});!function(e,t,i,n,s,o,a){e.GoogleAnalyticsObject="ga",e.ga=e.ga||function(){(e.ga.q=e.ga.q||[]).push(arguments)},e.ga.l=1*new Date,o=t.createElement(i),a=t.getElementsByTagName(i)[0],o.async=1,o.src="//www.google-analytics.com/analytics.js",a.parentNode.insertBefore(o,a)}(window,document,"script"),ga("create","UA-45869305-1","teampayoffice.com"),ga("create","UA-45869305-1",{cookieDomain:"none"}),ga("send","pageview"),Affinity.Components=Affinity.Components||{},Affinity.Components.ZelosTemplateLoad={Version:"1.0.0.0",Name:"Zelos Template Load",File:"ui.zelos.template.load.js",Jira:""};var ZelosTemplateLoad=new Class({Implements:[Options,Events],Binds:["loadTemplate","templateLoaded","loadFailed","cancel"],options:{},initialize:function(e){this.setOptions(e);var t=new Date;log("&#x2794; attempting ZelosLoader template load (0) ..."),this.formTemplateRequest=new Request.JSON({method:"get",timeout:12e4,onRequest:function(){log("&#x2794; ZelosLoader template load requested ("+t.elapsed()+") - "+this.logUrl+" ...",{color:"blue"}),this.fireEvent("request",this.formTemplateRequest.options.url)}.bind(this),onFailure:function(e){var i="";switch(e.status){case 401:i="Api unauthorized.";break;case 404:i="API path not found.";break;case 500:var n;try{n=JSON.decode(e.responseText)}catch(t){n=!1,i=e.responseText}n&&(i=n.error?n.error:e.responseText),delete n;break;default:i=e.statusText}i.contains(401)||i.toLowerCase().contains("unauthorized")?(log("&#x270B; attempted ZelosLoader template load unauthorized &#x270B;",{color:"red"}),window.fireEvent("unauthorized"),this.loadFailed(i)):(log("&#x2718; attempted ZelosLoader template load failed ("+t.elapsed()+") - "+this.logUrl+" - "+i,{color:"red"}),this.loadFailed(i)),delete i}.bind(this),onError:function(e,i){log("&#x2718; attempted ZelosLoader template load failed with errors ("+t.elapsed()+") - "+this.logUrl+" - "+e,{color:"red"}),this.loadFailed(e)}.bind(this),onException:function(e,i){log("&#x2718; attempted ZelosLoader template load failed with exception ("+t.elapsed()+") - "+this.logUrl+" - "+e+": "+i,{color:"red"}),this.loadFailed("Exception on "+e+": "+i)}.bind(this),onTimeout:function(){log("&#x2718; attempted ZelosLoader template load timed out ("+t.elapsed()+") - "+this.logUrl,{color:"red"}),this.loadFailed("Load reached timeout limit.")}.bind(this),onSuccess:function(e){JSON.Unauthorized(e,"Zelos Loader, initialize - "+this.formTemplateRequest.url)||(e.error?"object"===typeOf(e.error)?(log("&#x2718; attempted ZelosLoader template load succeeded with errors ("+t.elapsed()+") - "+this.logUrl+" - "+JSON.stringify(e.error),{color:"red"}),this.loadFailed(JSON.stringify(e.error))):(log("&#x2718; attempted ZelosLoader template load succeeded with errors ("+t.elapsed()+") - "+this.logUrl+" - "+e.error.split("\r\n").join(", "),{color:"red"}),this.loadFailed(e.error.split("\r\n").join("<br />"))):(log("&#x2714; attempted ZelosLoader template load succeeded ("+t.elapsed()+") - "+this.logUrl,{color:"green"}),this.templateLoaded(e)))}.bind(this)})},attemptUrl:"no url set",loadFailed:function(e){this.formTemplateRequest.isRunning()&&this.formTemplateRequest.cancel(),this.fireEvent("error",e),ga&&ga("send","event","Zelos","FormTemplate","load failed ("+this.attemptUrl+")")},loadTemplate:function(e){this.attemptUrl=e,this.attemptUrl.contains("ran")||(this.attemptUrl=Affinity.GetCacheSafePath(this.attemptUrl)),this.formTemplateRequest.url=this.formTemplateRequest.options.url=this.attemptUrl,this.formTemplateRequest.send()},templateLoaded:function(e){"boolean"===typeOf(e.success)&&!1===e.success?this.loadFailed():(this.template=e,this.fireEvent("complete",this.template),ga&&ga("send","event","Zelos","FormTemplate","From Loaded ("+this.attemptUrl+")"))},isRunning:function(){return!(!this.formTemplateRequest||!this.formTemplateRequest.isRunning())},cancel:function(){this.formTemplateRequest&&this.formTemplateRequest.isRunning()&&this.formTemplateRequest.cancel(),this.fireEvent("cancel","Form was canceled.")},destroy:function(){}});Affinity.Components=Affinity.Components||{},Affinity.Components.ZelosTemplateProcess={Version:"1.0.1.1",Name:"Zelos Template Process",File:"ui.zelos.template.process.js",Jira:"Add autocomplete to off on fields and forms"};var ZelosTemplateProcess=new Class({Implements:[Options,Events],Binds:["processTemplate","writeField","readField","readDirectValue","submit","cancel","cancelForm","validationFailed","onPost","updateDocument","sanatisePostJson","validationPassed","postFailed","postSuccess","getLookupDependancies","setLookupDependancies","processChild"],options:{getApi:null,putApi:null,getEmptyTimesheetApi:null,insertAddTimesheetForm:!0,target:document.body,viewOnly:!1,frameless:!1,dateDisplayFormat:"%a %e %b %Y"},fieldProcessor:!1,hasValidation:!1,processorId:!1,initialize:function(e){if(this.setOptions(e),this.processorId=String.uniqueID(),this.icons={},this.icons.save=Affinity.icons.Save||"&#xe093;",this.icons.cancel=Affinity.icons.Cancel||"&#xe070;",null==Affinity.zelos.Elements)throw new ZelosError("Zelos HTML Elements must be compiled. See ui.zelos.init.js");if(!this.options.viewOnly&&null==this.options.putApi)throw new ZelosError("Zelos needs a put API path in options.");this.target=this.options.target,this.fieldProcessor=new ZelosProcessFileds({zelosProcessor:this})},getValue:function(e){return!!this.fieldProcessor&&this.fieldProcessor.getValue(e)},getAttributes:function(e){return!!this.fieldProcessor&&this.fieldProcessor.getValue(e)},getLookupDependancies:function(e){return!!this.fieldProcessor&&this.fieldProcessor.getLookupDependancies(e)},setLookupDependancies:function(e,t,i){this.fieldProcessor&&this.fieldProcessor.setLookupDependancies(e,t,i)},processTemplate:function(e){if("string"==typeOf(e)&&(e=JSON.encode(e)),"object"===typeOf(e)){this.template=e,this.fieldProcessor.template=e;var t=e;"array"==typeOf(t.Children)&&(t.Children.sort((function(e,t){return parseInt(e.Layout.Rank,10)-parseInt(t.Layout.Rank,10)})),Array.each(t.Children,this.processSection.bind(this)));var i=this.options.target.getElements(".zelos-button");i.length>0?(this.form=new Element("form"),this.form.adopt(this.target.getChildren()),this.form.inject(this.target),this.form.set("autocomplete","off"),this.buttonBox=this.options.target.getElement(".form-row.buttons"),this.loaderBox=new Element("div",{class:"form-row hidden"}).adopt(new Element("img",{src:Affinity.loaders.light})).inject(this.buttonBox,"after"),this.errorScroll=new Fx.Scroll(window),this.validation=new UIFormValidation({target:this.form,onPost:this.onPost,onValidateFailCallback:this.validationFailed,onValidateCallback:this.validationPassed}),i.addEvent("click",function(e){var t=e.target.hasClass("zelos-button")?e.target:e.target.getParent(".zelos-button");t.get("data-type")&&("Cancel"!==t.get("data-type")?(this.buttonClickedName=t.get("data-name"),this.submit(e)):this.cancelForm())}.bind(this))):(this.form=this.target,this.form.set("autocomplete","off")),this.options.frameless,Array.each(this.form.getElements(".has-dependencies"),(function(e){e.retrieve("dependencies").setEvents()})),Affinity.formhideables&&Affinity.formhideables.processNew(),Affinity.tooltips&&Affinity.tooltips.processNew(),Affinity.lookups&&Affinity.lookups.processNew({jsonp:!0}),Affinity.displaylookups&&Affinity.displaylookups.processNew({jsonp:!0}),Affinity.uiDrawPanels&&Affinity.uiDrawPanels.processNew(),this.fireEvent("complete",this.options.target)}},submit:function(e){document.getElements(".error").removeClass("error"),document.getElements(".errorstr").destroy(),this.loaderBox&&this.loaderBox.removeClass("hidden"),this.buttonBox&&this.buttonBox.addClass("hidden"),this.buttonClicked=e.target.hasClass("button")?e.target:e.target.getParent(".button");var t=!0;this.options.beforSave&&(t=this.options.beforSave({button:this.buttonClicked})),t?this.validation?this.validation.validate():this.validationPassed():(this.loaderBox&&this.loaderBox.addClass("hidden"),this.buttonBox&&this.buttonBox.removeClass("hidden"))},cancel:function(){this.cancelForm()},cancelForm:function(){this.fireEvent("cancel")},validationFailed:function(){(function(){this.buttonBox&&this.buttonBox.removeClass("hidden"),this.loaderBox&&this.loaderBox.addClass("hidden"),this.errorScroll.toElement(document.getElement(".errorstr").getParent(".form-row"))}).delay(1e3,this)},onPost:function(){this.loaderBox.removeClass("hidden"),this.buttonBox.addClass("hidden")},updateDocument:function(){var e=Object.clone(this.template);return e.Children&&"array"==typeOf(e.Children)&&Array.each(e.Children,function(t,i){t.Children&&"array"==typeOf(t.Children)&&Array.each(t.Children,function(t,n){this.readField(e,i,n,t)}.bind(this))}.bind(this)),e},sanatisePostJson:function(e){var t=JSON.encode(e);return t=(t=t.replace(new RegExp("&amp;","gi"),"%26")).replace(new RegExp("&","gi"),"%26"),escape(t)},validationPassed:function(){var e=this.updateDocument();if(this.fireEvent("validated",{document:e,buttonClicked:this.buttonClicked}),"none"!==this.options.putApi){var t=this.sanatisePostJson(e);new Request.JSON({method:"POST",url:this.options.putApi,onFailure:this.postFailed,onError:this.postFailed,onSuccess:this.postSuccess}).post("="+t)}},postFailed:function(e){this.loaderBox&&this.loaderBox.addClass("hidden"),this.buttonBox&&this.buttonBox.removeClass("hidden"),this.fireEvent("saveError")},postSuccess:function(e){if("string"==typeOf(e)&&(e=JSON.decode(e)),"object"!=typeOf(e))throw new ZelosError("returned Json is not a valid object");var t,i,n,s;this.loaderBox&&this.loaderBox.addClass("hidden"),this.buttonBox&&this.buttonBox.removeClass("hidden");var o="cleverform",a=!1,r=[];e.Attribute&&e.Attribute.IsError&&(r.push(e.Attribute.ErrorMessage),a=!0),e.Children&&Array.each(e.Children,function(l){l.Attribute&&l.Attribute.IsError&&(r.push(l.name+": "+l.Attribute.ErrorMessage),a=!0),Array.each(l.Children,function(l,h){if(l.ElementType&&"TimesheetTable"===l.ElementType){if(o="timesheets",l.Attribute&&l.Attribute.IsError){if(a)return void window.fireEvent("processorDocumentError",{document:e,processorId:this.processorId});a=!0}}else l.Attribute&&l.Attribute.IsError&&(a=!0,(t=!!document.id(l.Name)&&document.id(l.Name))?(t.get("data-widget")?((i=t.retrieve("widget"))&&"processErrors"in i&&(n=t.retrieve("widget").processErrors(e)),n.length>0?(a=!0,s=n.join(", ")):s=l.Attribute.ErrorMessage):(t.getPrevious("label,.lable")?t=t.getPrevious("label,.lable"):t.getParent().getElement("label,.lable")&&(t=t.getParent().getElement("label,.lable")),s=l.Attribute.ErrorMessage),t.addClass("error"),t.hasClass("suppress-errors")||new Element("div",{class:"errorstr",html:s}).inject(t,"before")):r.push(l.Name+": "+l.Attribute.ErrorMessage))}.bind(this))}.bind(this)),a?("timesheets"==o&&window.fireEvent("processorDocumentError",{document:e,processorId:this.processorId}),r.length>0?this.fireEvent("saveError","<br />"+r.join("<br />")):this.fireEvent("saveError","")):(this.fireEvent("save",e),window.fireEvent("processorDocumentSaved",{document:e,processorId:this.processorId})),delete t,delete i,delete n,delete a,delete r},processChild:function(e,t,i,n){i="null"===typeOf(i)?null:i;var s=this.fieldProcessor.returnField(e,t,n);return null!==i&&s&&(i.getElement(".default-form").adopt(s),s.fireEvent("inDom")),s},processSection:function(e,t){if("SectionHeading"==e.ElementType){if(e.Attribute&&e.Attribute.IsHidden)return;var i=!1,n=Affinity.zelos.getElementFromData(e);this.options.frameless&&n.addClass("frameless"),this.options.target.adopt(n),n.getElement(".section-title").set("html",e.Description.ShortText),e.Layout&&e.Layout.HideTitle&&n.getElement(".section-header")&&n.getElement(".section-header").addClass("hidden"),"array"==typeOf(e.Children)&&(e.Children.sort((function(e,t){return parseInt(e.Layout.Rank,10)-parseInt(t.Layout.Rank,10)})),Array.each(e.Children,function(e,s){e.ElementType&&"WorkflowButton"==e.ElementType&&(i=!0),this.processChild(e,s,n,t)}.bind(this))),"null"===typeOf(e.Layout.HideMessage)||e.Layout.HideMessage||n.getElement(".required-message").removeClass("hidden"),n.getElement(".required")&&i&&new Element("div",{class:"form-row buttons"}).inject(n.getElement(".required-message"),"after").adopt(n.getElements(".button-wrapper")),e.Layout.IsHideable&&n.addClass("is-hideable").addClass("ui-hideable-id-"+e.Name.trim().toLowerCase().replace(/ /g,"-"))}},readDirectValue:function(e,t){return this.fieldProcessor.readField(e,t)},writeField:function(e,t){this.fieldProcessor.writeField(e,t)},readField:function(e,t,i,n,s){if("null"===typeOf(s)&&(s=this.form),s.getElement("#"+n.Name)){var o=s.getElement("#"+n.Name);this.buttonClickedName&&(this.fieldProcessor.buttonClickedName=this.buttonClickedName),e.Children[t].Children[i]=this.fieldProcessor.readField(n,o),delete o}}});