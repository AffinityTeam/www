function ZelosError(n){this.name="ZelosError";this.message=n||""}var Element,IFrame,Elements,Cookie,InputValidator,doc,datalistTest,Drag,Slider,Sortables,File,mybasepath,CFindex,CFInit,CFTemplateAddress,CFTemplateAttachInstructions,CFTemplateBankNumber,CFTemplateCheckbox,CFTemplateContentsTable,CFTemplateCurrency,CFTemplateDatePicker,CFTemplateDrawPanel,CFTemplateEffectiveDate,CFTemplateEmail,CFTemplateExplanation,CFTemplateFielddisplay,CFTemplateFieldEdit,CFTemplateFileUpload,CFTemplateFileUploadMulti,CFTemplateFloat,CFTemplateGridFields,CFTemplateInteger,CFTemplateLink,CFTemplateMemo,CFTemplateMultiselect,CFTemplateParagraph,CFTemplateSection,CFTemplateSeparator,CFTemplateDropdown,CFTemplateRadioButton,CFTemplateTaxNumber,CFTemplateText,CFTemplateTitle,CFTemplateYoutube,ZelosInit,ZelosTemplateLoad,ZelosTemplateProcess;if(function(n,t){function pu(n){var t=pt[n]={};return i.each(n.split(h),function(n,i){t[i]=!0}),t}function ri(n,r,u){if(u===t&&n.nodeType===1){var f="data-"+r.replace(hr,"-$1").toLowerCase();if(u=n.getAttribute(f),typeof u=="string"){try{u=u==="true"?!0:u==="false"?!1:u==="null"?null:+u+""===u?+u:sr.test(u)?i.parseJSON(u):u}catch(e){}i.data(n,r,u)}else u=t}return u}function at(n){var t;for(t in n)if((t!=="data"||!i.isEmptyObject(n[t]))&&t!=="toJSON")return!1;return!0}function v(){return!1}function d(){return!0}function b(n){return!n||!n.parentNode||n.parentNode.nodeType===11}function ui(n,t){do n=n[t];while(n&&n.nodeType!==1);return n}function fi(n,t,r){if(t=t||0,i.isFunction(t))return i.grep(n,function(n,i){var u=!!t.call(n,i,n);return u===r});if(t.nodeType)return i.grep(n,function(n){return n===t===r});if(typeof t=="string"){var u=i.grep(n,function(n){return n.nodeType===1});if(fe.test(t))return i.filter(t,u,!r);t=i.filter(t,u)}return i.grep(n,function(n){return i.inArray(n,t)>=0===r})}function ei(n){var i=dr.split("|"),t=n.createDocumentFragment();if(t.createElement)while(i.length)t.createElement(i.pop());return t}function wu(n,t){return n.getElementsByTagName(t)[0]||n.appendChild(n.ownerDocument.createElement(t))}function oi(n,t){if(t.nodeType===1&&i.hasData(n)){var u,f,o,s=i._data(n),r=i._data(t,s),e=s.events;if(e){delete r.handle;r.events={};for(u in e)for(f=0,o=e[u].length;f<o;f++)i.event.add(t,u,e[u][f])}r.data&&(r.data=i.extend({},r.data))}}function si(n,t){var r;t.nodeType===1&&(t.clearAttributes&&t.clearAttributes(),t.mergeAttributes&&t.mergeAttributes(n),r=t.nodeName.toLowerCase(),r==="object"?(t.parentNode&&(t.outerHTML=n.outerHTML),i.support.html5Clone&&n.innerHTML&&!i.trim(t.innerHTML)&&(t.innerHTML=n.innerHTML)):r==="input"&&tu.test(n.type)?(t.defaultChecked=t.checked=n.checked,t.value!==n.value&&(t.value=n.value)):r==="option"?t.selected=n.defaultSelected:r==="input"||r==="textarea"?t.defaultValue=n.defaultValue:r==="script"&&t.text!==n.text&&(t.text=n.text),t.removeAttribute(i.expando))}function g(n){return typeof n.getElementsByTagName!="undefined"?n.getElementsByTagName("*"):typeof n.querySelectorAll!="undefined"?n.querySelectorAll("*"):[]}function hi(n){tu.test(n.type)&&(n.defaultChecked=n.checked)}function ci(n,t){if(t in n)return t;for(var r=t.charAt(0).toUpperCase()+t.slice(1),u=t,i=eu.length;i--;)if(t=eu[i]+r,t in n)return t;return u}function nt(n,t){return n=t||n,i.css(n,"display")==="none"||!i.contains(n.ownerDocument,n)}function li(n,t){for(var r,o,e=[],f=0,s=n.length;f<s;f++)(r=n[f],r.style)&&(e[f]=i._data(r,"olddisplay"),t?(!e[f]&&r.style.display==="none"&&(r.style.display=""),r.style.display===""&&nt(r)&&(e[f]=i._data(r,"olddisplay",pi(r.nodeName)))):(o=u(r,"display"),!e[f]&&o!=="none"&&i._data(r,"olddisplay",o)));for(f=0;f<s;f++)(r=n[f],r.style)&&(t&&r.style.display!=="none"&&r.style.display!==""||(r.style.display=t?e[f]||"":"none"));return n}function ai(n,t,i){var r=we.exec(t);return r?Math.max(0,r[1]-(i||0))+(r[2]||"px"):t}function vi(n,t,r,f){for(var e=r===(f?"border":"content")?4:t==="width"?1:0,o=0;e<4;e+=2)r==="margin"&&(o+=i.css(n,r+c[e],!0)),f?(r==="content"&&(o-=parseFloat(u(n,"padding"+c[e]))||0),r!=="margin"&&(o-=parseFloat(u(n,"border"+c[e]+"Width"))||0)):(o+=parseFloat(u(n,"padding"+c[e]))||0,r!=="padding"&&(o+=parseFloat(u(n,"border"+c[e]+"Width"))||0));return o}function yi(n,t,r){var f=t==="width"?n.offsetWidth:n.offsetHeight,e=!0,o=i.support.boxSizing&&i.css(n,"boxSizing")==="border-box";if(f<=0){if(f=u(n,t),(f<0||f==null)&&(f=n.style[t]),et.test(f))return f;e=o&&(i.support.boxSizingReliable||f===n.style[t]);f=parseFloat(f)||0}return f+vi(n,t,r||(o?"border":"content"),e)+"px"}function pi(n){if(ni[n])return ni[n];var f=i("<"+n+">").appendTo(r.body),t=f.css("display");return f.remove(),(t==="none"||t==="")&&(y=r.body.appendChild(y||i.extend(r.createElement("iframe"),{frameBorder:0,width:0,height:0})),p&&y.createElement||(p=(y.contentWindow||y.contentDocument).document,p.write("<!doctype html><html><body>"),p.close()),f=p.body.appendChild(p.createElement(n)),t=u(f,"display"),r.body.removeChild(y)),ni[n]=t,t}function vt(n,t,r,u){var f;if(i.isArray(t))i.each(t,function(t,i){r||no.test(n)?u(n,i):vt(n+"["+(typeof i=="object"?t:"")+"]",i,r,u)});else if(r||i.type(t)!=="object")u(n,t);else for(f in t)vt(n+"["+f+"]",t[f],r,u)}function wi(n){return function(t,r){typeof t!="string"&&(r=t,t="*");var u,o,f,s=t.toLowerCase().split(h),e=0,c=s.length;if(i.isFunction(r))for(;e<c;e++)u=s[e],f=/^\+/.test(u),f&&(u=u.substr(1)||"*"),o=n[u]=n[u]||[],o[f?"unshift":"push"](r)}}function tt(n,i,r,u,f,e){f=f||i.dataTypes[0];e=e||{};e[f]=!0;for(var o,s=n[f],h=0,l=s?s.length:0,c=n===ti;h<l&&(c||!o);h++)o=s[h](i,r,u),typeof o=="string"&&(!c||e[o]?o=t:(i.dataTypes.unshift(o),o=tt(n,i,r,u,o,e)));return(c||!o)&&!e["*"]&&(o=tt(n,i,r,u,"*",e)),o}function bi(n,r){var u,f,e=i.ajaxSettings.flatOptions||{};for(u in r)r[u]!==t&&((e[u]?n:f||(f={}))[u]=r[u]);f&&i.extend(!0,n,f)}function bu(n,i,r){var o,u,e,s,h=n.contents,f=n.dataTypes,c=n.responseFields;for(u in c)u in r&&(i[c[u]]=r[u]);while(f[0]==="*")f.shift(),o===t&&(o=n.mimeType||i.getResponseHeader("content-type"));if(o)for(u in h)if(h[u]&&h[u].test(o)){f.unshift(u);break}if(f[0]in r)e=f[0];else{for(u in r){if(!f[0]||n.converters[u+" "+f[0]]){e=u;break}s||(s=u)}e=e||s}if(e)return e!==f[0]&&f.unshift(e),r[e]}function ku(n,t){var i,o,r,e,s=n.dataTypes.slice(),f=s[0],u={},h=0;if(n.dataFilter&&(t=n.dataFilter(t,n.dataType)),s[1])for(i in n.converters)u[i.toLowerCase()]=n.converters[i];for(;r=s[++h];)if(r!=="*"){if(f!=="*"&&f!==r){if(i=u[f+" "+r]||u["* "+r],!i)for(o in u)if(e=o.split(" "),e[1]===r&&(i=u[f+" "+e[0]]||u["* "+e[0]],i)){i===!0?i=u[o]:u[o]!==!0&&(r=e[0],s.splice(h--,0,r));break}if(i!==!0)if(i&&n.throws)t=i(t);else try{t=i(t)}catch(c){return{state:"parsererror",error:i?c:"No conversion from "+f+" to "+r}}}f=r}return{state:"success",data:t}}function ki(){try{return new n.XMLHttpRequest}catch(t){}}function du(){try{return new n.ActiveXObject("Microsoft.XMLHTTP")}catch(t){}}function di(){return setTimeout(function(){ht=t},0),ht=i.now()}function gu(n,t){i.each(t,function(t,i){for(var u=(k[t]||[]).concat(k["*"]),r=0,f=u.length;r<f;r++)if(u[r].call(n,t,i))return})}function gi(n,t,r){var e,o=0,c=lt.length,f=i.Deferred().always(function(){delete h.elem}),h=function(){for(var o=ht||di(),t=Math.max(0,u.startTime+u.duration-o),i=1-(t/u.duration||0),r=0,e=u.tweens.length;r<e;r++)u.tweens[r].run(i);return f.notifyWith(n,[u,i,t]),i<1&&e?t:(f.resolveWith(n,[u]),!1)},u=f.promise({elem:n,props:i.extend({},t),opts:i.extend(!0,{specialEasing:{}},r),originalProperties:t,originalOptions:r,startTime:ht||di(),duration:r.duration,tweens:[],createTween:function(t,r){var f=i.Tween(n,u.opts,t,r,u.opts.specialEasing[t]||u.opts.easing);return u.tweens.push(f),f},stop:function(t){for(var i=0,r=t?u.tweens.length:0;i<r;i++)u.tweens[i].run(1);return t?f.resolveWith(n,[u,t]):f.rejectWith(n,[u,t]),this}}),s=u.props;for(nf(s,u.opts.specialEasing);o<c;o++)if(e=lt[o].call(u,n,s,u.opts),e)return e;return gu(u,s),i.isFunction(u.opts.start)&&u.opts.start.call(n,u),i.fx.timer(i.extend(h,{anim:u,queue:u.opts.queue,elem:n})),u.progress(u.opts.progress).done(u.opts.done,u.opts.complete).fail(u.opts.fail).always(u.opts.always)}function nf(n,t){var r,f,e,u,o;for(r in n)if(f=i.camelCase(r),e=t[f],u=n[r],i.isArray(u)&&(e=u[1],u=n[r]=u[0]),r!==f&&(n[f]=u,delete n[r]),o=i.cssHooks[f],o&&"expand"in o){u=o.expand(u);delete n[f];for(r in u)r in n||(n[r]=u[r],t[r]=e)}else t[f]=e}function tf(n,t,r){var o,u,a,v,h,c,f,w,s=this,e=n.style,y={},p=[],l=n.nodeType&&nt(n);r.queue||(f=i._queueHooks(n,"fx"),f.unqueued==null&&(f.unqueued=0,w=f.empty.fire,f.empty.fire=function(){f.unqueued||w()}),f.unqueued++,s.always(function(){s.always(function(){f.unqueued--;i.queue(n,"fx").length||f.empty.fire()})}));n.nodeType===1&&("height"in t||"width"in t)&&(r.overflow=[e.overflow,e.overflowX,e.overflowY],i.css(n,"display")==="inline"&&i.css(n,"float")==="none"&&(!i.support.inlineBlockNeedsLayout||pi(n.nodeName)==="inline"?e.display="inline-block":e.zoom=1));r.overflow&&(e.overflow="hidden",i.support.shrinkWrapBlocks||s.done(function(){e.overflow=r.overflow[0];e.overflowX=r.overflow[1];e.overflowY=r.overflow[2]}));for(o in t)if(a=t[o],lo.exec(a)){if(delete t[o],a===(l?"hide":"show"))continue;p.push(o)}if(v=p.length,v)for(h=i._data(n,"fxshow")||i._data(n,"fxshow",{}),l?i(n).show():s.done(function(){i(n).hide()}),s.done(function(){var t;i.removeData(n,"fxshow",!0);for(t in y)i.style(n,t,y[t])}),o=0;o<v;o++)u=p[o],c=s.createTween(u,l?h[u]:0),y[u]=h[u]||i.style(n,u),u in h||(h[u]=c.start,l&&(c.end=c.start,c.start=u==="width"||u==="height"?1:0))}function f(n,t,i,r,u){return new f.prototype.init(n,t,i,r,u)}function it(n,t){for(var r,i={height:n},u=0;u<4;u+=2-t)r=c[u],i["margin"+r]=i["padding"+r]=n;return t&&(i.opacity=i.width=n),i}function nr(n){return i.isWindow(n)?n:n.nodeType===9?n.defaultView||n.parentWindow:!1}var tr,rt,r=n.document,rf=n.location,uf=n.navigator,ff=n.jQuery,ef=n.$,ir=Array.prototype.push,o=Array.prototype.slice,rr=Array.prototype.indexOf,of=Object.prototype.toString,yt=Object.prototype.hasOwnProperty,ur=String.prototype.trim,i=function(n,t){return new i.fn.init(n,t,tr)},ut=/[\-+]?(?:\d*\.|)\d+(?:[eE][\-+]?\d+|)/.source,fr=/\S/,h=/\s+/,sf=fr.test("Â ")?/^[\s\xA0]+|[\s\xA0]+$/g:/^\s+|\s+$/g,hf=/^(?:[^#<]*(<[\w\W]+>)[^>]*$|#([\w\-]*)$)/,er=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,cf=/^[\],:{}\s]*$/,lf=/(?:^|:|,)(?:\s*\[)+/g,af=/\\(?:["\\\/bfnrt]|u[\da-fA-F]{4})/g,vf=/"[^"\\\r\n]*"|true|false|null|-?(?:\d\d*\.|)\d+(?:[eE][\-+]?\d+|)/g,yf=/^-ms-/,pf=/-([\da-z])/gi,wf=function(n,t){return(t+"").toUpperCase()},ft=function(){r.addEventListener?(r.removeEventListener("DOMContentLoaded",ft,!1),i.ready()):r.readyState==="complete"&&(r.detachEvent("onreadystatechange",ft),i.ready())},or={},pt,sr,hr,w,st,yu,ii;i.fn=i.prototype={constructor:i,init:function(n,u,f){var e,o,s;if(!n)return this;if(n.nodeType)return this.context=this[0]=n,this.length=1,this;if(typeof n=="string"){if(e=n.charAt(0)==="<"&&n.charAt(n.length-1)===">"&&n.length>=3?[null,n,null]:hf.exec(n),e&&(e[1]||!u)){if(e[1])return u=u instanceof i?u[0]:u,s=u&&u.nodeType?u.ownerDocument||u:r,n=i.parseHTML(e[1],s,!0),er.test(e[1])&&i.isPlainObject(u)&&this.attr.call(n,u,!0),i.merge(this,n);if(o=r.getElementById(e[2]),o&&o.parentNode){if(o.id!==e[2])return f.find(n);this.length=1;this[0]=o}return this.context=r,this.selector=n,this}return!u||u.jquery?(u||f).find(n):this.constructor(u).find(n)}return i.isFunction(n)?f.ready(n):(n.selector!==t&&(this.selector=n.selector,this.context=n.context),i.makeArray(n,this))},selector:"",jquery:"1.8.0",length:0,size:function(){return this.length},toArray:function(){return o.call(this)},get:function(n){return n==null?this.toArray():n<0?this[this.length+n]:this[n]},pushStack:function(n,t,r){var u=i.merge(this.constructor(),n);return u.prevObject=this,u.context=this.context,t==="find"?u.selector=this.selector+(this.selector?" ":"")+r:t&&(u.selector=this.selector+"."+t+"("+r+")"),u},each:function(n,t){return i.each(this,n,t)},ready:function(n){return i.ready.promise().done(n),this},eq:function(n){return n=+n,n===-1?this.slice(n):this.slice(n,n+1)},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},slice:function(){return this.pushStack(o.apply(this,arguments),"slice",o.call(arguments).join(","))},map:function(n){return this.pushStack(i.map(this,function(t,i){return n.call(t,i,t)}))},end:function(){return this.prevObject||this.constructor(null)},push:ir,sort:[].sort,splice:[].splice};i.fn.init.prototype=i.fn;i.extend=i.fn.extend=function(){var o,e,u,r,s,h,n=arguments[0]||{},f=1,l=arguments.length,c=!1;for(typeof n=="boolean"&&(c=n,n=arguments[1]||{},f=2),typeof n!="object"&&!i.isFunction(n)&&(n={}),l===f&&(n=this,--f);f<l;f++)if((o=arguments[f])!=null)for(e in o)(u=n[e],r=o[e],n!==r)&&(c&&r&&(i.isPlainObject(r)||(s=i.isArray(r)))?(s?(s=!1,h=u&&i.isArray(u)?u:[]):h=u&&i.isPlainObject(u)?u:{},n[e]=i.extend(c,h,r)):r!==t&&(n[e]=r));return n};i.extend({noConflict:function(t){return n.$===i&&(n.$=ef),t&&n.jQuery===i&&(n.jQuery=ff),i},isReady:!1,readyWait:1,holdReady:function(n){n?i.readyWait++:i.ready(!0)},ready:function(n){if(n===!0?!--i.readyWait:!i.isReady){if(!r.body)return setTimeout(i.ready,1);(i.isReady=!0,n!==!0&&--i.readyWait>0)||(rt.resolveWith(r,[i]),i.fn.trigger&&i(r).trigger("ready").off("ready"))}},isFunction:function(n){return i.type(n)==="function"},isArray:Array.isArray||function(n){return i.type(n)==="array"},isWindow:function(n){return n!=null&&n==n.window},isNumeric:function(n){return!isNaN(parseFloat(n))&&isFinite(n)},type:function(n){return n==null?String(n):or[of.call(n)]||"object"},isPlainObject:function(n){if(!n||i.type(n)!=="object"||n.nodeType||i.isWindow(n))return!1;try{if(n.constructor&&!yt.call(n,"constructor")&&!yt.call(n.constructor.prototype,"isPrototypeOf"))return!1}catch(u){return!1}var r;for(r in n);return r===t||yt.call(n,r)},isEmptyObject:function(n){var t;for(t in n)return!1;return!0},error:function(n){throw new Error(n);},parseHTML:function(n,t,u){var f;return!n||typeof n!="string"?null:(typeof t=="boolean"&&(u=t,t=0),t=t||r,(f=er.exec(n))?[t.createElement(f[1])]:(f=i.buildFragment([n],t,u?null:[]),i.merge([],(f.cacheable?i.clone(f.fragment):f.fragment).childNodes)))},parseJSON:function(t){if(!t||typeof t!="string")return null;if(t=i.trim(t),n.JSON&&n.JSON.parse)return n.JSON.parse(t);if(cf.test(t.replace(af,"@").replace(vf,"]").replace(lf,"")))return new Function("return "+t)();i.error("Invalid JSON: "+t)},parseXML:function(r){var u,f;if(!r||typeof r!="string")return null;try{n.DOMParser?(f=new DOMParser,u=f.parseFromString(r,"text/xml")):(u=new ActiveXObject("Microsoft.XMLDOM"),u.async="false",u.loadXML(r))}catch(e){u=t}return(!u||!u.documentElement||u.getElementsByTagName("parsererror").length)&&i.error("Invalid XML: "+r),u},noop:function(){},globalEval:function(t){t&&fr.test(t)&&(n.execScript||function(t){n.eval.call(n,t)})(t)},camelCase:function(n){return n.replace(yf,"ms-").replace(pf,wf)},nodeName:function(n,t){return n.nodeName&&n.nodeName.toUpperCase()===t.toUpperCase()},each:function(n,r,u){var f,e=0,o=n.length,s=o===t||i.isFunction(n);if(u){if(s){for(f in n)if(r.apply(n[f],u)===!1)break}else for(;e<o;)if(r.apply(n[e++],u)===!1)break}else if(s){for(f in n)if(r.call(n[f],f,n[f])===!1)break}else for(;e<o;)if(r.call(n[e],e,n[e++])===!1)break;return n},trim:ur?function(n){return n==null?"":ur.call(n)}:function(n){return n==null?"":n.toString().replace(sf,"")},makeArray:function(n,t){var r,u=t||[];return n!=null&&(r=i.type(n),n.length==null||r==="string"||r==="function"||r==="regexp"||i.isWindow(n)?ir.call(u,n):i.merge(u,n)),u},inArray:function(n,t,i){var r;if(t){if(rr)return rr.call(t,n,i);for(r=t.length,i=i?i<0?Math.max(0,r+i):i:0;i<r;i++)if(i in t&&t[i]===n)return i}return-1},merge:function(n,i){var f=i.length,u=n.length,r=0;if(typeof f=="number")for(;r<f;r++)n[u++]=i[r];else while(i[r]!==t)n[u++]=i[r++];return n.length=u,n},grep:function(n,t,i){var u,f=[],r=0,e=n.length;for(i=!!i;r<e;r++)u=!!t(n[r],r),i!==u&&f.push(n[r]);return f},map:function(n,r,u){var f,h,e=[],s=0,o=n.length,c=n instanceof i||o!==t&&typeof o=="number"&&(o>0&&n[0]&&n[o-1]||o===0||i.isArray(n));if(c)for(;s<o;s++)f=r(n[s],s,u),f!=null&&(e[e.length]=f);else for(h in n)f=r(n[h],h,u),f!=null&&(e[e.length]=f);return e.concat.apply([],e)},guid:1,proxy:function(n,r){var f,e,u;return typeof r=="string"&&(f=n[r],r=n,n=f),i.isFunction(n)?(e=o.call(arguments,2),u=function(){return n.apply(r,e.concat(o.call(arguments)))},u.guid=n.guid=n.guid||u.guid||i.guid++,u):t},access:function(n,r,u,f,e,o,s){var c,l=u==null,h=0,a=n.length;if(u&&typeof u=="object"){for(h in u)i.access(n,r,h,u[h],1,o,f);e=1}else if(f!==t){if(c=s===t&&i.isFunction(f),l&&(c?(c=r,r=function(n,t,r){return c.call(i(n),r)}):(r.call(n,f),r=null)),r)for(;h<a;h++)r(n[h],u,c?f.call(n[h],h,r(n[h],u)):f,s);e=1}return e?n:l?r.call(n):a?r(n[0],u):o},now:function(){return(new Date).getTime()}});i.ready.promise=function(t){if(!rt)if(rt=i.Deferred(),r.readyState==="complete"||r.readyState!=="loading"&&r.addEventListener)setTimeout(i.ready,1);else if(r.addEventListener)r.addEventListener("DOMContentLoaded",ft,!1),n.addEventListener("load",i.ready,!1);else{r.attachEvent("onreadystatechange",ft);n.attachEvent("onload",i.ready);var u=!1;try{u=n.frameElement==null&&r.documentElement}catch(e){}u&&u.doScroll&&function f(){if(!i.isReady){try{u.doScroll("left")}catch(n){return setTimeout(f,50)}i.ready()}}()}return rt.promise(t)};i.each("Boolean Number String Function Array Date RegExp Object".split(" "),function(n,t){or["[object "+t+"]"]=t.toLowerCase()});tr=i(r);pt={};i.Callbacks=function(n){n=typeof n=="string"?pt[n]||pu(n):i.extend({},n);var f,c,o,l,s,e,r=[],u=!n.once&&[],a=function(t){for(f=n.memory&&t,c=!0,e=l||0,l=0,s=r.length,o=!0;r&&e<s;e++)if(r[e].apply(t[0],t[1])===!1&&n.stopOnFalse){f=!1;break}o=!1;r&&(u?u.length&&a(u.shift()):f?r=[]:h.disable())},h={add:function(){if(r){var t=r.length;(function u(t){i.each(t,function(t,f){i.isFunction(f)&&(!n.unique||!h.has(f))?r.push(f):f&&f.length&&u(f)})})(arguments);o?s=r.length:f&&(l=t,a(f))}return this},remove:function(){return r&&i.each(arguments,function(n,t){for(var u;(u=i.inArray(t,r,u))>-1;)r.splice(u,1),o&&(u<=s&&s--,u<=e&&e--)}),this},has:function(n){return i.inArray(n,r)>-1},empty:function(){return r=[],this},disable:function(){return r=u=f=t,this},disabled:function(){return!r},lock:function(){return u=t,f||h.disable(),this},locked:function(){return!u},fireWith:function(n,t){return t=t||[],t=[n,t.slice?t.slice():t],r&&(!c||u)&&(o?u.push(t):a(t)),this},fire:function(){return h.fireWith(this,arguments),this},fired:function(){return!!c}};return h};i.extend({Deferred:function(n){var u=[["resolve","done",i.Callbacks("once memory"),"resolved"],["reject","fail",i.Callbacks("once memory"),"rejected"],["notify","progress",i.Callbacks("memory")]],f="pending",r={state:function(){return f},always:function(){return t.done(arguments).fail(arguments),this},then:function(){var n=arguments;return i.Deferred(function(r){i.each(u,function(u,f){var e=f[0],o=n[u];t[f[1]](i.isFunction(o)?function(){var n=o.apply(this,arguments);n&&i.isFunction(n.promise)?n.promise().done(r.resolve).fail(r.reject).progress(r.notify):r[e+"With"](this===t?r:this,[n])}:r[e])});n=null}).promise()},promise:function(n){return typeof n=="object"?i.extend(n,r):r}},t={};return r.pipe=r.then,i.each(u,function(n,i){var e=i[2],o=i[3];r[i[1]]=e.add;o&&e.add(function(){f=o},u[n^1][2].disable,u[2][2].lock);t[i[0]]=e.fire;t[i[0]+"With"]=e.fireWith}),r.promise(t),n&&n.call(t,t),t},when:function(n){var t=0,u=o.call(arguments),r=u.length,e=r!==1||n&&i.isFunction(n.promise)?r:0,f=e===1?n:i.Deferred(),c=function(n,t,i){return function(r){t[n]=this;i[n]=arguments.length>1?o.call(arguments):r;i===s?f.notifyWith(t,i):--e||f.resolveWith(t,i)}},s,l,h;if(r>1)for(s=new Array(r),l=new Array(r),h=new Array(r);t<r;t++)u[t]&&i.isFunction(u[t].promise)?u[t].promise().done(c(t,h,u)).fail(f.reject).progress(c(t,l,s)):--e;return e||f.resolveWith(h,u),f.promise()}});i.support=function(){var u,h,e,c,l,f,o,a,v,s,y,t=r.createElement("div");if(t.setAttribute("className","t"),t.innerHTML="  <link/><table><\/table><a href='/a'>a<\/a><input type='checkbox'/>",h=t.getElementsByTagName("*"),e=t.getElementsByTagName("a")[0],e.style.cssText="top:1px;float:left;opacity:.5",!h||!h.length||!e)return{};c=r.createElement("select");l=c.appendChild(r.createElement("option"));f=t.getElementsByTagName("input")[0];u={leadingWhitespace:t.firstChild.nodeType===3,tbody:!t.getElementsByTagName("tbody").length,htmlSerialize:!!t.getElementsByTagName("link").length,style:/top/.test(e.getAttribute("style")),hrefNormalized:e.getAttribute("href")==="/a",opacity:/^0.5/.test(e.style.opacity),cssFloat:!!e.style.cssFloat,checkOn:f.value==="on",optSelected:l.selected,getSetAttribute:t.className!=="t",enctype:!!r.createElement("form").enctype,html5Clone:r.createElement("nav").cloneNode(!0).outerHTML!=="<:nav><\/:nav>",boxModel:r.compatMode==="CSS1Compat",submitBubbles:!0,changeBubbles:!0,focusinBubbles:!1,deleteExpando:!0,noCloneEvent:!0,inlineBlockNeedsLayout:!1,shrinkWrapBlocks:!1,reliableMarginRight:!0,boxSizingReliable:!0,pixelPosition:!1};f.checked=!0;u.noCloneChecked=f.cloneNode(!0).checked;c.disabled=!0;u.optDisabled=!l.disabled;try{delete t.test}catch(p){u.deleteExpando=!1}if(!t.addEventListener&&t.attachEvent&&t.fireEvent&&(t.attachEvent("onclick",y=function(){u.noCloneEvent=!1}),t.cloneNode(!0).fireEvent("onclick"),t.detachEvent("onclick",y)),f=r.createElement("input"),f.value="t",f.setAttribute("type","radio"),u.radioValue=f.value==="t",f.setAttribute("checked","checked"),f.setAttribute("name","t"),t.appendChild(f),o=r.createDocumentFragment(),o.appendChild(t.lastChild),u.checkClone=o.cloneNode(!0).cloneNode(!0).lastChild.checked,u.appendChecked=f.checked,o.removeChild(f),o.appendChild(t),t.attachEvent)for(v in{submit:!0,change:!0,focusin:!0})a="on"+v,s=a in t,s||(t.setAttribute(a,"return;"),s=typeof t[a]=="function"),u[v+"Bubbles"]=s;return i(function(){var i,t,f,e,h="padding:0;margin:0;border:0;display:block;overflow:hidden;",o=r.getElementsByTagName("body")[0];o&&(i=r.createElement("div"),i.style.cssText="visibility:hidden;border:0;width:0;height:0;position:static;top:0;margin-top:1px",o.insertBefore(i,o.firstChild),t=r.createElement("div"),i.appendChild(t),t.innerHTML="<table><tr><td><\/td><td>t<\/td><\/tr><\/table>",f=t.getElementsByTagName("td"),f[0].style.cssText="padding:0;margin:0;border:0;display:none",s=f[0].offsetHeight===0,f[0].style.display="",f[1].style.display="none",u.reliableHiddenOffsets=s&&f[0].offsetHeight===0,t.innerHTML="",t.style.cssText="box-sizing:border-box;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%;",u.boxSizing=t.offsetWidth===4,u.doesNotIncludeMarginInBodyOffset=o.offsetTop!==1,n.getComputedStyle&&(u.pixelPosition=(n.getComputedStyle(t,null)||{}).top!=="1%",u.boxSizingReliable=(n.getComputedStyle(t,null)||{width:"4px"}).width==="4px",e=r.createElement("div"),e.style.cssText=t.style.cssText=h,e.style.marginRight=e.style.width="0",t.style.width="1px",t.appendChild(e),u.reliableMarginRight=!parseFloat((n.getComputedStyle(e,null)||{}).marginRight)),typeof t.style.zoom!="undefined"&&(t.innerHTML="",t.style.cssText=h+"width:1px;padding:1px;display:inline;zoom:1",u.inlineBlockNeedsLayout=t.offsetWidth===3,t.style.display="block",t.style.overflow="visible",t.innerHTML="<div><\/div>",t.firstChild.style.width="5px",u.shrinkWrapBlocks=t.offsetWidth!==3,i.style.zoom=1),o.removeChild(i),i=t=f=e=null)}),o.removeChild(t),h=e=c=l=f=o=t=null,u}();sr=/^(?:\{.*\}|\[.*\])$/;hr=/([A-Z])/g;i.extend({cache:{},deletedIds:[],uuid:0,expando:"jQuery"+(i.fn.jquery+Math.random()).replace(/\D/g,""),noData:{embed:!0,object:"clsid:D27CDB6E-AE6D-11cf-96B8-444553540000",applet:!0},hasData:function(n){return n=n.nodeType?i.cache[n[i.expando]]:n[i.expando],!!n&&!at(n)},data:function(n,r,u,f){if(i.acceptData(n)){var s,h,c=i.expando,a=typeof r=="string",l=n.nodeType,o=l?i.cache:n,e=l?n[c]:n[c]&&c;if(e&&o[e]&&(f||o[e].data)||!a||u!==t)return e||(l?n[c]=e=i.deletedIds.pop()||++i.uuid:e=c),o[e]||(o[e]={},l||(o[e].toJSON=i.noop)),(typeof r=="object"||typeof r=="function")&&(f?o[e]=i.extend(o[e],r):o[e].data=i.extend(o[e].data,r)),s=o[e],f||(s.data||(s.data={}),s=s.data),u!==t&&(s[i.camelCase(r)]=u),a?(h=s[r],h==null&&(h=s[i.camelCase(r)])):h=s,h}},removeData:function(n,t,r){if(i.acceptData(n)){var e,o,h,s=n.nodeType,u=s?i.cache:n,f=s?n[i.expando]:i.expando;if(u[f]){if(t&&(e=r?u[f]:u[f].data,e)){for(i.isArray(t)||((t in e)?t=[t]:(t=i.camelCase(t),t=(t in e)?[t]:t.split(" "))),o=0,h=t.length;o<h;o++)delete e[t[o]];if(!(r?at:i.isEmptyObject)(e))return}(r||(delete u[f].data,at(u[f])))&&(s?i.cleanData([n],!0):i.support.deleteExpando||u!=u.window?delete u[f]:u[f]=null)}}},_data:function(n,t,r){return i.data(n,t,r,!0)},acceptData:function(n){var t=n.nodeName&&i.noData[n.nodeName.toLowerCase()];return!t||t!==!0&&n.getAttribute("classid")===t}});i.fn.extend({data:function(n,r){var u,s,h,o,l,e=this[0],c=0,f=null;if(n===t){if(this.length&&(f=i.data(e),e.nodeType===1&&!i._data(e,"parsedAttrs"))){for(h=e.attributes,l=h.length;c<l;c++)o=h[c].name,o.indexOf("data-")===0&&(o=i.camelCase(o.substring(5)),ri(e,o,f[o]));i._data(e,"parsedAttrs",!0)}return f}return typeof n=="object"?this.each(function(){i.data(this,n)}):(u=n.split(".",2),u[1]=u[1]?"."+u[1]:"",s=u[1]+"!",i.access(this,function(r){if(r===t)return f=this.triggerHandler("getData"+s,[u[0]]),f===t&&e&&(f=i.data(e,n),f=ri(e,n,f)),f===t&&u[1]?this.data(u[0]):f;u[1]=r;this.each(function(){var t=i(this);t.triggerHandler("setData"+s,u);i.data(this,n,r);t.triggerHandler("changeData"+s,u)})},null,r,arguments.length>1,null,!1))},removeData:function(n){return this.each(function(){i.removeData(this,n)})}});i.extend({queue:function(n,t,r){var u;if(n)return t=(t||"fx")+"queue",u=i._data(n,t),r&&(!u||i.isArray(r)?u=i._data(n,t,i.makeArray(r)):u.push(r)),u||[]},dequeue:function(n,t){t=t||"fx";var r=i.queue(n,t),u=r.shift(),f=i._queueHooks(n,t),e=function(){i.dequeue(n,t)};u==="inprogress"&&(u=r.shift());u&&(t==="fx"&&r.unshift("inprogress"),delete f.stop,u.call(n,e,f));!r.length&&f&&f.empty.fire()},_queueHooks:function(n,t){var r=t+"queueHooks";return i._data(n,r)||i._data(n,r,{empty:i.Callbacks("once memory").add(function(){i.removeData(n,t+"queue",!0);i.removeData(n,r,!0)})})}});i.fn.extend({queue:function(n,r){var u=2;return typeof n!="string"&&(r=n,n="fx",u--),arguments.length<u?i.queue(this[0],n):r===t?this:this.each(function(){var t=i.queue(this,n,r);i._queueHooks(this,n);n==="fx"&&t[0]!=="inprogress"&&i.dequeue(this,n)})},dequeue:function(n){return this.each(function(){i.dequeue(this,n)})},delay:function(n,t){return n=i.fx?i.fx.speeds[n]||n:n,t=t||"fx",this.queue(t,function(t,i){var r=setTimeout(t,n);i.stop=function(){clearTimeout(r)}})},clearQueue:function(n){return this.queue(n||"fx",[])},promise:function(n,r){var u,e=1,o=i.Deferred(),f=this,s=this.length,h=function(){--e||o.resolveWith(f,[f])};for(typeof n!="string"&&(r=n,n=t),n=n||"fx";s--;)(u=i._data(f[s],n+"queueHooks"))&&u.empty&&(e++,u.empty.add(h));return h(),o.promise(r)}});var s,cr,lr,ar=/[\t\r\n]/g,bf=/\r/g,kf=/^(?:button|input)$/i,df=/^(?:button|input|object|select|textarea)$/i,gf=/^a(?:rea|)$/i,vr=/^(?:autofocus|autoplay|async|checked|controls|defer|disabled|hidden|loop|multiple|open|readonly|required|scoped|selected)$/i,yr=i.support.getSetAttribute;i.fn.extend({attr:function(n,t){return i.access(this,i.attr,n,t,arguments.length>1)},removeAttr:function(n){return this.each(function(){i.removeAttr(this,n)})},prop:function(n,t){return i.access(this,i.prop,n,t,arguments.length>1)},removeProp:function(n){return n=i.propFix[n]||n,this.each(function(){try{this[n]=t;delete this[n]}catch(i){}})},addClass:function(n){var r,f,o,t,e,u,s;if(i.isFunction(n))return this.each(function(t){i(this).addClass(n.call(this,t,this.className))});if(n&&typeof n=="string")for(r=n.split(h),f=0,o=this.length;f<o;f++)if(t=this[f],t.nodeType===1)if(t.className||r.length!==1){for(e=" "+t.className+" ",u=0,s=r.length;u<s;u++)~e.indexOf(" "+r[u]+" ")||(e+=r[u]+" ");t.className=i.trim(e)}else t.className=n;return this},removeClass:function(n){var e,r,u,f,s,o,c;if(i.isFunction(n))return this.each(function(t){i(this).removeClass(n.call(this,t,this.className))});if(n&&typeof n=="string"||n===t)for(e=(n||"").split(h),o=0,c=this.length;o<c;o++)if(u=this[o],u.nodeType===1&&u.className){for(r=(" "+u.className+" ").replace(ar," "),f=0,s=e.length;f<s;f++)while(r.indexOf(" "+e[f]+" ")>-1)r=r.replace(" "+e[f]+" "," ");u.className=n?i.trim(r):""}return this},toggleClass:function(n,t){var r=typeof n,u=typeof t=="boolean";return i.isFunction(n)?this.each(function(r){i(this).toggleClass(n.call(this,r,this.className,t),t)}):this.each(function(){if(r==="string")for(var f,s=0,o=i(this),e=t,c=n.split(h);f=c[s++];)e=u?e:!o.hasClass(f),o[e?"addClass":"removeClass"](f);else(r==="undefined"||r==="boolean")&&(this.className&&i._data(this,"__className__",this.className),this.className=this.className||n===!1?"":i._data(this,"__className__")||"")})},hasClass:function(n){for(var i=" "+n+" ",t=0,r=this.length;t<r;t++)if(this[t].nodeType===1&&(" "+this[t].className+" ").replace(ar," ").indexOf(i)>-1)return!0;return!1},val:function(n){var r,u,e,f=this[0];return arguments.length?(e=i.isFunction(n),this.each(function(u){var f,o=i(this);this.nodeType===1&&(f=e?n.call(this,u,o.val()):n,f==null?f="":typeof f=="number"?f+="":i.isArray(f)&&(f=i.map(f,function(n){return n==null?"":n+""})),r=i.valHooks[this.type]||i.valHooks[this.nodeName.toLowerCase()],r&&"set"in r&&r.set(this,f,"value")!==t||(this.value=f))})):f?(r=i.valHooks[f.type]||i.valHooks[f.nodeName.toLowerCase()],r&&"get"in r&&(u=r.get(f,"value"))!==t?u:(u=f.value,typeof u=="string"?u.replace(bf,""):u==null?"":u)):void 0}});i.extend({valHooks:{option:{get:function(n){var t=n.attributes.value;return!t||t.specified?n.value:n.text}},select:{get:function(n){var o,r,h,t,u=n.selectedIndex,s=[],f=n.options,e=n.type==="select-one";if(u<0)return null;for(r=e?u:0,h=e?u+1:f.length;r<h;r++)if(t=f[r],t.selected&&(i.support.optDisabled?!t.disabled:t.getAttribute("disabled")===null)&&(!t.parentNode.disabled||!i.nodeName(t.parentNode,"optgroup"))){if(o=i(t).val(),e)return o;s.push(o)}return e&&!s.length&&f.length?i(f[u]).val():s},set:function(n,t){var r=i.makeArray(t);return i(n).find("option").each(function(){this.selected=i.inArray(i(this).val(),r)>=0}),r.length||(n.selectedIndex=-1),r}}},attrFn:{},attr:function(n,r,u,f){var e,o,h,c=n.nodeType;if(n&&c!==3&&c!==8&&c!==2){if(f&&i.isFunction(i.fn[r]))return i(n)[r](u);if(typeof n.getAttribute=="undefined")return i.prop(n,r,u);if(h=c!==1||!i.isXMLDoc(n),h&&(r=r.toLowerCase(),o=i.attrHooks[r]||(vr.test(r)?cr:s)),u!==t){if(u===null){i.removeAttr(n,r);return}return o&&"set"in o&&h&&(e=o.set(n,u,r))!==t?e:(n.setAttribute(r,""+u),u)}return o&&"get"in o&&h&&(e=o.get(n,r))!==null?e:(e=n.getAttribute(r),e===null?t:e)}},removeAttr:function(n,t){var u,f,r,e,o=0;if(t&&n.nodeType===1)for(f=t.split(h);o<f.length;o++)r=f[o],r&&(u=i.propFix[r]||r,e=vr.test(r),e||i.attr(n,r,""),n.removeAttribute(yr?r:u),e&&u in n&&(n[u]=!1))},attrHooks:{type:{set:function(n,t){if(kf.test(n.nodeName)&&n.parentNode)i.error("type property can't be changed");else if(!i.support.radioValue&&t==="radio"&&i.nodeName(n,"input")){var r=n.value;return n.setAttribute("type",t),r&&(n.value=r),t}}},value:{get:function(n,t){return s&&i.nodeName(n,"button")?s.get(n,t):t in n?n.value:null},set:function(n,t,r){if(s&&i.nodeName(n,"button"))return s.set(n,t,r);n.value=t}}},propFix:{tabindex:"tabIndex",readonly:"readOnly","for":"htmlFor","class":"className",maxlength:"maxLength",cellspacing:"cellSpacing",cellpadding:"cellPadding",rowspan:"rowSpan",colspan:"colSpan",usemap:"useMap",frameborder:"frameBorder",contenteditable:"contentEditable"},prop:function(n,r,u){var e,f,s,o=n.nodeType;if(n&&o!==3&&o!==8&&o!==2)return s=o!==1||!i.isXMLDoc(n),s&&(r=i.propFix[r]||r,f=i.propHooks[r]),u!==t?f&&"set"in f&&(e=f.set(n,u,r))!==t?e:n[r]=u:f&&"get"in f&&(e=f.get(n,r))!==null?e:n[r]},propHooks:{tabIndex:{get:function(n){var i=n.getAttributeNode("tabindex");return i&&i.specified?parseInt(i.value,10):df.test(n.nodeName)||gf.test(n.nodeName)&&n.href?0:t}}}});cr={get:function(n,r){var u,f=i.prop(n,r);return f===!0||typeof f!="boolean"&&(u=n.getAttributeNode(r))&&u.nodeValue!==!1?r.toLowerCase():t},set:function(n,t,r){var u;return t===!1?i.removeAttr(n,r):(u=i.propFix[r]||r,u in n&&(n[u]=!0),n.setAttribute(r,r.toLowerCase())),r}};yr||(lr={name:!0,id:!0,coords:!0},s=i.valHooks.button={get:function(n,i){var r;return r=n.getAttributeNode(i),r&&(lr[i]?r.value!=="":r.specified)?r.value:t},set:function(n,t,i){var u=n.getAttributeNode(i);return u||(u=r.createAttribute(i),n.setAttributeNode(u)),u.value=t+""}},i.each(["width","height"],function(n,t){i.attrHooks[t]=i.extend(i.attrHooks[t],{set:function(n,i){if(i==="")return n.setAttribute(t,"auto"),i}})}),i.attrHooks.contenteditable={get:s.get,set:function(n,t,i){t===""&&(t="false");s.set(n,t,i)}});i.support.hrefNormalized||i.each(["href","src","width","height"],function(n,r){i.attrHooks[r]=i.extend(i.attrHooks[r],{get:function(n){var i=n.getAttribute(r,2);return i===null?t:i}})});i.support.style||(i.attrHooks.style={get:function(n){return n.style.cssText.toLowerCase()||t},set:function(n,t){return n.style.cssText=""+t}});i.support.optSelected||(i.propHooks.selected=i.extend(i.propHooks.selected,{get:function(n){var t=n.parentNode;return t&&(t.selectedIndex,t.parentNode&&t.parentNode.selectedIndex),null}}));i.support.enctype||(i.propFix.enctype="encoding");i.support.checkOn||i.each(["radio","checkbox"],function(){i.valHooks[this]={get:function(n){return n.getAttribute("value")===null?"on":n.value}}});i.each(["radio","checkbox"],function(){i.valHooks[this]=i.extend(i.valHooks[this],{set:function(n,t){if(i.isArray(t))return n.checked=i.inArray(i(n).val(),t)>=0}})});var wt=/^(?:textarea|input|select)$/i,pr=/^([^\.]*|)(?:\.(.+)|)$/,ne=/(?:^|\s)hover(\.\S+|)\b/,te=/^key/,ie=/^(?:mouse|contextmenu)|click/,wr=/^(?:focusinfocus|focusoutblur)$/,br=function(n){return i.event.special.hover?n:n.replace(ne,"mouseenter$1 mouseleave$1")};i.event={add:function(n,r,u,f,e){var a,s,v,y,p,o,b,l,w,c,h;if(n.nodeType!==3&&n.nodeType!==8&&r&&u&&(a=i._data(n))){for(u.handler&&(w=u,u=w.handler,e=w.selector),u.guid||(u.guid=i.guid++),v=a.events,v||(a.events=v={}),s=a.handle,s||(a.handle=s=function(n){return typeof i!="undefined"&&(!n||i.event.triggered!==n.type)?i.event.dispatch.apply(s.elem,arguments):t},s.elem=n),r=i.trim(br(r)).split(" "),y=0;y<r.length;y++)p=pr.exec(r[y])||[],o=p[1],b=(p[2]||"").split(".").sort(),h=i.event.special[o]||{},o=(e?h.delegateType:h.bindType)||o,h=i.event.special[o]||{},l=i.extend({type:o,origType:p[1],data:f,handler:u,guid:u.guid,selector:e,namespace:b.join(".")},w),c=v[o],c||(c=v[o]=[],c.delegateCount=0,h.setup&&h.setup.call(n,f,b,s)!==!1||(n.addEventListener?n.addEventListener(o,s,!1):n.attachEvent&&n.attachEvent("on"+o,s))),h.add&&(h.add.call(n,l),l.handler.guid||(l.handler.guid=u.guid)),e?c.splice(c.delegateCount++,0,l):c.push(l),i.event.global[o]=!0;n=null}},global:{},remove:function(n,t,r,u,f){var l,p,e,w,h,b,a,v,c,o,s,y=i.hasData(n)&&i._data(n);if(y&&(v=y.events)){for(t=i.trim(br(t||"")).split(" "),l=0;l<t.length;l++){if(p=pr.exec(t[l])||[],e=w=p[1],h=p[2],!e){for(e in v)i.event.remove(n,e+t[l],r,u,!0);continue}for(c=i.event.special[e]||{},e=(u?c.delegateType:c.bindType)||e,o=v[e]||[],b=o.length,h=h?new RegExp("(^|\\.)"+h.split(".").sort().join("\\.(?:.*\\.|)")+"(\\.|$)"):null,a=0;a<o.length;a++)s=o[a],(f||w===s.origType)&&(!r||r.guid===s.guid)&&(!h||h.test(s.namespace))&&(!u||u===s.selector||u==="**"&&s.selector)&&(o.splice(a--,1),s.selector&&o.delegateCount--,c.remove&&c.remove.call(n,s));o.length===0&&b!==o.length&&((!c.teardown||c.teardown.call(n,h,y.handle)===!1)&&i.removeEvent(n,e,y.handle),delete v[e])}i.isEmptyObject(v)&&(delete y.handle,i.removeData(n,"events",!0))}},customEvent:{getData:!0,setData:!0,changeData:!0},trigger:function(u,f,e,o){if(!e||e.nodeType!==3&&e.nodeType!==8){var w,d,c,h,l,v,a,y,p,k,s=u.type||u,b=[];if(wr.test(s+i.event.triggered))return;if(s.indexOf("!")>=0&&(s=s.slice(0,-1),d=!0),s.indexOf(".")>=0&&(b=s.split("."),s=b.shift(),b.sort()),(!e||i.event.customEvent[s])&&!i.event.global[s])return;if(u=typeof u=="object"?u[i.expando]?u:new i.Event(s,u):new i.Event(s),u.type=s,u.isTrigger=!0,u.exclusive=d,u.namespace=b.join("."),u.namespace_re=u.namespace?new RegExp("(^|\\.)"+b.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,v=s.indexOf(":")<0?"on"+s:"",!e){w=i.cache;for(c in w)w[c].events&&w[c].events[s]&&i.event.trigger(u,f,w[c].handle.elem,!0);return}if(u.result=t,u.target||(u.target=e),f=f!=null?i.makeArray(f):[],f.unshift(u),a=i.event.special[s]||{},a.trigger&&a.trigger.apply(e,f)===!1)return;if(p=[[e,a.bindType||s]],!o&&!a.noBubble&&!i.isWindow(e)){for(k=a.delegateType||s,h=wr.test(k+s)?e:e.parentNode,l=e;h;h=h.parentNode)p.push([h,k]),l=h;l===(e.ownerDocument||r)&&p.push([l.defaultView||l.parentWindow||n,k])}for(c=0;c<p.length&&!u.isPropagationStopped();c++)h=p[c][0],u.type=p[c][1],y=(i._data(h,"events")||{})[u.type]&&i._data(h,"handle"),y&&y.apply(h,f),y=v&&h[v],y&&i.acceptData(h)&&y.apply(h,f)===!1&&u.preventDefault();return u.type=s,!o&&!u.isDefaultPrevented()&&(!a._default||a._default.apply(e.ownerDocument,f)===!1)&&(s!=="click"||!i.nodeName(e,"a"))&&i.acceptData(e)&&v&&e[s]&&(s!=="focus"&&s!=="blur"||u.target.offsetWidth!==0)&&!i.isWindow(e)&&(l=e[v],l&&(e[v]=null),i.event.triggered=s,e[s](),i.event.triggered=t,l&&(e[v]=l)),u.result}return},dispatch:function(r){r=i.event.fix(r||n.event);var f,h,e,c,l,a,o,v,u,s,y=(i._data(this,"events")||{})[r.type]||[],p=y.delegateCount,k=[].slice.call(arguments),d=!r.exclusive&&!r.namespace,w=i.event.special[r.type]||{},b=[];if(k[0]=r,r.delegateTarget=this,!w.preDispatch||w.preDispatch.call(this,r)!==!1){if(p&&(!r.button||r.type!=="click"))for(c=i(this),c.context=this,e=r.target;e!=this;e=e.parentNode||this)if(e.disabled!==!0||r.type!=="click"){for(a={},v=[],c[0]=e,f=0;f<p;f++)u=y[f],s=u.selector,a[s]===t&&(a[s]=c.is(s)),a[s]&&v.push(u);v.length&&b.push({elem:e,matches:v})}for(y.length>p&&b.push({elem:this,matches:y.slice(p)}),f=0;f<b.length&&!r.isPropagationStopped();f++)for(o=b[f],r.currentTarget=o.elem,h=0;h<o.matches.length&&!r.isImmediatePropagationStopped();h++)u=o.matches[h],(d||!r.namespace&&!u.namespace||r.namespace_re&&r.namespace_re.test(u.namespace))&&(r.data=u.data,r.handleObj=u,l=((i.event.special[u.origType]||{}).handle||u.handler).apply(o.elem,k),l!==t&&(r.result=l,l===!1&&(r.preventDefault(),r.stopPropagation())));return w.postDispatch&&w.postDispatch.call(this,r),r.result}},props:"attrChange attrName relatedNode srcElement altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(n,t){return n.which==null&&(n.which=t.charCode!=null?t.charCode:t.keyCode),n}},mouseHooks:{props:"button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(n,i){var o,u,f,e=i.button,s=i.fromElement;return n.pageX==null&&i.clientX!=null&&(o=n.target.ownerDocument||r,u=o.documentElement,f=o.body,n.pageX=i.clientX+(u&&u.scrollLeft||f&&f.scrollLeft||0)-(u&&u.clientLeft||f&&f.clientLeft||0),n.pageY=i.clientY+(u&&u.scrollTop||f&&f.scrollTop||0)-(u&&u.clientTop||f&&f.clientTop||0)),!n.relatedTarget&&s&&(n.relatedTarget=s===n.target?i.toElement:s),!n.which&&e!==t&&(n.which=e&1?1:e&2?3:e&4?2:0),n}},fix:function(n){if(n[i.expando])return n;var f,e,t=n,u=i.event.fixHooks[n.type]||{},o=u.props?this.props.concat(u.props):this.props;for(n=i.Event(t),f=o.length;f;)e=o[--f],n[e]=t[e];return n.target||(n.target=t.srcElement||r),n.target.nodeType===3&&(n.target=n.target.parentNode),n.metaKey=!!n.metaKey,u.filter?u.filter(n,t):n},special:{ready:{setup:i.bindReady},load:{noBubble:!0},focus:{delegateType:"focusin"},blur:{delegateType:"focusout"},beforeunload:{setup:function(n,t,r){i.isWindow(this)&&(this.onbeforeunload=r)},teardown:function(n,t){this.onbeforeunload===t&&(this.onbeforeunload=null)}}},simulate:function(n,t,r,u){var f=i.extend(new i.Event,r,{type:n,isSimulated:!0,originalEvent:{}});u?i.event.trigger(f,null,t):i.event.dispatch.call(t,f);f.isDefaultPrevented()&&r.preventDefault()}};i.event.handle=i.event.dispatch;i.removeEvent=r.removeEventListener?function(n,t,i){n.removeEventListener&&n.removeEventListener(t,i,!1)}:function(n,t,i){var r="on"+t;n.detachEvent&&(typeof n[r]=="undefined"&&(n[r]=null),n.detachEvent(r,i))};i.Event=function(n,t){if(this instanceof i.Event)n&&n.type?(this.originalEvent=n,this.type=n.type,this.isDefaultPrevented=n.defaultPrevented||n.returnValue===!1||n.getPreventDefault&&n.getPreventDefault()?d:v):this.type=n,t&&i.extend(this,t),this.timeStamp=n&&n.timeStamp||i.now(),this[i.expando]=!0;else return new i.Event(n,t)};i.Event.prototype={preventDefault:function(){this.isDefaultPrevented=d;var n=this.originalEvent;n&&(n.preventDefault?n.preventDefault():n.returnValue=!1)},stopPropagation:function(){this.isPropagationStopped=d;var n=this.originalEvent;n&&(n.stopPropagation&&n.stopPropagation(),n.cancelBubble=!0)},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=d;this.stopPropagation()},isDefaultPrevented:v,isPropagationStopped:v,isImmediatePropagationStopped:v};i.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(n,t){i.event.special[n]={delegateType:t,bindType:t,handle:function(n){var f,e=this,r=n.relatedTarget,u=n.handleObj,o=u.selector;return r&&(r===e||i.contains(e,r))||(n.type=u.origType,f=u.handler.apply(this,arguments),n.type=t),f}}});i.support.submitBubbles||(i.event.special.submit={setup:function(){if(i.nodeName(this,"form"))return!1;i.event.add(this,"click._submit keypress._submit",function(n){var u=n.target,r=i.nodeName(u,"input")||i.nodeName(u,"button")?u.form:t;r&&!i._data(r,"_submit_attached")&&(i.event.add(r,"submit._submit",function(n){n._submit_bubble=!0}),i._data(r,"_submit_attached",!0))})},postDispatch:function(n){n._submit_bubble&&(delete n._submit_bubble,this.parentNode&&!n.isTrigger&&i.event.simulate("submit",this.parentNode,n,!0))},teardown:function(){if(i.nodeName(this,"form"))return!1;i.event.remove(this,"._submit")}});i.support.changeBubbles||(i.event.special.change={setup:function(){if(wt.test(this.nodeName))return(this.type==="checkbox"||this.type==="radio")&&(i.event.add(this,"propertychange._change",function(n){n.originalEvent.propertyName==="checked"&&(this._just_changed=!0)}),i.event.add(this,"click._change",function(n){this._just_changed&&!n.isTrigger&&(this._just_changed=!1);i.event.simulate("change",this,n,!0)})),!1;i.event.add(this,"beforeactivate._change",function(n){var t=n.target;wt.test(t.nodeName)&&!i._data(t,"_change_attached")&&(i.event.add(t,"change._change",function(n){!this.parentNode||n.isSimulated||n.isTrigger||i.event.simulate("change",this.parentNode,n,!0)}),i._data(t,"_change_attached",!0))})},handle:function(n){var t=n.target;if(this!==t||n.isSimulated||n.isTrigger||t.type!=="radio"&&t.type!=="checkbox")return n.handleObj.handler.apply(this,arguments)},teardown:function(){return i.event.remove(this,"._change"),wt.test(this.nodeName)}});i.support.focusinBubbles||i.each({focus:"focusin",blur:"focusout"},function(n,t){var u=0,f=function(n){i.event.simulate(t,n.target,i.event.fix(n),!0)};i.event.special[t]={setup:function(){u++==0&&r.addEventListener(n,f,!0)},teardown:function(){--u==0&&r.removeEventListener(n,f,!0)}}});i.fn.extend({on:function(n,r,u,f,e){var o,s;if(typeof n=="object"){typeof r!="string"&&(u=u||r,r=t);for(s in n)this.on(s,r,u,n[s],e);return this}if(u==null&&f==null?(f=r,u=r=t):f==null&&(typeof r=="string"?(f=u,u=t):(f=u,u=r,r=t)),f===!1)f=v;else if(!f)return this;return e===1&&(o=f,f=function(n){return i().off(n),o.apply(this,arguments)},f.guid=o.guid||(o.guid=i.guid++)),this.each(function(){i.event.add(this,n,f,u,r)})},one:function(n,t,i,r){return this.on(n,t,i,r,1)},off:function(n,r,u){var f,e;if(n&&n.preventDefault&&n.handleObj)return f=n.handleObj,i(n.delegateTarget).off(f.namespace?f.origType+"."+f.namespace:f.origType,f.selector,f.handler),this;if(typeof n=="object"){for(e in n)this.off(e,r,n[e]);return this}return(r===!1||typeof r=="function")&&(u=r,r=t),u===!1&&(u=v),this.each(function(){i.event.remove(this,n,u,r)})},bind:function(n,t,i){return this.on(n,null,t,i)},unbind:function(n,t){return this.off(n,null,t)},live:function(n,t,r){return i(this.context).on(n,this.selector,t,r),this},die:function(n,t){return i(this.context).off(n,this.selector||"**",t),this},delegate:function(n,t,i,r){return this.on(t,n,i,r)},undelegate:function(n,t,i){return arguments.length==1?this.off(n,"**"):this.off(t,n||"**",i)},trigger:function(n,t){return this.each(function(){i.event.trigger(n,t,this)})},triggerHandler:function(n,t){if(this[0])return i.event.trigger(n,t,this[0],!0)},toggle:function(n){var t=arguments,u=n.guid||i.guid++,r=0,f=function(u){var f=(i._data(this,"lastToggle"+n.guid)||0)%r;return i._data(this,"lastToggle"+n.guid,f+1),u.preventDefault(),t[f].apply(this,arguments)||!1};for(f.guid=u;r<t.length;)t[r++].guid=u;return this.click(f)},hover:function(n,t){return this.mouseenter(n).mouseleave(t||n)}});i.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(n,t){i.fn[t]=function(n,i){return i==null&&(i=n,n=null),arguments.length>0?this.on(t,null,n,i):this.trigger(t)};te.test(t)&&(i.event.fixHooks[t]=i.event.keyHooks);ie.test(t)&&(i.event.fixHooks[t]=i.event.mouseHooks)}),function(n,t){function yt(n,t,i,u){for(var f=0,e=t.length;f<e;f++)r(n,t[f],i,u)}function fi(n,t,i,f,e,o){var s,h=u.setFilters[t.toLowerCase()];return h||r.error(t),(n||!(s=e))&&yt(n||"*",f,s=[],e),s.length>0?h(s,i,o):[]}function ei(n,i,u,e,o){for(var c,d,a,v,h,w,s,b,k=0,nt=o.length,p=l.POS,tt=new RegExp("^"+p.source+"(?!"+f+")","i"),it=function(){for(var n=1,i=arguments.length-2;n<i;n++)arguments[n]===t&&(c[n]=t)};k<nt;k++){for(p.exec(""),n=o[k],v=[],a=0,h=e;c=p.exec(n);)b=p.lastIndex=c.index+c[0].length,b>a&&(s=n.slice(a,c.index),a=b,w=[i],g.test(s)&&(h&&(w=h),h=e),(d=pi.test(s))&&(s=s.slice(0,-5).replace(g,"$&*")),c.length>1&&c[0].replace(tt,it),h=fi(s,c[1],c[2],w,h,d));h?(v=v.concat(h),(s=n.slice(a))&&s!==")"?g.test(s)?yt(s,v,u,e):r(s,i,u,e?e.concat(h):h):y.apply(u,v)):r(n,i,u,e)}return nt===1?u:r.uniqueSort(u)}function oi(n,t,i){for(var c,e,h,a=[],v=0,f=ii.exec(n),o=!f.pop()&&!f.pop(),p=o&&n.match(ft)||[""],y=u.preFilter,w=u.filter,b=!i&&t!==s;(e=p[v])!=null&&o;v++)for(a.push(c=[]),b&&(e=" "+e);e;){o=!1;(f=g.exec(e))&&(e=e.slice(f[0].length),o=c.push({part:f.pop().replace(ut," "),captures:f}));for(h in w)(f=l[h].exec(e))&&(!y[h]||(f=y[h](f,t,i)))&&(e=e.slice(f.shift().length),o=c.push({part:h,captures:f}));if(!o)break}return o||r.error(n),a}function si(n,t,i){var r=t.dir,u=kt++;return n||(n=function(n){return n===i}),t.first?function(t,i){while(t=t[r])if(t.nodeType===1)return n(t,i)&&t}:function(t,i){for(var f,e=u+"."+wt,s=e+"."+pt;t=t[r];)if(t.nodeType===1){if((f=t[o])===s)return t.sizset;if(typeof f=="string"&&f.indexOf(e)===0){if(t.sizset)return t}else{if(t[o]=s,n(t,i))return t.sizset=!0,t;t.sizset=!1}}}}function hi(n,t){return n?function(i,r){var u=t(i,r);return u&&n(u===!0?i:u,r)}:t}function ci(n,t,i){for(var r,f,e=0;r=n[e];e++)u.relative[r.part]?f=si(f,u.relative[r.part],t):(r.captures.push(t,i),f=hi(f,u.filter[r.part].apply(null,r.captures)));return f}function li(n){return function(t,i){for(var r,u=0;r=n[u];u++)if(r(t,i))return!0;return!1}}var pt,wt,k,w,it,s=n.document,e=s.documentElement,h="undefined",d=!1,bt=!0,kt=0,c=[].slice,y=[].push,o=("sizcache"+Math.random()).replace(".",""),f="[\\x20\\t\\r\\n\\f]",v="(?:\\\\.|[-\\w]|[^\\x00-\\xa0])+",ai=v.replace("w","w#"),dt="\\["+f+"*("+v+")"+f+"*(?:([*^$|!~]?=)"+f+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+ai+")|)|)"+f+"*\\]",gt=":("+v+")(?:\\((?:(['\"])((?:\\\\.|[^\\\\])*?)\\2|((?:[^,]|\\\\,|(?:,(?=[^\\[]*\\]))|(?:,(?=[^\\(]*\\))))*))\\)|)",ni=":(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\)|)(?=[^-]|$)",ti=f+"*([\\x20\\t\\r\\n\\f>+~])"+f+"*",rt="(?=[^\\x20\\t\\r\\n\\f])(?:\\\\.|"+dt+"|"+gt.replace(2,7)+"|[^\\\\(),])+",ut=new RegExp("^"+f+"+|((?:^|[^\\\\])(?:\\\\.)*)"+f+"+$","g"),g=new RegExp("^"+ti),ft=new RegExp(rt+"?(?="+f+"*,|$)","g"),ii=new RegExp("^(?:(?!,)(?:(?:^|,)"+f+"*"+rt+")*?|"+f+"*(.*?))(\\)|$)"),vi=new RegExp(rt.slice(19,-6)+"\\x20\\t\\r\\n\\f>+~])+|"+ti,"g"),yi=/^(?:#([\w\-]+)|(\w+)|\.([\w\-]+))$/,et=/[\x20\t\r\n\f]*[+~]/,pi=/:not\($/,wi=/h\d/i,bi=/input|select|textarea|button/i,p=/\\(?!\\)/g,l={ID:new RegExp("^#("+v+")"),CLASS:new RegExp("^\\.("+v+")"),NAME:new RegExp("^\\[name=['\"]?("+v+")['\"]?\\]"),TAG:new RegExp("^("+v.replace("[-","[-\\*")+")"),ATTR:new RegExp("^"+dt),PSEUDO:new RegExp("^"+gt),CHILD:new RegExp("^:(only|nth|last|first)-child(?:\\("+f+"*(even|odd|(([+-]|)(\\d*)n|)"+f+"*(?:([+-]|)"+f+"*(\\d+)|))"+f+"*\\)|)","i"),POS:new RegExp(ni,"ig"),needsContext:new RegExp("^"+f+"*[>+~]|"+ni,"i")},ot={},st=[],ht={},ct=[],nt=function(n){return n.sizzleFilter=!0,n},b=function(n){return function(t){return t.nodeName.toLowerCase()==="input"&&t.type===n}},ri=function(n){return function(t){var i=t.nodeName.toLowerCase();return(i==="input"||i==="button")&&t.type===n}},a=function(n){var t=!1,i=s.createElement("div");try{t=n(i)}catch(r){}return i=null,t},ki=a(function(n){n.innerHTML="<select><\/select>";var t=typeof n.lastChild.getAttribute("multiple");return t!=="boolean"&&t!=="string"}),di=a(function(n){n.id=o+0;n.innerHTML="<a name='"+o+"'><\/a><div name='"+o+"'><\/div>";e.insertBefore(n,e.firstChild);var t=s.getElementsByName&&s.getElementsByName(o).length===2+s.getElementsByName(o+0).length;return it=!s.getElementById(o),e.removeChild(n),t}),gi=a(function(n){return n.appendChild(s.createComment("")),n.getElementsByTagName("*").length===0}),nr=a(function(n){return n.innerHTML="<a href='#'><\/a>",n.firstChild&&typeof n.firstChild.getAttribute!==h&&n.firstChild.getAttribute("href")==="#"}),ui=a(function(n){return n.innerHTML="<div class='hidden e'><\/div><div class='hidden'><\/div>",!n.getElementsByClassName||n.getElementsByClassName("e").length===0?!1:(n.lastChild.className="e",n.getElementsByClassName("e").length!==1)}),r=function(n,t,i,r){i=i||[];t=t||s;var e,u,o,f,h=t.nodeType;if(h!==1&&h!==9)return[];if(!n||typeof n!="string")return i;if(o=lt(t),!o&&!r&&(e=yi.exec(n)))if(f=e[1]){if(h===9){if(u=t.getElementById(f),!u||!u.parentNode)return i;if(u.id===f)return i.push(u),i}else if(t.ownerDocument&&(u=t.ownerDocument.getElementById(f))&&tr(t,u)&&u.id===f)return i.push(u),i}else{if(e[2])return y.apply(i,c.call(t.getElementsByTagName(n),0)),i;if((f=e[3])&&ui&&t.getElementsByClassName)return y.apply(i,c.call(t.getElementsByClassName(f),0)),i}return tt(n,t,i,r,o)},u=r.selectors={cacheLength:50,match:l,order:["ID","TAG"],attrHandle:{},createPseudo:nt,find:{ID:it?function(n,t,i){if(typeof t.getElementById!==h&&!i){var r=t.getElementById(n);return r&&r.parentNode?[r]:[]}}:function(n,i,r){if(typeof i.getElementById!==h&&!r){var u=i.getElementById(n);return u?u.id===n||typeof u.getAttributeNode!==h&&u.getAttributeNode("id").value===n?[u]:t:[]}},TAG:gi?function(n,t){if(typeof t.getElementsByTagName!==h)return t.getElementsByTagName(n)}:function(n,t){var f=t.getElementsByTagName(n),i,r,u;if(n==="*"){for(r=[],u=0;i=f[u];u++)i.nodeType===1&&r.push(i);return r}return f}},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(n){return n[1]=n[1].replace(p,""),n[3]=(n[4]||n[5]||"").replace(p,""),n[2]==="~="&&(n[3]=" "+n[3]+" "),n.slice(0,4)},CHILD:function(n){return n[1]=n[1].toLowerCase(),n[1]==="nth"?(n[2]||r.error(n[0]),n[3]=+(n[3]?n[4]+(n[5]||1):2*(n[2]==="even"||n[2]==="odd")),n[4]=+(n[6]+n[7]||n[2]==="odd")):n[2]&&r.error(n[0]),n},PSEUDO:function(n){var i,t=n[4];return l.CHILD.test(n[0])?null:(t&&(i=ii.exec(t))&&i.pop()&&(n[0]=n[0].slice(0,i[0].length-t.length-1),t=i[0].slice(0,-1)),n.splice(2,3,t||n[3]),n)}},filter:{ID:it?function(n){return n=n.replace(p,""),function(t){return t.getAttribute("id")===n}}:function(n){return n=n.replace(p,""),function(t){var i=typeof t.getAttributeNode!==h&&t.getAttributeNode("id");return i&&i.value===n}},TAG:function(n){return n==="*"?function(){return!0}:(n=n.replace(p,"").toLowerCase(),function(t){return t.nodeName&&t.nodeName.toLowerCase()===n})},CLASS:function(n){var t=ot[n];return t||(t=ot[n]=new RegExp("(^|"+f+")"+n+"("+f+"|$)"),st.push(n),st.length>u.cacheLength&&delete ot[st.shift()]),function(n){return t.test(n.className||typeof n.getAttribute!==h&&n.getAttribute("class")||"")}},ATTR:function(n,t,i){return t?function(u){var e=r.attr(u,n),f=e+"";if(e==null)return t==="!=";switch(t){case"=":return f===i;case"!=":return f!==i;case"^=":return i&&f.indexOf(i)===0;case"*=":return i&&f.indexOf(i)>-1;case"$=":return i&&f.substr(f.length-i.length)===i;case"~=":return(" "+f+" ").indexOf(i)>-1;case"|=":return f===i||f.substr(0,i.length+1)===i+"-"}}:function(t){return r.attr(t,n)!=null}},CHILD:function(n,t,i,r){if(n==="nth"){var u=kt++;return function(n){var f,e,s=0,t=n;if(i===1&&r===0)return!0;if(f=n.parentNode,f&&(f[o]!==u||!n.sizset)){for(t=f.firstChild;t;t=t.nextSibling)if(t.nodeType===1&&(t.sizset=++s,t===n))break;f[o]=u}return e=n.sizset-r,i===0?e===0:e%i==0&&e/i>=0}}return function(t){var i=t;switch(n){case"only":case"first":while(i=i.previousSibling)if(i.nodeType===1)return!1;if(n==="first")return!0;i=t;case"last":while(i=i.nextSibling)if(i.nodeType===1)return!1;return!0}}},PSEUDO:function(n,t,i,f){var e=u.pseudos[n]||u.pseudos[n.toLowerCase()];return e||r.error("unsupported pseudo: "+n),e.sizzleFilter?e(t,i,f):e}},pseudos:{not:nt(function(n,t,i){var r=vt(n.replace(ut,"$1"),t,i);return function(n){return!r(n)}}),enabled:function(n){return n.disabled===!1},disabled:function(n){return n.disabled===!0},checked:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&!!n.checked||t==="option"&&!!n.selected},selected:function(n){return n.parentNode&&n.parentNode.selectedIndex,n.selected===!0},parent:function(n){return!u.pseudos.empty(n)},empty:function(n){var t;for(n=n.firstChild;n;){if(n.nodeName>"@"||(t=n.nodeType)===3||t===4)return!1;n=n.nextSibling}return!0},contains:nt(function(n){return function(t){return(t.textContent||t.innerText||at(t)).indexOf(n)>-1}}),has:nt(function(n){return function(t){return r(n,t).length>0}}),header:function(n){return wi.test(n.nodeName)},text:function(n){var t,i;return n.nodeName.toLowerCase()==="input"&&(t=n.type)==="text"&&((i=n.getAttribute("type"))==null||i.toLowerCase()===t)},radio:b("radio"),checkbox:b("checkbox"),file:b("file"),password:b("password"),image:b("image"),submit:ri("submit"),reset:ri("reset"),button:function(n){var t=n.nodeName.toLowerCase();return t==="input"&&n.type==="button"||t==="button"},input:function(n){return bi.test(n.nodeName)},focus:function(n){var t=n.ownerDocument;return n===t.activeElement&&(!t.hasFocus||t.hasFocus())&&(!!n.type||!!n.href)},active:function(n){return n===n.ownerDocument.activeElement}},setFilters:{first:function(n,t,i){return i?n.slice(1):[n[0]]},last:function(n,t,i){var r=n.pop();return i?n:[r]},even:function(n,t,i){for(var u=[],r=i?1:0,f=n.length;r<f;r=r+2)u.push(n[r]);return u},odd:function(n,t,i){for(var u=[],r=i?0:1,f=n.length;r<f;r=r+2)u.push(n[r]);return u},lt:function(n,t,i){return i?n.slice(+t):n.slice(0,+t)},gt:function(n,t,i){return i?n.slice(0,+t+1):n.slice(+t+1)},eq:function(n,t,i){var r=n.splice(+t,1);return i?n:r}}},vt,tt;u.setFilters.nth=u.setFilters.eq;u.filters=u.pseudos;nr||(u.attrHandle={href:function(n){return n.getAttribute("href",2)},type:function(n){return n.getAttribute("type")}});di&&(u.order.push("NAME"),u.find.NAME=function(n,t){if(typeof t.getElementsByName!==h)return t.getElementsByName(n)});ui&&(u.order.splice(1,0,"CLASS"),u.find.CLASS=function(n,t,i){if(typeof t.getElementsByClassName!==h&&!i)return t.getElementsByClassName(n)});try{c.call(e.childNodes,0)[0].nodeType}catch(ir){c=function(n){for(var t,i=[];t=this[n];n++)i.push(t);return i}}var lt=r.isXML=function(n){var t=n&&(n.ownerDocument||n).documentElement;return t?t.nodeName!=="HTML":!1},tr=r.contains=e.compareDocumentPosition?function(n,t){return!!(n.compareDocumentPosition(t)&16)}:e.contains?function(n,t){var r=n.nodeType===9?n.documentElement:n,i=t.parentNode;return n===i||!!(i&&i.nodeType===1&&r.contains&&r.contains(i))}:function(n,t){while(t=t.parentNode)if(t===n)return!0;return!1},at=r.getText=function(n){var r,i="",u=0,t=n.nodeType;if(t){if(t===1||t===9||t===11){if(typeof n.textContent=="string")return n.textContent;for(n=n.firstChild;n;n=n.nextSibling)i+=at(n)}else if(t===3||t===4)return n.nodeValue}else for(;r=n[u];u++)i+=at(r);return i};r.attr=function(n,t){var i,r=lt(n);return r||(t=t.toLowerCase()),u.attrHandle[t]?u.attrHandle[t](n):ki||r?n.getAttribute(t):(i=n.getAttributeNode(t),i?typeof n[t]=="boolean"?n[t]?t:null:i.specified?i.value:null:null)};r.error=function(n){throw new Error("Syntax error, unrecognized expression: "+n);};[0,0].sort(function(){return bt=0});e.compareDocumentPosition?k=function(n,t){return n===t?(d=!0,0):(!n.compareDocumentPosition||!t.compareDocumentPosition?n.compareDocumentPosition:n.compareDocumentPosition(t)&4)?-1:1}:(k=function(n,t){var i;if(n===t)return d=!0,0;if(n.sourceIndex&&t.sourceIndex)return n.sourceIndex-t.sourceIndex;var e,h,u=[],f=[],o=n.parentNode,s=t.parentNode,r=o;if(o===s)return w(n,t);if(!o)return-1;if(!s)return 1;while(r)u.unshift(r),r=r.parentNode;for(r=s;r;)f.unshift(r),r=r.parentNode;for(e=u.length,h=f.length,i=0;i<e&&i<h;i++)if(u[i]!==f[i])return w(u[i],f[i]);return i===e?w(n,f[i],-1):w(u[i],t,1)},w=function(n,t,i){if(n===t)return i;for(var r=n.nextSibling;r;){if(r===t)return-1;r=r.nextSibling}return 1});r.uniqueSort=function(n){var i,t=1;if(k&&(d=bt,n.sort(k),d))for(;i=n[t];t++)i===n[t-1]&&n.splice(t--,1);return n};vt=r.compile=function(n,t,i){var o,f,e,r=ht[n];if(r&&r.context===t)return r;for(f=oi(n,t,i),e=0;o=f[e];e++)f[e]=ci(o,t,i);return r=ht[n]=li(f),r.context=t,r.runs=r.dirruns=0,ct.push(n),ct.length>u.cacheLength&&delete ht[ct.shift()],r};r.matches=function(n,t){return r(n,null,null,t)};r.matchesSelector=function(n,t){return r(t,null,null,[n]).length>0};tt=function(n,t,i,r,f){n=n.replace(ut,"$1");var o,a,s,d,k,v,w,g,b,e=n.match(ft),h=n.match(vi),nt=t.nodeType;if(l.POS.test(n))return ei(n,t,i,r,e);if(r)o=c.call(r,0);else if(e&&e.length===1){if(h.length>1&&nt===9&&!f&&(e=l.ID.exec(h[0]))){if(t=u.find.ID(e[1],t,f)[0],!t)return i;n=n.slice(h.shift().length)}for(g=(e=et.exec(h[0]))&&!e.index&&t.parentNode||t,b=h.pop(),v=b.split(":not")[0],s=0,d=u.order.length;s<d;s++)if(w=u.order[s],e=l[w].exec(v)){if(o=u.find[w]((e[1]||"").replace(p,""),g,f),o==null)continue;v===b&&(n=n.slice(0,n.length-b.length)+v.replace(l[w],""),n||y.apply(i,c.call(o,0)));break}}if(n)for(a=vt(n,t,f),wt=a.dirruns++,o==null&&(o=u.find.TAG("*",et.test(n)&&t.parentNode||t)),s=0;k=o[s];s++)pt=a.runs++,a(k,t)&&i.push(k);return i};s.querySelectorAll&&function(){var s,h=tt,l=/'|\\/g,v=/\=[\x20\t\r\n\f]*([^'"\]]*)[\x20\t\r\n\f]*\]/g,n=[],t=[":active"],i=e.matchesSelector||e.mozMatchesSelector||e.webkitMatchesSelector||e.oMatchesSelector||e.msMatchesSelector;a(function(t){t.innerHTML="<select><option selected><\/option><\/select>";t.querySelectorAll("[selected]").length||n.push("\\["+f+"*(?:checked|disabled|ismap|multiple|readonly|selected|value)");t.querySelectorAll(":checked").length||n.push(":checked")});a(function(t){t.innerHTML="<p test=''><\/p>";t.querySelectorAll("[test^='']").length&&n.push("[*^$]="+f+"*(?:\"\"|'')");t.innerHTML="<input type='hidden'>";t.querySelectorAll(":enabled").length||n.push(":enabled",":disabled")});n=n.length&&new RegExp(n.join("|"));tt=function(t,i,r,u,f){if(!u&&!f&&(!n||!n.test(t)))if(i.nodeType===9)try{return y.apply(r,c.call(i.querySelectorAll(t),0)),r}catch(v){}else if(i.nodeType===1&&i.nodeName.toLowerCase()!=="object"){var s=i.getAttribute("id"),e=s||o,a=et.test(t)&&i.parentNode||i;s?e=e.replace(l,"\\$&"):i.setAttribute("id",e);try{return y.apply(r,c.call(a.querySelectorAll(t.replace(ft,"[id='"+e+"'] $&")),0)),r}catch(v){}finally{s||i.removeAttribute("id")}}return h(t,i,r,u,f)};i&&(a(function(n){s=i.call(n,"div");try{i.call(n,"[test!='']:sizzle");t.push(u.match.PSEUDO)}catch(r){}}),t=new RegExp(t.join("|")),r.matchesSelector=function(u,f){if(f=f.replace(v,"='$1']"),!lt(u)&&!t.test(f)&&(!n||!n.test(f)))try{var e=i.call(u,f);if(e||s||u.document&&u.document.nodeType!==11)return e}catch(o){}return r(f,null,null,[u]).length>0})}();r.attr=i.attr;i.find=r;i.expr=r.selectors;i.expr[":"]=i.expr.pseudos;i.unique=r.uniqueSort;i.text=r.getText;i.isXMLDoc=r.isXML;i.contains=r.contains}(n);var re=/Until$/,ue=/^(?:parents|prev(?:Until|All))/,fe=/^.[^:#\[\.,]*$/,kr=i.expr.match.needsContext,ee={children:!0,contents:!0,next:!0,prev:!0};i.fn.extend({find:function(n){var t,f,o,u,e,r,s=this;if(typeof n!="string")return i(n).filter(function(){for(t=0,f=s.length;t<f;t++)if(i.contains(s[t],this))return!0});for(r=this.pushStack("","find",n),t=0,f=this.length;t<f;t++)if(o=r.length,i.find(n,this[t],r),t>0)for(u=o;u<r.length;u++)for(e=0;e<o;e++)if(r[e]===r[u]){r.splice(u--,1);break}return r},has:function(n){var t,r=i(n,this),u=r.length;return this.filter(function(){for(t=0;t<u;t++)if(i.contains(this,r[t]))return!0})},not:function(n){return this.pushStack(fi(this,n,!1),"not",n)},filter:function(n){return this.pushStack(fi(this,n,!0),"filter",n)},is:function(n){return!!n&&(typeof n=="string"?kr.test(n)?i(n,this.context).index(this[0])>=0:i.filter(n,this).length>0:this.filter(n).length>0)},closest:function(n,t){for(var r,f=0,o=this.length,u=[],e=kr.test(n)||typeof n!="string"?i(n,t||this.context):0;f<o;f++)for(r=this[f];r&&r.ownerDocument&&r!==t&&r.nodeType!==11;){if(e?e.index(r)>-1:i.find.matchesSelector(r,n)){u.push(r);break}r=r.parentNode}return u=u.length>1?i.unique(u):u,this.pushStack(u,"closest",n)},index:function(n){return n?typeof n=="string"?i.inArray(this[0],i(n)):i.inArray(n.jquery?n[0]:n,this):this[0]&&this[0].parentNode?this.prevAll().length:-1},add:function(n,t){var u=typeof n=="string"?i(n,t):i.makeArray(n&&n.nodeType?[n]:n),r=i.merge(this.get(),u);return this.pushStack(b(u[0])||b(r[0])?r:i.unique(r))},addBack:function(n){return this.add(n==null?this.prevObject:this.prevObject.filter(n))}});i.fn.andSelf=i.fn.addBack;i.each({parent:function(n){var t=n.parentNode;return t&&t.nodeType!==11?t:null},parents:function(n){return i.dir(n,"parentNode")},parentsUntil:function(n,t,r){return i.dir(n,"parentNode",r)},next:function(n){return ui(n,"nextSibling")},prev:function(n){return ui(n,"previousSibling")},nextAll:function(n){return i.dir(n,"nextSibling")},prevAll:function(n){return i.dir(n,"previousSibling")},nextUntil:function(n,t,r){return i.dir(n,"nextSibling",r)},prevUntil:function(n,t,r){return i.dir(n,"previousSibling",r)},siblings:function(n){return i.sibling((n.parentNode||{}).firstChild,n)},children:function(n){return i.sibling(n.firstChild)},contents:function(n){return i.nodeName(n,"iframe")?n.contentDocument||n.contentWindow.document:i.merge([],n.childNodes)}},function(n,t){i.fn[n]=function(r,u){var f=i.map(this,t,r);return re.test(n)||(u=r),u&&typeof u=="string"&&(f=i.filter(u,f)),f=this.length>1&&!ee[n]?i.unique(f):f,this.length>1&&ue.test(n)&&(f=f.reverse()),this.pushStack(f,n,o.call(arguments).join(","))}});i.extend({filter:function(n,t,r){return r&&(n=":not("+n+")"),t.length===1?i.find.matchesSelector(t[0],n)?[t[0]]:[]:i.find.matches(n,t)},dir:function(n,r,u){for(var e=[],f=n[r];f&&f.nodeType!==9&&(u===t||f.nodeType!==1||!i(f).is(u));)f.nodeType===1&&e.push(f),f=f[r];return e},sibling:function(n,t){for(var i=[];n;n=n.nextSibling)n.nodeType===1&&n!==t&&i.push(n);return i}});var dr="abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|header|hgroup|mark|meter|nav|output|progress|section|summary|time|video",oe=/ jQuery\d+="(?:null|\d+)"/g,bt=/^\s+/,gr=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,nu=/<([\w:]+)/,se=/<tbody/i,he=/<|&#?\w+;/,ce=/<(?:script|style|link)/i,le=/<(?:script|object|embed|option|style)/i,kt=new RegExp("<(?:"+dr+")[\\s/>]","i"),tu=/^(?:checkbox|radio)$/,iu=/checked\s*(?:[^=]|=\s*.checked.)/i,ae=/\/(java|ecma)script/i,ve=/^\s*<!(?:\[CDATA\[|\-\-)|[\]\-]{2}>\s*$/g,e={option:[1,"<select multiple='multiple'>","<\/select>"],legend:[1,"<fieldset>","<\/fieldset>"],thead:[1,"<table>","<\/table>"],tr:[2,"<table><tbody>","<\/tbody><\/table>"],td:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"],col:[2,"<table><tbody><\/tbody><colgroup>","<\/colgroup><\/table>"],area:[1,"<map>","<\/map>"],_default:[0,"",""]},ru=ei(r),dt=ru.appendChild(r.createElement("div"));e.optgroup=e.option;e.tbody=e.tfoot=e.colgroup=e.caption=e.thead;e.th=e.td;i.support.htmlSerialize||(e._default=[1,"X<div>","<\/div>"]);i.fn.extend({text:function(n){return i.access(this,function(n){return n===t?i.text(this):this.empty().append((this[0]&&this[0].ownerDocument||r).createTextNode(n))},null,n,arguments.length)},wrapAll:function(n){if(i.isFunction(n))return this.each(function(t){i(this).wrapAll(n.call(this,t))});if(this[0]){var t=i(n,this[0].ownerDocument).eq(0).clone(!0);this[0].parentNode&&t.insertBefore(this[0]);t.map(function(){for(var n=this;n.firstChild&&n.firstChild.nodeType===1;)n=n.firstChild;return n}).append(this)}return this},wrapInner:function(n){return i.isFunction(n)?this.each(function(t){i(this).wrapInner(n.call(this,t))}):this.each(function(){var t=i(this),r=t.contents();r.length?r.wrapAll(n):t.append(n)})},wrap:function(n){var t=i.isFunction(n);return this.each(function(r){i(this).wrapAll(t?n.call(this,r):n)})},unwrap:function(){return this.parent().each(function(){i.nodeName(this,"body")||i(this).replaceWith(this.childNodes)}).end()},append:function(){return this.domManip(arguments,!0,function(n){(this.nodeType===1||this.nodeType===11)&&this.appendChild(n)})},prepend:function(){return this.domManip(arguments,!0,function(n){(this.nodeType===1||this.nodeType===11)&&this.insertBefore(n,this.firstChild)})},before:function(){if(!b(this[0]))return this.domManip(arguments,!1,function(n){this.parentNode.insertBefore(n,this)});if(arguments.length){var n=i.clean(arguments);return this.pushStack(i.merge(n,this),"before",this.selector)}},after:function(){if(!b(this[0]))return this.domManip(arguments,!1,function(n){this.parentNode.insertBefore(n,this.nextSibling)});if(arguments.length){var n=i.clean(arguments);return this.pushStack(i.merge(this,n),"after",this.selector)}},remove:function(n,t){for(var r,u=0;(r=this[u])!=null;u++)(!n||i.filter(n,[r]).length)&&(t||r.nodeType!==1||(i.cleanData(r.getElementsByTagName("*")),i.cleanData([r])),r.parentNode&&r.parentNode.removeChild(r));return this},empty:function(){for(var n,t=0;(n=this[t])!=null;t++)for(n.nodeType===1&&i.cleanData(n.getElementsByTagName("*"));n.firstChild;)n.removeChild(n.firstChild);return this},clone:function(n,t){return n=n==null?!1:n,t=t==null?n:t,this.map(function(){return i.clone(this,n,t)})},html:function(n){return i.access(this,function(n){var r=this[0]||{},u=0,f=this.length;if(n===t)return r.nodeType===1?r.innerHTML.replace(oe,""):t;if(typeof n=="string"&&!ce.test(n)&&(i.support.htmlSerialize||!kt.test(n))&&(i.support.leadingWhitespace||!bt.test(n))&&!e[(nu.exec(n)||["",""])[1].toLowerCase()]){n=n.replace(gr,"<$1><\/$2>");try{for(;u<f;u++)r=this[u]||{},r.nodeType===1&&(i.cleanData(r.getElementsByTagName("*")),r.innerHTML=n);r=0}catch(o){}}r&&this.empty().append(n)},null,n,arguments.length)},replaceWith:function(n){return b(this[0])?this.length?this.pushStack(i(i.isFunction(n)?n():n),"replaceWith",n):this:i.isFunction(n)?this.each(function(t){var r=i(this),u=r.html();r.replaceWith(n.call(this,t,u))}):(typeof n!="string"&&(n=i(n).detach()),this.each(function(){var t=this.nextSibling,r=this.parentNode;i(this).remove();t?i(t).before(n):i(r).append(n)}))},detach:function(n){return this.remove(n,!0)},domManip:function(n,r,u){n=[].concat.apply([],n);var h,o,f,a,e=0,s=n[0],c=[],l=this.length;if(!i.support.checkClone&&l>1&&typeof s=="string"&&iu.test(s))return this.each(function(){i(this).domManip(n,r,u)});if(i.isFunction(s))return this.each(function(f){var e=i(this);n[0]=s.call(this,f,r?e.html():t);e.domManip(n,r,u)});if(this[0]){if(h=i.buildFragment(n,this,c),f=h.fragment,o=f.firstChild,f.childNodes.length===1&&(f=o),o)for(r=r&&i.nodeName(o,"tr"),a=h.cacheable||l-1;e<l;e++)u.call(r&&i.nodeName(this[e],"table")?wu(this[e],"tbody"):this[e],e===a?f:i.clone(f,!0,!0));f=o=null;c.length&&i.each(c,function(n,t){t.src?i.ajax?i.ajax({url:t.src,type:"GET",dataType:"script",async:!1,global:!1,throws:!0}):i.error("no ajax"):i.globalEval((t.text||t.textContent||t.innerHTML||"").replace(ve,""));t.parentNode&&t.parentNode.removeChild(t)})}return this}});i.buildFragment=function(n,u,f){var o,s,h,e=n[0];return u=u||r,u=(u[0]||u).ownerDocument||u[0]||u,typeof u.createDocumentFragment=="undefined"&&(u=r),n.length===1&&typeof e=="string"&&e.length<512&&u===r&&e.charAt(0)==="<"&&!le.test(e)&&(i.support.checkClone||!iu.test(e))&&(i.support.html5Clone||!kt.test(e))&&(s=!0,o=i.fragments[e],h=o!==t),o||(o=u.createDocumentFragment(),i.clean(n,u,o,f),s&&(i.fragments[e]=h&&o)),{fragment:o,cacheable:s}};i.fragments={};i.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(n,t){i.fn[n]=function(r){var o,u=0,s=[],f=i(r),h=f.length,e=this.length===1&&this[0].parentNode;if((e==null||e&&e.nodeType===11&&e.childNodes.length===1)&&h===1)return f[t](this[0]),this;for(;u<h;u++)o=(u>0?this.clone(!0):this).get(),i(f[u])[t](o),s=s.concat(o);return this.pushStack(s,n,f.selector)}});i.extend({clone:function(n,t,r){var f,o,u,e;if(i.support.html5Clone||i.isXMLDoc(n)||!kt.test("<"+n.nodeName+">")?e=n.cloneNode(!0):(dt.innerHTML=n.outerHTML,dt.removeChild(e=dt.firstChild)),(!i.support.noCloneEvent||!i.support.noCloneChecked)&&(n.nodeType===1||n.nodeType===11)&&!i.isXMLDoc(n))for(si(n,e),f=g(n),o=g(e),u=0;f[u];++u)o[u]&&si(f[u],o[u]);if(t&&(oi(n,e),r))for(f=g(n),o=g(e),u=0;f[u];++u)oi(f[u],o[u]);return f=o=null,e},clean:function(n,t,u,f){var l,a,o,p,y,d,s,w,v,b,k,h=0,c=[];for(t&&typeof t.createDocumentFragment!="undefined"||(t=r),a=t===r&&ru;(o=n[h])!=null;h++)if(typeof o=="number"&&(o+=""),o){if(typeof o=="string")if(he.test(o)){for(a=a||ei(t),s=s||a.appendChild(t.createElement("div")),o=o.replace(gr,"<$1><\/$2>"),p=(nu.exec(o)||["",""])[1].toLowerCase(),y=e[p]||e._default,d=y[0],s.innerHTML=y[1]+o+y[2];d--;)s=s.lastChild;if(!i.support.tbody)for(w=se.test(o),v=p==="table"&&!w?s.firstChild&&s.firstChild.childNodes:y[1]==="<table>"&&!w?s.childNodes:[],l=v.length-1;l>=0;--l)i.nodeName(v[l],"tbody")&&!v[l].childNodes.length&&v[l].parentNode.removeChild(v[l]);!i.support.leadingWhitespace&&bt.test(o)&&s.insertBefore(t.createTextNode(bt.exec(o)[0]),s.firstChild);o=s.childNodes;s=a.lastChild}else o=t.createTextNode(o);o.nodeType?c.push(o):c=i.merge(c,o)}if(s&&(a.removeChild(s),o=s=a=null),!i.support.appendChecked)for(h=0;(o=c[h])!=null;h++)i.nodeName(o,"input")?hi(o):typeof o.getElementsByTagName!="undefined"&&i.grep(o.getElementsByTagName("input"),hi);if(u)for(b=function(n){if(!n.type||ae.test(n.type))return f?f.push(n.parentNode?n.parentNode.removeChild(n):n):u.appendChild(n)},h=0;(o=c[h])!=null;h++)i.nodeName(o,"script")&&b(o)||(u.appendChild(o),typeof o.getElementsByTagName!="undefined"&&(k=i.grep(i.merge([],o.getElementsByTagName("script")),b),c.splice.apply(c,[h+1,0].concat(k)),h+=k.length));return c},cleanData:function(n,t){for(var f,u,r,e,h=0,o=i.expando,s=i.cache,c=i.support.deleteExpando,l=i.event.special;(r=n[h])!=null;h++)if((t||i.acceptData(r))&&(u=r[o],f=u&&s[u],f)){if(f.events)for(e in f.events)l[e]?i.event.remove(r,e):i.removeEvent(r,e,f.handle);s[u]&&(delete s[u],c?delete r[o]:r.removeAttribute?r.removeAttribute(o):r[o]=null,i.deletedIds.push(u))}}}),function(){var t,n;i.uaMatch=function(n){n=n.toLowerCase();var t=/(chrome)[ \/]([\w.]+)/.exec(n)||/(webkit)[ \/]([\w.]+)/.exec(n)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(n)||/(msie) ([\w.]+)/.exec(n)||n.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(n)||[];return{browser:t[1]||"",version:t[2]||"0"}};t=i.uaMatch(uf.userAgent);n={};t.browser&&(n[t.browser]=!0,n.version=t.version);n.webkit&&(n.safari=!0);i.browser=n;i.sub=function(){function n(t,i){return new n.fn.init(t,i)}i.extend(!0,n,this);n.superclass=this;n.fn=n.prototype=this();n.fn.constructor=n;n.sub=this.sub;n.fn.init=function(r,u){return u&&u instanceof i&&!(u instanceof n)&&(u=n(u)),i.fn.init.call(this,r,u,t)};n.fn.init.prototype=n.fn;var t=n(r);return n}}();var u,y,p,gt=/alpha\([^)]*\)/i,ye=/opacity=([^)]*)/,pe=/^(top|right|bottom|left)$/,uu=/^margin/,we=new RegExp("^("+ut+")(.*)$","i"),et=new RegExp("^("+ut+")(?!px)[a-z%]+$","i"),be=new RegExp("^([-+])=("+ut+")","i"),ni={},ke={position:"absolute",visibility:"hidden",display:"block"},fu={letterSpacing:0,fontWeight:400,lineHeight:1},c=["Top","Right","Bottom","Left"],eu=["Webkit","O","Moz","ms"],de=i.fn.toggle;i.fn.extend({css:function(n,r){return i.access(this,function(n,r,u){return u!==t?i.style(n,r,u):i.css(n,r)},n,r,arguments.length>1)},show:function(){return li(this,!0)},hide:function(){return li(this)},toggle:function(n,t){var r=typeof n=="boolean";return i.isFunction(n)&&i.isFunction(t)?de.apply(this,arguments):this.each(function(){(r?n:nt(this))?i(this).show():i(this).hide()})}});i.extend({cssHooks:{opacity:{get:function(n,t){if(t){var i=u(n,"opacity");return i===""?"1":i}}}},cssNumber:{fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{float:i.support.cssFloat?"cssFloat":"styleFloat"},style:function(n,r,u,f){if(n&&n.nodeType!==3&&n.nodeType!==8&&n.style){var o,s,e,h=i.camelCase(r),c=n.style;if(r=i.cssProps[h]||(i.cssProps[h]=ci(c,h)),e=i.cssHooks[r]||i.cssHooks[h],u===t)return e&&"get"in e&&(o=e.get(n,!1,f))!==t?o:c[r];if((s=typeof u,s==="string"&&(o=be.exec(u))&&(u=(o[1]+1)*o[2]+parseFloat(i.css(n,r)),s="number"),u!=null&&(s!=="number"||!isNaN(u)))&&(s!=="number"||i.cssNumber[h]||(u+="px"),!e||!("set"in e)||(u=e.set(n,u,f))!==t))try{c[r]=u}catch(l){}}},css:function(n,r,f,e){var o,c,s,h=i.camelCase(r);return r=i.cssProps[h]||(i.cssProps[h]=ci(n.style,h)),s=i.cssHooks[r]||i.cssHooks[h],s&&"get"in s&&(o=s.get(n,!0,e)),o===t&&(o=u(n,r)),o==="normal"&&r in fu&&(o=fu[r]),f||e!==t?(c=parseFloat(o),f||i.isNumeric(c)?c||0:o):o},swap:function(n,t,i){var u,r,f={};for(r in t)f[r]=n.style[r],n.style[r]=t[r];u=i.call(n);for(r in t)n.style[r]=f[r];return u}});n.getComputedStyle?u=function(n,t){var u,e,o,s,f=getComputedStyle(n,null),r=n.style;return f&&(u=f[t],u===""&&!i.contains(n.ownerDocument.documentElement,n)&&(u=i.style(n,t)),et.test(u)&&uu.test(t)&&(e=r.width,o=r.minWidth,s=r.maxWidth,r.minWidth=r.maxWidth=r.width=u,u=f.width,r.width=e,r.minWidth=o,r.maxWidth=s)),u}:r.documentElement.currentStyle&&(u=function(n,t){var f,u,i=n.currentStyle&&n.currentStyle[t],r=n.style;return i==null&&r&&r[t]&&(i=r[t]),et.test(i)&&!pe.test(t)&&(f=r.left,u=n.runtimeStyle&&n.runtimeStyle.left,u&&(n.runtimeStyle.left=n.currentStyle.left),r.left=t==="fontSize"?"1em":i,i=r.pixelLeft+"px",r.left=f,u&&(n.runtimeStyle.left=u)),i===""?"auto":i});i.each(["height","width"],function(n,t){i.cssHooks[t]={get:function(n,r,f){if(r)return n.offsetWidth!==0||u(n,"display")!=="none"?yi(n,t,f):i.swap(n,ke,function(){return yi(n,t,f)})},set:function(n,r,u){return ai(n,r,u?vi(n,t,u,i.support.boxSizing&&i.css(n,"boxSizing")==="border-box"):0)}}});i.support.opacity||(i.cssHooks.opacity={get:function(n,t){return ye.test((t&&n.currentStyle?n.currentStyle.filter:n.style.filter)||"")?.01*parseFloat(RegExp.$1)+"":t?"1":""},set:function(n,t){var r=n.style,u=n.currentStyle,e=i.isNumeric(t)?"alpha(opacity="+t*100+")":"",f=u&&u.filter||r.filter||"";(r.zoom=1,t>=1&&i.trim(f.replace(gt,""))===""&&r.removeAttribute&&(r.removeAttribute("filter"),u&&!u.filter))||(r.filter=gt.test(f)?f.replace(gt,e):f+" "+e)}});i(function(){i.support.reliableMarginRight||(i.cssHooks.marginRight={get:function(n,t){return i.swap(n,{display:"inline-block"},function(){if(t)return u(n,"marginRight")})}});!i.support.pixelPosition&&i.fn.position&&i.each(["top","left"],function(n,t){i.cssHooks[t]={get:function(n,r){if(r){var f=u(n,t);return et.test(f)?i(n).position()[t]+"px":f}}}})});i.expr&&i.expr.filters&&(i.expr.filters.hidden=function(n){return n.offsetWidth===0&&n.offsetHeight===0||!i.support.reliableHiddenOffsets&&(n.style&&n.style.display||u(n,"display"))==="none"},i.expr.filters.visible=function(n){return!i.expr.filters.hidden(n)});i.each({margin:"",padding:"",border:"Width"},function(n,t){i.cssHooks[n+t]={expand:function(i){for(var u=typeof i=="string"?i.split(" "):[i],f={},r=0;r<4;r++)f[n+c[r]+t]=u[r]||u[r-2]||u[0];return f}};uu.test(n)||(i.cssHooks[n+t].set=ai)});var ge=/%20/g,no=/\[\]$/,ou=/\r?\n/g,to=/^(?:color|date|datetime|datetime-local|email|hidden|month|number|password|range|search|tel|text|time|url|week)$/i,io=/^(?:select|textarea)/i;i.fn.extend({serialize:function(){return i.param(this.serializeArray())},serializeArray:function(){return this.map(function(){return this.elements?i.makeArray(this.elements):this}).filter(function(){return this.name&&!this.disabled&&(this.checked||io.test(this.nodeName)||to.test(this.type))}).map(function(n,t){var r=i(this).val();return r==null?null:i.isArray(r)?i.map(r,function(n){return{name:t.name,value:n.replace(ou,"\r\n")}}):{name:t.name,value:r.replace(ou,"\r\n")}}).get()}});i.param=function(n,r){var u,f=[],e=function(n,t){t=i.isFunction(t)?t():t==null?"":t;f[f.length]=encodeURIComponent(n)+"="+encodeURIComponent(t)};if(r===t&&(r=i.ajaxSettings&&i.ajaxSettings.traditional),i.isArray(n)||n.jquery&&!i.isPlainObject(n))i.each(n,function(){e(this.name,this.value)});else for(u in n)vt(u,n[u],r,e);return f.join("&").replace(ge,"+")};var l,a,ro=/#.*$/,uo=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,fo=/^(?:GET|HEAD)$/,eo=/^\/\//,su=/\?/,oo=/<script\b[^<]*(?:(?!<\/script>)<[^<]*)*<\/script>/gi,so=/([?&])_=[^&]*/,hu=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,cu=i.fn.load,ti={},lu={},au=["*/"]+["*"];try{l=rf.href}catch(yo){l=r.createElement("a");l.href="";l=l.href}a=hu.exec(l.toLowerCase())||[];i.fn.load=function(n,r,u){if(typeof n!="string"&&cu)return cu.apply(this,arguments);if(!this.length)return this;var f,o,s,h=this,e=n.indexOf(" ");return e>=0&&(f=n.slice(e,n.length),n=n.slice(0,e)),i.isFunction(r)?(u=r,r=t):typeof r=="object"&&(o="POST"),i.ajax({url:n,type:o,dataType:"html",data:r,complete:function(n,t){u&&h.each(u,s||[n.responseText,t,n])}}).done(function(n){s=arguments;h.html(f?i("<div>").append(n.replace(oo,"")).find(f):n)}),this};i.each("ajaxStart ajaxStop ajaxComplete ajaxError ajaxSuccess ajaxSend".split(" "),function(n,t){i.fn[t]=function(n){return this.on(t,n)}});i.each(["get","post"],function(n,r){i[r]=function(n,u,f,e){return i.isFunction(u)&&(e=e||f,f=u,u=t),i.ajax({type:r,url:n,data:u,success:f,dataType:e})}});i.extend({getScript:function(n,r){return i.get(n,t,r,"script")},getJSON:function(n,t,r){return i.get(n,t,r,"json")},ajaxSetup:function(n,t){return t?bi(n,i.ajaxSettings):(t=n,n=i.ajaxSettings),bi(n,t),n},ajaxSettings:{url:l,isLocal:/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/.test(a[1]),global:!0,type:"GET",contentType:"application/x-www-form-urlencoded; charset=UTF-8",processData:!0,async:!0,accepts:{xml:"application/xml, text/xml",html:"text/html",text:"text/plain",json:"application/json, text/javascript","*":au},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText"},converters:{"* text":n.String,"text html":!0,"text json":i.parseJSON,"text xml":i.parseXML},flatOptions:{context:!0,url:!0}},ajaxPrefilter:wi(ti),ajaxTransport:wi(lu),ajax:function(n,r){function p(n,r,h,l){var a,tt,w,it,p,v=r;e!==2&&(e=2,d&&clearTimeout(d),c=t,k=l||"",f.readyState=n>0?4:0,h&&(it=bu(u,f,h)),n>=200&&n<300||n===304?(u.ifModified&&(p=f.getResponseHeader("Last-Modified"),p&&(i.lastModified[o]=p),p=f.getResponseHeader("Etag"),p&&(i.etag[o]=p)),n===304?(v="notmodified",a=!0):(a=ku(u,it),v=a.state,tt=a.data,w=a.error,a=!w)):(w=v,(!v||n)&&(v="error",n<0&&(n=0))),f.status=n,f.statusText=""+(r||v),a?nt.resolveWith(s,[tt,v,f]):nt.rejectWith(s,[f,v,w]),f.statusCode(b),b=t,y&&g.trigger("ajax"+(a?"Success":"Error"),[f,u,a?tt:w]),ut.fireWith(s,[f,v]),y&&(g.trigger("ajaxComplete",[f,u]),--i.active||i.event.trigger("ajaxStop")))}var it,rt;typeof n=="object"&&(r=n,n=t);r=r||{};var o,k,w,c,d,l,y,v,u=i.ajaxSetup({},r),s=u.context||u,g=s!==u&&(s.nodeType||s instanceof i)?i(s):i.event,nt=i.Deferred(),ut=i.Callbacks("once memory"),b=u.statusCode||{},ft={},et={},e=0,ot="canceled",f={readyState:0,setRequestHeader:function(n,t){if(!e){var i=n.toLowerCase();n=et[i]=et[i]||n;ft[n]=t}return this},getAllResponseHeaders:function(){return e===2?k:null},getResponseHeader:function(n){var i;if(e===2){if(!w)for(w={};i=uo.exec(k);)w[i[1].toLowerCase()]=i[2];i=w[n.toLowerCase()]}return i===t?null:i},overrideMimeType:function(n){return e||(u.mimeType=n),this},abort:function(n){return n=n||ot,c&&c.abort(n),p(0,n),this}};if(nt.promise(f),f.success=f.done,f.error=f.fail,f.complete=ut.add,f.statusCode=function(n){if(n){var t;if(e<2)for(t in n)b[t]=[b[t],n[t]];else t=n[f.status],f.always(t)}return this},u.url=((n||u.url)+"").replace(ro,"").replace(eo,a[1]+"//"),u.dataTypes=i.trim(u.dataType||"*").toLowerCase().split(h),u.crossDomain==null&&(l=hu.exec(u.url.toLowerCase()),u.crossDomain=!(!l||l[1]==a[1]&&l[2]==a[2]&&(l[3]||(l[1]==="http:"?80:443))==(a[3]||(a[1]==="http:"?80:443)))),u.data&&u.processData&&typeof u.data!="string"&&(u.data=i.param(u.data,u.traditional)),tt(ti,u,r,f),e===2)return f;y=u.global;u.type=u.type.toUpperCase();u.hasContent=!fo.test(u.type);y&&i.active++==0&&i.event.trigger("ajaxStart");u.hasContent||(u.data&&(u.url+=(su.test(u.url)?"&":"?")+u.data,delete u.data),o=u.url,u.cache===!1&&(it=i.now(),rt=u.url.replace(so,"$1_="+it),u.url=rt+(rt===u.url?(su.test(u.url)?"&":"?")+"_="+it:"")));(u.data&&u.hasContent&&u.contentType!==!1||r.contentType)&&f.setRequestHeader("Content-Type",u.contentType);u.ifModified&&(o=o||u.url,i.lastModified[o]&&f.setRequestHeader("If-Modified-Since",i.lastModified[o]),i.etag[o]&&f.setRequestHeader("If-None-Match",i.etag[o]));f.setRequestHeader("Accept",u.dataTypes[0]&&u.accepts[u.dataTypes[0]]?u.accepts[u.dataTypes[0]]+(u.dataTypes[0]!=="*"?", "+au+"; q=0.01":""):u.accepts["*"]);for(v in u.headers)f.setRequestHeader(v,u.headers[v]);if(!u.beforeSend||u.beforeSend.call(s,f,u)!==!1&&e!==2){ot="abort";for(v in{success:1,error:1,complete:1})f[v](u[v]);if(c=tt(lu,u,r,f),c){f.readyState=1;y&&g.trigger("ajaxSend",[f,u]);u.async&&u.timeout>0&&(d=setTimeout(function(){f.abort("timeout")},u.timeout));try{e=1;c.send(ft,p)}catch(st){if(e<2)p(-1,st);else throw st;}}else p(-1,"No Transport");return f}return f.abort()},active:0,lastModified:{},etag:{}});var vu=[],ho=/\?/,ot=/(=)\?(?=&|$)|\?\?/,co=i.now();i.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var n=vu.pop()||i.expando+"_"+co++;return this[n]=!0,n}});i.ajaxPrefilter("json jsonp",function(r,u,f){var e,s,o,h=r.data,c=r.url,l=r.jsonp!==!1,a=l&&ot.test(c),v=l&&!a&&typeof h=="string"&&!(r.contentType||"").indexOf("application/x-www-form-urlencoded")&&ot.test(h);if(r.dataTypes[0]==="jsonp"||a||v)return e=r.jsonpCallback=i.isFunction(r.jsonpCallback)?r.jsonpCallback():r.jsonpCallback,s=n[e],a?r.url=c.replace(ot,"$1"+e):v?r.data=h.replace(ot,"$1"+e):l&&(r.url+=(ho.test(c)?"&":"?")+r.jsonp+"="+e),r.converters["script json"]=function(){return o||i.error(e+" was not called"),o[0]},r.dataTypes[0]="json",n[e]=function(){o=arguments},f.always(function(){n[e]=s;r[e]&&(r.jsonpCallback=u.jsonpCallback,vu.push(e));o&&i.isFunction(s)&&s(o[0]);o=s=t}),"script"});i.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/javascript|ecmascript/},converters:{"text script":function(n){return i.globalEval(n),n}}});i.ajaxPrefilter("script",function(n){n.cache===t&&(n.cache=!1);n.crossDomain&&(n.type="GET",n.global=!1)});i.ajaxTransport("script",function(n){if(n.crossDomain){var i,u=r.head||r.getElementsByTagName("head")[0]||r.documentElement;return{send:function(f,e){i=r.createElement("script");i.async="async";n.scriptCharset&&(i.charset=n.scriptCharset);i.src=n.url;i.onload=i.onreadystatechange=function(n,r){(r||!i.readyState||/loaded|complete/.test(i.readyState))&&(i.onload=i.onreadystatechange=null,u&&i.parentNode&&u.removeChild(i),i=t,r||e(200,"success"))};u.insertBefore(i,u.firstChild)},abort:function(){i&&i.onload(0,1)}}}});st=n.ActiveXObject?function(){for(var n in w)w[n](0,1)}:!1;yu=0;i.ajaxSettings.xhr=n.ActiveXObject?function(){return!this.isLocal&&ki()||du()}:ki,function(n){i.extend(i.support,{ajax:!!n,cors:!!n&&"withCredentials"in n})}(i.ajaxSettings.xhr());i.support.ajax&&i.ajaxTransport(function(r){if(!r.crossDomain||i.support.cors){var u;return{send:function(f,e){var h,s,o=r.xhr();if(r.username?o.open(r.type,r.url,r.async,r.username,r.password):o.open(r.type,r.url,r.async),r.xhrFields)for(s in r.xhrFields)o[s]=r.xhrFields[s];r.mimeType&&o.overrideMimeType&&o.overrideMimeType(r.mimeType);r.crossDomain||f["X-Requested-With"]||(f["X-Requested-With"]="XMLHttpRequest");try{for(s in f)o.setRequestHeader(s,f[s])}catch(c){}o.send(r.hasContent&&r.data||null);u=function(n,f){var s,a,v,c,l;try{if(u&&(f||o.readyState===4))if(u=t,h&&(o.onreadystatechange=i.noop,st&&delete w[h]),f)o.readyState!==4&&o.abort();else{s=o.status;v=o.getAllResponseHeaders();c={};l=o.responseXML;l&&l.documentElement&&(c.xml=l);try{c.text=o.responseText}catch(n){}try{a=o.statusText}catch(p){a=""}!s&&r.isLocal&&!r.crossDomain?s=c.text?200:404:s===1223&&(s=204)}}catch(y){f||e(-1,y)}c&&e(s,a,c,v)};r.async?o.readyState===4?setTimeout(u,0):(h=++yu,st&&(w||(w={},i(n).unload(st)),w[h]=u),o.onreadystatechange=u):u()},abort:function(){u&&u(0,1)}}}});var ht,ct,lo=/^(?:toggle|show|hide)$/,ao=new RegExp("^(?:([-+])=|)("+ut+")([a-z%]*)$","i"),vo=/queueHooks$/,lt=[tf],k={"*":[function(n,t){var o,s,h,r=this.createTween(n,t),e=ao.exec(t),c=r.cur(),u=+c||0,f=1;if(e){if(o=+e[2],s=e[3]||(i.cssNumber[n]?"":"px"),s!=="px"&&u){u=i.css(r.elem,n,!0)||o||1;do h=f=f||".5",u=u/f,i.style(r.elem,n,u+s),f=r.cur()/c;while(f!==1&&f!==h)}r.unit=s;r.start=u;r.end=e[1]?u+(e[1]+1)*o:o}return r}]};i.Animation=i.extend(gi,{tweener:function(n,t){i.isFunction(n)?(t=n,n=["*"]):n=n.split(" ");for(var r,u=0,f=n.length;u<f;u++)r=n[u],k[r]=k[r]||[],k[r].unshift(t)},prefilter:function(n,t){t?lt.unshift(n):lt.push(n)}});i.Tween=f;f.prototype={constructor:f,init:function(n,t,r,u,f,e){this.elem=n;this.prop=r;this.easing=f||"swing";this.options=t;this.start=this.now=this.cur();this.end=u;this.unit=e||(i.cssNumber[r]?"":"px")},cur:function(){var n=f.propHooks[this.prop];return n&&n.get?n.get(this):f.propHooks._default.get(this)},run:function(n){var r,t=f.propHooks[this.prop];return this.pos=r=i.easing[this.easing](n,this.options.duration*n,0,1,this.options.duration),this.now=(this.end-this.start)*r+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),t&&t.set?t.set(this):f.propHooks._default.set(this),this}};f.prototype.init.prototype=f.prototype;f.propHooks={_default:{get:function(n){var t;return n.elem[n.prop]==null||!!n.elem.style&&n.elem.style[n.prop]!=null?(t=i.css(n.elem,n.prop,!1,""),!t||t==="auto"?0:t):n.elem[n.prop]},set:function(n){i.fx.step[n.prop]?i.fx.step[n.prop](n):n.elem.style&&(n.elem.style[i.cssProps[n.prop]]!=null||i.cssHooks[n.prop])?i.style(n.elem,n.prop,n.now+n.unit):n.elem[n.prop]=n.now}}};f.propHooks.scrollTop=f.propHooks.scrollLeft={set:function(n){n.elem.nodeType&&n.elem.parentNode&&(n.elem[n.prop]=n.now)}};i.each(["toggle","show","hide"],function(n,t){var r=i.fn[t];i.fn[t]=function(u,f,e){return u==null||typeof u=="boolean"||!n&&i.isFunction(u)&&i.isFunction(f)?r.apply(this,arguments):this.animate(it(t,!0),u,f,e)}});i.fn.extend({fadeTo:function(n,t,i,r){return this.filter(nt).css("opacity",0).show().end().animate({opacity:t},n,i,r)},animate:function(n,t,r,u){var e=i.isEmptyObject(n),f=i.speed(t,r,u),o=function(){var t=gi(this,i.extend({},n),f);e&&t.stop(!0)};return e||f.queue===!1?this.each(o):this.queue(f.queue,o)},stop:function(n,r,u){var f=function(n){var t=n.stop;delete n.stop;t(u)};return typeof n!="string"&&(u=r,r=n,n=t),r&&n!==!1&&this.queue(n||"fx",[]),this.each(function(){var o=!0,t=n!=null&&n+"queueHooks",e=i.timers,r=i._data(this);if(t)r[t]&&r[t].stop&&f(r[t]);else for(t in r)r[t]&&r[t].stop&&vo.test(t)&&f(r[t]);for(t=e.length;t--;)e[t].elem===this&&(n==null||e[t].queue===n)&&(e[t].anim.stop(u),o=!1,e.splice(t,1));(o||!u)&&i.dequeue(this,n)})}});i.each({slideDown:it("show"),slideUp:it("hide"),slideToggle:it("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(n,t){i.fn[n]=function(n,i,r){return this.animate(t,n,i,r)}});i.speed=function(n,t,r){var u=n&&typeof n=="object"?i.extend({},n):{complete:r||!r&&t||i.isFunction(n)&&n,duration:n,easing:r&&t||t&&!i.isFunction(t)&&t};return u.duration=i.fx.off?0:typeof u.duration=="number"?u.duration:u.duration in i.fx.speeds?i.fx.speeds[u.duration]:i.fx.speeds._default,(u.queue==null||u.queue===!0)&&(u.queue="fx"),u.old=u.complete,u.complete=function(){i.isFunction(u.old)&&u.old.call(this);u.queue&&i.dequeue(this,u.queue)},u};i.easing={linear:function(n){return n},swing:function(n){return.5-Math.cos(n*Math.PI)/2}};i.timers=[];i.fx=f.prototype.init;i.fx.tick=function(){for(var r,n=i.timers,t=0;t<n.length;t++)r=n[t],r()||n[t]!==r||n.splice(t--,1);n.length||i.fx.stop()};i.fx.timer=function(n){n()&&i.timers.push(n)&&!ct&&(ct=setInterval(i.fx.tick,i.fx.interval))};i.fx.interval=13;i.fx.stop=function(){clearInterval(ct);ct=null};i.fx.speeds={slow:600,fast:200,_default:400};i.fx.step={};i.expr&&i.expr.filters&&(i.expr.filters.animated=function(n){return i.grep(i.timers,function(t){return n===t.elem}).length});ii=/^(?:body|html)$/i;i.fn.offset=function(n){if(arguments.length)return n===t?this:this.each(function(t){i.offset.setOffset(this,n,t)});var e,r,o,s,h,c,l,a,v,y,u=this[0],f=u&&u.ownerDocument;if(f)return(o=f.body)===u?i.offset.bodyOffset(u):(r=f.documentElement,i.contains(r,u)?(e=u.getBoundingClientRect(),s=nr(f),h=r.clientTop||o.clientTop||0,c=r.clientLeft||o.clientLeft||0,l=s.pageYOffset||r.scrollTop,a=s.pageXOffset||r.scrollLeft,v=e.top+l-h,y=e.left+a-c,{top:v,left:y}):{top:0,left:0})};i.offset={bodyOffset:function(n){var t=n.offsetTop,r=n.offsetLeft;return i.support.doesNotIncludeMarginInBodyOffset&&(t+=parseFloat(i.css(n,"marginTop"))||0,r+=parseFloat(i.css(n,"marginLeft"))||0),{top:t,left:r}},setOffset:function(n,t,r){var f=i.css(n,"position");f==="static"&&(n.style.position="relative");var e=i(n),o=e.offset(),l=i.css(n,"top"),a=i.css(n,"left"),v=(f==="absolute"||f==="fixed")&&i.inArray("auto",[l,a])>-1,u={},s={},h,c;v?(s=e.position(),h=s.top,c=s.left):(h=parseFloat(l)||0,c=parseFloat(a)||0);i.isFunction(t)&&(t=t.call(n,r,o));t.top!=null&&(u.top=t.top-o.top+h);t.left!=null&&(u.left=t.left-o.left+c);"using"in t?t.using.call(n,u):e.css(u)}};i.fn.extend({position:function(){if(this[0]){var u=this[0],n=this.offsetParent(),t=this.offset(),r=ii.test(n[0].nodeName)?{top:0,left:0}:n.offset();return t.top-=parseFloat(i.css(u,"marginTop"))||0,t.left-=parseFloat(i.css(u,"marginLeft"))||0,r.top+=parseFloat(i.css(n[0],"borderTopWidth"))||0,r.left+=parseFloat(i.css(n[0],"borderLeftWidth"))||0,{top:t.top-r.top,left:t.left-r.left}}},offsetParent:function(){return this.map(function(){for(var n=this.offsetParent||r.body;n&&!ii.test(n.nodeName)&&i.css(n,"position")==="static";)n=n.offsetParent;return n||r.body})}});i.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(n,r){var u=/Y/.test(r);i.fn[n]=function(f){return i.access(this,function(n,f,e){var o=nr(n);if(e===t)return o?r in o?o[r]:o.document.documentElement[f]:n[f];o?o.scrollTo(u?i(o).scrollLeft():e,u?e:i(o).scrollTop()):n[f]=e},n,f,arguments.length,null)}});i.each({Height:"height",Width:"width"},function(n,r){i.each({padding:"inner"+n,content:r,"":"outer"+n},function(u,f){i.fn[f]=function(f,e){var o=arguments.length&&(u||typeof f!="boolean"),s=u||(f===!0||e===!0?"margin":"border");return i.access(this,function(r,u,f){var e;return i.isWindow(r)?r.document.documentElement["client"+n]:r.nodeType===9?(e=r.documentElement,Math.max(r.body["scroll"+n],e["scroll"+n],r.body["offset"+n],e["offset"+n],e["client"+n])):f===t?i.css(r,u,f,s):i.style(r,u,f,s)},r,o?f:t,o)}})});n.jQuery=n.$=i;typeof define=="function"&&define.amd&&define.amd.jQuery&&define("jquery",[],function(){return i})}(window),!function(n){function i(n,t){for(var i=window,r=(n||"").split(".");i&&r.length;)i=i[r.shift()];return"function"==typeof i?i:(t.push(n),Function.constructor.apply(null,t))}function u(n){return"GET"===n||"POST"===n}function e(n,t){u(t)||n.setRequestHeader("X-HTTP-Method-Override",t)}function o(t,i,r){var u;r.indexOf("application/x-javascript")===-1&&(u=(t.getAttribute("data-ajax-mode")||"").toUpperCase(),n(t.getAttribute("data-ajax-update")).each(function(t,r){switch(u){case"BEFORE":n(r).prepend(i);break;case"AFTER":n(r).append(i);break;case"REPLACE-WITH":n(r).replaceWith(i);break;default:n(r).html(i)}}))}function f(t,r){var c,l,f,a,s,h;(c=t.getAttribute("data-ajax-confirm"),!c||window.confirm(c))&&(l=n(t.getAttribute("data-ajax-loading")),a=parseInt(t.getAttribute("data-ajax-loading-duration"),10)||0,n.extend(r,{type:t.getAttribute("data-ajax-method")||void 0,url:t.getAttribute("data-ajax-url")||void 0,cache:"true"===(t.getAttribute("data-ajax-cache")||"").toLowerCase(),beforeSend:function(n){var r;return e(n,f),r=i(t.getAttribute("data-ajax-begin"),["xhr"]).apply(t,arguments),r!==!1&&l.show(a),r},complete:function(){l.hide(a);i(t.getAttribute("data-ajax-complete"),["xhr","status"]).apply(t,arguments)},success:function(n,r,u){o(t,n,u.getResponseHeader("Content-Type")||"text/html");i(t.getAttribute("data-ajax-success"),["data","status","xhr"]).apply(t,arguments)},error:function(){i(t.getAttribute("data-ajax-failure"),["xhr","status","error"]).apply(t,arguments)}}),r.data.push({name:"X-Requested-With",value:"XMLHttpRequest"}),f=r.type.toUpperCase(),u(f)||(r.type="POST",r.data.push({name:"X-HTTP-Method-Override",value:f})),s=n(t),s.is("form")&&"multipart/form-data"==s.attr("enctype")&&(h=new FormData,n.each(r.data,function(n,t){h.append(t.name,t.value)}),n("input[type=file]",s).each(function(){var t=this;n.each(t.files,function(n,i){h.append(t.name,i)})}),n.extend(r,{processData:!1,contentType:!1,data:h})),n.ajax(r))}function s(t){var i=n(t).data(h);return!i||!i.validate||i.validate()}var t="unobtrusiveAjaxClick",r="unobtrusiveAjaxClickTarget",h="unobtrusiveValidation";n(document).on("click","a[data-ajax=true]",function(n){n.preventDefault();f(this,{url:this.href,type:"GET",data:[]})});n(document).on("click","form[data-ajax=true] input[type=image]",function(i){var r=i.target.name,u=n(i.target),f=n(u.parents("form")[0]),e=u.offset();f.data(t,[{name:r+".x",value:Math.round(i.pageX-e.left)},{name:r+".y",value:Math.round(i.pageY-e.top)}]);setTimeout(function(){f.removeData(t)},0)});n(document).on("click","form[data-ajax=true] :submit",function(i){var f=i.currentTarget.name,e=n(i.target),u=n(e.parents("form")[0]);u.data(t,f?[{name:f,value:i.currentTarget.value}]:[]);u.data(r,e);setTimeout(function(){u.removeData(t);u.removeData(r)},0)});n(document).on("submit","form[data-ajax=true]",function(i){var e=n(this).data(t)||[],u=n(this).data(r),o=u&&(u.hasClass("cancel")||void 0!==u.attr("formnovalidate"));i.preventDefault();(o||s(this))&&f(this,{url:this.action,type:this.method||"GET",data:e.concat(n(this).serializeArray())})})}(jQuery),!function(){function c(n,t,i){var f,u;if(r)for(f=r.length;f--;)u=r[f],l.call(n,u)&&t.call(i,u,n[u])}var w,i,u,n,a,o,s,h,p;this.MooTools={version:"1.6.0",build:"529422872adfff401b901b8b6c7ca5114ee95e2b"};var t=this.typeOf=function(n){if(null==n)return"null";if(null!=n.$family)return n.$family();if(n.nodeName){if(1==n.nodeType)return"element";if(3==n.nodeType)return/\S/.test(n.nodeValue)?"textnode":"whitespace"}else if("number"==typeof n.length){if("callee"in n)return"arguments";if("item"in n)return"collection"}return typeof n},l=(this.instanceOf=function(n,t){if(null==n)return!1;for(var i=n.$constructor||n.constructor;i;){if(i===t)return!0;i=i.parent}return n.hasOwnProperty?n instanceof t:!1},Object.prototype.hasOwnProperty),r=!0;for(w in{toString:1})r=null;r&&(r=["hasOwnProperty","valueOf","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","constructor"]);i=this.Function;i.prototype.overloadSetter=function(n){var t=this;return function(i,r){if(null==i)return this;if(n||"string"!=typeof i){for(var u in i)t.call(this,u,i[u]);c(i,t,this)}else t.call(this,i,r);return this}};i.prototype.overloadGetter=function(n){var t=this;return function(i){var r,f,u;if("string"!=typeof i?r=i:arguments.length>1?r=arguments:n&&(r=[i]),r)for(f={},u=0;u<r.length;u++)f[r[u]]=t.call(this,r[u]);else f=t.call(this,i);return f}};i.prototype.extend=function(n,t){this[n]=t}.overloadSetter();i.prototype.implement=function(n,t){this.prototype[n]=t}.overloadSetter();u=Array.prototype.slice;Array.convert=function(i){return null==i?[]:n.isEnumerable(i)&&"string"!=typeof i?"array"==t(i)?i:u.call(i):[i]};i.convert=function(n){return"function"==t(n)?n:function(){return n}};Number.convert=function(n){var t=parseFloat(n);return isFinite(t)?t:null};String.convert=function(n){return n+""};i.from=i.convert;Number.from=Number.convert;String.from=String.convert;i.implement({hide:function(){return this.$hidden=!0,this},protect:function(){return this.$protected=!0,this}});n=this.Type=function(i,r){if(i){var u=i.toLowerCase(),f=function(n){return t(n)==u};n["is"+i]=f;null!=r&&(r.prototype.$family=function(){return u}.hide())}return null==r?null:(r.extend(this),r.$constructor=n,r.prototype.$constructor=r,r)};a=Object.prototype.toString;n.isEnumerable=function(n){return null!=n&&"number"==typeof n.length&&"[object Function]"!=a.call(n)};var v={},y=function(n){var i=t(n.prototype);return v[i]||(v[i]=[])},f=function(n,i){var s,r,o,h;if(!i||!i.$hidden){for(s=y(this),r=0;r<s.length;r++)o=s[r],"type"==t(o)?f.call(o,n,i):o.call(this,n,i);h=this.prototype[n];null!=h&&h.$protected||(this.prototype[n]=i);null==this[n]&&"function"==t(i)&&e.call(this,n,function(n){return i.apply(n,u.call(arguments,1))})}},e=function(n,t){if(!t||!t.$hidden){var i=this[n];null!=i&&i.$protected||(this[n]=t)}};n.implement({implement:f.overloadSetter(),extend:e.overloadSetter(),alias:function(n,t){f.call(this,n,this.prototype[t])}.overloadSetter(),mirror:function(n){return y(this).push(n),this}});new n("Type",n);o=function(t,i,r){var e=i!=Object,u=i.prototype,f,h,a;for(e&&(i=new n(t,i)),f=0,h=r.length;h>f;f++){var s=r[f],c=i[s],l=u[s];c&&c.protect();e&&l&&i.implement(s,l.protect())}return e&&(a=u.propertyIsEnumerable(r[0]),i.forEachMethod=function(n){var t,f,i;if(!a)for(t=0,f=r.length;f>t;t++)n.call(u,u[r[t]],r[t]);for(i in u)n.call(u,u[i],i)}),o};o("String",String,["charAt","charCodeAt","concat","contains","indexOf","lastIndexOf","match","quote","replace","search","slice","split","substr","substring","trim","toLowerCase","toUpperCase"])("Array",Array,["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice","indexOf","lastIndexOf","filter","forEach","every","map","some","reduce","reduceRight","contains"])("Number",Number,["toExponential","toFixed","toLocaleString","toPrecision"])("Function",i,["apply","call","bind"])("RegExp",RegExp,["exec","test"])("Object",Object,["create","defineProperty","defineProperties","keys","getPrototypeOf","getOwnPropertyDescriptor","getOwnPropertyNames","preventExtensions","isExtensible","seal","isSealed","freeze","isFrozen"])("Date",Date,["now"]);Object.extend=e.overloadSetter();Date.extend("now",function(){return+new Date});new n("Boolean",Boolean);Number.prototype.$family=function(){return isFinite(this)?"number":"null"}.hide();Number.extend("random",function(n,t){return Math.floor(Math.random()*(t-n+1)+n)});Array.implement({forEach:function(n,t){for(var i=0,r=this.length;r>i;i++)i in this&&n.call(t,this[i],i,this)},each:function(n,t){return Array.forEach(this,n,t),this}});Object.extend({keys:function(n){var t=[],i;for(i in n)l.call(n,i)&&t.push(i);return c(n,function(n){t.push(n)}),t},forEach:function(n,t,i){Object.keys(n).forEach(function(r){t.call(i,n[r],r,n)})}});Object.each=Object.forEach;s=function(n){switch(t(n)){case"array":return n.clone();case"object":return Object.clone(n);default:return n}};Array.implement("clone",function(){for(var n=this.length,t=new Array(n);n--;)t[n]=s(this[n]);return t});h=function(n,i,r){switch(t(r)){case"object":"object"==t(n[i])?Object.merge(n[i],r):n[i]=Object.clone(r);break;case"array":n[i]=r.clone();break;default:n[i]=r}return n};Object.extend({merge:function(n,i,r){var u,o,f,e;if("string"==t(i))return h(n,i,r);for(u=1,o=arguments.length;o>u;u++){f=arguments[u];for(e in f)h(n,e,f[e])}return n},clone:function(n){var i={},t;for(t in n)i[t]=s(n[t]);return i},append:function(n){for(var i,r,t=1,u=arguments.length;u>t;t++){i=arguments[t]||{};for(r in i)n[r]=i[r]}return n}});["Object","WhiteSpace","TextNode","Collection","Arguments"].each(function(t){new n(t)});p=Date.now();String.extend("uniqueID",function(){return(p++).toString(36)})}(),Array.implement({every:function(n,t){for(var i=0,r=this.length>>>0;r>i;i++)if(i in this&&!n.call(t,this[i],i,this))return!1;return!0},filter:function(n,t){for(var r,u=[],i=0,f=this.length>>>0;f>i;i++)i in this&&(r=this[i],n.call(t,r,i,this)&&u.push(r));return u},indexOf:function(n,t){for(var r=this.length>>>0,i=0>t?Math.max(0,r+t):t||0;r>i;i++)if(this[i]===n)return i;return-1},map:function(n,t){for(var r=this.length>>>0,u=Array(r),i=0;r>i;i++)i in this&&(u[i]=n.call(t,this[i],i,this));return u},some:function(n,t){for(var i=0,r=this.length>>>0;r>i;i++)if(i in this&&n.call(t,this[i],i,this))return!0;return!1},clean:function(){return this.filter(function(n){return null!=n})},invoke:function(n){var t=Array.slice(arguments,1);return this.map(function(i){return i[n].apply(i,t)})},associate:function(n){for(var i={},r=Math.min(this.length,n.length),t=0;r>t;t++)i[n[t]]=this[t];return i},link:function(n){for(var i,r={},t=0,u=this.length;u>t;t++)for(i in n)if(n[i](this[t])){r[i]=this[t];delete n[i];break}return r},contains:function(n,t){return-1!=this.indexOf(n,t)},append:function(n){return this.push.apply(this,n),this},getLast:function(){return this.length?this[this.length-1]:null},getRandom:function(){return this.length?this[Number.random(0,this.length-1)]:null},include:function(n){return this.contains(n)||this.push(n),this},combine:function(n){for(var t=0,i=n.length;i>t;t++)this.include(n[t]);return this},erase:function(n){for(var t=this.length;t--;)this[t]===n&&this.splice(t,1);return this},empty:function(){return this.length=0,this},flatten:function(){for(var t,i=[],n=0,r=this.length;r>n;n++)t=typeOf(this[n]),"null"!=t&&(i=i.concat("array"==t||"collection"==t||"arguments"==t||instanceOf(this[n],Array)?Array.flatten(this[n]):this[n]));return i},pick:function(){for(var n=0,t=this.length;t>n;n++)if(null!=this[n])return this[n];return null},hexToRgb:function(n){if(3!=this.length)return null;var t=this.map(function(n){return 1==n.length&&(n+=n),parseInt(n,16)});return n?t:"rgb("+t+")"},rgbToHex:function(n){var t,i,r;if(this.length<3)return null;if(4==this.length&&0==this[3]&&!n)return"transparent";for(t=[],i=0;3>i;i++)r=(this[i]-0).toString(16),t.push(1==r.length?"0"+r:r);return n?t:"#"+t.join("")}}),Function.extend({attempt:function(){for(var n=0,t=arguments.length;t>n;n++)try{return arguments[n]()}catch(i){}return null}}),Function.implement({attempt:function(n,t){try{return this.apply(t,Array.convert(n))}catch(i){}return null},bind:function(n){var i=this,t=arguments.length>1?Array.slice(arguments,1):null,r=function(){},u=function(){var f=n,e=arguments.length,o;return this instanceof u&&(r.prototype=i.prototype,f=new r),o=t||e?i.apply(f,t&&e?t.concat(Array.slice(arguments)):t||arguments):i.call(f),f==n?o:f};return u},pass:function(n,t){var i=this;return null!=n&&(n=Array.convert(n)),function(){return i.apply(t,n||arguments)}},delay:function(n,t,i){return setTimeout(this.pass(null==i?[]:i,t),n)},periodical:function(n,t,i){return setInterval(this.pass(null==i?[]:i,t),n)}}),Number.implement({limit:function(n,t){return Math.min(t,Math.max(n,this))},round:function(n){return n=Math.pow(10,n||0).toFixed(0>n?-n:0),Math.round(this*n)/n},times:function(n,t){for(var i=0;this>i;i++)n.call(t,i,this)},toFloat:function(){return parseFloat(this)},toInt:function(n){return parseInt(this,n||10)}}),Number.alias("each","times"),function(n){var t={};n.each(function(n){Number[n]||(t[n]=function(){return Math[n].apply(null,[this].concat(Array.convert(arguments)))})});Number.implement(t)}(["abs","acos","asin","atan","atan2","ceil","cos","exp","floor","log","max","min","pow","sin","sqrt","tan"]),String.implement({contains:function(n,t){return(t?String(this).slice(t):String(this)).indexOf(n)>-1},test:function(n,t){return("regexp"==typeOf(n)?n:new RegExp(""+n,t)).test(this)},trim:function(){return String(this).replace(/^\s+|\s+$/g,"")},clean:function(){return String(this).replace(/\s+/g," ").trim()},camelCase:function(){return String(this).replace(/-\D/g,function(n){return n.charAt(1).toUpperCase()})},hyphenate:function(){return String(this).replace(/[A-Z]/g,function(n){return"-"+n.charAt(0).toLowerCase()})},capitalize:function(){return String(this).replace(/\b[a-z]/g,function(n){return n.toUpperCase()})},escapeRegExp:function(){return String(this).replace(/([-.*+?^${}()|[\]\/\\])/g,"\\$1")},toInt:function(n){return parseInt(this,n||10)},toFloat:function(){return parseFloat(this)},hexToRgb:function(n){var t=String(this).match(/^#?(\w{1,2})(\w{1,2})(\w{1,2})$/);return t?t.slice(1).hexToRgb(n):null},rgbToHex:function(n){var t=String(this).match(/\d{1,3}/g);return t?t.rgbToHex(n):null},substitute:function(n,t){return String(this).replace(t||/\\?\{([^{}]+)\}/g,function(t,i){return"\\"==t.charAt(0)?t.slice(1):null!=n[i]?n[i]:""})}}),function(){var n=this.document,i=n.window=this,e=function(n,t){n=n.toLowerCase();t=t?t.toLowerCase():"";var i=n.match(/(edge)[\s\/:]([\w\d\.]+)/);return i||(i=n.match(/(opera|ie|firefox|chrome|trident|crios|version)[\s\/:]([\w\d\.]+)?.*?(safari|(?:rv[\s\/:]|version[\s\/:])([\w\d\.]+)|$)/)||[null,"unknown",0]),"trident"==i[1]?(i[1]="ie",i[4]&&(i[2]=i[4])):"crios"==i[1]&&(i[1]="chrome"),t=n.match(/ip(?:ad|od|hone)/)?"ios":(n.match(/(?:webos|android)/)||n.match(/mac|win|linux/)||["other"])[0],"win"==t&&(t="windows"),{extend:Function.prototype.extend,name:"version"==i[1]?i[3]:i[1],version:parseFloat("opera"==i[1]&&i[4]?i[4]:i[2]),platform:t}},t=this.Browser=e(navigator.userAgent,navigator.platform),r,u,f,o;if("ie"==t.name&&n.documentMode&&(t.version=n.documentMode),t.extend({Features:{xpath:!!n.evaluate,air:!!i.runtime,query:!!n.querySelector,json:!!i.JSON},parseUA:e}),t.Request=function(){var n=function(){return new XMLHttpRequest},t=function(){return new ActiveXObject("MSXML2.XMLHTTP")},i=function(){return new ActiveXObject("Microsoft.XMLHTTP")};return Function.attempt(function(){return n(),n},function(){return t(),t},function(){return i(),i})}(),t.Features.xhr=!!t.Request,t.exec=function(t){if(!t)return t;if(i.execScript)i.execScript(t);else{var r=n.createElement("script");r.setAttribute("type","text/javascript");r.text=t;n.head.appendChild(r);n.head.removeChild(r)}return t},String.implement("stripScripts",function(n){var i="",r=this.replace(/<script[^>]*>([\s\S]*?)<\/script>/gi,function(n,t){return i+=t+"\n",""});return n===!0?t.exec(i):"function"==typeOf(n)&&n(i,r),r}),t.extend({Document:this.Document,Window:this.Window,Element:this.Element,Event:this.Event}),this.Window=this.$constructor=new Type("Window",function(){}),this.$family=Function.convert("window").hide(),Window.mirror(function(n,t){i[n]=t}),this.Document=n.$constructor=new Type("Document",function(){}),n.$family=Function.convert("document").hide(),Document.mirror(function(t,i){n[t]=i}),n.html=n.documentElement,n.head||(n.head=n.getElementsByTagName("head")[0]),n.execCommand)try{n.execCommand("BackgroundImageCache",!1,!0)}catch(s){}this.attachEvent&&!this.addEventListener&&(r=function(){this.detachEvent("onunload",r);n.head=n.html=n.window=null;i=this.Window=n=null},this.attachEvent("onunload",r));u=Array.convert;try{u(n.html.childNodes)}catch(s){Array.convert=function(n){if("string"!=typeof n&&Type.isEnumerable(n)&&"array"!=typeOf(n)){for(var t=n.length,i=new Array(t);t--;)i[t]=n[t];return i}return u(n)};f=Array.prototype;o=f.slice;["pop","push","reverse","shift","sort","splice","unshift","concat","join","slice"].each(function(n){var t=f[n];Array[n]=function(n){return t.apply(Array.convert(n),o.call(arguments,1))}})}}(),function(){var n=this.Class=new Type("Class",function(i){instanceOf(i,Function)&&(i={initialize:i});var u=function(){if(t(this),u.$prototyping)return this;this.$caller=null;this.$family=null;var n=this.initialize?this.initialize.apply(this,arguments):this;return this.$caller=this.caller=null,n}.extend(this).implement(i);return u.$constructor=n,u.prototype.$constructor=u,u.prototype.parent=r,u}),r=function(){if(!this.$caller)throw new Error('The method "parent" cannot be called.');var n=this.$caller.$name,t=this.$caller.$owner.parent,i=t?t.prototype[n]:null;if(!i)throw new Error('The method "'+n+'" has no parent.');return i.apply(this,arguments)},t=function(n){var i,r,u;for(i in n){r=n[i];switch(typeOf(r)){case"object":u=function(){};u.prototype=r;n[i]=t(new u);break;case"array":n[i]=r.clone()}}return n},u=function(n,t,i){i.$origin&&(i=i.$origin);var r=function(){var u,n,f;if(i.$protected&&null==this.$caller)throw new Error('The method "'+t+'" cannot be called.');return u=this.caller,n=this.$caller,this.caller=n,this.$caller=r,f=i.apply(this,arguments),this.$caller=n,this.caller=u,f}.extend({$owner:n,$origin:i,$name:t});return r},i=function(t,i,r){if(n.Mutators.hasOwnProperty(t)&&(i=n.Mutators[t].call(this,i),null==i))return this;if("function"==typeOf(i)){if(i.$hidden)return this;this.prototype[t]=r?i:u(this,t,i)}else Object.merge(this.prototype,t,i);return this},f=function(n){n.$prototyping=!0;var t=new n;return delete n.$prototyping,t};n.implement("implement",i.overloadSetter());n.Mutators={Extends:function(n){this.parent=n;this.prototype=f(n)},Implements:function(n){Array.convert(n).each(function(n){var r=new n,t;for(t in r)i.call(this,t,r[t],!0)},this)}}}(),function(){this.Chain=new Class({$chain:[],chain:function(){return this.$chain.append(Array.flatten(arguments)),this},callChain:function(){return this.$chain.length?this.$chain.shift().apply(this,arguments):!1},clearChain:function(){return this.$chain.empty(),this}});var n=function(n){return n.replace(/^on([A-Z])/,function(n,t){return t.toLowerCase()})};this.Events=new Class({$events:{},addEvent:function(t,i,r){return t=n(t),this.$events[t]=(this.$events[t]||[]).include(i),r&&(i.internal=!0),this},addEvents:function(n){for(var t in n)this.addEvent(t,n[t]);return this},fireEvent:function(t,i,r){t=n(t);var u=this.$events[t];return u?(i=Array.convert(i),u.each(function(n){r?n.delay(r,this,i):n.apply(this,i)},this),this):this},removeEvent:function(t,i){var r,u;return t=n(t),r=this.$events[t],r&&!i.internal&&(u=r.indexOf(i),-1!=u&&delete r[u]),this},removeEvents:function(t){var i,r,u;if("object"==typeOf(t)){for(i in t)this.removeEvent(i,t[i]);return this}t&&(t=n(t));for(i in this.$events)if(!t||t==i)for(r=this.$events[i],u=r.length;u--;)u in r&&this.removeEvent(i,r[u]);return this}});this.Options=new Class({setOptions:function(){var t=this.options=Object.merge.apply(null,[{},this.options].append(arguments)),n;if(this.addEvent)for(n in t)"function"==typeOf(t[n])&&/^on[A-Z]/.test(n)&&(this.addEvent(n,t[n]),delete t[n]);return this}})}(),function(){function i(r,u){var e,f;if(r.$thenableState===t)if(r===u)n(r,new TypeError("Tried to resolve a thenable with itself."));else if(u&&("object"==typeof u||"function"==typeof u)){try{e=u.then}catch(h){n(r,h)}"function"==typeof e?(f=!1,o(function(){try{e.call(u,function(n){f||(f=!0,i(r,n))},function(t){f||(f=!0,n(r,t))})}catch(t){f||(f=!0,n(r,t))}})):s(r,u)}else s(r,u)}function s(n,i){n.$thenableState===t&&(n.$thenableResult=i,n.$thenableState=f,u(n))}function n(n,i){n.$thenableState===t&&(n.$thenableResult=i,n.$thenableState=e,u(n))}function h(n){n.$thenableState!==t&&(n.$thenableResult=null,n.$thenableState=t)}function u(n){var t,i=n.$thenableState,r=n.$thenableResult,u=n.$thenableReactions;i===f?(n.$thenableReactions=[],t="fulfillHandler"):i==e&&(n.$thenableReactions=[],t="rejectHandler");t&&o(c.pass([r,u,t]))}function c(t,r,u){for(var f,o,e=0,s=r.length;s>e;++e)if(f=r[e],o=f[u],"Identity"===o)i(f.thenable,t);else if("Thrower"===o)n(f.thenable,t);else try{i(f.thenable,o(t))}catch(h){n(f.thenable,h)}}var t=0,f=1,e=2,r=Class.Thenable=new Class({$thenableState:t,$thenableResult:null,$thenableReactions:[],resolve:function(n){return i(this,n),this},reject:function(t){return n(this,t),this},getThenableState:function(){switch(this.$thenableState){case t:return"pending";case f:return"fulfilled";case e:return"rejected"}},resetThenable:function(t){return n(this,t),h(this),this},then:function(n,i){"function"!=typeof n&&(n="Identity");"function"!=typeof i&&(i="Thrower");var f=new r;return this.$thenableReactions.push({thenable:f,fulfillHandler:n,rejectHandler:i}),this.$thenableState!==t&&u(this),f},"catch":function(n){return this.then(null,n)}}),o;r.extend({resolve:function(n){var t;return n instanceof r?t=n:(t=new r,i(t,n)),t},reject:function(t){var i=new r;return n(i,t),i}});o="undefined"!=typeof process&&"function"==typeof process.nextTick?process.nextTick:"undefined"!=typeof setImmediate?setImmediate:function(n){setTimeout(n,0)}}(),function(){Object.extend({subset:function(n,t){for(var i,u={},r=0,f=t.length;f>r;r++)i=t[r],i in n&&(u[i]=n[i]);return u},map:function(n,t,i){for(var r,f={},e=Object.keys(n),u=0;u<e.length;u++)r=e[u],f[r]=t.call(i,n[r],r,n);return f},filter:function(n,t,i){for(var r,f,e={},o=Object.keys(n),u=0;u<o.length;u++)r=o[u],f=n[r],t.call(i,f,r,n)&&(e[r]=f);return e},every:function(n,t,i){for(var f,u=Object.keys(n),r=0;r<u.length;r++)if(f=u[r],!t.call(i,n[f],f))return!1;return!0},some:function(n,t,i){for(var f,u=Object.keys(n),r=0;r<u.length;r++)if(f=u[r],t.call(i,n[f],f))return!0;return!1},values:function(n){for(var u,i=[],r=Object.keys(n),t=0;t<r.length;t++)u=r[t],i.push(n[u]);return i},getLength:function(n){return Object.keys(n).length},keyOf:function(n,t){for(var u,r=Object.keys(n),i=0;i<r.length;i++)if(u=r[i],n[u]===t)return u;return null},contains:function(n,t){return null!=Object.keyOf(n,t)},toQueryString:function(n,t){var i=[];return Object.each(n,function(n,r){var u,f;t&&(r=t+"["+r+"]");switch(typeOf(n)){case"object":u=Object.toQueryString(n,r);break;case"array":f={};n.each(function(n,t){f[t]=n});u=Object.toQueryString(f,r);break;default:u=r+"="+encodeURIComponent(n)}null!=n&&i.push(u)}),i.join("&")}})}(),function(){function h(e,o,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt){var ft,it,rt,ut;if((o||-1===u)&&(n.expressions[++u]=[],r=-1,o))return"";if((h||c||-1===r)&&(h=h||" ",ft=n.expressions[u],f&&ft[r]&&(ft[r].reverseCombinator=s(h)),ft[++r]={combinator:h,tag:"*"}),it=n.expressions[u][r],l)it.tag=l.replace(t,"");else if(a)it.id=a.replace(t,"");else if(v)v=v.replace(t,""),it.classList||(it.classList=[]),it.classes||(it.classes=[]),it.classList.push(v),it.classes.push({value:v,regexp:new RegExp("(^|\\s)"+i(v)+"(\\s|$)")});else if(d)tt=tt||nt,tt=tt?tt.replace(t,""):null,it.pseudos||(it.pseudos=[]),it.pseudos.push({key:d.replace(t,""),value:tt,type:1==k.length?"class":"element"});else if(y){y=y.replace(t,"");b=(b||"").replace(t,"");switch(p){case"^=":ut=new RegExp("^"+i(b));break;case"$=":ut=new RegExp(i(b)+"$");break;case"~=":ut=new RegExp("(^|\\s)"+i(b)+"(\\s|$)");break;case"|=":ut=new RegExp("^"+i(b)+"(-|$)");break;case"=":rt=function(n){return b==n};break;case"*=":rt=function(n){return n&&n.indexOf(b)>-1};break;case"!=":rt=function(n){return b!=n};break;default:rt=function(n){return!!n}}""==b&&/^[*$^]=$/.test(p)&&(rt=function(){return!1});rt||(rt=function(n){return n&&ut.test(n)});it.attributes||(it.attributes=[]);it.attributes.push({key:y,operator:p,value:b,test:rt})}return""}var n,u,r,f,c={},l={},t=/\\/g,o=function(t,i){if(null==t)return null;if(t.Slick===!0)return t;t=(""+t).replace(/^\s+|\s+$/g,"");f=!!i;var r=f?l:c;if(r[t])return r[t];for(n={Slick:!0,expressions:[],raw:t,reverse:function(){return o(this.raw,!0)}},u=-1;t!=(t=t.replace(v,h)););return n.length=n.expressions.length,r[n.raw]=f?a(n):n},s=function(n){return"!"===n?" ":" "===n?"!":/^!/.test(n)?n.replace(/^!/,""):"!"+n},a=function(n){for(var t,u=n.expressions,i=0;i<u.length;i++){for(var r=u[i],e={parts:[],tag:"*",combinator:s(r[0].combinator)},f=0;f<r.length;f++)t=r[f],t.reverseCombinator||(t.reverseCombinator=" "),t.combinator=t.reverseCombinator,delete t.reverseCombinator;r.reverse().push(e)}return n},i=function(n){return n.replace(/[-[\]{}()*+?.\\^$|,#\s]/g,function(n){return"\\"+n})},v=new RegExp("^(?:\\s*(,)\\s*|\\s*(<combinator>+)\\s*|(\\s+)|(<unicode>+|\\*)|\\#(<unicode>+)|\\.(<unicode>+)|\\[\\s*(<unicode1>+)(?:\\s*([*^$!~|]?=)(?:\\s*(?:([\"']?)(.*?)\\9)))?\\s*\\](?!\\])|(:+)(<unicode>+)(?:\\((?:(?:([\"'])([^\\13]*)\\13)|((?:\\([^)]+\\)|[^()]*)+))\\))?)".replace(/<combinator>/,"["+i(">+~`!@$%^&={}\\;<\/")+"]").replace(/<unicode>/g,"(?:[\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])").replace(/<unicode1>/g,"(?:[:\\w\\u00a1-\\uFFFF-]|\\\\[^\\s0-9a-f])")),e=this.Slick||{};e.parse=function(n){return o(n)};e.escapeRegExp=i;this.Slick||(this.Slick=e)}.apply("undefined"!=typeof exports?exports:this),function(){var n={},o={},h=Object.prototype.toString,r,u,f,e,i,t;n.isNativeCode=function(n){return/\{\s*\[native code\]\s*\}/.test(""+n)};n.isXML=function(n){return!!n.xmlVersion||!!n.xml||"[object XMLDocument]"==h.call(n)||9==n.nodeType&&"HTML"!=n.documentElement.nodeName};n.setDocument=function(n){var l=n.nodeType,h,c;if(9!=l)if(l)n=n.ownerDocument;else{if(!n.navigator)return;n=n.document}if(this.document!==n){this.document=n;var f,r=n.documentElement,a=this.getUIDXML(r),t=o[a];if(t)for(f in t)this[f]=t[f];else{t=o[a]={};t.root=r;t.isXMLDocument=this.isXML(n);t.brokenStarGEBTN=t.starSelectsClosedQSA=t.idGetsName=t.brokenMixedCaseQSA=t.brokenGEBCN=t.brokenCheckedQSA=t.brokenEmptyAttributeQSA=t.isHTMLDocument=t.nativeMatchesSelector=!1;var v,y,p,w,b,u,e="slick_uniqueid",i=n.createElement("div"),s=n.body||n.getElementsByTagName("body")[0]||r;s.appendChild(i);try{i.innerHTML='<a id="'+e+'"><\/a>';t.isHTMLDocument=!!n.getElementById(e)}catch(k){}if(t.isHTMLDocument){i.style.display="none";i.appendChild(n.createComment(""));y=i.getElementsByTagName("*").length>1;try{i.innerHTML="foo<\/foo>";u=i.getElementsByTagName("*");v=u&&!!u.length&&"/"==u[0].nodeName.charAt(0)}catch(k){}t.brokenStarGEBTN=y||v;try{i.innerHTML='<a name="'+e+'"><\/a><b id="'+e+'"><\/b>';t.idGetsName=n.getElementById(e)===i.firstChild}catch(k){}if(i.getElementsByClassName){try{i.innerHTML='<a class="f"><\/a><a class="b"><\/a>';i.getElementsByClassName("b").length;i.firstChild.className="b";w=2!=i.getElementsByClassName("b").length}catch(k){}try{i.innerHTML='<a class="a"><\/a><a class="f b a"><\/a>';p=2!=i.getElementsByClassName("a").length}catch(k){}t.brokenGEBCN=w||p}if(i.querySelectorAll){try{i.innerHTML="foo<\/foo>";u=i.querySelectorAll("*");t.starSelectsClosedQSA=u&&!!u.length&&"/"==u[0].nodeName.charAt(0)}catch(k){}try{i.innerHTML='<a class="MiX"><\/a>';t.brokenMixedCaseQSA=!i.querySelectorAll(".MiX").length}catch(k){}try{i.innerHTML='<select><option selected="selected">a<\/option><\/select>';t.brokenCheckedQSA=0==i.querySelectorAll(":checked").length}catch(k){}try{i.innerHTML='<a class=""><\/a>';t.brokenEmptyAttributeQSA=0!=i.querySelectorAll('[class*=""]').length}catch(k){}}try{i.innerHTML='<form action="s"><input id="action"/><\/form>';b="s"!=i.firstChild.getAttribute("action")}catch(k){}if(t.nativeMatchesSelector=r.matches||r.mozMatchesSelector||r.webkitMatchesSelector,t.nativeMatchesSelector)try{t.nativeMatchesSelector.call(r,":slick");t.nativeMatchesSelector=null}catch(k){}}try{r.slick_expando=1;delete r.slick_expando;t.getUID=this.getUIDHTML}catch(k){t.getUID=this.getUIDXML}s.removeChild(i);i=u=s=null;t.getAttribute=t.isHTMLDocument&&b?function(n,t){var r=this.attributeGetters[t],i;return r?r.call(n):(i=n.getAttributeNode(t),i?i.nodeValue:null)}:function(n,t){var i=this.attributeGetters[t];return i?i.call(n):n.getAttribute(t)};t.hasAttribute=r&&this.isNativeCode(r.hasAttribute)?function(n,t){return n.hasAttribute(t)}:function(n,t){return n=n.getAttributeNode(t),!(!n||!n.specified&&!n.nodeValue)};h=r&&this.isNativeCode(r.contains);c=n&&this.isNativeCode(n.contains);t.contains=h&&c?function(n,t){return n.contains(t)}:h&&!c?function(t,i){return t===i||(t===n?n.documentElement:t).contains(i)}:r&&r.compareDocumentPosition?function(n,t){return n===t||!!(16&n.compareDocumentPosition(t))}:function(n,t){if(t)do if(t===n)return!0;while(t=t.parentNode);return!1};t.documentSorter=r.compareDocumentPosition?function(n,t){return n.compareDocumentPosition&&t.compareDocumentPosition?4&n.compareDocumentPosition(t)?-1:n===t?0:1:0}:"sourceIndex"in r?function(n,t){return n.sourceIndex&&t.sourceIndex?n.sourceIndex-t.sourceIndex:0}:n.createRange?function(n,t){if(!n.ownerDocument||!t.ownerDocument)return 0;var i=n.ownerDocument.createRange(),r=t.ownerDocument.createRange();return i.setStart(n,0),i.setEnd(n,0),r.setStart(t,0),r.setEnd(t,0),i.compareBoundaryPoints(Range.START_TO_END,r)}:null;r=null;for(f in t)this[f]=t[f]}}};var c=/^([#.]?)((?:[\w-]+|\*))$/,l=/\[.+[*$^]=(?:""|'')?\]/,s={};n.search=function(n,i,r,u){var f=this.found=u?null:r||[],rt,ut,b,pt,vt,g,k,nt,p,ft,tt,et,ot,st,ht,ct,lt,it,yt,v,at,wt;if(!n)return f;if(n.navigator)n=n.document;else if(!n.nodeType)return f;var w,o,e,h,y=this.uniques={},a=!(!r||!r.length),d=9==n.nodeType;if(this.document!==(d?n:n.ownerDocument)&&this.setDocument(n),a)for(o=f.length;o--;)y[this.getUID(f[o])]=!0;if("string"==typeof i){rt=i.match(c);n:if(rt){if(ut=rt[1],b=rt[2],ut){if("#"==ut){if(!this.isHTMLDocument||!d)break n;if(e=n.getElementById(b),!e)return f;if(this.idGetsName&&e.getAttributeNode("id").nodeValue!=b)break n;if(u)return e||null;a&&y[this.getUID(e)]||f.push(e)}else if("."==ut){if(!this.isHTMLDocument||(!n.getElementsByClassName||this.brokenGEBCN)&&n.querySelectorAll)break n;if(n.getElementsByClassName&&!this.brokenGEBCN){if(h=n.getElementsByClassName(b),u)return h[0]||null;for(o=0;e=h[o++];)a&&y[this.getUID(e)]||f.push(e)}else for(pt=new RegExp("(^|\\s)"+t.escapeRegExp(b)+"(\\s|$)"),h=n.getElementsByTagName("*"),o=0;e=h[o++];)if(className=e.className,className&&pt.test(className)){if(u)return e;a&&y[this.getUID(e)]||f.push(e)}}}else{if("*"==b&&this.brokenStarGEBTN)break n;if(h=n.getElementsByTagName(b),u)return h[0]||null;for(o=0;e=h[o++];)a&&y[this.getUID(e)]||f.push(e)}return a&&this.sort(f),u?null:f}n:if(n.querySelectorAll){if(!this.isHTMLDocument||s[i]||this.brokenMixedCaseQSA||this.brokenCheckedQSA&&i.indexOf(":checked")>-1||this.brokenEmptyAttributeQSA&&l.test(i)||!d&&i.indexOf(",")>-1||t.disableQSA)break n;g=i;k=n;d||(vt=k.getAttribute("id"),slickid="slickid__",k.setAttribute("id",slickid),g="#"+slickid+" "+g,n=k.parentNode);try{if(u)return n.querySelector(g)||null;h=n.querySelectorAll(g)}catch(bt){s[i]=1;break n}finally{d||(vt?k.setAttribute("id",vt):k.removeAttribute("id"),n=k)}if(this.starSelectsClosedQSA)for(o=0;e=h[o++];)e.nodeName>"@"&&(!a||!y[this.getUID(e)])&&f.push(e);else for(o=0;e=h[o++];)a&&y[this.getUID(e)]||f.push(e);return a&&this.sort(f),f}if(w=this.Slick.parse(i),!w.length)return f}else{if(null==i)return f;if(!i.Slick)return this.contains(n.documentElement||n,i)?(f?f.push(i):f=i,f):f;w=i}this.posNTH={};this.posNTHLast={};this.posNTHType={};this.posNTHTypeLast={};this.push=!a&&(u||1==w.length&&1==w.expressions[0].length)?this.pushArray:this.pushUID;null==f&&(f=[]);wt=w.expressions;n:for(o=0;yt=wt[o];o++)for(nt=0;v=yt[nt];nt++){if(tt="combinator:"+v.combinator,!this[tt])continue n;if(et=this.isXMLDocument?v.tag:v.tag.toUpperCase(),ot=v.id,st=v.classList,ht=v.classes,ct=v.attributes,lt=v.pseudos,at=nt===yt.length-1,this.bitUniques={},at?(this.uniques=y,this.found=f):(this.uniques={},this.found=[]),0===nt){if(this[tt](n,et,ot,ht,ct,lt,st),u&&at&&f.length)break n}else if(u&&at){for(p=0,ft=it.length;ft>p;p++)if(this[tt](it[p],et,ot,ht,ct,lt,st),f.length)break n}else for(p=0,ft=it.length;ft>p;p++)this[tt](it[p],et,ot,ht,ct,lt,st);it=this.found}return(a||w.expressions.length>1)&&this.sort(f),u?f[0]||null:f};n.uidx=1;n.uidk="slick-uniqueid";n.getUIDXML=function(n){var t=n.getAttribute(this.uidk);return t||(t=this.uidx++,n.setAttribute(this.uidk,t)),t};n.getUIDHTML=function(n){return n.uniqueNumber||(n.uniqueNumber=this.uidx++)};n.sort=function(n){return this.documentSorter?(n.sort(this.documentSorter),n):n};n.cacheNTH={};n.matchNTH=/^([+-]?\d*)?([a-z]+)?([+-]\d+)?$/;n.parseNTHArgument=function(n){var t=n.match(this.matchNTH),r,i,u;return t?(r=t[2]||!1,i=t[1]||1,"-"==i&&(i=-1),u=+t[3]||0,t="n"==r?{a:i,b:u}:"odd"==r?{a:2,b:1}:"even"==r?{a:2,b:0}:{a:0,b:i},this.cacheNTH[n]=t):!1};n.createNTHPseudo=function(n,t,i,r){return function(u,f){var v=this.getUID(u),c,e,l,y,o;if(!this[i][v]){if(c=u.parentNode,!c)return!1;if(e=c[n],l=1,r){y=u.nodeName;do e.nodeName==y&&(this[i][this.getUID(e)]=l++);while(e=e[t])}else do 1==e.nodeType&&(this[i][this.getUID(e)]=l++);while(e=e[t])}if(f=f||"n",o=this.cacheNTH[f]||this.parseNTHArgument(f),!o)return!1;var a=o.a,s=o.b,h=this[i][v];if(0==a)return s==h;if(a>0){if(s>h)return!1}else if(h>s)return!1;return(h-s)%a==0}};n.pushArray=function(n,t,i,r,u,f){this.matchSelector(n,t,i,r,u,f)&&this.found.push(n)};n.pushUID=function(n,t,i,r,u,f){var e=this.getUID(n);!this.uniques[e]&&this.matchSelector(n,t,i,r,u,f)&&(this.uniques[e]=!0,this.found.push(n))};n.matchNode=function(n,t){var r,u,f,o,e,i,s,h;if(this.isHTMLDocument&&this.nativeMatchesSelector)try{return this.nativeMatchesSelector.call(n,t.replace(/\[([^=]+)=\s*([^'"\]]+?)\s*\]/g,'[$1="$2"]'))}catch(c){}if(r=this.Slick.parse(t),!r)return!0;for(o=r.expressions,e=0,u=0;f=o[u];u++)if(1==f.length){if(i=f[0],this.matchSelector(n,this.isXMLDocument?i.tag:i.tag.toUpperCase(),i.id,i.classes,i.attributes,i.pseudos))return!0;e++}if(e==r.length)return!1;for(h=this.search(this.document,r),u=0;s=h[u++];)if(s===n)return!0;return!1};n.matchPseudo=function(n,t,i){var u="pseudo:"+t,r;return this[u]?this[u](n,i):(r=this.getAttribute(n,t),i?i==r:!!r)};n.matchSelector=function(n,t,i,r,u,f){var s,e,o,h;if(t)if(s=this.isXMLDocument?n.nodeName:n.nodeName.toUpperCase(),"*"==t){if("@">s)return!1}else if(s!=t)return!1;if(i&&n.getAttribute("id")!=i)return!1;if(r)for(e=r.length;e--;)if(h=this.getAttribute(n,"class"),!h||!r[e].regexp.test(h))return!1;if(u)for(e=u.length;e--;)if(o=u[e],o.operator?!o.test(this.getAttribute(n,o.key)):!this.hasAttribute(n,o.key))return!1;if(f)for(e=f.length;e--;)if(o=f[e],!this.matchPseudo(n,o.key,o.value))return!1;return!0};r={" ":function(n,t,i,r,u,f,e){var h,o,s,c;if(this.isHTMLDocument){n:if(i){if(o=this.document.getElementById(i),!o&&n.all||this.idGetsName&&o&&o.getAttributeNode("id").nodeValue!=i){if(s=n.all[i],!s)return;for(s[0]||(s=[s]),h=0;o=s[h++];)if(c=o.getAttributeNode("id"),c&&c.nodeValue==i){this.push(o,t,null,r,u,f);break}return}if(!o){if(this.contains(this.root,n))return;break n}return this.document!==n&&!this.contains(n,o)?void 0:void this.push(o,t,null,r,u,f)}n:if(r&&n.getElementsByClassName&&!this.brokenGEBCN){if(s=n.getElementsByClassName(e.join(" ")),!s||!s.length)break n;for(h=0;o=s[h++];)this.push(o,t,i,null,u,f);return}}if(s=n.getElementsByTagName(t),s&&s.length)for(this.brokenStarGEBTN||(t=null),h=0;o=s[h++];)this.push(o,t,i,r,u,f)},">":function(n,t,i,r,u,f){if(n=n.firstChild)do 1==n.nodeType&&this.push(n,t,i,r,u,f);while(n=n.nextSibling)},"+":function(n,t,i,r,u,f){for(;n=n.nextSibling;)if(1==n.nodeType){this.push(n,t,i,r,u,f);break}},"^":function(n,t,i,r,u,f){n=n.firstChild;n&&(1==n.nodeType?this.push(n,t,i,r,u,f):this["combinator:+"](n,t,i,r,u,f))},"~":function(n,t,i,r,u,f){for(;n=n.nextSibling;)if(1==n.nodeType){var e=this.getUID(n);if(this.bitUniques[e])break;this.bitUniques[e]=!0;this.push(n,t,i,r,u,f)}},"++":function(n,t,i,r,u,f){this["combinator:+"](n,t,i,r,u,f);this["combinator:!+"](n,t,i,r,u,f)},"~~":function(n,t,i,r,u,f){this["combinator:~"](n,t,i,r,u,f);this["combinator:!~"](n,t,i,r,u,f)},"!":function(n,t,i,r,u,f){for(;n=n.parentNode;)n!==this.document&&this.push(n,t,i,r,u,f)},"!>":function(n,t,i,r,u,f){n=n.parentNode;n!==this.document&&this.push(n,t,i,r,u,f)},"!+":function(n,t,i,r,u,f){for(;n=n.previousSibling;)if(1==n.nodeType){this.push(n,t,i,r,u,f);break}},"!^":function(n,t,i,r,u,f){n=n.lastChild;n&&(1==n.nodeType?this.push(n,t,i,r,u,f):this["combinator:!+"](n,t,i,r,u,f))},"!~":function(n,t,i,r,u,f){for(;n=n.previousSibling;)if(1==n.nodeType){var e=this.getUID(n);if(this.bitUniques[e])break;this.bitUniques[e]=!0;this.push(n,t,i,r,u,f)}}};for(u in r)n["combinator:"+u]=r[u];f={empty:function(n){var t=n.firstChild;return!(t&&1==t.nodeType||(n.innerText||n.textContent||"").length)},not:function(n,t){return!this.matchNode(n,t)},contains:function(n,t){return(n.innerText||n.textContent||"").indexOf(t)>-1},"first-child":function(n){for(;n=n.previousSibling;)if(1==n.nodeType)return!1;return!0},"last-child":function(n){for(;n=n.nextSibling;)if(1==n.nodeType)return!1;return!0},"only-child":function(n){for(var i,t=n;t=t.previousSibling;)if(1==t.nodeType)return!1;for(i=n;i=i.nextSibling;)if(1==i.nodeType)return!1;return!0},"nth-child":n.createNTHPseudo("firstChild","nextSibling","posNTH"),"nth-last-child":n.createNTHPseudo("lastChild","previousSibling","posNTHLast"),"nth-of-type":n.createNTHPseudo("firstChild","nextSibling","posNTHType",!0),"nth-last-of-type":n.createNTHPseudo("lastChild","previousSibling","posNTHTypeLast",!0),index:function(n,t){return this["pseudo:nth-child"](n,""+(t+1))},even:function(n){return this["pseudo:nth-child"](n,"2n")},odd:function(n){return this["pseudo:nth-child"](n,"2n+1")},"first-of-type":function(n){for(var t=n.nodeName;n=n.previousSibling;)if(n.nodeName==t)return!1;return!0},"last-of-type":function(n){for(var t=n.nodeName;n=n.nextSibling;)if(n.nodeName==t)return!1;return!0},"only-of-type":function(n){for(var i,t=n,r=n.nodeName;t=t.previousSibling;)if(t.nodeName==r)return!1;for(i=n;i=i.nextSibling;)if(i.nodeName==r)return!1;return!0},enabled:function(n){return!n.disabled},disabled:function(n){return n.disabled},checked:function(n){return n.checked||n.selected},focus:function(n){return this.isHTMLDocument&&this.document.activeElement===n&&(n.href||n.type||this.hasAttribute(n,"tabindex"))},root:function(n){return n===this.root},selected:function(n){return n.selected}};for(e in f)n["pseudo:"+e]=f[e];i=n.attributeGetters={"for":function(){return"htmlFor"in this?this.htmlFor:this.getAttribute("for")},href:function(){return"href"in this?this.getAttribute("href",2):this.getAttribute("href")},style:function(){return this.style?this.style.cssText:this.getAttribute("style")},tabindex:function(){var n=this.getAttributeNode("tabindex");return n&&n.specified?n.nodeValue:null},type:function(){return this.getAttribute("type")},maxlength:function(){var n=this.getAttributeNode("maxLength");return n&&n.specified?n.nodeValue:null}};i.MAXLENGTH=i.maxLength=i.maxlength;t=n.Slick=this.Slick||{};t.version="1.1.7";t.search=function(t,i,r){return n.search(t,i,r)};t.find=function(t,i){return n.search(t,i,null,!0)};t.contains=function(t,i){return n.setDocument(t),n.contains(t,i)};t.getAttribute=function(t,i){return n.setDocument(t),n.getAttribute(t,i)};t.hasAttribute=function(t,i){return n.setDocument(t),n.hasAttribute(t,i)};t.match=function(t,i){return t&&i?i&&i!==t?(n.setDocument(t),n.matchNode(t,i)):!0:!1};t.defineAttributeGetter=function(t,i){return n.attributeGetters[t]=i,this};t.lookupAttributeGetter=function(t){return n.attributeGetters[t]};t.definePseudo=function(t,i){return n["pseudo:"+t]=function(n,t){return i.call(n,t)},this};t.lookupPseudo=function(t){var i=n["pseudo:"+t];return i?function(n){return i.call(this,n)}:null};t.override=function(t,i){return n.override(t,i),this};t.isXML=n.isXML;t.uidOf=function(t){return n.getUIDHTML(t)};this.Slick||(this.Slick=t)}.apply("undefined"!=typeof exports?exports:this),Element=this.Element=function(n,t){var e=Element.Constructors[n],r,u,i,f,o;if(e)return e(t);if("string"!=typeof n)return document.id(n).set(t);if(t||(t={}),!/^[\w-]+$/.test(n)){if(r=Slick.parse(n).expressions[0][0],n="*"==r.tag?"div":r.tag,r.id&&null==t.id&&(t.id=r.id),u=r.attributes,u)for(f=0,o=u.length;o>f;f++)i=u[f],null==t[i.key]&&(null!=i.value&&"="==i.operator?t[i.key]=i.value:i.value||i.operator||(t[i.key]=!0));r.classList&&null==t["class"]&&(t["class"]=r.classList.join(" "))}return document.newElement(n,t)},Browser.Element&&(Element.prototype=Browser.Element.prototype,Element.prototype._fireEvent=function(n){return function(t,i){return n.call(this,t,i)}}(Element.prototype.fireEvent)),new Type("Element",Element).mirror(function(n){if(!Array.prototype[n]){var t={};t[n]=function(){for(var u,f,i=[],e=arguments,r=!0,t=0,o=this.length;o>t;t++)u=this[t],f=i[t]=u[n].apply(u,e),r=r&&"element"==typeOf(f);return r?new Elements(i):i};Elements.implement(t)}}),Browser.Element||(Element.parent=Object,Element.Prototype={$constructor:Element,$family:Function.convert("element").hide()},Element.mirror(function(n,t){Element.Prototype[n]=t})),Element.Constructors={},IFrame=new Type("IFrame",function(){var n,i=Array.link(arguments,{properties:Type.isObject,iframe:function(n){return null!=n}}),t=i.properties||{},u,r;return i.iframe&&(n=document.id(i.iframe)),u=t.onload||function(){},delete t.onload,t.id=t.name=[t.id,t.name,n?n.id||n.name:"IFrame_"+String.uniqueID()].pick(),n=new Element(n||"iframe",t),r=function(){u.call(n.contentWindow)},window.frames[t.id]?r():n.addListener("load",r),n}),Elements=this.Elements=function(n){var t,i,u,r;if(n&&n.length)for(i={},u=0;t=n[u++];)r=Slick.uidOf(t),i[r]||(i[r]=!0,this.push(t))},Elements.prototype={length:0},Elements.parent=Array,new Type("Elements",Elements).implement({filter:function(n,t){return n?new Elements(Array.filter(this,"string"==typeOf(n)?function(t){return t.match(n)}:n,t)):this}.protect(),push:function(){for(var t,i=this.length,n=0,r=arguments.length;r>n;n++)t=document.id(arguments[n]),t&&(this[i++]=t);return this.length=i}.protect(),unshift:function(){for(var t,i=[],n=0,r=arguments.length;r>n;n++)t=document.id(arguments[n]),t&&i.push(t);return Array.prototype.unshift.apply(this,i)}.protect(),concat:function(){for(var n,t=new Elements(this),i=0,r=arguments.length;r>i;i++)n=arguments[i],Type.isEnumerable(n)?t.append(n):t.push(n);return t}.protect(),append:function(n){for(var t=0,i=n.length;i>t;t++)this.push(n[t]);return this}.protect(),empty:function(){for(;this.length;)delete this[--this.length];return this}.protect()}),function(){var t=Array.prototype.splice,i={0:0,1:1,length:2},r,n,u;t.call(i,1,1);1==i[1]&&Elements.implement("splice",function(){for(var n=this.length,i=t.apply(this,arguments);n>=this.length;)delete this[n--];return i}.protect());Array.forEachMethod(function(n,t){Elements.implement(t,n)});Array.mirror(Elements);try{r="x"==document.createElement("<input name=x>").name}catch(f){}n=function(n){return(""+n).replace(/&/g,"&amp;").replace(/"/g,"&quot;")};u=function(){var n=document.createElement("style"),t=!1;try{n.innerHTML="#justTesing{margin: 0px;}";t=!!n.innerHTML}catch(i){}return t}();Document.implement({newElement:function(t,i){if(i){if(null!=i.checked&&(i.defaultChecked=i.checked),"checkbox"!=i.type&&"radio"!=i.type||null!=i.value||(i.value="on"),!u&&"style"==t){var f=document.createElement("style");return f.setAttribute("type","text/css"),i.type&&delete i.type,this.id(f).set(i)}r&&(t="<"+t,i.name&&(t+=' name="'+n(i.name)+'"'),i.type&&(t+=' type="'+n(i.type)+'"'),t+=">",delete i.name,delete i.type)}return this.id(this.createElement(t)).set(i)}})}(),function(){var y,e,i,rt,ut,s,ft,et,ot,t,st,g,tt,a,it,v;Slick.uidOf(window);Slick.uidOf(document);Document.implement({newTextNode:function(n){return this.createTextNode(n)},getDocument:function(){return this},getWindow:function(){return this.window},id:function(){var n={string:function(t,i,r){return t=Slick.find(r,"#"+t.replace(/(\W)/g,"\\$1")),t?n.element(t,i):null},element:function(n,t){if(Slick.uidOf(n),!t&&!n.$family&&!/^(?:object|embed)$/i.test(n.tagName)){var i=n.fireEvent;n._fireEvent=function(n,t){return i(n,t)};Object.append(n,Element.Prototype)}return n},object:function(t,i,r){return t.toElement?n.element(t.toElement(r),i):null}};return n.textnode=n.whitespace=n.window=n.document=function(n){return n},function(t,i,r){if(t&&t.$family&&t.uniqueNumber)return t;var u=typeOf(t);return n[u]?n[u](t,i,r||document):null}}()});null==window.$&&Window.implement("$",function(n,t){return document.id(n,t,this.document)});Window.implement({getDocument:function(){return this.document},getWindow:function(){return this}});[Document,Element].invoke("implement",{getElements:function(n){return Slick.search(this,n,new Elements)},getElement:function(n){return document.id(Slick.find(this,n))}});y={contains:function(n){return Slick.contains(this,n)}};document.contains||Document.implement(y);document.createElement("div").contains||Element.implement(y);e=function(n,t){if(!n)return t;n=Object.clone(Slick.parse(n));for(var i=n.expressions,r=i.length;r--;)i[r][0].combinator=t;return n};Object.forEach({getNext:"~",getPrevious:"!~",getParent:"!"},function(n,t){Element.implement(t,function(t){return this.getElement(e(t,n))})});Object.forEach({getAllNext:"~",getAllPrevious:"!~",getSiblings:"~~",getChildren:">",getParents:"!"},function(n,t){Element.implement(t,function(t){return this.getElements(e(t,n))})});Element.implement({getFirst:function(n){return document.id(Slick.search(this,e(n,">"))[0])},getLast:function(n){return document.id(Slick.search(this,e(n,">")).getLast())},getWindow:function(){return this.ownerDocument.window},getDocument:function(){return this.ownerDocument},getElementById:function(n){return document.id(Slick.find(this,"#"+(""+n).replace(/(\W)/g,"\\$1")))},match:function(n){return!n||Slick.match(this,n)}});null==window.$$&&Window.implement("$$",function(n){if(1==arguments.length){if("string"==typeof n)return Slick.search(this.document,n,new Elements);if(Type.isEnumerable(n))return new Elements(n)}return new Elements(arguments)});i={before:function(n,t){var i=t.parentNode;i&&i.insertBefore(n,t)},after:function(n,t){var i=t.parentNode;i&&i.insertBefore(n,t.nextSibling)},bottom:function(n,t){t.appendChild(n)},top:function(n,t){t.insertBefore(n,t.firstChild)}};i.inside=i.bottom;var r={},n={},o={};Array.forEach(["type","value","defaultValue","accessKey","cellPadding","cellSpacing","colSpan","frameBorder","rowSpan","tabIndex","useMap"],function(n){o[n.toLowerCase()]=n});o.html="innerHTML";o.text=null==document.createElement("div").textContent?"innerText":"textContent";Object.forEach(o,function(t,i){n[i]=function(n,i){n[t]=i};r[i]=function(n){return n[t]}});n.text=function(){return function(n,t){"style"==n.get("tag")?n.set("html",t):n[o.text]=t}}(n.text);r.text=function(n){return function(t){return"style"==t.get("tag")?t.innerHTML:n(t)}}(r.text);rt=["compact","nowrap","ismap","declare","noshade","checked","disabled","readOnly","multiple","selected","noresize","defer","defaultChecked","autofocus","controls","autoplay","loop"];ut={};Array.forEach(rt,function(t){var i=t.toLowerCase();ut[i]=t;n[i]=function(n,i){n[t]=!!i};r[i]=function(n){return!!n[t]}});Object.append(n,{"class":function(n,t){"className"in n?n.className=t||"":n.setAttribute("class",t)},"for":function(n,t){"htmlFor"in n?n.htmlFor=t:n.setAttribute("for",t)},style:function(n,t){n.style?n.style.cssText=t:n.setAttribute("style",t)},value:function(n,t){n.value=null!=t?t:""}});r["class"]=function(n){return"className"in n?n.className||null:n.getAttribute("class")};s=document.createElement("button");try{s.type="button"}catch(pt){}"button"!=s.type&&(n.type=function(n,t){n.setAttribute("type",t)});s=null;ot=function(){var n=document.createElement("style"),t=!1;try{n.innerHTML="#justTesing{margin: 0px;}";t=!!n.innerHTML}catch(i){}return t}();t=document.createElement("input");t.value="t";t.type="submit";ft="t"!=t.value;try{t.value="";t.type="email";et="email"==t.type}catch(pt){}t=null;(ft||!et)&&(n.type=function(n,t){try{var i=n.value;n.type=t;n.value=i}catch(r){}});var h=function(n){return n.random="attribute","attribute"==n.getAttribute("random")}(document.createElement("div")),lt=function(n){return n.innerHTML='<object><param name="should_fix" value="the unknown" /><\/object>',1!=n.cloneNode(!0).firstChild.childNodes.length}(document.createElement("div")),p=!!document.createElement("div").classList,u=function(n){var i=(n||"").clean().split(" "),t={};return i.filter(function(n){if(""!==n&&!t[n])return t[n]=n})},at=function(n){this.classList.add(n)},vt=function(n){this.classList.remove(n)};Element.implement({setProperty:function(t,i){var u=n[t.toLowerCase()],r;return u?u(this,i):(h&&(r=this.retrieve("$attributeWhiteList",{})),null==i?(this.removeAttribute(t),h&&delete r[t]):(this.setAttribute(t,""+i),h&&(r[t]=!0))),this},setProperties:function(n){for(var t in n)this.setProperty(t,n[t]);return this},getProperty:function(n){var e=r[n.toLowerCase()],t,i,u,f;if(e)return e(this);if(h){if(t=this.getAttributeNode(n),i=this.retrieve("$attributeWhiteList",{}),!t)return null;if(t.expando&&!i[n]){if(u=this.outerHTML,u.substr(0,u.search(/\/?['"]?>(?![^<]*<['"])/)).indexOf(n)<0)return null;i[n]=!0}}return f=Slick.getAttribute(this,n),f||Slick.hasAttribute(this,n)?f:null},getProperties:function(){var n=Array.convert(arguments);return n.map(this.getProperty,this).associate(n)},removeProperty:function(n){return this.setProperty(n,null)},removeProperties:function(){return Array.each(arguments,this.removeProperty,this),this},set:function(n,t){var i=Element.Properties[n];i&&i.set?i.set.call(this,t):this.setProperty(n,t)}.overloadSetter(),get:function(n){var t=Element.Properties[n];return t&&t.get?t.get.apply(this):this.getProperty(n)}.overloadGetter(),erase:function(n){var t=Element.Properties[n];return t&&t.erase?t.erase.apply(this):this.removeProperty(n),this},hasClass:p?function(n){return this.classList.contains(n)}:function(n){return u(this.className).contains(n)},addClass:p?function(n){return u(n).forEach(at,this),this}:function(n){return this.className=u(n+" "+this.className).join(" "),this},removeClass:p?function(n){return u(n).forEach(vt,this),this}:function(n){var t=u(this.className);return u(n).forEach(t.erase,t),this.className=t.join(" "),this},toggleClass:function(n,t){return null==t&&(t=!this.hasClass(n)),t?this.addClass(n):this.removeClass(n)},adopt:function(){var t,r=this,u=Array.flatten(arguments),f=u.length,n,i;for(f>1&&(r=t=document.createDocumentFragment()),n=0;f>n;n++)i=document.id(u[n],!0),i&&r.appendChild(i);return t&&this.appendChild(t),this},appendText:function(n,t){return this.grab(this.getDocument().newTextNode(n),t)},grab:function(n,t){return i[t||"bottom"](document.id(n,!0),this),this},inject:function(n,t){return i[t||"bottom"](this,document.id(n,!0)),this},replaces:function(n){return n=document.id(n,!0),n.parentNode.replaceChild(this,n),this},wraps:function(n,t){return n=document.id(n,!0),this.replaces(n).grab(n,t)},getSelected:function(){return this.selectedIndex,new Elements(Array.convert(this.options).filter(function(n){return n.selected}))},toQueryString:function(){var n=[];return this.getElements("input, select, textarea").each(function(t){var i=t.type,r;t.name&&!t.disabled&&"submit"!=i&&"reset"!=i&&"file"!=i&&"image"!=i&&(r="select"==t.get("tag")?t.getSelected().map(function(n){return document.id(n).get("value")}):"radio"!=i&&"checkbox"!=i||t.checked?t.get("value"):null,Array.convert(r).each(function(i){"undefined"!=typeof i&&n.push(encodeURIComponent(t.name)+"="+encodeURIComponent(i))}))}),n.join("&")}});st={before:"beforeBegin",after:"afterEnd",bottom:"beforeEnd",top:"afterBegin",inside:"beforeEnd"};Element.implement("appendHTML","insertAdjacentHTML"in document.createElement("div")?function(n,t){return this.insertAdjacentHTML(st[t||"bottom"],n),this}:function(n,t){var e=new Element("div",{html:n}),f=e.childNodes,r=e.firstChild,u,o;if(!r)return this;if(f.length>1)for(r=document.createDocumentFragment(),u=0,o=f.length;o>u;u++)r.appendChild(f[u]);return i[t||"bottom"](r,this),this});var w={},b={},k=function(n){return b[n]||(b[n]={})},d=function(n){var t=n.uniqueNumber;return n.removeEvents&&n.removeEvents(),n.clearAttributes&&n.clearAttributes(),null!=t&&(delete w[t],delete b[t]),n},yt={input:"checked",option:"selected",textarea:"value"};(Element.implement({destroy:function(){var n=d(this).getElementsByTagName("*");return Array.each(n,d),Element.dispose(this),null},empty:function(){return Array.convert(this.childNodes).each(Element.dispose),this},dispose:function(){return this.parentNode?this.parentNode.removeChild(this):this},clone:function(n,t){var i,u,f,h,a;n=n!==!1;var r,e=this.cloneNode(n),o=[e],c=[this];for(n&&(o.append(Array.convert(e.getElementsByTagName("*"))),c.append(Array.convert(this.getElementsByTagName("*")))),r=o.length;r--;){if(i=o[r],u=c[r],t||i.removeAttribute("id"),i.clearAttributes&&(i.clearAttributes(),i.mergeAttributes(u),i.removeAttribute("uniqueNumber"),i.options))for(var l=i.options,v=u.options,s=l.length;s--;)l[s].selected=v[s].selected;f=yt[u.tagName.toLowerCase()];f&&u[f]&&(i[f]=u[f])}if(lt)for(h=e.getElementsByTagName("object"),a=this.getElementsByTagName("object"),r=h.length;r--;)h[r].outerHTML=a[r].outerHTML;return document.id(e)}}),[Element,Window,Document].invoke("implement",{addListener:function(n,t){return window.attachEvent&&!window.addEventListener&&(w[Slick.uidOf(this)]=this),this.addEventListener?this.addEventListener(n,t,!!arguments[2]):this.attachEvent("on"+n,t),this},removeListener:function(n,t){return this.removeEventListener?this.removeEventListener(n,t,!!arguments[2]):this.detachEvent("on"+n,t),this},retrieve:function(n,t){var r=k(Slick.uidOf(this)),i=r[n];return null!=t&&null==i&&(i=r[n]=t),null!=i?i:null},store:function(n,t){var i=k(Slick.uidOf(this));return i[n]=t,this},eliminate:function(n){var t=k(Slick.uidOf(this));return delete t[n],this}}),window.attachEvent&&!window.addEventListener)&&(g=function(){Object.each(w,d);window.CollectGarbage&&CollectGarbage();window.removeListener("unload",g)},window.addListener("unload",g));Element.Properties={};Element.Properties.style={set:function(n){this.style.cssText=n},get:function(){return this.style.cssText},erase:function(){this.style.cssText=""}};Element.Properties.tag={get:function(){return this.tagName.toLowerCase()}};Element.Properties.html={set:function(n){null==n?n="":"array"==typeOf(n)&&(n=n.join(""));this.styleSheet&&!ot?this.styleSheet.cssText=n:this.innerHTML=n},erase:function(){this.set("html","")}};var c,f=!0,ht=!0,ct=!0,nt=document.createElement("div");if(nt.innerHTML="<nav><\/nav>",f=1==nt.childNodes.length,!f)for(tt="abbr article aside audio canvas datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video".split(" "),c=document.createDocumentFragment(),l=tt.length;l--;)c.createElement(tt[l]);nt=null;ht=Function.attempt(function(){var n=document.createElement("table");return n.innerHTML="<tr><td><\/td><\/tr>",!0});a=document.createElement("tr");it="<td><\/td>";a.innerHTML=it;ct=a.innerHTML==it;a=null;ht&&ct&&f||(Element.Properties.html.set=function(n){var t={table:[1,"<table>","<\/table>"],select:[1,"<select>","<\/select>"],tbody:[2,"<table><tbody>","<\/tbody><\/table>"],tr:[3,"<table><tbody><tr>","<\/tr><\/tbody><\/table>"]};return t.thead=t.tfoot=t.tbody,function(i){var r;if(this.styleSheet||(r=t[this.get("tag")],r||f||(r=[0,"",""]),!r))return n.call(this,i);var o=r[0],u=document.createElement("div"),e=u;for(f||c.appendChild(u),u.innerHTML=[r[1],i,r[2]].flatten().join("");o--;)e=e.firstChild;this.empty().adopt(e.childNodes);f||c.removeChild(u);u=null}}(Element.Properties.html.set));v=document.createElement("form");v.innerHTML="<select><option>s<\/option><\/select>";"s"!=v.firstChild.value&&(Element.Properties.value={set:function(n){var f=this.get("tag"),r,t;if("select"!=f)return this.setProperty("value",n);for(r=this.getElements("option"),n=String(n),t=0;t<r.length;t++){var i=r[t],u=i.getAttributeNode("value"),e=u&&u.specified?i.value:i.get("text");if(e===n)return i.selected=!0}},get:function(){var n=this,t=n.get("tag"),i;return"select"!=t&&"option"!=t?this.getProperty("value"):"select"==t&&!(n=n.getSelected()[0])?"":(i=n.getAttributeNode("value"),i&&i.specified?n.value:n.get("text"))}});v=null;document.createElement("div").getAttributeNode("id")&&(Element.Properties.id={set:function(n){this.id=this.getAttributeNode("id").value=n},get:function(){return this.id||null},erase:function(){this.id=this.getAttributeNode("id").value=""}})}(),function(){var t={},i=function(n){var i,t;return n.wheelDelta?i=n.wheelDelta%120==0?n.wheelDelta/120:n.wheelDelta/12:(t=n.deltaY||n.detail||0,i=-(t%3==0?t/3:10*t)),i},n=this.DOMEvent=new Type("DOMEvent",function(n,r){var u,o,f,e,l,s,c,h;if(r||(r=window),n=n||r.event,n.$extended)return n;for(this.event=n,this.$extended=!0,this.shift=n.shiftKey,this.control=n.ctrlKey,this.alt=n.altKey,this.meta=n.metaKey,u=this.type=n.type,o=n.target||n.srcElement;o&&3==o.nodeType;)o=o.parentNode;if(this.target=document.id(o),0==u.indexOf("key"))f=this.code=n.which||n.keyCode,this.shift&&"keypress"==u||(this.key=t[f]),("keydown"==u||"keyup"==u)&&(f>111&&124>f?this.key="f"+(f-111):f>95&&106>f&&(this.key=f-96)),null==this.key&&(this.key=String.fromCharCode(f).toLowerCase());else if("click"==u||"dblclick"==u||"contextmenu"==u||"wheel"==u||"DOMMouseScroll"==u||0==u.indexOf("mouse")){if(e=r.document,e=e.compatMode&&"CSS1Compat"!=e.compatMode?e.body:e.html,this.page={x:null!=n.pageX?n.pageX:n.clientX+e.scrollLeft,y:null!=n.pageY?n.pageY:n.clientY+e.scrollTop},this.client={x:null!=n.pageX?n.pageX-r.pageXOffset:n.clientX,y:null!=n.pageY?n.pageY-r.pageYOffset:n.clientY},("DOMMouseScroll"==u||"wheel"==u||"mousewheel"==u)&&(this.wheel=i(n)),this.rightClick=3==n.which||2==n.button,"mouseover"==u||"mouseout"==u||"mouseenter"==u||"mouseleave"==u){for(l="mouseover"==u||"mouseenter"==u,s=n.relatedTarget||n[(l?"from":"to")+"Element"];s&&3==s.nodeType;)s=s.parentNode;this.relatedTarget=document.id(s)}}else(0==u.indexOf("touch")||0==u.indexOf("gesture"))&&(this.rotation=n.rotation,this.scale=n.scale,this.targetTouches=n.targetTouches,this.changedTouches=n.changedTouches,c=this.touches=n.touches,c&&c[0]&&(h=c[0],this.page={x:h.pageX,y:h.pageY},this.client={x:h.clientX,y:h.clientY}));this.client||(this.client={});this.page||(this.page={})});n.implement({stop:function(){return this.preventDefault().stopPropagation()},stopPropagation:function(){return this.event.stopPropagation?this.event.stopPropagation():this.event.cancelBubble=!0,this},preventDefault:function(){return this.event.preventDefault?this.event.preventDefault():this.event.returnValue=!1,this}});n.defineKey=function(n,i){return t[n]=i,this};n.defineKeys=n.defineKey.overloadSetter(!0);n.defineKeys({38:"up",40:"down",37:"left",39:"right",27:"esc",32:"space",8:"backspace",9:"tab",46:"delete",13:"enter"})}(),function(){Element.Properties.events={set:function(n){this.addEvents(n)}};[Element,Window,Document].invoke("implement",{addEvent:function(n,t){var r=this.retrieve("events",{}),u,o;if(r[n]||(r[n]={keys:[],values:[]}),r[n].keys.contains(t))return this;r[n].keys.push(t);var f=n,i=Element.Events[n],s=t,e=this;return i&&(i.onAdd&&i.onAdd.call(this,t,n),i.condition&&(s=function(r){return i.condition.call(this,r,n)?t.call(this,r):!0}),i.base&&(f=Function.convert(i.base).call(this,n))),u=function(){return t.call(e)},o=Element.NativeEvents[f],o&&(2==o&&(u=function(n){n=new DOMEvent(n,e.getWindow());s.call(e,n)===!1&&n.stop()}),this.addListener(f,u,arguments[2])),r[n].values.push(u),this},removeEvent:function(n,t){var f=this.retrieve("events"),r,u,e,i;return!f||!f[n]?this:(r=f[n],u=r.keys.indexOf(t),-1==u)?this:(e=r.values[u],delete r.keys[u],delete r.values[u],i=Element.Events[n],i&&(i.onRemove&&i.onRemove.call(this,t,n),i.base&&(n=Function.convert(i.base).call(this,n))),Element.NativeEvents[n]?this.removeListener(n,e,arguments[2]):this)},addEvents:function(n){for(var t in n)this.addEvent(t,n[t]);return this},removeEvents:function(n){var i,t;if("object"==typeOf(n)){for(i in n)this.removeEvent(i,n[i]);return this}if(t=this.retrieve("events"),!t)return this;if(n)t[n]&&(t[n].keys.each(function(t){this.removeEvent(n,t)},this),delete t[n]);else{for(i in t)this.removeEvents(i);this.eliminate("events")}return this},fireEvent:function(n,t,i){var r=this.retrieve("events");return r&&r[n]?(t=Array.convert(t),r[n].keys.each(function(n){i?n.delay(i,this,t):n.apply(this,t)},this),this):this},cloneEvents:function(n,t){var i,r;if(n=document.id(n),i=n.retrieve("events"),!i)return this;if(t)i[t]&&i[t].keys.each(function(n){this.addEvent(t,n)},this);else for(r in i)this.cloneEvents(n,r);return this}});Element.NativeEvents={click:2,dblclick:2,mouseup:2,mousedown:2,contextmenu:2,wheel:2,mousewheel:2,DOMMouseScroll:2,mouseover:2,mouseout:2,mousemove:2,selectstart:2,selectend:2,keydown:2,keypress:2,keyup:2,orientationchange:2,touchstart:2,touchmove:2,touchend:2,touchcancel:2,gesturestart:2,gesturechange:2,gestureend:2,focus:2,blur:2,change:2,reset:2,select:2,submit:2,paste:2,input:2,load:2,unload:1,beforeunload:2,resize:1,move:1,DOMContentLoaded:1,readystatechange:1,hashchange:1,popstate:2,pageshow:2,pagehide:2,error:1,abort:1,scroll:1,message:2};Element.Events={mousewheel:{base:"onwheel"in document?"wheel":"onmousewheel"in document?"mousewheel":"DOMMouseScroll"}};var n=function(n){var t=n.relatedTarget;return null==t?!0:t?t!=this&&"xul"!=t.prefix&&"document"!=typeOf(this)&&!this.contains(t):!1};"onmouseenter"in document.documentElement?(Element.NativeEvents.mouseenter=Element.NativeEvents.mouseleave=2,Element.MouseenterCheck=n):(Element.Events.mouseenter={base:"mouseover",condition:n},Element.Events.mouseleave={base:"mouseout",condition:n});window.addEventListener||(Element.NativeEvents.propertychange=2,Element.Events.change={base:function(){var n=this.type;return"input"!=this.get("tag")||"radio"!=n&&"checkbox"!=n?"change":"propertychange"},condition:function(n){return"propertychange"!=n.type||"checked"==n.event.propertyName}})}(),function(){var t=!!window.addEventListener;Element.NativeEvents.focusin=Element.NativeEvents.focusout=2;var i=function(n,t,i,r,u){for(;u&&u!=n;){if(t(u,r))return i.call(u,r,u);u=document.id(u.parentNode)}},r={mouseenter:{base:"mouseover",condition:Element.MouseenterCheck},mouseleave:{base:"mouseout",condition:Element.MouseenterCheck},focus:{base:"focus"+(t?"":"in"),capture:!0},blur:{base:t?"blur":"focusout",capture:!0}},u="$delegation:",f=function(n){return{base:"focusin",remove:function(t,i){var r=t.retrieve(u+n+"listeners",{})[i],f;if(r&&r.forms)for(f=r.forms.length;f--;)r.forms[f].removeEvent&&r.forms[f].removeEvent(n,r.fns[f])},listen:function(t,r,f,e,o,s){var h="form"==o.get("tag")?o:e.target.getParent("form"),a;if(h){var c=t.retrieve(u+n+"listeners",{}),l=c[s]||{forms:[],fns:[]},v=l.forms,y=l.fns;-1==v.indexOf(h)&&(v.push(h),a=function(n){i(t,r,f,n,o)},h.addEvent(n,a),y.push(a),c[s]=l,t.store(u+n+"listeners",c))}}}},e=function(n){return{base:"focusin",listen:function(t,r,u,f,e){var o={blur:function(){this.removeEvents(o)}};o[n]=function(n){i(t,r,u,n,e)};f.target.addEvents(o)}}};t||Object.append(r,{submit:f("submit"),reset:f("reset"),change:e("change"),select:e("select")});var o=Element.prototype,s=o.addEvent,h=o.removeEvent,c=function(n,t){return function(i,r,u){var f,e;return-1==i.indexOf(":relay")?n.call(this,i,r,u):(f=Slick.parse(i).expressions[0][0],"relay"!=f.pseudos[0].key)?n.call(this,i,r,u):(e=f.tag,f.pseudos.slice(1).each(function(n){e+=":"+n.key+(n.value?"("+n.value+")":"")}),n.call(this,i,r),t.call(this,e,f.pseudos[0].value,r))}},n={addEvent:function(n,t,u){var l=this.retrieve("$delegates",{}),f=l[n],h,o,v,y;if(f)for(h in f)if(f[h].fn==u&&f[h].match==t)return this;var c=n,a=t,k=u,e=r[n]||{};n=e.base||c;t=function(n){return Slick.match(n,a)};o=Element.Events[c];(e.condition||o&&o.condition)&&(v=t,y=e.condition||o.condition,t=function(t,i){return v(t,i)&&y.call(t,i,n)});var p=this,w=String.uniqueID(),b=e.listen?function(n,i){!i&&n&&n.target&&(i=n.target);i&&e.listen(p,t,u,n,i,w)}:function(n,r){!r&&n&&n.target&&(r=n.target);r&&i(p,t,u,n,r)};return f||(f={}),f[w]={match:a,fn:k,delegator:b},l[c]=f,s.call(this,n,b,e.capture)},removeEvent:function(t,i,u,f){var l=this.retrieve("$delegates",{}),e=l[t],o,s;if(!e)return this;if(f){var a=t,v=e[f].delegator,c=r[t]||{};return t=c.base||a,c.remove&&c.remove(this,f),delete e[f],l[a]=e,h.call(this,t,v,c.capture)}if(u){for(o in e)if(s=e[o],s.match==i&&s.fn==u)return n.removeEvent.call(this,t,i,u,o)}else for(o in e)s=e[o],s.match==i&&n.removeEvent.call(this,t,i,s.fn,o);return this}};[Element,Window,Document].invoke("implement",{addEvent:c(s,n.addEvent),removeEvent:c(h,n.removeEvent)})}(),function(){var n,t=document.html,s,r,h,u,c;n=document.createElement("div");n.style.color="red";n.style.color=null;s="red"==n.style.color;r="1px solid #123abc";n.style.border=r;h=n.style.border!=r;n=null;u=!!window.getComputedStyle;c=null!=document.createElement("div").style.borderRadius;Element.Properties.styles={set:function(n){this.setStyles(n)}};var l=null!=t.style.opacity,a=null!=t.style.filter,i=/alpha\(opacity=([\d.]+)\)/i,p=function(n,t){n.store("$opacity",t);n.style.visibility=t>0||null==t?"visible":"hidden"},f=function(n,t,i){var r=n.style,u=r.filter||n.getComputedStyle("filter")||"";r.filter=(t.test(u)?u.replace(t,i):u+" "+i).trim();r.filter||r.removeAttribute("filter")},w=l?function(n,t){n.style.opacity=t}:a?function(n,t){n.currentStyle&&n.currentStyle.hasLayout||(n.style.zoom=1);null==t||1==t?(f(n,i,""),1==t&&1!=v(n)&&f(n,i,"alpha(opacity=100)")):f(n,i,"alpha(opacity="+(100*t).limit(0,100).round()+")")}:p,v=l?function(n){var t=n.style.opacity||n.getComputedStyle("opacity");return""==t?1:t.toFloat()}:a?function(n){var t,r=n.style.filter||n.getComputedStyle("filter");return r&&(t=r.match(i)),null==t||null==r?1:t[1]/100}:function(n){var t=n.retrieve("$opacity");return null==t&&(t="hidden"==n.style.visibility?0:1),t},e=null==t.style.cssFloat?"styleFloat":"cssFloat",b={left:"0%",top:"0%",center:"50%",right:"100%",bottom:"100%"},y=null!=t.style.backgroundPositionX,k=/^-(ms)-/,o=function(n){return n.replace(k,"$1-").camelCase()},d=function(n,t){"backgroundPosition"==t&&(n.removeAttribute(t+"X"),t+="Y");n.removeAttribute(t)};Element.implement({getComputedStyle:function(n){if(!u&&this.currentStyle)return this.currentStyle[o(n)];var t=Element.getDocument(this).defaultView,i=t?t.getComputedStyle(this,null):null;return i?i.getPropertyValue(n==e?"float":n.hyphenate()):""},setStyle:function(n,t){if("opacity"==n)return null!=t&&(t=parseFloat(t)),w(this,t),this;if(n=o("float"==n?e:n),"string"!=typeOf(t)){var i=(Element.Styles[n]||"@").split(" ");t=Array.convert(t).map(function(n,t){return i[t]?"number"==typeOf(n)?i[t].replace("@",Math.round(n)):n:""}).join(" ")}else t==String(Number(t))&&(t=Math.round(t));return this.style[n]=t,(""==t||null==t)&&s&&this.style.removeAttribute&&d(this.style,n),this},getStyle:function(n){var t,f,i,s,r;if("opacity"==n)return v(this);if(n=o("float"==n?e:n),c&&-1!=n.indexOf("borderRadius"))return["borderTopLeftRadius","borderTopRightRadius","borderBottomRightRadius","borderBottomLeftRadius"].map(function(n){return this.style[n]||"0px"},this).join(" ");if(t=this.style[n],!t||"zIndex"==n){if(Element.ShortStyles.hasOwnProperty(n)){t=[];for(f in Element.ShortStyles[n])t.push(this.getStyle(f));return t.join(" ")}t=this.getComputedStyle(n)}if(y&&/^backgroundPosition[XY]?$/.test(n))return t.replace(/(top|right|bottom|left)/g,function(n){return b[n]})||"0px";if(!t&&"backgroundPosition"==n)return"0px 0px";if(t&&(t=String(t),i=t.match(/rgba?\([\d\s,]+\)/),i&&(t=t.replace(i[0],i[0].rgbToHex()))),!u&&!this.style[n]){if(/^(height|width)$/.test(n)&&!/px$/.test(t))return s="width"==n?["left","right"]:["top","bottom"],r=0,s.each(function(n){r+=this.getStyle("border-"+n+"-width").toInt()+this.getStyle("padding-"+n).toInt()},this),this["offset"+n.capitalize()]-r+"px";if(/^border(.+)Width|margin|padding/.test(n)&&isNaN(parseFloat(t)))return"0px"}return h&&/^border(Top|Right|Bottom|Left)?$/.test(n)&&/^#/.test(t)?t.replace(/^(.+)\s(.+)\s(.+)$/,"$2 $3 $1"):t},setStyles:function(n){for(var t in n)this.setStyle(t,n[t]);return this},getStyles:function(){var n={};return Array.flatten(arguments).each(function(t){n[t]=this.getStyle(t)},this),n}});Element.Styles={left:"@px",top:"@px",bottom:"@px",right:"@px",width:"@px",height:"@px",maxWidth:"@px",maxHeight:"@px",minWidth:"@px",minHeight:"@px",backgroundColor:"rgb(@, @, @)",backgroundSize:"@px",backgroundPosition:"@px @px",color:"rgb(@, @, @)",fontSize:"@px",letterSpacing:"@px",lineHeight:"@px",clip:"rect(@px @px @px @px)",margin:"@px @px @px @px",padding:"@px @px @px @px",border:"@px @ rgb(@, @, @) @px @ rgb(@, @, @) @px @ rgb(@, @, @)",borderWidth:"@px @px @px @px",borderStyle:"@ @ @ @",borderColor:"rgb(@, @, @) rgb(@, @, @) rgb(@, @, @) rgb(@, @, @)",zIndex:"@",zoom:"@",fontWeight:"@",textIndent:"@px",opacity:"@",borderRadius:"@px @px @px @px"};Element.ShortStyles={margin:{},padding:{},border:{},borderWidth:{},borderStyle:{},borderColor:{}};["Top","Right","Bottom","Left"].each(function(n){var i=Element.ShortStyles,r=Element.Styles,t;["margin","padding"].each(function(t){var u=t+n;i[t][u]=r[u]="@px"});t="border"+n;i.border[t]=r[t]="@px @ rgb(@, @, @)";var u=t+"Width",f=t+"Style",e=t+"Color";i[t]={};i.borderWidth[u]=i[t][u]=r[u]="@px";i.borderStyle[f]=i[t][f]=r[f]="@";i.borderColor[e]=i[t][e]=r[e]="rgb(@, @, @)"});y&&(Element.ShortStyles.backgroundPosition={backgroundPositionX:"@",backgroundPositionY:"@"})}(),function(){function i(n,i){return t(n,i).toInt()||0}function s(n){return i(n,"border-top-width")}function h(n){return i(n,"border-left-width")}function n(n){return/^(?:body|html)$/i.test(n.tagName)}function u(n){var t=n.getDocument();return t.compatMode&&"CSS1Compat"!=t.compatMode?t.body:t.html}var r=document.createElement("div"),f=document.createElement("div"),e,t;r.style.height="0";r.appendChild(f);e=f.offsetParent===r;r=f=null;var c=["height","paddingTop","paddingBottom","borderTopWidth","borderBottomWidth"],l=["width","paddingLeft","paddingRight","borderLeftWidth","borderRightWidth"],a=function(n){var i=window.getComputedStyle(n),t={x:0,y:0};return c.each(function(n){t.y+=parseFloat(i[n])}),l.each(function(n){t.x+=parseFloat(i[n])}),t},o=function(i){return"static"!=t(i,"position")||n(i)},v=function(n){return o(n)||/^(?:table|td|th)$/i.test(n.tagName)};Element.implement({scrollTo:function(t,i){return n(this)?this.getWindow().scrollTo(t,i):(this.scrollLeft=t,this.scrollTop=i),this},getSize:function(){if(n(this))return this.getWindow().getSize();if(!window.getComputedStyle)return{x:this.offsetWidth,y:this.offsetHeight};if("svg"==this.get("tag"))return a(this);try{var t=this.getBoundingClientRect();return{x:t.width,y:t.height}}catch(i){return{x:0,y:0}}},getScrollSize:function(){return n(this)?this.getWindow().getScrollSize():{x:this.scrollWidth,y:this.scrollHeight}},getScroll:function(){return n(this)?this.getWindow().getScroll():{x:this.scrollLeft,y:this.scrollTop}},getScrolls:function(){for(var t=this.parentNode,i={x:0,y:0};t&&!n(t);)i.x+=t.scrollLeft,i.y+=t.scrollTop,t=t.parentNode;return i},getOffsetParent:e?function(){var i=this,r;if(n(i)||"fixed"==t(i,"position"))return null;for(r="static"==t(i,"position")?v:o;i=i.parentNode;)if(r(i))return i;return null}:function(){var i=this;if(n(i)||"fixed"==t(i,"position"))return null;try{return i.offsetParent}catch(r){}return null},getOffsets:function(){var h=this.getBoundingClientRect,i,r;if(h){var f=this.getBoundingClientRect(),u=document.id(this.getDocument().documentElement),e=u.getScroll(),o=this.getScrolls(),s="fixed"==t(this,"position");return{x:f.left.toFloat()+o.x+(s?0:e.x)-u.clientLeft,y:f.top.toFloat()+o.y+(s?0:e.y)-u.clientTop}}if(i=this,r={x:0,y:0},n(this))return r;for(;i&&!n(i);)r.x+=i.offsetLeft,r.y+=i.offsetTop,i=i.offsetParent;return r},getPosition:function(n){var r=this.getOffsets(),u=this.getScrolls(),t={x:r.x-u.x,y:r.y-u.y},i;return n&&(n=document.id(n))?(i=n.getPosition(),{x:t.x-i.x-h(n),y:t.y-i.y-s(n)}):t},getCoordinates:function(t){if(n(this))return this.getWindow().getCoordinates();var r=this.getPosition(t),u=this.getSize(),i={left:r.x,top:r.y,width:u.x,height:u.y};return i.right=i.left+i.width,i.bottom=i.top+i.height,i},computePosition:function(n){return{left:n.x-i(this,"margin-left"),top:n.y-i(this,"margin-top")}},setPosition:function(n){return this.setStyles(this.computePosition(n))}});[Document,Window].invoke("implement",{getSize:function(){var n=u(this);return{x:n.clientWidth,y:n.clientHeight}},getScroll:function(){var n=this.getWindow(),t=u(this);return{x:n.pageXOffset||t.scrollLeft,y:n.pageYOffset||t.scrollTop}},getScrollSize:function(){var n=u(this),t=this.getSize(),i=this.getDocument().body;return{x:Math.max(n.scrollWidth,i.scrollWidth,t.x),y:Math.max(n.scrollHeight,i.scrollHeight,t.y)}},getPosition:function(){return{x:0,y:0}},getCoordinates:function(){var n=this.getSize();return{top:0,left:0,bottom:n.y,right:n.x,height:n.y,width:n.x}}});t=Element.getComputedStyle}(),Element.alias({position:"setPosition"}),[Window,Document,Element].invoke("implement",{getHeight:function(){return this.getSize().y},getWidth:function(){return this.getSize().x},getScrollTop:function(){return this.getScroll().y},getScrollLeft:function(){return this.getScroll().x},getScrollHeight:function(){return this.getScrollSize().y},getScrollWidth:function(){return this.getScrollSize().x},getTop:function(){return this.getPosition().y},getLeft:function(){return this.getPosition().x}}),function(){var i=this.Fx=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{fps:60,unit:!1,duration:500,frames:null,frameSkip:!0,link:"ignore"},initialize:function(n){this.subject=this.subject||this;this.setOptions(n)},getTransition:function(){return function(n){return-(Math.cos(Math.PI*n)-1)/2}},step:function(n){var t,i,r;this.options.frameSkip?(t=null!=this.time?n-this.time:0,i=t/this.frameInterval,this.time=n,this.frame+=i):this.frame++;this.frame<this.frames?(r=this.transition(this.frame/this.frames),this.set(this.compute(this.from,this.to,r))):(this.frame=this.frames,this.set(this.compute(this.from,this.to,1)),this.stop())},set:function(n){return n},compute:function(n,t,r){return i.compute(n,t,r)},check:function(){if(!this.isRunning())return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},start:function(n,t){if(!this.check(n,t))return this;this.from=n;this.to=t;this.frame=this.options.frameSkip?0:-1;this.time=null;this.transition=this.getTransition();var e=this.options.frames,r=this.options.fps,f=this.options.duration;return this.duration=i.Durations[f]||f.toInt(),this.frameInterval=1e3/r,this.frames=e||Math.round(this.duration/this.frameInterval),"pending"!==this.getThenableState()&&this.resetThenable(this.subject),this.fireEvent("start",this.subject),u.call(this,r),this},stop:function(){return this.isRunning()&&(this.time=null,r.call(this,this.options.fps),this.frames==this.frame?(this.fireEvent("complete",this.subject),this.callChain()||this.fireEvent("chainComplete",this.subject)):this.fireEvent("stop",this.subject),this.resolve(this.subject===this?null:this.subject)),this},cancel:function(){return this.isRunning()&&(this.time=null,r.call(this,this.options.fps),this.frame=this.frames,this.fireEvent("cancel",this.subject).clearChain(),this.reject(this.subject)),this},pause:function(){return this.isRunning()&&(this.time=null,r.call(this,this.options.fps)),this},resume:function(){return this.isPaused()&&u.call(this,this.options.fps),this},isRunning:function(){var t=n[this.options.fps];return t&&t.contains(this)},isPaused:function(){return this.frame<this.frames&&!this.isRunning()}});i.compute=function(n,t,i){return(t-n)*i+n};i.Durations={short:250,normal:500,long:1e3};var n={},t={},f=function(){for(var t,i=Date.now(),n=this.length;n--;)t=this[n],t&&t.step(i)},u=function(i){var r=n[i]||(n[i]=[]);r.push(this);t[i]||(t[i]=f.periodical(Math.round(1e3/i),r))},r=function(i){var r=n[i];r&&(r.erase(this),!r.length&&t[i]&&(delete n[i],t[i]=clearInterval(t[i])))}}(),Fx.CSS=new Class({Extends:Fx,prepare:function(n,t,i){var r,u,f,e,o;return i=Array.convert(i),r=i[0],u=i[1],null==u&&(u=r,r=n.getStyle(t),f=this.options.unit,f&&r&&"string"==typeof r&&r.slice(-f.length)!=f&&0!=parseFloat(r)&&(n.setStyle(t,u+f),e=n.getComputedStyle(t),/px$/.test(e)||(e=n.style[("pixel-"+t).camelCase()],null!=e)||(o=n.style.left,n.style.left=u+f,e=n.style.pixelLeft,n.style.left=o),r=(u||1)/(parseFloat(e)||1)*(parseFloat(r)||0),n.setStyle(t,r+f))),{from:this.parse(r),to:this.parse(u)}},parse:function(n){return n=Function.convert(n)(),n="string"==typeof n?n.split(" "):Array.convert(n),n.map(function(n){n=String(n);var t=!1;return Object.each(Fx.CSS.Parsers,function(i){if(!t){var r=i.parse(n);(r||0===r)&&(t={value:r,parser:i})}}),t=t||{value:n,parser:Fx.CSS.Parsers.String}})},compute:function(n,t,i){var r=[];return Math.min(n.length,t.length).times(function(u){r.push({value:n[u].parser.compute(n[u].value,t[u].value,i),parser:n[u].parser})}),r.$family=Function.convert("fx:css:value"),r},serve:function(n,t){"fx:css:value"!=typeOf(n)&&(n=this.parse(n));var i=[];return n.each(function(n){i=i.concat(n.parser.serve(n.value,t))}),i},render:function(n,t,i,r){n.setStyle(t,this.serve(i,r))},search:function(n){if(Fx.CSS.Cache[n])return Fx.CSS.Cache[n];var t={},r=new RegExp("^"+n.escapeRegExp()+"$"),i=function(n){Array.each(n,function(n){if(n.media)return void i(n.rules||n.cssRules);if(n.style){var u=n.selectorText?n.selectorText.replace(/^\w+/,function(n){return n.toLowerCase()}):null;u&&r.test(u)&&Object.each(Element.Styles,function(i,r){n.style[r]&&!Element.ShortStyles[r]&&(i=String(n.style[r]),t[r]=/^rgb/.test(i)?i.rgbToHex():i)})}})};return Array.each(document.styleSheets,function(n){var t=n.href,r;t&&t.indexOf("://")>-1&&-1==t.indexOf(document.domain)||(r=n.rules||n.cssRules,i(r))}),Fx.CSS.Cache[n]=t}}),Fx.CSS.Cache={},Fx.CSS.Parsers={Color:{parse:function(n){return n.match(/^#[0-9a-f]{3,6}$/i)?n.hexToRgb(!0):(n=n.match(/(\d+),\s*(\d+),\s*(\d+)/))?[n[1],n[2],n[3]]:!1},compute:function(n,t,i){return n.map(function(r,u){return Math.round(Fx.compute(n[u],t[u],i))})},serve:function(n){return n.map(Number)}},Number:{parse:parseFloat,compute:Fx.compute,serve:function(n,t){return t?n+t:n}},String:{parse:Function.convert(!1),compute:function(n,t){return t},serve:function(n){return n}}},Fx.Morph=new Class({Extends:Fx.CSS,initialize:function(n,t){this.element=this.subject=document.id(n);this.parent(t)},set:function(n){"string"==typeof n&&(n=this.search(n));for(var t in n)this.render(this.element,t,n[t],this.options.unit);return this},compute:function(n,t,i){var u={},r;for(r in n)u[r]=this.parent(n[r],t[r],i);return u},start:function(n){var i,r,t,u;if(!this.check(n))return this;"string"==typeof n&&(n=this.search(n));i={};r={};for(t in n)u=this.prepare(this.element,t,n[t]),i[t]=u.from,r[t]=u.to;return this.parent(i,r)}}),Element.Properties.morph={set:function(n){return this.get("morph").cancel().setOptions(n),this},get:function(){var n=this.retrieve("morph");return n||(n=new Fx.Morph(this,{link:"cancel"}),this.store("morph",n)),n}},Element.implement({morph:function(n){return this.get("morph").start(n),this}}),Fx.implement({getTransition:function(){var n=this.options.transition||Fx.Transitions.Sine.easeInOut,t;return"string"==typeof n&&(t=n.split(":"),n=Fx.Transitions,n=n[t[0]]||n[t[0].capitalize()],t[1]&&(n=n["ease"+t[1].capitalize()+(t[2]?t[2].capitalize():"")])),n}}),Fx.Transition=function(n,t){t=Array.convert(t);var i=function(i){return n(i,t)};return Object.append(i,{easeIn:i,easeOut:function(i){return 1-n(1-i,t)},easeInOut:function(i){return(.5>=i?n(2*i,t):2-n(2*(1-i),t))/2}})},Fx.Transitions={linear:function(n){return n}},Fx.Transitions.extend=function(n){for(var t in n)Fx.Transitions[t]=new Fx.Transition(n[t])},Fx.Transitions.extend({Pow:function(n,t){return Math.pow(n,t&&t[0]||6)},Expo:function(n){return Math.pow(2,8*(n-1))},Circ:function(n){return 1-Math.sin(Math.acos(n))},Sine:function(n){return 1-Math.cos(n*Math.PI/2)},Back:function(n,t){return t=t&&t[0]||1.618,Math.pow(n,2)*((t+1)*n-t)},Bounce:function(n){for(var r,i=0,t=1;;i+=t,t/=2)if(n>=(7-4*i)/11){r=t*t-Math.pow((11-6*i-11*n)/4,2);break}return r},Elastic:function(n,t){return Math.pow(2,10*--n)*Math.cos(20*n*Math.PI*(t&&t[0]||1)/3)}}),["Quad","Cubic","Quart","Quint"].each(function(n,t){Fx.Transitions[n]=new Fx.Transition(function(n){return Math.pow(n,t+2)})}),Fx.Tween=new Class({Extends:Fx.CSS,initialize:function(n,t){this.element=this.subject=document.id(n);this.parent(t)},set:function(n,t){return 1==arguments.length&&(t=n,n=this.property||this.options.property),this.render(this.element,n,t,this.options.unit),this},start:function(n,t,i){var r,u;return this.check(n,t,i)?(r=Array.flatten(arguments),this.property=this.options.property||r.shift(),u=this.prepare(this.element,this.property,r),this.parent(u.from,u.to)):this}}),Element.Properties.tween={set:function(n){return this.get("tween").cancel().setOptions(n),this},get:function(){var n=this.retrieve("tween");return n||(n=new Fx.Tween(this,{link:"cancel"}),this.store("tween",n)),n}},Element.implement({tween:function(n,t,i){return this.get("tween").start(n,t,i),this},fade:function(){var t,f,i=this.get("tween"),n=["opacity"].append(arguments),r,u;switch(null==n[1]&&(n[1]="toggle"),n[1]){case"in":t="start";n[1]=1;break;case"out":t="start";n[1]=0;break;case"show":t="set";n[1]=1;break;case"hide":t="set";n[1]=0;break;case"toggle":r=this.retrieve("fade:flag",1==this.getStyle("opacity"));t="start";n[1]=r?0:1;this.store("fade:flag",!r);f=!0;break;default:t="start"}return f||this.eliminate("fade:flag"),i[t].apply(i,n),u=n[n.length-1],"set"==t?this.setStyle("visibility",0==u?"hidden":"visible"):0!=u?i.$chain.length?i.chain(function(){this.element.setStyle("visibility","visible");this.callChain()}):this.setStyle("visibility","visible"):i.chain(function(){this.element.getStyle("opacity")||(this.element.setStyle("visibility","hidden"),this.callChain())}),this},highlight:function(n,t){t||(t=this.retrieve("highlight:original",this.getStyle("background-color")),t="transparent"==t?"#fff":t);var i=this.get("tween");return i.start("background-color",n||"#ffff88",t).chain(function(){this.setStyle("background-color",this.retrieve("highlight:original"));i.callChain()}.bind(this)),this}}),function(){var n=function(){},t="onprogress"in new Browser.Request,i=this.Request=new Class({Implements:[Chain,Events,Options,Class.Thenable],options:{url:"",data:"",headers:{"X-Requested-With":"XMLHttpRequest",Accept:"text/javascript, text/html, application/xml, text/xml, */*"},async:!0,format:!1,method:"post",link:"ignore",isSuccess:null,emulation:!0,urlEncoded:!0,encoding:"utf-8",evalScripts:!1,evalResponse:!1,timeout:0,noCache:!1},initialize:function(n){this.xhr=new Browser.Request;this.setOptions(n);this.headers=this.options.headers},onStateChange:function(){var i=this.xhr;4==i.readyState&&this.running&&(this.running=!1,this.status=0,Function.attempt(function(){var n=i.status;this.status=1223==n?204:n}.bind(this)),i.onreadystatechange=n,t&&(i.onprogress=i.onloadstart=n),this.timer&&(clearTimeout(this.timer),delete this.timer),this.response={text:this.xhr.responseText||"",xml:this.xhr.responseXML},this.options.isSuccess.call(this,this.status)?this.success(this.response.text,this.response.xml):this.failure())},isSuccess:function(){var n=this.status;return n>=200&&300>n},isRunning:function(){return!!this.running},processScripts:function(n){return this.options.evalResponse||/(ecma|java)script/.test(this.getHeader("Content-type"))?Browser.exec(n):n.stripScripts(this.options.evalScripts)},success:function(n,t){this.onSuccess(this.processScripts(n),t);this.resolve({text:n,xml:t})},onSuccess:function(){this.fireEvent("complete",arguments).fireEvent("success",arguments).callChain()},failure:function(){this.onFailure();this.reject({reason:"failure",xhr:this.xhr})},onFailure:function(){this.fireEvent("complete").fireEvent("failure",this.xhr)},loadstart:function(n){this.fireEvent("loadstart",[n,this.xhr])},progress:function(n){this.fireEvent("progress",[n,this.xhr])},timeout:function(){this.fireEvent("timeout",this.xhr);this.reject({reason:"timeout",xhr:this.xhr})},setHeader:function(n,t){return this.headers[n]=t,this},getHeader:function(n){return Function.attempt(function(){return this.xhr.getResponseHeader(n)}.bind(this))},check:function(){if(!this.running)return!0;switch(this.options.link){case"cancel":return this.cancel(),!0;case"chain":return this.chain(this.caller.pass(arguments,this)),!1}return!1},send:function(n){var s,e,h,c,l,o,u;if(!this.check(n))return this;this.options.isSuccess=this.options.isSuccess||this.isSuccess;this.running=!0;s=typeOf(n);("string"==s||"element"==s)&&(n={data:n});e=this.options;n=Object.append({data:e.data,url:e.url,method:e.method},n);var i=n.data,r=String(n.url),f=n.method.toLowerCase();switch(typeOf(i)){case"element":i=document.id(i).toQueryString();break;case"object":case"hash":i=Object.toQueryString(i)}return this.options.format&&(h="format="+this.options.format,i=i?h+"&"+i:h),this.options.emulation&&!["get","post"].contains(f)&&(c="_method="+f,i=i?c+"&"+i:c,f="post"),this.options.urlEncoded&&["post","put"].contains(f)&&(l=this.options.encoding?"; charset="+this.options.encoding:"",this.headers["Content-type"]="application/x-www-form-urlencoded"+l),r||(r=document.location.pathname),o=r.lastIndexOf("/"),o>-1&&(o=r.indexOf("#"))>-1&&(r=r.substr(0,o)),this.options.noCache&&(r+=(r.indexOf("?")>-1?"&":"?")+String.uniqueID()),!i||"get"!=f&&"delete"!=f||(r+=(r.indexOf("?")>-1?"&":"?")+i,i=null),u=this.xhr,t&&(u.onloadstart=this.loadstart.bind(this),u.onprogress=this.progress.bind(this)),u.open(f.toUpperCase(),r,this.options.async,this.options.user,this.options.password),this.options.withCredentials&&"withCredentials"in u&&(u.withCredentials=!0),u.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,function(n,t){try{u.setRequestHeader(t,n)}catch(i){this.fireEvent("exception",[t,n]);this.reject({reason:"exception",xhr:u,exception:i})}},this),"pending"!==this.getThenableState()&&this.resetThenable({reason:"send"}),this.fireEvent("request"),u.send(i),this.options.async?this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)):this.onStateChange(),this},cancel:function(){if(!this.running)return this;this.running=!1;var i=this.xhr;return i.abort(),this.timer&&(clearTimeout(this.timer),delete this.timer),i.onreadystatechange=n,t&&(i.onprogress=i.onloadstart=n),this.xhr=new Browser.Request,this.fireEvent("cancel"),this.reject({reason:"cancel",xhr:i}),this}}),r={};["get","post","put","delete","patch","head","GET","POST","PUT","DELETE","PATCH","HEAD"].each(function(n){r[n]=function(t){var i={method:n};return null!=t&&(i.data=t),this.send(i)}});i.implement(r);Element.Properties.send={set:function(n){var t=this.get("send").cancel();return t.setOptions(n),this},get:function(){var n=this.retrieve("send");return n||(n=new i({data:this,link:"cancel",method:this.get("method")||"post",url:this.get("action")}),this.store("send",n)),n}};Element.implement({send:function(n){var t=this.get("send");return t.send({data:this,url:n||t.options.url}),this}})}(),Request.HTML=new Class({Extends:Request,options:{update:!1,append:!1,evalScripts:!0,filter:!1,headers:{Accept:"text/html, application/xml, text/xml, */*"}},success:function(n){var i=this.options,t=this.response,u,r,f,e;t.html=n.stripScripts(function(n){t.javascript=n});u=t.html.match(/<body[^>]*>([\s\S]*?)<\/body>/i);u&&(t.html=u[1]);r=new Element("div").set("html",t.html);(t.tree=r.childNodes,t.elements=r.getElements(i.filter||"*"),i.filter&&(t.tree=t.elements),i.update)?(f=document.id(i.update).empty(),i.filter?f.adopt(t.elements):f.set("html",t.html)):i.append&&(e=document.id(i.append),i.filter?t.elements.reverse().inject(e):e.adopt(r.getChildren()));i.evalScripts&&Browser.exec(t.javascript);this.onSuccess(t.tree,t.elements,t.html,t.javascript);this.resolve({tree:t.tree,elements:t.elements,html:t.html,javascript:t.javascript})}}),Element.Properties.load={set:function(n){var t=this.get("load").cancel();return t.setOptions(n),this},get:function(){var n=this.retrieve("load");return n||(n=new Request.HTML({data:this,link:"cancel",update:this,method:"get"}),this.store("load",n)),n}},Element.implement({load:function(){return this.get("load").send(Array.link(arguments,{data:Type.isObject,url:Type.isString})),this}}),"undefined"==typeof JSON&&(this.JSON={}),function(){var n={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},t=function(t){return n[t]||"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)};JSON.validate=function(n){return n=n.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(n)};JSON.encode=JSON.stringify?function(n){return JSON.stringify(n)}:function(n){switch(n&&n.toJSON&&(n=n.toJSON()),typeOf(n)){case"string":return'"'+n.replace(/[\x00-\x1f\\"]/g,t)+'"';case"array":return"["+n.map(JSON.encode).clean()+"]";case"object":case"hash":var i=[];return Object.each(n,function(n,t){var r=JSON.encode(n);r&&i.push(JSON.encode(t)+":"+r)}),"{"+i+"}";case"number":case"boolean":return""+n;case"null":return"null"}return null};JSON.secure=!0;JSON.decode=function(string,secure){if(!string||"string"!=typeOf(string))return null;if(null==secure&&(secure=JSON.secure),secure){if(JSON.parse)return JSON.parse(string);if(!JSON.validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");}return eval("("+string+")")}}(),Request.JSON=new Class({Extends:Request,options:{secure:!0},initialize:function(n){this.parent(n);Object.append(this.headers,{Accept:"application/json","X-Request":"JSON"})},success:function(n){var t;try{t=this.response.json=JSON.decode(n,this.options.secure)}catch(i){return void this.fireEvent("error",[n,i])}null==t?this.failure():(this.onSuccess(t,n),this.resolve({json:t,text:n}))}}),Cookie=new Class({Implements:Options,options:{path:"/",domain:!1,duration:!1,secure:!1,document:document,encode:!0,httpOnly:!1},initialize:function(n,t){this.key=n;this.setOptions(t)},write:function(n){if(this.options.encode&&(n=encodeURIComponent(n)),this.options.domain&&(n+="; domain="+this.options.domain),this.options.path&&(n+="; path="+this.options.path),this.options.duration){var t=new Date;t.setTime(t.getTime()+864e5*this.options.duration);n+="; expires="+t.toGMTString()}return this.options.secure&&(n+="; secure"),this.options.httpOnly&&(n+="; HttpOnly"),this.options.document.cookie=this.key+"="+n,this},read:function(){var n=this.options.document.cookie.match("(?:^|;)\\s*"+this.key.escapeRegExp()+"=([^;]*)");return n?decodeURIComponent(n[1]):null},dispose:function(){return new Cookie(this.key,Object.merge({},this.options,{duration:-1})).write(""),this}}),Cookie.write=function(n,t,i){return new Cookie(n,i).write(t)},Cookie.read=function(n){return new Cookie(n).read()},Cookie.dispose=function(n,t){return new Cookie(n,t).dispose()},function(n,t){var u,c,f,e,i=[],o=t.createElement("div"),r=function(){clearTimeout(e);u||(Browser.loaded=u=!0,t.removeListener("DOMContentLoaded",r).removeListener("readystatechange",s),t.fireEvent("domready"),n.fireEvent("domready"));t=n=o=null},s=function(){for(var n=i.length;n--;)if(i[n]())return r(),!0;return!1},l=function(){clearTimeout(e);s()||(e=setTimeout(l,10))},h;t.addListener("DOMContentLoaded",r);h=function(){try{return o.doScroll(),!0}catch(n){}return!1};o.doScroll&&!h()&&(i.push(h),f=!0);t.readyState&&i.push(function(){var n=t.readyState;return"loaded"==n||"complete"==n});"onreadystatechange"in t?t.addListener("readystatechange",s):f=!0;f&&l();Element.Events.domready={onAdd:function(n){u&&n.call(this)}};Element.Events.load={base:"load",onAdd:function(t){c&&this==n&&t.call(this)},condition:function(){return this==n&&(r(),delete Element.Events.load),!0}};n.addEvent("load",function(){c=!0})}(window,document),MooTools.More={version:"1.6.0",build:"45b71db70f879781a7e0b0d3fb3bb1307c2521eb"},function(){var n={wait:function(n){return this.chain(function(){return this.callChain.delay(null==n?500:n,this),this}.bind(this))}};Chain.implement(n);this.Fx&&Fx.implement(n);this.Element&&Element.implement&&this.Fx&&Element.implement({chains:function(n){return Array.convert(n||["tween","morph","reveal"]).each(function(n){n=this.get(n);n&&n.setOptions({link:"chain"})},this),this},pauseFx:function(n,t){return this.chains(t).get(t||"tween").wait(n),this}})}(),Class.Mutators.Binds=function(n){return this.prototype.initialize||this.implement("initialize",function(){}),Array.convert(n).concat(this.prototype.Binds||[])},Class.Mutators.initialize=function(n){return function(){return Array.convert(this.Binds).each(function(n){var t=this[n];t&&(this[n]=t.bind(this))},this),n.apply(this,arguments)}},Class.Occlude=new Class({occlude:function(n,t){t=document.id(t||this.element);var i=t.retrieve(n||this.property);return i&&!this.occluded?this.occluded=i:(this.occluded=!1,t.store(n||this.property,this),this.occluded)}}),Class.refactor=function(n,t){return Object.each(t,function(t,i){var r=n.prototype[i];r=r&&r.$origin||r||function(){};n.implement(i,"function"==typeof t?function(){var i=this.previous,n;return this.previous=r,n=t.apply(this,arguments),this.previous=i,n}:t)}),n},Class.Singleton=new Class({initialize:function(n){var t,i=new Class(n);return function(){if(t)return t;t=Object.append({},i.prototype);t.constructor=i;var n=i.apply(t,arguments);return t="object"==typeof n?n:t}}}),function(){var n,t;Events.Pseudos=function(n,t,i){var r="_monitorEvents:",u=function(n){return{store:n.store?function(t,i){n.store(r+t,i)}:function(t,i){(n._monitorEvents||(n._monitorEvents={}))[t]=i},retrieve:n.retrieve?function(t,i){return n.retrieve(r+t,i)}:function(t,i){return n._monitorEvents?n._monitorEvents[t]||i:i}}},f=function(t){var f,e;if(-1==t.indexOf(":")||!n)return null;for(var o=Slick.parse(t).expressions[0][0],i=o.pseudos,r=i.length,u=[];r--;)f=i[r].key,e=n[f],null!=e&&u.push({event:o.tag,value:i[r].value,pseudo:f,original:t,listener:e});return u.length?u:null};return{addEvent:function(n,i,r){var s=f(n);if(!s)return t.call(this,n,i,r);var h=u(this),c=h.retrieve(n,[]),o=s[0].event,l=Array.slice(arguments,2),e=i,a=this;return s.each(function(n){var t=n.listener,i=e;0==t?o+=":"+n.pseudo+"("+n.value+")":e=function(){t.call(a,n,i,arguments,e)}}),c.include({type:o,event:i,monitor:e}),h.store(n,c),n!=o&&t.apply(this,[n,i].concat(l)),t.apply(this,[o,e].concat(l))},removeEvent:function(n,t){var s=f(n),e,r,o;return s?(e=u(this),r=e.retrieve(n),!r)?this:(o=Array.slice(arguments,2),i.apply(this,[n,t].concat(o)),r.each(function(n,u){t&&n.event!=t||i.apply(this,[n.type,n.monitor].concat(o));delete r[u]},this),e.store(n,r),this):i.call(this,n,t)}}};n={once:function(n,t,i,r){t.apply(this,i);this.removeEvent(n.event,r).removeEvent(n.original,t)},throttle:function(n,t,i){t._throttled||(t.apply(this,i),t._throttled=setTimeout(function(){t._throttled=!1},n.value||250))},pause:function(n,t,i){clearTimeout(t._pause);t._pause=t.delay(n.value||250,this,i)}};Events.definePseudo=function(t,i){return n[t]=i,this};Events.lookupPseudo=function(t){return n[t]};t=Events.prototype;Events.implement(Events.Pseudos(n,t.addEvent,t.removeEvent));["Request","Fx"].each(function(n){this[n]&&this[n].implement(Events.prototype)})}(),function(){var n=this.Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,unDraggableTags:["button","input","a","textarea","select","option"],preventDefault:!1,stopPropagation:!1,compensateScroll:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var i=Array.link(arguments,{options:Type.isObject,element:function(n){return null!=n}}),t;this.element=document.id(i.element);this.document=this.element.getDocument();this.setOptions(i.options||{});t=typeOf(this.options.handle);this.handles=("array"==t||"collection"==t?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.offsetParent=function(n){var t=n.getOffsetParent(),i=!t||/^(?:body|html)$/i.test(t.tagName);return i?window:document.id(t)}(this.element);this.selection="selectstart"in document?"selectstart":"mousedown";this.compensateScroll={start:{},diff:{},last:{}};!("ondragstart"in document)||"FileReader"in window||n.ondragstartFixed||(document.ondragstart=Function.convert(!1),n.ondragstartFixed=!0);this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.convert(!1),scrollListener:this.scrollListener.bind(this)};this.attach()},attach:function(){return this.handles.addEvent("mousedown",this.bound.start),this.handles.addEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.addEvent("scroll",this.bound.scrollListener),this},detach:function(){return this.handles.removeEvent("mousedown",this.bound.start),this.handles.removeEvent("touchstart",this.bound.start),this.options.compensateScroll&&this.offsetParent.removeEvent("scroll",this.bound.scrollListener),this},scrollListener:function(){var n,t;this.mouse.start&&(n=this.offsetParent.getScroll(),"absolute"==this.element.getStyle("position")?(t=this.sumValues(n,this.compensateScroll.last,-1),this.mouse.now=this.sumValues(this.mouse.now,t,1)):this.compensateScroll.diff=this.sumValues(n,this.compensateScroll.start,-1),this.offsetParent!=window&&(this.compensateScroll.diff=this.sumValues(this.compensateScroll.start,n,-1)),this.compensateScroll.last=n,this.render(this.options))},sumValues:function(n,t,i){var u={},f=this.options,r;for(r in f.modifiers)f.modifiers[r]&&(u[r]=n[r]+t[r]*i);return u},start:function(n){var i,f,t,o,h,u,e,r,s;if(!this.options.unDraggableTags.contains(n.target.get("tag"))&&(i=this.options,!n.rightClick)){i.preventDefault&&n.preventDefault();i.stopPropagation&&n.stopPropagation();this.compensateScroll.start=this.compensateScroll.last=this.offsetParent.getScroll();this.compensateScroll.diff={x:0,y:0};this.mouse.start=n.page;this.fireEvent("beforeStart",this.element);f=i.limit;this.limit={x:[],y:[]};h=this.offsetParent==window?null:this.offsetParent;for(t in i.modifiers)if(i.modifiers[t]&&(u=this.element.getStyle(i.modifiers[t]),u&&!u.match(/px$/)&&(o||(o=this.element.getCoordinates(h)),u=o[i.modifiers[t]]),this.value.now[t]=i.style?(u||0).toInt():this.element[i.modifiers[t]],i.invert&&(this.value.now[t]*=-1),this.mouse.pos[t]=n.page[t]-this.value.now[t],f&&f[t]))for(e=2;e--;)r=f[t][e],(r||0===r)&&(this.limit[t][e]="function"==typeof r?r():r);"number"==typeOf(this.options.grid)&&(this.options.grid={x:this.options.grid,y:this.options.grid});s={mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel};s[this.selection]=this.bound.eventStop;this.document.addEvents(s)}},check:function(n){this.options.preventDefault&&n.preventDefault();var t=Math.round(Math.sqrt(Math.pow(n.page.x-this.mouse.start.x,2)+Math.pow(n.page.y-this.mouse.start.y,2)));t>this.options.snap&&(this.cancel(),this.document.addEvents({mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop}),this.fireEvent("start",[this.element,n]).fireEvent("snap",this.element))},drag:function(n){var t=this.options;t.preventDefault&&n.preventDefault();this.mouse.now=this.sumValues(n.page,this.compensateScroll.diff,-1);this.render(t);this.fireEvent("drag",[this.element,n])},render:function(n){for(var t in n.modifiers)n.modifiers[t]&&(this.value.now[t]=this.mouse.now[t]-this.mouse.pos[t],n.invert&&(this.value.now[t]*=-1),n.limit&&this.limit[t]&&((this.limit[t][1]||0===this.limit[t][1])&&this.value.now[t]>this.limit[t][1]?this.value.now[t]=this.limit[t][1]:(this.limit[t][0]||0===this.limit[t][0])&&this.value.now[t]<this.limit[t][0]&&(this.value.now[t]=this.limit[t][0])),n.grid[t]&&(this.value.now[t]-=(this.value.now[t]-(this.limit[t][0]||0))%n.grid[t]),n.style?this.element.setStyle(n.modifiers[t],this.value.now[t]+n.unit):this.element[n.modifiers[t]]=this.value.now[t])},cancel:function(n){this.document.removeEvents({mousemove:this.bound.check,mouseup:this.bound.cancel,touchmove:this.bound.check,touchend:this.bound.cancel});n&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(n){var t={mousemove:this.bound.drag,mouseup:this.bound.stop,touchmove:this.bound.drag,touchend:this.bound.stop};t[this.selection]=this.bound.eventStop;this.document.removeEvents(t);this.mouse.start=null;n&&this.fireEvent("complete",[this.element,n])}})}(),Element.implement({makeResizable:function(n){var t=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},n));return this.store("resizer",t),t.addEvent("drag",function(){this.fireEvent("resize",t)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(n,t){if(this.parent(n,t),n=this.element,this.droppables=$$(this.options.droppables),this.setContainer(this.options.container),this.options.style){if("left"==this.options.modifiers.x&&"top"==this.options.modifiers.y){var i=n.getOffsetParent(),r=n.getStyles("left","top");i&&("auto"==r.left||"auto"==r.top)&&n.setPosition(n.getPosition(i))}"static"==n.getStyle("position")&&n.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0);this.overed=null},setContainer:function(n){this.container=document.id(n);this.container&&"element"!=typeOf(this.container)&&(this.container=document.id(this.container.getDocument().body))},start:function(n){this.container&&(this.options.limit=this.calculateLimit());this.options.precalculate&&(this.positions=this.droppables.map(function(n){return n.getCoordinates()}));this.parent(n)},calculateLimit:function(){var t=this.element,o=this.container,u=document.id(t.getOffsetParent())||document.body,h=o.getCoordinates(u),n={},y={},l={},f={},s={},c=u.getScroll(),e;["top","right","bottom","left"].each(function(i){n[i]=t.getStyle("margin-"+i).toInt();y[i]=t.getStyle("border-"+i).toInt();l[i]=o.getStyle("margin-"+i).toInt();f[i]=o.getStyle("border-"+i).toInt();s[i]=u.getStyle("padding-"+i).toInt()},this);var p=t.offsetWidth+n.left+n.right,w=t.offsetHeight+n.top+n.bottom,i=0+c.x,r=0+c.y,a=h.right-f.right-p+c.x,v=h.bottom-f.bottom-w+c.y;return(this.options.includeMargins?(i+=n.left,r+=n.top):(a+=n.right,v+=n.bottom),"relative"==t.getStyle("position"))?(e=t.getCoordinates(u),e.left-=t.getStyle("left").toInt(),e.top-=t.getStyle("top").toInt(),i-=e.left,r-=e.top,"relative"!=o.getStyle("position")&&(i+=f.left,r+=f.top),a+=n.left-e.left,v+=n.top-e.top,o!=u&&(i+=l.left+s.left,!s.left&&0>i&&(i=0),r+=u==document.body?0:l.top+s.top,!s.top&&0>r&&(r=0))):(i-=n.left,r-=n.top,o!=u&&(i+=h.left+f.left,r+=h.top+f.top)),{x:[i,a],y:[r,v]}},getDroppableCoordinates:function(n){var t=n.getCoordinates(),i;return"fixed"==n.getStyle("position")&&(i=window.getScroll(),t.left+=i.x,t.right+=i.x,t.top+=i.y,t.bottom+=i.y),t},checkDroppables:function(){var n=this.droppables.filter(function(n,t){n=this.positions?this.positions[t]:this.getDroppableCoordinates(n);var i=this.mouse.now;return i.x>n.left&&i.x<n.right&&i.y<n.bottom&&i.y>n.top},this).getLast();this.overed!=n&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),n&&this.fireEvent("enter",[this.element,n]),this.overed=n)},drag:function(n){this.parent(n);this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(n){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,n]),this.overed=null,this.parent(n)}}),Element.implement({makeDraggable:function(n){var t=new Drag.Move(this,n);return this.store("dragger",t),t}}),function(){var t=function(n,t){var i=[];return Object.each(t,function(t){Object.each(t,function(t){n.each(function(n){i.push(n+"-"+t+("border"==n?"-width":""))})})}),i},i=function(n,t){var i=0;return Object.each(t,function(t,r){r.test(n)&&(i+=t.toInt())}),i},n=function(n){return!(n&&!n.offsetHeight&&!n.offsetWidth)};Element.implement({measure:function(t){var i,r,u,f;if(n(this))return t.call(this);for(i=this.getParent(),r=[];!n(i)&&i!=document.body;)r.push(i.expose()),i=i.getParent();return u=this.expose(),f=t.call(this),u(),r.each(function(n){n()}),f},expose:function(){if("none"!=this.getStyle("display"))return function(){};var n=this.style.cssText;return this.setStyles({display:"block",position:"absolute",visibility:"hidden"}),function(){this.style.cssText=n}.bind(this)},getDimensions:function(n){n=Object.merge({computeSize:!1},n);var t={x:0,y:0},i=function(n,t){return t.computeSize?n.getComputedSize(t):n.getSize()},r=this.getParent("body");if(r&&"none"==this.getStyle("display"))t=this.measure(function(){return i(this,n)});else if(r)try{t=i(this,n)}catch(u){}return Object.append(t,t.x||0===t.x?{width:t.x,height:t.y}:{x:t.width,y:t.height})},getComputedSize:function(n){n=Object.merge({styles:["padding","border"],planes:{height:["top","bottom"],width:["left","right"]},mode:"both"},n);var f,u={},r={width:0,height:0};return"vertical"==n.mode?(delete r.width,delete n.planes.width):"horizontal"==n.mode&&(delete r.height,delete n.planes.height),t(n.styles,n.planes).each(function(n){u[n]=this.getStyle(n).toInt()},this),Object.each(n.planes,function(n,t){var o=t.capitalize(),e=this.getStyle(t);"auto"!=e||f||(f=this.getDimensions());e=u[t]="auto"==e?f[t]:e.toInt();r["total"+o]=e;n.each(function(n){var t=i(n,u);r["computed"+n.capitalize()]=t;r["total"+o]+=t})},this),Object.append(r,u)}})}(),function(){this.Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(n){this.setKnobPosition(n)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(n,t,i){var r,u,f;this.setOptions(i);i=this.options;this.element=document.id(n);t=this.knob=document.id(t);this.previousChange=this.previousEnd=this.step=i.initialStep?i.initialStep:i.range?i.range[0]:0;r={};u={x:!1,y:!1};switch(i.mode){case"vertical":this.axis="y";this.property="top";this.offset="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";this.offset="offsetWidth"}this.setSliderDimensions();this.setRange(i.range,null,!0);"static"==t.getStyle("position")&&t.setStyle("position","relative");t.setStyle(this.property,-i.offset);u[this.axis]=this.property;r[this.axis]=[-i.offset,this.full-i.offset];f={snap:0,limit:r,modifiers:u,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1;this.draggedKnob();this.end()}.bind(this)};i.snap&&this.setSnap(f);this.drag=new Drag(t,f);null!=i.initialStep&&this.set(i.initialStep,!0);this.attach()},attach:function(){return this.element.addEvent("mousedown",this.clickedElement),this.options.wheel&&this.element.addEvent("mousewheel",this.scrolledElement),this.drag.attach(),this},detach:function(){return this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement),this.drag.detach(),this},autosize:function(){return this.setSliderDimensions().setKnobPosition(this.toPosition(this.step)),this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset],this.options.snap&&this.setSnap(),this},setSnap:function(n){return n||(n=this.drag.options),n.grid=Math.ceil(this.stepWidth),n.limit[this.axis][1]=this.element[this.offset],this},setKnobPosition:function(n){return this.options.snap&&(n=this.toPosition(this.step)),this.knob.setStyle(this.property,n),this},setSliderDimensions:function(){return this.full=this.element.measure(function(){return this.half=this.knob[this.offset]/2,this.element[this.offset]-this.knob[this.offset]+2*this.options.offset}.bind(this)),this},set:function(n,t){return this.range>0^n<this.min||(n=this.min),this.range>0^n>this.max||(n=this.max),this.step=n.round(this.modulus.decimalLength),t?this.checkStep().setKnobPosition(this.toPosition(this.step)):this.checkStep().fireEvent("tick",this.toPosition(this.step)).fireEvent("move").end(),this},setRange:function(n,t,i){return this.min=Array.pick([n[0],0]),this.max=Array.pick([n[1],this.options.steps]),this.range=this.max-this.min,this.steps=this.options.steps||this.full,this.stepSize=Math.abs(this.range)/this.steps,this.stepWidth=this.stepSize*this.full/Math.abs(this.range),this.setModulus(),n&&this.set(Array.pick([t,this.step]).limit(this.min,this.max),i),this},setModulus:function(){for(var t=((this.stepSize+"").split(".")[1]||[]).length,n="1";t--;)n+="0";this.modulus={multiplier:n.toInt(10),decimalLength:n.length-1}},clickedElement:function(n){if(!this.isDragging&&n.target!=this.knob){var i=this.range<0?-1:1,t=n.page[this.axis]-this.element.getPosition()[this.axis]-this.half;t=t.limit(-this.options.offset,this.full-this.options.offset);this.step=(this.min+i*this.toStep(t)).round(this.modulus.decimalLength);this.checkStep().fireEvent("tick",t).fireEvent("move").end()}},scrolledElement:function(n){var t="horizontal"==this.options.mode?n.wheel<0:n.wheel>0;this.set(this.step+(t?-1:1)*this.stepSize);n.stop()},draggedKnob:function(){var t=this.range<0?-1:1,n=this.drag.value.now[this.axis];n=n.limit(-this.options.offset,this.full-this.options.offset);this.step=(this.min+t*this.toStep(n)).round(this.modulus.decimalLength);this.checkStep();this.fireEvent("move")},checkStep:function(){var n=this.step;return this.previousChange!=n&&(this.previousChange=n,this.fireEvent("change",n)),this},end:function(){var n=this.step;return this.previousEnd!==n&&(this.previousEnd=n,this.fireEvent("complete",n+"")),this},toStep:function(n){var t=(n+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?(t-t*this.modulus.multiplier%(this.stepSize*this.modulus.multiplier)/this.modulus.multiplier).round(this.modulus.decimalLength):t},toPosition:function(n){return this.full*Math.abs(this.min-n)/(this.steps*this.stepSize)-this.options.offset||0}})}(),function(){this.Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{},unDraggableTags:["button","input","a","textarea","select","option"]},initialize:function(n,t){this.setOptions(t);this.elements=[];this.lists=[];this.idle=!0;this.addLists($$(document.id(n)||n));this.options.clone||(this.options.revert=!1);this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each(function(n){this.elements.push(n);var t=n.retrieve("sortables:start",function(t){this.start.call(this,t,n)}.bind(this));(this.options.handle?n.getElement(this.options.handle)||n:n).addEvent("mousedown",t)},this),this},addLists:function(){return Array.flatten(arguments).each(function(n){this.lists.include(n);this.addItems(n.getChildren())},this),this},removeItems:function(){return $$(Array.flatten(arguments).map(function(n){this.elements.erase(n);var t=n.retrieve("sortables:start");return(this.options.handle?n.getElement(this.options.handle)||n:n).removeEvent("mousedown",t),n},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(n){return this.lists.erase(n),this.removeItems(n.getChildren()),n},this))},getDroppableCoordinates:function(n){var r=n.getOffsetParent(),t=n.getPosition(r),i={w:window.getScroll(),offsetParent:r.getScroll()};return t.x+=i.offsetParent.x,t.y+=i.offsetParent.y,"fixed"==r.getStyle("position")&&(t.x-=i.w.x,t.y-=i.w.y),t},getClone:function(n,t){if(!this.options.clone)return new Element(t.tagName).inject(document.body);if("function"==typeOf(this.options.clone))return this.options.clone.call(this,n,t,this.list);var i=t.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:t.getStyle("width")}).addEvent("mousedown",function(n){t.fireEvent("mousedown",n)});return i.get("html").test("radio")&&i.getElements("input[type=radio]").each(function(n,i){n.set("name","clone_"+i);n.get("checked")&&t.getElements("input[type=radio]")[i].set("checked",!0)}),i.inject(this.list).setPosition(this.getDroppableCoordinates(this.element))},getDroppables:function(){var n=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||n.append(this.lists).erase(this.list),n},insert:function(n,t){var i="inside";this.lists.contains(t)?(this.list=t,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(t)?"before":"after";this.element.inject(t,i);this.fireEvent("sort",[this.element,this.clone])},start:function(n,t){!this.idle||n.rightClick||!this.options.handle&&this.options.unDraggableTags.contains(n.target.get("tag"))||(this.idle=!1,this.element=t,this.opacity=t.getStyle("opacity"),this.list=t.getParent(),this.clone=this.getClone(n,t),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){n.stop();this.clone.setStyle("visibility","visible");this.element.setStyle("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(n))},end:function(){var t;if(this.drag.detach(),this.element.setStyle("opacity",this.opacity),t=this,this.effect){var r=this.element.getStyles("width","height"),n=this.clone,u=n.computePosition(this.getDroppableCoordinates(n)),i=function(){this.removeEvent("cancel",i);n.destroy();t.reset()};this.effect.element=n;this.effect.start({top:u.top,left:u.left,width:r.width,height:r.height,opacity:.25}).addEvent("cancel",i).chain(i)}else this.clone.destroy(),t.reset()},reset:function(){this.idle=!0;this.fireEvent("complete",this.element)},serialize:function(){var t=Array.link(arguments,{modifier:Type.isFunction,index:function(n){return null!=n}}),i=this.lists.map(function(n){return n.getChildren().map(t.modifier||function(n){return n.get("id")},this)},this),n=t.index;return 1==this.lists.length&&(n=0),(n||0===n)&&n>=0&&n<this.lists.length?i[n]:i}})}(),function(){for(var r,n={relay:!1},t=["once","throttle","pause"],i=t.length;i--;)n[t[i]]=Events.lookupPseudo(t[i]);DOMEvent.definePseudo=function(t,i){return n[t]=i,this};r=Element.prototype;[Element,Window,Document].invoke("implement",Events.Pseudos(n,r.addEvent,r.removeEvent))}(),function(){var n="$moo:keys-pressed",t="$moo:keys-keyup";DOMEvent.definePseudo("keys",function(i,r,u){var h=u[0],e=[],f=this.retrieve(n,[]),s=i.value,o;("+"!=s?e.append(s.replace("++",function(){return e.push("+"),""}).split("+")):e=["+"],f.include(h.key),e.every(function(n){return f.contains(n)})&&r.apply(this,u),this.store(n,f),this.retrieve(t))||(o=function(t){(function(){f=this.retrieve(n,[]).erase(t.key);this.store(n,f)}).delay(0,this)},this.store(t,o).addEvent("keyup",o))});DOMEvent.defineKeys({16:"shift",17:"control",18:"alt",20:"capslock",33:"pageup",34:"pagedown",35:"end",36:"home",144:"numlock",145:"scrolllock",186:";",187:"=",188:",",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",107:"+",109:"-",189:"-"})}(),function(){var i={a:/[Ã Ã¡Ã¢Ã£Ã¤Ã¥ÄÄ]/g,A:/[ÃÃÃÃÃÃÄÄ]/g,c:/[ÄÄÃ§]/g,C:/[ÄÄÃ]/g,d:/[ÄÄ]/g,D:/[ÄÃ]/g,e:/[Ã¨Ã©ÃªÃ«ÄÄ]/g,E:/[ÃÃÃÃÄÄ]/g,g:/[Ä]/g,G:/[Ä]/g,i:/[Ã¬Ã­Ã®Ã¯]/g,I:/[ÃÃÃÃ]/g,l:/[ÄºÄ¾Å]/g,L:/[Ä¹Ä½Å]/g,n:/[Ã±ÅÅ]/g,N:/[ÃÅÅ]/g,o:/[Ã²Ã³Ã´ÃµÃ¶Ã¸Å]/g,O:/[ÃÃÃÃÃÃ]/g,r:/[ÅÅ]/g,R:/[ÅÅ]/g,s:/[Å¡Å¡Å]/g,S:/[Å ÅÅ]/g,t:/[Å¥Å£]/g,T:/[Å¤Å¢]/g,u:/[Ã¹ÃºÃ»Å¯Ã¼Âµ]/g,U:/[ÃÃÃÅ®Ã]/g,y:/[Ã¿Ã½]/g,Y:/[Å¸Ã]/g,z:/[Å¾ÅºÅ¼]/g,Z:/[Å½Å¹Å»]/g,th:/[Ã¾]/g,TH:/[Ã]/g,dh:/[Ã°]/g,DH:/[Ã]/g,ss:/[Ã]/g,oe:/[Å]/g,OE:/[Å]/g,ae:/[Ã¦]/g,AE:/[Ã]/g},r={" ":/[\xa0\u2002\u2003\u2009]/g,"*":/[\xb7]/g,"'":/[\u2018\u2019]/g,'"':/[\u201c\u201d]/g,"...":/[\u2026]/g,"-":/[\u2013]/g,"&raquo;":/[\uFFFD]/g},u={ms:1,s:1e3,m:6e4,h:36e5},f=/(\d*.?\d+)([msh]+)/,n=function(n,t){var i,r=n;for(i in t)r=r.replace(t[i],i);return r},t=function(n,t){n=n||(t?"":"\\w+");var i=t?"<"+n+"(?!\\w)[^>]*>([\\s\\S]*?)<\/"+n+"(?!\\w)>":"<\/?"+n+"/?>|<"+n+"[\\s|/][^>]*>";return new RegExp(i,"gi")};String.implement({standardize:function(){return n(this,i)},repeat:function(n){return new Array(n+1).join(this)},pad:function(n,t,i){if(this.length>=n)return this;var r=(null==t?" ":""+t).repeat(n-this.length).substr(0,n-this.length);return i&&"right"!=i?"left"==i?r+this:r.substr(0,(r.length/2).floor())+this+r.substr(0,(r.length/2).ceil()):this+r},getTags:function(n,i){return this.match(t(n,i))||[]},stripTags:function(n,i){return this.replace(t(n,i),"")},tidy:function(){return n(this,r)},truncate:function(n,t,i){var r=this,u;return(null==t&&1==arguments.length&&(t="â¦"),r.length>n)&&((r=r.substring(0,n),i)&&(u=r.lastIndexOf(i),-1!=u&&(r=r.substr(0,u))),t&&(r+=t)),r},ms:function(){var n=f.exec(this);return null==n?Number(this):Number(n[1])*u[n[2]]}})}(),Element.implement({tidy:function(){this.set("value",this.get("value").tidy())},getTextInRange:function(n,t){return this.get("value").substring(n,t)},getSelectedText:function(){return this.setSelectionRange?this.getTextInRange(this.getSelectionStart(),this.getSelectionEnd()):document.selection.createRange().text},getSelectedRange:function(){var n,i,t,u,r;return null!=this.selectionStart?{start:this.selectionStart,end:this.selectionEnd}:(n={start:0,end:0},i=this.getDocument().selection.createRange(),!i||i.parentElement()!=this)?n:(t=i.duplicate(),"text"==this.type?(n.start=0-t.moveStart("character",-1e5),n.end=n.start+i.text.length):(u=this.get("value"),r=u.length,t.moveToElementText(this),t.setEndPoint("StartToEnd",i),t.text.length&&(r-=u.match(/[\n\r]*$/)[0].length),n.end=r-t.text.length,t.setEndPoint("StartToStart",i),n.start=r-t.text.length),n)},getSelectionStart:function(){return this.getSelectedRange().start},getSelectionEnd:function(){return this.getSelectedRange().end},setCaretPosition:function(n){return"end"==n&&(n=this.get("value").length),this.selectRange(n,n),this},getCaretPosition:function(){return this.getSelectedRange().start},selectRange:function(n,t){var r,u,i;return this.setSelectionRange?(this.focus(),this.setSelectionRange(n,t)):(r=this.get("value"),u=r.substr(n,t-n).replace(/\r/g,"").length,n=r.substr(0,n).replace(/\r/g,"").length,i=this.createTextRange(),i.collapse(!0),i.moveEnd("character",n+u),i.moveStart("character",n),i.select()),this},insertAtCursor:function(n,t){var i=this.getSelectedRange(),r=this.get("value");return this.set("value",r.substring(0,i.start)+n+r.substring(i.end,r.length)),t!==!1?this.selectRange(i.start,i.start+n.length):this.setCaretPosition(i.start+n.length),this},insertAroundCursor:function(n,t){var f,u;n=Object.append({before:"",defaultMiddle:"",after:""},n);var e=this.getSelectedText()||n.defaultMiddle,i=this.getSelectedRange(),r=this.get("value");return i.start==i.end?(this.set("value",r.substring(0,i.start)+n.before+e+n.after+r.substring(i.end,r.length)),this.selectRange(i.start+n.before.length,i.end+n.before.length+e.length)):(f=r.substring(i.start,i.end),this.set("value",r.substring(0,i.start)+n.before+f+n.after+r.substring(i.end,r.length)),u=i.start+n.before.length,t!==!1?this.selectRange(u,u+f.length):this.setCaretPosition(u+r.length)),this}}),function(){var n=!1,t=!1,i=function(){var i=new Element("div").setStyles({position:"fixed",top:0,right:0}).inject(document.body);n=0===i.offsetTop;i.dispose();t=!0};Element.implement({pin:function(r,u){var o,f,s,e,l,h,c;if(t||i(),"none"==this.getStyle("display"))return this;if(e=window.getScroll(),r!==!1)(o=this.getPosition(),this.retrieve("pin:_pinned"))||(l={top:o.y-e.y,left:o.x-e.x,margin:"0px",padding:"0px"},n&&!u?this.setStyle("position","fixed").setStyles(l):(f=this.getOffsetParent(),h=this.getPosition(f),c=this.getStyles("left","top"),(f&&"auto"==c.left||"auto"==c.top)&&this.setPosition(h),"static"==this.getStyle("position")&&this.setStyle("position","absolute"),h={x:c.left.toInt()-e.x,y:c.top.toInt()-e.y},s=function(){if(this.retrieve("pin:_pinned")){var n=window.getScroll();this.setStyles({left:h.x+n.x,top:h.y+n.y})}}.bind(this),this.store("pin:_scrollFixer",s),window.addEvent("scroll",s)),this.store("pin:_pinned",!0));else{if(!this.retrieve("pin:_pinned"))return this;f=this.getParent();"static"!=f.getComputedStyle("position")?f:f.getOffsetParent();o=this.getPosition();this.store("pin:_pinned",!1);s=this.retrieve("pin:_scrollFixer");s?(this.store("pin:_scrollFixer",null),window.removeEvent("scroll",s)):this.setStyles({position:"absolute",top:o.y+e.y,left:o.x+e.x});this.removeClass("isPinned")}return this},unpin:function(){return this.pin(!1)},togglePin:function(){return this.pin(!this.retrieve("pin:_pinned"))}})}(),function(n){var t=Element.Position={options:{relativeTo:document.body,position:{x:"center",y:"center"},offset:{x:0,y:0}},getOptions:function(n,i){return i=Object.merge({},t.options,i),t.setPositionOption(i),t.setEdgeOption(i),t.setOffsetOption(n,i),t.setDimensionsOption(n,i),i},setPositionOption:function(n){n.position=t.getCoordinateFromValue(n.position)},setEdgeOption:function(n){var i=t.getCoordinateFromValue(n.edge);n.edge=i?i:"center"==n.position.x&&"center"==n.position.y?{x:"center",y:"center"}:{x:"left",y:"top"}},setOffsetOption:function(n,t){var r={x:0,y:0},u={x:0,y:0},i=n.measure(function(){return document.id(this.getOffsetParent())});i&&i!=n.getDocument().body&&(u=i.getScroll(),r=i.measure(function(){var n=this.getPosition(),t;return"fixed"==this.getStyle("position")&&(t=window.getScroll(),n.x+=t.x,n.y+=t.y),n}),t.offset={parentPositioned:i!=document.id(t.relativeTo),x:t.offset.x-r.x+u.x,y:t.offset.y-r.y+u.y})},setDimensionsOption:function(n,t){t.dimensions=n.getDimensions({computeSize:!0,styles:["padding","border","margin"]})},getPosition:function(n,i){var r={},u,f;return i=t.getOptions(n,i),u=document.id(i.relativeTo)||document.body,t.setPositionCoordinates(i,r,u),i.edge&&t.toEdge(r,i),f=i.offset,r.left=(r.x>=0||f.parentPositioned||i.allowNegative?r.x:0).toInt(),r.top=(r.y>=0||f.parentPositioned||i.allowNegative?r.y:0).toInt(),t.toMinMax(r,i),(i.relFixedPosition||"fixed"==u.getStyle("position"))&&t.toRelFixedPosition(u,r),i.ignoreScroll&&t.toIgnoreScroll(u,r),i.ignoreMargins&&t.toIgnoreMargins(r,i),r.left=Math.ceil(r.left),r.top=Math.ceil(r.top),delete r.x,delete r.y,r},setPositionCoordinates:function(n,t,i){var r=n.offset.y,u=n.offset.x,o=i==document.body?window.getScroll():i.getPosition(),f=o.y,e=o.x,s=window.getSize();switch(n.position.x){case"left":t.x=e+u;break;case"right":t.x=e+u+i.offsetWidth;break;default:t.x=e+(i==document.body?s.x:i.offsetWidth)/2+u}switch(n.position.y){case"top":t.y=f+r;break;case"bottom":t.y=f+r+i.offsetHeight;break;default:t.y=f+(i==document.body?s.y:i.offsetHeight)/2+r}},toMinMax:function(n,t){var i,r={left:"x",top:"y"};["minimum","maximum"].each(function(u){["left","top"].each(function(f){i=t[u]?t[u][r[f]]:null;null!=i&&("minimum"==u?n[f]<i:n[f]>i)&&(n[f]=i)})})},toRelFixedPosition:function(n,t){var i=window.getScroll();t.top+=i.y;t.left+=i.x},toIgnoreScroll:function(n,t){var i=n.getScroll();t.top-=i.y;t.left-=i.x},toIgnoreMargins:function(n,t){n.left+="right"==t.edge.x?t.dimensions["margin-right"]:"center"!=t.edge.x?-t.dimensions["margin-left"]:-t.dimensions["margin-left"]+(t.dimensions["margin-right"]+t.dimensions["margin-left"])/2;n.top+="bottom"==t.edge.y?t.dimensions["margin-bottom"]:"center"!=t.edge.y?-t.dimensions["margin-top"]:-t.dimensions["margin-top"]+(t.dimensions["margin-bottom"]+t.dimensions["margin-top"])/2},toEdge:function(n,t){var i={},r=t.dimensions,u=t.edge;switch(u.x){case"left":i.x=0;break;case"right":i.x=-r.x-r.computedRight-r.computedLeft;break;default:i.x=-Math.round(r.totalWidth/2)}switch(u.y){case"top":i.y=0;break;case"bottom":i.y=-r.y-r.computedTop-r.computedBottom;break;default:i.y=-Math.round(r.totalHeight/2)}n.x+=i.x;n.y+=i.y},getCoordinateFromValue:function(n){return"string"!=typeOf(n)?n:(n=n.toLowerCase(),{x:n.test("left")?"left":n.test("right")?"right":"center",y:n.test(/upper|top/)?"top":n.test("bottom")?"bottom":"center"})}};Element.implement({position:function(t){if(t&&(null!=t.x||null!=t.y))return n?n.apply(this,arguments):this;var i=this.setStyle("position","absolute").calculatePosition(t);return t&&t.returnPos?i:this.setStyles(i)},calculatePosition:function(n){return t.getPosition(this,n)}})}(Element.prototype.position),Elements.from=function(n,t){var i,r,u;return(t||null==t)&&(n=n.stripScripts()),r=n.match(/^\s*(?:<!--.*?-->\s*)*<(t[dhr]|tbody|tfoot|thead)/i),r&&(i=new Element("table"),u=r[1].toLowerCase(),["td","th","tr"].contains(u)&&(i=new Element("tbody").inject(i),"tr"!=u&&(i=new Element("tr").inject(i)))),(i||new Element("div")).set("html",n).getChildren()},function(){var n=this.IframeShim=new Class({Implements:[Options,Events,Class.Occlude],options:{className:"iframeShim",src:'javascript:false;document.write("");',display:!1,zIndex:null,margin:0,offset:{x:0,y:0},browsers:!1},property:"IframeShim",initialize:function(n,t){return this.element=document.id(n),this.occlude()?this.occluded:(this.setOptions(t),this.makeShim(),this)},makeShim:function(){var t,i,r;this.options.browsers?(t=this.element.getStyle("zIndex").toInt(),t||(t=1,i=this.element.getStyle("position"),"static"!=i&&i||this.element.setStyle("position","relative"),this.element.setStyle("zIndex",t)),t=(null!=this.options.zIndex||0===this.options.zIndex)&&t>this.options.zIndex?this.options.zIndex:t-1,0>t&&(t=1),this.shim=new Element("iframe",{src:this.options.src,scrolling:"no",frameborder:0,styles:{zIndex:t,position:"absolute",border:"none",filter:"progid:DXImageTransform.Microsoft.Alpha(style=0,opacity=0)"},"class":this.options.className}).store("IframeShim",this),r=function(){this.shim.inject(this.element,"after");this[this.options.display?"show":"hide"]();this.fireEvent("inject")}.bind(this),n.ready?r():window.addEvent("load",r)):this.position=this.hide=this.show=this.dispose=Function.convert(this)},position:function(){if(!n.ready||!this.shim)return this;var t=this.element.measure(function(){return this.getSize()});return void 0!=this.options.margin&&(t.x=t.x-2*this.options.margin,t.y=t.y-2*this.options.margin,this.options.offset.x+=this.options.margin,this.options.offset.y+=this.options.margin),this.shim.set({width:t.x,height:t.y}).position({relativeTo:this.element,offset:this.options.offset}),this},hide:function(){return this.shim&&this.shim.setStyle("display","none"),this},show:function(){return this.shim&&this.shim.setStyle("display","block"),this.position()},dispose:function(){return this.shim&&this.shim.dispose(),this},destroy:function(){return this.shim&&this.shim.destroy(),this}})}(),window.addEvent("load",function(){IframeShim.ready=!0}),function(){this.Mask=new Class({Implements:[Options,Events],Binds:["position"],options:{style:{},"class":"mask",maskMargins:!1,useIframeShim:!0,iframeShimOptions:{}},initialize:function(n,t){this.target=document.id(n)||document.id(document.body);this.target.store("mask",this);this.setOptions(t);this.render();this.inject()},render:function(){this.element=new Element("div",{"class":this.options["class"],id:this.options.id||"mask-"+String.uniqueID(),styles:Object.merge({},this.options.style,{display:"none"}),events:{click:function(n){this.fireEvent("click",n);this.options.hideOnClick&&this.hide()}.bind(this)}});this.hidden=!0},toElement:function(){return this.element},inject:function(n,t){t=t||(this.options.inject?this.options.inject.where:"")||(this.target==document.body?"inside":"after");n=n||this.options.inject&&this.options.inject.target||this.target;this.element.inject(n,t);this.options.useIframeShim&&(this.shim=new IframeShim(this.element,this.options.iframeShimOptions),this.addEvents({show:this.shim.show.bind(this.shim),hide:this.shim.hide.bind(this.shim),destroy:this.shim.destroy.bind(this.shim)}))},position:function(){return this.resize(this.options.width,this.options.height),this.element.position({relativeTo:this.target,position:"topLeft",ignoreMargins:!this.options.maskMargins,ignoreScroll:this.target==document.body}),this},resize:function(n,t){var u={styles:["padding","border"]},i,r;return this.options.maskMargins&&u.styles.push("margin"),i=this.target.getComputedSize(u),this.target==document.body&&(this.element.setStyles({width:0,height:0}),r=window.getScrollSize(),i.totalHeight<r.y&&(i.totalHeight=r.y),i.totalWidth<r.x&&(i.totalWidth=r.x)),this.element.setStyles({width:Array.pick([n,i.totalWidth,i.x]),height:Array.pick([t,i.totalHeight,i.y])}),this},show:function(){return this.hidden?(window.addEvent("resize",this.position),this.position(),this.showMask.apply(this,arguments),this):this},showMask:function(){this.element.setStyle("display","block");this.hidden=!1;this.fireEvent("show")},hide:function(){return this.hidden?this:(window.removeEvent("resize",this.position),this.hideMask.apply(this,arguments),this.options.destroyOnHide?this.destroy():this)},hideMask:function(){this.element.setStyle("display","none");this.hidden=!0;this.fireEvent("hide")},toggle:function(){this[this.hidden?"show":"hide"]()},destroy:function(){this.hide();this.element.destroy();this.fireEvent("destroy");this.target.eliminate("mask")}})}(),Element.Properties.mask={set:function(n){var t=this.retrieve("mask");return t&&t.destroy(),this.eliminate("mask").store("mask:options",n)},get:function(){var n=this.retrieve("mask");return n||(n=new Mask(this,this.retrieve("mask:options")),this.store("mask",n)),n}},Element.implement({mask:function(n){return n&&this.set("mask",n),this.get("mask").show(),this},unmask:function(){return this.get("mask").hide(),this}}),function(){this.Spinner=new Class({Extends:this.Mask,Implements:Chain,options:{"class":"spinner",containerPosition:{},content:{"class":"spinner-content"},messageContainer:{"class":"spinner-msg"},img:{"class":"spinner-img"},fxOptions:{link:"chain"}},initialize:function(n,t){this.target=document.id(n)||document.id(document.body);this.target.store("spinner",this);this.setOptions(t);this.render();this.inject();var i=function(){this.active=!1}.bind(this);this.addEvents({hide:i,show:i})},render:function(){this.parent();this.element.set("id",this.options.id||"spinner-"+String.uniqueID());this.content=document.id(this.options.content)||new Element("div",this.options.content);this.content.inject(this.element);this.options.message&&(this.msg=document.id(this.options.message)||new Element("p",this.options.messageContainer).appendText(this.options.message),this.msg.inject(this.content));this.options.img&&(this.img=document.id(this.options.img)||new Element("div",this.options.img),this.img.inject(this.content));this.element.set("tween",this.options.fxOptions)},show:function(n){return this.active?this.chain(this.show.bind(this)):this.hidden?(this.target.set("aria-busy","true"),this.active=!0,this.parent(n)):(this.callChain.delay(20,this),this)},showMask:function(n){var t=function(){this.content.position(Object.merge({relativeTo:this.element},this.options.containerPosition))}.bind(this);n?(this.parent(),t()):(this.options.style.opacity||(this.options.style.opacity=this.element.getStyle("opacity").toFloat()),this.element.setStyles({display:"block",opacity:0}).tween("opacity",this.options.style.opacity),t(),this.hidden=!1,this.fireEvent("show"),this.callChain())},hide:function(n){return this.active?this.chain(this.hide.bind(this)):this.hidden?(this.callChain.delay(20,this),this):(this.target.set("aria-busy","false"),this.active=!0,this.parent(n))},hideMask:function(n){return n?this.parent():void this.element.tween("opacity",0).get("tween").chain(function(){this.element.setStyle("display","none");this.hidden=!0;this.fireEvent("hide");this.callChain()}.bind(this))},destroy:function(){this.content.destroy();this.parent();this.target.eliminate("spinner")}})}(),Request=Class.refactor(Request,{options:{useSpinner:!1,spinnerOptions:{},spinnerTarget:!1},initialize:function(n){this._send=this.send;this.send=function(n){var t=this.getSpinner();return t?t.chain(this._send.pass(n,this)).show():this._send(n),this};this.previous(n)},getSpinner:function(){var n,t;return this.spinner||(n=document.id(this.options.spinnerTarget)||document.id(this.options.update),this.options.useSpinner&&n&&(n.set("spinner",this.options.spinnerOptions),t=this.spinner=n.get("spinner"),["complete","exception","cancel"].each(function(n){this.addEvent(n,t.hide.bind(t))},this))),this.spinner}}),Element.Properties.spinner={set:function(n){var t=this.retrieve("spinner");return t&&t.destroy(),this.eliminate("spinner").store("spinner:options",n)},get:function(){var n=this.retrieve("spinner");return n||(n=new Spinner(this,this.retrieve("spinner:options")),this.store("spinner",n)),n}},Element.implement({spin:function(n){return n&&this.set("spinner",n),this.get("spinner").show(),this},unspin:function(){return this.get("spinner").hide(),this}}),function(){var n=function(n){return decodeURIComponent(n.replace(/\+/g," "))};String.implement({parseQueryString:function(t,i){null==t&&(t=!0);null==i&&(i=!0);var u=this.split(/[&;]/),r={};return u.length?(u.each(function(u){var e=u.indexOf("=")+1,f=e?u.substr(e):"",s=e?u.substr(0,e-1).match(/([^\]\[]+|(\B)(?=\]))/g):[u],o=r;s&&(i&&(f=n(f)),s.each(function(i,r){t&&(i=n(i));var u=o[i];r<s.length-1?o=o[i]=u||{}:"array"==typeOf(u)?u.push(f):o[i]=null!=u?[u,f]:f}))}),r):r},cleanQueryString:function(n){return this.split("&").filter(function(t){var i=t.indexOf("="),u=0>i?"":t.substr(0,i),r=t.substr(i+1);return n?n.call(null,u,r):r||0===r}).join("&")}})}(),window.Form||(window.Form={}),function(){Form.Request=new Class({Binds:["onSubmit","onFormValidate"],Implements:[Options,Events,Class.Occlude],options:{requestOptions:{evalScripts:!0,useSpinner:!0,emulation:!1,link:"ignore"},sendButtonClicked:!0,extraData:{},resetForm:!0},property:"form.request",initialize:function(n,t,i){return this.element=document.id(n),this.occlude()?this.occluded:void this.setOptions(i).setTarget(t).attach()},setTarget:function(n){return this.target=document.id(n),this.request?this.request.setOptions({update:this.target}):this.makeRequest(),this},toElement:function(){return this.element},makeRequest:function(){var n=this;return this.request=new Request.HTML(Object.merge({update:this.target,emulation:!1,spinnerTarget:this.element,method:this.element.get("method")||"post"},this.options.requestOptions)).addEvents({success:function(t,i,r,u){["complete","success"].each(function(f){n.fireEvent(f,[n.target,t,i,r,u])})},failure:function(){n.fireEvent("complete",arguments).fireEvent("failure",arguments)},exception:function(){n.fireEvent("failure",arguments)}}),this.attachReset()},attachReset:function(){return this.options.resetForm?(this.request.addEvent("success",function(){Function.attempt(function(){this.element.reset()}.bind(this));window.OverText&&OverText.update()}.bind(this)),this):this},attach:function(n){var t=0!=n?"addEvent":"removeEvent",i;return this.element[t]("click:relay(button, input[type=submit])",this.saveClickedButton.bind(this)),i=this.element.retrieve("validator"),i?i[t]("onFormValidate",this.onFormValidate):this.element[t]("submit",this.onSubmit),this},detach:function(){return this.attach(!1)},enable:function(){return this.attach()},disable:function(){return this.detach()},onFormValidate:function(n,t,i){if(i){var r=this.element.retrieve("validator");(n||r&&!r.options.stopOnFailure)&&(i.stop(),this.send())}},onSubmit:function(n){var t=this.element.retrieve("validator");return t?(this.element.removeEvent("submit",this.onSubmit),t.addEvent("onFormValidate",this.onFormValidate),void t.validate(n)):(n&&n.stop(),void this.send())},saveClickedButton:function(n,t){var i=t.get("name");i&&this.options.sendButtonClicked&&(this.options.extraData[i]=t.get("value")||!0,this.clickedCleaner=function(){delete this.options.extraData[i];this.clickedCleaner=function(){}}.bind(this))},clickedCleaner:function(){},send:function(){var n=this.element.toQueryString().trim(),t=Object.toQueryString(this.options.extraData);return n?n+="&"+t:n=t,this.fireEvent("send",[this.element,n.parseQueryString()]),this.request.send({data:n,url:this.options.requestOptions.url||this.element.get("action")}),this.clickedCleaner(),this}});Element.implement("formUpdate",function(n,t){var i=this.retrieve("form.request");return i?(n&&i.setTarget(n),t&&i.setOptions(t).makeRequest()):i=new Form.Request(this,n,t),i.send(),this})}(),Element.implement({isDisplayed:function(){return"none"!=this.getStyle("display")},isVisible:function(){var n=this.offsetWidth,t=this.offsetHeight;return 0==n&&0==t?!1:n>0&&t>0?!0:"none"!=this.style.display},toggle:function(){return this[this.isDisplayed()?"hide":"show"]()},hide:function(){var n;try{n=this.getStyle("display")}catch(t){}return"none"==n?this:this.store("element:_originalDisplay",n||"").setStyle("display","none")},show:function(n){return!n&&this.isDisplayed()?this:(n=n||this.retrieve("element:_originalDisplay")||"block",this.setStyle("display","none"==n?"block":n))},swapClass:function(n,t){return this.removeClass(n).addClass(t)}}),Document.implement({clearSelection:function(){if(window.getSelection){var n=window.getSelection();n&&n.removeAllRanges&&n.removeAllRanges()}else if(document.selection&&document.selection.empty)try{document.selection.empty()}catch(t){}}}),function(){var n=function(n){var i=n.options.hideInputs,t;return window.OverText&&(t=[null],OverText.each(function(n){t.include("."+n.options.labelClass)}),t&&(i+=t.join(", "))),i?n.element.getElements(i):null};Fx.Reveal=new Class({Extends:Fx.Morph,options:{link:"cancel",styles:["padding","border","margin"],transitionOpacity:"opacity"in document.documentElement,mode:"vertical",display:function(){return"tr"!=this.element.get("tag")?"block":"table-row"},opacity:1,hideInputs:"opacity"in document.documentElement?null:"select, input, textarea, object, embed"},dissolve:function(){var i,r,t;return this.hiding||this.showing?"chain"==this.options.link?this.chain(this.dissolve.bind(this)):"cancel"!=this.options.link||this.hiding||(this.cancel(),this.dissolve()):"none"!=this.element.getStyle("display")?(this.hiding=!0,this.showing=!1,this.hidden=!0,this.cssText=this.element.style.cssText,i=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode}),this.options.transitionOpacity&&(i.opacity=this.options.opacity),r={},Object.each(i,function(n,t){r[t]=[n,0]}),this.element.setStyles({display:Function.convert(this.options.display).call(this),overflow:"hidden"}),t=n(this),t&&t.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.hidden&&(this.hiding=!1,this.element.style.cssText=this.cssText,this.element.setStyle("display","none"),t&&t.setStyle("visibility","visible"));this.fireEvent("hide",this.element);this.callChain()}.bind(this)),this.start(r)):(this.callChain.delay(10,this),this.fireEvent("complete",this.element),this.fireEvent("hide",this.element)),this},reveal:function(){var t,r,i;return this.showing||this.hiding?"chain"==this.options.link?this.chain(this.reveal.bind(this)):"cancel"!=this.options.link||this.showing||(this.cancel(),this.reveal()):"none"==this.element.getStyle("display")?(this.hiding=!1,this.showing=!0,this.hidden=!1,this.cssText=this.element.style.cssText,this.element.measure(function(){t=this.element.getComputedSize({styles:this.options.styles,mode:this.options.mode})}.bind(this)),null!=this.options.heightOverride&&(t.height=this.options.heightOverride.toInt()),null!=this.options.widthOverride&&(t.width=this.options.widthOverride.toInt()),this.options.transitionOpacity&&(this.element.setStyle("opacity",0),t.opacity=this.options.opacity),r={height:0,display:Function.convert(this.options.display).call(this)},Object.each(t,function(n,t){r[t]=0}),r.overflow="hidden",this.element.setStyles(r),i=n(this),i&&i.setStyle("visibility","hidden"),this.$chain.unshift(function(){this.element.style.cssText=this.cssText;this.element.setStyle("display",Function.convert(this.options.display).call(this));this.hidden||(this.showing=!1);i&&i.setStyle("visibility","visible");this.callChain();this.fireEvent("show",this.element)}.bind(this)),this.start(t)):(this.callChain(),this.fireEvent("complete",this.element),this.fireEvent("show",this.element)),this},toggle:function(){return"none"==this.element.getStyle("display")?this.reveal():this.dissolve(),this},cancel:function(){return this.parent.apply(this,arguments),null!=this.cssText&&(this.element.style.cssText=this.cssText),this.hiding=!1,this.showing=!1,this}});Element.Properties.reveal={set:function(n){return this.get("reveal").cancel().setOptions(n),this},get:function(){var n=this.retrieve("reveal");return n||(n=new Fx.Reveal(this),this.store("reveal",n)),n}};Element.Properties.dissolve=Element.Properties.reveal;Element.implement({reveal:function(n){return this.get("reveal").setOptions(n).reveal(),this},dissolve:function(n){return this.get("reveal").setOptions(n).dissolve(),this},nix:function(n){var t=Array.link(arguments,{destroy:Type.isBoolean,options:Type.isObject});return this.get("reveal").setOptions(n).dissolve().chain(function(){this[t.destroy?"destroy":"dispose"]()}.bind(this)),this},wink:function(){var n=Array.link(arguments,{duration:Type.isNumber,options:Type.isObject}),t=this.get("reveal").setOptions(n.options);t.reveal().chain(function(){(function(){t.dissolve()}).delay(n.duration||2e3)})}})}(),Form.Request.Append=new Class({Extends:Form.Request,options:{useReveal:!0,revealOptions:{},inject:"bottom"},makeRequest:function(){this.request=new Request.HTML(Object.merge({url:this.element.get("action"),method:this.element.get("method")||"post",spinnerTarget:this.element},this.options.requestOptions,{evalScripts:!1})).addEvents({success:function(n,t,i,r){var u,f=Elements.from(i),e;u=1==f.length?f[0]:new Element("div",{styles:{display:"none"}}).adopt(f);u.inject(this.target,this.options.inject);this.options.requestOptions.evalScripts&&Browser.exec(r);this.fireEvent("beforeEffect",u);e=function(){this.fireEvent("success",[u,this.target,n,t,i,r])}.bind(this);this.options.useReveal?(u.set("reveal",this.options.revealOptions).get("reveal").chain(e),u.reveal()):e()}.bind(this),failure:function(n){this.fireEvent("failure",n)}.bind(this)});this.attachReset()}}),function(){var t=function(n){return null!=n},n=Object.prototype.hasOwnProperty;Object.extend({getFromPath:function(t,i){"string"==typeof i&&(i=i.split("."));for(var r=0,u=i.length;u>r;r++){if(!n.call(t,i[r]))return null;t=t[i[r]]}return t},cleanValues:function(n,i){i=i||t;for(var r in n)i(n[r])||delete n[r];return n},erase:function(t,i){return n.call(t,i)&&delete t[i],t},run:function(n){var i=Array.slice(arguments,1),t;for(t in n)n[t].apply&&n[t].apply(n,i);return n}})}(),function(){var t=null,n={},r=function(t){return instanceOf(t,i.Set)?t:n[t]},i=this.Locale={define:function(r,u,f,e){var o;return instanceOf(r,i.Set)?(o=r.name,o&&(n[o]=r)):(o=r,n[o]||(n[o]=new i.Set(o)),r=n[o]),u&&r.define(u,f,e),t||(t=r),r},use:function(n){return n=r(n),n&&(t=n,this.fireEvent("change",n)),this},getCurrent:function(){return t},get:function(n,i){return t?t.get(n,i):""},inherit:function(n,t,i){return n=r(n),n&&n.inherit(t,i),this},list:function(){return Object.keys(n)}};Object.append(i,new Events);i.Set=new Class({sets:{},inherits:{locales:[],sets:{}},initialize:function(n){this.name=n||""},define:function(n,t,i){var r=this.sets[n];return r||(r={}),t&&("object"==typeOf(t)?r=Object.merge(r,t):r[t]=i),this.sets[n]=r,this},get:function(t,i,r){var u=Object.getFromPath(this.sets,t),o,f,c,s;if(null!=u)return o=typeOf(u),"function"==o?u=u.apply(null,Array.convert(i)):"object"==o&&(u=Object.clone(u)),u;var h=t.indexOf("."),l=0>h?t:t.substr(0,h),e=(this.inherits.sets[l]||[]).combine(this.inherits.locales).include("en-US");for(r||(r=[]),f=0,c=e.length;c>f;f++)if(!r.contains(e[f])&&(r.include(e[f]),s=n[e[f]],s&&(u=s.get(t,i,r),null!=u)))return u;return""},inherit:function(n,t){n=Array.convert(n);t&&!this.inherits.sets[t]&&(this.inherits.sets[t]=[]);for(var i=n.length;i--;)(t?this.inherits.sets[t]:this.inherits.locales).unshift(n[i]);return this}})}(),Locale.define("en-US","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],months_abbr:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],days_abbr:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dateOrder:["month","date","year"],shortDate:"%m/%d/%Y",shortTime:"%I:%M%p",AM:"AM",PM:"PM",firstDayOfWeek:0,ordinal:function(n){return n>3&&21>n?"th":["th","st","nd","rd","th"][Math.min(n%10,4)]},lessThanMinuteAgo:"less than a minute ago",minuteAgo:"about a minute ago",minutesAgo:"{delta} minutes ago",hourAgo:"about an hour ago",hoursAgo:"about {delta} hours ago",dayAgo:"1 day ago",daysAgo:"{delta} days ago",weekAgo:"1 week ago",weeksAgo:"{delta} weeks ago",monthAgo:"1 month ago",monthsAgo:"{delta} months ago",yearAgo:"1 year ago",yearsAgo:"{delta} years ago",lessThanMinuteUntil:"less than a minute from now",minuteUntil:"about a minute from now",minutesUntil:"{delta} minutes from now",hourUntil:"about an hour from now",hoursUntil:"about {delta} hours from now",dayUntil:"1 day from now",daysUntil:"{delta} days from now",weekUntil:"1 week from now",weeksUntil:"{delta} weeks from now",monthUntil:"1 month from now",monthsUntil:"{delta} months from now",yearUntil:"1 year from now",yearsUntil:"{delta} years from now"}),function(){var n=this.Date,r=n.Methods={ms:"Milliseconds",year:"FullYear",min:"Minutes",mo:"Month",sec:"Seconds",hr:"Hours"},t;["Date","Day","FullYear","Hours","Milliseconds","Minutes","Month","Seconds","Time","TimezoneOffset","Week","Timezone","GMTOffset","DayOfYear","LastMonth","LastDayOfMonth","UTCDate","UTCDay","UTCFullYear","AMPM","Ordinal","UTCHours","UTCMilliseconds","UTCMinutes","UTCMonth","UTCSeconds","UTCMilliseconds"].each(function(t){n.Methods[t.toLowerCase()]=t});t=function(n,i,r){return 1==i?n:n<Math.pow(10,i-1)?(r||"0")+t(n,i-1,r):n};n.implement({set:function(n,t){n=n.toLowerCase();var i=r[n]&&"set"+r[n];return i&&this[i]&&this[i](t),this}.overloadSetter(),get:function(n){n=n.toLowerCase();var t=r[n]&&"get"+r[n];return t&&this[t]?this[t]():null}.overloadGetter(),clone:function(){return new n(this.get("time"))},increment:function(t,i){switch(t=t||"day",i=null!=i?i:1,t){case"year":return this.increment("month",12*i);case"month":var r=this.get("date");return this.set("date",1).set("mo",this.get("mo")+i),this.set("date",r.min(this.get("lastdayofmonth")));case"week":return this.increment("day",7*i);case"day":return this.set("date",this.get("date")+i)}if(!n.units[t])throw new Error(t+" is not a supported interval");return this.set("time",this.get("time")+i*n.units[t]())},decrement:function(n,t){return this.increment(n,-1*(null!=t?t:1))},isLeapYear:function(){return n.isLeapYear(this.get("year"))},clearTime:function(){return this.set({hr:0,min:0,sec:0,ms:0})},diff:function(t,i){return"string"==typeOf(t)&&(t=n.parse(t)),((t-this)/n.units[i||"day"](3,3)).round()},getLastDayOfMonth:function(){return n.daysInMonth(this.get("mo"),this.get("year"))},getDayOfYear:function(){return(n.UTC(this.get("year"),this.get("mo"),this.get("date")+1)-n.UTC(this.get("year"),0,1))/n.units.day()},setDay:function(t,i){null==i&&(i=n.getMsg("firstDayOfWeek"),""===i&&(i=1));t=(7+n.parseDay(t,!0)-i)%7;var r=(7+this.get("day")-i)%7;return this.increment("day",t-r)},getWeek:function(t){var e,o;null==t&&(t=n.getMsg("firstDayOfWeek"),""===t&&(t=1));var u,i=this,f=(7+i.get("day")-t)%7,r=0;if(1==t){if(e=i.get("month"),o=i.get("date")-f,11==e&&o>28)return 1;0==e&&-2>o&&(i=new n(i).decrement("day",f),f=0);u=new n(i.get("year"),0,1).get("day")||7;u>4&&(r=-7)}else u=new n(i.get("year"),0,1).get("day");return r+=i.get("dayofyear"),r+=6-f,r+=(7+u-t)%7,r/7},getOrdinal:function(t){return n.getMsg("ordinal",t||this.get("date"))},getTimezone:function(){return this.toString().replace(/^.*? ([A-Z]{3}).[0-9]{4}.*$/,"$1").replace(/^.*?\(([A-Z])[a-z]+ ([A-Z])[a-z]+ ([A-Z])[a-z]+\)$/,"$1$2$3")},getGMTOffset:function(){var n=this.get("timezoneOffset");return(n>0?"-":"+")+t((n.abs()/60).floor(),2)+t(n%60,2)},setAMPM:function(n){n=n.toUpperCase();var t=this.get("hr");return t>11&&"AM"==n?this.decrement("hour",12):12>t&&"PM"==n?this.increment("hour",12):this},getAMPM:function(){return this.get("hr")<12?"AM":"PM"},parse:function(t){return this.set("time",n.parse(t)),this},isValid:function(n){return n||(n=this),"date"==typeOf(n)&&!isNaN(n.valueOf())},format:function(i){if(!this.isValid())return"invalid date";if(i||(i="%x %X"),"string"==typeof i&&(i=h[i.toLowerCase()]||i),"function"==typeof i)return i(this);var r=this;return i.replace(/%([a-z%])/gi,function(i,u){switch(u){case"a":return n.getMsg("days_abbr")[r.get("day")];case"A":return n.getMsg("days")[r.get("day")];case"b":return n.getMsg("months_abbr")[r.get("month")];case"B":return n.getMsg("months")[r.get("month")];case"c":return r.format("%a %b %d %H:%M:%S %Y");case"d":return t(r.get("date"),2);case"e":return t(r.get("date"),2," ");case"H":return t(r.get("hr"),2);case"I":return t(r.get("hr")%12||12,2);case"j":return t(r.get("dayofyear"),3);case"k":return t(r.get("hr"),2," ");case"l":return t(r.get("hr")%12||12,2," ");case"L":return t(r.get("ms"),3);case"m":return t(r.get("mo")+1,2);case"M":return t(r.get("min"),2);case"o":return r.get("ordinal");case"p":return n.getMsg(r.get("ampm"));case"s":return Math.round(r/1e3);case"S":return t(r.get("seconds"),2);case"T":return r.format("%H:%M:%S");case"U":return t(r.get("week"),2);case"w":return r.get("day");case"x":return r.format(n.getMsg("shortDate"));case"X":return r.format(n.getMsg("shortTime"));case"y":return r.get("year").toString().substr(2);case"Y":return r.get("year");case"z":return r.get("GMTOffset");case"Z":return r.get("Timezone")}return u})},toISOString:function(){return this.format("iso8601")}}).alias({toJSON:"toISOString",compare:"diff",strftime:"format"});var o=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],s=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],h={db:"%Y-%m-%d %H:%M:%S",compact:"%Y%m%dT%H%M%S",short:"%d %b %H:%M",long:"%B %d, %Y %H:%M",rfc822:function(n){return o[n.get("day")]+n.format(", %d ")+s[n.get("month")]+n.format(" %Y %H:%M:%S %Z")},rfc2822:function(n){return o[n.get("day")]+n.format(", %d ")+s[n.get("month")]+n.format(" %Y %H:%M:%S %z")},iso8601:function(n){return n.getUTCFullYear()+"-"+t(n.getUTCMonth()+1,2)+"-"+t(n.getUTCDate(),2)+"T"+t(n.getUTCHours(),2)+":"+t(n.getUTCMinutes(),2)+":"+t(n.getUTCSeconds(),2)+"."+t(n.getUTCMilliseconds(),3)+"Z"}},u=[],p=n.parse,c=function(t,i,r){var u=-1,f=n.getMsg(t+"s"),e;switch(typeOf(i)){case"object":u=f[i.get(t)];break;case"number":if(u=f[i],!u)throw new Error("Invalid "+t+" index: "+i);break;case"string":if(e=f.filter(function(n){return this.test(n)},new RegExp("^"+i,"i")),!e.length)throw new Error("Invalid "+t+" string");if(e.length>1)throw new Error("Ambiguous "+t);u=e[0]}return r?f.indexOf(u):u},l=1900,e=70;n.extend({getMsg:function(n,t){return Locale.get("Date."+n,t)},units:{ms:Function.convert(1),second:Function.convert(1e3),minute:Function.convert(6e4),hour:Function.convert(36e5),day:Function.convert(864e5),week:Function.convert(6084e5),month:function(t,i){var r=new n;return 864e5*n.daysInMonth(null!=t?t:r.get("mo"),null!=i?i:r.get("year"))},year:function(t){return t=t||(new n).get("year"),n.isLeapYear(t)?316224e5:31536e6}},daysInMonth:function(t,i){return[31,n.isLeapYear(i)?29:28,31,30,31,30,31,31,30,31,30,31][t]},isLeapYear:function(n){return n%4==0&&n%100!=0||n%400==0},parse:function(t){var r=typeOf(t),i;return"number"==r?new n(t):"string"!=r?t:(t=t.clean(),!t.length)?null:(u.some(function(n){var r=n.re.exec(t);return r?i=n.handler(r):!1}),i&&i.isValid()||(i=new n(p(t)),i&&i.isValid()||(i=new n(t.toInt()))),i)},parseDay:function(n,t){return c("day",n,t)},parseMonth:function(n,t){return c("month",n,t)},parseUTC:function(t){var i=new n(t),r=n.UTC(i.get("year"),i.get("mo"),i.get("date"),i.get("hr"),i.get("min"),i.get("sec"),i.get("ms"));return new n(r)},orderIndex:function(t){return n.getMsg("dateOrder").indexOf(t)+1},defineFormat:function(n,t){return h[n]=t,this},defineParser:function(n){return u.push(n.re&&n.handler?n:y(n)),this},defineParsers:function(){return Array.flatten(arguments).each(n.defineParser),this},define2DigitYearStart:function(n){return e=n%100,l=n-e,this}}).extend({defineFormats:n.defineFormat.overloadSetter()});var a=function(t){return new RegExp("(?:"+n.getMsg(t).map(function(n){return n.substr(0,3)}).join("|")+")[a-z]*")},w=function(t){switch(t){case"T":return"%H:%M:%S";case"x":return(1==n.orderIndex("month")?"%m[-./]%d":"%d[-./]%m")+"([-./]%y)?";case"X":return"%H([.:]%M)?([.:]%S([.:]%s)?)? ?%p? ?%z?"}return null},i={d:/[0-2]?[0-9]|3[01]/,H:/[01]?[0-9]|2[0-3]/,I:/0?[1-9]|1[0-2]/,M:/[0-5]?\d/,s:/\d+/,o:/[a-z]*/,p:/[ap]\.?m\.?/,y:/\d{2}|\d{4}/,Y:/\d{4}/,z:/Z|[+-]\d{2}(?::?\d{2})?/};i.m=i.I;i.S=i.M;var v,b=function(n){v=n;i.a=i.A=a("days");i.b=i.B=a("months");u.each(function(n,t){n.format&&(u[t]=y(n.format))})},y=function(t){if(!v)return{format:t};var r=[],u=(t.source||t).replace(/%([a-z])/gi,function(n,t){return w(t)||n}).replace(/\((?!\?)/g,"(?:").replace(/ (?!\?|\*)/g,",? ").replace(/%([a-z%])/gi,function(n,t){var u=i[t];return u?(r.push(t),"("+u.source+")"):t}).replace(/\[a-z\]/gi,"[a-z\\u00c0-\\uffff;&]");return{format:t,re:new RegExp("^"+u+"$","i"),handler:function(t){var i,u,e;t=t.slice(1).associate(r);i=(new n).clearTime();u=t.y||t.Y;null!=u&&f.call(i,"y",u);"d"in t&&f.call(i,"d",1);("m"in t||t.b||t.B)&&f.call(i,"m",1);for(e in t)f.call(i,e,t[e]);return i}}},f=function(t,i){if(!i)return this;switch(t){case"a":case"A":return this.set("day",n.parseDay(i,!0));case"b":case"B":return this.set("mo",n.parseMonth(i,!0));case"d":return this.set("date",i);case"H":case"I":return this.set("hr",i);case"m":return this.set("mo",i-1);case"M":return this.set("min",i);case"p":return this.set("ampm",i.replace(/\./g,""));case"S":return this.set("sec",i);case"s":return this.set("ms",1e3*("0."+i));case"w":return this.set("day",i);case"Y":return this.set("year",i);case"y":return i=+i,100>i&&(i+=l+(e>i?100:0)),this.set("year",i);case"z":"Z"==i&&(i="+00");var r=i.match(/([+-])(\d{2}):?(\d{2})?/);return r=(r[1]+"1")*(60*r[2]+(+r[3]||0))+this.getTimezoneOffset(),this.set("time",this-6e4*r)}return this};n.defineParsers("%Y([-./]%m([-./]%d((T| )%X)?)?)?","%Y%m%d(T%H(%M%S?)?)?","%x( %X)?","%d%o( %b( %Y)?)?( %X)?","%b( %d%o)?( %Y)?( %X)?","%Y %b( %d%o( %X)?)?","%o %b %d %X %z %Y","%T","%H:%M( ?%p)?");Locale.addEvent("change",function(n){Locale.get("Date")&&b(n)}).fireEvent("change",Locale.getCurrent())}(),Locale.define("en-US","FormValidator",{required:"This field is required.",length:"Please enter {length} characters (you entered {elLength} characters)",minLength:"Please enter at least {minLength} characters (you entered {length} characters).",maxLength:"Please enter no more than {maxLength} characters (you entered {length} characters).",integer:"Please enter an integer in this field. Numbers with decimals (e.g. 1.25) are not permitted.",numeric:'Please enter only numeric values in this field (i.e. "1" or "1.1" or "-1" or "-1.1").',digits:"Please use numbers and punctuation only in this field (for example, a phone number with dashes or dots is permitted).",alpha:"Please use only letters (a-z) within this field. No spaces or other characters are allowed.",alphanum:"Please use only letters (a-z) or numbers (0-9) in this field. No spaces or other characters are allowed.",dateSuchAs:"Please enter a valid date such as {date}",dateInFormatMDY:'Please enter a valid date such as MM/DD/YYYY (i.e. "12/31/1999")',email:'Please enter a valid email address. For example "fred@domain.com".',url:"Please enter a valid URL such as http://www.example.com.",currencyDollar:"Please enter a valid $ amount. For example $100.00 .",oneRequired:"Please enter something for at least one of these inputs.",errorPrefix:"Error: ",warningPrefix:"Warning: ",noSpace:"There can be no spaces in this input.",reqChkByNode:"No items are selected.",requiredChk:"This field is required.",reqChkByName:"Please select a {label}.",match:"This field needs to match the {matchName} field",startDate:"the start date",endDate:"the end date",currentDate:"the current date",afterDate:"The date should be the same or after {label}.",beforeDate:"The date should be the same or before {label}.",startMonth:"Please select a start month",sameMonth:"These two dates must be in the same month - you must change one or the other.",creditcard:"The credit card number entered is invalid. Please check the number and try again. {length} digits entered."}),window.Form||(window.Form={}),InputValidator=this.InputValidator=new Class({Implements:[Options],options:{errorMsg:"Validation failed.",test:Function.convert(!0)},initialize:function(n,t){this.setOptions(t);this.className=n},test:function(n,t){return n=document.id(n),n?this.options.test(n,t||this.getProps(n)):!1},getError:function(n,t){n=document.id(n);var i=this.options.errorMsg;return"function"==typeOf(i)&&(i=i(n,t||this.getProps(n))),i},getProps:function(n){return n=document.id(n),n?n.get("validatorProps"):{}}}),Element.Properties.validators={get:function(){return(this.get("data-validators")||this.className).clean().replace(/'(\\.|[^'])*'|"(\\.|[^"])*"/g,function(n){return n.replace(" ","\\x20")}).split(" ")}},Element.Properties.validatorProps={set:function(n){return this.eliminate("$moo:validatorProps").store("$moo:validatorProps",n)},get:function(n){if(n&&this.set(n),this.retrieve("$moo:validatorProps"))return this.retrieve("$moo:validatorProps");if(this.getProperty("data-validator-properties")||this.getProperty("validatorProps"))try{this.store("$moo:validatorProps",JSON.decode(this.getProperty("validatorProps")||this.getProperty("data-validator-properties"),!1))}catch(i){return{}}else{var t=this.get("validators").filter(function(n){return n.test(":")});t.length?(n={},t.each(function(t){var i=t.split(":");if(i[1])try{n[i[0]]=JSON.decode(i[1],!1)}catch(r){}}),this.store("$moo:validatorProps",n)):this.store("$moo:validatorProps",{})}return this.retrieve("$moo:validatorProps")}},Form.Validator=new Class({Implements:[Options,Events],options:{fieldSelectors:"input, select, textarea",ignoreHidden:!0,ignoreDisabled:!0,useTitles:!1,evaluateOnSubmit:!0,evaluateFieldsOnBlur:!0,evaluateFieldsOnChange:!0,serial:!0,stopOnFailure:!0,warningPrefix:function(){return Form.Validator.getMsg("warningPrefix")||"Warning: "},errorPrefix:function(){return Form.Validator.getMsg("errorPrefix")||"Error: "}},initialize:function(n,t){this.setOptions(t);this.element=document.id(n);this.warningPrefix=Function.convert(this.options.warningPrefix)();this.errorPrefix=Function.convert(this.options.errorPrefix)();this._bound={onSubmit:this.onSubmit.bind(this),blurOrChange:function(n,t){this.validationMonitor(t,!0)}.bind(this)};this.enable()},toElement:function(){return this.element},getFields:function(){return this.fields=this.element.getElements(this.options.fieldSelectors)},enable:function(){this.element.store("validator",this);this.options.evaluateOnSubmit&&this.element.addEvent("submit",this._bound.onSubmit);this.options.evaluateFieldsOnBlur&&this.element.addEvent("blur:relay(input,select,textarea)",this._bound.blurOrChange);this.options.evaluateFieldsOnChange&&this.element.addEvent("change:relay(input,select,textarea)",this._bound.blurOrChange)},disable:function(){this.element.eliminate("validator");this.element.removeEvents({submit:this._bound.onSubmit,"blur:relay(input,select,textarea)":this._bound.blurOrChange,"change:relay(input,select,textarea)":this._bound.blurOrChange})},validationMonitor:function(){clearTimeout(this.timer);this.timer=this.validateField.delay(50,this,arguments)},onSubmit:function(n){this.validate(n)&&this.reset()},reset:function(){return this.getFields().each(this.resetField,this),this},validate:function(n){var t=this.getFields().map(function(n){return this.validateField(n,!0)},this).every(function(n){return n});return this.fireEvent("formValidate",[t,this.element,n]),this.options.stopOnFailure&&!t&&n&&n.preventDefault(),t},validateField:function(n,t){var u,e,i;if(this.paused)return!0;if(n=document.id(n),i=!n.hasClass("validation-failed"),this.options.serial&&!t&&(u=this.element.getElement(".validation-failed"),e=this.element.getElement(".warning")),n&&(!u||t||n.hasClass("validation-failed")||u&&!this.options.serial)){var r=n.get("validators"),o=r.some(function(n){return this.getValidator(n)},this),f=[];(r.each(function(t){t&&!this.test(t,n)&&f.include(t)},this),i=0===f.length,o&&!this.hasValidator(n,"warnOnly")&&(i?(n.addClass("validation-passed").removeClass("validation-failed"),this.fireEvent("elementPass",[n])):(n.addClass("validation-failed").removeClass("validation-passed"),this.fireEvent("elementFail",[n,f]))),e)||(r.some(function(n){return n.test("^warn")?this.getValidator(n.replace(/^warn-/,"")):null},this),n.removeClass("warning"),r.map(function(t){return t.test("^warn")?this.test(t.replace(/^warn-/,""),n,!0):null},this))}return i},test:function(n,t,i){var r,u;return(t=document.id(t),this.options.ignoreHidden&&!t.isVisible()||this.options.ignoreDisabled&&t.get("disabled"))?!0:(r=this.getValidator(n),null!=i&&(i=!1),this.hasValidator(t,"warnOnly")&&(i=!0),u=t.hasClass("ignoreValidation")||(r?r.test(t):!0),r&&this.fireEvent("elementValidate",[u,t,n,i]),i?!0:u)},hasValidator:function(n,t){return n.get("validators").contains(t)},resetField:function(n){return n=document.id(n),n&&n.get("validators").each(function(t){t.test("^warn-")&&(t=t.replace(/^warn-/,""));n.removeClass("validation-failed");n.removeClass("warning");n.removeClass("validation-passed")},this),this},stop:function(){return this.paused=!0,this},start:function(){return this.paused=!1,this},ignoreField:function(n,t){return n=document.id(n),n&&(this.enforceField(n),t?n.addClass("warnOnly"):n.addClass("ignoreValidation")),this},enforceField:function(n){return n=document.id(n),n&&n.removeClass("warnOnly").removeClass("ignoreValidation"),this}}),Form.Validator.getMsg=function(n){return Locale.get("FormValidator."+n)},Form.Validator.adders={validators:{},add:function(n,t){this.validators[n]=new InputValidator(n,t);this.initialize||this.implement({validators:this.validators})},addAllThese:function(n){Array.convert(n).each(function(n){this.add(n[0],n[1])},this)},getValidator:function(n){return this.validators[n.split(":")[0]]}},Object.append(Form.Validator,Form.Validator.adders),Form.Validator.implement(Form.Validator.adders),Form.Validator.add("IsEmpty",{errorMsg:!1,test:function(n){return"select-one"==n.type||"select"==n.type?!(n.selectedIndex>=0&&""!=n.options[n.selectedIndex].value):null==n.get("value")||0==n.get("value").length}}),Form.Validator.addAllThese([["required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(n){return!Form.Validator.getValidator("IsEmpty").test(n)}}],["length",{errorMsg:function(n,t){return"null"!=typeOf(t.length)?Form.Validator.getMsg("length").substitute({length:t.length,elLength:n.get("value").length}):""},test:function(n,t){return"null"!=typeOf(t.length)?n.get("value").length==t.length||0==n.get("value").length:!0}}],["minLength",{errorMsg:function(n,t){return"null"!=typeOf(t.minLength)?Form.Validator.getMsg("minLength").substitute({minLength:t.minLength,length:n.get("value").length}):""},test:function(n,t){return"null"!=typeOf(t.minLength)?n.get("value").length>=(t.minLength||0):!0}}],["maxLength",{errorMsg:function(n,t){return"null"!=typeOf(t.maxLength)?Form.Validator.getMsg("maxLength").substitute({maxLength:t.maxLength,length:n.get("value").length}):""},test:function(n,t){return n.get("value").length<=(t.maxLength||1e4)}}],["validate-integer",{errorMsg:Form.Validator.getMsg.pass("integer"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^(-?[1-9]\d*|0)$/.test(n.get("value"))}}],["validate-numeric",{errorMsg:Form.Validator.getMsg.pass("numeric"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^-?(?:0$0(?=\d*\.)|[1-9]|0)\d*(\.\d+)?$/.test(n.get("value"))}}],["validate-digits",{errorMsg:Form.Validator.getMsg.pass("digits"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^[\d() .:\-\+#]+$/.test(n.get("value"))}}],["validate-alpha",{errorMsg:Form.Validator.getMsg.pass("alpha"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^[a-zA-Z]+$/.test(n.get("value"))}}],["validate-alphanum",{errorMsg:Form.Validator.getMsg.pass("alphanum"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||!/\W/.test(n.get("value"))}}],["validate-date",{errorMsg:function(n,t){if(Date.parse){var i=t.dateFormat||"%x";return Form.Validator.getMsg("dateSuchAs").substitute({date:(new Date).format(i)})}return Form.Validator.getMsg("dateInFormatMDY")},test:function(n,t){var r,s,u;if(Form.Validator.getValidator("IsEmpty").test(n))return!0;var i=Locale.get("Date"),f=new RegExp([i.days,i.days_abbr,i.months,i.months_abbr,i.AM,i.PM].flatten().join("|"),"i"),e=n.get("value"),o=e.match(/[a-z]+/gi);return o&&!o.every(f.exec,f)?!1:(r=Date.parse(e),!r)?!1:(s=t.dateFormat||"%x",u=r.format(s),"invalid date"!=u&&n.set("value",u),r.isValid())}}],["validate-email",{errorMsg:Form.Validator.getMsg.pass("email"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^(?:[a-z0-9!#$%&'*+\/=?^_`{|}~-]\.?){0,63}[a-z0-9!#$%&'*+\/=?^_`{|}~-]@(?:(?:[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?\.)*[a-z0-9](?:[a-z0-9-]{0,61}[a-z0-9])?|\[(?:(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\.){3}(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\])$/i.test(n.get("value"))}}],["validate-url",{errorMsg:Form.Validator.getMsg.pass("url"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^(https?|ftp|rmtp|mms):\/\/(([A-Z0-9][A-Z0-9_-]*)(\.[A-Z0-9][A-Z0-9_-]*)+)(:(\d+))?\/?/i.test(n.get("value"))}}],["validate-currency-dollar",{errorMsg:Form.Validator.getMsg.pass("currencyDollar"),test:function(n){return Form.Validator.getValidator("IsEmpty").test(n)||/^\$?\-?([1-9]{1}[0-9]{0,2}(\,[0-9]{3})*(\.[0-9]{0,2})?|[1-9]{1}\d*(\.[0-9]{0,2})?|0(\.[0-9]{0,2})?|(\.[0-9]{1,2})?)$/.test(n.get("value"))}}],["validate-one-required",{errorMsg:Form.Validator.getMsg.pass("oneRequired"),test:function(n,t){var i=document.id(t["validate-one-required"])||n.getParent(t["validate-one-required"]);return i.getElements("input").some(function(n){return["checkbox","radio"].contains(n.get("type"))?n.get("checked"):n.get("value")})}}]]),Element.Properties.validator={set:function(n){this.get("validator").setOptions(n)},get:function(){var n=this.retrieve("validator");return n||(n=new Form.Validator(this),this.store("validator",n)),n}},Element.implement({validate:function(n){return n&&this.set("validator",n),this.get("validator").validate()}}),function(){function n(n,t,i,r){if(t&&n[t])return n[t];var u=document.id(n[i]);return u?u.getElements(r):[]}Form.Validator.addAllThese([["validate-enforce-oncheck",{test:function(t,i){var r=t.getParent("form").retrieve("validator");return r?(n(i,"toEnforce","enforceChildrenOf","input, select, textarea").each(function(n){t.checked?r.enforceField(n):(r.ignoreField(n),r.resetField(n))}),!0):!0}}],["validate-ignore-oncheck",{test:function(t,i){var r=t.getParent("form").retrieve("validator");return r?(n(i,"toIgnore","ignoreChildrenOf","input, select, textarea").each(function(n){t.checked?(r.ignoreField(n),r.resetField(n)):r.enforceField(n)}),!0):!0}}],["validate-enforce-onselect-value",{test:function(t,i){if(!i.value)return!0;var r=t.getParent("form").retrieve("validator");return r?(n(i,"toEnforce","enforceChildrenOf","input, select, textarea").each(function(n){i.value==t.value?r.enforceField(n):(r.ignoreField(n),r.resetField(n))}),!0):!0}}],["validate-nospace",{errorMsg:function(){return Form.Validator.getMsg("noSpace")},test:function(n){return!n.get("value").test(/\s/)}}],["validate-toggle-oncheck",{test:function(t,i){var r=t.getParent("form").retrieve("validator"),u;return r?(u=n(i,"toToggle","toToggleChildrenOf","input, select, textarea"),t.checked?u.each(function(n){r.enforceField(n)}):u.each(function(n){r.ignoreField(n);r.resetField(n)}),!0):!0}}],["validate-reqchk-bynode",{errorMsg:function(){return Form.Validator.getMsg("reqChkByNode")},test:function(t,i){return n(i,!1,"nodeId",i.selector||"input[type=checkbox], input[type=radio]").some(function(n){return n.checked})}}],["validate-required-check",{errorMsg:function(n,t){return t.useTitle?n.get("title"):Form.Validator.getMsg("requiredChk")},test:function(n){return!!n.checked}}],["validate-reqchk-byname",{errorMsg:function(n,t){return Form.Validator.getMsg("reqChkByName").substitute({label:t.label||n.get("type")})},test:function(n,t){var f=t.groupName||n.get("name"),i=$$("[name="+f+"]"),r=i.some(function(n){return n.checked}),u=n.getParent("form").retrieve("validator");return r&&u&&i.each(function(n){u.resetField(n)}),r}}],["validate-match",{errorMsg:function(n,t){return Form.Validator.getMsg("match").substitute({matchName:decodeURIComponent((t.matchName+"").replace(/\+/g,"%20"))||document.id(t.matchInput).get("name")})},test:function(n,t){var i=n.get("value"),r=document.id(t.matchInput)&&document.id(t.matchInput).get("value");return i&&r?i==r:!0}}],["validate-after-date",{errorMsg:function(n,t){return Form.Validator.getMsg("afterDate").substitute({label:t.afterLabel||(t.afterElement?Form.Validator.getMsg("startDate"):Form.Validator.getMsg("currentDate"))})},test:function(n,t){var i=document.id(t.afterElement)?Date.parse(document.id(t.afterElement).get("value")):new Date,r=Date.parse(n.get("value"));return r&&i?r>=i:!0}}],["validate-before-date",{errorMsg:function(n,t){return Form.Validator.getMsg("beforeDate").substitute({label:t.beforeLabel||(t.beforeElement?Form.Validator.getMsg("endDate"):Form.Validator.getMsg("currentDate"))})},test:function(n,t){var i=Date.parse(n.get("value")),r=document.id(t.beforeElement)?Date.parse(document.id(t.beforeElement).get("value")):new Date;return r&&i?r>=i:!0}}],["validate-custom-required",{errorMsg:function(){return Form.Validator.getMsg("required")},test:function(n,t){return n.get("value")!=t.emptyValue}}],["validate-same-month",{errorMsg:function(n,t){var i=document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value"),r=n.get("value");if(""!=r)return Form.Validator.getMsg(i?"sameMonth":"startMonth")},test:function(n,t){var i=Date.parse(n.get("value")),r=Date.parse(document.id(t.sameMonthAs)&&document.id(t.sameMonthAs).get("value"));return i&&r?i.format("%B")==r.format("%B"):!0}}],["validate-cc-num",{errorMsg:function(n){var t=n.get("value").replace(/[^0-9]/g,"");return Form.Validator.getMsg("creditcard").substitute({length:t.length})},test:function(n){var t,r,f;if(Form.Validator.getValidator("IsEmpty").test(n))return!0;if(t=n.get("value"),t=t.replace(/[^0-9]/g,""),r=!1,t.test(/^4[0-9]{12}([0-9]{3})?$/)?r="Visa":t.test(/^5[1-5]([0-9]{14})$/)?r="Master Card":t.test(/^3[47][0-9]{13}$/)?r="American Express":t.test(/^6(?:011|5[0-9]{2})[0-9]{12}$/)?r="Discover":t.test(/^3(?:0[0-5]|[68][0-9])[0-9]{11}$/)&&(r="Diners Club"),r){for(var e=0,i=0,u=t.length-1;u>=0;--u)i=t.charAt(u).toInt(),0!=i&&((t.length-u)%2==0&&(i+=i),i>9&&(i=i.toString().charAt(0).toInt()+i.toString().charAt(1).toInt()),e+=i);if(e%10==0)return!0}for(f="";""!=t;)f+=" "+t.substr(0,4),t=t.substr(4);return n.getParent("form").retrieve("validator").ignoreField(n),n.set("value",f.clean()),n.getParent("form").retrieve("validator").enforceField(n),!1}}]])}(),Form.Validator.Inline=new Class({Extends:Form.Validator,options:{showError:function(n){n.reveal?n.reveal():n.setStyle("display","block")},hideError:function(n){n.dissolve?n.dissolve():n.setStyle("display","none")},scrollToErrorsOnSubmit:!0,scrollToErrorsOnBlur:!1,scrollToErrorsOnChange:!1,scrollFxOptions:{transition:"quad:out",offset:{y:-20}}},initialize:function(n,t){this.parent(n,t);this.addEvent("onElementValidate",function(n,t,i,r){var u=this.getValidator(i),f;!n&&u.getError(t)?(r&&t.addClass("warning"),f=this.makeAdvice(i,t,u.getError(t),r),this.insertAdvice(f,t),this.showAdvice(i,t)):this.hideAdvice(i,t)})},makeAdvice:function(n,t,i,r){var f=r?this.warningPrefix:this.errorPrefix,e,u;return f+=this.options.useTitles?t.title||i:i,e=r?"warning-advice":"validation-advice",u=this.getAdvice(n,t),u=u?u.set("html",f):new Element("div",{html:f,styles:{display:"none"},id:"advice-"+n.split(":")[0]+"-"+this.getFieldId(t)}).addClass(e),t.store("$moo:advice-"+n,u),u},getFieldId:function(n){return n.id?n.id:n.id="input_"+n.name},showAdvice:function(n,t){var i=this.getAdvice(n,t);!i||t.retrieve("$moo:"+this.getPropName(n))||"none"!=i.getStyle("display")&&"hidden"!=i.getStyle("visibility")&&0!=i.getStyle("opacity")||(t.store("$moo:"+this.getPropName(n),!0),this.options.showError(i),this.fireEvent("showAdvice",[t,i,n]))},hideAdvice:function(n,t){var i=this.getAdvice(n,t);i&&t.retrieve("$moo:"+this.getPropName(n))&&(t.store("$moo:"+this.getPropName(n),!1),this.options.hideError(i),this.fireEvent("hideAdvice",[t,i,n]))},getPropName:function(n){return"advice"+n},resetField:function(n){return(n=document.id(n))?(this.parent(n),n.get("validators").each(function(t){this.hideAdvice(t,n)},this),this):this},getAllAdviceMessages:function(n,t){var i=[];return n.hasClass("ignoreValidation")&&!t?i:(n.get("validators").some(function(t){var u=t.test("^warn-")||n.hasClass("warnOnly"),r;u&&(t=t.replace(/^warn-/,""));r=this.getValidator(t);r&&i.push({message:r.getError(n),warnOnly:u,passed:r.test(),validator:r})},this),i)},getAdvice:function(n,t){return t.retrieve("$moo:advice-"+n)},insertAdvice:function(n,t){var i=t.get("validatorProps");i.msgPos&&document.id(i.msgPos)?document.id(i.msgPos).grab(n):t.type&&"radio"==t.type.toLowerCase()?t.getParent().adopt(n):n.inject(document.id(t),"after")},validateField:function(n,t,i){var e=this.parent(n,t),f,r,u;if((this.options.scrollToErrorsOnSubmit&&null==i||i)&&!e){for(f=document.id(this).getElement(".validation-failed"),r=document.id(this).getParent();r!=document.body&&r.getScrollSize().y==r.getSize().y;)r=r.getParent();u=r.retrieve("$moo:fvScroller");!u&&window.Fx&&Fx.Scroll&&(u=new Fx.Scroll(r,this.options.scrollFxOptions),r.store("$moo:fvScroller",u));f&&(u?u.toElement(f):r.scrollTo(r.getScroll().x,f.getPosition(r).y-20))}return e},watchFields:function(n){n.each(function(n){this.options.evaluateFieldsOnBlur&&n.addEvent("blur",this.validationMonitor.pass([n,!1,this.options.scrollToErrorsOnBlur],this));this.options.evaluateFieldsOnChange&&n.addEvent("change",this.validationMonitor.pass([n,!0,this.options.scrollToErrorsOnChange],this))},this)}}),Fx.Elements=new Class({Extends:Fx.CSS,initialize:function(n,t){this.elements=this.subject=$$(n);this.parent(t)},compute:function(n,t,i){var f={},r,u;for(r in n){var e=n[r],o=t[r],s=f[r]={};for(u in e)s[u]=this.parent(e[u],o[u],i)}return f},set:function(n){var t,i,r;for(t in n)if(this.elements[t]){i=n[t];for(r in i)this.render(this.elements[t],r,i[r],this.options.unit)}return this},start:function(n){var r,u,t,i,f;if(!this.check(n))return this;r={};u={};for(t in n)if(this.elements[t]){var e=n[t],o=r[t]={},s=u[t]={};for(i in e)f=this.prepare(this.elements[t],i,e[i]),o[i]=f.from,s[i]=f.to}return this.parent(r,u)}}),Fx.Accordion=new Class({Extends:Fx.Elements,options:{fixedHeight:!1,fixedWidth:!1,display:0,show:!1,height:!0,width:!1,opacity:!0,alwaysHide:!1,trigger:"click",initialDisplayFx:!0,resetHeight:!0,keepOpen:!1},initialize:function(){var f=function(n){return null!=n},u=Array.link(arguments,{container:Type.isElement,options:Type.isObject,togglers:f,elements:f}),n,r,t,i,e;for(this.parent(u.elements,u.options),n=this.options,r=this.togglers=$$(u.togglers),this.previous=-1,this.internalChain=new Chain,n.alwaysHide&&(this.options.link="chain"),(n.show||0===this.options.show)&&(n.display=!1,this.previous=n.show),n.start&&(n.display=!1,n.show=!1),t=this.effects={},n.opacity&&(t.opacity="fullOpacity"),n.width&&(t.width=n.fixedWidth?"fullWidth":"offsetWidth"),n.height&&(t.height=n.fixedHeight?"fullHeight":"scrollHeight"),i=0,e=r.length;e>i;i++)this.addSection(r[i],this.elements[i]);this.elements.each(function(i,u){if(n.show===u)this.fireEvent("active",[r[u],i]);else for(var f in t)i.setStyle(f,0)},this);(n.display||0===n.display||n.initialDisplayFx===!1)&&this.display(n.display,n.initialDisplayFx);n.fixedHeight!==!1&&(n.resetHeight=!1);this.addEvent("complete",this.internalChain.callChain.bind(this.internalChain))},addSection:function(n,t){var f;n=document.id(n);t=document.id(t);this.togglers.include(n);this.elements.include(t);var r=this.togglers,i=this.options,e=r.contains(n),o=r.indexOf(n),u=this.display.pass(o,this);if(n.store("accordion:display",u).addEvent(i.trigger,u),i.height&&t.setStyles({"padding-top":0,"border-top":"none","padding-bottom":0,"border-bottom":"none"}),i.width&&t.setStyles({"padding-left":0,"border-left":"none","padding-right":0,"border-right":"none"}),t.fullOpacity=1,i.fixedWidth&&(t.fullWidth=i.fixedWidth),i.fixedHeight&&(t.fullHeight=i.fixedHeight),t.setStyle("overflow","hidden"),!e)for(f in this.effects)t.setStyle(f,0);return this},removeSection:function(n,t){var r=this.togglers,i=r.indexOf(n),f=this.elements[i],u=function(){r.erase(n);this.elements.erase(f);this.detach(n)}.bind(this);return this.now==i||null!=t?this.display(null!=t?t:i-1>=0?i-1:0).chain(u):u(),this},detach:function(n){var t=function(n){n.removeEvent(this.options.trigger,n.retrieve("accordion:display"))}.bind(this);return n?t(n):this.togglers.each(t),this},display:function(n,t){var e,s;if(!this.check(n,t))return this;var r={},u=this.elements,i=this.options,f=this.effects,o=i.keepOpen,h=i.alwaysHide;if(null==t&&(t=!0),"element"==typeOf(n)&&(n=u.indexOf(n)),n==this.current&&!h&&!o)return this;if(i.resetHeight&&(e=u[this.current],e&&!this.selfHidden))for(s in f)e.setStyle(s,e[f[s]]);return this.timer&&"chain"==i.link?this:(null!=this.current&&(this.previous=this.current),this.current=n,this.selfHidden=!1,u.each(function(u,e){var s,l,c;if(r[e]={},!o||e==n){e==n&&(l=u.offsetHeight>0&&i.height||u.offsetWidth>0&&i.width);e!=n?s=!0:(h||o)&&l&&(s=!0,this.selfHidden=!0);this.fireEvent(s?"background":"active",[this.togglers[e],u]);for(c in f)r[e][c]=s?0:u[f[c]];t||s||!i.resetHeight||(r[e].height="auto")}},this),this.internalChain.clearChain(),this.internalChain.chain(function(){if(i.resetHeight&&!this.selfHidden){var t=u[n];t&&t.setStyle("height","auto")}}.bind(this)),t?this.start(r):this.set(r).internalChain.callChain())}}),Fx.Move=new Class({Extends:Fx.Morph,options:{relativeTo:document.body,position:"center",edge:!1,offset:{x:0,y:0}},start:function(n){var t=this.element,i=t.getStyles("top","left");return("auto"==i.top||"auto"==i.left)&&t.setPosition(t.getPosition(t.getOffsetParent())),this.parent(t.position(Object.merge({},this.options,n,{returnPos:!0})))}}),Element.Properties.move={set:function(n){return this.get("move").cancel().setOptions(n),this},get:function(){var n=this.retrieve("move");return n||(n=new Fx.Move(this,{link:"cancel"}),this.store("move",n)),n}},Element.implement({move:function(n){return this.get("move").start(n),this}}),function(){function n(n){return/^(?:body|html)$/i.test(n.tagName)}Fx.Scroll=new Class({Extends:Fx,options:{offset:{x:0,y:0},wheelStops:!0},initialize:function(n,t){if(this.element=this.subject=document.id(n),this.parent(t),"element"!=typeOf(this.element)&&(this.element=document.id(this.element.getDocument().body)),this.options.wheelStops){var i=this.element,r=this.cancel.pass(!1,this);this.addEvent("start",function(){i.addEvent("mousewheel",r)},!0);this.addEvent("complete",function(){i.removeEvent("mousewheel",r)},!0)}},set:function(){var n=Array.flatten(arguments);return this.element.scrollTo(n[0],n[1]),this},compute:function(n,t,i){return[0,1].map(function(r){return Fx.compute(n[r],t[r],i)})},start:function(n,t){if(!this.check(n,t))return this;var i=this.element.getScroll();return this.parent([i.x,i.y],[n,t])},calculateScroll:function(n,t){var u=this.element,f=u.getScrollSize(),e=u.getScroll(),o=u.getSize(),s=this.options.offset,r={x:n,y:t},i;for(i in r)r[i]||0===r[i]||(r[i]=e[i]),"number"!=typeOf(r[i])&&(r[i]=f[i]-o[i]),r[i]+=s[i];return[r.x,r.y]},toTop:function(){return this.start.apply(this,this.calculateScroll(!1,0))},toLeft:function(){return this.start.apply(this,this.calculateScroll(0,!1))},toRight:function(){return this.start.apply(this,this.calculateScroll("right",!1))},toBottom:function(){return this.start.apply(this,this.calculateScroll(!1,"bottom"))},toElement:function(t,i){i=i?Array.convert(i):["x","y"];var u=n(this.element)?{x:0,y:0}:this.element.getScroll(),r=Object.map(document.id(t).getPosition(this.element),function(n,t){return i.contains(t)?n+u[t]:!1});return this.start.apply(this,this.calculateScroll(r.x,r.y))},toElementEdge:function(n,t,i){t=t?Array.convert(t):["x","y"];n=document.id(n);var r={},f=n.getPosition(this.element),e=n.getSize(),u=this.element.getScroll(),o=this.element.getSize(),s={x:f.x+e.x,y:f.y+e.y};return["x","y"].each(function(n){t.contains(n)&&(s[n]>u[n]+o[n]&&(r[n]=s[n]-o[n]),f[n]<u[n]&&(r[n]=f[n]));null==r[n]&&(r[n]=u[n]);i&&i[n]&&(r[n]=r[n]+i[n])},this),(r.x!=u.x||r.y!=u.y)&&this.start(r.x,r.y),this},toElementCenter:function(n,t,i){t=t?Array.convert(t):["x","y"];n=document.id(n);var r={},f=n.getPosition(this.element),e=n.getSize(),u=this.element.getScroll(),o=this.element.getSize();return["x","y"].each(function(n){t.contains(n)&&(r[n]=f[n]-(o[n]-e[n])/2);null==r[n]&&(r[n]=u[n]);i&&i[n]&&(r[n]=r[n]+i[n])},this),(r.x!=u.x||r.y!=u.y)&&this.start(r.x,r.y),this}})}(),Fx.Slide=new Class({Extends:Fx,options:{mode:"vertical",wrapper:!1,hideOverflow:!0,resetHeight:!1},initialize:function(n,t){n=this.element=this.subject=document.id(n);this.parent(t);t=this.options;var i=n.retrieve("wrapper"),r=n.getStyles("margin","position","overflow");t.hideOverflow&&(r=Object.append(r,{overflow:"hidden"}));t.wrapper&&(i=document.id(t.wrapper).setStyles(r));i||(i=new Element("div",{styles:r}).wraps(n));n.store("wrapper",i).setStyle("margin",0);"visible"==n.getStyle("overflow")&&n.setStyle("overflow","hidden");this.now=[];this.open=!0;this.wrapper=i;this.addEvent("complete",function(){this.open=0!=i["offset"+this.layout.capitalize()];this.open&&this.options.resetHeight&&i.setStyle("height","")},!0)},vertical:function(){this.margin="margin-top";this.layout="height";this.offset=this.element.offsetHeight},horizontal:function(){this.margin="margin-left";this.layout="width";this.offset=this.element.offsetWidth},set:function(n){return this.element.setStyle(this.margin,n[0]),this.wrapper.setStyle(this.layout,n[1]),this},compute:function(n,t,i){return[0,1].map(function(r){return Fx.compute(n[r],t[r],i)})},start:function(n,t){if(!this.check(n,t))return this;this[t||this.options.mode]();var i,u=this.element.getStyle(this.margin).toInt(),r=this.wrapper.getStyle(this.layout).toInt(),f=[[u,r],[0,this.offset]],e=[[u,r],[-this.offset,0]];switch(n){case"in":i=f;break;case"out":i=e;break;case"toggle":i=0==r?f:e}return this.parent(i[0],i[1])},slideIn:function(n){return this.start("in",n)},slideOut:function(n){return this.start("out",n)},hide:function(n){return this[n||this.options.mode](),this.open=!1,this.set([-this.offset,0])},show:function(n){return this[n||this.options.mode](),this.open=!0,this.set([0,this.offset])},toggle:function(n){return this.start("toggle",n)}}),Element.Properties.slide={set:function(n){return this.get("slide").cancel().setOptions(n),this},get:function(){var n=this.retrieve("slide");return n||(n=new Fx.Slide(this,{link:"cancel"}),this.store("slide",n)),n}},Element.implement({slide:function(n,t){var u,i,r;n=n||"toggle";i=this.get("slide");switch(n){case"hide":i.hide(t);break;case"show":i.show(t);break;case"toggle":r=this.retrieve("slide:flag",i.open);i[r?"slideOut":"slideIn"](t);this.store("slide:flag",!r);u=!0;break;default:i.start(n,t)}return u||this.eliminate("slide:flag"),this}}),Fx.SmoothScroll=new Class({Extends:Fx.Scroll,options:{axes:["x","y"]},initialize:function(n,t){t=t||document;this.doc=t.getDocument();this.parent(this.doc,n);var i=t.getWindow(),r=i.location.href.match(/^[^#]*/)[0]+"#",u=$$(this.options.links||this.doc.links);u.each(function(n){if(0==n.href.indexOf(r)){var t=n.href.substr(r.length);t&&this.useLink(n,t)}},this);this.addEvent("complete",function(){i.location.hash=this.anchor;this.element.scrollTo(this.to[0],this.to[1])},!0)},useLink:function(n,t){return n.addEvent("click",function(i){var r=document.id(t)||this.doc.getElement("a[name="+t+"]");r&&(i.preventDefault(),this.toElement(r,this.options.axes).chain(function(){this.fireEvent("scrolledTo",[n,r])}.bind(this)),this.anchor=t)}.bind(this)),this}}),Fx.Sort=new Class({Extends:Fx.Elements,options:{mode:"vertical"},initialize:function(n,t){this.parent(n,t);this.elements.each(function(n){"static"==n.getStyle("position")&&n.setStyle("position","relative")});this.setDefaultOrder()},setDefaultOrder:function(){this.currentOrder=this.elements.map(function(n,t){return t})},sort:function(){var e,o;if(!this.check(arguments))return this;var n=Array.flatten(arguments),t=0,i=0,s={},u={},f="vertical"==this.options.mode,r=this.elements.map(function(n,r){var e,o=n.getComputedSize({styles:["border","padding","margin"]}),s,h;return f?(e={top:t,margin:o["margin-top"],height:o.totalHeight},t+=e.height-o["margin-top"]):(e={left:i,margin:o["margin-left"],width:o.totalWidth},i+=e.width),s=f?"top":"left",u[r]={},h=n.getStyle(s).toInt(),u[r][s]=h||0,e},this);return this.set(u),n=n.map(function(n){return n.toInt()}),n.length!=this.elements.length&&(this.currentOrder.each(function(t){n.contains(t)||n.push(t)}),n.length>this.elements.length&&n.splice(this.elements.length-1,n.length-this.elements.length)),e=0,t=i=0,n.each(function(n){var u={};f?(u.top=t-r[n].top-e,t+=r[n].height):(u.left=i-r[n].left,i+=r[n].width);e+=r[n].margin;s[n]=u},this),o={},Array.clone(n).sort().each(function(n){o[n]=s[n]}),this.start(o),this.currentOrder=n,this},rearrangeDOM:function(n){n=n||this.currentOrder;var i=this.elements[0].getParent(),t=[];return this.elements.setStyle("opacity",0),n.each(function(n){t.push(this.elements[n].inject(i).setStyles({top:0,left:0}))},this),this.elements.setStyle("opacity",1),this.elements=$$(t),this.setDefaultOrder(),this},getDefaultOrder:function(){return this.elements.map(function(n,t){return t})},getCurrentOrder:function(){return this.currentOrder},forward:function(){return this.sort(this.getDefaultOrder())},backward:function(){return this.sort(this.getDefaultOrder().reverse())},reverse:function(){return this.sort(this.currentOrder.reverse())},sortByElements:function(n){return this.sort(n.map(function(n){return this.elements.indexOf(n)},this))},swap:function(n,t){"element"==typeOf(n)&&(n=this.elements.indexOf(n));"element"==typeOf(t)&&(t=this.elements.indexOf(t));var i=Array.clone(this.currentOrder);return i[this.currentOrder.indexOf(n)]=t,i[this.currentOrder.indexOf(t)]=n,this.sort(i)}}),function(){var n=this.Keyboard=new Class({Extends:Events,Implements:[Options],options:{defaultEventType:"keydown",active:!1,manager:null,events:{},nonParsedEvents:["activate","deactivate","onactivate","ondeactivate","changed","onchanged"]},initialize:function(n){n&&n.manager&&(this._manager=n.manager,delete n.manager);this.setOptions(n);this._setup()},addEvent:function(t,i,r){return this.parent(n.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i,r)},removeEvent:function(t,i){return this.parent(n.parse(t,this.options.defaultEventType,this.options.nonParsedEvents),i)},toggleActive:function(){return this[this.isActive()?"deactivate":"activate"]()},activate:function(t){if(t){if(t.isActive())return this;this._activeKB&&t!=this._activeKB&&(this.previous=this._activeKB,this.previous.fireEvent("deactivate"));this._activeKB=t.fireEvent("activate");n.manager.fireEvent("changed")}else this._manager&&this._manager.activate(this);return this},isActive:function(){return this._manager?this._manager._activeKB==this:n.manager==this},deactivate:function(t){return t?t===this._activeKB&&(this._activeKB=null,t.fireEvent("deactivate"),n.manager.fireEvent("changed")):this._manager&&this._manager.deactivate(this),this},relinquish:function(){return this.isActive()&&this._manager&&this._manager.previous?this._manager.activate(this._manager.previous):this.deactivate(),this},manage:function(n){return n._manager&&n._manager.drop(n),this._instances.push(n),n._manager=this,this._activeKB||this.activate(n),this},drop:function(n){return n.relinquish(),this._instances.erase(n),this._activeKB==n&&(this.previous&&this._instances.contains(this.previous)?this.activate(this.previous):this._activeKB=this._instances[0]),this},trace:function(){n.trace(this)},each:function(t){n.each(this,t)},_instances:[],_disable:function(n){this._activeKB==n&&(this._activeKB=null)},_setup:function(){this.addEvents(this.options.events);n.manager&&!this._manager&&n.manager.manage(this);this.options.active?this.activate():this.relinquish()},_handle:function(n,t){if(!n.preventKeyboardPropagation){var i=!!this._manager;i&&this._activeKB&&(this._activeKB._handle(n,t),n.preventKeyboardPropagation)||(this.fireEvent(t,n),!i&&this._activeKB&&this._activeKB._handle(n,t))}}}),t={},r=["shift","control","alt","meta"],u=/^(?:shift|control|ctrl|alt|meta)$/,i;n.parse=function(n,i,f){var s,e,o;return f&&f.contains(n.toLowerCase())?n:((n=n.toLowerCase().replace(/^(keyup|keydown):/,function(n,t){return i=t,""}),t[n])||("+"!=n?(e={},n.split("+").each(function(n){u.test(n)?e[n]=!0:s=n}),e.control=e.control||e.ctrl,o=[],r.each(function(n){e[n]&&o.push(n)}),s&&o.push(s),t[n]=o.join("+")):t[n]=n),i+":keys("+t[n]+")")};n.each=function(t,i){for(var r=t||n.manager;r;)i(r),r=r._activeKB};n.stop=function(n){n.preventKeyboardPropagation=!0};n.manager=new n({active:!0});n.trace=function(t){t=t||n.manager;var i=window.console&&console.log;i&&console.log("the following items have focus: ");n.each(t,function(n){i&&console.log(document.id(n.widget)||n.wiget||n)})};i=function(t){var i=[];r.each(function(n){t[n]&&i.push(n)});u.test(t.key)||i.push(t.key);n.manager._handle(t,t.type+":keys("+i.join("+")+")")};document.addEvents({keyup:i,keydown:i})}(),Keyboard.prototype.options.nonParsedEvents.combine(["rebound","onrebound"]),Keyboard.implement({addShortcut:function(n,t){return this._shortcuts=this._shortcuts||[],this._shortcutIndex=this._shortcutIndex||{},t.getKeyboard=Function.convert(this),t.name=n,this._shortcutIndex[n]=t,this._shortcuts.push(t),t.keys&&this.addEvent(t.keys,t.handler),this},addShortcuts:function(n){for(var t in n)this.addShortcut(t,n[t]);return this},removeShortcut:function(n){var t=this.getShortcut(n);return t&&t.keys&&(this.removeEvent(t.keys,t.handler),delete this._shortcutIndex[n],this._shortcuts.erase(t)),this},removeShortcuts:function(n){return n.each(this.removeShortcut,this),this},getShortcuts:function(){return this._shortcuts||[]},getShortcut:function(n){return(this._shortcutIndex||{})[n]}}),Keyboard.rebind=function(n,t){Array.convert(t).each(function(t){t.getKeyboard().removeEvent(t.keys,t.handler);t.getKeyboard().addEvent(n,t.handler);t.keys=n;t.getKeyboard().fireEvent("rebound")})},Keyboard.getActiveShortcuts=function(n){var t=[],i=[];return Keyboard.each(n,[].push.bind(t)),t.each(function(n){i.extend(n.getShortcuts())}),i},Keyboard.getShortcut=function(n,t,i){i=i||{};var r=i.many?[]:null,u=i.many?function(t){var i=t.getShortcut(n);i&&r.push(i)}:function(t){r||(r=t.getShortcut(n))};return Keyboard.each(t,u),r},Keyboard.getShortcuts=function(n,t){return Keyboard.getShortcut(n,t,{many:!0})},function(){this.HtmlTable=new Class({Implements:[Options,Events,Class.Occlude],options:{properties:{cellpadding:0,cellspacing:0,border:0},rows:[],headers:[],footers:[]},property:"HtmlTable",initialize:function(){var n=Array.link(arguments,{options:Type.isObject,table:Type.isElement,id:Type.isString});return this.setOptions(n.options),!n.table&&n.id&&(n.table=document.id(n.id)),this.element=n.table||new Element("table",this.options.properties),this.occlude()?this.occluded:void this.build()},build:function(){this.element.store("HtmlTable",this);this.body=document.id(this.element.tBodies[0])||new Element("tbody").inject(this.element);$$(this.body.rows);this.options.headers.length?this.setHeaders(this.options.headers):this.thead=document.id(this.element.tHead);this.thead&&(this.head=this.getHead());this.options.footers.length&&this.setFooters(this.options.footers);this.tfoot=document.id(this.element.tFoot);this.tfoot&&(this.foot=document.id(this.tfoot.rows[0]));this.options.rows.each(function(n){this.push(n)},this)},toElement:function(){return this.element},empty:function(){return this.body.empty(),this},set:function(n,t){var r="headers"==n?"tHead":"tFoot",i=r.toLowerCase(),u;return this[i]=(document.id(this.element[r])||new Element(i).inject(this.element,"top")).empty(),u=this.push(t,{},this[i],"headers"==n?"th":"td"),"headers"==n?this.head=this.getHead():this.foot=this.getHead(),u},getHead:function(){var n=this.thead.rows;return n.length>1?$$(n):n.length?document.id(n[0]):!1},setHeaders:function(n){return this.set("headers",n),this},setFooters:function(n){return this.set("footers",n),this},update:function(n,t,i){var r=n.getChildren(i||"td"),u=r.length-1;return t.each(function(t,f){var e=r[f]||new Element(i||"td").inject(n),o=(t&&Object.prototype.hasOwnProperty.call(t,"content")?t.content:"")||t,s=typeOf(o);t&&Object.prototype.hasOwnProperty.call(t,"properties")&&e.set(t.properties);/(element(s?)|array|collection)/.test(s)?e.empty().adopt(o):e.set("html",o);f>u?r.push(e):r[f]=e}),{tr:n,tds:r}},push:function(n,t,i,r,u){return"element"==typeOf(n)&&"tr"==n.get("tag")?(n.inject(i||this.body,u),{tr:n,tds:n.getChildren("td")}):this.update(new Element("tr",t).inject(i||this.body,u),n,r)},pushMany:function(n,t,i,r,u){return n.map(function(n){return this.push(n,t,i,r,u)},this)}})}(),["adopt","inject","wraps","grab","replaces","dispose"].each(function(n){HtmlTable.implement(n,function(){return this.element[n].apply(this.element,arguments),this})}),HtmlTable=Class.refactor(HtmlTable,{options:{useKeyboard:!0,classRowSelected:"table-tr-selected",classRowHovered:"table-tr-hovered",classSelectable:"table-selectable",shiftForMultiSelect:!0,allowMultiSelect:!0,selectable:!1,selectHiddenRows:!1},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.selectedRows=new Elements,this.bound||(this.bound={}),this.bound.mouseleave=this.mouseleave.bind(this),this.bound.clickRow=this.clickRow.bind(this),this.bound.activateKeyboard=function(){this.keyboard&&this.selectEnabled&&this.keyboard.activate()}.bind(this),void(this.options.selectable&&this.enableSelect()))},empty:function(){return this.body.rows.length&&this.selectNone(),this.previous()},enableSelect:function(){return this.selectEnabled=!0,this.attachSelects(),this.element.addClass(this.options.classSelectable),this},disableSelect:function(){return this.selectEnabled=!1,this.attachSelects(!1),this.element.removeClass(this.options.classSelectable),this},push:function(){var n=this.previous.apply(this,arguments);return this.updateSelects(),n},toggleRow:function(n){return this[(this.isSelected(n)?"de":"")+"selectRow"](n)},selectRow:function(n,t){if(!this.isSelected(n)&&(t||this.body.getChildren().contains(n)))return(this.options.allowMultiSelect||this.selectNone(),this.isSelected(n)||(this.selectedRows.push(n),n.addClass(this.options.classRowSelected),this.fireEvent("rowFocus",[n,this.selectedRows]),this.fireEvent("stateChanged")),this.focused=n,document.clearSelection(),this)},isSelected:function(n){return this.selectedRows.contains(n)},getSelected:function(){return this.selectedRows},serialize:function(){var n=this.previous.apply(this,arguments)||{};return this.options.selectable&&(n.selectedRows=this.selectedRows.map(function(n){return Array.indexOf(this.body.rows,n)}.bind(this))),n},restore:function(n){this.options.selectable&&n.selectedRows&&n.selectedRows.each(function(n){this.selectRow(this.body.rows[n])}.bind(this));this.previous.apply(this,arguments)},deselectRow:function(n,t){if(this.isSelected(n)&&(t||this.body.getChildren().contains(n)))return(this.selectedRows=new Elements(Array.convert(this.selectedRows).erase(n)),n.removeClass(this.options.classRowSelected),this.fireEvent("rowUnfocus",[n,this.selectedRows]),this.fireEvent("stateChanged"),this)},selectAll:function(n){if(n||this.options.allowMultiSelect)return(this.selectRange(0,this.body.rows.length,n),this)},selectNone:function(){return this.selectAll(!0)},selectRange:function(n,t,i){var f,r,e,u;if(this.options.allowMultiSelect||i){for(f=i?"deselectRow":"selectRow",r=Array.clone(this.body.rows),("element"==typeOf(n)&&(n=r.indexOf(n)),"element"==typeOf(t)&&(t=r.indexOf(t)),t=t<r.length-1?t:r.length-1,n>t)&&(e=n,n=t,t=e),u=n;t>=u;u++)(this.options.selectHiddenRows||r[u].isDisplayed())&&this[f](r[u],!0);return this}},deselectRange:function(n,t){this.selectRange(n,t,!0)},enterRow:function(n){this.hovered&&(this.hovered=this.leaveRow(this.hovered));this.hovered=n.addClass(this.options.classRowHovered)},leaveRow:function(n){n.removeClass(this.options.classRowHovered)},updateSelects:function(){Array.each(this.body.rows,function(n){var t=n.retrieve("binders");(t||this.selectEnabled)&&(t||(t={mouseenter:this.enterRow.pass([n],this),mouseleave:this.leaveRow.pass([n],this)},n.store("binders",t)),this.selectEnabled?n.addEvents(t):n.removeEvents(t))},this)},shiftFocus:function(n,t){if(!this.focused)return this.selectRow(this.body.rows[0],t);var i=this.getRowByOffset(n,this.options.selectHiddenRows);return null===i||this.focused==this.body.rows[i]?this:void this.toggleRow(this.body.rows[i],t)},clickRow:function(n,t){var i=(n.shift||n.meta||n.control)&&this.options.shiftForMultiSelect;i||n.rightClick&&this.isSelected(t)&&this.options.allowMultiSelect||this.selectNone();n.rightClick?this.selectRow(t):this.toggleRow(t);n.shift&&(this.selectRange(this.rangeStart||this.body.rows[0],t,this.rangeStart?!this.isSelected(t):!0),this.focused=t);this.rangeStart=t},getRowByOffset:function(n,t){var i,r;if(!this.focused)return 0;if(i=Array.indexOf(this.body.rows,this.focused),0==i&&0>n||i==this.body.rows.length-1&&n>0)return null;if(t)i+=n;else if(r=0,n>0)for(;n>r&&i<this.body.rows.length-1;)this.body.rows[++i].isDisplayed()&&r++;else for(;r>n&&i>0;)this.body.rows[--i].isDisplayed()&&r--;return i},attachSelects:function(n){var u,f,e,t,i,r;n=null!=n?n:!0;u=n?"addEvents":"removeEvents";(this.element[u]({mouseleave:this.bound.mouseleave,click:this.bound.activateKeyboard}),this.body[u]({"click:relay(tr)":this.bound.clickRow,"contextmenu:relay(tr)":this.bound.clickRow}),this.options.useKeyboard||this.keyboard)&&((this.keyboard||(this.keyboard=new Keyboard),this.selectKeysDefined)||(this.selectKeysDefined=!0,t=function(n){var t=function(i){clearTimeout(f);i.preventDefault();var r=this.body.rows[this.getRowByOffset(n,this.options.selectHiddenRows)];i.shift&&r&&this.isSelected(r)?(this.deselectRow(this.focused),this.focused=r):(!r||this.options.allowMultiSelect&&i.shift||this.selectNone(),this.shiftFocus(n,i));f=e?t.delay(100,this,i):function(){e=!0;t(i)}.delay(400)}.bind(this);return t}.bind(this),i=function(){clearTimeout(f);e=!1},this.keyboard.addEvents({"keydown:shift+up":t(-1),"keydown:shift+down":t(1),"keyup:shift+up":i,"keyup:shift+down":i,"keyup:up":i,"keyup:down":i}),r="",this.options.allowMultiSelect&&this.options.shiftForMultiSelect&&this.options.useKeyboard&&(r=" (Shift multi-selects)."),this.keyboard.addShortcuts({"Select Previous Row":{keys:"up",shortcut:"up arrow",handler:t(-1),description:"Select the previous row in the table."+r},"Select Next Row":{keys:"down",shortcut:"down arrow",handler:t(1),description:"Select the next row in the table."+r}})),this.keyboard[n?"activate":"deactivate"]());this.updateSelects()},mouseleave:function(){this.hovered&&this.leaveRow(this.hovered)}}),function(){var n=document.createElement("table");try{n.innerHTML="<tr><td><\/td><\/tr>";n=0===n.childNodes.length}catch(t){n=!0}HtmlTable=Class.refactor(HtmlTable,{options:{sortIndex:0,sortReverse:!1,parsers:[],defaultParser:"string",classSortable:"table-sortable",classHeadSort:"table-th-sort",classHeadSortRev:"table-th-sort-rev",classNoSort:"table-th-nosort",classGroupHead:"table-tr-group-head",classGroup:"table-tr-group",classCellSort:"table-td-sort",classSortSpan:"table-th-sort-span",sortable:!1,thSelector:"th"},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:(this.sorted={index:null,dir:1},this.bound||(this.bound={}),this.bound.headClick=this.headClick.bind(this),this.sortSpans=new Elements,void(this.options.sortable&&(this.enableSort(),null!=this.options.sortIndex&&this.sort(this.options.sortIndex,this.options.sortReverse))))},attachSorts:function(n){this.detachSorts();n!==!1&&this.element.addEvent("click:relay("+this.options.thSelector+")",this.bound.headClick)},detachSorts:function(){this.element.removeEvents("click:relay("+this.options.thSelector+")")},setHeaders:function(){this.previous.apply(this,arguments);this.sortable&&this.setParsers()},setParsers:function(){this.parsers=this.detectParsers()},detectParsers:function(){return this.head&&this.head.getElements(this.options.thSelector).flatten().map(this.detectParser,this)},detectParser:function(n,t){var r,e,u,i,f;if(n.hasClass(this.options.classNoSort)||n.retrieve("htmltable-parser"))return n.retrieve("htmltable-parser");r=new Element("div");r.adopt(n.childNodes).inject(n);e=new Element("span",{"class":this.options.classSortSpan}).inject(r,"top");this.sortSpans.push(e);i=this.options.parsers[t];f=this.body.rows;switch(typeOf(i)){case"function":i={convert:i};u=!0;break;case"string":i=i;u=!0}return u||HtmlTable.ParserPriority.some(function(n){var o=HtmlTable.Parsers[n],s=o.match,r,h,u,e;if(!s)return!1;for(r=0,h=f.length;h>r;r++)if(u=document.id(f[r].cells[t]),e=u?u.get("html").clean():"",e&&s.test(e))return i=o,!0}),i||(i=this.options.defaultParser),n.store("htmltable-parser",i),i},headClick:function(n,t){if(this.head&&!t.hasClass(this.options.classNoSort))return this.sort(Array.indexOf(this.head.getElements(this.options.thSelector).flatten(),t)%this.body.rows[0].cells.length)},serialize:function(){var n=this.previous.apply(this,arguments)||{};return this.options.sortable&&(n.sortIndex=this.sorted.index,n.sortReverse=this.sorted.reverse),n},restore:function(n){this.options.sortable&&n.sortIndex&&this.sort(n.sortIndex,n.sortReverse);this.previous.apply(this,arguments)},setSortedState:function(n,t){this.sorted.reverse=null!=t?t:this.sorted.index==n?!this.sorted.reverse:null==this.sorted.index;null!=n&&(this.sorted.index=n)},setHeadSort:function(n){var t=$$(this.head.length?this.head.map(function(n){return n.getElements(this.options.thSelector)[this.sorted.index]},this).clean():this.head.cells[this.sorted.index]);t.length&&(n?(t.addClass(this.options.classHeadSort),this.sorted.reverse?t.addClass(this.options.classHeadSortRev):t.removeClass(this.options.classHeadSortRev)):t.removeClass(this.options.classHeadSort).removeClass(this.options.classHeadSortRev))},setRowSort:function(n,t){for(var e,i,r=n.length,f=this.body;r;){var o=n[--r],s=o.position,u=f.rows[s];if(!u.disabled)for(t||(e=this.setGroupSort(e,u,o),this.setRowStyle(u,r)),f.appendChild(u),i=0;r>i;i++)n[i].position>s&&n[i].position--}},setRowStyle:function(n,t){this.previous(n,t);n.cells[this.sorted.index].addClass(this.options.classCellSort)},setGroupSort:function(n,t,i){return n==i.value?t.removeClass(this.options.classGroupHead).addClass(this.options.classGroup):t.removeClass(this.options.classGroup).addClass(this.options.classGroupHead),i.value},getParser:function(){var n=this.parsers[this.sorted.index];return"string"==typeOf(n)?HtmlTable.Parsers[n]:n},sort:function(t,i,r,u){var f,e,o,s;if(this.head&&(r||(this.clearSort(),this.setSortedState(t,i),this.setHeadSort(!0)),f=this.getParser(),f))return n||(e=this.body.getParent(),this.body.dispose()),o=this.parseData(f).sort(u?u:function(n,t){return n.value===t.value?0:n.value>t.value?1:-1}),s=this.sorted.reverse==(f==HtmlTable.Parsers["input-checked"]),s&&o.reverse(!0),this.setRowSort(o,r),e&&e.grab(this.body),this.fireEvent("stateChanged"),this.fireEvent("sort",[this.body,this.sorted.index,s?"asc":"desc"])},parseData:function(n){return Array.map(this.body.rows,function(t,i){var r=n.convert.call(document.id(t.cells[this.sorted.index]));return{position:i,value:r}},this)},clearSort:function(){this.setHeadSort(!1);this.body.getElements("td").removeClass(this.options.classCellSort)},reSort:function(){return this.sortable&&this.sort.call(this,this.sorted.index,this.sorted.reverse),this},enableSort:function(){return this.element.addClass(this.options.classSortable),this.attachSorts(!0),this.setParsers(),this.sortable=!0,this},disableSort:function(){return this.element.removeClass(this.options.classSortable),this.attachSorts(!1),this.sortSpans.each(function(n){n.destroy()}),this.sortSpans.empty(),this.sortable=!1,this}});HtmlTable.ParserPriority=["date","input-checked","input-value","float","number"];HtmlTable.Parsers={date:{match:/^\d{2}[-\/ ]\d{2}[-\/ ]\d{2,4}$/,convert:function(){var n=Date.parse(this.get("text").stripTags());return"date"==typeOf(n)?n.format("db"):""},type:"date"},"input-checked":{match:/ type="(radio|checkbox)"/,convert:function(){return this.getElement("input").checked}},"input-value":{match:/<input/,convert:function(){return this.getElement("input").value}},number:{match:/^\d+[^\d.,]*$/,convert:function(){return this.get("text").stripTags().toInt()},number:!0},numberLax:{match:/^[^\d]+\d+$/,convert:function(){return this.get("text").replace(/[^-?^0-9]/,"").stripTags().toInt()},number:!0},float:{match:/^[\d]+\.[\d]+/,convert:function(){return this.get("text").replace(/[^-?^\d.e]/,"").stripTags().toFloat()},number:!0},floatLax:{match:/^[^\d]+[\d]+\.[\d]+$/,convert:function(){return this.get("text").replace(/[^-?^\d.]/,"").stripTags().toFloat()},number:!0},string:{match:null,convert:function(){return this.get("text").stripTags().toLowerCase()}},title:{match:null,convert:function(){return this.title}}};HtmlTable.defineParsers=function(n){HtmlTable.Parsers=Object.append(HtmlTable.Parsers,n);for(var t in n)HtmlTable.ParserPriority.unshift(t)}}(),HtmlTable=Class.refactor(HtmlTable,{options:{classZebra:"table-tr-odd",zebra:!0,zebraOnlyVisibleRows:!0},initialize:function(){return this.previous.apply(this,arguments),this.occluded?this.occluded:void(this.options.zebra&&this.updateZebras())},updateZebras:function(){var n=0;Array.each(this.body.rows,function(t){(!this.options.zebraOnlyVisibleRows||t.isDisplayed())&&this.zebra(t,n++)},this)},setRowStyle:function(n,t){this.previous&&this.previous(n,t);this.zebra(n,t)},zebra:function(n,t){return n[(t%2?"remove":"add")+"Class"](this.options.classZebra)},push:function(){var n=this.previous.apply(this,arguments);return this.options.zebra&&this.updateZebras(),n}}),function(){this.Scroller=new Class({Implements:[Events,Options],options:{area:20,velocity:1,onChange:function(n,t){this.element.scrollTo(n,t)},fps:50},initialize:function(n,t){this.setOptions(t);this.element=document.id(n);this.docBody=document.id(this.element.getDocument().body);this.listener="element"!=typeOf(this.element)?this.docBody:this.element;this.timer=null;this.bound={attach:this.attach.bind(this),detach:this.detach.bind(this),getCoords:this.getCoords.bind(this)}},start:function(){return this.listener.addEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this},stop:function(){return this.listener.removeEvents({mouseover:this.bound.attach,mouseleave:this.bound.detach}),this.detach(),this.timer=clearInterval(this.timer),this},attach:function(){this.listener.addEvent("mousemove",this.bound.getCoords)},detach:function(){this.listener.removeEvent("mousemove",this.bound.getCoords);this.timer=clearInterval(this.timer)},getCoords:function(n){this.page="body"==this.listener.get("tag")?n.client:n.page;this.timer||(this.timer=this.scroll.periodical(Math.round(1e3/this.options.fps),this))},scroll:function(){var u=this.element.getSize(),i=this.element.getScroll(),r=this.element!=this.docBody&&this.element!=window?this.element.getOffsets():{x:0,y:0},o=this.element.getScrollSize(),t={x:0,y:0},f=this.options.area.top||this.options.area,e=this.options.area.bottom||this.options.area,n;for(n in this.page)this.page[n]<f+r[n]&&0!=i[n]?t[n]=(this.page[n]-f-r[n])*this.options.velocity:this.page[n]+e>u[n]+r[n]&&i[n]+u[n]!=o[n]&&(t[n]=(this.page[n]-u[n]+e-r[n])*this.options.velocity),t[n]=t[n].round();(t.y||t.x)&&this.fireEvent("change",[i.x+t.x,i.y+t.y])}})}(),Locale.define("en-GB","Date",{dateOrder:["date","month","year"],shortDate:"%d/%m/%Y",shortTime:"%H:%M"}).inherit("en-US","Date"),Locale.define("en-US","Number",{decimal:".",group:",",currency:{prefix:"$ "}}),Request.JSONP=new Class({Implements:[Chain,Events,Options],options:{onRequest:function(n){this.options.log&&window.console&&console.log&&console.log("JSONP retrieving script with url:"+n)},onError:function(n){this.options.log&&window.console&&console.warn&&console.warn("JSONP "+n+" will fail in Internet Explorer, which enforces a 2083 bytes length limit on URIs")},url:"",callbackKey:"callback",injectScript:document.head,data:"",link:"ignore",timeout:0,log:!1},initialize:function(n){this.setOptions(n)},send:function(n){var r,t,e;if(!Request.prototype.check.call(this,n))return this;this.running=!0;r=typeOf(n);("string"==r||"element"==r)&&(n={data:n});n=Object.merge(this.options,n||{});t=n.data;switch(typeOf(t)){case"element":t=document.id(t).toQueryString();break;case"object":case"hash":t=Object.toQueryString(t)}var u=this.index=Request.JSONP.counter++,f="request_"+u,i=n.url+(n.url.test("\\?")?"&":"?")+n.callbackKey+"=Request.JSONP.request_map.request_"+u+(t?"&"+t:"");return i.length>2083&&this.fireEvent("error",i),Request.JSONP.request_map[f]=function(){delete Request.JSONP.request_map[f];this.success(arguments,u)}.bind(this),e=this.getScript(i).inject(n.injectScript),this.fireEvent("request",[i,e]),n.timeout&&this.timeout.delay(n.timeout,this),this},getScript:function(n){return this.script||(this.script=new Element("script",{type:"text/javascript",async:!0,src:n})),this.script},success:function(n){this.running&&this.clear().fireEvent("complete",n).fireEvent("success",n).callChain()},cancel:function(){return this.running&&this.clear().fireEvent("cancel"),this},isRunning:function(){return!!this.running},clear:function(){return this.running=!1,this.script&&(this.script.destroy(),this.script=null),this},timeout:function(){return this.running&&(this.running=!1,this.fireEvent("timeout",[this.script.get("src"),this.script]).fireEvent("failure").cancel()),this}}),Request.JSONP.counter=0,Request.JSONP.request_map={},Request.implement({options:{initialDelay:5e3,delay:5e3,limit:6e4},startTimer:function(n){var t=function(){this.running||this.send({data:n})};return this.lastDelay=this.options.initialDelay,this.timer=t.delay(this.lastDelay,this),this.completeCheck=function(n){clearTimeout(this.timer);this.lastDelay=n?this.options.delay:(this.lastDelay+this.options.delay).min(this.options.limit);this.timer=t.delay(this.lastDelay,this)},this.addEvent("complete",this.completeCheck)},stopTimer:function(){return clearTimeout(this.timer),this.removeEvent("complete",this.completeCheck)}}),Request.Queue=new Class({Implements:[Options,Events],Binds:["attach","request","complete","cancel","success","failure","exception"],options:{stopOnFailure:!0,autoAdvance:!0,concurrent:1,requests:{}},initialize:function(n){var t;n&&(t=n.requests,delete n.requests);this.setOptions(n);this.requests={};this.queue=[];this.reqBinders={};t&&this.addRequests(t)},addRequest:function(n,t){return this.requests[n]=t,this.attach(n,t),this},addRequests:function(n){return Object.each(n,function(n,t){this.addRequest(t,n)},this),this},getName:function(n){return Object.keyOf(this.requests,n)},attach:function(n,t){return t._groupSend?this:(["request","complete","cancel","success","failure","exception"].each(function(i){this.reqBinders[n]||(this.reqBinders[n]={});this.reqBinders[n][i]=function(){this["on"+i.capitalize()].apply(this,[n,t].append(arguments))}.bind(this);t.addEvent(i,this.reqBinders[n][i])},this),t._groupSend=t.send,t.send=function(i){return this.send(n,i),t}.bind(this),this)},removeRequest:function(n){var t="object"==typeOf(n)?this.getName(n):n;return(t||"string"==typeOf(t))&&(n=this.requests[t])?(["request","complete","cancel","success","failure","exception"].each(function(i){n.removeEvent(i,this.reqBinders[t][i])},this),n.send=n._groupSend,delete n._groupSend,this):this},getRunning:function(){return Object.filter(this.requests,function(n){return n.running})},isRunning:function(){return!!Object.keys(this.getRunning()).length},send:function(n,t){var i=function(){this.requests[n]._groupSend(t);this.queue.erase(i)}.bind(this);return i.name=n,Object.keys(this.getRunning()).length>=this.options.concurrent||this.error&&this.options.stopOnFailure?this.queue.push(i):i(),this},hasNext:function(n){return n?!!this.queue.filter(function(t){return t.name==n}).length:!!this.queue.length},resume:function(){return this.error=!1,(this.options.concurrent-Object.keys(this.getRunning()).length).times(this.runNext,this),this},runNext:function(n){if(!this.queue.length)return this;if(n){var t;this.queue.each(function(i){t||i.name!=n||(t=!0,i())})}else this.queue[0]();return this},runAll:function(){return this.queue.each(function(n){n()}),this},clear:function(n){return n?this.queue=this.queue.map(function(t){return t.name!=n?t:!1}).filter(function(n){return n}):this.queue.empty(),this},cancel:function(n){return this.requests[n].cancel(),this},onRequest:function(){this.fireEvent("request",arguments)},onComplete:function(){this.fireEvent("complete",arguments);this.queue.length||this.fireEvent("end")},onCancel:function(){this.options.autoAdvance&&!this.error&&this.runNext();this.fireEvent("cancel",arguments)},onSuccess:function(){this.options.autoAdvance&&!this.error&&this.runNext();this.fireEvent("success",arguments)},onFailure:function(){this.error=!0;!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext();this.fireEvent("failure",arguments)},onException:function(){this.error=!0;!this.options.stopOnFailure&&this.options.autoAdvance&&this.runNext();this.fireEvent("exception",arguments)}}),function(n){Array.implement({min:function(){return Math.min.apply(null,this)},max:function(){return Math.max.apply(null,this)},average:function(){return this.length?this.sum()/this.length:0},sum:function(){var t=0,n=this.length;if(n)for(;n--;)null!=this[n]&&(t+=parseFloat(this[n]));return t},unique:function(){return[].combine(this)},shuffle:function(){for(var i,t,n=this.length;n&&--n;)i=this[n],t=Math.floor(Math.random()*(n+1)),this[n]=this[t],this[t]=i;return this},reduce:function(t,i){for(var r=0,u=this.length;u>r;r++)r in this&&(i=i===n?this[r]:t.call(null,i,this[r],r,this));return i},reduceRight:function(t,i){for(var r=this.length;r--;)r in this&&(i=i===n?this[r]:t.call(null,i,this[r],r,this));return i},pluck:function(n){return this.map(function(t){return t[n]})}})}(),Date.implement({timeDiffInWords:function(n){return Date.distanceOfTimeInWords(this,n||new Date)},timeDiff:function(n,t){null==n&&(n=new Date);for(var u,f,i=((n-this)/1e3).floor().abs(),e=[],o=[60,60,24,365,0],s=["s","m","h","d","y"],r=0;r<o.length&&(!r||i);r++)u=i,(f=o[r])&&(u=i%f,i=(i/f).floor()),e.unshift(u+(s[r]||""));return e.join(t||":")}}).extend({distanceOfTimeInWords:function(n,t){return Date.getTimePhrase(((t-n)/1e3).toInt())},getTimePhrase:function(n){var f=0>n?"Until":"Ago",u,t,i,r;0>n&&(n*=-1);u={minute:60,hour:60,day:24,week:7,month:52/12,year:12,eon:1/0};t="lessThanMinute";for(i in u){if(r=u[i],1.5*r>n){n>.75*r&&(t=i);break}n/=r;t=i+"s"}return n=n.round(),Date.getMsg(t+f,n).substitute({delta:n})}}).defineParsers({re:/^(?:tod|tom|yes)/i,handler:function(n){var t=(new Date).clearTime();switch(n[0]){case"tom":return t.increment();case"yes":return t.decrement();default:return t}}},{re:/^(next|last) ([a-z]+)$/i,handler:function(n){var t=(new Date).clearTime(),r=t.getDay(),u=Date.parseDay(n[2],!0),i=u-r;return r>=u&&(i+=7),"last"==n[1]&&(i-=7),t.set("date",t.getDate()+i)}}).alias("timeAgoInWords","timeDiffInWords"),function(){if(!this.Hash){var n=this.Hash=new Type("Hash",function(n){"hash"==typeOf(n)&&(n=Object.clone(n.getClean()));for(var t in n)this[t]=n[t];return this});this.$H=function(t){return new n(t)};n.implement({forEach:function(n,t){Object.forEach(this,n,t)},getClean:function(){var t={},n;for(n in this)this.hasOwnProperty(n)&&(t[n]=this[n]);return t},getLength:function(){var n=0,t;for(t in this)this.hasOwnProperty(t)&&n++;return n}});n.alias("each","forEach");n.implement({has:Object.prototype.hasOwnProperty,keyOf:function(n){return Object.keyOf(this,n)},hasValue:function(n){return Object.contains(this,n)},extend:function(t){return n.each(t||{},function(t,i){n.set(this,i,t)},this),this},combine:function(t){return n.each(t||{},function(t,i){n.include(this,i,t)},this),this},erase:function(n){return this.hasOwnProperty(n)&&delete this[n],this},get:function(n){return this.hasOwnProperty(n)?this[n]:null},set:function(n,t){return(!this[n]||this.hasOwnProperty(n))&&(this[n]=t),this},empty:function(){return n.each(this,function(n,t){delete this[t]},this),this},include:function(n,t){return void 0==this[n]&&(this[n]=t),this},map:function(t,i){return new n(Object.map(this,t,i))},filter:function(t,i){return new n(Object.filter(this,t,i))},every:function(n,t){return Object.every(this,n,t)},some:function(n,t){return Object.some(this,n,t)},getKeys:function(){return Object.keys(this)},getValues:function(){return Object.values(this)},toQueryString:function(n){return Object.toQueryString(this,n)}});n.alias({indexOf:"keyOf",contains:"hasValue"})}}(),Hash.implement({getFromPath:function(n){return Object.getFromPath(this,n)},cleanValues:function(n){return new Hash(Object.cleanValues(this,n))},run:function(){Object.run(arguments)}}),Number.implement({format:function(n){var t=this,f,a,v,i,e,u,o,s;n=n?Object.clone(n):{};var r=function(t){return null!=n[t]?n[t]:Locale.get("Number."+t)},p=0>t,c=r("decimal"),l=r("precision"),y=r("group"),h=r("decimals");if(p&&(f=r("negative")||{},null==f.prefix&&null==f.suffix&&(f.prefix="-"),["prefix","suffix"].each(function(t){f[t]&&(n[t]=r(t)+f[t])}),t=-t),a=r("prefix"),v=r("suffix"),""!==h&&h>=0&&20>=h&&(t=t.toFixed(h)),l>=1&&21>=l&&(t=(+t).toPrecision(l)),t+="",r("scientific")===!1&&t.indexOf("e")>-1)if(e=t.split("e"),u=+e[1],t=e[0].replace(".",""),0>u){for(u=-u-1,i=e[0].indexOf("."),i>-1&&(u-=i-1);u--;)t="0"+t;t="0."+t}else for(i=e[0].lastIndexOf("."),i>-1&&(u-=e[0].length-i-1);u--;)t+="0";if("."!=c&&(t=t.replace(".",c)),y){for(i=t.lastIndexOf(c),i=i>-1?i:t.length,o=t.substring(i),s=i;s--;)(i-s-1)%3==0&&s!=i-1&&(o=y+o),o=t.charAt(s)+o;t=o}return a&&(t=a+t),v&&(t+=v),t},formatCurrency:function(n){var t=Locale.get("Number.currency")||{};return null==t.scientific&&(t.scientific=!1),t.decimals=null!=n?n:null==t.decimals?2:t.decimals,this.format(t)},formatPercentage:function(n){var t=Locale.get("Number.percentage")||{};return null==t.suffix&&(t.suffix="%"),t.decimals=null!=n?n:null==t.decimals?2:t.decimals,this.format(t)}}),function(){var t=function(){return this.get("value")},n=this.URI=new Class({Implements:Options,options:{},regex:/^(?:(\w+):)?(?:\/\/(?:(?:([^:@\/]*):?([^:@\/]*))?@)?(\[[A-Fa-f0-9:]+\]|[^:\/?#]*)(?::(\d*))?)?(\.\.?$|(?:[^?#\/]*\/)*)([^?#]*)(?:\?([^#]*))?(?:#(.*))?/,parts:["scheme","user","password","host","port","directory","file","query","fragment"],schemes:{http:80,https:443,ftp:21,rtsp:554,mms:1755,file:0},initialize:function(t,i){this.setOptions(i);var r=this.options.base||n.base;t||(t=r);t&&t.parsed?this.parsed=Object.clone(t.parsed):this.set("value",t.href||t.toString(),r?new n(r):!1)},parse:function(n,t){var i=n.match(this.regex);return i?(i.shift(),this.merge(i.associate(this.parts),t)):!1},merge:function(n,t){return n&&n.scheme||t&&t.scheme?(t&&this.parts.every(function(i){return n[i]?!1:(n[i]=t[i]||"",!0)}),n.port=n.port||this.schemes[n.scheme.toLowerCase()],n.directory=n.directory?this.parseDirectory(n.directory,t?t.directory:""):"/",n):!1},parseDirectory:function(t,i){if(t=("/"==t.substr(0,1)?"":i||"/")+t,!t.test(n.regs.directoryDot))return t;var r=[];return t.replace(n.regs.endSlash,"").split("/").each(function(n){".."==n&&r.length>0?r.pop():"."!=n&&r.push(n)}),r.join("/")+"/"},combine:function(n){return n.value||n.scheme+"://"+(n.user?n.user+(n.password?":"+n.password:"")+"@":"")+(n.host||"")+(n.port&&n.port!=this.schemes[n.scheme]?":"+n.port:"")+(n.directory||"/")+(n.file||"")+(n.query?"?"+n.query:"")+(n.fragment?"#"+n.fragment:"")},set:function(t,i,r){if("value"==t){var u=i.match(n.regs.scheme);u&&(u=u[1]);this.parsed=u&&null==this.schemes[u.toLowerCase()]?{scheme:u,value:i}:this.parse(i,(r||this).parsed)||(u?{scheme:u,value:i}:{value:i})}else"data"==t?this.setData(i):this.parsed[t]=i;return this},get:function(n,t){switch(n){case"value":return this.combine(this.parsed,t?t.parsed:!1);case"data":return this.getData()}return this.parsed[n]||""},go:function(){document.location.href=this.toString()},toURI:function(){return this},getData:function(n,t){var i=this.get(t||"query"),r;return!i&&0!==i?n?null:{}:(r=i.parseQueryString(),n?r[n]:r)},setData:function(n,t,i){if("string"==typeof n){var r=this.getData();r[arguments[0]]=arguments[1];n=r}else t&&(n=Object.merge(this.getData(null,i),n));return this.set(i||"query",Object.toQueryString(n))},clearData:function(n){return this.set(n||"query","")},toString:t,valueOf:t});n.regs={endSlash:/\/$/,scheme:/^(\w+):/,directoryDot:/\.\/|\.$/};n.base=new n(Array.convert(document.getElements("base[href]",!0)).getLast(),{base:document.location});String.implement({toURI:function(t){return new n(this,t)}})}(),URI=Class.refactor(URI,{combine:function(n,t){var f;if(!t||n.scheme!=t.scheme||n.host!=t.host||n.port!=t.port)return this.previous.apply(this,arguments);if(f=n.file+(n.query?"?"+n.query:"")+(n.fragment?"#"+n.fragment:""),!t.directory)return(n.directory||(n.file?"":"./"))+f;for(var e=t.directory.split("/"),u=n.directory.split("/"),o="",r=0,i=0;i<e.length&&i<u.length&&e[i]==u[i];i++);for(r=0;r<e.length-i-1;r++)o+="../";for(r=i;r<u.length-1;r++)o+=u[r]+"/";return(o||(n.file?"":"./"))+f},toAbsolute:function(n){return n=new URI(n),n&&n.set("directory","").set("file",""),this.toRelative(n)},toRelative:function(n){return this.get("value",new URI(n))}}),function(){var n=this.Asset={javascript:function(n,t){t||(t={});var i=new Element("script",{src:n,type:"text/javascript"}),u=t.document||document,r=t.onload||t.onLoad;return delete t.onload,delete t.onLoad,delete t.document,r&&(i.addEventListener?i.addEvent("load",r):i.addEvent("readystatechange",function(){["loaded","complete"].contains(this.readyState)&&r.call(this)})),i.set(t).inject(u.head)},css:function(n,t){var i;t||(t={});var r=t.onload||t.onLoad,o=t.document||document,s=t.timeout||3e3;if(["onload","onLoad","document"].each(function(n){delete t[n]}),i=new Element("link",{type:"text/css",rel:"stylesheet",media:"screen",href:n}).setProperties(t).inject(o.head),r){var u=!1,f=0,e=function(){for(var t,h,o=document.styleSheets,n=0;n<o.length;n++)if(t=o[n],h=t.ownerNode?t.ownerNode:t.owningElement,h&&h==i)return u=!0,r.call(i);return f++,!u&&s/50>f?setTimeout(e,50):void 0};setTimeout(e,0)}return i},image:function(n,t){t||(t={});var i=new Image,r=document.id(i)||new Element("img");return["load","abort","error"].each(function(n){var u="on"+n,f="on"+n.capitalize(),e=t[u]||t[f]||function(){};delete t[f];delete t[u];i[u]=function(){i&&(r.parentNode||(r.width=i.width,r.height=i.height),i=i.onload=i.onabort=i.onerror=null,e.delay(1,r,r),r.fireEvent(n,r,1))}}),i.src=r.src=n,i&&i.complete&&i.onload.delay(1),r.set(t)},images:function(t,i){t=Array.convert(t);var u=function(){},r=0;return i=Object.merge({onComplete:u,onProgress:u,onError:u,properties:{}},i),new Elements(t.map(function(u,f){return n.image(u,Object.append(i.properties,{onload:function(){r++;i.onProgress.call(this,r,f,u);r==t.length&&i.onComplete()},onerror:function(){r++;i.onError.call(this,r,f,u);r==t.length&&i.onComplete()}}))}))}}}(),function(){var n=this.Color=new Type("Color",function(n,t){switch(arguments.length>=3?(t="rgb",n=Array.slice(arguments,0,3)):"string"==typeof n&&(n=n.match(/rgb/)?n.rgbToHex().hexToRgb(!0):n.match(/hsb/)?n.hsbToRgb():n.hexToRgb(!0)),t=t||"rgb"){case"hsb":var i=n;n=n.hsbToRgb();n.hsb=i;break;case"hex":n=n.hexToRgb(!0)}return n.rgb=n.slice(0,3),n.hsb=n.hsb||n.rgbToHsb(),n.hex=n.rgbToHex(),Object.append(n,this)});n.implement({mix:function(){var t=Array.slice(arguments),r="number"==typeOf(t.getLast())?t.pop():50,i=this.slice();return t.each(function(t){t=new n(t);for(var u=0;3>u;u++)i[u]=Math.round(i[u]/100*(100-r)+t[u]/100*r)}),new n(i,"rgb")},invert:function(){return new n(this.map(function(n){return 255-n}))},setHue:function(t){return new n([t,this.hsb[1],this.hsb[2]],"hsb")},setSaturation:function(t){return new n([this.hsb[0],t,this.hsb[2]],"hsb")},setBrightness:function(t){return new n([this.hsb[0],this.hsb[1],t],"hsb")}});this.$RGB=function(t,i,r){return new n([t,i,r],"rgb")};this.$HSB=function(t,i,r){return new n([t,i,r],"hsb")};this.$HEX=function(t){return new n(t,"hex")};Array.implement({rgbToHsb:function(){var i=this[0],r=this[1],f=this[2],t=0,n=Math.max(i,r,f),c=Math.min(i,r,f),u=n-c,l=n/255,e=0!=n?u/n:0;if(0!=e){var o=(n-i)/u,s=(n-r)/u,h=(n-f)/u;t=i==n?h-s:r==n?2+o-h:4+s-o;t/=6;0>t&&t++}return[Math.round(360*t),Math.round(100*e),Math.round(100*l)]},hsbToRgb:function(){var n=Math.round(this[2]/100*255);if(0==this[1])return[n,n,n];var u=this[0]%360,f=u%60,t=Math.round(this[2]*(100-this[1])/1e4*255),i=Math.round(this[2]*(6e3-this[1]*f)/6e5*255),r=Math.round(this[2]*(6e3-this[1]*(60-f))/6e5*255);switch(Math.floor(u/60)){case 0:return[n,r,t];case 1:return[i,n,t];case 2:return[t,n,r];case 3:return[t,i,n];case 4:return[r,t,n];case 5:return[n,t,i]}return!1}});String.implement({rgbToHsb:function(){var n=this.match(/\d{1,3}/g);return n?n.rgbToHsb():null},hsbToRgb:function(){var n=this.match(/\d{1,3}/g);return n?n.hsbToRgb():null}})}(),function(){this.Group=new Class({initialize:function(){this.instances=Array.flatten(arguments)},addEvent:function(n,t){var u=this.instances,i=u.length,f=i,r=new Array(i),e=this;u.each(function(o,s){o.addEvent(n,function(){r[s]||f--;r[s]=arguments;f||(t.call(e,u,o,r),f=i,r=new Array(i))})})}})}(),Hash.Cookie=new Class({Extends:Cookie,options:{autoSave:!0},initialize:function(n,t){this.parent(n,t);this.load()},save:function(){var n=JSON.encode(this.hash);return!n||n.length>4096?!1:("{}"==n?this.dispose():this.write(n),!0)},load:function(){return this.hash=new Hash(JSON.decode(this.read(),!0)),this}}),Hash.each(Hash.prototype,function(n,t){"function"==typeof n&&Hash.Cookie.implement(t,function(){var t=n.apply(this.hash,arguments);return this.options.autoSave&&this.save(),t})}),function(){var n=this.Table=function(){this.length=0;var n=[],t=[];this.set=function(i,r){var f=n.indexOf(i),u;return-1==f?(u=n.length,n[u]=i,t[u]=r,this.length++):t[f]=r,this};this.get=function(i){var r=n.indexOf(i);return-1==r?null:t[r]};this.erase=function(i){var r=n.indexOf(i);return-1!=r?(this.length--,n.splice(r,1),t.splice(r,1)[0]):null};this.each=this.forEach=function(i,r){for(var u=0,f=this.length;f>u;u++)i.call(r,n[u],t[u],this)}};this.Type&&new Type("Table",n)}(),"Affinity"in window||(window.Affinity={}),typeof console=="undefined"&&(console={log:function(){}}),typeof MooTools=="undefined")throw new ReferenceError("This site requires MooTools 1.4.5 and MooTools.More 1.4.0.1");doc=document.documentElement;doc.setAttribute("data-useragent",navigator.userAgent);"events"in Affinity||(Affinity.events={});Affinity.mobile=!1;Affinity.events={over:"mouseover",out:"mouseout",overAll:"mouseenter",outAll:"mouseleave",start:"mousedown",move:"mousemove",end:"mouseup",click:"click"};Affinity.icons={AddToList:"&#xe096;",Air:"&#xe047;",Alarm:"&#xe855;",AlarmAdd:"&#xe856;",Archive:"&#xe0a2;",ArrowDown:"&#xe0c0;",ArrowDownCircle:"&#xe0c8;",ArrowDownSmall:"&#xe0c4;",ArrowLeft:"&#xe0bf;",ArrowLeftCircle:"&#xe0c7;",ArrowLeftSmall:"&#xe0c3;",ArrowLineBigDown:"&#xe0d8;",ArrowLineBigLeft:"&#xe0d7;",ArrowLineBigRight:"&#xe0da;",ArrowLineBigUp:"&#xe0d9;",ArrowLineDown:"&#xe0d0;",ArrowLineLeft:"&#xe0cf;",ArrowLineRight:"&#xe0d2;",ArrowLineSmallDown:"&#xe0d4;",ArrowLineSmallLeft:"&#xe0d3;",ArrowLineSmallRight:"&#xe0d6;",ArrowLineSmallUp:"&#xe0d5;",ArrowLineUp:"&#xe0d1;",ArrowLongDown:"&#xe0dc;",ArrowLongLeft:"&#xe0db;",ArrowLongRight:"&#xe0de;",ArrowLongUp:"&#xe0dd;",ArrowRight:"&#xe0c2;",ArrowRightCircle:"&#xe0ca;",ArrowRightSmall:"&#xe0c6;",ArrowUp:"&#xe0c1;",ArrowUpCircle:"&#xe0c9;",ArrowUpSmall:"&#xe0c5;",ArrowheadDown:"&#xe0cc;",ArrowheadLeft:"&#xe0cb;",ArrowheadRight:"&#xe0ce;",ArrowheadUp:"&#xe0cd;",ArrowheadUpDown:"&#xe0df;",Back:"&#xe093;",Bag:"&#xe03b;",Barcode:"&#xe0fc;",Battery:"&#xe04d;",Bell:"&#xe029;",Blocked:"&#xe084;",Book:"&#xe039;",Book2:"&#xe0ac;",Bookmark:"&#xe0aa;",Bookmarks:"&#xe0ab;",Box:"&#xe06a;",Braces:"&#xe104;",Briefcase:"&#xe046;",Brightness:"&#xe060;",BrogressThird:"&#xe05c;",Browser:"&#xe058;",Brush:"&#xe053;",Bucket:"&#xe04e;",BulletList:"&#xe095;",Calendar:"&#xe041;",Camera:"&#xe030;",Cancel:"&#xe083;",Car:"&#xe909;",Cart:"&#xe069;",Cc:"&#xe0e3;",CcBy:"&#xe0e4;",CcNc:"&#xe0e5;",CcNcEu:"&#xe0e6;",CcNcJp:"&#xe0e7;",CcNd:"&#xe0e9;",CcPd:"&#xe0ea;",CcSa:"&#xe0e8;",CcShare:"&#xe0ec;",CcShare3:"&#xe0ed;",CcZero:"&#xe0eb;",Ccw:"&#xe08c;",Cd:"&#xe045;",Chat:"&#xe021;",Clipboard:"&#xe068;",Clock:"&#xe03f;",Cloud:"&#xe0a8;",Code:"&#xe061;",CodeA:"&#xe0ee;",CodeD:"&#xe0f0;",CodeH:"&#xe0ef;",CodeM:"&#xe10e;",CodeP:"&#xe10f;",CodeR:"&#xe0f1;",CodeS:"&#xe0f2;",Cog:"&#xe02c;",Comment:"&#xe022;",Compare:"&#xe103;",Compass:"&#xe016;",Cone:"&#xe055;",CreditCard:"&#xe065;",Cross:"&#xe07a;",CrossRound:"&#xe080;",CrossSquare:"&#xe07d;",Csharp:"&#xe0ff;",Cup:"&#xe051;",Cw:"&#xe08b;",Cycle:"&#xe08a;",Database:"&#xe066;",Directions:"&#xe005;",Docs:"&#xe09c;",DollarRound:"&#xe0fe;",Dot:"&#xe0e2;",Dots:"&#xe0e1;",DotsVert:"&#xe000;",Download:"&#xe0a5;",Drive:"&#xe050;",Droplet:"&#xe044;",Droplets:"&#xe06f;",Earth:"&#xe056;",Education:"&#xe038;",Eightball:"&#xe901;",Ellipsis:"&#xe0e0;",EmptyInbox:"&#xe00b;",Export:"&#xe013;",Extension:"&#xe87b;",Eye:"&#xe03e;",Feather:"&#xe009;",FieldEdit:"&#xe001;",FileExcel:"&#xe908;",FilePdf:"&#xe902;",FileWord:"&#xe907;",First:"&#xe0b3;",Flag:"&#xe02b;",Flashlight:"&#xe027;",FlowBranch:"&#xe0bb;",FlowCascade:"&#xe0ba;",FlowLine:"&#xe0bd;",FlowParallel:"&#xe0be;",FlowTree:"&#xe0bc;",Folder:"&#xe0a1;",Forward:"&#xe00e;",Gauge:"&#xe049;",Ghost:"&#xe0fa;",Gift:"&#xe105;",GraphBars:"&#xe073;",GraphLinefill:"&#xe074;",GraphPie:"&#xe072;",GraphStatistics:"&#xe071;",Grid:"&#xe070;",HeartEmpty:"&#xe01c;",HeartFull:"&#xe01b;",HelpRound:"&#xe088;",History:"&#xe092;",Hourglass:"&#xe048;",House:"&#xe024;",Incident:"&#xe548;",Infinity:"&#xe063;",Info:"&#xe085;",InfoRound:"&#xe086;",Install:"&#xe0a7;",Key:"&#xe04c;",Keyboard:"&#xe057;",Kiwi:"&#xe102;",Lab:"&#xe903;",Landscape:"&#xe09d;",Language:"&#xe04a;",Last:"&#xe0b4;",Layout:"&#xe097;",Leaf:"&#xe034;",LifeRing:"&#xe03d;",LightBulb:"&#xe064;",Lightning:"&#xe042;",Link:"&#xe02a;",List:"&#xe098;",Location:"&#xe014;",LocationArrow:"&#xe017;",Lock:"&#xe075;",LockApproved:"&#xe90c;",LockDeclined:"&#xe90d;",LockOpen:"&#xe90a;",LockPaid:"&#xe90e;",LockSubmitted:"&#xe90b;",Login:"&#xe078;",Logout:"&#xe077;",Loop:"&#xe091;",Magnet:"&#xe04f;",Mail:"&#xe006;",Map:"&#xe015;",Megaphone:"&#xe031;",Microphone:"&#xe040;",Minus:"&#xe081;",MinusRound:"&#xe07e;",MinusSquare:"&#xe07b;",Mobile:"&#xe003;",Moneybag:"&#xe0fd;",Moon:"&#xe032;",MoreLeft:"&#xe10a;",MoreRight:"&#xe10d;",Mouse:"&#xe004;",Music:"&#xe036;",MusicSemi:"&#xe035;",MusicSquare:"&#xe0a0;",Mute:"&#xe0b9;",Network:"&#xe04b;",New:"&#xe037;",Newspaper:"&#xe03a;",Next:"&#xe0b1;",Page:"&#xe099;",PageEmpty:"&#xe09b;",PageFull:"&#xe09a;",Palette:"&#xe033;",Paperclip:"&#xe00a;",Paperplane:"&#xe007;",Pause:"&#xe0ae;",Pencil:"&#xe008;",Phone:"&#xe002;",Pictures:"&#xe09e;",Pin:"&#xe904;",Plane:"&#xe03c;",Play:"&#xe0ad;",Plugin:"&#xe905;",Plus:"&#xe082;",PlusRound:"&#xe07f;",PlusSquare:"&#xe07c;",Poop:"&#xe101;",Popup:"&#xe025;",Previous:"&#xe0b2;",Printer:"&#xe028;",ProgressEmpty:"&#xe05d;",ProgressFull:"&#xe05a;",ProgressHalf:"&#xe05b;",Prompt:"&#xe109;",PromptAlert:"&#xe10c;",PromptInfo:"&#xe10b;",Publish:"&#xe059;",Qrcode:"&#xe0fb;",Question:"&#xe087;",Quote:"&#xe023;",Record:"&#xe0af;",Repeat:"&#xe090;",Reply:"&#xe00c;",ReplyAll:"&#xe00d;",ResizeEnlarge:"&#xe0b5;",ResizeShrink:"&#xe0b6;",Return:"&#xe08f;",ReturnBack:"&#xe08e;",Rocket:"&#xe052;",Rss:"&#xe06c;",Save:"&#xe0a6;",Scaledown:"&#xe107;",Scaleup:"&#xe108;",Schedule:"&#xe900;",Screen:"&#xe062;",Search:"&#xe026;",Sharable:"&#xe01a;",Share:"&#xe019;",Shield:"&#xe906;",Shuffle:"&#xe08d;",Sound:"&#xe0b8;",StarEmpty:"&#xe01e;",StarFull:"&#xe01d;",Stop:"&#xe0b0;",Suitcase:"&#xe054;",Sun:"&#xe05f;",SunSmall:"&#xe05e;",Switch:"&#xe094;",Sync:"&#xe100;",Tag:"&#xe02f;",Target:"&#xe018;",Thermometer:"&#xe06e;",ThumbsDown:"&#xe020;",ThumbsUp:"&#xe01f;",Thunder:"&#xe043;",Tick:"&#xe079;",Ticket:"&#xe06b;",Tools:"&#xe02d;",Traffic:"&#xe565;",Trash:"&#xe0a3;",Trophy:"&#xe02e;",Upload:"&#xe0a4;",Upload2:"&#xe0a9;",User:"&#xe0f3;",UserAdd:"&#xe0f5;",UserAddOld:"&#xe011;",UserBlock:"&#xe0f7;",UserBoss:"&#xe0f8;",UserCheck:"&#xe18a;",UserCheckOutline:"&#xe18b;",UserDel:"&#xe0f6;",UserOld:"&#xe00f;",Users:"&#xe0f4;",UsersOld:"&#xe010;",Vcard:"&#xe012;",Video:"&#xe09f;",Voicemail:"&#xe067;",Volume:"&#xe0b7;",Warning:"&#xe089;",Wireless:"&#xe06d;",Wrench:"&#xe0f9;",Zzz:"&#xe106;"};window.UIIcons||(window.UIIcons=Affinity.icons);Affinity.icons.getIcon=function(n,t){return n&&n in Affinity.icons?Affinity.icons[n]:n&&(n=n.replace("icon","").trim().camelCase(),n in Affinity.icons)?Affinity.icons[n]:t&&t in Affinity.icons?Affinity.icons[t]:""};Affinity.appname="none";Affinity.apiversion=1;Affinity.urlroot="";Affinity.authroot="";Affinity.apiroot="";Affinity.zelosroot="";Affinity.lookupapi="";Affinity.uisession=String.uniqueID();Affinity.uiready=!1;Affinity.login=null;Affinity.datalist=!1;Affinity.loaders={};Affinity.loaders.dark="data:image/gif;base64,R0lGODlhEAAQAPQAADMzM8zMzDs7O3h4eERERKGhoYKCgszMzJaWlra2tmNjY1lZWb+/v21tbcjIyKqqqoyMjAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==";Affinity.loaders.light="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zMzM/Ly8qGhoebm5mpqapSUlDMzM3l5eU9PT7y8vMrKykJCQq+vrzY2Nl5eXoaGhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==";Affinity.loaders.blue="data:image/gif;base64,R0lGODlhEAAQAPQAAJrS7v///5/U7sfm9aXX7+Lx+c3o9v///9vu+O/3+7rg87Pd8vb6/MDi9Pz9/ej0+tXr9wAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==";Affinity.loaders.large={};Affinity.loaders.large.light="data:image/gif;base64,R0lGODlhIAAgAPMAAO/v7wAAALq6unx8fKurq5CQkDIyMlBQUMvLy9bW1rCwsBwcHAMDAwAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==";Affinity.loaders.large.dark="data:image/gif;base64,R0lGODlhIAAgAPMAADMzM////19fX5SUlGxsbIKCgtLS0rm5uVFRUUdHR2dnZ+bm5vr6+gAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAIAAgAAAE5xDISWlhperN52JLhSSdRgwVo1ICQZRUsiwHpTJT4iowNS8vyW2icCF6k8HMMBkCEDskxTBDAZwuAkkqIfxIQyhBQBFvAQSDITM5VDW6XNE4KagNh6Bgwe60smQUB3d4Rz1ZBApnFASDd0hihh12BkE9kjAJVlycXIg7CQIFA6SlnJ87paqbSKiKoqusnbMdmDC2tXQlkUhziYtyWTxIfy6BE8WJt5YJvpJivxNaGmLHT0VnOgSYf0dZXS7APdpB309RnHOG5gDqXGLDaC457D1zZ/V/nmOM82XiHRLYKhKP1oZmADdEAAAh+QQJCgAAACwAAAAAIAAgAAAE6hDISWlZpOrNp1lGNRSdRpDUolIGw5RUYhhHukqFu8DsrEyqnWThGvAmhVlteBvojpTDDBUEIFwMFBRAmBkSgOrBFZogCASwBDEY/CZSg7GSE0gSCjQBMVG023xWBhklAnoEdhQEfyNqMIcKjhRsjEdnezB+A4k8gTwJhFuiW4dokXiloUepBAp5qaKpp6+Ho7aWW54wl7obvEe0kRuoplCGepwSx2jJvqHEmGt6whJpGpfJCHmOoNHKaHx61WiSR92E4lbFoq+B6QDtuetcaBPnW6+O7wDHpIiK9SaVK5GgV543tzjgGcghAgAh+QQJCgAAACwAAAAAIAAgAAAE7hDISSkxpOrN5zFHNWRdhSiVoVLHspRUMoyUakyEe8PTPCATW9A14E0UvuAKMNAZKYUZCiBMuBakSQKG8G2FzUWox2AUtAQFcBKlVQoLgQReZhQlCIJesQXI5B0CBnUMOxMCenoCfTCEWBsJColTMANldx15BGs8B5wlCZ9Po6OJkwmRpnqkqnuSrayqfKmqpLajoiW5HJq7FL1Gr2mMMcKUMIiJgIemy7xZtJsTmsM4xHiKv5KMCXqfyUCJEonXPN2rAOIAmsfB3uPoAK++G+w48edZPK+M6hLJpQg484enXIdQFSS1u6UhksENEQAAIfkECQoAAAAsAAAAACAAIAAABOcQyEmpGKLqzWcZRVUQnZYg1aBSh2GUVEIQ2aQOE+G+cD4ntpWkZQj1JIiZIogDFFyHI0UxQwFugMSOFIPJftfVAEoZLBbcLEFhlQiqGp1Vd140AUklUN3eCA51C1EWMzMCezCBBmkxVIVHBWd3HHl9JQOIJSdSnJ0TDKChCwUJjoWMPaGqDKannasMo6WnM562R5YluZRwur0wpgqZE7NKUm+FNRPIhjBJxKZteWuIBMN4zRMIVIhffcgojwCF117i4nlLnY5ztRLsnOk+aV+oJY7V7m76PdkS4trKcdg0Zc0tTcKkRAAAIfkECQoAAAAsAAAAACAAIAAABO4QyEkpKqjqzScpRaVkXZWQEximw1BSCUEIlDohrft6cpKCk5xid5MNJTaAIkekKGQkWyKHkvhKsR7ARmitkAYDYRIbUQRQjWBwJRzChi9CRlBcY1UN4g0/VNB0AlcvcAYHRyZPdEQFYV8ccwR5HWxEJ02YmRMLnJ1xCYp0Y5idpQuhopmmC2KgojKasUQDk5BNAwwMOh2RtRq5uQuPZKGIJQIGwAwGf6I0JXMpC8C7kXWDBINFMxS4DKMAWVWAGYsAdNqW5uaRxkSKJOZKaU3tPOBZ4DuK2LATgJhkPJMgTwKCdFjyPHEnKxFCDhEAACH5BAkKAAAALAAAAAAgACAAAATzEMhJaVKp6s2nIkolIJ2WkBShpkVRWqqQrhLSEu9MZJKK9y1ZrqYK9WiClmvoUaF8gIQSNeF1Er4MNFn4SRSDARWroAIETg1iVwuHjYB1kYc1mwruwXKC9gmsJXliGxc+XiUCby9ydh1sOSdMkpMTBpaXBzsfhoc5l58Gm5yToAaZhaOUqjkDgCWNHAULCwOLaTmzswadEqggQwgHuQsHIoZCHQMMQgQGubVEcxOPFAcMDAYUA85eWARmfSRQCdcMe0zeP1AAygwLlJtPNAAL19DARdPzBOWSm1brJBi45soRAWQAAkrQIykShQ9wVhHCwCQCACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiRMDjI0Fd30/iI2UA5GSS5UDj2l6NoqgOgN4gksEBgYFf0FDqKgHnyZ9OX8HrgYHdHpcHQULXAS2qKpENRg7eAMLC7kTBaixUYFkKAzWAAnLC7FLVxLWDBLKCwaKTULgEwbLA4hJtOkSBNqITT3xEgfLpBtzE/jiuL04RGEBgwWhShRgQExHBAAh+QQJCgAAACwAAAAAIAAgAAAE7xDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfZiCqGk5dTESJeaOAlClzsJsqwiJwiqnFrb2nS9kmIcgEsjQydLiIlHehhpejaIjzh9eomSjZR+ipslWIRLAgMDOR2DOqKogTB9pCUJBagDBXR6XB0EBkIIsaRsGGMMAxoDBgYHTKJiUYEGDAzHC9EACcUGkIgFzgwZ0QsSBcXHiQvOwgDdEwfFs0sDzt4S6BK4xYjkDOzn0unFeBzOBijIm1Dgmg5YFQwsCMjp1oJ8LyIAACH5BAkKAAAALAAAAAAgACAAAATwEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GGl6NoiPOH16iZKNlH6KmyWFOggHhEEvAwwMA0N9GBsEC6amhnVcEwavDAazGwIDaH1ipaYLBUTCGgQDA8NdHz0FpqgTBwsLqAbWAAnIA4FWKdMLGdYGEgraigbT0OITBcg5QwPT4xLrROZL6AuQAPUS7bxLpoWidY0JtxLHKhwwMJBTHgPKdEQAACH5BAkKAAAALAAAAAAgACAAAATrEMhJaVKp6s2nIkqFZF2VIBWhUsJaTokqUCoBq+E71SRQeyqUToLA7VxF0JDyIQh/MVVPMt1ECZlfcjZJ9mIKoaTl1MRIl5o4CUKXOwmyrCInCKqcWtvadL2SYhyASyNDJ0uIiUd6GAULDJCRiXo1CpGXDJOUjY+Yip9DhToJA4RBLwMLCwVDfRgbBAaqqoZ1XBMHswsHtxtFaH1iqaoGNgAIxRpbFAgfPQSqpbgGBqUD1wBXeCYp1AYZ19JJOYgH1KwA4UBvQwXUBxPqVD9L3sbp2BNk2xvvFPJd+MFCN6HAAIKgNggY0KtEBAAh+QQJCgAAACwAAAAAIAAgAAAE6BDISWlSqerNpyJKhWRdlSAVoVLCWk6JKlAqAavhO9UkUHsqlE6CwO1cRdCQ8iEIfzFVTzLdRAmZX3I2SfYIDMaAFdTESJeaEDAIMxYFqrOUaNW4E4ObYcCXaiBVEgULe0NJaxxtYksjh2NLkZISgDgJhHthkpU4mW6blRiYmZOlh4JWkDqILwUGBnE6TYEbCgevr0N1gH4At7gHiRpFaLNrrq8HNgAJA70AWxQIH1+vsYMDAzZQPC9VCNkDWUhGkuE5PxJNwiUK4UfLzOlD4WvzAHaoG9nxPi5d+jYUqfAhhykOFwJWiAAAIfkECQoAAAAsAAAAACAAIAAABPAQyElpUqnqzaciSoVkXVUMFaFSwlpOCcMYlErAavhOMnNLNo8KsZsMZItJEIDIFSkLGQoQTNhIsFehRww2CQLKF0tYGKYSg+ygsZIuNqJksKgbfgIGepNo2cIUB3V1B3IvNiBYNQaDSTtfhhx0CwVPI0UJe0+bm4g5VgcGoqOcnjmjqDSdnhgEoamcsZuXO1aWQy8KAwOAuTYYGwi7w5h+Kr0SJ8MFihpNbx+4Erq7BYBuzsdiH1jCAzoSfl0rVirNbRXlBBlLX+BP0XJLAPGzTkAuAOqb0WT5AH7OcdCm5B8TgRwSRKIHQtaLCwg1RAAAOwAAAAAAAAAAAA==";Affinity.agent=window.navigator.userAgent;Affinity.oldess=!1;Affinity.oldessLaunched=!1;Affinity.oldessFrame=!1;Affinity.oldessWindow=!1;Affinity.UI={};Affinity.UI.lookups={};Affinity.UI.lookupLoaders=[];Affinity.UI.displaylookups={};Affinity.UI.displaylookupLoaders=[];Affinity.UI.dependancies={};Affinity.UI.dependancyLoaders=[];Affinity.UI.autocomplete={};Affinity.UI.lastAutoKill={};Affinity.UI.delayAutoKill=function(n,t){document.getElement("."+t)&&(document.getElement("."+t).removeEvents(),document.getElement("."+t).destroy());window.Affinity.UI.lastAutoKill[n]=null;delete window.Affinity.UI.lastAutoKill[n]};datalistTest=document.createElement("datalist");"options"in datalistTest&&(Affinity.datalist=!0);datalistTest=null;delete datalistTest;Affinity.UI.scrolling=!1;Affinity.UI.autoscroll=function(n){var t=window;if(Affinity.oldessFrame)try{t=window.parent.window}catch(f){}try{var i=t.document.documentElement,r=t.document.body,u=i&&i.scrollTop||r&&r.scrollTop||0;n>0&&t.scrollTo(0,u+10);n<0&&t.scrollTo(0,u-10)}catch(f){}};document.addEvent(Affinity.events.move,function(n){var h,c,r;if(Affinity.UI.drageventFired){var u=n.client.y,i=window.innerHeight||window.document.documentElement.clientHeight,f=50,e=i-50;if(Affinity.oldessFrame)try{var t=window.parent,o=t.document.documentElement,s=t.document.body;i=t.innerHeight||t.document.documentElement.clientHeight;h=o&&o.scrollTop||s&&s.scrollTop||0;r=t.document.getElementById("ctl00_MainPanel");c=document.documentMode&&document.documentMode<9?r.querySelectorAll(".ContentBody")[0]:r.getElementsByClassName("ContentBody")[0];var a=c.offsetTop,l=h-a,f=50+l,e=l+i-50}catch(n){}u>e?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[1])):u<f?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[-1])):Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}});document.addEvent(Affinity.events.end,function(){Affinity.UI.drageventFired=!1;Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))});Affinity.Konami=new Class({Implements:[Options],options:{onSuccess:function(){}},input:"",pattern:"38384040373937396665",initialize:function(n){this.setOptions(n);document.addEvent("keydown",function(n){this.input+=n.code;this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length));this.input==this.pattern&&this.options.onSuccess()}.bind(this))}});Affinity.RickRoll=new Class({Implements:[Options],Binds:["inject","destroy"],options:{},input:"",ytBox:!1,pattern:"8273677582797676",initialize:function(n){this.setOptions(n);document.addEvent("keydown",function(n){this.input+=n.code;this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length));this.input==this.pattern&&this.inject()}.bind(this))},inject:function(){this.destroy();this.ytBox=new Element("div").setStyles({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.8)","text-align":"center","z-index":99999999999}).inject(document.body,"bottom").set("html",'<iframe width="420" height="315" style="position:fixed;top:50%;left:50%;margin:-157px 0 0 -210px;" src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?rel=0&amp;autoplay=1&amp;showinfo=0" frameborder="0" allowfullscreen><\/iframe>').addEvent("click",this.destroy)},destroy:function(){this.ytBox&&(this.ytBox.removeEvents(),this.ytBox.destroy())}});new Affinity.RickRoll;Affinity.CookieMonster=new new Class({Read:function(n){var t,i;if(Affinity.isie){if(t=document.cookie.indexOf(n+"="),t!=-1)return t+=n.length+1,i=document.cookie.indexOf(";",t),i==-1&&(i=document.cookie.length),unescape(document.cookie.substring(t,i))}else return Cookie.read(n)},Write:function(n,t,i){var r=new URI(window.location.href).parsed.host,u=new Date;if(typeOf(i)!=="null"&&!isNaN(i)&&parseFloat(i)>0){var e=new Date(u.getTime()+i*6e4),o=u.toUTCString(),f=e.toUTCString();log("&#169; Cookie Write Expires - name: "+n+", value: "+t);log("  expires: "+f+", now: "+o+", expires value: "+i+", in days: "+parseFloat(i)/1440+", domain: "+r);Affinity.isie?document.cookie=n+"="+escape(t)+"; expires="+f+"; domain:"+r:Cookie.write(n,t,{duration:parseFloat(i)/1440})}else log("&#169; Cookie Write - name: "+n+", value: "+t),Affinity.isie?document.cookie=n+"="+escape(t)+";":Cookie.write(n,t)},Delete:function(n){if(log("&#169; Cookie Delete - name: "+n),Affinity.isie){document.cookie=n+"=; expires=Thu, 01-Jan-70 00:00:01 GMT;";try{Cookie.dispose(n)}catch(t){}}else Cookie.dispose(n)}});Affinity.logger=new new Class({Binds:["build","enable","disable","log","clear","open","close"],enabled:!1,initialize:function(){window.log=function(){}},build:function(){if(!Affinity.uiready){window.removeEvent("UiReady",this.build);window.addEvent("UiReady",this.build);return}window.removeEvent("UiReady",this.build);document.id("_log")&&document.id("_log").destroy();document.id("_logbutton")&&document.id("_logbutton").destroy();this.logBox=new Element("div",{id:"_log"}).inject(document.body,"bottom");this.logsBox=new Element("div",{html:"","class":"logs"}).inject(this.logBox,"top");this.closeButton=new Element("div",{html:"close","class":"close"}).inject(this.logBox,"top");this.clearButton=new Element("div",{html:"clear","class":"clear"}).inject(this.logBox,"top");this.hiddenButton=new Element("div",{id:"_logbutton"}).inject(this.logBox,"after");this.hiddenButton.setStyles({position:"absolute",top:5,left:5,width:30,height:30,"z-index":9999999998});this.logBox.setStyles({position:"absolute",top:40,left:5,width:"80%",height:"80%",border:"1px solid black","background-color":"#fff",color:"000","z-index":9999999999,"-webkit-transform":"translateX(0)",transform:"translateX(0)",display:"none"});this.logsBox.setStyles({width:"100%",height:"100%",padding:10,overflow:"scroll","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"});this.clearButton.setStyles({position:"absolute",top:10,right:80,padding:5,"background-color":"#fff",cursor:"pointer"});this.closeButton.setStyles({position:"absolute",top:10,right:30,padding:5,"background-color":"#fff",cursor:"pointer"});this.closeButton.addEvent(Affinity.events.click,this.close);this.clearButton.addEvent(Affinity.events.click,this.clear);this.hiddenButton.addEvent(Affinity.events.click,this.open);this.log("// log started "+new Date);window.log=this.log;this.enabled=!0;window.fireEvent("LogReady")},enable:function(){this.destroy();this.build();this.open()},disable:function(){this.destroy()},log:function(n){if(this.enabled){var t=typeOf(n)==="object"||typeOf(n)==="array"?JSON.stringify(n,null,2):typeOf(n)==="element"?"element type: "+n.get("tag")+"\r\n"+JSON.stringify(n.getProperties("id","class","style","src","title","alt"),null,2):n;this.logsBox.adopt(new Element("<pre>",{html:t}))}},clear:function(){this.enabled&&(this.logsBox.empty(),this.log("// log cleared "+new Date))},open:function(){this.enabled&&(this.logBox.getStyle("display")==="none"?this.logBox.setStyle("display","block"):this.logBox.setStyle("display","none"))},close:function(){this.enabled&&(this.logBox.getStyle("display")==="block"?this.logBox.setStyle("display","none"):this.logBox.setStyle("display","block"))},destroy:function(){window.removeEvent("UiReady",this.build);this.enabled=!1;this.closeButton&&this.closeButton.remveEvents();this.clearButton&&this.clearButton.remveEvents();this.hiddenButton&&this.hiddenButton.remveEvents();this.logBox&&this.logBox.destroy();window.log=function(){}}});Affinity.SmartClose=new Class({Binds:["isActive","checkActive","isOver","setClose","overAll","outAll","windowClick"],over:!1,isOverCheckTimer:!1,initialize:function(n){if(Affinity.mobile)return"is mobile";this.class="smart-close-"+String.uniqueID();this.element=n;this.element.addClass(this.class);this.element.isOver=this.isOver;this.element.addEvent(Affinity.events.overAll,this.overAll);this.element.addEvent(Affinity.events.outAll,this.outAll);this.element.addEvent("focus",this.setClose)},isActive:function(){if(document.activeElement){if(document.activeElement===this.element||document.activeElement.getParent("."+this.class)===this.element)return!0}else return!1;return!0},checkActive:function(){this.isActive()||(this.over=!1,this.windowClick())},isOver:function(){return this.isActive()||(this.over=!1),this.over},setClose:function(){window.removeEvent(Affinity.events.click,this.windowClick);window.addEvent(Affinity.events.click,this.windowClick)},overAll:function(){clearTimeout(this.isOverCheckTimer);this.setClose();this.over=!0;this.isOverCheckTimer=this.checkActive.delay(1e3,this)},outAll:function(){clearTimeout(this.isOverCheckTimer);this.over=!1},windowClick:function(){this.over||(this.element.fireEvent("SmartClose"),window.removeEvent(Affinity.events.click,this.windowClick))}});Affinity.UI.mobileZooming=!1;Affinity.mobile&&window.addEvents({touchmove:function(n){n.touches.length===2&&(Affinity.UI.mobileZooming=!0)},touchend:function(){if(Affinity.UI.mobileZooming){var n=document.createEvent("HTMLEvents");n.initEvent("resize",!0,!1);window.dispatchEvent(n)}Affinity.UI.mobileZooming=!1}});Affinity.GetCacheSafePath=function(n){return!Affinity.isie||typeOf(n)!=="string"?n:n+(n.contains("?")?"&ran=":"?ran=")+String.uniqueID()+"-"+Date.parse(new Date).format("%s")};Locale.define("en-NZ","Date",{dateOrder:["date","month","year","/"],shortDate:"%D/%M/%Y",shortTime:"%I:%M%p",AM:"am",PM:"pm"}).inherit("en-US","Date");Locale.define("en-AU").inherit("en-NZ","Date");Locale.use("en-NZ");Date.implement({toZelos:function(){return Date.parse(this.format("%d/%m/%Y %H:%M:%S")).format("%Y-%m-%dT%H:%M:%S")},toTime:function(){try{return this.format("%k:%M:%S")}catch(n){return"Invalid Date"}},toTime24:function(){this.toTime()},toTime12:function(){try{return this.format("%l:%M:%S %p").toLowerCase()}catch(n){return"Invalid Date"}},toSimple:function(){try{return this.format("%d-%m-%Y")}catch(n){return"Invalid Date"}},toSimpleDateTime:function(){try{return this.format("%d-%m-%Y %k:%M:%S")}catch(n){return"Invalid Date"}},toServer:function(){try{return this.format("%d.%m.%Y %k:%M:%S %z")}catch(n){return"Invalid Date"}},toFriendly:function(){try{return this.format("%A %B %e%o %Y").replace(/  /gi," ")}catch(n){return"Invalid Date"}},toFriendlyShort:function(){try{return this.format("%a %b %e%o %Y").replace(/  /gi," ")}catch(n){return"Invalid Date"}},toWords:function(){try{return this.timeDiffInWords()}catch(n){return"Invalid Date"}},toWordsShort:function(){try{return this.timeDiffInWords().replace(/year/g,"yr").replace(/month/g,"mnth").replace(/hour/g,"hr").replace(/minute/g,"min").replace(/second/g,"sec").replace(/about/g,"")}catch(n){return"Invalid Date"}},matches:function(n,t,i){if(typeOf(n)!=="null"){var r=Date.parse(this),u=Date.parse(n);if(r&&u&&typeOf(r)=="date"&&typeOf(u)==="date"&&r.isValid()&&u.isValid()&&(typeOf(t)==="boolean"&&t&&(r=r.setSeconds(0),u=u.setSeconds(0)),typeOf(i)==="boolean"&&i&&(r=r.setMilliseconds(0),u=u.setMilliseconds(0)),r=r.getTime(),u=u.getTime(),r===u))return!0}return!1},sameDay:function(n){if(typeOf(n)!=="null"){var t=Date.parse(this),i=Date.parse(n);if(t&&i&&typeOf(t)=="date"&&typeOf(i)==="date"&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t===i))return!0}return!1}});Date.defineFormat("zelos",function(n){return n.toZelos()});Date.CurentYear=(new Date).get("year");Date.FormatStrings=[["christmas","12.25."+(Date.CurentYear+1)],["xmas","12.25."+(Date.CurentYear+1)],["newyear","1.1."+(Date.CurentYear+1)],["new year","1.1."+(Date.CurentYear+1)]];Date.TimeTravel=[["second",/(\+|\-)\s*[0-9]+( )*(seconds|second|sec|s)/],["minute",/(\+|\-)\s*[0-9]+( )*(minutes|minute|min|m)/],["hour",/(\+|\-)\s*[0-9]+( )*(hours|hour|h)/],["day",/(\+|\-)\s*[0-9]+( )*(days|day|d)/],["week",/(\+|\-)\s*[0-9]+( )*(weeks|week|w)/],["month",/(\+|\-)\s*[0-9]+( )*(months|month)/],["year",/(\+|\-)\s*[0-9]+( )*(years|year|y)/]];String.implement({toDate:function(){Locale.use("en-GB");var n,i,r,t;if(s=this.toLowerCase().trim(),s==="now")return new Date;for(s.contains("now ")&&(s=s.replace(/(now |today )/,(new Date).format("%k:%H:%S "))),/^\d+$/.test(s)&&s.length>=6&&(s=s.length>8?parseInt(s,10)*1e3+"":s.substr(0,2)+"."+s.substr(2,2)+"."+s.substr(4)),n=0;n<Date.FormatStrings.length;n++)if(s.contains(Date.FormatStrings[n][0])){s=s.replace(Date.FormatStrings[n][0],Date.FormatStrings[n][1]);break}for(n=0;n<Date.TimeTravel.length;n++)s.test(Date.TimeTravel[n][1])&&(i=s.match(Date.TimeTravel[n][1])[0],r=i.match(/[0-9]+/)[0],i.indexOf("+")&&(t=Date.parse(s.replace(i,"").trim()).decrement(Date.TimeTravel[n][0],parseFloat(r))),i.indexOf("-")&&(t=Date.parse(s.replace(i,"").trim()).increment(Date.TimeTravel[n][0],parseFloat(r))));t=t==null?Date.parse(s):t;try{return t.format("%s")==0?"Invalid Date":t}catch(u){return"Invalid Date"}}});Object.valueFromKeyString=function(n,t){var r,i,f,u;for(t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,""),r=t.split("."),i=0,f=r.length;i<f;++i)if(u=r[i],u in n)n=n[u];else return!1;return n};JSON.Unauthorized=function(n,t){var r=!1,i=typeOf(n);return(i==="object"||i==="array")&&(n=JSON.encode(n),i="string"),i==="string"&&(n.test("unauthorized","gi")||n.test("unauthorised","gi")||n.test("/(401/)","gi")||n.test("/(403/)","gi"))&&(log("&#x270B; json response is unauthorized"+(typeOf(t)!==null?" ("+unescape(t)+")":"")+" &#x270B;"),window.prompts&&Affinity.prompts.hide(),window.fireEvent("unauthorized"),r=!0),n=null,r};Element.implement({hasWidget:function(n){return this.retrieve(n)?!0:!1},getWidget:function(n){return this.retrieve(n)?this.retrieve(n):this.retrieve("widget")?this.retrieve("widget"):!1},destroyWidget:function(n){var t=this.getWidget(n);return t&&"destroy"in t&&t.destroy(),delete t,null},exists:function(){try{if(document.contains(this))return this}catch(n){}return!1}});DOMEvent.implement({getTarget:function(n){return this.target.hasClass(n)?this.target:this.target.get("id")===n?this.target:this.target.getParent("."+n)?this.target.getParent("."+n):this.target.getParent("#"+n)?this.target.getParent("#"+n):this.target}});Element.implement({hasEvent:function(n,t){var i=this.retrieve("events");switch(i&&i[n]&&(t==undefined||i[n].keys.contains(t))){case null:case!1:case undefined:case 0:return!1;default:return!0}}});Affinity.FormElement=new Class({Implements:[Options,Events],Binds:["clearEvents","setEvents","setValue","getValue","getDisplayValue","checkChanged","lookup","lookupComplete","destroy"],options:{},element:!1,dynamicContents:!1,dynamicFirstLoad:!0,defaultValue:"",changed:!1,initialize:function(n,t){this.setOptions(t);this.element=n;n.retrieve("defaultValue")||(this.element=n,this.setEvents(),this.defaultValue=n.value,this.element.store("defaultValue",this.defaultValue));this.element.store("widget",this);this.element.store("elementWidget",this);this.element.addClass("widget");this.lastValue=this.element.value},clearEvents:function(){this.element.removeEvent("input",this.checkChanged);this.element.removeEvent("lookup",this.lookup);this.element.removeEvent("lookupComplete",this.lookupComplete);this.element.removeEvent("change",this.checkChanged);this.element.removeEvent("blur",this.checkChanged)},setEvents:function(){this.clearEvents();this.element.get("list")?this.element.addEvent("input",this.checkChanged):(this.element.addEvent("lookup",this.lookup),this.element.addEvent("lookupComplete",this.lookupComplete),this.element.addEvent("change",this.checkChanged),this.element.addEvent("blur",this.checkChanged))},getValue:function(){return this.element.value},setValue:function(n){this.element.value=n;this.defaultValue=this.element.value;this.lastValue=this.element.value;this.element.store("defaultValue",this.defaultValue);this.changed=!1},getDisplayValue:function(){return this.element.value},checkChanged:function(n){var t;return t=typeOf(n)!=="null"&&typeOf(n.target)!=="null"?n.target.value:this.element.value,t+""!=this.defaultValue+""?(this.changed=!0,(this.lastValue=this.element.value)&&this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:n}),this.lastValue=this.element.value):(this.changed=!1,this.element.fireEvent("restored",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"restored",originalEvent:n}),this.lastValue=this.element.value),this.changed},lookup:function(){this.dynamicContents=!0},lookupComplete:function(n){this.dynamicFirstLoad&&(this.defaultValue=n.defaultValue,this.element.store("defaultValue",this.defaultValue),this.dynamicFirstLoad=!1);this.checkChanged({target:this.element})},destroy:function(){this.clearEvents();this.element.eliminate("defaultValue");this.element.eliminate("elementWidget")}});Element.implement({makeFormElement:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.FormElement(this),this}});Affinity.ElementValueTracker=new Class({Implements:[Options,Events],Binds:["__removeEvents","__addEvents","__elementChanged","__elementBlured","__doChangeCheck","__doChangeCheckThrottled","addElement","removeElement","setValue","hasChanged","hasRestored","getValue","getDefault","getLast","changeStatus"],options:{},elements:[],values:[],valuesDefault:[],valuesLast:[],id:!1,initialize:function(n){this.id=String.uniqueID();n&&!n.hasClass("has-change-tracker")&&this.addElement(n)},__removeEvents:function(n){n.removeEvent("change",this.__elementChanged);n.removeEvent("blur",this.__elementBlured)},__addEvents:function(n){n.addEvent("change",this.__elementChanged);n.addEvent("blur",this.__elementBlured)},__cloneValue:function(n){var i=typeOf(n)==="number"?!0:!1,t=(n+"").trim();return i?parseFloat(t):t},__sanatiseValue:function(n){try{return n===null||n===undefined||n.trim()===""?"":n}catch(t){return n}},__isSame:function(n,t){return(n+"").trim().toLowerCase()===(t+"").trim().toLowerCase()},__doChangeCheck:function(n){clearTimeout(this.__doChangeCheckThrottle);this.__doChangeCheckThrottle=this.__doChangeCheckThrottled.delay(100,this,[n])},__doChangeCheckThrottle:!1,__doChangeCheckThrottled:function(n){if(n&&["object","event","domevent"].contains(typeOf(n))&&"target"in n&&this.elements.indexOf(n.target)>-1){var t,i;Array.each(this.elements,function(n,r){t=i=!1;this.values[r]=this.__sanatiseValue(n.value);this.__isSame(this.values[r],this.valuesDefault[r])?i=!0:t=!0;t&&(n.removeClass("value-restored").addClass("value-changed"),n.fireEvent("ElementChanged",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),this.fireEvent("ElementChanged",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),window.fireEvent("AnElementChanged",{target:this.elements[r],value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}));i&&(n.removeClass("value-changed").addClass("value-restored"),n.fireEvent("ElementRestored",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),this.fireEvent("ElementRestored",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),window.fireEvent("AnElementRestored",{target:this.elements[r],value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}));this.valuesLast[r]=this.values[r]}.bind(this))}},__elementChanged:function(n){this.__doChangeCheck(n)},__elementBlured:function(n){this.__doChangeCheck(n)},addElement:function(n){if(!n.retrieve("changetracker")){var t="value"in n?n.value:"",i=n.get("data-default-value")?n.get("data-default-value"):t;this.elements.indexOf(n)===-1?(this.elements.push(n),this.values.push(t),this.valuesDefault.push(i),this.valuesLast.push(t),this.__removeEvents(n),this.__addEvents(n),n.addClass("has-change-tracker"),n.store("changetracker",this)):this.setValue(n,t)}},removeElement:function(n){if(this.elements.indexOf(n)!==-1){var t=this.elements.indexOf(n);this.elements.splice(t,1);this.values.splice(t,1);this.valuesLast.splice(t,1);this.valuesDefault.splice(t,1);this.__removeEvents(n);n.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker");n.eliminate("changetracker")}},setValue:function(n,t){if(this.elements.indexOf(n)!==-1){var i=this.elements.indexOf(n);n.value=t;n.removeClass("value-restored").removeClass("value-changed");this.values[i]=t;this.valuesDefault[i]=t;this.valuesLast[i]=t;this.__removeEvents(n);this.__addEvents(n)}else this.addElement(n)},hasChanged:function(){var n=!1;return Array.each(this.elements,function(t,i){t.hasClass("value-changed")&&(n=!0);this.__isSame(this.values[i],this.valuesDefault[i])||(n=!0)}.bind(this)),n},hasRestored:function(){var n=!1;return Array.each(this.elements,function(t){t.hasClass("value-restored")&&(n=!0)}.bind(this)),n},getValue:function(n){var t=this.elements.indexOf(n);if(t!==-1)return this.values[t];throw new Error("Target element not tracked");},getDefault:function(n){var t=this.elements.indexOf(n);if(t!==-1)return this.valuesDefault[t];throw new Error("Target element not tracked");},getLast:function(n){var t=this.elements.indexOf(n);if(t!==-1)return this.valuesLast[t];throw new Error("Target element not tracked");},changeStatus:function(){return{changed:this.hasChanged(),restored:this.hasRestored(),values:this.values,last:this.valuesLast,defaults:this.valuesDefault}},destroy:function(){Array.each(this.elements,function(n){this.__removeEvents(n);n.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker");n.eliminate("changetracker")}.bind(this))}});Element.implement({addChangeTracker:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.ElementValueTracker(this),this},hasChanged:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").hasChanged()},getTrackedValue:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getValue(this)},getTrackedDefault:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getDefault(this)},getTrackedLast:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getLast(this)},fireTrackedChange:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").__elementChanged({target:this}),this.retrieve("changetracker").getValue(this)}});Element.implement({exists:function(){try{if(document.body.contains(this)||this.ownerDocument&&this.ownerDocument.body.contains(this))return this}catch(n){return!1}return!1}});Element.Events.added={onAdd:function(){this.exists()?this.fireEvent("exists",this):(this.store("_exists_method",function(){this.exists()&&(clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method"),this.fireEvent("exists",this))}),this.store("_exists_timer",this.retrieve("_exists_method").periodical(100,this)))},onRemove:function(){clearInterval(this.retrieve("_exists_timer"));this.eliminate("_exists_timer");this.eliminate("_exists_method")}};Element.Events.removed={onAdd:function(){this.exists()?(this.store("_not_exists_method",function(){this.exists()||(clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_timer"),this.eliminate("_not_exists_method"),this.fireEvent("notexists",!0))}),this.store("_not_exists_timer",this.retrieve("_not_exists_method").periodical(1e3,this))):this.fireEvent("notexists",!0)},onRemove:function(){clearInterval(this.retrieve("_not_exists_timer"));this.eliminate("_not_exists_method");this.eliminate("_not_exists_method")}};MooTools&&"version"in MooTools&&parseFloat(MooTools.version)>=1.4&&parseFloat(MooTools.version)<1.5&&(Drag=new Class({Implements:[Events,Options],options:{snap:6,unit:"px",grid:!1,style:!0,limit:!1,handle:!1,invert:!1,preventDefault:!1,stopPropagation:!1,modifiers:{x:"left",y:"top"}},initialize:function(){var t=Array.link(arguments,{options:Type.isObject,element:function(n){return n!=null}}),n;this.element=document.id(t.element);this.document=this.element.getDocument();this.setOptions(t.options||{});n=typeOf(this.options.handle);this.handles=(n=="array"||n=="collection"?$$(this.options.handle):document.id(this.options.handle))||this.element;this.mouse={now:{},pos:{}};this.value={start:{},now:{}};this.selection=Browser.ie?"selectstart":Affinity.events.start;Browser.ie&&!Drag.ondragstartFixed&&(document.ondragstart=Function.from(!1),Drag.ondragstartFixed=!0);this.bound={start:this.start.bind(this),check:this.check.bind(this),drag:this.drag.bind(this),stop:this.stop.bind(this),cancel:this.cancel.bind(this),eventStop:Function.from(!1)};this.attach()},attach:function(){return this.handles.addEvent(Affinity.events.start,this.bound.start),this},detach:function(){return this.handles.removeEvent(Affinity.events.start,this.bound.start),this},start:function(n){var i=this.options,e,t,s,u,o,r,f;if(!n.rightClick){i.preventDefault&&n.preventDefault();i.stopPropagation&&n.stopPropagation();this.mouse.start=n.page;this.fireEvent("beforeStart",this.element);e=i.limit;this.limit={x:[],y:[]};for(t in i.modifiers)if(i.modifiers[t]&&(u=this.element.getStyle(i.modifiers[t]),u&&!u.match(/px$/)&&(s||(s=this.element.getCoordinates(this.element.getOffsetParent())),u=s[i.modifiers[t]]),this.value.now[t]=i.style?(u||0).toInt():this.element[i.modifiers[t]],i.invert&&(this.value.now[t]*=-1),this.mouse.pos[t]=n.page[t]-this.value.now[t],e&&e[t]))for(o=2;o--;)r=e[t][o],(r||r===0)&&(this.limit[t][o]=typeof r=="function"?r():r);typeOf(this.options.grid)=="number"&&(this.options.grid={x:this.options.grid,y:this.options.grid});f={};f[Affinity.events.move]=this.bound.check;f[Affinity.events.end]=this.bound.cancel;f[this.selection]=this.bound.eventStop;this.document.addEvents(f)}},check:function(n){var i,t;Affinity.mobile&&Affinity.UI.scrolling||(this.options.preventDefault&&n.preventDefault(),i=Math.round(Math.sqrt(Math.pow(n.page.x-this.mouse.start.x,2)+Math.pow(n.page.y-this.mouse.start.y,2))),(i>this.options.snap||Affinity.mobile)&&(this.cancel(),t={},t[Affinity.events.move]=this.bound.drag,t[Affinity.events.end]=this.bound.stop,this.document.addEvents(t),this.fireEvent("start",[this.element,n]).fireEvent("snap",this.element)))},drag:function(n){var i,t;if(Affinity.UI.drageventFired=!0,!Affinity.mobile||!Affinity.UI.scrolling){i=this.options;i.preventDefault&&n.preventDefault();this.mouse.now=n.page;for(t in i.modifiers)i.modifiers[t]&&(this.value.now[t]=this.mouse.now[t]-this.mouse.pos[t],i.invert&&(this.value.now[t]*=-1),i.limit&&this.limit[t]&&((this.limit[t][1]||this.limit[t][1]===0)&&this.value.now[t]>this.limit[t][1]?this.value.now[t]=this.limit[t][1]:(this.limit[t][0]||this.limit[t][0]===0)&&this.value.now[t]<this.limit[t][0]&&(this.value.now[t]=this.limit[t][0])),i.grid[t]&&(this.value.now[t]-=(this.value.now[t]-(this.limit[t][0]||0))%i.grid[t]),i.style?this.element.setStyle(i.modifiers[t],this.value.now[t]+i.unit):this.element[i.modifiers[t]]=this.value.now[t]);this.fireEvent("drag",[this.element,n])}},cancel:function(n){this.document.removeEvent(Affinity.events.move,this.bound.check);this.document.removeEvent(Affinity.events.end,this.bound.cancel);n&&(this.document.removeEvent(this.selection,this.bound.eventStop),this.fireEvent("cancel",this.element))},stop:function(n){var t={};t[Affinity.events.move]=this.bound.drag;t[Affinity.events.end]=this.bound.stop;t[this.selection]=this.bound.eventStop;this.document.removeEvents(t);n&&this.fireEvent("complete",[this.element,n])}}),Element.implement({makeResizable:function(n){var t=new Drag(this,Object.merge({modifiers:{x:"width",y:"height"}},n));return this.store("resizer",t),t.addEvent("drag",function(){this.fireEvent("resize",t)}.bind(this))}}),Drag.Move=new Class({Extends:Drag,options:{droppables:[],container:!1,precalculate:!1,includeMargins:!0,checkDroppables:!0},initialize:function(n,t){if(this.parent(n,t),n=this.element,this.droppables=$$(this.options.droppables),this.container=document.id(this.options.container),this.container&&typeOf(this.container)!="element"&&(this.container=document.id(this.container.getDocument().body)),this.options.style){if(this.options.modifiers.x=="left"&&this.options.modifiers.y=="top"){var i=n.getOffsetParent(),r=n.getStyles("left","top");i&&(r.left=="auto"||r.top=="auto")&&n.setPosition(n.getPosition(i))}n.getStyle("position")=="static"&&n.setStyle("position","absolute")}this.addEvent("start",this.checkDroppables,!0);this.overed=null},start:function(n){this.container&&(this.options.limit=this.calculateLimit());this.options.precalculate&&(this.positions=this.droppables.map(function(n){return n.getCoordinates()}));this.parent(n)},calculateLimit:function(){var t=this.element,e=this.container,o=document.id(t.getOffsetParent())||document.body,s=e.getCoordinates(o),n={},v={},h={},i={},c={},f;["top","right","bottom","left"].each(function(r){n[r]=t.getStyle("margin-"+r).toInt();v[r]=t.getStyle("border-"+r).toInt();h[r]=e.getStyle("margin-"+r).toInt();i[r]=e.getStyle("border-"+r).toInt();c[r]=o.getStyle("padding-"+r).toInt()},this);var y=t.offsetWidth+n.left+n.right,p=t.offsetHeight+n.top+n.bottom,r=0,u=0,l=s.right-i.right-y,a=s.bottom-i.bottom-p;return this.options.includeMargins?(r+=n.left,u+=n.top):(l+=n.right,a+=n.bottom),t.getStyle("position")=="relative"?(f=t.getCoordinates(o),f.left-=t.getStyle("left").toInt(),f.top-=t.getStyle("top").toInt(),r-=f.left,u-=f.top,e.getStyle("position")!="relative"&&(r+=i.left,u+=i.top),l+=n.left-f.left,a+=n.top-f.top,e!=o&&(r+=h.left+c.left,u+=(Browser.ie6||Browser.ie7?0:h.top)+c.top)):(r-=n.left,u-=n.top,e!=o&&(r+=s.left+i.left,u+=s.top+i.top)),{x:[r,l],y:[u,a]}},getDroppableCoordinates:function(n){var t=n.getCoordinates(),i;return n.getStyle("position")=="fixed"&&(i=window.getScroll(),t.left+=i.x,t.right+=i.x,t.top+=i.y,t.bottom+=i.y),t},checkDroppables:function(){var n=this.droppables.filter(function(n,t){n=this.positions?this.positions[t]:this.getDroppableCoordinates(n);var i=this.mouse.now;return i.x>n.left&&i.x<n.right&&i.y<n.bottom&&i.y>n.top},this).getLast();this.overed!=n&&(this.overed&&this.fireEvent("leave",[this.element,this.overed]),n&&this.fireEvent("enter",[this.element,n]),this.overed=n)},drag:function(n){this.parent(n);this.options.checkDroppables&&this.droppables.length&&this.checkDroppables()},stop:function(n){return this.checkDroppables(),this.fireEvent("drop",[this.element,this.overed,n]),this.overed=null,this.parent(n)}}),Element.implement({makeDraggable:function(n){var t=new Drag.Move(this,n);return this.store("dragger",t),t}}),Slider=new Class({Implements:[Events,Options],Binds:["clickedElement","draggedKnob","scrolledElement"],options:{onTick:function(n){this.setKnobPosition(n)},initialStep:0,snap:!1,offset:0,range:!1,wheel:!1,steps:100,mode:"horizontal"},initialize:function(n,t,i){var r,u,f;this.setOptions(i);i=this.options;this.element=document.id(n);t=this.knob=document.id(t);this.previousChange=this.previousEnd=this.step=-1;r={};u={x:!1,y:!1};switch(i.mode){case"vertical":this.axis="y";this.property="top";this.offset="offsetHeight";break;case"horizontal":this.axis="x";this.property="left";this.offset="offsetWidth"}this.setSliderDimensions();this.setRange(i.range);t.getStyle("position")=="static"&&t.setStyle("position","relative");t.setStyle(this.property,-i.offset);u[this.axis]=this.property;r[this.axis]=[-i.offset,this.full-i.offset];f={snap:0,limit:r,modifiers:u,onDrag:this.draggedKnob,onStart:this.draggedKnob,onBeforeStart:function(){this.isDragging=!0}.bind(this),onCancel:function(){this.isDragging=!1}.bind(this),onComplete:function(){this.isDragging=!1;this.draggedKnob();this.end()}.bind(this)};i.snap&&this.setSnap(f);this.drag=new Drag(t,f);this.attach();i.initialStep!=null&&this.set(i.initialStep)},attach:function(){return this.element.addEvent("mousedown",this.clickedElement),this.options.wheel&&this.element.addEvent("mousewheel",this.scrolledElement),this.drag.attach(),this},detach:function(){return this.element.removeEvent("mousedown",this.clickedElement).removeEvent("mousewheel",this.scrolledElement),this.drag.detach(),this},autosize:function(){return this.setSliderDimensions().setKnobPosition(this.toPosition(this.step)),this.drag.options.limit[this.axis]=[-this.options.offset,this.full-this.options.offset],this.options.snap&&this.setSnap(),this},setSnap:function(n){return n||(n=this.drag.options),n.grid=Math.ceil(this.stepWidth),n.limit[this.axis][1]=this.full,this},setKnobPosition:function(n){return this.options.snap&&(n=this.toPosition(this.step)),this.knob.setStyle(this.property,n),this},setSliderDimensions:function(){return this.full=this.element.measure(function(){return this.half=this.knob[this.offset]/2,this.element[this.offset]-this.knob[this.offset]+this.options.offset*2}.bind(this)),this},set:function(n){return this.range>0^n<this.min||(n=this.min),this.range>0^n>this.max||(n=this.max),this.step=Math.round(n),this.checkStep().fireEvent("tick",this.toPosition(this.step)).end()},setRange:function(n,t){return this.min=Array.pick([n[0],0]),this.max=Array.pick([n[1],this.options.steps]),this.range=this.max-this.min,this.steps=this.options.steps||this.full,this.stepSize=Math.abs(this.range)/this.steps,this.stepWidth=this.stepSize*this.full/Math.abs(this.range),n&&this.set(Array.pick([t,this.step]).floor(this.min).max(this.max)),this},clickedElement:function(n){if(!this.isDragging&&n.target!=this.knob){var i=this.range<0?-1:1,t=n.page[this.axis]-this.element.getPosition()[this.axis]-this.half;t=t.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+i*this.toStep(t));this.checkStep().fireEvent("tick",t).end()}},scrolledElement:function(n){var t=this.options.mode=="horizontal"?n.wheel<0:n.wheel>0;this.set(this.step+(t?-1:1)*this.stepSize);n.stop()},draggedKnob:function(){var t=this.range<0?-1:1,n=this.drag.value.now[this.axis];n=n.limit(-this.options.offset,this.full-this.options.offset);this.step=Math.round(this.min+t*this.toStep(n));this.checkStep()},checkStep:function(){var n=this.step;return this.previousChange!=n&&(this.previousChange=n,this.fireEvent("change",n)),this},end:function(){var n=this.step;return this.previousEnd!==n&&(this.previousEnd=n,this.fireEvent("complete",n+"")),this},toStep:function(n){var t=(n+this.options.offset)*this.stepSize/this.full*this.steps;return this.options.steps?Math.round(t-=t%this.stepSize):t},toPosition:function(n){return this.full*Math.abs(this.min-n)/(this.steps*this.stepSize)-this.options.offset}}),Sortables=new Class({Implements:[Events,Options],options:{opacity:1,clone:!1,revert:!1,handle:!1,dragOptions:{}},initialize:function(n,t){this.setOptions(t);this.elements=[];this.lists=[];this.idle=!0;this.addLists($$(document.id(n)||n));this.options.clone||(this.options.revert=!1);this.options.revert&&(this.effect=new Fx.Morph(null,Object.merge({duration:250,link:"cancel"},this.options.revert)))},attach:function(){return this.addLists(this.lists),this},detach:function(){return this.lists=this.removeLists(this.lists),this},addItems:function(){return Array.flatten(arguments).each(function(n){this.elements.push(n);var t=n.retrieve("sortables:start",function(t){this.start.call(this,t,n)}.bind(this));(this.options.handle?n.getElement(this.options.handle)||n:n).addEvent(Affinity.events.start,t)},this),this},addLists:function(){return Array.flatten(arguments).each(function(n){this.lists.include(n);this.addItems(n.getChildren())},this),this},removeItems:function(){return $$(Array.flatten(arguments).map(function(n){this.elements.erase(n);var t=n.retrieve("sortables:start");return(this.options.handle?n.getElement(this.options.handle)||n:n).removeEvent(Affinity.events.start,t),n},this))},removeLists:function(){return $$(Array.flatten(arguments).map(function(n){return this.lists.erase(n),this.removeItems(n.getChildren()),n},this))},getClone:function(n,t){if(!this.options.clone)return new Element(t.tagName).inject(document.body);if(typeOf(this.options.clone)=="function")return this.options.clone.call(this,n,t,this.list);var i=t.clone(!0).setStyles({margin:0,position:"absolute",visibility:"hidden",width:t.getStyle("width")}).addEvent(Affinity.events.start,function(n){t.fireEvent(Affinity.events.start,n)});return i.get("html").test("radio")&&i.getElements("input[type=radio]").each(function(n,i){n.set("name","clone_"+i);n.get("checked")&&t.getElements("input[type=radio]")[i].set("checked",!0)}),i.inject(this.list).setPosition(t.getPosition(t.getOffsetParent()))},getDroppables:function(){var n=this.list.getChildren().erase(this.clone).erase(this.element);return this.options.constrain||n.append(this.lists).erase(this.list),n},insert:function(n,t){var i="inside";this.lists.contains(t)?(this.list=t,this.drag.droppables=this.getDroppables()):i=this.element.getAllPrevious().contains(t)?"before":"after";this.element.inject(t,i);this.fireEvent("sort",[this.element,this.clone])},start:function(n,t){!this.idle||n.rightClick||["button","input","a","textarea"].contains(n.target.get("tag"))||(Affinity.mobile&&(n.preventDefault(),n.stopPropagation()),this.idle=!1,this.element=t,this.opacity=t.getStyle("opacity"),this.list=t.getParent(),this.clone=this.getClone(n,t),this.drag=new Drag.Move(this.clone,Object.merge({droppables:this.getDroppables()},this.options.dragOptions)).addEvents({onSnap:function(){n.stop();this.clone.setStyle("visibility","visible");this.element.setStyle("opacity",this.options.opacity||0);this.fireEvent("start",[this.element,this.clone])}.bind(this),onEnter:this.insert.bind(this),onCancel:this.end.bind(this),onComplete:this.end.bind(this)}),this.clone.inject(this.element,"before"),this.drag.start(n))},end:function(){if(this.drag.detach(),this.element.setStyle("opacity",this.opacity),this.effect){var i=this.element.getStyles("width","height"),n=this.clone,r=n.computePosition(this.element.getPosition(this.clone.getOffsetParent())),t=function(){this.removeEvent("cancel",t);n.destroy()};this.effect.element=n;this.effect.start({top:r.top,left:r.left,width:i.width,height:i.height,opacity:.25}).addEvent("cancel",t).chain(t)}else this.clone.destroy();this.reset()},reset:function(){this.idle=!0;this.fireEvent("complete",this.element)},serialize:function(){var t=Array.link(arguments,{modifier:Type.isFunction,index:function(n){return n!=null}}),i=this.lists.map(function(n){return n.getChildren().map(t.modifier||function(n){return n.get("id")},this)},this),n=t.index;return this.lists.length==1&&(n=0),(n||n===0)&&n>=0&&n<this.lists.length?i[n]:i}}));String.prototype.soundex=function(){var f=this,t,n="",r,e,o,u;for(f=f.toUpperCase(),n=f,n=n.replace(/[^A-Z]/gi," "),n=n.replace(/^\s*/g,""),n=n.replace(/\s*$/g,""),n=n.replace(/^GH/g,"G"),n=n.replace(/DG/g,"G"),n=n.replace(/GH/g,"H"),n=n.replace(/GN/g,"N"),n=n.replace(/KN/g,"N"),n=n.replace(/PH/g,"F"),n=n.replace(/MP([STZ])/g,"M$1"),n=n.replace(/^PS/g,"S"),n=n.replace(/^PF/g,"F"),n=n.replace(/MB/g,"M"),n=n.replace(/TCH/g,"CH"),u=n.substr(0,1),(u=="H"||u=="W")&&(n="-"+n.substr(1)),n=n.replace(/[AEIOUYHW]/g,"0"),n=n.replace(/[BPFV]/g,"1"),n=n.replace(/[CSGJKQXZ]/g,"2"),n=n.replace(/[DT]/g,"3"),n=n.replace(/[L]/g,"4"),n=n.replace(/[MN]/g,"5"),n=n.replace(/[R]/g,"6"),o=n.length,e="",t="",i=0;i<o;i++)r=n.charAt(i),r==e?t+=" ":(t+=r,e=r);return n=t,n=n.substr(1),n=n.replace(/\s/g,""),n=n.replace(/0/g,""),n+="0000000000",n=u+n,n.substr(0,5)};String.prototype.distance=function(n){var u=this.toLowerCase(),f=n.toLowerCase(),r,t,i;if(u.length===0)return f.length;if(f.length===0)return u.length;for(r=[],t=0;t<=f.length;t++)r[t]=[t];for(i=0;i<=u.length;i++)r[0][i]=i;for(t=1;t<=f.length;t++)for(i=1;i<=u.length;i++)r[t][i]=f.charAt(t-1)==u.charAt(i-1)?r[t-1][i-1]:Math.min(r[t-1][i-1]+1,Math.min(r[t][i-1]+1,r[t-1][i]+1));return r[f.length][u.length]};typeOf(File)=="null"&&(File={});typeOf(Request)=="null"&&(File={});File.Upload=new Class({Implements:[Options,Events],options:{onComplete:function(){}},initialize:function(n){var t=this;this.setOptions(n);this.uploadReq=new Request.File({onComplete:function(){t.fireEvent("complete",arguments);this.reset()}});this.options.data&&this.data(this.options.data);this.options.images&&this.addMultiple(this.options.images)},data:function(n){var t=this;this.options.url.indexOf("?")<0&&(this.options.url+="?");Object.each(n,function(n,i){t.options.url.charAt(t.options.url.length-1)!="?"&&(t.options.url+="&");t.options.url+=encodeURIComponent(i)+"="+encodeURIComponent(n)})},addMultiple:function(n){var t=this;n.each(function(n){t.add(n)})},add:function(n){var i=n;if(typeOf(n)!=="null"){var n=document.id(n),r=n.get("name"),t=n.files[0];this.uploadReq.append("fileData",t)}},addPostData:function(n){this.uploadReq.addPostData(n)},send:function(n){n&&this.add(n);this.uploadReq.send({url:this.options.url})}});Request.File=new Class({Extends:Request,options:{emulation:!1,urlEncoded:!1},initialize:function(n){this.xhr=new Browser.Request;this.formData=new FormData;this.setOptions(n);this.headers=this.options.headers},append:function(n,t){return this.formData.append(n,t),this.formData},addPostData:function(n){var t=this;Object.each(n,function(n,i){t.formData.append(i,n)})},reset:function(){this.formData=new FormData},send:function(n){var i=n.url||this.options.url,t;return this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0,t=this.xhr,t.open("POST",i,!0),t.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,function(n,i){try{t.setRequestHeader(i,n)}catch(r){this.fireEvent("exception",[i,n])}},this),this.fireEvent("request"),t.send(this.formData),this.options.async||this.onStateChange(),this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)),this}});Affinity.Shake=new Class({Implements:Options,options:{distance:4,duration:50,transition:Fx.Transitions.Sine.easeInOut,loops:2},initialize:function(n,t){this.setOptions(t);this.element=n;this.tween=new Fx.Tween(this.element,{link:"chain",duration:this.options.duration,transition:this.options.transition,property:"margin-left"})},shake:function(){var n=this.options.distance;for(this.loops=0;this.loops<this.options.loops;this.loops++)this.tween.start("left",n).start("left",-n),this.tween.start("left",n).start("left",0);delete n},stop:function(){this.loops=this.options.loops;this.tween.cancel();this.element.setStyle("margin-left",0)}});window.addEvent("UiReady",function(){Affinity.oldess&&Affinity.oldessFrame&&Affinity.agent.contains("Chrome")&&Affinity.agent.contains("Windows NT 6.2")&&window.addEvent("click",function(){document.getElement("body").className.contains("redraw")?(document.getElement("body").setStyle("width","100%"),document.getElement("body").className="newui"):(document.getElement("body").setStyle("width","99.9%"),document.getElement("body").className="newui redraw")});typeof window.masterMessage!="undefined"&&Affinity.isie&&Affinity.ieversion<9&&masterMessage({message:'<strong class="color red large">Warning!<\/strong><br /><br />We do not support Internet Explorer 8 and less<br />Some functionality may not work.<br /><br />We recommend <a href="https://www.google.com/chrome/browser/desktop/" target="_blank" class="color green">Chrome<\/a> or updating to at least IE9.<br /><br />Continue at your own risk.',okText:"Accept and Continue"})});Affinity.PageReady=function(){var n,t;window.removeEvent("PageReady",Affinity.PageReady);Affinity.apiversion>1?(Affinity.zelosroot=Affinity.apiroot,Affinity.lookupapi=Affinity.apiroot+"/api/Lookup/Get"):Affinity.lookupapi=Affinity.zelosroot+"/api/Lookup/Get";document.documentMode&&document.documentMode==8&&document.getElement("body").addClass("ie8");Affinity.mobile;n=document.getElement("body").get("class").toLowerCase();Affinity.ismac=n.contains("mac")?!0:!1;Affinity.isie=n.contains("ie")?!0:!1;Affinity.isie&&(Affinity.ieversion=parseInt(String(n.match(/ie[0-9]+/i)[0]).substr(2)));Affinity.isie&&(Affinity.iedocmode=document.documentMode?document.documentMode:!1);Affinity.ismobile=n.contains("mobile")?!0:!1;Affinity.mobile&&(Affinity.ismobile=!0);Affinity&&Affinity.isie&&Affinity.ieversion<9&&document.addEvent("keydown",function(n){(n.key==8||n.key==="backspace")&&(n.target.get("tag").test("select","gi")||n.target.disabled||n.target.readOnly)&&n.preventDefault()});Affinity.refreshControll={};Affinity.refreshControll.initialLoad=!0;Affinity.refreshControll.lastRefresh=(new Date).getTime();window.addEvent("keydown",function(n){if(n.key==="f5"||n.key==="F5"||n.control&&(n.key==="r"||n.key==="R")){var t=(new Date).getTime(),i=Affinity.refreshControll.initialLoad?1e4:5e3;t-Affinity.refreshControll.lastRefresh<i&&(n.stop(),uialert({message:"Refreshing this often can slow things down.<br />If you believe the page is not responding,<br />please contact Affinity Help desk.",showButtons:!0}));Affinity.refreshControll.lastRefresh=(new Date).getTime();Affinity.refreshControll.initialLoad=!1}});window.addEvent("userComplete",function(n){document.getElements(".displayname").set("html",n.commonName?n.commonName:n.displayName?n.displayName:"")});Affinity.essmessage="";window.Affinity.oldess=!1;t=function(){var t=new URI(window.location.href),n=t&&typeOf(t)==="object"&&typeOf(t.parsed.query)==="null"?{}:t.parsed.query.parseQueryString();if("sessionKey"in n||"isEss"in n)window.Affinity.oldess=!0,"iframe"in n&&(window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent),"external"in n&&(window.Affinity.oldessLaunched=!0,window.Affinity.oldessFrame=!1,window.Affinity.oldessWindow=window.opener),window.Affinity.oldess&&!1 in n&&!1 in n&&window.addEvent("UiReady",function(){window.Affinity.appname==="cleverforms"?(window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent):(window.Affinity.oldessLaunched=!0,window.Affinity.oldessFrame=!1,window.Affinity.oldessWindow=window.opener)});else try{parent&&"parentFrameResize"in parent&&(window.Affinity.oldess=!0,window.Affinity.oldessLaunched=!1,window.Affinity.oldessFrame=!0,window.Affinity.oldessWindow=window.parent)}catch(i){log("!!! old ess check try failed")}return!0}();try{window.Affinity.oldessFrame&&(window.addEvent("ResizeFrame",function(){var i,n,t;document.getElement(".content")&&(i=document.getElement(".content"),n=i.getScrollSize(),Affinity.oldessFrame&&"parentFrameResize"in parent&&(t=window.parent.window.innerWidth?window.parent.window.innerWidth-70:window.parent.window.document.body.offsetWidth-70,n.x=t&&t>0?t:1e3,parent.parentFrameResize({x:n.x,y:n.y+100})))}),window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500))}catch(i){}};window.addEvent("PageReady",Affinity.PageReady);Affinity.disableAutoPageReady=!1;window.addEvent("load",function(){(function(){Affinity.disableAutoPageReady||Affinity.uiready||window.fireEvent("PageReady")}).delay(1e3,this)});Affinity.log=!0;Affinity.prettyuploads=!0;Affinity.selectToAutoNum=0;Affinity.selectmax=1e3;Affinity.enableSelectLimit=!0;Affinity.logger.enable();window.config=document.config=Affinity;var UIAddress=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(n){this.setOptions(n);window.googleAddressAutocompletes||(window.googleAddressAutocompletes={},window.googleAddressApiScripts=!1,window.googleAddressWidgetCount=0);window.googleAddressStartTime=(new Date).getTime();this.processNew()},processNew:function(){Array.each(document.getElements(".ui-address"),this.process)},process:function(n){(function(){n.removeClass("ui-address");new UIAddressWidget({element:n,index:window.googleAddressWidgetCount});window.googleAddressWidgetCount++}).delay(250*window.googleAddressWidgetCount)}}),UIAddressWidget=new Class({Implements:[Options,Events],Binds:["revert","destroy","findComponent","getCityFromLatLong","getClosestLocation","clearValues","updatePropertyValue","fillInAddress","loadScript","addressInit","getPlaceFromValue","setPlaceValues","mainAddressFocus","mainAddressBlur","checkForError","setPlaceValuesEvent","getCityFromLatLongEvent","fireCityFromLatLong"],options:{element:null,index:0},element:null,index:0,type:"address",uuid:"",place:!1,initialize:function(n){if(this.setOptions(n),this.options.element===null||typeOf(this.options.element)!=="element")throw"No valid element passed in, dummy";this.apikey="AIzaSyDX7vRyaNWfkZQfj0xx9Kthii3HBXk5DGc";this.originalElement=this.options.element;this.disabled=this.originalElement.get("disabled")?!0:!1;this.uuid=String.uniqueID();this.index=this.options.index;this.element=new Element("div",{"class":"addressbox ui-validate","data-validate-method":"address"}).inject(this.options.element,"before");window.googleAddressAutocompletes["address_"+this.uuid]=this;this.options.element.removeClass("ui-address").addClass("ui-address-done full-address");this.addressinput=new Element("input",{"class":"googleAddress",type:"text",id:"googleAddress_"+this.uuid,placeholder:"Enter your address to fill the fields below"}).inject(this.element,"top");this.errorIcon=new Element("span",{"class":"addressbox-error-icon icon-warning ui-has-tooltip hidden","data-tooltip":"This is not a valid Address"}).inject(this.element);this.addressComponentWrapper=new Element("div").set("reveal",{duration:250,transition:Fx.Transitions.Sine.easeInOut}).inject(this.element).toggle();this.addressNumber=new Element("input",{"class":"number",type:"text",id:"street_number_"+this.uuid,placeholder:"Number",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Number"'}).inject(this.addressComponentWrapper);this.addressStreet=new Element("input",{"class":"street",type:"text",id:"street_address_"+this.uuid,placeholder:"Street",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Street"'}).inject(this.addressComponentWrapper);this.addressSuburb=new Element("input",{"class":"suburb",type:"text",id:"suburb_"+this.uuid,placeholder:"Suburb",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Suburb"'}).inject(this.addressComponentWrapper);this.addressCity=new Element("input",{"class":"city",type:"text",id:"city_"+this.uuid,placeholder:"City",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "City"'}).inject(this.addressComponentWrapper);this.addressState=new Element("input",{"class":"state",type:"text",id:"state_"+this.uuid,placeholder:"State",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "State"'}).inject(this.addressComponentWrapper);this.addressCountry=new Element("input",{"class":"country",type:"text",id:"country_"+this.uuid,placeholder:"Country",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Country"'}).inject(this.addressComponentWrapper);this.addressPostcode=new Element("input",{"class":"postcode",type:"text",id:"postal_code_"+this.uuid,placeholder:"Postcode",onfocus:"this.placeholder = ''",onblur:'this.placeholder = "Postcode"'}).inject(this.addressComponentWrapper);this.hiddenWrapper=new Element("div",{"class":"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after");this.subhiddenaddress1=new Element("input",{"class":"address1 validate ui-address-done"}).inject(this.hiddenWrapper);this.subhiddenaddress2=new Element("input",{"class":"address2 validate ui-address-done"}).inject(this.hiddenWrapper);this.subhiddenaddress3=new Element("input",{"class":"address3 validate ui-address-done"}).inject(this.hiddenWrapper);this.subhiddenaddress4=new Element("input",{"class":"address4 validate ui-address-done"}).inject(this.hiddenWrapper);this.hiddenWrapper.adopt(this.options.element);this.element.inject(this.hiddenWrapper,"before");this.loadScript();this.disabled?this.addressinput.addClass("hidden"):(this.addressNumber.addEvent("keyup",this.updatePropertyValue),this.addressStreet.addEvent("keyup",this.updatePropertyValue),this.addressSuburb.addEvent("keyup",this.updatePropertyValue),this.addressCity.addEvent("keyup",this.updatePropertyValue),this.addressState.addEvent("keyup",this.updatePropertyValue),this.addressCountry.addEvent("keyup",this.updatePropertyValue),this.addressPostcode.addEvent("keyup",this.updatePropertyValue),this.addressinput.addEvent("focus",this.mainAddressFocus),this.addressinput.addEvent("blur",this.mainAddressBlur));Affinity.tooltips.processNew()},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy());this.addressNumber.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressStreet.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressSuburb.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressCity.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressState.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressCountry.removeEvent("keyup",this.updatePropertyValue).destroy();this.addressPostcode.removeEvent("keyup",this.updatePropertyValue).destroy();this.selectElement.inject(this.hiddenWrapper,"before");this.hiddenWrapper.destroy();this.selectElement.eliminate("widget");var n=this.selectElement;return Object.each(this,function(n){this[n]=null;delete this[n]}.bind(this)),n},destroy:function(){clearTimeout(this.checkExistsPeriodical);var n=this.revert();n.destroy()},findComponent:function(n,t){for(var u=!1,r,i=0;i<n.length;i++)if("address_components"in n[i])for(r=0;r<n[i].address_components.length;r++)if(n[i].address_components[r].types.contains(t)){u=n[i].address_components[r];break}return u},getLatLong:function(n){var t=[];return Object.each(n,function(n,i){typeOf(n)==="function"?t.push(this.place.geometry.location[i]()):typeOf(n!=="object")&&t.push(n)}.bind(this)),t.slice(0,2)},fireCityFromLatLong:function(n,t){var i=new google.maps.Geocoder;i.geocode({latLng:new google.maps.LatLng(n,t)},function(i,r){r==google.maps.GeocoderStatus.OK?this.fireEvent("gotCity",{uuid:this.uuid,city:this.findComponent(i,"colloquial_area")}):r=="OVER_QUERY_LIMIT"&&("warn"in console&&console.warn(this.index+' received google status in "fireCityFromLatLong" with "'+r+'"'),this.fireCityFromLatLong.delay(500,this,[n,t]))}.bind(this))},getCityFromLatLong:function(n,t){this.addEvent("gotCity",this.getCityFromLatLongEvent);this.fireCityFromLatLong(n,t)},getCityFromLatLongEvent:function(n){n.uuid===this.uuid&&(this.removeEvent("gotCity",this.getCityFromLatLongEvent),this.place.address_components.push(n.city),this.setPlaceValues())},getPlaceFromValue:function(n){var t,i;try{t=JSON.parse(n);t.street&&(i=t.street.indexOf(" "),this.addressNumber.value=t.street.substring(0,i),this.addressStreet.value=t.street.substring(i+1,t.street.length));this.addressSuburb.value=t.suburb?t.suburb:"";this.addressCity.value=t.city?t.city:"";this.addressState.value=t.state?t.state:"";this.addressCountry.value=t.country?t.country:"";this.addressPostcode.value=t.postcode?t.postcode:""}catch(r){t=n.split(",");i=t[0].indexOf(" ");this.addressNumber.value=t[0].substring(0,i);this.addressStreet.value=t[0].substring(i+1,t[0].length);this.addressSuburb.value=t[1];this.addressCountry.value=t[4]?t[4]:"";this.addressPostcode.value=t[3];switch(this.addressCountry.value){case"New Zealand":this.addressCity.value=t[2];break;case"Australia":this.addressState.value=t[2];break;default:this.addressCity.value=t[2]}}},clearValues:function(){this.addressNumber.value="";this.addressStreet.value="";this.addressSuburb.value="";this.addressCity.value="";this.addressState.value="";this.addressCountry.value="";this.addressPostcode.value=""},setPlaceValues:function(){var t,n;(this.values={},Array.each(this.place.address_components,function(n){try{this.values[n.types[0]]={};this.values[n.types[0]].long=n.long_name;this.values[n.types[0]].short=n.short_name}catch(t){}}.bind(this)),this.countryCode=!1,t=this.findComponent([this.place],"country"),t&&(this.countryCode=t.short_name),this.countryCode&&this.countryCode!="")&&(n=this.getLatLong(this.place.geometry.location),n.length>=2&&!isNaN(n[0])&&!isNaN(n[1])&&(this.addEvent("gotCity",this.setPlaceValuesEvent),this.fireCityFromLatLong(n[0],n[1])))},setPlaceValuesEvent:function(n){if(n.uuid===this.uuid){if(this.removeEvent("gotCity",this.setPlaceValuesEvent),n&&"city"in n)try{this.values[n.city.types[0]]={};this.values[n.city.types[0]].long=n.city.long_name;this.values[n.city.types[0]].short=n.city.short_name}catch(n){}switch(this.countryCode){case"AU":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:"");this.addressStreet.value=this.values.route?this.values.route.long:"";this.addressSuburb.value=this.values.locality?this.values.locality.long:this.values.political?this.values.political.long:"";this.addressCity.value=this.values.colloquial_area?this.values.colloquial_area.long:"";this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"";this.addressCountry.value=this.values.country?this.values.country.long:"";this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"NZ":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:"");this.addressStreet.value=this.values.route?this.values.route.long:"";this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"";this.addressCity.value=this.values.locality?this.values.locality.long:"";this.addressState.value="";this.addressCountry.value=this.values.country?this.values.country.long:"";this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;case"GB":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:"");this.addressStreet.value=this.values.route?this.values.route.long:"";this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"";this.addressCity.value=this.values.locality?this.values.locality.long:"";this.addressState.value=this.values.administrative_area_level_2?this.values.administrative_area_level_2.long:"";this.addressCountry.value=this.values.country?this.values.country.long:"";this.addressPostcode.value=this.values.postal_code_prefix?this.values.postal_code_prefix.long:"";break;case"US":this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:"");this.addressStreet.value=this.values.route?this.values.route.long:"";this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"";this.addressSuburb.value=this.values.sublocality_level_1?this.values.sublocality_level_1.long:this.values.political?this.values.political.long:"";this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"";this.addressCountry.value=this.values.country?this.values.country.long:"";this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:"";break;default:this.addressNumber.value=(this.values.subpremise?this.values.subpremise.long+"/":"")+(this.values.street_number?this.values.street_number.long:"");this.addressStreet.value=this.values.route?this.values.route.long:"";this.addressSuburb.value=this.values.neighborhood?this.values.neighborhood.long:"";this.addressCity.value=this.values.locality?this.values.locality.long:"";this.addressState.value=this.values.administrative_area_level_1?this.values.administrative_area_level_1.short:"";this.addressCountry.value=this.values.country?this.values.country.long:"";this.addressPostcode.value=this.values.postal_code?this.values.postal_code.long:""}this.updatePropertyValue()}},mainAddressFocus:function(){this.addressinput.set("placeholder","")},mainAddressBlur:function(){this.addressinput.set("placeholder","Enter your address to fill the fields below");this.checkForError()},checkForError:function(){var n=[this.addressNumber.value+" "+this.addressStreet.value,this.addressSuburb.value],t=[this.addressCity.value,this.addressState.value,this.addressCountry.value,this.addressPostcode.value],i=Array.clone(n).combine(Array.clone(t));i.join("").trim()===""||n.join("").trim()===""?this.errorIcon.removeClass("hidden"):this.errorIcon.addClass("hidden")},addressInit:function(){var i,r,t,n;if(!document.id("googleAddress_"+this.uuid))throw"target google autocomplete input can not be found";if(!("google"in window&&"maps"in window.google))throw"google maps implementation cannot be found";"maps"in Affinity.UI||(Affinity.UI.maps={});"autocompleteBounds"in Affinity.UI.maps||(Affinity.UI.maps.autocompleteBounds=!1,i=new google.maps.LatLng(-36.847605,174.7485493),r=new google.maps.Circle({center:i,radius:15}),Affinity.UI.maps.autocompleteBounds=r.getBounds());this.disabled||document.id("googleAddress_"+this.uuid).set("disabled",null);this.addressComponentWrapper.reveal();document.config.ismobile||(document.id("googleAddress_"+this.uuid).set("autocomplete","off"),new Element("input",{type:"text",name:"address_fake_"+this.uuid,id:"address_fake_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before"),new Element("input",{type:"text",name:"prevent_autofill_"+this.uuid,id:"prevent_autofill_"+this.uuid,value:"",style:"display:none;"}).inject(document.id("googleAddress_"+this.uuid),"before"));t=new google.maps.places.Autocomplete(document.id("googleAddress_"+this.uuid),{types:["geocode"],componentRestrictions:{country:["nz","au"]}});typeOf(window.autocompleteBounds)!=="null"&&t.setBounds(Affinity.UI.maps.autocompleteBounds);google.maps.event.addListener(t,"place_changed",function(){this.clearValues();this.place=t.getPlace();var n=document.id("googleAddress_"+this.uuid).value.trim();axios.get("https://maps.googleapis.com/maps/api/geocode/json?address="+n+"&key="+this.apikey).then(function(n){n.hasOwnProperty("data")&&n.data.hasOwnProperty("results")&&(this.place=n.data.results[0],this.setPlaceValues())}.bind(this)).catch(function(n){console.log(n)})}.bind(this));n=document.id("subhidden_"+this.uuid).getElement(".full-address").value;typeOf(n)!=="null"&&typeOf(n)==="string"&&n.trim()!==""&&this.getPlaceFromValue(n);this.updatePropertyValue()},updatePropertyValue:function(){var n=JSON.stringify({street:this.addressNumber.value+" "+this.addressStreet.value,suburb:this.addressSuburb.value,city:this.addressCity.value,state:this.addressState.value,country:this.addressCountry.value,postcode:this.addressPostcode.value});document.id("subhidden_"+this.uuid).getElement(".full-address").value=n;this.checkForError()},isGoogleApiready:function(){return"google"in window&&typeOf(google)==="object"&&"maps"in google&&typeOf(google.maps)==="object"&&"places"in google.maps&&typeOf(google.maps.places)==="object"&&"Autocomplete"in google.maps.places&&typeOf(google.maps.places.Autocomplete)==="function"?!0:!1},maybeLoadTimer:!1,loadScript:function(){if(this.isGoogleApiready())this.addressInit();else if(window.googleAddressApiScripts)this.maybeLoadTimer=function(){this.isGoogleApiready()&&(clearInterval(this.maybeLoadTimer),this.addressInit())}.periodical(500,this);else{window.googleAddressApiScripts=!0;var n="window.googleAddressAutocompletes.address_"+this.uuid+".addressInit",t=new Element("script",{src:"https://maps.googleapis.com/maps/api/js?v=3.exp&libraries=places&callback="+n+"&key="+this.apikey}).inject(document.getElement("head"),"bottom")}}}),UIAutoComplete=new Class({Version:"1.0.9.2",File:"ui.autocomplete.js",Notes:"Position including scroll",Implements:[Options],Binds:["processNew","doAutoComplete","hideAll"],options:{},widgets:{},initialize:function(n){this.setOptions(n);Affinity.UI.autocomplete||(Affinity.UI.autocomplete={});Affinity.UI.lastAutoKill={};typeOf(Affinity.UI.ghostFocus)==="null"&&(Affinity.UI.ghostFocus=new Element("input",{type:"text"}),new Element("div",{"class":"subhidden"}).adopt(Affinity.UI.ghostFocus).inject(document.body,"bottom"));window.autocompletes=this;this.processNew()},processNew:function(){Array.each(document.getElements(".ui-autocomplete"),function(n){n.hasClass("has-lookup")||n.hasClass("lookup-loading")||(n.removeClass("ui-autocomplete"),ac=Affinity.mobile&&"UIAutoCompleteMobileWidget"in window?new UIAutoCompleteMobileWidget({selectElement:n}):new UIAutoCompleteWidget({selectElement:n}),this.widgets[ac.uuid]||(this.widgets[ac.uuid]=ac))}.bind(this))},doAutoComplete:function(n){var t=new UIAutoCompleteWidget({selectElement:n});this.widgets[t.uuid]||(this.widgets[t.uuid]=t)},hideAll:function(n){Object.each(this.widgets,function(t){typeOf(n)!=="null"&&n.uuid?t.uuid!==n.uuid&&t.hide("master hide all"):t.hide("master hide all")}.bind(this))}}),UIAutoCompleteWidget=new Class({debug:!1,Implements:[Options,Events],Binds:["fuzzyWorkerComplete","cleanDisplay","processOptions","updateOptions","stopEvent","getValue","setValue","getDisplayValue","position","windowClickStart","windowClickEnd","listOver","listOut","elementOver","elementOut","doFocus","doClick","doKeyUp","doKeyDown","fuzzySearch","continueWithFuzzySearch","itemClicked","escapeRegExp","obscure","reveal","hide","show","clearList","revert","destroy","searchMode_fireChangeEvents","searchMode_valueToOption","searchMode_iconClicked","searchMode_displayBlur",],options:{stopInitialChange:!1,selectElement:null},webworkerpath:"./scripts/common/ui.autocomplete.web.worker.js",list:[],selectElement:null,listElement:null,displayElement:null,changed:!1,defaultChangeValue:null,center:!1,autowidth:!1,uuid:"",killid:"",type:"autocomplete",initialize:function(n){if(Affinity.mobile&&"UIAutoCompleteMobileWidget"in window)return new UIAutoCompleteMobileWidget(n);this.setOptions(n);this.useWebWorkers=Affinity.useWebWorkers?typeof Worker!="undefined"?!0:!1:!1;this.useWebWorkers&&(this.fuzzyWorker=new Worker(this.webworkerpath),this.fuzzyWorker.onmessage=this.fuzzyWorkerComplete);this.searchMode=!1;Affinity&&Affinity.mobile&&(this.searchMode=!0);this.icons={};this.icons.search=Affinity.icons.Search;this.selectElement=this.options.selectElement;this.selectElement.hasClass("ui-autocomplete-center")&&(this.center=!0);this.selectElement.hasClass("ui-autocomplete-autowidth")&&(this.autowidth=!0);this.bestguess=null;this.selectElement.set("tabindex",5e3);this.hiddenWrapper=new Element("div",{"class":"subhidden"}).inject(this.selectElement,"after");this.selectElement.inject(this.hiddenWrapper);this.uuid=this.selectElement.get("id")==null?String.uniqueID():this.selectElement.get("id");this.killid="ac-destroy-"+String.uniqueID();window.autocompletes.widgets[this.uuid]||(window.autocompletes.widgets[this.uuid]=this);this.selectElement.set("id",this.uuid);this.processOptions.delay(100,this);this.selectElement.store("widget",this);this.valuetracker=this.selectElement.retrieve("changetracker")?this.selectElement.retrieve("changetracker"):new Affinity.ElementValueTracker;this.valuetracker.addElement(this.selectElement);document.addEvent("scroll",this.position);document.addEvent("resize",this.position)},fuzzyWorkerComplete:function(n){var t=n.data,i,r;switch(t.job){case"getOptions":this.searchMode&&(this.massiveSelect.innerHTML=t.html,Affinity.prompts.adopt(this.massiveSelect),this.massiveSelect.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:this.massiveSelect,onComplete:function(n){this.massiveLoader.destroy();Affinity.prompts.center();Affinity.prompts.showButtons();Affinity.prompts.show();n.position()}.bind(this)}));break;case"getList":i=null;this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked);this.listElement.innerHTML=t.html;this.fuzzySearchItemsTotal=t.data.total;this.fuzzySearchItems=t.data.items;this.items=this.listElement.getElements("li");this.items.addEvent(Affinity.events.click,this.itemClicked);t.data.defaultID&&(i=this.listElement.getElement("#"+n.data.data.defaultID),this.defaultValue=i,this.lastSelected=i,this.defaultChangeValue=i.get("data-value"));this.continueProcessOptsions(i);break;case"resetList":this.listElement.innerHTML=t.html;this.iconElement&&this.iconElement.removeClass("working");t.select&&(this.lastSelected=document.id(t.select),this.defaultValue=document.id(t.select),this.bestguess=document.id(t.select),this.selectElement.value="");this.selectElement.selectedIndex=0;this.listElement.scrollTo(0,0);this.defaultChangeValue=this.defaultValue.value;this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked);this.fuzzySearchItemsTotal=t.data.total;this.fuzzySearchItems=t.data.items;this.items=this.listElement.getElements("li");this.items.addEvent(Affinity.events.click,this.itemClicked);window.fireEvent("elementChanged",{element:this.selectElement});break;case"doSearch":r=[];this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked);this.listElement.innerHTML=t.html;t.bestguess&&(this.bestguess=document.id(t.bestguess));this.iconElement&&this.iconElement.removeClass("working");this.items=this.listElement.getElements("li");this.items.addEvent(Affinity.events.click,this.itemClicked)}},cleanDisplay:function(n){if(typeOf(n)==="string"&&n.trim()!==""){var t=n.split(",").filter(function(n){return n!==""}).join(", ");return t.trim().replace(/&amp;/gi,"&")}return n},getValue:function(){return this.selectElement.value},setValue:function(n,t){var r,i;if(t=t||!0,n=this.cleanDisplay(n),typeOf(this.listElement)!=="null")if(this.searchMode)this.datalistElement.getElement("option[value="+n+"]")&&(this.displayElement.value=n,this.mobileChange());else{if(!n||n===""||typeOf(this.fuzzySearchItems)==="null"||this.fuzzySearchItems===!1){this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t});return}for(r=!1,i=0;i<this.fuzzySearchItems.length;i++)if(this.fuzzySearchItems[i].value+""==n+""){r=document.id(this.fuzzySearchItems[i].id);break}r?this.itemClicked({target:r,fireEvents:t}):this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t})}},getDisplayValue:function(){return this.cleanDisplay(this.displayElement.value)},status:"closed",searchMode_firstPass:!0,searchMode_lastKnownValue:"",searchMode_fireChangeEvents:function(n){this.changed=typeOf(n)==="boolean"&&n===!0?!0:!1;this.defaultChangeValue!==this.selectElement.value&&(this.defaultChangeValue=this.selectElement.value,this.changed=!0);!this.searchMode_firstPass&&this.changed&&this.searchMode_lastKnownValue===this.selectElement.value&&(this.changed=!1);this.changed&&(this.defaultChangeValue=this.selectElement.value,this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete search mode"}));this.searchMode_firstPass=!1},searchMode_valueToOption:function(n,t,i){var u,r;if(i=i||!1,this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.selectElement.empty(),new Element("option",{value:n,html:t}).inject(this.selectElement),this.selectElement.value=n,this.selectElement.selectedIndex=0;else for(this.selectElement.value=n,u=this.selectElement.getElements("options"),r=0;r<u.length;r++)if(u[r].value===n){this.selectElement.selectedIndex=r;break}this.displayElement.value=n;this.displayElement.store("data-search-value",n);this.searchMode_fireChangeEvents(i)},searchMode_iconClicked:function(){var t=this.cleanDisplay(this.displayElement.value),n,i;!Affinity.mobile&&t.trim()!==""&&t.length>1||Affinity.mobile?(n=new Element("select",{"class":"override ui-autocomplete-center hidden"}),i=new Element("span",{html:'Loading list <img src="'+Affinity.loaders.dark+'" />'}),uialert({message:"Set Value<br /><br />",showButtons:!0,showCancel:!0,canClose:!Affinity.mobile,position:{position:"fixed",top:10},onOk:function(){var n=document.id("UIPromtBox").getElement("select"),i=n.selectedIndex||0,r=n.getElements("option"),t=r[i],u=t.get("value");this.searchMode_valueToOption(t.get("value"),t.get("html"),!0);n.getWidget()&&n.getWidget().destroy();n.destroy()}.bind(this),onCancel:function(){n.getWidget()&&n.getWidget().destroy();n.destroy()},onClose:function(){n.getWidget()&&n.getWidget().destroy();n.destroy()}}),Affinity.prompts.adopt(i),Affinity.prompts.hideButtons(),function(){if(this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")){var e,r=this.selectElement.retrieve("data-store"),u=this.selectElement.retrieve("data-key"),f=Affinity.UI[r][u].api;f=f.contains("limit")?f.substr(0,f.indexOf("limit")-1):f;Affinity.UI[r][u].data.length===0?new Request.JSONP({callbackKey:"jsoncallback",url:f,method:"get",timeout:3e4,onComplete:function(f){JSON.Unauthorized(f,Affinity.UI[r][u].id+", lookup massive loader")||("error"in f?i.set("html","Failed loading list. Please refresh and try again."):typeOf(f)==="array"&&f.length>0&&(Affinity.UI[r][u].data=f,Affinity.UI[r][u].loaded=!0,this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[r][u].data,function(i){(i.Value.toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(e=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(n),i.Value===t&&e.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy();Affinity.prompts.center();Affinity.prompts.showButtons();Affinity.prompts.show();n.position();Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))))}.bind(this),onError:function(){i.set("html","Failed loading list. Please refresh and try again.");Affinity.prompts.showButtons()}.bind(this),onFailure:function(){i.set("html","Failed loading list. Please refresh and try again.");Affinity.prompts.showButtons()}.bind(this),onTimeout:function(){i.set("html","List loader timed out. Please refresh and try again.");Affinity.prompts.showButtons()}.bind(this)}).send():this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[r][u].data,function(i){(i.Value.toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(e=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(n),i.Value===t&&e.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy();Affinity.prompts.center();Affinity.prompts.showButtons();Affinity.prompts.show();n.position();Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))}else this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(this.selectElement.getElements("option"),function(i){(i.get("html").stripTags().toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(i=new Element("option",{value:i.get("value")?i.get("value"):i.get("html").stripTags(),html:this.cleanDisplay(i.get("html"))}).inject(n),i.get("html")===t&&i.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy();Affinity.prompts.center();Affinity.prompts.showButtons();Affinity.prompts.show();n.position();Affinity.oldess&&Affinity.oldessWindow.scrollTo(0,0)}}))}.delay(300,this)):t.trim()!==""&&t.length===1?uialert({message:"You must enter more than 1 character",showButtons:!0}):uialert({message:"You must enter a search term",showButtons:!0})},searchMode_displayBlur:function(){var t=this.cleanDisplay(this.displayElement.value),n=this.displayElement.retrieve("data-search-value");(n===""||t!==n)&&(n=t);this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.selectElement.empty(),this.searchMode_valueToOption(n,t))},updateOptions:function(){this.clearList();this.processOptions()},processCount:0,processOptions:function(){var i,r,u,n,e,f,t,o;typeOf(this.selectElement)!=="null"&&this.selectElement&&"getElements"in this.selectElement&&(i=this.selectElement.getElements("option"),(i.length>Affinity.selectmax||this.selectElement.hasClass("massive"))&&(this.searchMode=!0),this.searchMode&&this.selectElement.hasClass("override")&&(this.searchMode=!1),r=!0,u=!0,this.searchMode?(n=this.uuid,Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display").inject(this.hiddenWrapper,"before"),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),r=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),r&&(this.displayElement=new Element("input",{type:"text","class":"ui-autocomplete-display",id:n+"-Display"}).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.killid),n=this.uuid+"_icon",Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),u=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),u&&(this.iconElement=new Element("span",{"class":"ui-autocomplete-display-icon searchmode",id:n+"-Display-Icon",html:Affinity.icons.Search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.selectElement.hasClass("massive")&&this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"))),this.selectElement.hasClass("massive")||(this.selectElement.addClass("massive"),this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")?this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label")):i.length>0&&(e=this.selectElement.selectedIndex&&this.selectElement.selectedIndex>0?this.selectElement.selectedIndex:0,this.searchMode_valueToOption(i[e].get("value")||"",i[e].get("html")))),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.fireEvent("complete",this)):(this.displayElement?this.listElement.empty():(n=this.uuid,Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid),this.displayElement.removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display").cloneEvents(this.selectElement),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),r=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),r&&(this.displayElement=new Element("input",{type:"text","class":"ui-autocomplete-display",id:this.uuid+"-Display"}).cloneEvents(this.selectElement).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.selectElement.get("class")),this.displayElement.addClass(this.killid),n=this.uuid+"_icon",Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),u=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),u&&(this.iconElement=new Element("span",{"class":"ui-autocomplete-display-icon",id:n+"-Display-Icon",html:this.icons.search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.displayElement.makeFormElement(),this.displayElement.addClass("widget"),this.displayElement.store("widget",this),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.displayElement.set("autocomplete","off"),this.selectElement.hasClass("has-message-icon")&&this.displayElement.addClass("has-message-icon"),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.listElement=new Element("ul",{"class":"ui-autocomplete-list",id:this.domid}).inject(document.body,"bottom"),this.autowidth&&this.listElement.addClass("auto-width"),Affinity.mobile?window.addEvent("mobileback",function(){this.hide()}.bind(this)):(new Affinity.SmartClose(this.displayElement),new Affinity.SmartClose(this.listElement),this.displayElement.addEvent("SmartClose",function(){this.listElement.isOver()||this.hide()}.bind(this)),this.listElement.addEvent("SmartClose",function(){this.displayElement.isOver()||this.hide()}.bind(this))),(this.displayElement.hasClass("width-auto")||this.displayElement.hasClass("width-full"))&&this.listElement.setStyle("width",this.displayElement.getSize().x),this.listElement.set("tween",{duration:100}),this.listElement.fade("hide"),this.displayElement.addEvent("focus",this.doFocus),this.listElement.set("tween",{duration:100,onComplete:function(n){n.getStyle("opacity")===0?n.addClass("hidden"):n.removeClass("hidden")}}),this.listElement.fade("hide")),this.items=[],this.fuzzySearchItems=[],o=null,this.defaultValue=null,this.useWebWorkers?(this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"getList",html:this.selectElement.innerHTML,defaultValue:this.selectElement.get("data-default-value")||!1,uuid:this.uuid})):(Array.each(this.selectElement.getElements("option"),function(n,i){f=this.cleanDisplay(n.get("html"));value=n.get("value");t=new Element("li",{html:f,"data-value":value,"class":"visible",id:this.uuid+"-li-"+i});t.set("data-index",i);t.set("data-value",value);t.addEvent(Affinity.events.click,this.itemClicked);t.inject(this.listElement);n.selected&&(o=t,this.defaultValue=t,t.addClass("selected"),this.lastSelected=t,this.defaultChangeValue=n.value);this.items.push(t);this.fuzzySearchItems.push({id:this.uuid+"-li-"+i,html:f,klass:"visible",searchstr:f,value:n.value})}.bind(this)),this.continueProcessOptsions(o))))},continueProcessOptsions:function(n){this.searchMode||(this.useWebWorkers||(this.fuzzySearchItemsTotal=this.fuzzySearchItems.length),this.iconElement&&this.iconElement.removeClass("working"),this.fuzzySearchLargeDataDelay=!1,!0&&(this.fuzzySearchLargeDataDelay=100),this.fuzzySearchItemsTotal>=2e3&&this.fuzzySearchItemsTotal<3e3&&(this.fuzzySearchLargeDataDelay=250),this.fuzzySearchItemsTotal>=3e3&&this.fuzzySearchItemsTotal<5e3&&(this.fuzzySearchLargeDataDelay=500),this.fuzzySearchItemsTotal>=5e3&&(this.fuzzySearchLargeDataDelay=1e3),Affinity.isie&&Affinity.ieversion===11&&(this.fuzzySearchLargeDataDelay=1001),this.defaultValue===null&&(this.defaultValue=this.listElement.getElement("li")),this.keyHeldCheck=!1,this.keyHeld=!1,this.keyHeldDelay=null,this.displayElement.addEvent("keyup",this.doKeyUp),this.displayElement.addEvent("keydown",this.doKeyDown),n!==null&&this.defaultSelected({target:n}),this.fireEvent("complete",this),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,this.options.stopInitialChange&&this.selectElement.fireEvent("change",{target:this.selectElement}),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this));this.displayElement&&this.valuetracker.addElement(this.displayElement)},stopEvent:function(n){n.stop()},reset:function(){if(!this.searchMode){var n=!1;typeOf(this.defaultValue)!=="null"&&this.defaultValue&&this.defaultValue.get("tag")==="li"&&(n=this.defaultValue);typeOf(this.lastSelected)!=="null"&&this.lastSelected&&this.lastSelected.get("tag")==="li"&&(n=this.lastSelected);Array.each(this.items,function(t){t.inject(this.listElement);t.removeClass("selected");t.removeClass("hidden");t.addClass("visible");this.fuzzySearchLargeDataDelay||t.set("html",this.cleanDisplay(t.get("html").stripTags()));n&&t===n&&(t.addClass("selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5),this.displayElement.value=this.cleanDisplay(n.get("html").stripTags()))}.bind(this))}},checkExists:function(){document.contains(this.selectElement)||(clearInterval(this.checkExistsPeriodical),this.destroy())},doFocusDelay:!1,doFocus:function(){clearTimeout(this.doFocusDelay);this.doFocusDelay=function(){this.status=="closed"&&this.show("displayElement focus")}.delay(100,this);Affinity.mobile&&(this.displayElement.selectionStart=0,this.displayElement.selectionEnd=999999)},doClick:function(n){this.stopEvent(n);this.displayElement.select()},doKeyUp:function(n){n.key=="tab"||n.shift||(n.key=="tab"&&this.hide("on key up tab"),clearTimeout(this.keyHeldDelay),this.keyHeld||this.elementKeyUp(n),this.keyHeld=!1,this.keyHeldCheck=!1)},doKeyDown:function(n){if(n.key=="tab"&&this.hide("on key down tab"),n.key!="tab"){if(n.key=="enter"){this.stopEvent(n);return}if(n.key=="down"||n.key=="up"){if(this.keyHeldCheck||this.keyHeld){this.stopEvent(n);return}this.keyHeldCheck||this.keyHeld||(this.keyHeldCheck=!0,this.keyHeldDelay=this.elementKeySetHeld.delay(500,this,[n]))}}},elementKeySetHeld:function(n){this.keyHeld=!0;this.elementKeyUp(n)},getTopVisibleElement:function(){for(var i=this.listElement.getElements("li.visible"),t,r,n=0;n<i.length;n++)if(t=i[n],r=t.getPosition(this.listElement),r.y>0)return t},getBottomVisibleElement:function(){for(var u=this.listElement.getSize().y,i=this.listElement.getElements("li.visible"),t,r,n=i.length-1;n>0;n--)if(t=i[n],r=t.getPosition(this.listElement),r.y<u)return t},scrollToTop:function(n){var i=this.listElement.getScroll().y,t=n.getPosition(this.listElement).y,r=n.getSize().y;t<0&&this.listElement.scrollTo(0,i+t-r+10)},scrollToBottom:function(n){var u=this.listElement.getScroll().y,t=this.listElement.getSize().y,i=n.getPosition(this.listElement).y,r=n.getSize().y;i>t-r&&this.listElement.scrollTo(0,u+(i-t)+r+5)},escapeRegExp:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},fuzzyRunning:!1,fuzzySearch:function(n,t,i,r){var v,f,o,u,h,e,tt,l,y,k,p,s,w,a,d,g,nt,c,b;if(!this.fuzzyRunning)return this.fuzzyRunning=!0,v=[],this.useWebWorkers?(this.fuzzyDoSearchData={searchData:n,target:r},this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"doSearch",data:n,searchKey:t,searchFor:i,perfDelay:this.fuzzySearchLargeDataDelay})):(f=[],isNaN(i)?Array.each(n,function(n,r){u=document.id(n.id);h=0;tt=[];i=i.toLowerCase();l=n[t].toLowerCase().trim();y=i===l;k=l.indexOf(i)>-1?!0:!1;w=i.split(" ");p=w.length;y?(s=p,e=99999,h=99999,this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c="<strong>"+this.cleanDisplay(u.get("html").stripTags())+"<\/strong>",u.set("html",c).removeClass("hidden").addClass("visible"))):!y&&k?(s=l.split(i).length-1||0,e=s,h=e+100,this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c=this.cleanDisplay(u.get("html").stripTags()).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1<\/strong>"),u.set("html",c).removeClass("hidden").addClass("visible"))):this.fuzzySearchLargeDataDelay<1001&&(a=l.split(" "),s=0,Array.each(w,function(n){Array.each(a,function(t){n!=" "&&n!=""&&(d=n.soundex(),g=t.soundex(),nt=d.distance(g),nt==0&&(s+=1))})}),h=s,e=Number.round(s/p,2)||0,h>=0&&(this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c=this.cleanDisplay(u.get("html").stripTags()),u.set("html",c).removeClass("hidden").addClass("visible"))));o={originalIndex:r,score:h,wordScore:e};f.push(o)}.bind(this)):Array.each(n,function(n,r){u=document.id(n.id);n[t].contains(i)?(e=n[t].split(i).length-1||0,a=n[t].split(" "),f.push({originalIndex:r,score:e,wordScore:e/a}),u.removeClass("hidden").addClass("visible")):u.addClass("hidden").removeClass("visible")}),f.sort(function(n,t){return parseFloat(n.score)===parseFloat(t.score)?parseFloat(n.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(n.score)<parseFloat(t.score)?1:-1}),b=!1,Array.each(f,function(t){o=n[t.originalIndex];o.score=t.score;o.wordScore=t.wordScore;v.push(o);u=document.id(o.id);t.score>0?(u.inject(r),b=!0):u.addClass("hidden").removeClass("visible")}),!b&&f.length>0&&f[0].originalIndex&&n[f[0].originalIndex]&&n[f[0].originalIndex].id&&(this.bestguess=document.id(n[f[0].originalIndex].id))),this.fuzzyRunning=!1,v},elementKeyUp:function(n){var i=this.cleanDisplay(this.displayElement.value.toLowerCase()),t=this.listElement.getElement("li.visible.selected")||!1;if(n.key=="enter"&&t){this.stopEvent(n);this.itemClicked({target:t});return}if(n.key=="down"||n.key=="up"){this.status=="closed"&&this.show();n.preventDefault();n.key=="down"&&this.elementDown(n);n.key=="up"&&this.elementUp(n);this.keyHeld&&this.elementKeyUp.delay(50,this,[n]);return}if(n.code===8||n.code===16||n.code===32||n.code===46||n.code>=48&&n.code<=57||n.code>=65&&n.code<=90||n.code>=96&&n.code<=105)this.status=="closed"&&this.show();else return;if(i===""){this.useWebWorkers?this.fuzzyWorker.postMessage({job:"resetList"}):(Array.each(this.items,function(n){n.inject(this.listElement);n.set("html",this.cleanDisplay(n.get("html").stripTags()));n.removeClass("selected").removeClass("hidden").addClass("visible");n.get("html").trim()===""&&(n.addClass("selected"),t!==n&&(this.changed=!0),this.lastSelected=n,this.defaultValue=n,this.selectElement.value="",this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.selectElement.getElements("option")[0].value)}.bind(this)),this.bestguess=this.defaultValue,window.fireEvent("elementChanged",{element:this.selectElement}));return}this.listElement.getElements("li").removeClass("selected");this.listElement.scrollTo(0,0);t&&(this.lastSelected=t);this.fuzzySearchLargeDataDelay?(clearTimeout(this.fuzzySearchDelay),this.fuzzySearchDelay=this.continueWithFuzzySearch.delay(this.fuzzySearchLargeDataDelay,this)):this.continueWithFuzzySearch();this.position()},continueWithFuzzySearch:function(){var n=this.fuzzySearch(this.fuzzySearchItems,"searchstr",this.cleanDisplay(this.displayElement.value.toLowerCase()),this.listElement);this.position()},elementUp:function(){if(this.listElement.getElements("li.visible").length===0){this.hide("elementUp with empty list");return}var r=this.listElement.getElement("li.visible.selected"),u=this.getTopVisibleElement(),n=this.getBottomVisibleElement(),t=-1,i=this.listElement.getElements("li.visible");r&&(t=i.indexOf(r),r.removeClass("selected"));t>i.indexOf(n)?n&&"addClass"in n&&n.addClass("selected"):t>0?i[t-1]&&"addClass"in i[t-1]&&(i[t-1].addClass("selected"),this.scrollToTop(i[t-1])):this.listElement.scrollHeight==this.listElement.clientHeight?n&&"addClass"in n&&n.addClass("selected"):u&&"addClass"in u&&u.addClass("selected");window.fireEvent("elementChanged",{element:this.selectElement})},elementDown:function(){if(this.listElement.getElements("li.visible").length===0){this.hide("elementDown with empty list");return}var r=this.listElement.getElement("li.visible.selected"),n=this.getTopVisibleElement(),u=this.getBottomVisibleElement(),t=-1,i=this.listElement.getElements("li.visible");r&&"addClass"in r&&(t=i.indexOf(r),r.removeClass("selected"));t<i.indexOf(n)?n&&"addClass"in n&&n.addClass("selected"):t<i.length-1?i[t+1]&&"addClass"in i[t+1]&&(i[t+1].addClass("selected"),this.scrollToBottom(i[t+1])):this.listElement.scrollHeight==this.listElement.clientHeight?n&&"addClass"in n&&n.addClass("selected"):u&&"addClass"in u&&u.addClass("selected")},defaultSelected:function(n){var t=this.cleanDisplay(n.target.get("html").stripTags());this.listElement.getElements("li").removeClass("selected");n.target.addClass("selected");this.displayElement.value=t;this.selectElement.selectedIndex=n.target.get("data-index");this.selectElement.value=n.target.get("data-value")},itemClicked:function(n){this.hide("item clicked");var t=n.target.get("tag")=="li"?n.target:n.target.getParent("li"),i=n.hasOwnProperty("fireEvents")&&n.fireEvents===!1?!1:!0;this.listElement.getElements("li").removeClass("selected");t.addClass("selected");this.lastSelected=t;this.displayElement.value=this.cleanDisplay(t.get("html").stripTags());this.selectElement.selectedIndex=t.get("data-index");this.selectElement.value=t.get("data-value");this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1;i&&(this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete itemClicked"}),this.fireEvent("elementChanged",this.selectElement.value))},position:function(){if(this.displayElement&&this.listElement)try{var n=this.displayElement.getPosition(),u=this.displayElement.measure(function(){return this.getSize()}),i=window.getSize(),f=document.body.scrollTop||0,e=n.y+u.y+f+5,r=n.x,t=this.listElement.measure(function(){return this.getSize()});this.center&&(r=n.x+u.x/2-t.x/2);i.y-n.y<t.y&&(e=n.y-t.y-5+f);n.x+t.x>i.x&&(r=i.x-t.x-5);this.listElement.setStyles({position:Affinity.mobile?"fixed":"absolute",top:e,left:r})}catch(o){}},obscure:function(){this.hide();this.iconElement&&this.iconElement.addClass("hidden");this.displayElement&&this.displayElement.addClass("hidden")},reveal:function(){this.iconElement&&this.iconElement.removeClass("hidden");this.displayElement.removeClass("hidden")},hide:function(){if(this.status!=="closed"){clearTimeout(this.doFocusDelay);clearTimeout(this.fuzzySearchDelay);var n=this.listElement;n.fade("out");this.status="closed",function(){n.addClass("hidden");this.listElement&&"getElement"in this.listElement&&!this.listElement.getElement("li.visible.selected")&&(this.lastSelected=this.listElement.getElement("li.visible.selected"));this.reset()}.delay(250,this)}},show:function(){var n,t;this.status!=="open"&&this.listElement&&"getElements"in this.listElement&&this.listElement.getElements("li.visible").length>0&&(window.autocompletes.hideAll(this),clearTimeout(this.doFocusDelay),n=this.listElement,n.removeClass("hidden"),this.position(),n.fade("in"),this.status="open",this.position.delay(250,this),this.listElement&&"getElement"in this.listElement&&this.listElement.getElement("li.visible.selected")&&(t=this.listElement.getElement("li.visible.selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5)))},clearList:function(){this.listElement&&(Array.each(this.listElement.getElements("li"),function(n){n.removeEvents()}.bind(this)),this.listElement.empty())},revert:function(n){var i=typeOf(n)==="null"?!1:n,t;if(this.useWebWorkers&&this.fuzzyWorker&&"terminate"in this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1),t="moo remove children",clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay),clearInterval(this.checkExistsPeriodical),this.doFocusDelay=null,this.fuzzySearchDelay=null,this.checkExistsPeriodical=null,this.displayElement&&(Affinity.UI.lastAutoKill[this.uuid]={},Affinity.UI.lastAutoKill[this.uuid].id=this.uuid+"",Affinity.UI.lastAutoKill[this.uuid].killid=this.killid+"",Affinity.UI.lastAutoKill[this.uuid].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"",this.killid+""]),this.iconElement&&(this.iconElement.addClass("loading"),Affinity.UI.lastAutoKill[this.uuid+"_icon"]={},Affinity.UI.lastAutoKill[this.uuid+"_icon"].id=this.uuid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].killid=this.killid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"_icon",this.killid+"_icon"]))),Affinity.mobile||(document.removeEvent("scroll",this.position),document.removeEvent("resize",this.position)),this.listElement){if(this.listElement.set("tween",null),this.listElement.removeEvents(),t==="native remove")try{this.listElement.parentNode.removeChild(this.listElement)}catch(r){}if(t==="native remove children"){while(this.listElement.lastChild)this.listElement.lastChild.removeEventListener(Affinity.events.click,this.itemClicked),this.listElement.removeChild(this.listElement.lastChild);try{this.listElement.parentNode.removeChild(this.listElement)}catch(r){}}t==="moo remove"&&this.listElement.destroy();t==="moo remove children"&&(this.clearList(),this.listElement.destroy())}return this.displayElement&&(this.displayElement.removeEvents(),this.displayElement.getWidget("elementWidget")&&this.displayElement.getWidget("elementWidget").destroy(),this.searchMode&&this.displayElement.eliminate("value")),this.selectElement&&(this.selectElement.inject(this.hiddenWrapper,"before"),this.selectElement.eliminate("widget"),i&&(this.selectElement.retrieve("changetracker")&&this.selectElement.retrieve("changetracker").destroy(),this.selectElement.destroy())),this.hiddenWrapper&&this.hiddenWrapper.destroy(),window.autocompletes.widgets[this.uuid]&&(window.autocompletes.widgets[this.uuid]=null,delete window.autocompletes.widgets[this.uuid]),Object.each(this,function(n,t){this[t]=null;delete this[t]}.bind(this)),!0},destroy:function(){this.useWebWorkers&&this.fuzzyWorker&&(this.fuzzyWorker.terminate(),this.fuzzyWorker=!1);this.revert(!0)}}),UIBankNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(n){this.setOptions(n);this.processNew()},processNew:function(){Array.each(document.getElements(".ui-banknumber"),this.process)},process:function(n){n.removeClass("ui-banknumber");new UIBankNumberWidget({element:n})}}),UIBankNumberWidget=new Class({Implements:[Options,Events],Binds:["bankFieldChange","currentLocation","bankFields","buildNZBank","buildAUBank","bankValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy","padLeft"],options:{element:null,hasPayPoint:!0},element:null,type:"banknumber",initialize:function(n){if(this.setOptions(n),this.uuid=String.uniqueID(),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=this.originalElement.get("disabled")?!0:!1,this.options.element===null||typeOf(this.options.element)!=="element")throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{"class":"countryselector"}).inject(this.options.element,"before");this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown=t==="True"?new Element("select",{"class":"selector validate","data-validate-method":"bankNumberCountry"}).inject(this.dropdownDiv):new Element("select",{"class":"selector"}).inject(this.dropdownDiv);this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown);this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdown);this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after");this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(i){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden");this.disabled?(this.countrySelectEl=new Element("input",{type:"text","class":"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.bankFieldChange,window.addEvent("bankValidationReturned",this.processValidation));this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country");this.bankFields(this.currentLocation())},bankFieldChange:function(){this.element!=null&&this.element.destroy();this.bankFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?this.countrySelectEl.get("tag")==="select"&&this.countrySelectEl.selectedIndex!="-1"?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},bankFields:function(n){n==="NZ"?(this.buildNZBank(),this.originalElement.removeClass("hidden")):n==="AU"?(this.buildAUBank(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("bankValidationError",{target:this.originalElement,silent:!0}))},buildNZBank:function(){this.element=new Element("div",{"class":"banknumberbox ui-validate nz","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after");this.element.set("tabindex",5e3);this.bankNumberPart1=new Element("input",{"class":"bank",id:"bank",type:"text",maxlength:"2"}).inject(this.element);new Element("span",{html:"-"}).inject(this.element);this.bankNumberPart2=new Element("input",{"class":"branch",id:"branch",type:"text",maxlength:"4"}).inject(this.element);new Element("span",{html:"-"}).inject(this.element);this.bankNumberPart3=new Element("input",{"class":"account",id:"account",type:"text",maxlength:"7"}).inject(this.element);new Element("span",{html:"-"}).inject(this.element);this.bankNumberPart4=new Element("input",{"class":"suffix",id:"suffix",type:"text",maxlength:"3"}).inject(this.element);this.tickcross=new Element("span",{"class":"tickcross font-icons color"}).inject(this.element);this.name=new Element("span",{"class":"names"}).inject(this.element);this.bankname=new Element("span",{"class":"bankname"}).inject(this.name);this.branchname=new Element("span",{"class":"branchname"}).inject(this.name);this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{"class":"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before"));this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.bankNumberPart4.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.bankNumberPart3.onblur=this.padLeft,this.bankNumberPart4.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked));this.setFromInitialValue()},buildAUBank:function(){this.element=new Element("div",{"class":"banknumberbox ui-validate au","data-validate-method":"banknumber"}).inject(this.dropdownDiv,"after");this.element.set("tabindex",5e3);this.bankNumberPart1=new Element("input",{"class":"bank",id:"bank",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:"-"}).inject(this.element);this.bankNumberPart2=new Element("input",{"class":"branch",id:"branch",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:"-"}).inject(this.element);this.bankNumberPart3=new Element("input",{"class":"account",id:"account",type:"text",maxlength:"14"}).inject(this.element);this.tickcross=new Element("span",{"class":"tickcross font-icons color"}).inject(this.element);this.name=new Element("span",{"class":"names"}).inject(this.element);this.bankname=new Element("span",{"class":"bankname"}).inject(this.name);this.branchname=new Element("span",{"class":"branchname"}).inject(this.name);this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{"class":"subhidden",id:"subhidden_"+this.uuid}).inject(this.options.element,"after"),this.hiddenWrapper.adopt(this.options.element),this.element.inject(this.hiddenWrapper,"before"));this.disabled?(this.bankNumberPart1.set("disabled","disabled"),this.bankNumberPart2.set("disabled","disabled"),this.bankNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.bankNumberPart1.onkeyup=this.processKeyUp,this.bankNumberPart2.onkeyup=this.processKeyUp,this.bankNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked));this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden();this.bankValidation()},padLeft:function(){this.bankNumberPart3&&this.bankNumberPart3.value!==""&&(this.bankNumberPart3.value=this.bankNumberPart3.value.padStart(7,"0"))},setFromInitialValue:function(){var n=this.hiddenWrapper.getElement("input").value.split("-");this.currentLocation()=="NZ"?(this.bankNumberPart1.value=n[0]?n[0].length>2?n[0].substring(0,2):n[0]:"",this.bankNumberPart2.value=n[1]?n[1]:"",this.bankNumberPart3.value=n[2]?n[2]:"",this.bankNumberPart4&&(n[2]&&n[2].length>7?(this.bankNumberPart3.value=n[2].substring(0,7),this.bankNumberPart4.value=n[2].substring(7,n[2].length)):this.bankNumberPart4.value=n[3]?n[3]:"")):this.currentLocation()=="AU"?(this.bankNumberPart1.value=n[0]?n[0]:"",this.bankNumberPart2.value=n[1]?n[1]:"",this.bankNumberPart3.value=(n[2]?n[2]:"")+(n[3]?n[3]:"")):(this.bankNumberPart1.value="",this.bankNumberPart2.value="",this.bankNumberPart3.value="",this.bankNumberPart4&&(this.bankNumberPart4.value=""));this.bankValidation()},copyToHidden:function(){var n="";if(this.currentLocation()=="NZ"){var t=this.bankNumberPart1.value!=""?this.bankNumberPart1.value+"-":"",i=this.bankNumberPart2.value!=""?this.bankNumberPart2.value+"-":"",r=this.bankNumberPart3.value!=""?this.bankNumberPart3.value+"-":"",u=this.bankNumberPart4.value!=""?this.bankNumberPart4.value:"";n=t+i+r+u}else if(this.currentLocation()=="AU"){var t=this.bankNumberPart1.value!=""?this.bankNumberPart1.value+"-":"",i=this.bankNumberPart2.value!=""?this.bankNumberPart2.value+"-":"",r=this.bankNumberPart3.value!=""?this.bankNumberPart3.value:"";n=t+i+r}this.hiddenWrapper.getElement("input").value=n;this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},bankValidationDelay:!1,bankValidation:function(){clearTimeout(this.bankValidationDelay);this.bankValidationDelay=function(){var n=this.hiddenWrapper.getElement("input"),t=n.getParent("form"),i;t!=null&&t.retrieve("validation")&&(i=t.retrieve("validation"),i.validateBankNumber(n,this.currentLocation(),n.get("name")))}.delay(500,this)},processValidation:function(n){var i=n.el,t=n.data;i===this.originalElement&&(this.bankname.set("html",t.bankName),this.branchname.set("html",t.branchName),t.success?this.success():i.value?this.failed():(window.fireEvent("bankValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(){var n=this.tickcross;n.set("html",Affinity.icons.Tick);n.removeClass("red").addClass("green")},failed:function(){var n=this.tickcross;n.set("html",Affinity.icons.Cross);n.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy());this.selectElement.inject(this.hiddenWrapper,"before");this.hiddenWrapper.destroy();this.selectElement.eliminate("widget");var n=this.selectElement;return Object.each(this,function(n){this[n]=null;delete this[n]}.bind(this)),n},destroy:function(){clearTimeout(this.checkExistsPeriodical);var n=this.revert();n.destroy()}}),UIDateCalendar=new Class({Version:"1.0.0.0",File:"ui.date.calendar.js",Implements:[Options,Events],Binds:["processNew","processDateInput","hideAll"],options:{outputFormat:"%d.%m.%Y",displayFormat:"%a the %e%o of %b %Y"},widgets:{},initialize:function(n){this.setOptions(n);Affinity.UI||(Affinity.UI={});Affinity.UI.calendars=this;this.processNew()},processNew:function(){Array.each(document.getElements("input.uidate-calendar"),this.processDateInput)},processDateInput:function(n){var t,i;if(!n.hasClass("uidone")){n.addClass("uidone");t={target:n,postName:n.get("name")||"",postId:n.get("id")||"",startDate:n.get("data-start-date")||new Date,validationMethods:n.get("data-validate-method")||"",validationErrorStr:n.get("data-validate-error-str")||"",showInline:n.hasClass("show-inline")?!0:!1,nullable:!1};switch(n.get("data-calendar-type")){case"date":t.showCalendar=!0;t.showTime=!1;break;case"time":t.showCalendar=!1;t.showTime=!0;break;case"datetime":t.showCalendar=!0;t.showTime=!0;break;case"hoursmins":t.showCalendar=!0;t.showTime=!0;t.hoursmins=!0;break;default:t.showCalendar=!0;t.showTime=!1}n.get("data-calendar-display-format")&&(t.displayFormat=n.get("data-calendar-display-format"));n.get("data-calendar-return-format")&&(t.outputFormat=n.get("data-calendar-return-format"));n.get("data-calendar-nullable")&&(t.nullable=n.get("data-calendar-nullable").trim().toLowerCase()==="true"?!0:!1);n.get("data-calendar-hoursmins")&&(t.hoursmins=n.get("data-calendar-hoursmins").trim().toLowerCase()==="true"?!0:!1);n.hasClass("preserve-original-input")&&(t.preserveOriginalInput=!0);t.hoursmins&&!n.get("data-start-date")&&(t.startDate.setMinutes(0),t.startDate.setHours(0),t.startDate.setSeconds(0),t.startDate.setMilliseconds(0));i=new UIDateTimeWidget(t);this.widgets[i.uuid]||(this.widgets[i.uuid]=i);delete i;delete t}},hideAll:function(n){Object.each(this.widgets,function(t){typeOf(n)!=="null"&&n.uuid?t.uuid!==n.uuid&&t.hide():t.hide()}.bind(this))}}),UIDateTimeWidget=new Class({Implements:[Options,Events],options:{target:null,preserveOriginalInput:!1,outputFormat:"%d.%m.%Y",displayFormat:"%a %e %b %Y",showCalendar:!0,showTime:!1,startDate:null,labelName:"",postId:"",postName:"",validationMethods:"",validationErrorStr:"",cssPosition:"absolute",watchOutput:!1,nullable:!1,hoursmins:!1,showInline:!1},Binds:["getDate","getDateObject","getValue","getDisplayValue","documentClick","calendarClick","calendarEnter","calendarLeave","monthElementClicked","yearElementClicked","monthSelectorClicked","yearSelectorClicked","lastMonth","nextMonth","resetCalendar","nextMonthDown","lastMonthDown","dayClicked","timeChanged","setCalendarDate","changeMonth","changeYear","attemptParse","setToday","setNone","externalShow","watchOutputChanges","obscure","reveal","show","hide","destroy"],row:null,date:null,__uiDate:null,__selectedDate:null,getValue:function(){return this.date.format(this.options.displayFormat)},getDisplayValue:function(){return this.date.format(this.options.outputFormat)},initialize:function(n){var t,i,r;this.setOptions(n);this.showDefault=this.options.startDate=="none"?!1:!0;t=new Date;this.__uiDate=t.clone();this.__selectedDate=this.date=!1;this.options.startDate=="none"?this.options.target&&"value"in this.options.target&&this.options.target.value.trim()!==""?Date.parse(this.options.target.value).isValid()?(this.__uiDate=Date.parse(this.options.target.value),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone(),this.showDefault=!0):this.showDefault=!1:this.showDefault=!1:this.options.startDate=="today"?(this.__uiDate=t.clone(),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()):this.options.startDate&&this.options.startDate!==null&&Date.parse(this.options.startDate).isValid()&&(this.__uiDate=Date.parse(this.options.startDate),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone());this.options.hoursmins&&t.getTime()===this.__uiDate.getTime()&&(this.__uiDate.setMinutes(0),this.__uiDate.setHours(0),this.__uiDate.setSeconds(0),this.__uiDate.setMilliseconds(0),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone());this.options.nullable&&(this.showDefault=!1);this.id=this.options.target!=null?this.options.target.get("id")?this.options.target.get("id"):String.uniqueID():String.uniqueID();this.uuid=this.id;Affinity.UI.calendars.widgets[this.uuid]||(Affinity.UI.calendars.widgets[this.uuid]=this);this.display=new Element("input",{type:"text","class":"ui-calendar-display data-hj-whitelist widget",id:this.id+"-Display"}).store("widget",this);this.output=new Element("input",{type:"hidden",name:this.options.postName,id:this.options.postId,"data-display-id":this.id+"-Display"});Affinity.mobile&&this.display.set("readonly","true");this.options.validationMethods!=""&&(this.output.addClass("validate"),this.output.set("data-validate-method",this.options.validationMethods),this.options.validationErrorStr&&this.output.set("data-validate-error-str",this.options.validationErrorStr));this.watch=this.options.watchOutput||!1;typeOf(this.options.target)!=="null"&&this.options.target.hasClass("uidate-watch")&&(this.watch=!0);this.watch&&(this.watchTimer=this.watchOutputChanges.periodical(500,this));this.reuse=this.options.preserveOriginalInput||!1;typeOf(this.options.target)!=="null"&&this.options.target.hasClass("uidate-preserve")&&(this.reuse=!0);this.reuse?typeOf(this.options.target)==="null"?(this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{"class":"hidden"}).inject(this.label,"after")):(this.row=this.options.target.getParent(".form-row")||!1,this.target=this.options.target,this.output=this.target,i=new Element("div",{"class":"subhidden"}),this.target.store("widget",this),this.row?(i.inject(this.row,"top"),this.display.inject(this.row,"bottom")):(i.inject(this.output,"before"),this.display.inject(this.output,"after")),this.output.inject(i)):(this.options.target==null?(this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{"class":"hidden"}).inject(this.label,"after")):(this.target=new Element("div",{"class":"hidden"}).inject(this.options.target,"after"),this.options.target.value&&(r=Date.parse(this.options.target.value),r.isValid()&&(this.options.startDate=r)),this.row=this.options.target.getParent(".form-row"),this.options.postId=this.options.target.get("id"),this.options.postName==""&&(this.options.postName=this.options.target.get("name"),this.output.set("name",this.options.postName)),this.display.cloneEvents(this.options.target),this.options.target.set("id","__"+this.options.target.get("id")),this.options.target.set("name",null),this.options.target.removeEvents(),this.options.target.store("widget",this).addClass("hidden")),this.row!==null&&this.row.set("class","form-row ui-calendar-row "+this.id),this.display.inject(this.target,"after"),this.output.inject(this.target,"after"),this.target.destroy());this.icons={};this.icons.Open=Affinity.icons.Popup||"&#xe012;";this.icons.Today=Affinity.icons.Calendar||"&#xe02e;";this.icons.Clear=Affinity.icons.Cross||"&#xe067;";this.icons.Tick=Affinity.icons.Tick;this.dontClose=!1;this.calendarOver=!1;this.buttons=new Element("span",{"class":"ui-calendar-buttons"}).inject(this.display,"after");this.showbutton=new Element("span",{"class":"ui-calendar-button button w-icon-only blue ui-has-tooltip",html:"<span>"+this.icons.Open+"<\/span>","data-calendar":this.id,"data-tooltip":"Open","data-tooltip-dir":"top"}).inject(this.buttons);this.todaybutton=new Element("span",{"class":"ui-calendar-button button w-icon-only green ui-has-tooltip",html:"<span>"+this.icons.Today+"<\/span>","data-calendar":this.id,"data-tooltip":"Set date to today","data-tooltip-dir":"top"}).inject(this.buttons);this.clearbutton=new Element("span",{"class":"ui-calendar-button button w-icon-only orange ui-has-tooltip",html:"<span>"+this.icons.Clear+"<\/span>","data-calendar":this.id,"data-tooltip":"Clear the date","data-tooltip-dir":"top"}).inject(this.buttons);this.calendarBox=new Element("div",{"class":"ui-calendar",id:this.domid}).inject(document.body);this.calendarBox.set("reveal",{duration:250});this.options.showInline||this.calendarBox.addEvent(Affinity.events.click,this.calendarClick);Affinity.mobile&&this.options.showInline||(this.calendarBox.addEvent(Affinity.events.overAll,this.calendarEnter),this.calendarBox.addEvent(Affinity.events.outAll,this.calendarLeave));this.options.showInline||(this.display.addEvent(Affinity.events.click,this.externalShow),this.showbutton.addEvent(Affinity.events.click,this.externalShow),this.display.addEvent("blur",this.attemptParse),document.addEvent(Affinity.events.click,this.documentClick),this.todaybutton.addEvent(Affinity.events.click,this.setToday),this.clearbutton.addEvent(Affinity.events.click,this.setNone));this.output&&this.date&&typeOf(this.output)==="element"&&typeOf(this.date)==="date"&&this.options.outputFormat&&this.output.store("defaultValue",this.date.format(this.options.outputFormat));this.printField=!1;this.display.getParent(".ui-calendar-row")&&this.display.getParent(".ui-calendar-row").getElement(".print-field")&&(this.printField=this.display.getParent(".ui-calendar-row").getElement(".print-field"));this.buildCalendar();window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this));Affinity.mobile&&(window.addEvent("mobileback",this.documentClick),"onorientationchange"in window&&window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this)));this.valuetracker=new Affinity.ElementValueTracker;this.display&&this.valuetracker.addElement(this.display);this.output&&this.valuetracker.addElement(this.output);this.checkExistsPeriodical=this.checkExists.periodical(1e3,this);this.options.showInline&&(this.buttons.addClass("hidden"),this.display.addClass("hidden"),this.calendarBox.addClass("inline"),this.calendarBox.inject(this.display.getParent(),"bottom"),this.show())},checkExists:function(){document.contains(this.output)||(clearInterval(this.checkExistsPeriodical),this.destroy())},documentClick:function(){this.status=="open"&&this.hide(null,"doc "+this.id)},calendarClick:function(n){n.stopPropagation();n.preventDefault()},calendarEnter:function(){this.calendarOver=!0},calendarLeave:function(){this.calendarOver=!1},monthElementClicked:function(n){this.calendarContainer.reveal();this.monthbox.dissolve();this.changeMonth(n.target.get("data-value"));this.monthbox.getElements(".active").removeClass("active");n.target.addClass("active");this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},yearElementClicked:function(n){this.calendarContainer.reveal();this.yearbox.dissolve();this.changeYear(n.target.get("data-value"));this.yearbox.getElements(".active").removeClass("active");n.target.addClass("active");this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay()},monthSelectorClicked:function(){this.monthbox.reveal();this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay());this.calendarContainer.dissolve()},yearSelectorClicked:function(){this.yearbox.reveal();this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay());this.calendarContainer.dissolve(),function(){var n=this.yearbox.getElement(".active").getPosition(this.yearbox).y;this.yearbox.scrollTo(0,n-5)}.delay(500,this)},nextMonthDown:function(n){n.preventDefault();n.stopPropagation()},lastMonthDown:function(n){n.preventDefault();n.stopPropagation()},getHumanHour:function(n){return n==0?"Midnight":n<12?n+" am":n>12?n-12+" pm":"Midday"},buildCalendar:function(){var t=new Date,n,f,i,r,u,e;if(this.options.showCalendar){for(this.calendarContainer=new Element("div").inject(this.calendarBox),this.lastButton=new Element("span",{html:"&#9668;","class":"ui-calendar-nextlast"}).inject(this.calendarContainer),i=new Element("span",{html:"","class":"ui-calendar-monthyear"}).inject(this.calendarContainer),this.nextButton=new Element("span",{html:"&#9658;","class":"ui-calendar-nextlast"}).inject(this.calendarContainer),this.monthButton=new Element("span",{"class":"ui-calendar-month"}).inject(i),this.yearButton=new Element("span",{"class":"ui-calendar-year"}).inject(i),this.monthbox=new Element("div",{"class":"ui-calendar-monthbox"}).inject(this.calendarBox),this.monthbox.set("reveal",{duration:250}),this.monthbox.toggle(),this.yearbox=new Element("div",{"class":"ui-calendar-yearbox"}).inject(this.calendarBox),this.yearbox.set("reveal",{duration:250}),this.yearbox.toggle(),n=0;n<12;n++)this.monthbox.adopt(new Element("span",{"class":"m"+n+(n===t.getMonth()?" today":""),html:t.clone().set("month",n).format("%b"),"data-value":n}).addEvent(Affinity.events.click,this.monthElementClicked));for(r=t.clone(),n=r.getFullYear()-100;n<r.getFullYear()+50;n++)new Element("span",{"class":"y"+n+(n===t.getFullYear()?" today":""),html:n,"data-value":n}).addEvent(Affinity.events.click,this.yearElementClicked).inject(this.yearbox,"top");for(n=0;n<7;n++)t.set("day",n),new Element("span",{html:t.format("%a"),"class":"ui-calendar-daylabel"}).inject(this.calendarContainer);for(n=0;n<42;n++)f=new Element("span",{"class":"ui-calendar-day"}).adopt(new Element("span")).inject(this.calendarContainer),this.setupClickable(f);this.nextButton.addEvent(Affinity.events.click,this.nextMonth);this.lastButton.addEvent(Affinity.events.click,this.lastMonth);this.monthButton.addEvent(Affinity.events.click,this.monthSelectorClicked);this.yearButton.addEvent(Affinity.events.click,this.yearSelectorClicked);Affinity.mobile||(this.nextButton.addEvent("mousedown",this.nextMonthDown),this.lastButton.addEvent("mousedown",this.lastMonthDown))}this.options.showTime&&(u=150,this.options.showCalendar&&(this.calendarContainer.set("reveal",{duration:250}),u=this.calendarContainer.measure(function(){return this.getSize()}).x-20),e=this.__selectedDate?this.__selectedDate.clone():!1,this.timeWidget=new UITimePickerWidget({target:this.calendarBox,displayInput:this.display,timeonly:this.options.showCalendar?!1:!0,date:e,hoursmins:this.options.hoursmins,dateWidget:this,onTimeSet:function(n){typeOf(n)==="date"&&n.isValid()&&(this.__selectedDate?n.getTime()!==this.__selectedDate.getTime()&&(this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__selectedDate=this.date.clone(),this.__uiDate=this.date.clone(),this.setCalendarDate()):this.date?n.getTime()!==this.date.getTime()&&(this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):this.options.nullable?this.options.showCalendar||(this.date=n,this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):(this.date=n,this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()))}.bind(this),onOpen:function(){this.options.showCalendar&&this.calendarContainer.dissolve()}.bind(this),onDone:function(n){this.options.showCalendar?this.calendarContainer.reveal():this.hide(n,"timeWidget");this.output.fireEvent("change",{target:this.output})}.bind(this),width:u}));this.setupCalendar(this.options.startDate==null?!1:!0)},setupCalendar:function(n){var s=typeOf(n)!=="null"?n:!1,r=new Date;if(this.options.showCalendar){var t=1,f=this.__uiDate.get("month"),e=this.__uiDate.get("year"),u=this.__uiDate.get("lastdayofmonth"),i=this.__uiDate.clone().set("date",1).get("day"),o;this.calendarBox.getElement(".ui-calendar-month").set("html",this.__uiDate.format("%B"));this.calendarBox.getElement(".ui-calendar-year").set("html",this.__uiDate.getFullYear());this.calendarBox.getElements(".ui-calendar-day").removeClass("today").removeClass("selected").removeClass("active");Array.each(this.calendarBox.getElements(".ui-calendar-day"),function(n,s){n.set("class","ui-calendar-day");n.getElement("span").set("html","&nbsp;");s>=i&&s<i+u&&t==r.get("date")&&f==r.get("month")&&e==r.get("year")&&n.addClass("today");s>=i&&s<i+u&&t==this.__uiDate.get("date")&&f==this.__uiDate.get("month")&&e==this.__uiDate.get("year")&&n.addClass("selected");s>=i&&s<i+u&&(o=this.__uiDate.clone().set("date",t).format("%b%d%Y"),n.getElement("span").set("html",t),n.addClass(o),n.addClass("active"),n.store("date",this.__uiDate.clone().set("date",t)),t++)}.bind(this));this.monthbox.getElements(".active").removeClass("active");this.monthbox.getElement(".m"+this.__uiDate.getMonth()).addClass("active");this.yearbox.getElements(".active").removeClass("active");this.yearbox.getElement(".y"+this.__uiDate.getFullYear()).addClass("active")}this.options.showTime&&this.timeWidget.setTime(this.__uiDate);s&&this.setCalendarDate()},setupClickable:function(n){n.addEvent(Affinity.events.click,this.dayClicked)},dayClicked:function(n){var t,i=n.target.hasClass("ui-calendar-day")?n.target:n.target.getParent(".ui-calendar-day"),r;i.hasClass("active")&&(this.calendarBox.getElements(".ui-calendar-day.selected").removeClass("selected"),t=i.retrieve("date"),this.date=t.clone(),this.__uiDate=t.clone(),this.__selectedDate=t.clone(),i.addClass("selected"),r=this.setCalendarDate(),this.fireEvent("dateClicked",this.date),this.options.showTime||this.hide())},nextMonth:function(){var t=this.__uiDate.get("month"),n=t;n=n+1>11?0:n+1;this.changeMonth(n);n===0&&this.changeYear(this.__uiDate.get("year")+1)},lastMonth:function(){var t=this.__uiDate.get("month"),n=t;n=n-1<0?11:n-1;this.changeMonth(n);n===11&&this.changeYear(this.__uiDate.get("year")-1)},changeMonth:function(n){this.doEvent=!1;var r=this.__uiDate.clone().set("date",1).set("month",n),i=r.get("lastdayofmonth"),t=this.__uiDate.get("date");t=t>i?i:t;this.__uiDate.set("date",1).set("month",n).set("date",t);this.setupCalendar();this.setCalendarDate()},changeYear:function(n){this.doEvent=!1;var r=this.__uiDate.clone().set("date",1).set("month",n),i=r.get("lastdayofmonth"),t=this.__uiDate.get("date");t=t>i?i:t;this.__uiDate.set("date",1).set("year",n).set("date",t);this.setupCalendar();this.setCalendarDate()},doEvent:!0,setCalendarDate:function(){var n=!1;return this.__selectedDate&&(this.__selectedDate.format(this.options.outputFormat)!==this.output.value&&(n=!0),this.display.value=this.__selectedDate.format(this.options.displayFormat),this.output.value=this.__selectedDate.format(this.options.outputFormat),this.printField&&this.printField.set("html",this.display.value)),this.doEvent&&(n&&window.fireEvent("formElementChanged",{element:this.output}),this.fireEvent("dateChanged",this.date),window.fireEvent("elementChanged",{element:this.output}),this.output.fireEvent("change",{target:this.output})),this.doEvent=!0,!0},getDate:function(){var n=this.getDateObject();return n?n.format(this.options.outputFormat):!1},getDateObject:function(){if(this.__selectedDate)return this.__selectedDate;if(!this.options.nullable){if(this.date)return this.date;if(this.__uiDate)return this.__uiDate}return!1},getRawDate:function(){if(!this.__selectedDate||this.output.value==="")return!1;var n=Date.parse(this.output.value);return n!==null&&typeOf(n)&&n.isValid()?n:!1},setDate:function(n,t){if(n&&typeOf(n)!=="date")try{n=Date.parse(n)}catch(i){return}n&&typeOf(n)==="date"&&n.isValid()?(typeOf(t)==="boolean"&&t===!1&&(this.doEvent=!1),this.date=n,this.__uiDate=n.clone(),this.__selectedDate=n.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0):this.options.nullable?(typeOf(t)==="boolean"&&t===!1&&(this.doEvent=!1),this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.setupCalendar(),this.output.value="",this.display.value="",this.doEvent=!0):(this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0)},setToday:function(){this.date=new Date;this.__uiDate=this.date.clone();this.__selectedDate=this.date.clone();this.dontClose=!1;this.setupCalendar(!0)},setNone:function(){this.date=this.__uiDate=new Date;this.__selectedDate=!1;this.output.value="";this.display.value="";this.showDefault=!1;this.dontClose=!1;this.output.fireEvent("change",{target:this.output})},attemptParse:function(n){var i,t,r;if((typeOf(n)==="null"||!n.type||n.type!=="blur"||this.status!=="open"||!this.calendarOver)&&(this.options.showCalendar||!this.options.showTime||!this.timeWidget)){i=this.display.value;t=!1;try{t=Date.parse(i)}catch(n){console.log(n)}t&&typeOf(t)=="date"?t.isValid()?(r=this.__selectedDate?this.__selectedDate.clone():!1,this.date=t,this.__uiDate=t.clone(),this.__selectedDate=t.clone(),typeOf(n)!=="null"?this.setupCalendar(!0):this.setupCalendar(),r&&t.setMilliseconds(0)===this.date.setMilliseconds(0)||(this.setCalendarDate(),this.output.fireEvent("change",{target:this.output}))):(this.__selectedDate=!1,this.display.value="Invalid Date. No date set.",this.output.value="",this.output.fireEvent("change",{target:this.output})):this.options.nullable?(this.output.value="",this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.output.fireEvent("change",{target:this.output})):(this.display.value=this.__selectedDate?this.__selectedDate.format(this.options.displayFormat):this.__uiDate.format(this.options.displayFormat),this.printField&&this.printField.set("html",this.display.value));this.hide(null,"attemptParse "+this.id)}},positionOverride:!1,position:function(){var u=this.positionOverride?this.positionOverride.getPosition():this.display.getPosition(),t=this.positionOverride?this.positionOverride.getSize():this.display.getSize(),n=window.getSize(),o=u.y+t.y+5,r=u.x,i,f,s=this.options.cssPosition,e=this.calendarBox.measure(function(){return this.getSize()});if(Affinity.mobile){this.calendarBox.hasClass("scaled")||(r=0,t=e,n=parent.getSize(),n.x-=40,n.y-=40,i=t.x>t.y?Number(n.x/t.x).round(2):Number(n.y/t.y).round(2),t.y*i>n.y&&(i=Number(n.y/t.y).round(2)),t.x*i>n.x&&(i=Number(n.x/t.x).round(2)),n.x+40>t.x*i&&(r=(n.x+40-t.x*i)/2),f={position:"fixed",top:r,left:r,"-webkit-transform":"scale("+i+")","-webkit-transform-origin":"0 0",transform:"scale("+i+")","transform-origin":"0 0"},this.calendarBox.setStyles(f),this.calendarBox.addClass("scaled"));return}n.y-(u.y-window.getScroll().y)<e.y&&(o=u.y-e.y-5);u.x-window.getScroll().x+e.x>n.x&&(r=n.x-e.x-5);s==="fixed"&&(o-=window.getScroll().y);f={position:s,top:o,left:r};this.calendarBox.setStyles(f);this.delayedRePosition&&clearTimeout(this.delayedRePosition);this.delayedRePosition=setTimeout(function(){this.calendarBox.setStyles(f)}.bind(this),500)},watchOutputChanges:function(){var t=this.output.value,n=Date.parse(t);n&&n.hasOwnProperty("isValid")&&n.isValid()&&n!==this.date&&this.setDate(n,!1)},externalShow:function(n){n.stopPropagation();Affinity.UI.calendars.hideAll(this);Affinity.mobile&&this.display.blur();this.show()},obscure:function(){this.hide();this.showbutton&&this.showbutton.addClass("hidden");this.todaybutton&&this.todaybutton.addClass("hidden");this.clearbutton&&this.clearbutton.addClass("hidden");this.display&&this.display.addClass("hidden")},reveal:function(){this.showbutton&&this.showbutton.removeClass("hidden");this.todaybutton&&this.todaybutton.removeClass("hidden");this.clearbutton&&this.clearbutton.removeClass("hidden");this.display&&this.display.removeClass("hidden")},show:function(){this.options.showInline||(Affinity.UI.calendars.hideAll(this),this.position());this.calendarBox.reveal();this.status="open"},hide:function(){this.options.showInline||this.dontClose||(this.monthbox&&this.monthbox.dissolve(),this.yearbox&&this.yearbox.dissolve(),this.calendarContainer&&this.calendarContainer.reveal(),this.calendarBox&&this.calendarBox.dissolve(),this.status="closed")},destroy:function(){if(clearInterval(this.checkExistsPeriodical),this.showbutton&&this.showbutton.removeEvents(),this.todaybutton&&this.todaybutton.removeEvents(),this.clearbutton&&this.clearbutton.removeEvents(),this.display&&this.display.removeEvents(),document.removeEvent(Affinity.events.click,this.documentClick),this.options.showCalendar&&(this.calendarContainer&&(Array.each(this.calendarContainer.getElements(".ui-calendar-day"),function(n){n.removeEvents();n.destroy()}.bind(this)),this.calendarContainer.set("reveal",null),this.calendarContainer.set("tween",null),this.calendarContainer.removeEvents()),this.monthbox&&(Array.each(this.monthbox.getElements("span"),function(n){n.removeEvents();n.destroy()}.bind(this)),this.monthbox.set("reveal",null),this.monthbox.set("tween",null),this.monthbox.removeEvents()),this.yearbox&&(Array.each(this.yearbox.getElements("span"),function(n){n.removeEvents();n.destroy()}.bind(this)),this.yearbox.set("reveal",null),this.yearbox.set("tween",null),this.yearbox.removeEvents()),this.nextButton&&this.nextButton.removeEvents(),this.lastButton&&this.lastButton.removeEvents(),this.yearButton&&this.yearButton.removeEvents(),this.monthButton&&this.monthButton.removeEvents()),this.options.showTime&&this.timeWidget.destroy(),Affinity.UI.calendars.widgets[this.uuid]&&(Affinity.UI.calendars.widgets[this.uuid]=null,delete Affinity.UI.calendars.widgets[this.uuid]),this.buttons&&(this.buttons.empty(),this.buttons.destroy()),this.display&&this.display.destroy(),this.output&&this.output.destroy(),this.calendarBox&&(this.calendarBox.set("reveal",null),this.calendarBox.set("tween",null),this.calendarBox.removeEvents(),this.calendarBox.empty(),this.calendarBox.destroy()),this.options.target)try{this.options.target.eliminate("widget");this.options.target.destroy()}catch(n){}Object.each(this,function(n,t){this[t]=null;delete this[t]}.bind(this))}}),UIDateDropDowns=new Class({Implements:[Options],Binds:["processDates","setDate"],options:{dateMooFormat:"%d.%m.%Y"},initialize:function(n){this.setOptions(n);this.days=["sun","mon","tue","wed","thu","fri","sat"];this.months=["january","february","march","april","may","june","july","august","september","october","november","december"];this.today=new Date;this.dateInputs=document.getElements("input.date-drops");Array.each(this.dateInputs,this.processDates)},processDates:function(n){var t,u,s,r;n.set("type","hidden");n.value!=""&&(s=Date.parse(n.value),s.isValid()&&(this.today=s));var i=new Element("div",{"class":"datepicker"}).inject(n,"before"),f=new Element("select",{"class":"date-day"}).inject(i),e=new Element("select",{"class":"date-month"}).inject(i),o=new Element("select",{"class":"date-year"}).inject(i);for(new Element("br").inject(i),new Element("span").inject(i),i.adopt(n),r=!1,i.getElement("input").value!=""&&(r=Date.parse(i.getElement("input").value),r===null&&(r=!1)),new Element("option",{value:"",html:""}).inject(f),t=0;t<31;t++)new Element("option",{value:t+1,html:t+1}).inject(f);for(r&&(f.value=parseInt(this.today.format("%e"),10)),new Element("option",{value:"",html:""}).inject(e),t=0;t<12;t++)new Element("option",{value:t,html:this.months[t].capitalize()}).inject(e);for(r&&(e.value=parseInt(this.today.format("%m"),10)-1),new Element("option",{value:"",html:""}).inject(o),u=parseInt(this.today.format("%Y"),10),t=u-100;t<u+10;t++)new Element("option",{value:t,html:t}).inject(o);r&&(o.value=u);f.addEvent("change",this.setDate);e.addEvent("change",this.setDate);o.addEvent("change",this.setDate);this.setDate(null,i)},setDate:function(n,t){var i,r;if(n!=null&&(t=n.target.getParent()),i=t.getElements("select"),i[0].value===""||i[1].value===""||i[2].value===""){t.getElement("input").value="";t.getElement("span").set("html","");return}r=(new Date).set("year",i[2].value).set("month",i[1].value).set("date",i[0].value).set("hr",0).set("min",0).set("sec",0).set("ms",0);r.isValid()&&(t.getElement("input").value=r.format(this.options.dateMooFormat),t.getElement("span").set("html",r.format("%A the %e%o of %B %Y")));delete r;delete i}}),UIDisplayLookup=new Class({Version:"1.0.2.0",File:"ui.display.lookup.js",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","setValue","refreshQueue","cancelQueue","processQueue"],options:{jsonp:!1},enabled:!1,initialize:function(n){this.setOptions(n);Affinity.UI||(Affinity.UI={});Affinity.UI.displaylookups||(Affinity.UI.displaylookups={});Affinity.UI.displaylookupLoaders=[];window.addEvent("refreshQueues",this.refreshQueue);window.addEvent("loggedout",this.cancelQueue);window.addEvent("loggedin",function(){this.enabled=!0;this.processNew()}.bind(this));this.processNew()},processNew:function(n){this.setOptions(n);var t=document.getElements(".has-display-lookup");Array.each(t,this.processLookup);this.processQueue();delete t},processLookup:function(n){var t,i;n.get("data-lookup-api")&&(n.removeClass("has-display-lookup"),n.get("data-lookup-api")!==""&&(t=n.get("data-lookup-api"),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.displaylookups[i]?Affinity.UI.displaylookups[i].elements.contains[n]||Affinity.UI.displaylookups[i].elements.push(n):Affinity.UI.displaylookups[i]={api:t,id:"dis_lookup_"+String.uniqueID(),type:"display",loaded:!1,elements:[n]}))},getApiKey:function(n){var o=new URI(n.toLowerCase()),s=o.get("query").parseQueryString(),i=[],u=[],t=!1,f="",r,e;return Object.each(s,function(n,r){r.toLowerCase()!=="ran"&&(r!=="parameters"?i.push(r+"-"+n):t=JSON.parse(n))}),i=i.sort(),t&&typeOf(t)==="object"&&"parameter"in t&&typeOf(t.parameter)==="array"&&(Array.each(t.parameter,function(n){r=[];Object.each(n,function(n,t){t.toLowerCase()!=="ran"&&r.push(t+"-"+n)});r.sort();u.push(r.join("|"))}),u.sort(),f="|parameters|"+u.join("||")),e=i.join("|")+f,"display-"+e.replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL DISPLAY LOOKUPS &#187;");this.enabled=!1;Array.each(Affinity.UI.displaylookupLoaders,function(n){"cancel"in n&&n.cancel();n.removeEvents();n=null});Affinity.UI.displaylookupLoaders=[];Object.each(Affinity.UI.displaylookups,function(n,t){Affinity.UI.displaylookups[t].loaded=!1;Affinity.UI.displaylookups[t].data=null});this.enabled=!0;window.fireEvent("lookupCacheClear")},cancelQueue:function(){log("&#171; CANCEL AND CLEAR ALL DISPLAY LOOKUPS &#187;");this.enabled=!1;Array.each(Affinity.UI.displaylookupLoaders,function(n){"cancel"in n&&n.cancel();"removeEvents"in n&&n.removeEvents();n=null});Affinity.UI.displaylookupLoaders=[];Object.each(Affinity.UI.displaylookups,function(n,t){Affinity.UI.displaylookups[t].loaded=!1;Affinity.UI.displaylookups[t].data=null;Affinity.UI.displaylookups[t].elements=[];Affinity.UI.displaylookups[t]=null;delete Affinity.UI.displaylookups[t]});Affinity.UI.displaylookups={}},processQueue:function(){var t,n;try{Object.each(Affinity.UI.displaylookups,function(i,r){if(!this.enabled){log("! display lookup queue disabled - process stooped !");throw"break Object.each";}Affinity.UI.displaylookups[r].loaded===!0&&this.setElements(r);Affinity.UI.displaylookups[r].loaded===!1&&(n=Affinity.UI.displaylookups[r].api,n.contains("ran=")||(n=n.contains("?")?n+="&ran="+String.uniqueID():n+="?ran="+String.uniqueID()),Affinity.UI.displaylookups[r].loaded="loading...",t=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:n,method:"get",noCache:!0,onComplete:function(n){JSON.Unauthorized(n,Affinity.UI.displaylookups[r].id)||(Affinity.UI.displaylookups[r].data=n,typeOf(n.success)!=="null"&&n.success===!1?this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[r].loaded=!0,this.setElements(r)))}.bind(this)}):new Request.JSON({url:n,method:"get",noCache:!0,onSuccess:function(n){JSON.Unauthorized(n,Affinity.UI.displaylookups[r].id)||(Affinity.UI.displaylookups[r].data=n,typeOf(n.success)!=="null"&&n.success===!1?this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[r].loaded=!0,this.setElements(r)))}.bind(this)}),t&&(Affinity.UI.displaylookupLoaders.push(t),t.send()))}.bind(this))}catch(i){}},setError:function(n,t){Array.each(Affinity.UI.displaylookups[n].elements,function(n){new Element("span",{"class":"errorstr inplace-of-input",html:t}).inject(n,"after");n.addClass("hidden")}.bind(this))},setElements:function(n){Array.each(Affinity.UI.displaylookups[n].elements,function(t){typeOf(t)!=="null"&&typeOf(t.get)==="function"&&t.get("data-lookup-api")&&this.setValue(Affinity.UI.displaylookups[n].data,t)}.bind(this))},setValue:function(n,t){if(typeOf(n)==="array"&&n.length>0&&typeOf(n[0].Value)!=="null"&&n[0].Value!==""){var i=n[0].Value.trim();Affinity.appname!=="cleverforms"&&(i=n[0].Value.split(",").sort(function(n,t){return t.length-n.length})[0].trim());t.getElement(".display")||t.hasClass("display")?(t.getElement(".display")&&t.getElement(".display").set("html",i),t.hasClass("display")&&t.set("html",i)):"value"in t?t.value=i:t.set("html",i);t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t});delete i}}}),UIDrawPanels=new Class({Version:"1.0.0.0",File:"ui.drawpanel.js",Implements:[Options],Binds:["init","processDrawPad"],options:{},initialize:function(n){this.setOptions(n);this.init()},canvasSupported:function(){if(Browser.IE&&Borwser.version<9)return!1;var n=document.createElement("canvas");return typeof n.getContext=="undefined"||typeOf(n.getContext("2d"))=="undefined"?(delete n,!1):(n.destroy(),delete n,!0)},processNew:function(){this.init()},init:function(){this.canvasSupported()&&Array.each(document.getElements(".ui-drawpad"),this.processDrawPad)},processDrawPad:function(n){n.removeClass("ui-drawpad");var t="",i="",r="",u=[];n.get("data-bg-image")!=null&&n.get("data-bg-image")!=""&&(bgnames=n.get("data-bg-name").split("||"),t=n.get("data-bg-image").split("||"),i=n.get("data-bg-image-width").split("||"),r=n.get("data-bg-image-height").split("||"),Array.each(t,function(n,f){u.push({name:bgnames[f],image:t[f],width:i[f],height:r[f]})}));new UIDrawPanel({element:n,bgImageData:u})}}),UIDrawPanel=new Class({Implements:[Options],Binds:["changeBgImage","canvasDown","canvasUp","setData","clear"],options:{element:null,bgImageData:[]},initialize:function(n){var t,i;if(this.setOptions(n),this.icons={},this.icons.clear=Affinity.icons.CrossRound||"@Html.Raw(Affinity.UIFramework.Icons.CrossRound)",this.options.element==null)throw new Error("element must be set in options.");var r=this.options.element.get("name"),u=this.options.element.get("id"),f=this.options.element.value;this.element=new Element("input",{type:"hidden",value:f}).inject(this.options.element,"after");this.options.element.destroy();delete this.options.element;r&&this.element.set("name",r);u&&this.element.set("id",u);t=500;i=Affinity.mobile?250:120;this.options.bgImageData.length>0&&(t=this.options.bgImageData[0].width,i=this.options.bgImageData[0].height);this.canvas=new Element("canvas",{"class":"uidrawpanel",width:t,height:i}).inject(this.element,"after");this.canvas.width=t;this.canvas.height=i;this.canvas.style.width=t+"px";this.canvas.style.height=i+"px";this.drawPanel=new SignaturePad(this.canvas,{});this.canvas.addEventListener("CanvasReady",this.setData);this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(new Element("br").inject(this.canvas,"before"),new Element("label",{html:"Select Background"}).inject(this.canvas,"before"),this.imageSelect=new Element("select").addEvent("change",this.changeBgImage).inject(this.canvas,"before"),Array.each(this.options.bgImageData,function(n,t){this.imageSelect.adopt(new Element("option",{html:n.name,value:t}))}.bind(this)),this.imageSelect.adopt(new Element("option",{html:"No Image",value:-1}))),this.changeBgImage({target:{value:0}}));this.clearButton=new Element("span",{html:"<span>"+this.icons.clear+"<\/span>Clear","class":"button orange w-icon"}).inject(this.canvas,"after");new Element("br").inject(this.element,"before");new Element("br").inject(this.canvas,"before");new Element("br").inject(this.canvas,"after");this.clearButton.addEvent(Affinity.events.click,this.clear);this.canvas.addEvent(Affinity.events.start,this.canvasDown);this.canvas.addEvent(Affinity.events.end,this.canvasUp);document.addEvent(Affinity.events.end,this.canvasUp)},changeBgImage:function(n){var t=this.options.bgImageData[n.target.value];t==null&&(t={width:500,height:Affinity.mobile?250:120,image:null});this.drawPanel.clear();this.element.value="";this.canvas.width=t.width;this.canvas.height=t.height;this.canvas.style.width=t.width+"px";this.canvas.style.height=t.height+"px";t.image!==null&&this.drawPanel.fromDataURL(t.image)},canvasDown:function(){this.eventIsDown=!0},canvasUp:function(){this.eventIsDown&&(this.eventIsDown=!1,this.setData())},setData:function(){this.element.value=this.drawPanel.toDataURL()},clear:function(){this.drawPanel.clear();this.element.value="";var n={value:0};this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(n=this.imageSelect),this.changeBgImage({target:n}))}}),SignaturePad=function(n){"use strict";var t=function(n,t){var r=this,i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7;this.minWidth=i.minWidth||.5;this.maxWidth=i.maxWidth||2.5;this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2};this.penColor=i.penColor||"black";this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)";this._canvas=n;this._ctx=n.getContext("2d");this.clear();this._handleMouseEvents();this._handleTouchEvents()},i,r;return t.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor;t.clearRect(0,0,n.width,n.height);t.fillRect(0,0,n.width,n.height);this._reset()},t.prototype.toDataURL=function(){var n=this._canvas;return n.toDataURL.apply(n,arguments)},t.prototype.fromDataURL=function(n){var t=this,i=new Image;this._reset();i.src=n;i.onload=function(){t._ctx.drawImage(i,0,0,t._canvas.width,t._canvas.height);t._canvas.dispatchEvent(new CustomEvent("CanvasReady"))};this._isEmpty=!1},t.prototype._strokeUpdate=function(n){var t=this._createPoint(n);this._addPoint(t)},t.prototype._strokeBegin=function(n){this._reset();this._strokeUpdate(n)},t.prototype._strokeDraw=function(n){var t=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;t.beginPath();this._drawPoint(n.x,n.y,i);t.closePath();t.fill()},t.prototype._strokeEnd=function(){var t=this.points.length>2,n=this.points[0];!t&&n&&this._strokeDraw(n)},t.prototype._handleMouseEvents=function(){var t=this;this._mouseButtonDown=!1;this._canvas.addEventListener("mousedown",function(n){n.which===1&&(t._mouseButtonDown=!0,t._strokeBegin(n))});this._canvas.addEventListener("mousemove",function(n){t._mouseButtonDown&&t._strokeUpdate(n)});n.addEventListener("mouseup",function(n){n.which===1&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(n))})},t.prototype._handleTouchEvents=function(){var t=this;this._canvas.addEventListener("touchstart",function(n){var i=n.changedTouches[0];t._strokeBegin(i)});this._canvas.addEventListener("touchmove",function(n){n.preventDefault();var i=n.changedTouches[0];t._strokeUpdate(i)});n.addEventListener("touchend",function(n){var i=n.target===t._canvas;i&&t._strokeEnd()})},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[];this._lastVelocity=0;this._lastWidth=(this.minWidth+this.maxWidth)/2;this._isEmpty=!0;this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(n){var t=this._canvas.getBoundingClientRect();return new i(n.clientX-t.left,n.clientY-t.top)},t.prototype._addPoint=function(n){var t=this.points,u,f,e,i;t.push(n);t.length>2&&(t.length===3&&t.unshift(t[0]),i=this._calculateCurveControlPoints(t[0],t[1],t[2]),u=i.c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]),f=i.c1,e=new r(t[1],u,f,t[2]),this._addCurve(e),t.shift())},t.prototype._calculateCurveControlPoints=function(n,t,r){var e=n.x-t.x,o=n.y-t.y,s=t.x-r.x,h=t.y-r.y,f={x:(n.x+t.x)/2,y:(n.y+t.y)/2},u={x:(t.x+r.x)/2,y:(t.y+r.y)/2},p=Math.sqrt(e*e+o*o),c=Math.sqrt(s*s+h*h),w=f.x-u.x,b=f.y-u.y,l=c/(p+c),a={x:u.x+w*l,y:u.y+b*l},v=t.x-a.x,y=t.y-a.y;return{c1:new i(f.x+v,f.y+y),c2:new i(u.x+v,u.y+y)}},t.prototype._addCurve=function(n){var r=n.startPoint,u=n.endPoint,t,i;t=u.velocityFrom(r);t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity;i=this._strokeWidth(t);this._drawCurve(n,this._lastWidth,i);this._lastVelocity=t;this._lastWidth=i},t.prototype._drawPoint=function(n,t,i){var r=this._ctx;r.moveTo(n,t);r.arc(n,t,i,0,2*Math.PI,!1);this._isEmpty=!1},t.prototype._drawCurve=function(n,t,i){var l=this._ctx,p=i-t,a,y,o,r,s,h,u,c,v,f,e;for(a=Math.floor(n.length()),l.beginPath(),o=0;o<a;o++)r=o/a,s=r*r,h=s*r,u=1-r,c=u*u,v=c*u,f=v*n.startPoint.x,f+=3*c*r*n.control1.x,f+=3*u*s*n.control2.x,f+=h*n.endPoint.x,e=v*n.startPoint.y,e+=3*c*r*n.control1.y,e+=3*u*s*n.control2.y,e+=h*n.endPoint.y,y=t+h*p,this._drawPoint(f,e,y);l.closePath();l.fill()},t.prototype._strokeWidth=function(n){return Math.max(this.maxWidth/(n+1),this.minWidth)},i=function(n,t,i){this.x=n;this.y=t;this.time=i||(new Date).getTime()},i.prototype.velocityFrom=function(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):1},i.prototype.distanceTo=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},r=function(n,t,i,r){this.startPoint=n;this.control1=t;this.control2=i;this.endPoint=r},r.prototype.length=function(){for(var e=10,o=0,t,i,r,s,h,u,f,n=0;n<=e;n++)t=n/e,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),n>0&&(u=i-s,f=r-h,o+=Math.sqrt(u*u+f*f)),s=i,h=r;return o},r.prototype._point=function(n,t,i,r,u){return t*(1-n)*(1-n)*(1-n)+3*i*(1-n)*(1-n)*n+3*r*(1-n)*n*n+u*n*n*n},t}(document),saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(n){"use strict";if(typeof navigator=="undefined"||!/MSIE [1-9]\./.test(navigator.userAgent)){var s=n.document,h=function(){return n.URL||n.webkitURL||n},r=s.createElementNS("http://www.w3.org/1999/xhtml","a"),y=!n.externalHost&&"download"in r,p=function(t){var i=s.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null);t.dispatchEvent(i)},u=n.webkitRequestFileSystem,c=n.requestFileSystem||u||n.mozRequestFileSystem,w=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},f="application/octet-stream",l=0,i=[],e=function(){for(var t=i.length,n;t--;)n=i[t],typeof n=="string"?h().revokeObjectURL(n):n.remove();i.length=0},o=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){w(f)}},a=function(t,e){var s=this,k=t.type,d=!1,v,b,g=function(){var n=h().createObjectURL(t);return i.push(n),n},nt=function(){o(s,"writestart progress write writeend".split(" "))},a=function(){(d||!v)&&(v=g(t));b?b.location.href=v:window.open(v,"_blank");s.readyState=s.DONE;nt()},w=function(n){return function(){if(s.readyState!==s.DONE)return n.apply(this,arguments)}},tt={create:!0,exclusive:!1},it;if(s.readyState=s.INIT,e||(e="download"),y){v=g(t);r.href=v;r.download=e;p(r);s.readyState=s.DONE;nt();return}if(n.chrome&&k&&k!==f&&(it=t.slice||t.webkitSlice,t=it.call(t,0,t.size,f),d=!0),u&&e!=="download"&&(e+=".download"),(k===f||u)&&(b=n),!c){a();return}l+=t.size;c(n.TEMPORARY,l,w(function(n){n.root.getDirectory("saved",tt,w(function(n){var r=function(){n.getFile(e,tt,w(function(n){n.createWriter(w(function(r){r.onwriteend=function(t){b.location.href=n.toURL();i.push(n);s.readyState=s.DONE;o(s,"writeend",t)};r.onerror=function(){var n=r.error;n.code!==n.ABORT_ERR&&a()};"writestart progress write abort".split(" ").forEach(function(n){r["on"+n]=s["on"+n]});r.write(t);s.abort=function(){r.abort();s.readyState=s.DONE};s.readyState=s.WRITING}),a)}),a)};n.getFile(e,{create:!1},w(function(n){n.remove();r()}),w(function(n){n.code===n.NOT_FOUND_ERR?r():a()}))}),a)}),a)},t=a.prototype,v=function(n,t){return new a(n,t)};return t.abort=function(){var n=this;n.readyState=n.DONE;o(n,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n.addEventListener("unload",e,!1),v.unload=function(){e();n.removeEventListener("unload",e,!1)},v}}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content);typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs});String.prototype.endsWithAny=function(){for(var t=Array.prototype.slice.call(arguments),i=this.toLowerCase().toString(),n=0;n<t.length;n++)if(i.indexOf(t[n],i.length-t[n].length)!==-1)return!0;return!1};var saveTextAs=saveTextAs||function(n,t,i){var f,r,u,e;return t=t||"download.txt",i=i||"utf-8",n=(n||"").replace(/\r?\n/g,"\r\n"),saveAs&&Blob?(f=new Blob([n],{type:"text/plain;charset="+i}),saveAs(f,t),!0):(r=window.frames.saveTxtWindow,!r&&(r=document.createElement("iframe"),r.id="saveTxtWindow",r.style.display="none",document.body.insertBefore(r,null),r=window.frames.saveTxtWindow,!r&&(r=window.open("","_temp","width=100,height=100"),!r)))?(window.alert("Sorry, download file could not be created."),!1):(u=r.document,u.open("text/plain","replace"),u.charset=i,t.endsWithAny(".htm",".html")?(u.close(),u.body.innerHTML="\r\n"+n+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),u.write(n),u.close()),e=u.execCommand("SaveAs",null,t),r.close(),e)},UIFormatDate=new Class({Implements:[Options],Binds:["init","processDate"],options:{},initialize:function(n){this.setOptions(n);this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-format-date"),this.processDate)},processDate:function(n){var u=!1,r,t,i;r="%I:%M:%S %p, %A %B %e%o %Y";n.get("data-date-format")&&n.get("data-date-format").trim()!==""&&(r=n.get("data-date-format").trim());t=n.get("html").trim();document.config.isie&&t.toLowerCase().contains("gmt")&&(t=t.replace(/GMT/gi,"UTC"));t.toLowerCase().contains(".")&&(t=t.replace(/\./gi,"/"));new RegExp("[0-9]T[0-9]","i").test(t)&&(t=t.replace(/(.*[0-9])t([0-9].*)/i,"$1 $2"));new RegExp("[0-9]Z","i").test(t)&&(t=t.replace(/(.*[0-9])Z/i,"$1 UTC"));t.toLowerCase().contains("utc")&&(t=t.trim().replace(/(.*[0-9]) UTC/i,"$1"),u=!0);i=new Date(Date.parse(t));u&&(i=new Date(i.getTime()-i.getTimezoneOffset()*6e4));i.isValid()&&n.set("html",i.format(r))}}),UIDynamicGrid=new Class({Implements:[Options],Binds:["init","moveUp","moveDn","delRow","newRow","inputReplace","inputReturn","setOutputData","returnData","handleCSVFile","saveCSV"],options:{container:null},tables:{},initialize:function(n){this.setOptions(n);this.docsv=!1;this.iemode=!1;document.config&&document.config.isie&&document.config.ieversion&&document.config.ieversion>10?window.encodeURIComponent&&window.FileReader&&(this.docsv=!0,this.iemode=!0):window.encodeURIComponent&&window.FileReader&&(this.docsv=!0);this.focused=null;this.input=new Element("input",{type:"text",events:{focus:function(n){this.focused=n.target}.bind(this),blur:function(n){this.focused=null;this.inputReturn(n.target)}.bind(this)}});this.input.addEvent("keydown",function(n){n.event.keyCode==13&&(n.stopPropagation(),n.preventDefault(),this.focused==n.target&&this.focused.blur())}.bind(this));this.init()},init:function(){this.options.container==null&&(this.options.container=document.body);Array.each(document.getElements("table.dynamic"),function(n){var t=n,i=t.get("id");i==null&&(i=String.uniqueID(),t.set("id",i));this.tables[i]||(this.tables[i]=t,this.docsv&&(this.csvUploader=new Element("input",{type:"file",accept:".csv"}).store("id",i).addEvent("change",this.handleCSVFile),this.iemode?new Element("span",{"class":"csvdrop-ie button green",html:"Load CSV"}).adopt(this.csvUploader).inject(t.getElement(".new"),"before"):new Element("span",{"class":"csvdrop ui-has-tooltip","data-tooltip":"Drop CSV file here","data-tooltip-dir":"top",html:Affinity.icons.Upload2}).adopt(this.csvUploader).inject(t.getElement(".new"),"before")),document.id("listdata")?this.outputdatafield=document.id("listdata"):(this.outputdatafield=new Element("input",{id:"listdata",name:"listdata",type:"hidden"}),this.outputdatafield.inject(t,"after")),Array.each(t.getElements("td.dynamic"),function(n){n.addEvent("click",this.inputReplace)}.bind(this)));this.docsv&&new Element("span",{"class":"button w-icon green save"}).adopt(new Element("span",{html:Affinity.icons.Save}),new Element("span",{html:"Save list as CSV file"})).store("id",i).addEvent("click",this.saveCSV).inject(t.getParent(),"after");Affinity.tooltips.processNew();this.zebra(t);this.setOutputData(t)}.bind(this));Array.each(document.getElements("table.dynamic .new, table.dynamic .del, table.dynamic .up, table.dynamic .dn"),function(n){n.hasClass("new")&&n.addEvent("click",this.newRow);n.hasClass("del")&&n.addEvent("click",this.delRow);n.hasClass("up")&&n.addEvent("click",this.moveUp);n.hasClass("dn")&&n.addEvent("click",this.moveDn)}.bind(this))},inputReplace:function(n,t){var i,r;n!==null?(element=n.target.get("tag")=="td"?n.target:n.target.getParent("td"),n.preventDefault(),n.stopPropagation()):element=t;element.getElement("input")?this.input.focus():(i=element.get("html").stripTags().trim(),element.empty(),r=element.getComputedSize(),this.input.setStyles({width:r.width-10,height:r.height-2}),this.input.inject(element),i=i=="Enter a value"?"":i,this.input.value=i,this.input.focus(),element.setStyles({width:r.width,height:r.height}),delete i,delete r)},inputReturn:function(n){if(n&&n.get("tag")=="input"){var i=n.getParent(),r=n.getParents("table")[0],t=n.value.stripTags().trim();t=t==""?"Enter a value":t;i.empty();i.set("html",t);this.setOutputData(r);delete t;delete i;delete r}},moveUp:function(n){n.preventDefault();var t=n.target.getParent("table"),r=t.getElement("tbody"),e=t.getElement(".template").clone();t.getElement(".template").destroy();var i=n.target.getParent("tr"),u=r.getElements("tr"),f=u.indexOf(i);f>1&&i.inject(u[f-1],"before");this.setOutputData(t);this.zebra(i.getParent("table"));e.inject(r);delete t;delete r;delete e;delete i;delete u;delete f},moveDn:function(n){n.preventDefault();var t=n.target.getParent("table"),u=t.getElement("tbody"),e=t.getElement(".template").clone();t.getElement(".template").destroy();var i=n.target.getParent("tr"),r=u.getElements("tr"),f=r.indexOf(i);f<r.length-1&&i.inject(r[f+1],"after");this.setOutputData(t);this.zebra(i.getParent("table"));e.inject(u);delete t;delete u;delete e;delete i;delete r;delete f},delRow:function(n){n.preventDefault();var t=n.target.getParents("table")[0];n.target.getParents("tr")[0].destroy();this.setOutputData(t);this.zebra(t);delete t},newRow:function(n){try{n.preventDefault()}catch(f){}var i=n.target.getParents("table")[0],t=i.getElement(".template").clone(),r,u;n.target.getParents("th")[0]?(r=i,u="bottom"):(r=n.target.getParents("tr")[0],u="after");t.removeClass("template");t.removeClass("hidden");t.inject(r,u);Array.each(t.getElements(".new,.del,.up,.dn"),function(n){n.hasClass("up")&&n.addEvent("click",this.moveUp);n.hasClass("dn")&&n.addEvent("click",this.moveDn);n.hasClass("new")&&n.addEvent("click",this.newRow);n.hasClass("del")&&n.addEvent("click",this.delRow)}.bind(this));Array.each(t.getElements("td.dynamic"),function(n){n.empty();n.addEvent("click",this.inputReplace)}.bind(this));this.inputReplace(null,t.getElement("td.dynamic"));this.zebra(i)},zebra:function(n){Array.each(n.getElements("tr"),function(n,t){t>0&&(n.addClass("odd"),t%2==0&&n.removeClass("odd"))}.bind(this))},setOutputData:function(n){var t=this.returnData(n,!0);return this.outputdatafield.value=t,t},returnData:function(n,t){t=typeof t!="undefined"?t:!1;var u,r=[],f=n.getElements("tr th.has-data-name"),i;return f.length>1?Array.each(n.getElements("tr"),function(n,t){t>0&&(u={},Array.each(n.getElements("td"),function(n,t){n.hasClass("dynamic")&&(i=n.getElement("input")?n.getElement("input").value.trim():n.get("html").trim(),i!=""&&i!="Enter a value"&&(u[f[t].get("data-name")]=escape(i)))}.bind(this)),Object.getLength(u)>0&&r.push(u))}.bind(this)):Array.each(n.getElements("tr"),function(n){Array.each(n.getElements("td"),function(n){n.hasClass("dynamic")&&(i=n.getElement("input")?n.getElement("input").value.trim():n.get("html").trim(),i!=""&&i!="Enter a value"&&r.push(escape(i)))}.bind(this))}.bind(this)),t&&(r=JSON.stringify(r)),r},handleCSVFile:function(n){var t=n.target,u=t.retrieve("id"),i=this.tables[u],f=i.getElement("tbody"),r;Affinity.prompts.hide();r=new FileReader;r.readAsText(t.files[0]);r.onload=function(n){for(var o=n.target.result,u=o.split(/\r\n|\n/),e,r=0;r<u.length;r++)u[r]!=""&&(e=i.getElement(".template").clone().removeClass("template").removeClass("hidden").inject(f,"bottom"),Array.each(e.getElements(".new,.del,.up,.dn"),function(n){n.hasClass("up")&&n.addEvent("click",this.moveUp);n.hasClass("dn")&&n.addEvent("click",this.moveDn);n.hasClass("new")&&n.addEvent("click",this.newRow);n.hasClass("del")&&n.addEvent("click",this.delRow)}.bind(this)),Array.each(e.getElements("td.dynamic"),function(n){n.set("html",u[r]);n.addEvent("click",this.inputReplace)}.bind(this)));this.zebra(i);t.files=[];t.value="";this.setOutputData(i)}.bind(this);r.onerror=function(n){n.target.error.name=="NotReadableError"&&console.log("Can't read file!")}.bind(this)},saveCSV:function(n){var r=n.target.hasClass("save")?n.target:n.target.getParent(".button.save"),u=r.retrieve("id"),t=this.tables[u],e=t.getElement("tbody"),f=this.setOutputData(t),i=unescape(f).replace("[","").replace("]","").split(",").join("\r\n");uiprompt({message:"Please enter a name for your file",onOk:function(n){if(this.iemode)saveTextAs(i,n+".csv");else{var t=new Blob([i],{type:"text/plain;charset=utf-8"});saveAs(t,n+".csv")}}.bind(this)})}}),UIGrid=new Class({Version:"1.0.0.0",File:"ui.grid.js",Implements:[Options],Binds:["processTables","setupTable","zebra"],options:{},tables:{},initialize:function(n){this.setOptions(n);this.processTables();Affinity.UI.Grids={};Affinity.UI.Grids.Zebra=this.zebra},processTables:function(n,t){var i;n==null?Array.each(document.getElements("table.ui-grid"),function(n){i=n.get("id")==""?String.uniqueID():n.get("id");typeOf(this.tables[i])=="null"?(this.tables[i]=n,this.setupTable(n,t)):this.zebra(n,t)}.bind(this)):n.hasClass("ui-grid")&&(i=n.get("id")==""?String.uniqueID():n.get("id"),typeOf(this.tables[i])=="null"?(this.tables[i]=n,this.setupTable(n,t)):this.zebra(n,t));delete i},setupTable:function(n,t){this.zebra(n,t)},zebra:function(n,t){var r="tr",u,i;typeof t!="undefined"&&typeof t=="string"&&(r="tr."+t);u=n==null?document.getElements("table.ui-grid"):[n];i=0;Array.each(u,function(n){i=0;"getElements"in n&&(n.getElements(r).removeClass("odd"),Array.each(n.getElements("tbody "+r),function(n){n.hasClass("hidden")||(n.addClass(i%2==0?"":"odd"),i++)}.bind(this)))}.bind(this));delete i}}),UISortableGrid=new Class({Version:"1.0.0.0",File:"ui.grid.sortable.js",Implements:[Options,Events],Binds:["checkTables","processTable","multisort","sortColumn"],options:{},tables:{},initialize:function(n){if(this.setOptions(n),typeOf(UIGrid)!="class"||typeOf(Affinity.uiGrid)=="null")throw new Error({"Missing Component":"UISortableGrid requires UIGrid"});this.icons={};this.icons.unsorted=Affinity.icons.ArrowheadUpDown||"&#xe0cc;";this.icons.sortup=Affinity.icons.ArrowheadUp||"&#xe0ba;";this.icons.sortdn=Affinity.icons.ArrowheadDown||"&#xe0b9;";Array.each(document.getElements("table"),this.checkTables)},checkTables:function(n){n.getElements("thead th.sort-on").length>0&&this.processTable(n)},processTable:function(n,t){var e,i,h,u;if(this.headers=n.getElements("thead th"),e=n.getElements("tbody tr"),i=n.get("id")?n.get("id"):String.uniqueID(),n.get("data-icon")&&(this.icons.unsorted=n.get("data-icon")),n.get("data-up-icon")&&(this.icons.sortup=n.get("data-up-icon")),n.get("data-down-icon")&&(this.icons.sortdn=n.get("data-down-icon")),n.set("id",i),this.tables[i]={},this.tables[i].table=n,this.tables[i].columns={},h=0,u=0,Array.each(this.headers,function(n,t){n.hasClass("sort-on")&&(n.getElement("div.icon")||(n.adopt(new Element("div",{"class":"icon",html:this.icons.unsorted})),n.addEvent("mousedown",function(n){n.preventDefault()}),n.addEvent("click",this.sortColumn)),this.tables[i].columns["h"+t]={method:n.get("data-sort-method"),direction:-1,sortables:[]})}.bind(this)),Array.each(e,function(n){Array.each(n.getElements("td"),function(n,t){this.tables[i].columns["h"+t]&&(this.tables[i].columns["h"+t].method==="string"&&this.tables[i].columns["h"+t].sortables.push([n.get("html"),n]),this.tables[i].columns["h"+t].method==="date"&&(n.get("html")==""?this.tables[i].columns["h"+t].sortables.push([Date.parse(0).format("%s"),n]):this.tables[i].columns["h"+t].sortables.push([Date.parse(n.get("html")).format("%s"),n])),(this.tables[i].columns["h"+t].method==="float"||this.tables[i].columns["h"+t].method==="integer")&&(n.get("html")==""?this.tables[i].columns["h"+t].sortables.push(0,n):this.tables[i].columns["h"+t].sortables.push([Number.from(n.get("html").replace(/[\s,$]/g,"")),n])));u++}.bind(this))}.bind(this)),this.tables[i].total=u,n.set("tween",{duration:250}),Affinity.uiGrid.zebra(n,t),Affinity.hasOwnProperty("pageId")){var o="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId,r=Affinity.CookieMonster.Read(o),c=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase(),s=1,f;r&&(r=JSON.parse(r),f=Date.parse(r.date),r.href===c&&(new Date).getTime()-f.getTime()<s*18e5&&(this.tables[n.get("id")].columns["h"+r.columnIndex].direction=r.direction*-1,this.sortColumn({target:n.getElements("th")[r.columnIndex]})),(new Date).getTime()-f.getTime()>s*18e5&&Affinity.CookieMonster.Delete(o))}},multisort:function(n,t){return n[0]==t[0]?0:n[0]<t[0]?-1:1},sortColumn:function(n){this.tables[n.target.getParent("table").get("id")].total>5e3?(n.target.getParent("table").fade(.25),this.continueSort.delay(500,this,[n])):this.continueSort(n)},continueSort:function(n){var u=n.target.get("tag")==="th"?n.target:n.target.getParent("th"),t=u.getParent("table"),f=t.getElement("tbody"),i=this.tables[t.get("id")].columns["h"+t.getElements("th").indexOf(u)],r,e,o;Array.each(t.getElements("thead th"),function(n){n.getElement(".icon")&&n.getElement(".icon").set("html",this.icons.unsorted)}.bind(this));i.direction*=-1;i.sortables.sort(this.multisort);i.direction<0&&i.sortables.reverse();u.getElement(".icon").set("html",i.direction>0?this.icons.sortup:this.icons.sortdn);Array.each(i.sortables,function(n){n[1].getParent("tr").inject(f,"top")}.bind(this));Affinity.uiGrid.zebra(t);t.fade(1);Affinity.hasOwnProperty("pageId")&&(r={},r.date=new Date,r.href=(document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href).toLowerCase(),r.direction=i.direction,r.columnIndex=t.getElements("th").indexOf(u),e=JSON.stringify(r),o="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber+"-"+Affinity.pageId,Affinity.CookieMonster.Write(o,e));delete u;delete t;delete f;delete i},returnData:function(n,t){t=typeof t!="undefined"?t:!1;var i,r=[],u=n.getElements("tr th");return(Array.each(n.getElements("tr"),function(n){i={};Array.each(n.getElements("td"),function(n,t){i[u[t].get("data-name")]=n.get("html")}.bind(this));Object.getLength(i)>0&&r.push(i)}.bind(this)),t)?JSON.stringify(r):r}}),UIHelpBubble=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:["populate","alignTo","position","hide","show"],options:{fadeTime:100},initialize:function(n){this.setOptions(n);document.getElement(".helpBubble.float")||(this.helpBubble=new Element("div",{"class":"helpBubble right float"}).inject(document.body,"bottom"),this.helpBubble.set("tween",{duration:this.options.fadeTime}),this.helpBubble.fade("hide"))},populate:function(n){this.helpBubble&&(this.helpBubble.empty(),typeOf(n)=="element"&&this.helpBubble.adopt(n),typeOf(n)=="string"&&this.helpBubble.set("html",n),this.addClass("right"),this.setDirection("left"))},alignTo:function(n){var t=n.getPosition(),i=n.getSize();this.position({x:t.x+i.x+5,y:t.y+i.y/2-15})},setDirection:function(n){if(this.helpBubble){n=n.toLowerCase().trim()||"left";var t=["top","left","right","bottom","bottom-right","top-right"];t.contains(n)&&(Array.each(t,function(n){this.helpBubble.removeClass(n)}.bind(this)),this.addClass(n))}},addClass:function(n){this.helpBubble&&this.helpBubble.addClass(n)},position:function(n){this.helpBubble&&this.helpBubble.setStyles({top:n.y,left:n.x})},show:function(n){this.helpBubble&&(n&&n===!0&&(this.helpBubble.addEvent(Affinity.events.outAll,this.hide),this.helpBubble.addEvent(Affinity.events.overAll,this.show)),this.helpBubble.fade("in"))},hide:function(){this.helpBubble&&(this.helpBubble.removeEvents(),this.helpBubble.fade("out"))},getSize:function(){if(this.helpBubble)return this.helpBubble.measure(function(){return this.getSize()})}}),UIHelpIcon=new Class({Version:"1.0.0.0",File:"ui.help.bubble.js",Implements:[Options],Binds:[],options:{},initialize:function(n){if(this.setOptions(n),Affinity.tooltips)Array.each(document.getElements(".indicator.help"),function(n){n.get("data-help")&&(n.set("data-tooltip",n.get("data-help")),n.addClass("ui-has-tooltip"),n.erase("data-help"))}.bind(this)),Affinity.tooltips.init();else throw"UI Help Icon requires UI Tooltips";}}),UIHidables=new Class({Version:"1.0.0.0",File:"ui.hidables.js",Implements:[Options],Binds:["processNew","process","processTriggers","processEachTrigger","triggerClicked"],options:{},initialize:function(n){this.setOptions(n);this.hidableFxs={};this.processTriggers()},processNew:function(){this.processTriggers()},processTriggers:function(){var n=document.getElements(".has-hidable");n.length>0&&Array.each(n,this.processEachTrigger)},process:function(n){this.processEachTrigger(n)},processEachTrigger:function(n){var t,i=n.get("data-hidable-trigger-id");document.id(i)&&(t=document.id(n.get("data-hidable-trigger-id")),t.store("hidableFx",new Fx.Reveal(t,{duration:250,mode:"vertical"})),n.addEvent("click",this.triggerClicked),t.setStyle("display","none"),t.removeClass("hidden"),t.hasClass("auto-hide")||t.retrieve("hidableFx").reveal())},triggerClicked:function(n){var t=!0,r=n.target,i=document.id(n.target.get("data-hidable-trigger-id"));n.target.get("type")!="checkbox"||n.target.checked||(t=!1);t?(i.retrieve("hidableFx").reveal(),n.target.get("name")&&Array.each(document.getElements("input[name="+n.target.get("name")+"]"),function(t){t!=n.target&&document.id(t.get("data-hidable-trigger-id")).retrieve("hidableFx").dissolve()}.bind(this))):i.retrieve("hidableFx").dissolve()}}),UIHideToggle=new Class({Implements:[Options],Binds:["init","processNew","processToggle"],options:{},initialize:function(n){this.setOptions(n);this.init()},init:function(){this.processNew()},processNew:function(){Array.each(document.getElements(".ui-hide-toggle"),this.processToggle)},processToggle:function(n){n.hasClass("ui-hide-toggle")&&(n.removeClass("ui-hide-toggle"),new UIHideToggleWidget({element:n}))}}),UIHideToggleWidget=new Class({Implements:[Options],Binds:["childFocus","toggle","hide","show"],options:{element:null},isHidden:!1,initialize:function(n){this.setOptions(n);this.element=this.options.element;this.toggleid=this.element.get("data-hide-toggle-id");this.togglelement=document.id(this.toggleid);this.icons={};this.icons.hide=Affinity.icons.ResizeShrink||"&#xe0b4;";this.icons.show=Affinity.icons.ResizeEnlarge||"&#xe0b3;";this.togglelement&&(this.element.set("reveal",{duration:250,onHide:function(n){n.addClass("subhidden")}.bind(this)}),this.togglelement.set("html",this.icons.hide),this.togglelement.addEvent("click",this.toggle),Array.each(this.element.getElements("input,textarea,select"),function(n){n.addEvent("focus",this.childFocus)}.bind(this)));var t=this.element.get("data-hide-toggle-state");t&&t=="hidden"&&(this.element.addClass("subhidden"),this.element.setStyle("display","none"),this.isHidden=!0,this.togglelement.set("html",this.icons.show));this.element.removeClass("hidden")},childFocus:function(n){this.isHidden&&this.element.contains(n.target)&&this.show()},toggle:function(){this.isHidden?this.show():this.hide()},hide:function(){this.isHidden=!0;this.togglelement.set("html",this.icons.show);this.element.dissolve()},show:function(){this.element.removeClass("subhidden");this.isHidden=!1;this.togglelement.set("html",this.icons.hide);this.element.reveal()}}),UIInbox=new Class({Implements:[Options,Events],Binds:["processBox","selectBox","rowClicked","refreshInbox","refresh","setError"],options:{},initialize:function(n){this.setOptions(n);Array.each(document.getElements(".ui-inbox"),function(n){var e=new Element("div",{"class":"hidden",html:"no errors",styles:{position:"absolute",top:"10px",right:"10px",padding:"10px",background:"white",border:"5px solid black","border-radius":"10px","z-index":"9999999999"}}).inject(n,"after");n.store("errors",e);n.getElement(".ui-inbox-labels h2").addEvent(Affinity.events.click,function(){e.toggleClass("hidden")});var o=n.get("id")||String.uniqueID(),r=n.get("data-tab-api"),i=n.get("data-refresh-frequency");i&&(i=parseFloat(i)||5,i=i<.5?.5:i);var s=n.getElements(".ui-inbox-labels li"),u=n.getElements(".ui-inbox-box"),f=n.getElement(".ui-inbox-readpane"),t={};n.set("id",o);t.tabApi=r||!1;t.tabIndex=Cookie.read("uiInboxIndex")||0;t.frequency=i;t.element=n;t.stoprefresh=!1;u.addClass("hidden");Array.each(s,function(n,t){n.store("box",u[t]);this.processBox(u[t]);n.addEvent(Affinity.events.click,function(n){var t=n.target.get("tag")=="li"?n.target:n.target.getParent("li");this.selectBox(t);delete t}.bind(this))}.bind(this));n.getElement(".ui-inbox-labels li").addClass("selected");n.getElement(".ui-inbox-box").removeClass("hidden");new Fx.Reveal(f,{duration:250,mode:"vertical"});f.setStyle("display","none");f.removeClass("hidden");r&&(t.refreshRequest=new CFRequest.JSON({url:r,onSuccess:function(n){this.refreshInbox(t,n)}.bind(this),onError:function(t){this.setError(n,t)}.bind(this),onFailure:function(t){this.setError(n,t)}.bind(this)}),n.getElement(".ui-inbox-loader")&&n.getElement(".ui-inbox-loader").removeClass("hidden"),n.hasClass("ui-inbox-requires-login")?window.addEvent("loggedin",function(){t.refreshRequest.send()}.bind(this)):t.refreshRequest.send());n.store("inboxObj",t)}.bind(this))},selectBox:function(n){var t=n.getParent(".ui-inbox"),i=t.retrieve("inboxObj");i.tabIndex=t.getElements(".ui-inbox-labels li").indexOf(n);t.store("inboxObj",i);t.getElements(".ui-inbox-labels li").removeClass("selected");t.getElements(".ui-inbox-box").addClass("hidden");n.retrieve("box").removeClass("hidden");n.addClass("selected");i.tabApi&&this.startRefresh(t);window.fireEvent("inboxSelected",{menuItem:n,box:n.retrieve("box")})},processBox:function(n){Array.each(n.getElements("tbody tr"),function(n){n.get("data-itemdata")&&n.addEvent(Affinity.events.click,this.rowClicked)}.bind(this))},rowClicked:function(n){var r=n.target.get("tag")=="tr"?n.target:n.target.getParent("tr"),t=JSON.parse(r.get("data-itemdata").replace(/'/g,'"')),i=r.getParent(".ui-inbox").getElement(".ui-inbox-readpane");i.getElement(".ui-inbox-date-display").set("html",t.date?unescape(t.date):"");i.getElement(".ui-inbox-from").set("html",t.from?unescape(t.from):"");i.getElement(".ui-inbox-subject").set("html",t.subject?unescape(t.subject):"");i.getElement(".ui-inbox-message").set("html",t.details?unescape(t.details):"");i.reveal();delete r;delete t;delete i},stopRefresh:function(n){if(n){var t=n.retrieve("inboxObj");t&&(t.stoprefresh=!0,t.refreshRequest.isRunning()&&t.refreshRequest.cancel())}},startRefresh:function(n){if(n){var t=n.retrieve("inboxObj");t&&(n.getElement(".ui-inbox-loader")&&n.getElement(".ui-inbox-loader").removeClass("hidden"),t.stoprefresh=!1,t.refreshRequest.isRunning()&&t.refreshRequest.cancel(),t.refreshRequest.send())}},refreshInbox:function(n,t){(this.fireEvent("refresh"),n.element&&n.element.getElement(".ui-inbox-loader")&&n.element.getElement(".ui-inbox-loader").addClass("hidden"),n.stoprefresh)||(window.fireEvent("inboxUpdated",{elementid:n.element.get("id"),inbox:n,data:t}),n.frequency&&function(){n.element&&n.element.getElement(".ui-inbox-loader")&&n.element.getElement(".ui-inbox-loader").removeClass("hidden");n.refreshRequest.send()}.delay(n.frequency*6e4,this))},refresh:function(){var n,i,t,r;Array.each(document.getElements(".ui-inbox"),function(u){lables=u.getElements(".ui-inbox-labels li");r=u.getElements(".ui-inbox-boxes .ui-inbox-box");Array.each(lables,function(u,f){n=r[f];i=n.getElements("tbody tr");t=i.length;n.getElement("tbody tr.empty")&&(t--,t==0&&n.getElement("tbody tr.empty").removeClass("hidden"));u.getElement(".indicator").set("html",t)}.bind(this))}.bind(this));delete r;delete lables;delete t;delete i;delete n},setError:function(n,t){var i="";i=typeOf(t)==="object"||typeOf(t)==="array"?JSON.stringify(t,null,2):t;n.retrieve("errors").set("html","<pre>"+i+"<\/pre>");this.fireEvent("error",i)}});Locale.define("en-NZ","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["date","month","year","/"],ordinal:function(n){return n>3&&n<21?"th":["th","st","nd","rd","th"][Math.min(n%10,4)]},AM:"am",PM:"pm"});Locale.use("en-NZ");window.components=[["UIHelpBubble","helpbubble"],["UIGrid"],["UISortableGrid"],["UIDynamicGrid"],["UIScrollableGrid"],["UITabs"],["UIInbox"],["UIHidables"],["UIFormHideables","formhideables"],["UISectionHideables","sectionHidables"],["UIHideToggle","hidetoggle"],["UIUplaoders"],["UIUplaodersMulti","uploaders"],["UIReplaceArrows","arrows"],["UIValidation"],["UISanitise"],["UIDateDropDowns"],["UISelectLookup","lookups"],["UIDisplayLookup","displaylookups"],["UIDateCalendar"],["UIListBuilder"],["UIDateCleverInput"],["UIAutoComplete"],["UIQuickSearch"],["UIModal","modal"],["UIDrawPanels"],["UITooltips","tooltips"],["UIHelpIcon","helpicon"],["UIPompts","prompts"],["UIFormatDate"],["UIBankNumber","banknumber"],["UITaxNumber","taxnumber"],["UIMasterMessage","masterMessage"],["UIAddress","address"],["UIPager"],["UITextareaAutoSize","textAutoSize"]];mybasepath=window.basepath||"";window.addEvent("PageReady",function(){var t,r,i,n,u;if("Affinity"in window||(window.Affinity={}),!Affinity.uiready){for(r=0;r<window.components.length;r++)if(t=window.components[r],typeof window[t[0]]!="undefined"&&typeOf(window[t[0]])==="class")if(n=t[0].replace("UI","ui"),n in Affinity)console.log('name collision in Affinity for "'+n+'"');else if(Affinity[n]=new window[t[0]],Affinity.Components[n]={},Affinity.Components[n].Version=Affinity[n].Version||"",Affinity.Components[n].Name=Affinity[n].Name||t[0].replace(new RegExp("UI","gi"),"").split(/(?=[A-Z])/).join(" "),Affinity.Components[n].File=Affinity[n].File||"",Affinity.Components[n].Jira=Affinity[n].Jira||"",t.length>1)for(u=1;u<t.length;u++)i=t[u],i in Affinity?console.log('name collision in Affinity for "'+i+'"'):Affinity[i]=Affinity[n];n=null;i=null;t=null;Affinity.useWebWorkers=Affinity.isie&&Affinity.ieversion<=11?!1:Affinity.useWebWorkers;Affinity.uiready=!0;window.fireEvent("UiReady")}});var UIModal=new Class({Version:"1.0.0.0",File:"ui.modal.js",Implements:[Options],Binds:["setElement","setString","adopt","position","clear","closeButtonCloser","backgroundCloser","show","hide"],Options:{},backgroundCloses:!0,initialize:function(n){this.setOptions(n);this.icons={};this.icons.del=Affinity.icons.CrossRound;document.id("uimodalbg")||(this.modalbg=new Element("div",{id:"uimodalbg","class":"white hidden"}).inject(document.body,"bottom"));document.id("uimodal")||(this.modal=new Element("div",{id:"uimodal","class":"shadow hidden"}).inject(document.body,"bottom"),this.modalclose=new Element("div",{"class":"uimodalclose"}).inject(this.modal),new Element("span",{"class":"icon-cross"}).inject(this.modalclose),this.modalbody=new Element("div",{"class":"uimodalbody"}).inject(this.modal));this.modalbg=document.id("uimodalbg");this.modal=document.id("uimodal");this.modalbg.set("tween",{duration:250});this.modal.set("tween",{duration:250});this.modalclose=this.modal.getElement(".uimodalclose");this.modalbody=this.modal.getElement(".uimodalbody");this.modalbg.addEvent("click",this.backgroundCloser);this.modalclose.addEvent("click",this.closeButtonCloser);this.modalbg.removeClass("hidden").fade("hide");this.modal.removeClass("hidden").fade("hide");window.addEvent("resize",function(){this.position()}.bind(this));this.position();this.scroll={};this.scroll.enable=function(){this.modal.addClass("scroll")}.bind(this);this.scroll.disable=function(){this.modal.removeClass("scroll")}.bind(this);this.close={};this.close.enable=function(){this.modalclose.removeClass("hidden")}.bind(this);this.close.disable=function(){this.modalclose.addClass("hidden")}.bind(this)},getCalculatedTop:function(){var n;if(Affinity.oldess&&Affinity.oldessFrame){var i=window.parent.window,r=i.document.documentElement,u=i.document.body,e=r&&r.scrollTop||u&&u.scrollTop||0,f=0,t=window.parent.document.getElementById("ctl00_MainPanel");return t&&(f=document.documentMode&&document.documentMode<9?t.querySelectorAll(".ContentBody")[0].offsetTop:t.getElementsByClassName("ContentBody")[0].offsetTop),n=e-f,n<10&&(n=10),n+10}return 10},position:function(){var n=window.getSize();this.modalbg.setStyles({width:n.x,height:n.y});this.modal.setStyles({left:n.x/2-this.modal.getDimensions().width/2,top:this.getCalculatedTop()});this.modalbody.setStyles({"max-height":n.y-60});delete n},setElement:function(n){this.modalbody.empty();n.inject(this.modalbody);this.position();this.close.enable();this.scroll.enable()},adopt:function(n){this.setElement(n)},setString:function(n){this.modalbody.empty();this.modalbody.set("html",n);this.position();this.close.enable();this.scroll.enable()},backgroundCloser:function(n){this.closeButtonCloser(n)},closeButtonCloser:function(){window.fireEvent("leaveEditDetailCloses");this.backgroundCloses&&this.hide()},hide:function(){"beforeClose"in this&&typeOf(this.beforeClose)==="function"&&(this.beforeClose(),this.beforeClose=null,delete this.beforeClose);document.body.removeClass("uimodal-open");this.modalbg.fade("out");this.modal.fade("out");this.clear.delay(500,this)},show:function(n){n==null?(n=!0,this.modalclose.fade("show")):this.modalclose.fade("hide");document.body.addClass("uimodal-open");this.backgroundCloses=n;this.modalbg.fade("in");this.modal.fade("in")},clear:function(){this.modalbody.empty()}}),UIPromptPositionObject={position:"absolute",top:!1,left:!1},UILoaderObject={message:"Loading",onClose:function(){},timeout:null,position:{},showButtons:!1,showLoader:!0,noClose:!0,cssSelector:""},UIMessageObject={message:"Message!",onClose:function(){},timeout:null,position:{},cssSelector:""},UIAlertObject={message:"Alert!",messageAlign:"center",okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},showButtons:!0,showCancel:!1,noClose:!1,showLoader:!1,append:!1,position:{},cssSelector:"",showHiddenInfo:!1,hiddenInfoMessage:"",hiddenInfoButtonText:""},UIConfirmObject={message:"Yes or No?",messageAlign:"center",okText:"Yes",okIcon:"",okColor:"green",cancelText:"No",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPromptObject={message:"Enter text",messageAlign:"center",lines:1,okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",value:"",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,position:{},cssSelector:""},UIPompts=new Class({Version:"1.0.4.0",Sequence:1050,Name:"Prompts",File:"ui.prompts.js",Jira:"",Notes:"Added value for TS Favs edit",Implements:[Options],Binds:["returnOptionsObject","message","alert","prompt","confirm","loader","center","show","escape","hide","hideDelay","clearHideDelay","okKeyUp"],options:{},status:"closed",message:"",currentObj:!1,container:!1,currentType:"",initialize:function(n){if(this.setOptions(n),this.promptBoxBG=document.id("UIPromtBoxBG")?document.id("UIPromtBoxBG"):new Element("div",{id:"UIPromtBoxBG","class":"UIPromtBoxBG"}).inject(document.body,"bottom"),this.promptBoxBG.set("tween",{duration:250}),this.promptBoxBG.fade("hide"),document.id("UIPromtBox"))this.promptBox=document.id("UIPromtBox");else{var t=new Element("div",{"class":"mobile-wrap"}).inject(document.body,"bottom");this.promptBox=new Element("div",{id:"UIPromtBox","class":"UIPromtBox"}).inject(t)}this.promptBox.set("tween",{duration:250});this.promptBox.fade("hide");this.container=this.promptBox;this.trueButton=new Element("span",{"class":"button true-button w-icon",tabindex:9999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{"class":"label",html:""}));this.falseButton=new Element("span",{"class":"button false-button w-icon",tabindex:9999999}).adopt(new Element("span",{html:Affinity.icons.Cancel||"&#xe070;"}),new Element("span",{"class":"label",html:""}));this.promptBoxBG.removeEvents();this.promptBoxBG.addEvent("keyup",function(n){if(n.stop(),!this.obj.noClose&&n.key=="esc"){this.hide();return}n.key=="enter"&&this.obj.onOk()}.bind(this));Affinity.mobile&&(window.removeEvent("mobileback",this.escape),window.addEvent("mobileback",this.escape));window.prompts=this;window.uimessage=this.message;window.uialert=this.alert;window.uiconfirm=this.confirm;window.uiprompt=this.prompt;window.uiloader=this.loader},returnOptionsObject:function(n){var t=Object.clone(n);return Object.merge({},t)},message:function(n){var t=this.returnOptionsObject(UIMessageObject);t.message=n.message?n.message:t.message;t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign;t.timeout=n.timeout?n.timeout:t.timeout;t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector;window.onPromptClose=n.onClose?n.onClose:t.onClose;t.position=this.returnOptionsObject(UIPromptPositionObject);n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left);this.currentObj=t;this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox";this.promptBox.empty();this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign}));this.center();this.show();t.timeout!==null&&this.hide.delay(t.timeout,this)},addLargeMessage:function(n){var t=new Element("div",{html:n,styles:{width:"100%","max-height":150,overflow:"auto","text-align":"left",margin:"10px 0"}});this.promptBox.getElement(".promptButtons")?t.inject(this.promptBox.getElement(".promptButtons"),"before"):t.inject(this.promptBox);this.center();t=null},adopt:function(){for(var t=this.promptBox.getElement(".content"),n=0;n<arguments.length;n++)t.adopt(arguments[n]);n=t=null;this.center()},alert:function(n){var t,i,r;if(this.currentType=n.type||"",t=this.returnOptionsObject(UIAlertObject),t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onOk=n.onOk?n.onOk:t.onOk,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.showButtons=typeOf(n.showButtons)==="boolean"?n.showButtons:t.showButtons,t.showCancel=typeOf(n.showCancel)==="boolean"?n.showCancel:t.showCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.showLoader=typeOf(n.showLoader)==="boolean"?n.showLoader:t.showLoader,t.append=n.append?n.append:t.append,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.showHiddenInfo=typeOf(n.showHiddenInfo)==="boolean"?n.showHiddenInfo:t.showHiddenInfo,t.hiddenInfoMessage=n.hiddenInfoMessage?n.hiddenInfoMessage:t.hiddenInfoMessage,t.hiddenInfoButtonText=n.hiddenInfoButtonText?n.hiddenInfoButtonText:t.hiddenInfoButtonText,n.isCloseOnClick!==undefined&&(t.isCloseOnClick=n.isCloseOnClick),t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){t.onOk();this.hide()}.bind(this),this.onCancelMethod=function(){t.onCancel();this.hide()}.bind(this),i=this.falseButton.clone().removeEvents().addClass(t.cancelColor).addClass("hidden").addEvent("click",this.onCancelMethod),i.getElement("span").set("html",t.cancelIcon),i.getElement(".label").set("html",t.cancelText),r=new Element("span",{html:"&nbsp;","class":"hidden"}),this.message=t.append?this.message+(this.message!==""?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,"class":"content align"+t.messageAlign})),t.showHiddenInfo){var u=new Element("div",{"class":"hiddenInfoContainer",style:"display: none;",html:"<br />"+t.hiddenInfoMessage}).inject(this.promptBox),f=new Element("div",{"class":"tooltip-view ui-has-tooltip more-button tile-more-button",style:"text-align: center;",html:'<br /><span class="button more w-icon more-info-button"><span class="icon-info"><\/span><span class="btn-tag tile-more">'+t.hiddenInfoButtonText+"<\/span><\/span>"}).inject(this.promptBox),e=new Element("div",{style:"text-align: center;","class":"tooltip-view ui-has-tooltip more-button tile-more-button",html:'<span class="button more w-icon more-info-button"><span><\/span><span class="btn-tag tile-more">Hide<\/span><\/span>'}).inject(u);f.addEvent(Affinity.events.click,function(){u.style.display="block";f.style.display="none"}.bind(this));e.addEvent(Affinity.events.click,function(){u.style.display="none";f.style.display="block"}.bind(this))}return t.showLoader?(this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader")):this.promptBox.removeClass("loader"),t.noClose?this.promptBox.getElement("promptButtons")&&this.promptBox.getElement("promptButtons").destroy():t.showButtons&&(this.promptBox.adopt(new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),r,i)),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText)),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.showButtons||t.noClose?t.showCancel&&(r.removeClass("hidden"),i.removeClass("hidden")):this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.center(),this.show(),this},prompt:function(n){var t,i;return this.currentType=n.type||"",t=this.returnOptionsObject(UIPromptObject),t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.value=n.value?n.value:t.value,t.lines=n.lines?n.lines:t.lines,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.onOk=n.onOk?n.onOk:t.onOk,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){var n=document.id("UIPromtBox").getElement(".promptinput").value;this.hide();t.onOk(n)}.bind(this),this.onCancelMethod=function(){var n=document.id("UIPromtBox").getElement(".promptinput").value;this.hide();t.onCancel(n)}.bind(this),i=t.lines<2?new Element("input",{type:"text","class":"promptinput data-hj-whitelist",tabindex:9999997}):new Element("textarea",{rows:t.lines,"class":"promptinput data-hj-whitelist",tabindex:9999997}),i.value=t.value,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign}),new Element("div",{"class":"promptButtons"}).adopt(i),new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this.promptBox.getElement(".promptinput").focus(),this},confirm:function(n){this.currentType=n.type||"";var t=this.returnOptionsObject(UIConfirmObject);return t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.onOk=n.onOk?n.onOk:t.onOk,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){this.hide();t.onOk(!0)}.bind(this),this.onCancelMethod=function(){this.hide();t.onCancel(!1)}.bind(this),this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign}),new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),this.currentObj=t,window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this},loader:function(n){this.currentType=n.type||"";var t=this.returnOptionsObject(UILoaderObject);t.message=n.message?n.message:t.message;t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign;t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector;window.onPromptClose=n.onClose?n.onClose:t.onClose;t.position=this.returnOptionsObject(UIPromptPositionObject);n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left);this.currentObj=t;this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox";this.message=t.append?this.message+(this.message!==""?"<br />":"")+t.message:t.message;this.promptBox.empty();this.promptBox.adopt(new Element("span",{html:this.message,"class":"content align"+t.messageAlign}));this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark}));this.promptBox.addClass("loader");window.removeEvent("keyup",this.okKeyUp);this.promptBoxBG.removeEvent(Affinity.events.click,this.hide);this.center();this.show()},getCalculatedTop:function(){var t,u,h;if(Affinity.oldess&&Affinity.oldessFrame){var c=this.promptBox.getSize(),f=c.y/2,n=window.parent.window,e=n.document.documentElement,o=n.document.body,l=e&&e.scrollTop||o&&o.scrollTop||0,s=n.innerHeight||n.document.documentElement.clientHeight,i=0,r=window.parent.document.getElementById("ctl00_MainPanel");return r&&(i=document.documentMode&&document.documentMode<9?r.querySelectorAll(".ContentBody")[0].offsetTop:r.getElementsByClassName("ContentBody")[0].offsetTop),this.promptBox.getStyle("position")==="fixed"?s/2-i:(t=l+s/2-i,t<f+10&&(t=f+10),t+10)}return u=document.getSize(),this.promptBox.getStyle("position")==="fixed"?u.y/2:(h=document.getScroll(),u.y/2+h.y)},center:function(){var n;if(!Affinity.mobile){var f=this.promptBox.getSize(),t=this.getCalculatedTop(),i="50%",r=0-f.y/2,u=0-f.x/2,e="absolute";typeOf(this.currentObj)!=="null"&&typeOf(this.currentObj.position)!=="null"&&(n=this.currentObj.position,e=n.position?n.position:"absolute",t=n.top?n.top:t,i=n.left?n.left:i,r=n.top?0:r,u=n.left?0:u);this.promptBox.setStyles({position:e,top:t,left:i,margin:r+"px 0 0 "+u+"px"})}},okKeyUp:function(n){n.key=="enter"&&this.status=="open"&&(this.promptBox.getElement(".promptinput")?this.promptBox.getElement(".promptinput")!=document.activeElement&&this.onEnterMethod():this.onEnterMethod())},showButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").removeClass("hidden"),this.promptBoxBG&&(this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.promptBoxBG.addEvent(Affinity.events.click,this.hide)))},hideButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").addClass("hidden"),this.promptBoxBG&&this.promptBoxBG.removeEvent(Affinity.events.click,this.hide))},show:function(){document.body.addClass("uiprompt-open");this.promptBoxBG.fade("in");this.promptBox.fade("in");this.status="open"},escape:function(){this.currentOb&&!this.currentOb.noClose&&this.hide()},clearOnClose:function(){window.onPromptClose=function(){}},hide:function(n){if(document.body.removeClass("uiprompt-open"),typeof n!="string"||n===""||n===this.currentType){"onPromptClose"in window&&window.onPromptClose();this.clearOnClose();this.promptBoxBG.fade("out");this.promptBox.fade("out");this.status="closed";this.message="";window.removeEvent("keyup",this.okKeyUp);try{this.promptBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(t){}this.currentObj=!1;this.currentType=""}},hideDelayTimer:!1,hideDelay:function(n){this.clearHideDelay();this.hideDelayTimer=this.hide.delay(n)},clearHideDelay:function(){clearTimeout(this.hideDelayTimer)}}),UIReplaceArrows=new Class({Implements:[Options],Binds:["processArrows","processInlineArrows"],Options:{},initialize:function(n){this.setOptions(n);this.processArrows()},processArrows:function(){var n=0,r,t,u,i,f;Array.each(document.getElements(".ui-replace-arrows td").combine(document.getElements(".ui-replace-arrows th")),function(e){e.getElements(".button,button").length==0&&(r=e.get("html").split(","),e.empty(),Array.each(r,function(o){o.contains("-&gt;")||o.contains("->")?(o.contains("-&gt;")&&(t=o.split("-&gt;")),o.contains("->")&&(t=o.split("->")),u=new Element("table",{"class":"arrow-table"}).inject(e),i=new Element("tr").inject(u),f=new Element("span",{html:t[0].trim()}).inject(new Element("td",{"class":"left"}).inject(i)),new Element("span",{"class":"smicon arrow"}).inject(new Element("td",{"class":"arrow"}).inject(i)),new Element("td",{html:t[1].trim()}).inject(i),w=f.getSize().x,n=w>n?n=w:n):(new Element("span",{html:o.trim()}).inject(e),r.length>1&&new Element("br").inject(e))}))});n>0&&document.getElements("td.left").setStyle("width",n);delete r;delete t;delete u;delete i;delete f},processInlineArrows:function(){var n=[];n.combine(document.getElements(".ui-replace-arrows td"));n.combine(document.getElements(".ui-replace-arrows li"));Array.each(n,function(n){(n.get("tag")=="td"&&n.getElements(".button,button").length==0||n.get("tag")!="td")&&(n.get("html").contains("-&gt;")&&n.set("html",n.get("html").replace(/-&(gt);/g,'<span class="smicon arrow"><\/span>')),n.get("html").contains("->")&&n.set("html",n.get("html").replace(/->/g,'<span class="smicon arrow"><\/span>')))});n=null;delete n}}),UISelectLookup=new Class({Version:"1.0.4.0",File:"ui.select.lookups.js",Notes:"remove superfluous logging",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","refreshQueue","cancelQueue","processQueue","removeFromQueue","addToQueue","addDefaultOption","addFilterOption"],options:{jsonp:!1},enabled:!1,initialize:function(n){this.setOptions(n);Affinity.UI||(Affinity.UI={});Affinity.UI.lookups||(Affinity.UI.lookups={});Affinity.UI.lookups.processLookup=this.processLookup;Affinity.UI.lookupLoaders=[];window.addEvent("refreshQueues",this.refreshQueue);Affinity.login?(window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0;this.processNew()}.bind(this))):(this.enabled=!0,this.processNew())},processNew:function(n){this.setOptions(n);var t=document.getElements("select.has-lookup");Array.each(t,this.processLookup);this.processQueue();delete t},processLookup:function(n){var t,i,r,u;(n.removeClass("has-lookup").addClass("was-lookup"),n.hasClass("has-dependencies"))||(n.addClass("lookup-loading"),n.get("data-lookup-api")&&(n.get("data-lookup-api")&&(n.removeClass("has-display-lookup"),n.get("data-lookup-api")!==""&&(t=n.get("data-lookup-api"),n.retrieve("original-lookup-url")||n.store("original-lookup-url",t),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.lookups[i]?Affinity.UI.lookups[i].elements.contains[n]||Affinity.UI.lookups[i].elements.push(n):Affinity.UI.lookups[i]={api:t,id:"lookup_"+String.uniqueID(),type:"select",loaded:!1,massive:!1,elements:[n]})),n.addClass("hidden"),n.getParent().getElement(".lookup-spinner")||(r=new Element("span",{html:'<img src="'+Affinity.loaders.light+'" />',"class":"lookup-spinner hidden"}).inject(n,"after"),n.store("spinner",r),n.getParent().getElement(".ui-autocomplete-display")||r.removeClass("hidden")),n.getParent().getElement(".errorstr")||(u=new Element("span",{"class":"errorstr inplace-of-input hidden"}).inject(n,"after"),n.store("error",u)),window.fireEvent("lookupComplete",n),n.addChangeTracker(),n.fireEvent("lookup")))},getApiKey:function(n){var o=new URI(n.toLowerCase()),s=o.get("query").parseQueryString(),i=[],u=[],t=!1,f="",r,e;return Object.each(s,function(n,r){r.toLowerCase()!=="ran"&&(r!=="parameters"?i.push(r+"-"+n):t=JSON.parse(n))}),i=i.sort(),t&&typeOf(t)==="object"&&"parameter"in t&&typeOf(t.parameter)==="array"&&(Array.each(t.parameter,function(n){r=[];Object.each(n,function(n,t){t.toLowerCase()!=="ran"&&r.push(t+"-"+n)});r.sort();u.push(r.join("|"))}),u.sort(),f="|parameters|"+u.join("||")),e=i.join("|")+f,"display-"+e.replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL LOOKUPS &#187;");this.enabled=!1;Array.each(Affinity.UI.lookupLoaders,function(n){"cancel"in n&&n.cancel();n.removeEvents();n=null});Affinity.UI.lookupLoaders=[];Object.each(Affinity.UI.lookups,function(n,t){Affinity.UI.lookups[t].loaded=!1;Affinity.UI.lookups[t].data=null});this.enabled=!0;window.fireEvent("lookupCacheClear")},cancelQueue:function(){return this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,function(n){"cancel"in n&&n.cancel();"removeEvents"in n&&n.removeEvents();n=null}),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,function(n,t){Affinity.UI.lookups[t].loaded=!1;Affinity.UI.lookups[t].data=null;Affinity.UI.lookups[t].elements=[];Affinity.UI.lookups[t]=null;delete Affinity.UI.lookups[t]}),Affinity.UI.lookups={},!0},processQueue:function(){var n,t;try{Object.each(Affinity.UI.lookups,function(i,r){this.enabled&&(Affinity.UI.lookups[r].loaded===!0&&this.setElements(r),Affinity.UI.lookups[r].loaded===!1&&(t=Affinity.UI.lookups[r].api,Affinity.UI.lookups[r].loaded="loading...",n=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:t,method:"get",timeout:6e4,onComplete:function(n){JSON.Unauthorized(n,Affinity.UI.lookups[r].id)||(Affinity.UI.lookups[r].data=n,"error"in n?n.error.test("limit","gi")?(Affinity.UI.lookups[r].data=[],Affinity.UI.lookups[r].massive=!0,Affinity.UI.lookups[r].loaded=!0,this.setElements(r)):(this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"),Affinity.UI.lookups[r].loaded=!1):typeOf(n)==="array"&&n.length>0?(Affinity.UI.lookups[r].loaded=!0,this.setElements(r)):(Affinity.UI.lookups[r].loaded=!1,this.hideLoader(r),this.setError(r,"Data returned as empty array"),Array.each(Affinity.UI.lookups[r].elements,function(n){n.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(){this.setError(r,"There was an error retrieving this data");Affinity.UI.lookups[r].loaded=!1}.bind(this),onFailure:function(){this.setError(r,"There was an error retrieving this data");Affinity.UI.lookups[r].loaded=!1}.bind(this),onTimeout:function(){this.setError(r,"lookup timed out");Affinity.UI.dependancies[r].loaded=!1}.bind(this)}):new Request.JSON({url:t,method:"get",timeout:6e4,onSuccess:function(n){JSON.Unauthorized(n,Affinity.UI.lookups[r].id)||(Affinity.UI.lookups[r].data=n,"error"in n?n.error.test("limit","gi")?(Affinity.UI.lookups[r].data=[],Affinity.UI.lookups[r].massive=!0,Affinity.UI.lookups[r].loaded=!0,this.setElements(r)):(this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"),Affinity.UI.lookups[r].loaded=!1):typeOf(n)==="array"&&n.length>0?(Affinity.UI.lookups[r].loaded=!0,this.setElements(r)):(Affinity.UI.lookups[r].loaded=!1,this.hideLoader(r),this.setError(r,"Data returned as empty array"),Array.each(Affinity.UI.lookups[r].elements,function(n){n.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(){this.setError(r,"There was an error retrieving this data");Affinity.UI.lookups[r].loaded=!1}.bind(this),onFailure:function(){this.setError(r,"There was an error retrieving this data");Affinity.UI.lookups[r].loaded=!1}.bind(this),onTimeout:function(){this.setError(r,"lookup timed out");Affinity.UI.dependancies[r].loaded=!1}.bind(this)}),n&&(Affinity.UI.lookupLoaders.push(n),n.send())))}.bind(this))}catch(i){}},removeFromQueue:function(n,t,i){var r,f,u;return t&&t.getWidget()&&(r=t.getWidget(),r.hasOwnProperty("revert")&&(f=r.revert(),typeOf(i)==="boolean"&&i===!0&&("empty"in t&&t.empty(),"value"in t&&(t.value="")))),t.retrieve("spinner")&&(spinner=t.retrieve("spinner"),spinner&&"destroy"in spinner&&spinner.destroy()),t.retrieve("error")&&(error=t.retrieve("error"),error&&"destroy"in error&&error.destroy()),Array.each(Affinity.UI.lookups,function(n){n.elements.contains(t)&&(u=n.elements.indexOf(t),array.splice(u,1))}),!0},addFilterOption:function(n,t){return n.set("filter-option",t),!0},addDefaultOption:function(n,t){if(t)n.adopt(t);else{var i=new Element("option",{value:"",html:"None"});n.adopt(i)}},addToQueue:function(n,t){return t.set("data-lookup-api",n),this.processLookup(t),!0},hideLoader:function(n){Array.each(Affinity.UI.lookups[n].elements,function(n){n.retrieve("spinner")&&n.retrieve("spinner").addClass("hidden")}.bind(this))},setError:function(n,t){Array.each(Affinity.UI.lookups[n].elements,function(n){n.retrieve("spinner")&&n.retrieve("spinner").addClass("hidden");n.retrieve("error")&&(n.get("data-lookup-error-str")&&n.get("data-lookup-error-str").trim()!==""?n.retrieve("error").set("html",n.get("data-lookup-error-str").trim()).removeClass("hidden"):n.retrieve("error").set("html",t).removeClass("hidden"))}.bind(this))},setElements:function(n){Array.each(Affinity.UI.lookups[n].elements,function(t){if(typeOf(t)!=="null"&&typeOf(t.get)==="function"&&t.get("data-lookup-api")){var i=this.filterSelect(t,Affinity.UI.lookups[n].data);this.populateSelect(t,i,n);t.erase("data-lookup-api")}}.bind(this))},filterSelect:function(n,t){var i=n.get("filter-option");return i?t.filter(function(n){return n.Value.indexOf(i)>-1}):t},populateSelect:function(n,t,i){var u,h,f=!1,r=n.get("data-default-value")||"",c=n.get("data-lookup-rules")?n.get("data-lookup-rules").split(","):[],v=n.getElements("option").length>0&&n.getElements("option")[0].get("html").trim()!=="",o,s,e,l,a;typeOf(t)==="array"&&(o=typeOf(t[0])!=="null"?t[0].Value:"",n.removeClass("lookup-loading"),Affinity.UI.lookups[i].massive||t.length>Affinity.selectmax?n.addClass("massive").store("data-store","lookups").store("data-key",i).store("data-value",r).store("data-label",r):(s={},e=n.getElements("option"),e&&e.length>0&&Array.each(e,function(n){s[n.get("value")]=n}),e=null,Array.each(t,function(t,i){u=!1;h=t.Value;s[t.Key]?u=s[t.Key]:c.contains("hasValue")?t.Value.trim()!==""&&(u=new Element("option",{value:t.Key,html:h})):u=new Element("option",{value:t.Key,html:h});u&&(t.Key==r?(u.set("selected","selected"),o=r,f=!0):c.contains("hasValue")&&r===""&&i===0&&(r=t.Key,u.set("selected","selected"),n.set("data-default-value",r),o=r,f=!0),!0&&n.adopt(u))})),l="UIAutoComplete"in window&&typeOf(window.UIAutoComplete)=="class"?!0:!1,a="UIAutoCompleteWidget"in window&&typeOf(window.UIAutoCompleteWidget)=="class"?!0:!1,!f&&r==""&&typeOf(t)=="array"&&t.length>0&&(f=!0),n.retrieve("spinner")&&n.retrieve("spinner").destroy(),n.removeClass("hidden"),t.length>=Affinity.selectToAutoNum&&l&&n.addClass("ui-autocomplete"),n.hasClass("ui-autocomplete")&&a&&(n.removeClass("ui-autocomplete"),new UIAutoCompleteWidget({selectElement:n})),!v&&n.retrieve("changetracker")&&n.retrieve("changetracker").setValue(n,r),f&&(n.get("onChange")||n.get("onchange")?n.onChange():n.fireEvent("change",{target:n})),n.fireEvent("lookupComplete",{defaultValue:r,value:o,target:n}));delete f;delete u;delete r}}),UITabs=new Class({Version:"1.0.0.0",File:"ui.tabs.js",Implements:[Options],Binds:["init","processNew"],options:{},initialize:function(n){this.setOptions(n);this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-tab-container"),function(n){if(!n.hasClass("ui-done")){n.addClass("ui-done");var t=n.getElements(".ui-tab");t.addClass("hidden");Array.each(n.getElements(".ui-tab-title"),function(n,i){n.store("tab",t[i]);n.addEvents({click:function(n){var t=n.target.hasClass("ui-tab-title")?n.target:n.target.getParent(".ui-tab-title");t.getParent(".ui-tab-container").getElements(".ui-tab-title").removeClass("selected");t.getParent(".ui-tab-container").getElements(".ui-tab").addClass("hidden");t.retrieve("tab").removeClass("hidden");t.addClass("selected")}})}.bind(this));n.getElement(".ui-tab-title").addClass("selected");n.getElement(".ui-tab").removeClass("hidden")}}.bind(this))}}),UITaxNumber=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},lists:{},initialize:function(n){this.setOptions(n);this.processNew()},processNew:function(){Array.each(document.getElements(".ui-taxnumber"),this.process)},process:function(n){n.removeClass("ui-taxnumber");new UITaxNumberWidget({element:n})}}),UITaxNumberWidget=new Class({Implements:[Options,Events],Binds:["taxFieldChange","currentLocation","taxFields","buildNZTax","buildAUTax","taxValidation","processValidation","processKeyUp","setFromInitialValue","copyToHidden","success","failed","revert","destroy"],options:{element:null,hasPayPoint:!0},element:null,type:"taxnumber",initialize:function(n){if(this.setOptions(n),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=this.originalElement.get("disabled")?!0:!1,this.options.element===null||typeOf(this.options.element)!=="element")throw"No valid element passed in, dummy";this.dropdownDiv=new Element("div",{"class":"countryselector"}).inject(this.originalElement,"before");this.dropdownDiv.set("tabindex",5e3);var t=this.originalElement.get("data-required");this.dropdown=t==="True"?new Element("select",{"class":"selector validate","data-validate-method":"taxNumberCountry"}).inject(this.dropdownDiv):new Element("select",{"class":"selector"}).inject(this.dropdownDiv);this.dropdownoption1=new Element("option",{html:"",value:""}).inject(this.dropdown);this.dropdownoption2=new Element("option",{html:"AU",value:"AU"}).inject(this.dropdownoption1,"after");this.dropdownoption3=new Element("option",{html:"NZ",value:"NZ"}).inject(this.dropdownoption2,"after");this.dropdown.value=this.originalElement.get("data-country");try{"hasPayPoint"in Affinity.CF&&(this.options.hasPayPoint=Affinity.CF.hasPayPoint)}catch(i){}this.options.hasPayPoint&&this.dropdown.addClass("subhidden");this.disabled?(this.countrySelectEl=new Element("input",{type:"text","class":"selector",disabled:"disabled",value:this.dropdown.value}).inject(this.dropdown,"after"),this.dropdown.destroy()):(this.countrySelectEl=this.dropdown,this.dropdown.onchange=this.taxFieldChange,window.addEvent("taxValidationReturned",this.processValidation));this.countrySelectEl.set("name",this.postname+"_country").set("id",this.postname+"_country");this.taxFields(this.currentLocation())},taxFieldChange:function(){this.element!=null&&this.element.destroy();var e,t,o,n,i,f,r,s,h,c,u;this.dropdown.getParent("form")&&(e=this.dropdown.getParent("form"),t=[],Array.each(e.getElements("input, select, textarea"),function(n){n.get("name")&&n.get("name").contains("TaxCode")&&t.push(n)}.bind(this)),t.length>0&&Array.each(t,function(t){o=t.get("data-display-id");n=t.retrieve("original-lookup-url");u=t.options[t.selectedIndex];s=Affinity.lookups.cancelQueue();h=Affinity.lookups.removeFromQueue(n,t,!0);r=this.dropdown.value;u.text.indexOf("- "+r)===-1&&(u=null);i=new URI(n);f=i.parsed.query.parseQueryString();f.payPointCountry=r;i.parsed.query=Object.toQueryString(f);n=i.toString();Affinity.lookups.addDefaultOption(t,u);Affinity.lookups.addFilterOption(t,"- "+r);c=Affinity.lookups.addToQueue(n,t);Affinity.lookups.refreshQueue();Affinity.lookups.processQueue()}.bind(this)));this.taxFields(this.currentLocation())},currentLocation:function(){return this.countrySelectEl?this.countrySelectEl.get("tag")==="select"?this.countrySelectEl.options[this.countrySelectEl.selectedIndex].value:this.countrySelectEl.value:"NZ"},taxFields:function(n){n==="NZ"?(this.buildNZTax(),this.originalElement.removeClass("hidden")):n==="AU"?(this.buildAUTax(),this.originalElement.removeClass("hidden")):(this.originalElement.value="",this.originalElement.addClass("hidden"),window.fireEvent("taxValidationError",{target:this.originalElement,silent:!0}))},buildNZTax:function(){this.element=new Element("div",{"class":"taxnumberbox ui-validate nz","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after");this.element.set("tabindex",5e3);this.taxNumberPart1=new Element("input",{"class":"tax1",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:" - "}).inject(this.element);this.taxNumberPart2=new Element("input",{"class":"tax2",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:" - "}).inject(this.element);this.taxNumberPart3=new Element("input",{"class":"tax3",type:"text",maxlength:"3"}).inject(this.element);this.tickcross=new Element("span",{"class":"tickcross font-icons color"}).inject(this.element);this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{"class":"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement),this.element.inject(this.hiddenWrapper,"before"));this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked));this.setFromInitialValue()},buildAUTax:function(){var n=this.originalElement.get("disabled")?!0:!1;this.element=new Element("div",{"class":"taxnumberbox ui-validate au","data-validate-method":"taxnumber"}).inject(this.dropdownDiv,"after");this.element.set("tabindex",5e3);this.taxNumberPart1=new Element("input",{"class":"tax1",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:" - "}).inject(this.element);this.taxNumberPart2=new Element("input",{"class":"tax2",type:"text",maxlength:"3"}).inject(this.element);new Element("span",{html:" - "}).inject(this.element);this.taxNumberPart3=new Element("input",{"class":"tax3",type:"text",maxlength:"3"}).inject(this.element);this.tickcross=new Element("span",{"class":"tickcross font-icons color"}).inject(this.element);this.hiddenWrapper?this.element.inject(this.hiddenWrapper,"before"):(this.hiddenWrapper=new Element("div",{"class":"subhidden"}).inject(this.originalElement,"after"),this.hiddenWrapper.adopt(this.originalElement),this.element.inject(this.hiddenWrapper,"before"));this.disabled?(this.taxNumberPart1.set("disabled","disabled"),this.taxNumberPart2.set("disabled","disabled"),this.taxNumberPart3.set("disabled","disabled"),this.tickcross.addClass("hidden")):(this.taxNumberPart1.onkeyup=this.processKeyUp,this.taxNumberPart2.onkeyup=this.processKeyUp,this.taxNumberPart3.onkeyup=this.processKeyUp,this.tickcross.set("html",Affinity.icons.Blocked));this.setFromInitialValue()},processKeyUp:function(){this.copyToHidden();this.taxValidation()},setFromInitialValue:function(){var n=this.hiddenWrapper.getElement("input").value;this.taxNumberPart3.value=n.substr(n.length-3);this.taxNumberPart2.value=n.substr(n.length-6,3);this.taxNumberPart1.value=n.replace(n.substr(n.length-6),"");this.taxValidation()},copyToHidden:function(){var n=this.taxNumberPart1.value!=""?this.taxNumberPart1.value:"",t=this.taxNumberPart2.value!=""?this.taxNumberPart2.value:"",i=this.taxNumberPart3.value!=""?this.taxNumberPart3.value:"",r=n+t+i;this.hiddenWrapper.getElement("input").value=r;this.hiddenWrapper.getElement("input").set("data-country",this.dropdown.value)},taxValidationDelay:!1,taxValidation:function(){clearTimeout(this.taxValidationDelay);this.taxValidationDelay=function(){var n=this.hiddenWrapper.getElement("input"),t=n.getParent("form"),i;t!=null&&t.retrieve("validation")&&(i=t.retrieve("validation"),i.validateTaxNumber(n,this.currentLocation(),n.get("name")))}.delay(500,this)},processValidation:function(n){var t=n.el,i=n.data;t===this.originalElement&&(i.success?this.success():t.value?this.failed():(window.fireEvent("taxValidationSuccess"),this.tickcross.set("html",Affinity.icons.Blocked),this.tickcross.removeClass("red"),this.tickcross.removeClass("green")))},success:function(){var n=this.tickcross;n.set("html",Affinity.icons.Tick);n.removeClass("red").addClass("green")},failed:function(){var n=this.tickcross;n.set("html",Affinity.icons.Cross);n.removeClass("green").addClass("red")},revert:function(){this.displayElement&&(this.displayElement.removeEvent("keyup",this.doKeyUp),this.iconElement.destroy(),this.displayElement.destroy());this.selectElement.inject(this.hiddenWrapper,"before");this.hiddenWrapper.destroy();this.selectElement.eliminate("widget");var n=this.selectElement;return Object.each(this,function(n){this[n]=null;delete this[n]}.bind(this)),n},destroy:function(){clearTimeout(this.checkExistsPeriodical);var n=this.revert();n.destroy()}}),UITextareaAutoSize=new Class({Implements:[Options],Binds:["processNew","process"],options:{postId:"",target:null},initialize:function(n){this.setOptions(n);this.processNew()},processNew:function(){Array.each(document.getElements(".ui-textarea-autosize"),this.process)},process:function(n){n.removeClass("ui-textarea-autosize");new UITextareaAutoSizeWidget({element:n})}}),UITextareaAutoSizeWidget=new Class({Implements:[Options,Events],Binds:["checkContent","hasContent","resize","revert","destroy"],options:{element:null},element:null,initialContent:!1,initialContentInterval:!1,initialize:function(n){if(this.setOptions(n),this.originalElement=this.options.element,this.postname=this.originalElement.get("name")||"",this.disabled=this.originalElement.get("disabled")?!0:!1,this.options.element===null||typeOf(this.options.element)!=="element")throw"No valid element passed in, dummy";this.originalElement.value===""?this.initialContentInterval=this.checkContent.periodical(100,this):this.hasContent()},checkContent:function(){this.originalElement.value!==""&&(clearInterval(this.initialContentInterval),this.hasContent())},hasContent:function(){clearInterval(this.initialContentInterval);this.initialHeight=this.originalElement.getSize().y;this.originalElement.addEvent("keyup",this.resize);this.resize()},resize:function(){var t=this.originalElement.getSize().y,n=this.originalElement.getScrollSize().y;n>t&&n>this.initialHeight&&this.originalElement.setStyle("height",n)},revert:function(){clearInterval(this.initialContentInterval);this.originalElement.removeEvent("keyup",this.resize);Object.each(this,function(n){this[n]=null;delete this[n]}.bind(this))},destroy:function(){this.revert()}}),UITimePickerWidget=new Class({Version:"1.0.0.0",File:"ui.time.picker.js",Implements:[Options,Events],options:{target:null,displayInput:!1,timeonly:!0,date:null,dateWidget:null,width:150,hoursmins:!1},Binds:["swapHours","swapMinutes","setAMPM","setAM","setPM","done","tileOver","tileOut","setMinute","swapHours","setHour","swapMinutes","setLastValue","attemptParse"],row:null,initialize:function(n){var t,i;this.setOptions(n);this.options.width<150&&(this.options.width=150);this.icons={};this.icons.done=Affinity.icons.Tick;this.target=this.options.target;this.timeTarget=new Element("div",{"class":"ui-calendar-time"}).setStyles({width:this.options.width}).inject(this.target);this.displayTarget=new Element("div",{"class":"ui-calendar-time-display",html:"<span><\/span>:<span><\/span> <span><\/span>"}).inject(this.timeTarget);this.displayTarget.set("reveal",{duration:250});this.containerBox=new Element("div",{"class":"ui-calendar-time-container"}).setStyles({width:this.options.width}).inject(this.timeTarget);this.containerBox.set("reveal",{duration:250});this.hoursTarget=new Element("div",{"class":"ui-calendar-time-circle hours"}).inject(this.containerBox);this.minutesTarget=new Element("div",{"class":"ui-calendar-time-circle minutes"}).inject(this.containerBox);this.hoursTarget.set("reveal",{duration:250});this.minutesTarget.set("reveal",{duration:250});this.minutesTarget.toggle();t=this.displayTarget.getElements("span");this.hourDisplay=t[0];this.minDisplay=t[1];this.ampmDisplay=t[2];delete t;this.doneButton=new Element("div",{"class":"button green w-icon done",html:"<span>"+this.icons.done+"<\/span> Done"}).inject(this.containerBox);this.amButton=new Element("div",{"class":"am",html:"am"}).inject(this.containerBox);this.pmButton=new Element("div",{"class":"pm",html:"pm"}).inject(this.containerBox);this.hourDisplay.addEvent(Affinity.events.click,this.swapHours);this.minDisplay.addEvent(Affinity.events.click,this.swapMinutes);this.options.hoursmins?(this.amButton.addClass("hidden"),this.pmButton.addClass("hidden"),this.ampmDisplay.addClass("hidden")):(this.ampmDisplay.addEvent(Affinity.events.click,this.setAMPM),this.amButton.addEvent(Affinity.events.click,this.setAM),this.pmButton.addEvent(Affinity.events.click,this.setPM));this.doneButton.addEvent(Affinity.events.click,this.done);this.size={x:170,y:170};this.width=this.size.x-50;this.height=this.width;this.radius=this.width/2;this.center=new Element("div",{"class":"circle-center"}).setStyles({top:this.size.x/2-15,left:this.options.width>150?this.size.x/2-15+(this.options.width-150)/2:this.size.x/2-15}).inject(this.containerBox,"top");this.marker=new Element("div",{"class":"circle-hover-marker"}).inject(this.containerBox,"top");this.marker.set("tween",{duration:250});this.marker.fade("hide");this.canvasOK=!0;this.canvas=new Element("canvas",{width:150,height:150}).setStyles({position:"absolute",top:0,left:this.options.width>150?(this.options.width-150)/2:0,width:150,height:150}).inject(this.containerBox,"top");try{this.canvasContext=this.canvas.getContext("2d")}catch(r){this.canvasOK=!1}this.canvasOK?(this.canvasContext.lineWidth=2,this.canvasContext.strokeStyle=this.center.getStyle("background-color")):this.canvas.destroy();i=new Element("div",{"class":"ui-calendar-time-circle-bg"}).inject(this.containerBox,"top");this.options.width>150&&i.setStyle("left",(this.options.width-150)/2);this.fireSet=!0;this.options.date===null||this.options.date===!1?(this.fireSet=!1,this.date=new Date,this.date.setSeconds(0),this.date.setMilliseconds(0)):this.date=this.options.date.clone();this.hour=this.date.getHours();this.minunte=this.date.getMinutes();this.ampm=this.hour>=12?"pm":"am";this.hoursTargetStatus="closed";this.minutesTargetStatus="closed";this.buildTimeElements();this.hide();this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.addEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.addEvent("focus",this.setLastValue),this.options.displayInput.addEvent("blur",this.attemptParse))},buildTimeElements:function(){var t=0,r,n,u=this.hoursTarget;for(n=3,i=0;i<12;i++)new Element("div",{html:n,"class":"time-circle-tile h-"+n}).inject(u),n++,n>=13&&(n=1),this.options.hoursmins&&n===12&&(n=0);for(r=this.hoursTarget.getElements("div"),t=0,step=2*Math.PI/r.length,Array.each(r,function(n){var u=n.getSize(),i=Math.round(this.width/2+this.radius*Math.cos(t)-10)+15,r=Math.round(this.height/2+this.radius*Math.sin(t)-10)+15;n.setStyles({left:i+"px",top:r+"px"});t+=step;n.addEvent(Affinity.events.overAll,this.tileOver);n.addEvent(Affinity.events.outAll,this.tileOut);n.addEvent(Affinity.events.click,this.setHour);n.addEvent(Affinity.events.click,this.swapMinutes)}.bind(this)),u=this.minutesTarget,n=15,i=0;i<60;i++)new Element("div",{html:n,"class":"time-circle-tile m-"+n}).inject(u),i+=4,n+=5,n>=60&&(n=0);r=this.minutesTarget.getElements("div");t=0;step=2*Math.PI/r.length;Array.each(r,function(n){var i=Math.round(this.width/2+this.radius*Math.cos(t)-10)+15,r=Math.round(this.height/2+this.radius*Math.sin(t)-10)+15;n.setStyles({left:i+"px",top:r+"px"});t+=step;n.addEvent(Affinity.events.overAll,this.tileOver);n.addEvent(Affinity.events.outAll,this.tileOut);n.addEvent(Affinity.events.click,this.setMinute);n.addEvent(Affinity.events.click,this.swapHours)}.bind(this))},setDisplayTime:function(){this.options.hoursmins?(this.hourDisplay.set("html",this.date.format("%H")),this.minDisplay.set("html",this.date.format("%M"))):(this.hourDisplay.set("html",this.date.format("%l")),this.minDisplay.set("html",this.date.format("%M")),this.ampmDisplay.set("html",this.date.format("%p").toLowerCase()));this.fireSet&&this.fireEvent("timeSet",this.date);this.fireSet=!0;this.options.timeonly&&this.displayTarget},setHour:function(n){this.hour=parseInt(n.target.get("html"));this.date.setHours(this.hour);this.setDisplayTime();this.hoursTarget.getElements(".active").removeClass("active");n.target.addClass("active")},setMinute:function(n){this.minunte=parseInt(n.target.get("html"));this.date.setMinutes(this.minunte);this.setDisplayTime();this.minutesTarget.getElements(".active").removeClass("active");n.target.addClass("active")},setAMPM:function(){this.containerBox.reveal();this.hourDisplay.removeClass("active");this.minDisplay.removeClass("active");this.ampmDisplay.addClass("active");this.ampm=="am"?this.setPM():this.setAM()},setAM:function(){this.hourDisplay.removeClass("active");this.minDisplay.removeClass("active");this.ampmDisplay.addClass("active");this.ampm="am";this.date.getHours()>=12&&this.date.setHours(this.date.getHours()-12);this.setDisplayTime()},setPM:function(){this.hourDisplay.removeClass("active");this.minDisplay.removeClass("active");this.ampmDisplay.addClass("active");this.ampm="pm";this.date.getHours()<12&&this.date.setHours(this.date.getHours()+12);this.setDisplayTime()},swapMinutes:function(){this.show();this.hourDisplay.removeClass("active");this.minDisplay.addClass("active");this.ampmDisplay.removeClass("active");this.hoursTargetStatus="closed";this.minutesTargetStatus="open";this.hoursTarget.dissolve();this.minutesTarget.reveal();this.marker.fade("out"),function(){this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))}.delay(300,this)},swapHours:function(){this.show();this.hourDisplay.addClass("active");this.minDisplay.removeClass("active");this.ampmDisplay.removeClass("active");this.hoursTargetStatus="open";this.minutesTargetStatus="closed";this.hoursTarget.reveal();this.minutesTarget.dissolve();this.marker.fade("out"),function(){this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active"))}.delay(300,this)},positionMarker:function(n){var t=n.getPosition(this.containerBox);this.marker.setPosition({x:t.x-4,y:t.y-4});this.marker.fade("in");delete t},tileOver:function(n){if(this.canvasOK){var t=this.center.getPosition(this.canvas),i=n.target.getPosition(this.canvas);this.canvasContext.clearRect(0,0,150,150);this.canvasContext.beginPath();this.canvasContext.moveTo(t.x+5,t.y+5);this.canvasContext.lineTo(i.x+10,i.y+10);this.canvasContext.stroke();delete t;delete i}},tileOut:function(){this.canvasOK&&this.canvasContext.clearRect(0,0,150,150);this.marker.fade("out");this.hoursTargetStatus=="open"&&this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active"));this.minutesTargetStatus=="open"&&this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))},show:function(){clearTimeout(this.autoHideDelay);this.options.hoursmins||(this.containerBox.reveal(),this.showDisplay(),this.fireEvent("open",this.date))},hide:function(){if(this.hourDisplay&&this.hourDisplay.removeClass("active"),this.minDisplay&&this.minDisplay.removeClass("active"),this.ampmDisplay&&this.ampmDisplay.removeClass("active"),this.options.timeonly){if(this.options.dateWidget)try{this.options.dateWidget.hide()}catch(n){}}else this.containerBox.dissolve()},showDisplay:function(){this.displayTarget.reveal()},hideDisplay:function(){this.displayTarget.dissolve()},done:function(){this.hide();this.fireEvent("timeSet",this.date);this.fireEvent("done",this.date)},setTime:function(n){this.date=n.clone();this.setDisplayTime()},getTime:function(){return this.date},lastValue:!1,setLastValue:function(){this.options.displayInput&&this.options.displayInput.get("tag")==="input"&&(this.lastValue=this.options.displayInput.value)},autoHideDelay:null,attemptParse:function(n){var s,h;if(clearTimeout(this.autoHideDelay),this.options.displayInput&&this.options.displayInput.get("tag")==="input"){var t=this.options.displayInput.value,f=!1,e=!1,u=!1,i,r,o;if(t=t.trim(),this.options.timeonly&&this.options.hoursmins){i=t.toLowerCase().replace(/m/," m ").replace(/h/," h ").split(/[^0-9mh]/i);i=i.filter(function(n){return n==="h"||n==="m"?n:!isNaN(parseFloat(n,10))});i.contains("m")&&!isNaN(i[i.indexOf("m")-1])&&(u=parseFloat(i[i.indexOf("m")-1],10),i.splice(i.indexOf("m"),1));i.contains("h")&&!isNaN(i[i.indexOf("h")-1])&&(e=parseFloat(i[i.indexOf("h")-1],10),i.splice(i.indexOf("h"),1));u||e?(i=[],e?i.push(e):i.push(0),u?i.push(u):i.push(0)):((t.charAt(0)===":"||t.charAt(0)===".")&&i.unshift(0),i.length===1&&(i[1]="0"));e=parseInt(i[0],10);u=parseInt(i[1],10);parseInt(e,10)>11&&(e="11");t.contains(".")&&(u=Math.round(parseFloat("0."+u)*60));parseInt(u,10)>59&&(e="59");t=(e+"").pad(2,"0","left")+":"+(u+"").pad(2,"0","left");try{f=Date.parse(t)}catch(c){f=!1}f&&typeOf(f)==="date"&&f.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=t),this.setTime(f))}else if(this.options.timeonly&&(t=t.replace(new RegExp(/[^0-9.\:]/gi),"")),t!==""){t.contains(":")?(i=t.split(":"),r=i[0],parseInt(r,10)>24&&(r="24"),parseInt(r,10)<0&&(r="00"),r=r.pad(2,"0","left"),o=i[1].pad(2,"0","right"),parseInt(o,10)>60&&(r="00"),parseInt(r,10)<0&&(r="00"),t=r+":"+o):t.contains(".")?(i=t.split("."),r=i[0],parseInt(r,10)>24&&(r="24"),parseInt(r,10)<0&&(r="00"),r=r.pad(2,"0","left"),o=i[1].pad(2,"0","right"),u=parseInt(o,10),u>99&&(u=0),u<0&&(u=0),o=(Math.round(60/100*u)+"").pad(2,"0","left"),t=r+":"+o):t.length===4?t=t.substring(0,2)+":"+t.substring(2):t.length>4?t=t.substring(0,2)+":"+t.substring(2,2):t.length<4&&(t.length===1&&(t="0"+t+"00"),t.length===2&&(t=t+"00"),t.length===3&&(t="0"+t),t=t.substring(0,2)+":"+t.substring(2));this.options.timeonly&&(s=parseInt(t.split(":")[0],10),h=parseInt(t.split(":")[1],10),s=s>24?0:s,h=h>59?0:h,t=(s+"").pad(2,"0","left")+":"+(h+"").pad(2,"0","left"));try{f=Date.parse(t)}catch(c){f=!1}f&&typeOf(f)==="date"&&f.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=t),this.setTime(f))}else this.lastValue&&(this.options.displayInput.value=this.lastValue)}n&&(typeOf(n)==="object"||typeOf(n)==="domevent")&&"type"in n&&n.type==="blur"&&(this.autoHideDelay=this.hide.delay(250,this))},destroy:function(){this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.removeEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.removeEvent("focus",this.setLastValue),this.options.displayInput.removeEvent("blur",this.attemptParse));this.hourDisplay.removeEvents();this.minDisplay.removeEvents();this.ampmDisplay.removeEvents();this.amButton.removeEvents();this.pmButton.removeEvents();this.doneButton.removeEvents();this.displayTarget.set("reveal",null);this.displayTarget.set("tween",null);this.containerBox.set("reveal",null);this.containerBox.set("tween",null);this.hoursTarget.set("reveal",null);this.hoursTarget.set("tween",null);this.minutesTarget.set("reveal",null);this.minutesTarget.set("tween",null);this.hourDisplay.destroy();this.minDisplay.destroy();this.ampmDisplay.destroy();this.amButton.destroy();this.pmButton.destroy();this.doneButton.destroy();this.canvasOK&&(this.canvas.destroy(),this.canvasContext=null);Array.each(this.hoursTarget.getElements("div"),function(n){n.removeEvents()}.bind(this));this.hoursTarget.empty();this.hoursTarget.destroy();Array.each(this.minutesTarget.getElements("div"),function(n){n.removeEvents()}.bind(this));this.minutesTarget.empty();this.minutesTarget.destroy();this.displayTarget.empty();this.displayTarget.destroy();Object.each(this,function(n,t){this[t]=null;delete this[t]}.bind(this))}}),UITooltips=new Class({Version:"1.0.2.0",File:"ui.tooltip.js",Implements:[Options],Binds:["processNew","init","processTooltip","removeTooltip","itemOver","itemOut"],options:{},initialize:function(n){this.setOptions(n);Affinity.UI.Tooltips={};Affinity.UI.Tooltips.Process=this.processNew;Affinity.UI.Tooltips.Remove=this.removeTooltip;Affinity.UI.Tooltips.Hide=this.hideAll;this.init()},processNew:function(){this.init()},init:function(){if(Affinity.helpbubble)Array.each(document.getElements(".ui-has-tooltip"),this.processTooltip.bind(this));else throw"UI Tooltips requires UI Help Bubble";},processTooltip:function(n,t){n.get("data-tooltip")&&(n.hasEvent(Affinity.events.overAll,this.itemOver)||(n.addEvent(Affinity.events.overAll,this.itemOver),n.addEvent(Affinity.events.outAll,this.itemOut),n.get("tag")==="input"&&n.addEvent("blur",this.itemOut)),typeOf(t)==="boolean"&&t&&this.itemOver({target:n}))},removeTooltip:function(n){n.removeClass("ui-has-tooltip");n.erase("data-tooltip");n.erase("data-tooltip-dir");n.removeEvent(Affinity.events.overAll,this.itemOver);n.removeEvent(Affinity.events.outAll,this.itemOut);n.get("tag")==="input"&&n.removeEvent("blur",this.itemOut)},itemOver:function(n){var f=n.target.hasClass("ui-has-tooltip")?n.target:n.target.getParent("ui-has-tooltip"),r;if(f&&(Affinity.helpbubble.populate(f.get("data-tooltip")),r=Affinity.helpbubble.getSize(),typeOf(r)==="object"&&"y"in r)){var s=f.get("data-tooltip-dir")?f.get("data-tooltip-dir").toLowerCase().trim():"right",o=document.getScrollSize(),i=f.getPosition(),e=f.getSize(),h=document.getScroll(),u,t={x:0,y:0};switch(s){case"top":u="bottom";t.x=i.x;t.y=i.y-r.y-10;break;case"bottom":u="top";t.x=i.x;t.y=i.y+r.y-5;break;case"right":u="left";t.x=i.x+e.x+5;t.y=i.y+e.y/2-20;break;case"left":u="right";t.x=i.x-r.x-5;t.y=i.y+e.y/2-20;break;case"top,left":u="bottom-right";t.x=i.x+e.x-r.x;t.y=i.y-r.y-10;break;case"top,right":u="bottom";t.x=i.x;t.y=i.y-r.y-10;break;case"bottom,left":u="top-right";t.x=i.x+e.x-r.x;t.y=i.y+r.y;break;case"bottom,right":u="top";t.x=i.x;t.y=i.y+r.y;break;case"top,center":u="bottom";t.x=i.x;t.y=i.y-r.y-10;break;case"bottom,center":u="top";t.x=i.x;t.y=i.y+r.y-5}Affinity.helpbubble.setDirection(u);t.x+r.x>o.x&&(t.x=o.x-r.x-5);t.y+r.y>o.y&&(t.y=o.y-r.y-5);Affinity.helpbubble.position(t);Affinity.helpbubble.show(f.hasClass("ui-tooltip-selectable")?!0:!1)}},itemOut:function(){Affinity.helpbubble.hide()},hideAll:function(){Affinity.helpbubble.hide()}}),UIUplaoders=new Class({Implements:[Options],Binds:["processUploaders","setFakeLabel"],options:{},uploaders:{},initialize:function(n){this.setOptions(n);this.processUploaders()},processNew:function(){processUploaders()},processUploaders:function(){if(this.ignoreUpload=!1,document.config.prettyuploads){var n=document.getElements(".upload");Array.each(n,function(n){var r,t,u,i;if(!n.hasClass("uidone")){n.addClass("uidone");r=n.getElement("input");r.fade("hide");t=new Element("label").inject(n);t.adopt(r);var f=new Element("span",{"class":"button blue",html:"Choose File"}).inject(t),e=new Element("span",{html:"","class":"uploadlabel hidden"}).inject(t),o=new Element("i",{html:" ","class":""}).inject(t,"after");n.get("data-show-delete")&&n.get("data-show-delete")=="true"&&(u=new Element("span",{"class":"button red",html:"Delete"}).inject(n),u.addEvent(Affinity.events.click,this.deleteFile));i=new Element("div",{html:"","class":"currentFileLabel"}).inject(n);n.getElement("input").addEvent("change",this.setFakeLabel);n.getElement("input").get("data-default-file-name")&&(n.getElement("input").get("data-default-file-path")?(i.set("html","Current File: "),new Element("a",{href:n.getElement("input").get("data-default-file-path"),html:n.getElement("input").get("data-default-file-name")}).inject(i)):i.set("html","Current File: "+n.getElement("input").get("data-default-file-name")))}}.bind(this));delete button}},deleteFile:function(){document.getElements(".uploadlabel").set("html","");document.getElements(".currentFileLabel").set("html","");document.getElementById("hiddenDeleteAttachment").set("value","true");document.getElementById("files").set("value","")},setFakeLabel:function(n){var t=n.target.value;t.contains("fakepath")&&(t=t.substring(n.target.value.indexOf("fakepath")+9));n.target.getParent().getLast("span").set("html",t)}}),UIUplaodersMulti=new Class({Version:"1.0.0.0",File:"ui.upload.multi.js",Implements:[Options,Events],Binds:["processNew","processUploader","addFile","addFileCont","addFileRow","deleteFile"],options:{auto:!0,maxsize:20971520,samenames:!0},uploaders:{},initialize:function(n){(this.setOptions(n),this.icons={},this.icons.del=Affinity.icons.CrossRound||"&#xe06d;",Affinity.prettyuploads)&&this.options.auto&&Array.each(document.getElements(".uploadmulti"),this.processUploader)},processNew:function(){Array.each(document.getElements(".uploadmulti"),this.processUploader)},processUploader:function(n){var t,e,f,i,o;if(Affinity.prettyuploads&&!n.hasClass("uidone")){n.store("count",1);t=new HtmlTable({properties:{"class":"ui-grid"},headers:["File",""],rows:[]});new Element("div",{"class":"upload-table hidden"}).adopt(t.element).inject(n);n.addClass("uidone");var s=n.hasClass("isrequired")?!0:!1,r=new Element("label").inject(n),u=n.get("data-question-name")+"_file0";n.getElement("input").set("name",u).set("id",u).addEvent("change",this.addFile).inject(r).fade("hide");e=new Element("span",{"class":"button blue"}).adopt(new Element("span",{"class":"icon-add-to-list"}),new Element("span",{html:"Add&nbsp;File"})).inject(r);new Element("span",{html:"","class":"uploadlabel"}).inject(r);f=n.getElement(".initialValues");f&&(i=f.value.trim(),i!==""&&(o=i.split(","),Array.each(o,function(n){this.addFileRow(t.element,n,n)}.bind(this)),window.fireEvent("multiFileDefaults",{initialValues:i,table:t.element})));delete t;delete r;delete u;delete e;delete i;Affinity.uiGrid.processTables(t.element)}},addFile:function(n){var t,i;if(n.stop(),t={},t.uploadInput=n.target,t.uploader=t.uploadInput.getParent(".uploadmulti"),t.table=t.uploader.getElement("table"),t.questionName=t.uploader.get("data-question-name"),t.filePath=t.uploadInput.value,t.fileName=t.filePath,t.count=t.uploader.retrieve("count")+1,t.inputId=t.questionName+"_file"+t.count,t.fileEventData={fileElement:t.uploadInput,questionName:t.questionName,table:t.table},t.filePath===""||typeOf(t.filePath)=="null"){delete t;return}if(t.uploadInput.files&&t.uploadInput.files[0].size>this.options.maxsize){window.fireEvent("multiFileTooLarge",{fileElement:t.uploadInput,maxsize:this.options.maxsize,size:t.uploadInput.files[0].size,table:t.table});t.uploadInput.value="";try{delete t.uploadInput.files}catch(n){}delete t;return}if(t.fileName.contains("fakepath")&&(t.fileName=t.fileName.substring(t.uploadInput.value.indexOf("fakepath")+9)),t.fileName.contains("/")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("/")+1)),t.fileName.contains("\\")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("\\")+1)),i=!1,Array.each(t.table.getElements("tr"),function(n){n.retrieve("fileName")&&n.retrieve("fileName").trim()===t.fileName.trim()&&(i=!0)}),i)if(this.options.samenames)uiconfirm({message:"You already have a file named '"+t.fileName+"'.<br />Would you like to continue anyway?",onOk:function(){this.addFileCont(n,t)}.bind(this),onCancel:function(){t.uploadInput.value="";try{delete t.uploadInput.files}catch(n){}delete t}.bind(this)});else{uialert({message:"Filenames must be different.<br />You already have a file with name '"+t.fileName+"'."});t.uploadInput.value="";try{delete t.uploadInput.files}catch(n){}delete t;return}else this.addFileCont(n,t)},addFileCont:function(n,t){n.stop();this.addFileRow(t.table,t.fileName,null,t.inputId);var i=t.table.getParent(".uploadmulti");t.uploadInput.set("class","").addClass("subhidden").set("name",t.inputId).set("id",t.inputId).removeEvents(),function(){t.uploadInput=t.uploadInput.clone().set("name",t.questionName+"_file0").set("id",t.questionName+"_file0").set("class","").addClass("new-master").inject(t.uploadInput,"before").fade("hide");t.uploadInput.removeEvents();t.uploadInput.addEvent("change",this.addFile);t.uploadInput.value="";t.uploader.store("count",t.count);window.fireEvent("multiFileAdded",t.fileEventData);i.fireEvent("multiFileAdded",t.fileEventData)}.delay(50,this);delete t},addFileRow:function(n,t,i,r,u){var e,f;e=i!==null?'<span class="button orange delete w-icon-only"><span>'+this.icons.del+"<\/span><\/span>":'<span class="button orange delete new w-icon-only"><span>'+this.icons.del+"<\/span><\/span>";n.retrieve("HtmlTable").push([t,e]);f=n.getElements("tbody tr").getLast();f.store("fileName",t);i!==null&&(f.store("fileId",i),f.addEvent("click",this.downloadFile.bind(this)),f.addClass("saved"));u&&(f.removeEvents(),f.getElement("td").empty(),new Element("a",{href:u,target:"_blank",html:t}).inject(f.getElement("td")));r!==null&&f.store("inputId",r);f.getElements(".delete").addEvent("click",this.deleteFile);Affinity.uiGrid.zebra(n);n.getParent().removeClass("hidden");delete e;delete f},deleteFile:function(n){var s,f;n.stop();var o=!1,h=n.target.hasClass("button")?n.target:n.target.getParent(".button"),u=n.target.getParent(".uploadmulti"),t=n.target.getParent("tr"),i=t.getParent("table"),e=u.get("data-question-name"),r=!1;t.retrieve("fileId")&&(r=t.retrieve("fileId"));h.hasClass("new")?(s=t.retrieve("inputId"),u.getElement("#"+s)&&u.getElement("#"+s).destroy()):(window.fireEvent("validateMultiFileDelete",{row:t,table:i,deletionTarget:{deleteName:f,deletedId:r,questionName:e,table:i}}),u.fireEvent("validateMultiFileDelete",{row:t,table:i,deletionTarget:{deleteName:f,deletedId:r,questionName:e,table:i}}),o=t.hasClass("preventDeletion"),o||(t.retrieve("fileId")&&(r=t.retrieve("fileId")),f=t.getElement("td").get("html"),window.fireEvent("multiFileDeleted",{deleteName:f,deletedId:r,questionName:e,table:i}),u.fireEvent("multiFileDeleted",{deleteName:f,deletedId:r,questionName:e,table:i}),delete r,delete f));o?t.removeClass("preventDeletion"):(t.destroy(),Affinity.uiGrid.zebra(i),i.getElements("tbody tr").length==0&&i.getParent().addClass("hidden"),delete h,delete u,delete t,delete i,delete e)},downloadFile:function(n){n.stop();var t=n.target.get("tag")=="td"?n.target:n.target.getParent("td"),i=t.getParent("tr").retrieve("fileId"),r=t.getParent("tr").retrieve("dowloadUrl");i&&r&&window.open(r+"?documentId="+i,"_blank")},setMaxSize:function(n){this.options.maxsize=n},reset:function(n){var t=!1,i=!1,r,u;if(typeOf(n)==="element"&&(n.hasClass("uploadmulti")&&(t=n),typeOf(n)==="element"&&n.get("type")&&(n.get("type")==="input"||n.get("type")==="file")&&(t=n.getParent(".uploadmulti"))),t&&t.getElement("label input")&&(i=t.getElement("label input")),t){if(r=t.getElement("table"),u=t.get("data-question-name"),Array.each(t.getElements("label input"),function(n){n!==i&&n.destroy()}),t.store("count",1),i&&(i.set("name",u+"_file0").set("id",u+"_file0").set("class",null).set("type","file").removeEvents().addEvent("change",this.addFile.bind(this)).fade("hide"),i.value="","files"in i))try{i.files=[]}catch(f){}r.getElement("tbody").empty();r.getParent().addClass("hidden")}}}),UIValidation=new Class({Version:"1.0.2.0",File:"ui.validation.js",Notes:"API Structure change",initialize:function(n){if(typeOf(n)==="object"&&(typeOf(n.target)=="element"||typeOf(n.target)=="form"))return new UIFormValidation(n);this.processNew()},processNew:function(){Array.each(document.getElements("form.validate-form"),function(n){n.retrieve("validation")||new UIFormValidation({target:n})}.bind(this))}}),UIFormValidation=new Class({Implements:[Options],Binds:["disable","enable","ignoreRequired","doRequired","submitButtonMouseDown","validateForm","validate","processForm","validateForm","processErrors","validateElement","processError","validateHasvalue","validateSentence","validateString","validateNumber","validateInt","validateFloat","validateCurrency","validateEmail","validateChecked","validateMultiChecked","validateRadioSelected","validateLength","validateRange","validateDate","validateLinked","validateNomatch","validateUrl","validateFile","checkNum","validateBankNumber","validateTaxCode","validateTaxNumber","validateTaxNumberCountry","validateBankNumberCountry"],options:{target:null,onPost:null,onValidateCallback:null,onValidateFailCallback:null},approvedElements:["input","textarea","select"],approvedValidations:["file","banknumber","bankNumber","taxcode","taxnumber","taxNumber"],initialize:function(n){this.setOptions(n);this.options.target.retrieve("validation")&&this.options.target.retrieve("validation").destroy();this.options.target.store("validation",this);this.options.target.addEvent("submit",this.validateForm);Array.each(this.options.target.getElements('*[type="submit"]'),function(n){n.addEvent(Affinity.events.start,this.submitButtonMouseDown)}.bind(this));this.taxValidationRequests={};this.banknumValidationRequests={}},ignoreHasValue:!1,disaabled:!1,disable:function(){this.disaabled=!0},enable:function(){this.disaabled=!1},ignoreRequired:function(){this.ignoreHasValue=!0},doRequired:function(){this.ignoreHasValue=!1},destroy:function(){this.options.target.removeEvent("submit",this.validateForm);this.options.target.eliminate("validation");this.options=null},submitButtonMouseDown:function(n){var t=n.target.hasClass(".button")?n.target:n.target.get("tag")==="button"?n.target:n.target.getParent(".button")?n.target.getParent(".button"):n.target.getParent("button")?n.target.getParent("button"):!1;this.ignoreHasValue=!1;t&&t.hasClass("ignore-required")&&(this.ignoreHasValue=!0)},validateForm:function(n){this.disaabled||(n.preventDefault(),n.stopPropagation(),n.stop(),this.validate())},validate:function(){if(this.options.target===null)throw"Can not validate on no form";document.getElements(".error").removeClass("error");document.getElements(".errorstr").destroy();this.options.onPost&&typeOf(this.options.onPost)==="function"&&this.options.onPost();this.errors=[];Array.each(this.options.target.getElements(".validate"),this.validateElement);document.getElements(".validated").removeClass("validated");this.errors.length>0?this.processErrors():this.options.onValidateCallback&&typeOf(this.options.onValidateCallback)=="function"?this.options.onValidateCallback():this.options.target.submit()},processErrors:function(){var n;if(Array.each(this.errors,function(t){n=t[0];this.approvedElements.contains(n.get("tag"))&&n.addClass("error");t[0].getPrevious("label")&&(n=t[0].getPrevious("label"));t[0].getParent().hasClass("currencybox")&&(n=t[0].getParent().getPrevious("label"));t[0].getParent().hasClass("countryselector")&&(n=t[0].getParent().getPrevious("label"));t[0].getParent().hasClass("subhidden")&&(n=t[0].getParent().getPrevious("label"));new Element("div",{"class":"errorstr",html:t[1]}).inject(n,"before");t[0].getParent(".form-row")&&t[0].getParent(".form-row").removeClass("valid").addClass("invalid")}.bind(this)),this.options.onValidateFailCallback&&typeOf(this.options.onValidateFailCallback)=="function")this.options.onValidateFailCallback(this.errors);delete n},processError:function(n,t){t.getAttribute("data-validate-error-str")&&(n=n+"<br />"+t.getAttribute("data-validate-error-str"));t.get("data-display-id")&&(t=document.id(t.get("data-display-id")));this.errors.contains([t,n])||this.errors.push([t,n])},validateElement:function(n){if(n.getAttribute("data-validate-method")&&(this.approvedElements.contains(n.get("tag"))||this.approvedValidations.contains(n.get("data-validate-method")))){var t,i,r=n.getAttribute("data-validate-method").split(",");Array.each(r,function(r){t="validate"+r.capitalize();i=typeOf(this[t])=="function"?!0:!1;i&&(n.getParent(".form-row")&&n.getParent(".form-row").removeClass("invalid").addClass("valid"),t==="validateTaxNumber"||t==="validateBankNumber"||this[t](n))}.bind(this))}},validateHasvalue:function(n){if(!this.ignoreHasValue&&typeOf(n)=="element"){if(n.hasClass("hidden"))return;if(typeOf(n.value)!=="null"){if(n.value!=""&&n.value.trim()!=="")return;this.processError("This must have a value",n)}}},validateSentence:function(n){var i=new RegExp(/^[a-zA-Z0-9_\-.,:;'\"!?@#$%\*\/\\|()\s]*$/g),t;n.value.length>0&&(i.test(n.value)||(t=255,t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):t,t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):t,t=parseInt(t)||255,n.value.length>t?this.processError("The text is too large. The maximum length allowed is 255 characters.",n):this.processError("Some of the symbols used are invalid (ok symbols: . , _ - ; : ( ) ? $ * % @ # ! \\ ' \" )",n)))},validateString:function(n){var t=new RegExp(/^[A-Za-z0-9_\-.]+$/g);n.value.length>0&&(t.test(n.value)||this.processError("This may not have spaces and can only have numbers, letters and some symbols (ok symbols: _ - . )",n))},validateNumber:function(n){var t=2147483647,i=new RegExp(/^[-+]?[0-9,.]+$/g);if(n.value.length>0){if(parseInt(n.value.replace(/[^0-9.]/g,""))>t){this.processError("Number values can be no greater than "+t,n);return}i.test(n.value)||this.processError("This must only be numbers and may have commas and points",n)}},validateInt:function(n){var t=2147483647,i=-2147483647,r=new RegExp(/^[-+]?[0-9]+$/g);if(n.value.length>0){if(parseInt(n.value)>t){this.processError("Int values can be no greater than "+t,n);return}if(parseInt(n.value)<i){this.processError("Int values can be no smaller than "+i,n);return}r.test(n.value)||this.processError("This must be an integer value",n)}},validateFloat:function(n){var t=2147483647,i=-2147483647,r=new RegExp(/^[-+]?[0-9]*\.?[0-9]+$/g);if(n.value.length>0){if(parseFloat(n.value)>t){this.processError("Float values can be no greater than "+t,n);return}if(parseFloat(n.value)<i){this.processError("Float values can be no smaller than "+i,n);return}r.test(n.value)||this.processError("This must be a float value with maximum 5 decimal places",n)}},validateAlphanumeric:function(n){var t=new RegExp(/^[a-zA-Z0-9_\-.,:'!?$%\*\/\\|\s]+$/g);if(n.value.length>0){if(n.value.replace(/[^a-zA-Z]+/g,"")===""){this.processError("This must have letters",n);return}t.test(n.value)||this.processError("This must have letters and can have numbers, spaces and some symbols . , _ - : ? $ * % ! \\ / ' |",n)}},validateCurrency:function(n){var t=2147483647,i=-2147483647,r=new RegExp(/^\-?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1,5})?|(?:,[0-9]{3})*(?:\.[0-9]{1,5})?|(?:\.[0-9]{3})*(?:,[0-9]{1,5})?)$/g);if(n.value=n.value.replace(/\$|\s/gi,""),n.value.length>0){if(parseFloat(n.value.replace(/[^0-9.]/g,""))>t){this.processError("Currency values can be no greater than "+t,n);return}if(parseFloat(n.value.replace(/[^0-9.-]/g,""))<i){this.processError("Currency values can be no smaller than "+i,n);return}r.test(n.value)||this.processError("This must be a valid currency value (without the currency symbol). Eg:<br />123,456,789.12<br />OR<br />123456789.12<br />Mind your commas and decimals!<br />Up to 5 decimal places is permitted.",n)}},validateEmail:function(n){var t=new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);n.value.length>0&&(t.test(n.value)||this.processError("This must be a valid email address",n))},validateChecked:function(n){this.ignoreHasValue||n.get("type")!="checkbox"||n.checked||this.processError("This must be checked",n)},validateMultiChecked:function(n){this.ignoreHasValue||!n.hasClass("validated")&&n.get("type")=="checkbox"&&n.get("data-validation-multicheck-id")&&(n.checked||(checked=!1,Array.each(n.getParents("form")[0].getElements("input[type=checkbox]"),function(t){t.get("data-validation-multicheck-id")==n.get("data-validation-multicheck-id")&&t.checked&&(checked=!0);t.addClass("validated")}.bind(this)),checked==!1&&this.processError("One of these must be checked",n)))},validateRadioSelected:function(n){this.ignoreHasValue||!n.hasClass("validated")&&n.get("type")=="radio"&&n.get("name")&&(n.checked||(checked=!1,Array.each(n.getParents("form")[0].getElements("input[name="+n.get("name")+"]"),function(n){n.checked&&(checked=!0);n.addClass("validated")}.bind(this)),checked==!1&&this.processError("One of these must be selected",n)))},validateLength:function(n){if(n.value.length>0){var t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):!1,i=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):!1,r=n.getAttribute("data-validate-min")?n.getAttribute("data-validate-min"):!1;r&&n.value.length<parseInt(r)&&this.processError("This must be longer than "+r+"character(s)",n);i&&n.value.length>parseInt(i)&&this.processError("This must be shorter than "+i+" character(s)",n);t&&n.value.length<parseInt(t)&&this.processError("This must be at least "+t+" character(s)",n)}},validateRange:function(n){if(n.value.length>0){var t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):!1,i=n.getAttribute("data-validate-min")?n.getAttribute("data-validate-min"):!1;if(isNaN(n.value)){this.processError("This must be a number",n);return}t&&parseFloat(n.value)>parseFloat(t)&&this.processError("This must be less than or equal to "+t,n);i&&parseFloat(n.value)<parseFloat(i)&&this.processError("This must be greater than or equal to "+i,n)}},validateDate:function(n){n.value.length>0&&(Date.parse(n.value).isValid()||this.processError("This must be a valid date",n))},validateLinked:function(){},validateNomatch:function(n){var i,r,u,t=n.getParent(".default-form");n.get("data-validate-match")&&t.getElement("."+n.get("data-validate-match"))&&(i=n.value,r=t.getElement("."+n.get("data-validate-match")).value,u=t.getElement("."+n.get("data-validate-match")).getParent(".form-row").getElement("label"),i===r&&this.processError("This must not match "+u.get("html").stripTags(),n))},validateUrl:function(n){if(n.value.startsWith("mailto:")){n.value=n.value.substring(7);this.validateEmail(n);n.value="mailto:"+n.value;return}var t=new RegExp(/(http|ftp|https|ftps):\/\/+([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?/);n.value.length>0&&(t.test(n.value)||this.processError("This must be a valid URL (try adding http:// to the start of the url)",n))},validateFile:function(n){var r,t,u,i;if(!this.ignoreHasValue){if(r=!1,typeOf(n)=="element"){if(u=n.getElements("input[type=file]"),u.length>0)for(t=0;t<u.length;t++)if(u[t].value!==""){r=!0;break}i=n.getElements("input.initialValues");try{if(i)if(typeOf(i)==="string")i.trim()!==""&&(r=!0);else if(i.length>0)for(t=0;t<i.length;t++)if(i[t].value!==null&&i[t].value!==""){r=!0;break}}catch(f){}}r||this.processError("You must upload a file",n)}},checkNum:function(n){if(isNaN(n))return!1},validateBankNumber:function(n,t,i){if(!this.ignoreHasValue){var r=this.banknumValidationRequests[i];r&&r.isRunning()&&r.cancel();this.banknumValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateBankNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("bankValidationSuccess"):window.fireEvent("bankValidationError");window.fireEvent("bankValidationReturned",{el:n,data:t})},onError:function(){window.fireEvent("bankValidationError")},onFailure:function(){window.fireEvent("bankValidationError")}}).post({BankNumber:n.value,CountryCode:t})}},validateTaxNumberCountry:function(n){if(!this.ignoreHasValue)return n.value.trim()===""?(this.processError("You must select a country",n),!1):void 0},validateBankNumberCountry:function(n){if(!this.ignoreHasValue)return n.value.trim()===""?(this.processError("You must select a country",n),!1):void 0},validateTaxNumber:function(n,t,i){if(!this.ignoreHasValue){var r=this.taxValidationRequests[i];r&&r.isRunning()&&r.cancel();this.taxValidationRequests[i]=new Request.JSON({url:Affinity.zelosroot+"/ValidateTaxNumber",method:"post",onSuccess:function(t){"success"in t&&t.success?window.fireEvent("taxValidationSuccess"):window.fireEvent("taxValidationError");window.fireEvent("taxValidationReturned",{el:n,data:t})},onError:function(){window.fireEvent("taxValidationError")},onFailure:function(){window.fireEvent("taxValidationError")}}).post({TaxNumber:n.value,CountryCode:t})}},validateText:function(n){var i=new RegExp(/^[a-zA-Z0-9_\-.,;'\"!?@#$\\|()\s]*$/g),t;n.value.length>0&&(i.test(n.value)||(t=255,t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):t,t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):t,t=parseInt(t)||255,n.value.length>t?this.processError("The text is too large. The maximum length allowed is 255 characters.",n):this.processError("You can only use these symbols: . , _ - ; ( ) ? $ @ # ! \\ ' \"",n)))}}),CFContentsTable=new Class({Implements:[Options],Binds:["processSection"],options:{},initialize:function(){new Element("a",{name:"#top"}).inject(document.body,"top");Array.each(document.getElements(".cf-contents-table.hidden"),function(n){new CFContentsTableComponent({element:n})})}}),CFContentsTableComponent=new Class({Implements:[Options],Binds:["processSection"],options:{element:null},initialize:function(n){this.setOptions(n);this.element=this.options.element;this.element.removeClass("hidden");this.sectionlist=this.element.getElement("ul");this.allrows=document.getElements(".form-row, .title-row");this.rowindex=this.allrows.indexOf(this.element);Array.each(document.getElements(".section"),this.processSection)},cleanName:function(n){return n=n.stripTags("span",!0).stripTags("div",!0).stripTags("a",!0).trim(),n.charAt(n.length-1)===":"&&(n=n.substring(0,n.length-1)),n},processSection:function(n){var u,t,i,r,f=n.getElements(".form-row, .title-row");f.length>0&&(Array.each(f,function(n){u=this.allrows.indexOf(n);u>this.rowindex&&(t=String.uniqueID(),n.hasClass("title-row")&&(i==null&&(i=new Element("ul")),new Element("a",{html:"Top",href:"#top","class":"anchor"}).inject(n),new Element("a",{name:t}).inject(n,"top"),i.adopt(new Element("a",{href:"#"+t,"class":"ui-contents-title"}).adopt(new Element("li",{html:this.cleanName(n.get("html"))})))),n.hasClass("form-row")&&(r=n.getElement("label,.label"),!r||r.hasClass("checkbox")||r.hasClass("radio")||(i==null&&(i=new Element("ul")),new Element("a",{name:t}).inject(n,"top"),i.adopt(new Element("a",{href:"#"+t}).adopt(new Element("li",{html:this.cleanName(r.get("html"))}))))))}.bind(this)),i!=null&&(t=String.uniqueID(),this.sectionlist.adopt(new Element("li").adopt(new Element("a",{href:"#"+t,"class":"ui-contents-section-title"}).adopt(new Element("li",{html:n.getElement(".section-header span").get("html")})),i)),new Element("a",{html:"Top",href:"#top","class":"anchor"}).inject(n.getElement(".section-header")),new Element("a",{name:t}).inject(n.getElement(".section-header"))));delete u;delete i;delete t;delete r;delete f}}),CFFormEdit=new Class({Implements:[Options],Binds:["onPost","validationFailed","taxValidationFail","taxValidationSuccess","bankValidationSuccess","bankValidationFail"],options:{instanceId:"",addFileApi:"",deleteFileApi:"",getFileNamesApi:"",downloadFileApi:""},taxFail:!1,bankFail:!1,initialize:function(n){this.setOptions(n);this.form=document.getElement("form");this.formMethod=this.form.get("method").toLowerCase();this.formAction=this.form.get("action");this.buttons=this.form.getElement(".buttons");this.loader=new Element("div",{"class":"formloader hidden"}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'}),new Element("span",{html:"Processing..."})).inject(this.buttons,"after");this.errorScroll=new Fx.Scroll(window);window.addEvent("taxValidationError",this.taxValidationFail);window.addEvent("taxValidationSuccess",this.taxValidationSuccess);window.addEvent("bankValidationError",this.bankValidationFail);window.addEvent("bankValidationSuccess",this.bankValidationSuccess);this.validation=new UIValidation({target:this.form,onPost:this.onPost,onValidateFailCallback:this.validationFailed.bind(this),onValidateCallback:this.submit.bind(this)});Array.each(document.getElements("input[type=text],button[type=password],textarea"),function(n){(n.value!=""||n.value=="NULL")&&(n.addClass("isnullable"),n.addEvent("blur",function(){this.value==""?this.addClass("isnull"):this.removeClass("isnull")}),this.value=="NULL"&&(this.value="",this.addClass("isnull")))}.bind(this));new CFMulitFileUploaders({instanceId:this.options.instanceId,addApi:this.options.addFileApi,deleteApi:this.options.deleteFileApi,getNamesApi:this.options.getFileNamesApi,downloadFileApi:this.options.downloadFileApi});var t,i;this.submitvalue=new Element("input",{type:"hidden"}).inject(document.getElement("form"));Array.each(document.getElements("input[type=submit],button[type=submit]"),function(n){this.submitvalue.set("name",n.name);t=new Element("span",{"data-value":n.get("value"),html:n.get("html")}).addEvent(Affinity.events.click,function(n){var t=n.target;this.submitvalue.value=t.get("data-value")?t.get("data-value"):t.getParent("span").get("data-value");this.buttons.addClass("hidden");this.loader.removeClass("hidden");this.submitvalue.value=="Save Form"?(this.validation.ignoreRequired(),this.validation.validate()):(this.validation.doRequired(),this.validation.validate())}.bind(this)).inject(n,"after");i=n.getProperties("id","class","name","data-tooltip","data-tooltip-dir");n.destroy();t.setProperties(i);t.addClass("button")}.bind(this));delete t;delete i;new CFContentsTable;window.addEvent("UiReady",function(){window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500)})},onPost:function(){document.getElements(".upload-table .notsaved").removeClass("notsaved");this.buttons.addClass("hidden");this.loader.removeClass("hidden")},validationFailed:function(){(function(){this.buttons.removeClass("hidden");this.loader.addClass("hidden");this.errorScroll.toElement(document.getElement(".errorstr").getParent(".form-row"))}).delay(1e3,this)},submit:function(){var t=!1,n,i;if(Array.each(Affinity.UI.lookupLoaders,function(n){t=t||n.running}.bind(this)),t){uialert({message:"You can't save or submit until all fields that auto-load data into the form have finished loading.",showButtons:!0});this.buttons.removeClass("hidden");this.loader.addClass("hidden");return}n="Click OK to submit this form instance.";i=Affinity.app==="MyDetails";i?n="OK, got that. Your changes will be visible soon. Check back later.":this.submitvalue.value==="Save Form"&&(n="Your form will be saved for later editing, but will not be submitted.");uialert({message:n,okText:"Ok",cancelText:"Cancel",showCancel:!i,onOk:function(){this.loader.removeClass("hidden");this.form.submit()}.bind(this),onCancel:function(){this.buttons.removeClass("hidden");this.loader.addClass("hidden")}.bind(this)})},taxValidationFail:function(){this.taxFail=!0},taxValidationSuccess:function(){this.taxFail=!1},bankValidationFail:function(){this.bankFail=!0},bankValidationSuccess:function(){this.bankFail=!1}}),CFFormTemplateCreate=new Class({Implements:[Options,Events],Binds:["areaSuccess","areaChanged","categorySuccess"],options:{getAreaApi:"",getCategoryApi:""},initialize:function(n){this.setOptions(n);new CFNameCreator({nameInput:document.getElement("#name"),fromInput:document.getElement("#desc")});this.areaDrop=document.id("cleverformAreaDrop");this.categoryDrop=document.id("cleverformCategoryDrop");this.areaDrop&&this.categoryDrop&&(this.areaDrop.addEvent("change",this.areaChanged),this.areaRequest=new CFRequest.JSON({url:this.options.getAreaApi,onSuccess:this.areaSuccess}).send(),this.categoryRequest=new CFRequest.JSON({url:this.options.getCategoryApi,onSuccess:this.categorySuccess}));window.fireEvent("ResizeFrame")},areaChanged:function(){this.categoryRequest.get({area:this.areaDrop.value})},areaSuccess:function(n){var r=document.id("cleverformAreaDrop").get("data-default-value"),t,i=!1;Array.each(n,function(n){t=new Element("option",{html:n,value:n});n==r&&(t.set("selected","selected"),i=!0);this.areaDrop.adopt(t)}.bind(this));i&&this.areaDrop.fireEvent("change");delete r;delete t;delete i},categorySuccess:function(n){var i=document.id("cleverformCategoryDrop").get("data-default-value"),t;this.categoryDrop.empty();this.categoryDrop.adopt(new Element("option",{html:"Make a selection",value:""}));Array.each(n,function(n){t=new Element("option",{html:n,value:n});n==i&&t.set("selected","selected");this.categoryDrop.adopt(t)}.bind(this));this.categoryDrop.removeClass("hidden");delete i;delete t}}),CFFormTemplateEdit=new Class({Implements:[Options,Events],Binds:["sortStart","sortSorted","sortComplete"],Options:{},initialize:function(){this.startlist=null;this.sortableSections=new Sortables([document.getElement(".from"),document.getElement(".to")],{clone:!0,handle:".grey",onStart:this.sortStart,onSort:this.sortSorted,onComplete:this.sortComplete});new CFNameCreator({nameInput:document.id("Name"),fromInput:document.id("Description")});window.fireEvent("ResizeFrame")},sortStart:function(n){this.startlist=n.getParent()},sortSorted:function(n){var i,t;n.getParent()!=this.startlist&&(i=n.getParent()==document.getElement(".from")?document.getElement(".to"):document.getElement(".from"),i.getElement(".temp")||(t=n.clone().inject(i),t.addClass("temp"),t.removeProperty("style"),t.setStyle("opacity",.5)),n.addClass("hidden"))},sortComplete:function(n){n.removeClass("hidden");document.getElement(".from .temp")&&document.getElement(".from .temp").destroy();document.getElement(".to .temp")&&document.getElement(".to .temp").destroy()}}),CFFormView=new Class({Implements:[Options],Binds:[],options:{instanceId:"",addFileApi:"",deleteFileApi:"",getFileNamesApi:"",downloadFileApi:""},initialize:function(n){this.setOptions(n);new CFMulitFileUploaders({instanceId:this.options.instanceId,addApi:null,deleteApi:null,getNamesApi:this.options.getFileNamesApi,downloadFileApi:this.options.downloadFileApi});new CFContentsTable;window.addEvent("UiReady",function(){window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500)})}}),CFformsAdminDelete=new Class({Implements:[Options,Events],Binds:["deleteClicked","processButton"],Options:{nameMaxLength:100},initialize:function(n){this.setOptions(n);this.processButton();var t=!1;Array.each(document.getElements("table .form-desc"),function(n){var i=n.get("html");i.length>this.options.nameMaxLength&&(n.set("data-tooltip",i),n.set("data-tooltip-dir","top"),n.set("html",i.substr(0,30)+" ..."),n.addClass("ui-has-tooltip"),t=!0)}.bind(this));t&&Affinity.tooltips.processNew();Array.each(document.getElements("table .form-workflow"),function(n){var t=n.get("html");t==""?n.set("html","No Workflow"):n.set("html",t.split(",").join(", "))}.bind(this))},deleteClicked:function(n){uiconfirm({message:"Are you sure you would like to delete this form instance?",onOk:function(){var t=n.target.hasClass("button")?n.target:n.target.getParent(".button"),i=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"instanceId",value:t.get("data-instanceId")}).inject(i);i.submit()}.bind(this)})},processButton:function(){Array.each(document.getElements(".button.delete"),function(n){n.addEvent(Affinity.events.click,this.deleteClicked)}.bind(this))}}),CFFormDesigner=new Class({Implements:[Options,Events],Binds:["itemPressed","itemOver","itemOut","draggerStart","onDragCalcIndex","draggerDroppped","draggerEnter","draggerLeave","dragCanceled","addNewSection","addSection","editSection","deleteSection","addNewItem","addItem","editItem","deleteItem","loadTemplate","templateLoaded","returnRankData","postRank","updateDashboardTemplateFlag"],singleUseElementTypes:["effectivedate"],options:{templateid:null,rankApi:null,itemDeleteApi:null,sectionDeleteApi:null,updateDashboardTemplateFlagUrl:null},dragger:null,sectionCount:0,initialize:function(n){this.setOptions(n);this.droppables=[];this.sections=document.getElements("#selectedFormItems .form-section");this.itemLists=document.getElements("#selectedFormItems .dragto");this.items=document.getElements("#selectedFormItems .form-item");this.droppables.combine(this.sections);this.droppables.combine(this.itemLists);this.templateId=document.id("TemplateId");this.dashboardTemplate=document.id("DashboardTemplate");this.dashboardTemplate.addEvent("change",this.updateDashboardTemplateFlag);var t;Array.each(document.getElements("#availableFormItems .form-element"),function(n){t=n.getElement(".form-element-title");window.mobile?n.addEvent(Affinity.events.start,this.itemPressed):n.getElements(".grey").addEvent(Affinity.events.start,this.itemPressed);window.mobile&&(n=t);n.addEvent(Affinity.events.overAll,this.itemOver);n.addEvent(Affinity.events.outAll,this.itemOut)}.bind(this));window.mobile?(this.sortableSections=new Sortables(document.id("selectedFormItems"),{clone:!0,handle:".grey",onStart:function(n,t){t.empty();t.set("class","form-element form-section draggable dragger");n.getElement(".blue").clone().inject(t);t.setStyles({"margin-left":n.getElement(".grey").getPosition(n).x,"margin-top":n.getElement(".grey").getPosition(n).y})},onComplete:this.postRank}),this.sortableItems=new Sortables(this.sections.getElements(".section-list"),{clone:!0,onStart:function(n,t){t.empty();t.set("class","form-element form-item draggable dragger");n.getElement(".blue").clone().inject(t);t.setStyles({"margin-left":n.getElement(".grey").getPosition(n).x,"margin-top":n.getElement(".grey").getPosition(n).y})},onComplete:function(n){n.removeClass("overtop");this.postRank()}.bind(this)})):(this.sortableSections=new Sortables(document.id("selectedFormItems"),{clone:!0,handle:".grey",onComplete:this.postRank,onStart:function(n,t){t.addClass("dragger")}}),this.sortableItems=new Sortables(this.sections.getElements(".section-list"),{clone:!0,handle:".grey",onStart:function(n,t){n.addClass("overtop");t.setStyle("opacity",.5);t.addClass("dragger")},onComplete:function(n){n.removeClass("overtop");this.postRank()}.bind(this)}),Array.each(this.itemLists.getElements(".grid-list"),function(n){new Sortables(n,{clone:!0,handle:".grey",onStart:function(n,t){n.addClass("overtop");t.setStyle("opacity",.5);t.addClass("dragger")},onComplete:function(n){n.removeClass("overtop");this.postRank()}.bind(this)})}.bind(this)));Array.each(this.items,function(n){n.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editItem);n.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteItem);n.set("data-form-label",n.getElement(".form-element-title").get("html"));n.set("data-form-name",n.getElement(".form-element-title").get("html").replace(/ /g,"").toLowerCase());this.sortableItems.addItems(n);this.singleUseElementTypes.contains(n.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+n.get("data-type").toLowerCase().trim()).addClass("disabled")}.bind(this));Array.each(this.sections,function(n){n.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editSection);n.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteSection);n.set("data-form-label",n.getElement(".form-element-title").get("html"));n.set("data-form-name",n.getElement(".form-element-title").get("html").replace(/ /g,"").toLowerCase());this.sortableItems.addItems(n)}.bind(this));this.templateRequest=new CFRequest.HTML({method:"get",onSuccess:this.templateLoaded});this.itemDeleteRequest=new CFRequest({url:this.options.itemDeleteApi,method:"post",onRequest:function(){},onSuccess:function(){},onFailure:function(){}});this.sectionDeleteRequest=new CFRequest({url:this.options.sectionDeleteApi,method:"post",onRequest:function(){},onSuccess:function(){},onFailure:function(){}});this.sendOrderRequest=new CFRequest({urlEncoded:!1,url:this.options.rankApi,method:"post",onRequest:function(){},onSuccess:function(){},onFailure:function(){}});this.sendOrderRequest.options.headers={"Content-type":"application/json; charset=utf-8"};this.sendOrderRequest.headers=this.sendOrderRequest.options.headers;this.sendOrderRequest.options.urlEncoded=!1;document.getElement(".col2 .section-list").setStyles({"min-height":document.getElement(".col1 .section-list").getSize().y-14});window.fireEvent("ResizeFrame")},itemOver:function(n){var t=n.target.hasClass("form-element")?n.target:n.target.getParents(".form-element")[0],i=t.getPosition();Affinity.helpbubble.populate(t.get("data-helptext"));Affinity.helpbubble.position({y:i.y+4,x:i.x+t.getSize().x+10});Affinity.helpbubble.show()},itemOut:function(){Affinity.helpbubble.hide()},itemPressed:function(n){var t,i,r,u;if(n.preventDefault(),n.stopPropagation(),this.dragger=null,document.getElements("drag-form-item")&&document.getElements("drag-form-item").destroy(),t=n.target.hasClass("draggable")?n.target:n.target.getParent(".draggable"),t.hasClass("disabled")){uialert({message:"This element can no longer be used.<br />This may be a single use element only and may already be in your form.",showButtons:!0,showLoader:!1});return}window.mobile?(this.dragger=t.getElement(".blue").clone().setStyles({position:"absolute",top:n.page.y-15,left:n.page.x-15}).inject(document.getElement("#availableFormItems")),this.dragger.addClass(t.get("class")+" dragger"),this.dragger.removeClass("light-shadow"),this.dragger.store("reference",t)):(this.dragger=t.clone().setStyles(t.getCoordinates()).setStyles({position:"absolute",opacity:.5}).inject(document.getElement("#availableFormItems")),this.dragger.addClass("drag-form-item dragger"),i=this.dragger.getSize(),this.dragger.setStyles({width:i.x-4+"px",height:i.y-4+"px"}),delete i);window.drageventFired=!0;r=this.dragger.hasClass("form-section")?".section-column.col2":this.droppables;u=window.mobile?function(n,t){window.mobileDragY=t.page.y}.bind(this):this.onDragCalcIndex;this.dropwhere="before";this.droppable=null;this.dropablelastindex=-1;this.droppableoffset=0;this.draggerrank=0;new Drag.Move(this.dragger,{droppables:r,onStart:this.draggerStart,onEnter:this.draggerEnter,onLeave:this.draggerLeave,onDrop:this.draggerDroppped,onCancel:this.dragCanceled,onDrag:u}).start(n)},draggerStart:function(){},draggerEnter:function(n,t){this.dragger&&t&&(t.getElement("ul").addClass("godrop"),this.droppable=t,this.indexMax=this.droppable.getElements(".form-element").length-1,n.get("data-type")=="section"?(this.droppableoffset=document.id("selectedFormItems").getPosition().y,this.draggertype="section",this.sectionPositions=[],Array.each(this.sections,function(n){this.sectionPositions.push({y:n.getPosition().y-this.droppableoffset,h:n.getSize().y,el:n})}.bind(this))):(this.draggertype="item",this.droppableoffset=t.getPosition().y))},onDragCalcIndex:function(n,t){if(this.droppable!=null){var r,u,i,f;this.draggertype=="item"?(r=window.mobile?window.mobileDragY-this.droppableoffset-55:t.page.y-this.droppableoffset-55,i=r/40,i=Math.floor(i),i=i>this.indexMax?this.indexMax:i,i=i<0?0:i,i>=0&&(i!=this.dropablelastindex||i==0)&&(this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop")),this.dropEl=this.droppable.getElements(".form-element")[i],this.dropEl&&(r<=20?(this.dropEl.addClass("overtop"),this.dropwhere="before",this.draggerrank=0):r>20&&(this.dropEl.addClass("over"),this.dropwhere="after",this.draggerrank=i+1),this.dropablelastindex=i))):this.draggertype=="section"&&(this.sectionPositions&&typeOf(this.sectionPositions)=="array"&&this.sectionPositions.length>0&&(u=this.sectionPositions[this.sectionPositions.length-1].h+this.sectionPositions[this.sectionPositions.length-1].y,r=t.page.y-this.droppableoffset,r>0&&r<u&&r%5==0?Array.each(this.sectionPositions,function(n,t){n.el.removeClass("over");n.el.removeClass("overtop");r>=n.y&&r<n.y+n.h/2?(this.dropEl=n.el,i=t,this.dropEl.addClass("overtop"),this.dropwhere="before",this.draggerrank=i):r>=n.y&&r<n.y+n.h&&(this.dropEl=n.el,i=t,this.dropEl.addClass("over"),this.dropwhere="after",this.draggerrank=i+1);this.dropablelastindex=this.draggerrank}.bind(this)):this.droppable!=null&&r<0?(i=this.draggerrank=this.dropablelastindex=0,this.dropEl=this.sectionPositions[i].el,this.dropwhere="before",this.dropEl.addClass("overtop")):this.droppable!=null&&r>u&&(i=this.draggerrank=this.dropablelastindex=this.sectionPositions.length-1,this.dropEl=this.sectionPositions[i].el,this.dropwhere="after",this.dropEl.addClass("over"))),delete r,delete u,delete i,delete f)}},draggerDroppped:function(n,t,i){if(window.mobile)this.onDragCalcIndex(n,i);this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop"));t!==null&&(n.hasClass("form-section")&&this.addNewSection(this.dragger),n.hasClass("form-item")&&(this.addNewItem(this.dragger,t.getElement("ul")),this.singleUseElementTypes.contains(this.dragger.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+this.dragger.get("data-type").toLowerCase().trim()).addClass("disabled")),t.getElement("ul").removeClass("godrop"));this.dragCanceled(n,null)},draggerLeave:function(n,t){this.draggertype=null;this.dropEl&&(this.dropEl.removeClass("over"),this.dropEl.removeClass("overtop"));t&&(t.getElement("ul").removeClass("godrop"),this.droppable=null,this.droppableoffset=0)},dragCanceled:function(n){this.draggertype=null;n.destroy();this.dragger=null;document.getElements("drag-form-item")&&document.getElements("drag-form-item").destroy()},addNewSection:function(n,t){t=this.dropEl?this.dropEl:t?t:document.id("selectedFormItems");var i=n.clone().removeProperty("style").removeClass("drag-form-item");this.dropEl?i.inject(this.dropEl,this.dropwhere):i.inject(t);this.sectionCount++;i.getElement(".form-element-title").set("html",i.getElement(".form-element-title").get("html")+" "+this.sectionCount);i.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editSection);i.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteSection);this.sortableSections.addItems(i);this.droppables.push(i);this.sortableItems.addLists(i.getElement(".section-list"));this.addSection(i);delete i},addSection:function(n){n=n.hasClass("form-section")?n:n.getParents(".form-section")[0];var t=new Element("div",{"class":"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(t);delete t;Affinity.modal.show(!1);document.callerElement=n;this.loadTemplate(n,!0,!0);window.fireEvent("ResizeFrame")},editSection:function(n){var t=n.target,i;t=t.hasClass("form-item")?t:t.getParents(".form-section")[0];i=new Element("div",{"class":"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(i);delete i;Affinity.modal.show(!1);document.callerElement=t;this.loadTemplate(t,!1,!0)},deleteSection:function(n,t){var r=n!=null?n.target:t,u,i;r.hasClass("form-section")||(r=r.getParents(".form-section")[0]);u=r.getElements("li");i=[];Array.each(u,function(n){i.push(n.getElement(".form-element-title").get("html").trim())});i.length>5&&(i=i.slice(0,5),i.push("..."));i=i.length>0?"This will delete all "+u.length+" elements in this section:<br /><br />"+i.join("<br />")+"<br /><br />":"This will delete this section. ";uiconfirm({message:i+"Continue?",onOk:function(){var n={};n.templateid=this.options.templateid;n.sectionname=r.get("data-item-name");r.getElements(".form-element").destroy();r.destroy();this.sectionDeleteRequest.post(n);delete n}.bind(this)})},addNewItem:function(n,t){typeOf(this.dropEl)!=="null"&&(t=this.dropEl);var i;i=n.retrieve("reference")?n.retrieve("reference").clone():n.clone().removeProperty("style").removeClass("drag-form-item");this.dropEl?i.inject(this.dropEl,this.dropwhere):i.inject(t);i.hasClass("dragto")&&(this.droppables.push(i),this.sortableItems.addLists(i.getElement(".grid-list")));this.sortableItems.addItems(i);i.getElement(".form-element-title").set("html","???");i.getElement(".form-element-edit").addEvent(Affinity.events.click,this.editItem);i.getElement(".form-element-close").addEvent(Affinity.events.click,this.deleteItem);this.addItem(i);delete i},addItem:function(n){n=n.hasClass("form-item")?n:n.getParents(".form-item")[0];var t=new Element("div",{"class":"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(t);delete t;Affinity.modal.show(!1);document.callerElement=n;this.loadTemplate(n,!0,!1);window.fireEvent("ResizeFrame")},editItem:function(n){var t=n.target,i;t=t.hasClass("form-item")?t:t.getParents(".form-item")[0];i=new Element("div",{"class":"spinnerbox large",html:'<img src="'+document.config.loaders.large.light+'" />'});Affinity.modal.setElement(i);delete i;Affinity.modal.show(!1);document.callerElement=t;this.loadTemplate(t,!1,!1)},deleteItem:function(n,t){var i=n!=null?n.target:t;i.hasClass("form-item")||(i=i.getParents(".form-item")[0]);uiconfirm({message:"Are you sure you want to delete this item?",onOk:function(){var n={};n.templateid=this.options.templateid;n.elementname=i.get("data-item-name");this.singleUseElementTypes.contains(i.get("data-type").toLowerCase().trim())&&document.getElement("#availableFormItems .master-"+i.get("data-type").toLowerCase().trim()).removeClass("disabled");this.itemDeleteRequest.post(n);i.destroy();delete n}.bind(this)})},loadTemplate:function(n,t,i){var r=t?n.get("data-template-load-create"):n.get("data-template-load-edit");i?r+="&sectionName="+n.get("data-item-name"):(t||(r+="&name="+n.get("data-item-name")),r+="&section="+n.getParents(".form-section")[0].get("data-item-name"));typeOf(this.draggerrank)!=="null"&&(r+="&rank="+this.draggerrank);r+="&ran="+(new Date).format("%s");this.templateItemName=n.get("data-template-type");this.templateRequest.options.url=r;this.templateRequest.send()},templateLoaded:function(n){Affinity.modal.setElement(new Element("div").adopt(n));Affinity.modal.show(!1),function(){document.uiHideToggle&&(document.uiHideToggle.processNew(),function(){Affinity.modal.position()}.delay(500));window.fireEvent("TemplateReady",{type:this.templateItemName})}.bind(this).delay(1e3,this)},returnRankData:function(){var t,n={};return n.TemplateId=this.options.templateid,n.Sections={},Array.each(document.getElements("#selectedFormItems .form-section"),function(i){n.Sections[i.get("data-item-name")]=[];t=n.Sections[i.get("data-item-name")];Array.each(i.getElements(".section-list .form-item"),function(n){t.push(n.get("data-item-name"))}.bind(this))}.bind(this)),delete t,JSON.stringify(n)},postRank:function(){this.sendOrderRequest.post(this.returnRankData())},updateDashboardTemplateFlag:function(){new CFRequest.JSON({url:this.options.updateDashboardTemplateFlagUrl,method:"POST",onSuccess:function(){},onError:function(){uialert({message:"Sorry, an error occurred while processing your request.",showLoader:!1,showButtons:!0,noClose:!1})}}).post({templateId:this.templateId.value,dashboardTemplate:this.dashboardTemplate.get("checked")})}}),CFInbox=new Class({Implements:[Options,Events],Binds:["updateInbox","selectInbox","deleteForm","startNewForm","formSelected"],options:{editUrl:"/Instance/Edit/",deleteUrl:"/Inbox/Delete/",viewUrl:"/Instance/View/",expireTabCookie:!1,expireTabMins:10},initialize:function(n){var t,i,r;this.setOptions(n);this.icons={};this.icons.edit=Affinity.icons.Pencil||"&#xe0fd;";this.icons.del=Affinity.icons.CrossRound||"&#xe06d;";this.icons.view=Affinity.icons.Page||"&#xe086;";this.labels={edit:"Edit",view:"View","delete":"Are you sure you want to delete this form?",deleting:"Deleting form. Please wait"};this.options.hasOwnProperty("labels")&&Object.each(this.options.labels,function(n,t){this.labels[t]=n}.bind(this));document.getElement(".button.startnew").addEvent(Affinity.events.click,this.startNewForm);Array.each(document.getElements(".delete"),function(n){n.addEvent(Affinity.events.click,this.deleteForm)}.bind(this));this.inbox=document.getElement(".ui-inbox");this.inboxid=this.inbox.get("id");t=this.inbox.getElements(".ui-inbox-box");this.toActionBox=t[0];this.inProgressBox=t[1];this.completedBox=t[2];i=this.inbox.getElements(".ui-inbox-labels .indicator");this.toActionIndicator=i[0];this.inProgressIndicator=i[1];this.completedIndicator=i[2];r=parseInt(Cookie.read("uiInboxIndex"));r&&Affinity.uiInbox.selectBox(this.inbox.getElements(".ui-inbox-labels ul li")[r]);window.addEvent("inboxUpdated",this.updateInbox);window.addEvent("inboxSelected",this.selectInbox);window.fireEvent("ResizeFrame")},lastdata:{},updateInbox:function(n){var r,t,u,i=[];n.elementid==this.inboxid&&(typeOf(this.lastdata.ToAction)==="null"&&(this.lastdata.ToAction={}),this.toActionIndicator.set("html",n.data.ToActionCount),this.lastdata.ToAction!=n.data.ToAction&&(n.data.ToActionCount==0?(this.toActionBox.getElement(".empty").removeClass("hidden"),this.toActionBox.getElements(".form").destroy()):(this.toActionBox.getElement(".empty").addClass("hidden"),this.toActionBox.getElements(".form").addClass("checking"),Array.each(n.data.ToAction,function(n){this.toActionBox.getElement("#"+n.InstanceId)?(t=this.toActionBox.getElement("#"+n.InstanceId),i=t.getElements("td"),i[1].set("html",n.StateName),i[2].set("html",n.StateEnteredAt),t.removeClass("checking")):(n.DisplayName+=n.ShareOrDelegate!=null?'<span class="tag '+n.ShareOrDelegate.toLowerCase()+'">'+n.SharedBy+"<\/span>":"",u=n.IsStarted?new Element("td",{"class":"ui-inbox-actions buttons",html:'<a href="'+this.options.editUrl+"/"+n.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.edit+"<\/span>"+this.labels.edit+'<\/span><\/a><span class="button red w-icon-only delete" data-delete-action="'+this.options.deleteUrl+"/"+n.InstanceId+'"><span>'+this.icons.del+"<\/span><\/span>"}):new Element("td",{"class":"ui-inbox-actions buttons",html:'<a href="'+this.options.editUrl+"/"+n.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.edit+"<\/span>"+this.labels.edit+"<\/span><\/a>"}),t=new Element("tr",{id:n.InstanceId,"class":"form"}).adopt(new Element("td",{"class":"indicate none sort-by",html:n.DisplayName}),new Element("td",{"class":"sort-by",html:n.StateName}),new Element("td",{"class":"ui-inbox-date sort-by ui-format-date",html:n.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),u).inject(this.toActionBox.getElement("tbody")),n.IsStarted&&t.getElement(".delete").addEvent(Affinity.events.click,this.deleteForm))}.bind(this)),this.toActionBox.getElements(".checking").destroy()),r=this.toActionBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(r),Affinity.uiGrid&&Affinity.uiGrid.zebra(r),this.lastdata.ToAction=n.data.ToAction),typeOf(this.lastdata.InProgress)==="null"&&(this.lastdata.InProgress={}),this.inProgressIndicator.set("html",n.data.InProgressCount),this.lastdata.InProgress!=n.data.InProgress&&(n.data.InProgressCount==0?(this.inProgressBox.getElement(".empty").removeClass("hidden"),this.inProgressBox.getElements(".form").destroy()):(this.inProgressBox.getElement(".empty").addClass("hidden"),this.inProgressBox.getElements(".form").addClass("checking"),Array.each(n.data.InProgress,function(n){this.inProgressBox.getElement("#"+n.InstanceId)?(t=this.inProgressBox.getElement("#"+n.InstanceId),i=t.getElements("td"),i[1].set("html",n.StateName),i[2].set("html",n.StateAssigneeName),i[3].set("html",n.StateEnteredAt),t.removeClass("checking")):(n.DisplayName+=n.ShareOrDelegate!=null?'<span class="tag '+n.ShareOrDelegate.toLowerCase()+'">'+n.SharedBy+"<\/span>":"",t=new Element("tr",{id:n.InstanceId,"class":"form"}).adopt(new Element("td",{"class":"indicate none sort-by",html:n.DisplayName}),new Element("td",{"class":"sort-by",html:n.StateName}),new Element("td",{"class":"ui-inbox-date sort-by",html:n.StateAssigneeName}),new Element("td",{"class":"ui-inbox-date sort-by ui-format-date",html:n.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),new Element("td",{"class":"ui-inbox-actions buttons",html:'<a href="'+this.options.viewUrl+"/"+n.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.view+"<\/span>"+this.labels.view+"<\/span><\/a>"})).inject(this.inProgressBox.getElement("tbody")))}.bind(this)),this.inProgressBox.getElements(".checking").destroy()),r=this.inProgressBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(r),Affinity.uiGrid&&Affinity.uiGrid.zebra(r),this.lastdata.InProgress=n.data.InProgress),typeOf(this.lastdata.Completed)==="null"&&(this.lastdata.Completed={}),this.completedIndicator.set("html",n.data.CompletedCount>99?"99+":n.data.CompletedCount),this.lastdata.Completed!=n.data.Completed&&(n.data.CompletedCount==0?(this.completedBox.getElement(".empty").removeClass("hidden"),this.completedBox.getElements(".form").destroy()):(this.completedBox.getElement(".empty").addClass("hidden"),this.completedBox.getElements(".form").addClass("checking"),Array.each(n.data.Completed,function(n){this.completedBox.getElement("#"+n.InstanceId)?(t=this.completedBox.getElement("#"+n.InstanceId),i=t.getElements("td"),i[1].set("html",n.StateName),i[2].set("html",n.CompletedBy),i[3].set("html",n.StateEnteredAt),t.removeClass("checking")):(n.DisplayName+=n.ShareOrDelegate!=null?'<span class="tag '+n.ShareOrDelegate.toLowerCase()+'">'+n.SharedBy+"<\/span>":"",t=new Element("tr",{id:n.InstanceId,"class":"form"}).adopt(new Element("td",{"class":"indicate none sort-by",html:n.DisplayName}),new Element("td",{"class":"sort-by",html:n.StateName}),new Element("td",{"class":"sort-by",html:n.CompletedBy}),new Element("td",{"class":"ui-inbox-date sort-by ui-format-date",html:n.StateEnteredAt,"data-date-format":"%e.%m.%Y %l:%M%p"}),new Element("td",{"class":"ui-inbox-actions buttons",html:'<a href="'+this.options.viewUrl+"/"+n.InstanceId+'" id=""><span class="button blue w-icon"><span>'+this.icons.view+"<\/span>"+this.labels.view+"<\/span><\/a>"})).inject(this.completedBox.getElement("tbody")))}.bind(this)),this.completedBox.getElements(".checking").destroy()),Affinity.uiFormatDate.processNew(),r=this.completedBox.getElement("table"),Affinity.uiSortableGrid&&Affinity.uiSortableGrid.processTable(r),Affinity.uiGrid&&Affinity.uiGrid.zebra(r),this.lastdata.Completed=n.data.Completed),delete r);window.fireEvent("ResizeFrame")},selectInbox:function(n){var t=this.inbox.getElements(".ui-inbox-labels ul li").indexOf(n.menuItem);this.boxCookie=Cookie.write("uiInboxIndex",t,{duration:this.options.expireTabCookie?1/1440*this.options.expireTabMins:1});this.tabIndex=t;window.fireEvent("ResizeFrame")},deleteForm:function(n){var t=n.target.hasClass("button")?n.target:n.target.getParent(".button"),i=t.get("data-delete-action"),r=t.getParent("tr"),u=this.labels.delete,f=this.labels.deleting;uiconfirm({message:u,onOk:function(){window.uialert({message:f,showLoader:!0,noClose:!0});new CFRequest({method:"post",url:i,onSuccess:function(){Affinity.prompts.hide();r.destroy();Affinity.uiGrid.zebra();Affinity.uiInbox.refresh()}}).send()}})},startNewForm:function(){var n,t;Affinity.modal.setElement(document.getElement(".start-template").clone().removeClass("hidden"));Affinity.modal.modalbody.getElement(".cancel").addEvent(Affinity.events.click,function(){Affinity.modal.hide()});Affinity.modal.modalbody.getElement(".start").addEvent(Affinity.events.click,function(){Affinity.modal.modalbody.getElement(".start").addClass("hidden");new Element("img",{src:document.config.loaders.light,style:"display: inline-block; margin-right:20px;"}).inject(Affinity.modal.modalbody.getElement(".start"),"after")});Affinity.modal.scroll.disable();Affinity.modal.close.disable();Affinity.modal.show();Affinity.modal.modalbody.getElement(".do-autocomplete")&&(n=Affinity.modal.modalbody.getElement(".do-autocomplete"),n.removeClass("do-autocomplete"),t=new UIAutoCompleteWidget({selectElement:n,onComplete:function(){t.displayElement.focus()}}))},formSelected:function(){document.getElement(".content select").selectedIndex=Affinity.modal.modalbody.getElement("select").selectedIndex;Affinity.modal.hide()}}),CFMulitFileUploaders=new Class({Implements:[Options,Events],Binds:["fileAdded","fileDeleted","fileDefaultsLoaded","fileAddedComplete","fileTooLarge","deleteNotSaved"],options:{instanceId:null,addApi:"/document/Add",deleteApi:"/document/Delete",getNamesApi:"/document/GetFileIdNamePairs",downloadFileApi:"/document/Download"},initialize:function(n){this.setOptions(n);this.deleteMessage="Deleting File. Please wait...";window.addEvent("multiFileAdded",this.fileAdded);window.addEvent("multiFileTooLarge",this.fileTooLarge);window.addEvent("multiFileDeleted",this.fileDeleted);window.addEvent("multiFileDefaults",this.fileDefaultsLoaded)},fileTooLarge:function(n){var t=(n.maxsize/1048576).round(2),i=(n.size/1048576).round(2);window.uialert({message:"This file is too large. The maximum size is "+t+"MB and this file is "+i+"MB."})},fileAdded:function(){},fileDefaultsLoaded:function(n){this.table=n.table;new CFRequest.JSON({url:this.options.getNamesApi,onSuccess:function(t){var i=t;typeOf(i)=="string"&&(i=JSON.parse(i));Array.each(n.table.getElements("tbody tr"),function(n){i.data[n.retrieve("fileId")]&&(n.getElement("td").set("html",i.data[n.retrieve("fileId")]),n.store("dowloadUrl",this.options.downloadFileApi))}.bind(this));(this.options.deleteApi==""||this.options.deleteApi==null)&&(Array.each(n.table.getElements("tbody tr"),function(n){n.getElements("td").getLast().destroy()}),Array.each(n.table.getElements("thead tr"),function(n){n.getElements("th").getLast().destroy()}));(this.options.addApi==""||this.options.addApi==null)&&n.table.getParent(".uploadmulti").getElement(".button.green").destroy()}.bind(this)}).post({fileIds:n.initialValues})},fileDeleted:function(n){window.uialert({message:this.deleteMessage,noClose:!0});this.table=n.table;new CFRequest.JSON({url:this.options.deleteApi,onSuccess:function(t){this.posting=!1;Affinity.prompts.hide();t.Success?n.row&&n.row.destroy():window.uialert({message:"You are not allowed to delete this file."})}}).post({fileId:n.deletedId,questionName:n.questionName,instanceId:this.options.instanceId,isAuto:!1})}}),CFNameCreator=new Class({Implements:[Options],Binds:["createName"],options:{nameInput:null,fromInput:null,maxLength:64,suffix:"",extraEntropy:!1,camelCase:!0,onComplete:function(){}},initialize:function(n){this.setOptions(n);this.options.nameInput&&this.options.nameInput.value==""&&(this.options.fromInput.addEvent("keyup",this.createName),this.options.fromInput.addEvent("blur",this.createName))},createName:function(){var t=this.options.maxLength,n;t-=8;n=this.options.fromInput.value.replace(/[^\w\d ]/g,"").trim();n=n.length>t?n.lastIndexOf(" ",t)>-1?n.substring(0,n.lastIndexOf(" ",t)):n.substring(0,t):n;n=n+this.options.suffix;n=this.options.camelCase?n.replace(/(?:^\w|[A-Z]|\b\w)/g,function(n,t){return t==0?n.toLowerCase():n.toUpperCase()}).replace(/\s+/g,"").trim():n.replace(/\s+/g,"").trim();this.options.extraEntropy&&(n+="_"+String.uniqueID()+"_"+(new Date).getTime());this.options.nameInput.value=n;this.options.onComplete(n)}}),CFTemplateBase=new Class({Implements:[Options],Binds:["killPopup","initted","toggleExample","validationFailed","postForm","postSuccess","postError"],options:{templateCssClass:null,autoGenerateName:!0,nativePost:!1},popupElement:null,form:null,formMethod:null,formAction:null,callerItem:null,section:null,initialize:function(n){if(this.setOptions(n),this.options.templateCssClass==null){this.killPopup("There was an error adding this element type to the form.\r\n<!--\r\nNo templateCssClass was specified.\r\n-->");return}if(!document.callerElement){this.killPopup("There was an error adding this element type to the form.\r\n<!--\r\nNo selected item was specified (document.callerElement).\r\n-->");return}if(this.popupElement=document.getElement(".question-content."+this.options.templateCssClass),!this.popupElement){this.killPopup('You can not use this component in this form.\r\n<!--\r\nFound no popup content with class "question-content '+this.options.templateCssClass+'".\r\nPlease check Requests for 500 errors fetching element content.\r\n-->');return}if(!this.popupElement.getParent("form")){this.killPopup('You can not use this component in this form.\r\n<!--\r\nFound no form in popup content with class "question-content '+this.options.templateCssClass+'".\r\nPlease check Requests for 500 errors fetching element content.\r\n-->');return}if(this.form=this.popupElement.getParent("form"),this.formMethod=this.form.get("method").toLowerCase(),this.formAction=this.form.get("action"),this.options.nativePost?this.form.adopt(new Element("input",{type:"hidden",name:"ReturnPath",value:"referrer"})):(this.formPost=new CFRequest({url:this.formAction,method:this.formMethod,onSuccess:this.postSuccess,onError:this.postError,onFailure:this.postError}),this.formPost.setHeader("Accept","Accept:text/javascript, text/html, application/xml, text/xml, */*"),this.form.adopt(new Element("input",{type:"hidden",name:"ReturnPath",value:"default"}))),this.callerItem=document.callerElement,this.section=this.callerItem.getParents(".form-section")[0],this.creating=this.formAction.toLowerCase().indexOf("create")>-1,this.form.getElement(".cancel")&&this.form.getElement(".cancel").addEvent("click",function(n){n.preventDefault();Affinity.modal.hide();this.creating&&this.callerItem&&(document.getElement("#availableFormItems .master-"+this.callerItem.get("data-type").toLowerCase().trim()).removeClass("disabled"),this.callerItem.destroy())}.bind(this)),this.save=this.form.getElement("button.save"),this.cancel=this.form.getElement("button.cancel"),this.loader=new Element("div",{"class":"loader hidden"}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'}),new Element("span",{html:"Saving..."})).inject(this.cancel,"after"),this.save.addEvent(Affinity.events.click,function(){this.save.addClass("hidden");this.cancel.addClass("hidden");this.loader.removeClass("hidden")}.bind(this)),this.section&&(this.form.getElement("#hiddenSectionName").value=this.section.get("data-item-name")),this.form.getElement(".hideshowpreview")&&(this.form.getElement(".hideshowpreview").addEvent(Affinity.events.click,this.toggleExample),this.exampleFx=new Fx.Reveal(this.form.getElement(".preview"),{duration:250,mode:"vertical"}),this.form.getElement(".preview").setStyle("display","none"),this.form.getElement(".preview").removeClass("hidden")),this.options.autoGenerateName){var t="";this.options.templateCssClass.test("fielddisplay","gi")&&(t="-display");this.options.templateCssClass.test("fieldedit","gi")&&(t="-edit");new CFNameCreator({nameInput:this.form.getElement("#name"),fromInput:this.form.getElements("#text,#shorttext,#title")[0],suffix:t})}new UIFormValidation({target:this.form,onValidateCallback:this.postForm,onValidateFailCallback:this.validationFailed});this.form&&this.save&&this.save.removeClass("hidden");this.initted()},killPopup:function(n){uialert({message:n,showButtons:!0,noClose:!1});document.callerElement&&typeOf(document.callerElement)==="element"&&document.callerElement.destroy();Affinity.modal.clear();Affinity.modal.hide()},initted:function(){},toggleExample:function(n){n.preventDefault();this.exampleFx.toggle();var t=document.getElement("#preview-toggle-icon");t.hasClass("icon-arrow-line-down")?(t.addClass("icon-arrow-line-up"),t.removeClass("icon-arrow-line-down")):t.hasClass("icon-arrow-line-up")&&(t.addClass("icon-arrow-line-down"),t.removeClass("icon-arrow-line-up"))},validationFailed:function(){this.save.removeClass("hidden");this.cancel.removeClass("hidden");this.loader.addClass("hidden")},postForm:function(){var n={},t=this.form.getElements("input,select,textarea");Array.each(t,function(t){if(t.get("name"))if(t.get("type")=="checkbox")n[t.get("name")]=t.checked;else if(t.get("type")=="radio"){var r=this.form.getElements("input[name="+t.get("name")+"]"),i=null;Array.each(r,function(n){n.checked&&(i=n)}.bind(this));i!==null&&(n[i.get("name")]=i.value)}else n[t.get("name")]=t.value}.bind(this));n.type!==undefined&&(n.type==="FieldEdit"&&n.name.lastIndexOf("_")!==n.name.length-1?n.name=n.name+"_":n.type!=="FieldEdit"&&n.type!=="FieldDisplay"&&n.name.lastIndexOf("_")!==n.name.length-1&&(n.name=n.name+String.uniqueID()+"_"));this.name=n.name;this.options.nativePost?(this.form.getElement("#name").value=this.name,this.form.submit()):this.formMethod=="get"?this.formPost.get(n):this.formPost.post(n);delete n},postSuccess:function(){var n="";this.form.getElement("#title")?(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#title").value),n=this.form.getElement("#title").value):this.form.getElement("#shorttext")?(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#shorttext").value),n=this.form.getElement("#shorttext").value):this.form.getElement("#text")&&(this.callerItem.getElement(".form-element-title").set("html",this.form.getElement("#text").value),n=this.form.getElement("#text").value);this.callerItem.set("data-item-name",this.name);this.loader.addClass("hidden");Affinity.modal.hide()},postError:function(n){var t=!1,i="Something went wrong. This is most likely due to a naming conflict. Try changing the 'short display text'.";if(typeOf(n.response)=="string")try{t=JSON.decode(n.response)}catch(r){}else if(typeOf(n.responseText)=="string")try{t=JSON.decode(n.responseText)}catch(r){}typeOf(t.message)=="string"&&t.message!==""&&(i=t.message);typeOf(t.systemMessage)=="string"&&t.systemMessage!==""&&(i=t.systemMessage);window.uialert({message:i});this.save.removeClass("hidden");this.cancel.removeClass("hidden");this.loader.addClass("hidden")}});window.cfTemplateTypes={};window.addEvent("TemplateReady",function(n){window.cfTemplateTypes[n.type]!==null&&typeOf(window.cfTemplateTypes[n.type].object)==="class"&&(window.cfCurrentTemplateObject=new window.cfTemplateTypes[n.type].object({templateCssClass:window.cfTemplateTypes[n.type].name}),Affinity.tooltips.processNew())});CFindex=new Class({Implements:[Options,Events],Binds:["archiveClicked","archiveDeleteClicked","undoArchiveClicked"],Options:{nameMaxLength:100},initialize:function(n){var i,t;this.setOptions(n);Array.each(document.getElements(".button.archive"),function(n){n.addEvent(Affinity.events.click,this.archiveClicked)}.bind(this));Array.each(document.getElements(".button.archivedelete"),function(n){n.addEvent(Affinity.events.click,this.archiveDeleteClicked)}.bind(this));Array.each(document.getElements(".button.undoarchive"),function(n){n.addEvent(Affinity.events.click,this.undoArchiveClicked)}.bind(this));i=!1;Array.each(document.getElements("table .form-desc"),function(n){var t=n.get("html");t.length>this.options.nameMaxLength&&(n.set("data-tooltip",t),n.set("data-tooltip-dir","top"),n.set("html",t.substr(0,30)+" ..."),n.addClass("ui-has-tooltip"),i=!0)}.bind(this));i&&Affinity.tooltips.processNew();Array.each(document.getElements("table .form-workflow"),function(n){var t=n.get("html");t==""?n.set("html","No Workflow"):n.set("html",t.split(",").join(", "))}.bind(this));document.getElements(".button.locked").addEvent(Affinity.events.click,this.unlock);t=Affinity.CookieMonster.Read("undo-archive")||!1;t&&(Affinity.CookieMonster.Delete("undo-archive"),document.id(t)&&window.scrollTo(0,document.id(t).getPosition().y));window.fireEvent("ResizeFrame")},unlock:function(n){var t,i,r;n.control&&(t=n.target.getParent("tr"),t&&(i=t.getElement(".button.locked"),r=t.getElement(".button.archive"),i&&r&&(i.addClass("hidden"),r.removeClass("hidden"),function(){r.addClass("hidden");i.removeClass("hidden")}.delay(2e3))))},archiveClicked:function(n){uiconfirm({message:"Are you sure you would like to archive this form?",onOk:function(){var t=n.target.hasClass("button")?n.target:n.target.getParent(".button"),i=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-templateId")}).inject(i);i.submit()}.bind(this)})},undoArchiveClicked:function(n){var t=n.target.hasClass("button")?n.target:n.target.getParent(".button"),r=t.getParent(),i=new Element("form",{action:t.get("data-action"),method:"post",target:"_self"}).inject(r,"bottom");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-templateId")}).inject(i);uialert({message:"Restoring...",showLoader:!0,showButtons:!1});Affinity.CookieMonster.Write("undo-archive",t.get("data-templateId"));i.submit()},archiveDeleteClicked:function(n){uiconfirm({message:"Are you sure you would like to delete this archived form?",onOk:function(){var t=n.target.hasClass("button")?n.target:n.target.getParent(".button"),i=new Element("form",{action:t.get("data-delete-action"),method:"post",target:"_self"}).inject(t,"after");new Element("input",{type:"hidden",name:"templateId",value:t.get("data-delete-id")}).inject(i);i.submit()}.bind(this)})}});CFInit=new Class({Implements:[Options,Events],Binds:["init"],Options:{},isProperBrowser:!0,parentWindow:null,initialize:function(n){this.setOptions(n);Browser.ie&&Browser.version<8&&(this.isProperBrowser=!1);this.isProperBrowser&&(this.parentWindow=window.parent.document)}});window.addEvent("PageReady",function(){document.cwInit=new CFInit}),function(){var n=function(n,t){n=="401 Unauthorized"?window.location.href="/Authentication/SignOut":t.parent(n)};window.CFRequest=new Class({Extends:Request,success:function(t){n(t,this)},failure:function(t){n(t,this)}});CFRequest.HTML=new Class({Extends:Request.HTML,success:function(t){n(t,this)},failure:function(t){n(t,this)}});CFRequest.JSON=new Class({Extends:Request.JSON,success:function(t){n(t,this)},failure:function(t){n(t,this)}});CFRequest.JSONP=new Class({Extends:Request.JSON,success:function(t){n(t,this)},failure:function(t){n(t,this)}})}();CFTemplateAddress=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n);Affinity.address.processNew()}});window.cfTemplateTypes.address={name:"address",objectname:"CFTemplateAddress",object:CFTemplateAddress};CFTemplateAttachInstructions=new Class({Extends:CFTemplateBase,Implements:[Options],options:{nativePost:!0},initialize:function(n){this.parent(n)},initted:function(){var n=new UIUplaoders}});window.cfTemplateTypes.attachinstructions={name:"attachinstructions",objectname:"CFTemplateAttachInstructions",object:CFTemplateAttachInstructions};CFTemplateBankNumber=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n);Affinity.banknumber.processNew()}});window.cfTemplateTypes.banknumber={name:"banknumber",objectname:"CFTemplateBankNumber",object:CFTemplateBankNumber};CFTemplateCheckbox=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.checkbox={name:"checkbox",objectname:"CFTemplateCheckbox",object:CFTemplateCheckbox};CFTemplateContentsTable=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){}});window.cfTemplateTypes.contentstable={name:"contentstable",objectname:"CFTemplateContentsTable",object:CFTemplateContentsTable};CFTemplateCurrency=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.currency={name:"currency",objectname:"CFTemplateCurrency",object:CFTemplateCurrency};CFTemplateDatePicker=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){new UIDateCalendar({dateMooFormat:"%d.%m.%Y"});document.id("showcalendar").addEvent(Affinity.events.click,this.setDateTimeType.bind(this));document.id("showtime").addEvent(Affinity.events.click,this.setDateTimeType.bind(this));document.id("setdefault").addEvent(Affinity.events.click,this.doSetDefaultValue.bind(this));this.doSetDefaultValue()},setDateTimeType:function(){var n="";document.id("showcalendar").checked&&(n+="date");document.id("showtime").checked&&(n+="time");n==""&&(n="date",document.id("showcalendar").checked=!0);document.id("DateTimeType").value=n},doSetDefaultValue:function(){document.id("SetDefaultvalue").value=document.id("setdefault").checked?"true":"false"}});window.cfTemplateTypes.date={name:"date",objectname:"CFTemplateDatePicker",object:CFTemplateDatePicker};CFTemplateDrawPanel=new Class({Extends:CFTemplateBase,options:{nativePost:!0},initialize:function(n){this.parent(n);Affinity.uiDrawPanels.processNew()},initted:function(){var n=new UIUplaoders}});window.cfTemplateTypes.drawpanel={name:"drawpanel",objectname:"CFTemplateDrawPanel",object:CFTemplateDrawPanel};CFTemplateEffectiveDate=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n);Affinity.uiDateCalendar.processNew()}});window.cfTemplateTypes.effectivedate={name:"effectivedate",objectname:"CFTemplateEffectiveDate",object:CFTemplateEffectiveDate};CFTemplateEmail=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.email={name:"email",objectname:"CFTemplateEmail",object:CFTemplateEmail};CFTemplateExplanation=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){this.form.getElement("select")&&this.form.getElement(".helpBubble.explain")&&this.form.getElement("select").addEvent("change",function(){this.form.getElement(".helpBubble.explain").removeClass("top");this.form.getElement(".helpBubble.explain").removeClass("left");this.form.getElement(".helpBubble.explain").removeClass("bottom");this.form.getElement(".helpBubble.explain").removeClass("right");this.form.getElement("select").value!="none"&&this.form.getElement(".helpBubble.explain").addClass(this.form.getElement("select").value)})}});window.cfTemplateTypes.explanation={name:"explanation",objectname:"CFTemplateExplanation",object:CFTemplateExplanation};CFTemplateFielddisplay=new Class({Extends:CFTemplateBase,Binds:["populateFieldDisplayFields","getFieldEditFields","setFieldName"],options:{autoGenerateName:!0},area:null,category:null,initialize:function(n){this.parent(n)},initted:function(){this.area=document.area;this.category=document.category;this.fieldDisplayFieldsLoader=document.id("fieldDisplayFieldsLoader");new Element("span",{html:'<img src="'+document.config.loaders.light+'" />'}).inject(this.fieldDisplayFieldsLoader);this.fieldDisplayFields=document.id("fieldDisplayFields");this.fieldDisplayFields.addClass("hidden");this.fieldDisplayFields.addEvent("change",this.setFieldName);this.getDisplayFieldsRequest=new CFRequest.JSON({url:this.fieldDisplayFields.get("data-lookup-method")+"?area="+this.area+"&category="+this.category+"&parameter=",onSuccess:this.populateFieldDisplayFields}).send()},keywordDict:{Double:"float number (allows decimals and comas)",Float:"float number (allows decimals and comas)",DateTime:"date",Int:"int number (no decimals)",Lookup:"dropdown box of choices"},getKeyword:function(n){return this.keywordDict[n]?this.keywordDict[n]:n},populateFieldDisplayFields:function(n){var u,f,t,i,r;if(n.error){this.fieldDisplayFieldsLoader.destroy();u="";u=n.error.test(/.*area.*category.*not found/)?"The area and category were not found. Please try again.<!--"+n.error+"-->":"We could not fetch the required values. Please try again.<!--"+n.error+"-->";uialert({message:u});return}f=this.fieldDisplayFields.get("data-default-value");Array.each(n.Properties,function(n){t=[];t.push(n.PropertyName?n.PropertyName:"");t.push(n.ModelName?n.ModelName:",");t.push(n.Attribute.PropertyType?n.Attribute.PropertyType:"");t.push(n.Attribute.DataType?n.Attribute.DataType:"");t.push(n.Attribute.FieldDecimal?n.Attribute.FieldDecimal:"");t.push(n.Attribute.FieldPrecision?n.Attribute.FieldPrecision:"");i=t.join(",");r=new Element("option",{value:i,html:n.DisplayLabel+" ("+n.PropertyName+" from "+n.ModelName+")"});f!==""&&i!==""&&i.indexOf(f)===0&&r.set("selected","selected");this.fieldDisplayFields.adopt(r)}.bind(this));n.Properties.length>20&&typeOf(UIAutoComplete)=="class"&&(this.fieldDisplayFields.addClass("ui-autocomplete"),Affinity.uiAutoComplete.processNew());this.fieldDisplayFields.removeClass("hidden");this.fieldDisplayFieldsLoader.destroy();this.setFieldName(null);delete t;delete i;delete r},setFieldName:function(){if(this.fieldDisplayFields.value!=""){var n=this.fieldDisplayFields.value.split(",");this.form.getElement("#name").value=n[0];this.form.getElement("#FieldName").value=n[0];this.form.getElement("#ModelName").value=n[1];this.form.getElement("#PropertyType").value=n[2];this.form.getElement("#DataType").value=n[3];this.form.getElement("#FieldDecimal").value=n[4];this.form.getElement("#FieldPrecision").value=n[5];delete n}}});window.cfTemplateTypes.fielddisplay={name:"fielddisplay",objectname:"CFTemplateFielddisplay",object:CFTemplateFielddisplay};CFTemplateFieldEdit=new Class({Extends:CFTemplateBase,Binds:["populateFieldEditTables","getFieldEditFields","setFieldName"],options:{autoGenerateName:!1},area:null,category:null,initialize:function(n){this.parent(n)},initted:function(){this.area=document.area;this.category=document.category;this.explainBox=this.form.getElement(".explaination");this.fieldEditFieldsLoader=document.id("fieldEditFieldsLoader");new Element("span",{html:'<img src="'+document.config.loaders.light+'" />'}).inject(this.fieldEditFieldsLoader);this.fieldEditFields=document.id("fieldEditFields");this.fieldEditFields.addClass("hidden");this.fieldEditFields.addEvent("change",this.setFieldName);this.getTablesRequest=new CFRequest.JSON({url:this.fieldEditFields.get("data-lookup-method")+"?area="+this.area+"&category="+this.category+"&parameter=editable",onSuccess:this.populateFieldEditTables}).send()},keywordDict:{Double:"float number (allows decimals and comas)",Float:"float number (allows decimals and comas)",DateTime:"date",Int:"int number (no decimals)",Lookup:"dropdown box of choices",BankNumber:"set of bank number fields",Address:"set of address fields with Google Address lookup"},getKeyword:function(n){return this.keywordDict[n]?this.keywordDict[n]:n},populateFieldEditTables:function(n){if(n.error){this.fieldEditFieldsLoader.destroy();uialert({message:"We could not fetch the required values. Please try again.<!--"+n.error+"-->"});return}var u=this.fieldEditFields.get("data-default-value"),t,i,r;Array.each(n.Properties,function(n){t=[];t.push(n.PropertyName?n.PropertyName:"");t.push(n.ModelName?n.ModelName:",");t.push(n.Attribute.PropertyType?n.Attribute.PropertyType:"");t.push(n.Attribute.MinValue?n.Attribute.MinValue:"");t.push(n.Attribute.MaxValue?n.Attribute.MaxValue:"");t.push(n.Attribute.MinLength?n.Attribute.MinLength:"");t.push(n.Attribute.MaxLength?n.Attribute.MaxLength:"");t.push(n.Attribute.IsRequired?n.Attribute.IsRequired:"");t.push(n.Attribute.DataType?n.Attribute.DataType:"");t.push(n.Attribute.IsKeyField?n.Attribute.IsKeyField:"");t.push(n.Attribute.FieldDecimal?n.Attribute.FieldDecimal:"");t.push(n.Attribute.FieldPrecision?n.Attribute.FieldPrecision:"");i=t.join(",");r=new Element("option",{value:i,html:n.DisplayLabel+" ("+n.PropertyName+" from "+n.ModelName+")"});u!==""&&i!==""&&i.indexOf(u)===0&&r.set("selected","selected");this.fieldEditFields.adopt(r)}.bind(this));this.fieldEditFields.removeClass("hidden");this.fieldEditFieldsLoader.destroy();n.Properties.length>20&&typeOf(UIAutoComplete)=="class"&&(this.fieldEditFields.addClass("ui-autocomplete"),Affinity.uiAutoComplete.processNew());this.setFieldName(null);delete t;delete i;delete r},setExplaination:function(){var n="";this.form.getElement("#IsRequired").value==="true"?(this.form.getElement("#required").set("checked","checked"),this.form.getElement("#required").set("disabled","disabled"),n+="This field must have a value and has been set as required above.<br /><br />"):this.form.getElement("#required").erase("disabled");n+="This field will be displayed as a "+this.getKeyword(this.form.getElement("#PropertyType").value)+".";this.explainBox.set("html",n)},setFieldName:function(){if(this.explainBox.set("html",""),this.fieldEditFields.value!=""){var n=this.fieldEditFields.value.split(",");this.form.getElement("#name").value=n[0];this.form.getElement("#FieldName").value=n[0];this.form.getElement("#ModelName").value=n[1];this.form.getElement("#PropertyType").value=n[2];this.form.getElement("#MinValue").value=n[3];this.form.getElement("#MaxValue").value=n[4];this.form.getElement("#MinLength").value=n[5];this.form.getElement("#MaxLength").value=n[6];this.form.getElement("#IsRequired").value=n[7]||n[9]||!1;this.form.getElement("#DataType").value=n[8];this.form.getElement("#FieldDecimal").value=n[10];this.form.getElement("#FieldPrecision").value=n[11];this.setExplaination();delete n}}});window.cfTemplateTypes.fieldedit={name:"fieldedit",objectname:"CFTemplateFieldEdit",object:CFTemplateFieldEdit};CFTemplateFileUpload=new Class({Extends:CFTemplateBase,Binds:["loadDropTwoValues","secondDropSuccess"],initialize:function(n){this.parent(n)},initted:function(){var n=new UIUplaoders;this.dropOne=this.form.getElement("#DocumentCategory");this.dropTwo=this.form.getElement("#DocumentType");this.spinbox=new Element("div",{"class":"formloader hidden",styles:{display:"inline-block",margin:"0 0 0 10px"}}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'})).inject(this.dropTwo,"after");this.dropRequest=new CFRequest.JSON({url:this.dropOne.getAttribute("data-secondary-select-lookup"),method:this.dropOne.getAttribute("data-secondary-select-lookup-method")==null?"get":this.dropOne.getAttribute("data-secondary-select-lookup-method").toLowerCase(),onSuccess:this.secondDropSuccess,onError:function(){},onFailure:function(){}});this.dropOne.addEvent("change",this.loadDropTwoValues);this.loadDropTwoValues();Affinity.uiHidables.processTriggers()},loadDropTwoValues:function(){this.dropTwo.addClass("hidden");this.spinbox.removeClass("hidden");this.dropRequest.options.method=="post"?this.dropRequest.post({DocumentCategory:this.dropOne.value}):this.dropRequest.get({DocumentCategory:this.dropOne.value})},secondDropSuccess:function(n){this.dropTwo.empty();this.dropTwo.removeClass("hidden");this.dropTwo.erase("disabled");this.spinbox.addClass("hidden");var t=typeOf(this.dropOne.getAttribute("data-secondary-select-default"))!="null"?this.dropOne.getAttribute("data-secondary-select-default"):null;n.length==0?this.dropTwo.set("disabled","disabled"):(new Element("option",{value:"",html:"Any"}).inject(this.dropTwo),Array.each(n,function(n){option=new Element("option",{value:n.ID,html:n.Name}).inject(this.dropTwo);t!=null&&t==n.ID&&option.set("selected","selected")}.bind(this)))}});window.cfTemplateTypes.fileupload={name:"fileupload",objectname:"CFTemplateFileUpload",object:CFTemplateFileUpload};CFTemplateFileUploadMulti=new Class({Extends:CFTemplateBase,Binds:["fileAdded","fileDeleted","loadDropTwoValues","secondDropSuccess"],initialize:function(n){this.parent(n)},initted:function(){var n=new UIUplaodersMulti;this.dropOne=this.form.getElement("#DocumentCategory");this.dropTwo=this.form.getElement("#DocumentType");this.spinbox=new Element("div",{"class":"formloader hidden",styles:{display:"inline-block",margin:"0 0 0 10px"}}).adopt(new Element("span",{html:'<img src="'+document.config.loaders.light+'" />&nbsp;'})).inject(this.dropTwo,"after");this.dropRequest=new CFRequest.JSON({url:this.dropOne.getAttribute("data-secondary-select-lookup"),method:this.dropOne.getAttribute("data-secondary-select-lookup-method")==null?"get":this.dropOne.getAttribute("data-secondary-select-lookup-method").toLowerCase(),onSuccess:this.secondDropSuccess,onError:function(){},onFailure:function(){}});this.dropOne.addEvent("change",this.loadDropTwoValues);this.loadDropTwoValues();Affinity.uiHidables.processTriggers()},loadDropTwoValues:function(){this.dropTwo.addClass("hidden");this.spinbox.removeClass("hidden");this.dropRequest.options.method=="post"?this.dropRequest.post({DocumentCategory:this.dropOne.value}):this.dropRequest.get({DocumentCategory:this.dropOne.value})},secondDropSuccess:function(n){this.dropTwo.empty();this.dropTwo.removeClass("hidden");this.dropTwo.erase("disabled");this.spinbox.addClass("hidden");var t=typeOf(this.dropOne.getAttribute("data-secondary-select-default"))!="null"?this.dropOne.getAttribute("data-secondary-select-default"):null;n.length==0?this.dropTwo.set("disabled","disabled"):(new Element("option",{value:"",html:"Any"}).inject(this.dropTwo),Array.each(n,function(n){option=new Element("option",{value:n.ID,html:n.Name}).inject(this.dropTwo);t!=null&&t==n.ID&&option.set("selected","selected")}.bind(this)))}});window.cfTemplateTypes.fileuploadmulti={name:"fileuploadmulti",objectname:"CFTemplateFileUploadMulti",object:CFTemplateFileUploadMulti};CFTemplateFloat=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.float={name:"float",objectname:"CFTemplateFloat",object:CFTemplateFloat};CFTemplateGridFields=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.gridfields={name:"gridfields",objectname:"CFTemplateGridFields",object:CFTemplateGridFields};CFTemplateInteger=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.integer={name:"integer",objectname:"CFTemplateInteger",object:CFTemplateInteger};CFTemplateLink=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.link={name:"link",objectname:"CFTemplateLink",object:CFTemplateLink};CFTemplateMemo=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){Affinity.textAutoSize.processNew()}});window.cfTemplateTypes.memo={name:"memo",objectname:"CFTemplateMemo",object:CFTemplateMemo};CFTemplateMultiselect=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){Affinity.uiDynamicGrid.init({container:this.form});Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.multiselect={name:"multiselect",objectname:"CFTemplateMultiselect",object:CFTemplateMultiselect};CFTemplateParagraph=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){}});window.cfTemplateTypes.paragraph={name:"paragraph",objectname:"CFTemplateParagraph",object:CFTemplateParagraph};CFTemplateSection=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.formsection={name:"formsection",objectname:"CFTemplateSection",object:CFTemplateSection};CFTemplateSeparator=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){this.form.getElement("#name").value===""&&(this.form.getElement("#name").value="seperator_"+String.uniqueID()+"_"+(new Date).getTime())}});window.cfTemplateTypes.separator={name:"separator",objectname:"CFTemplateSeparator",object:CFTemplateSeparator};CFTemplateDropdown=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){Affinity.uiDynamicGrid.init();Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.singleselectdropdown={name:"singleselectdropdown",objectname:"CFTemplateDropdown",object:CFTemplateDropdown};CFTemplateRadioButton=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)},initted:function(){Affinity.uiDynamicGrid.init();Affinity.uiHidables.processTriggers()}});window.cfTemplateTypes.singleselectradio={name:"singleselectradio",objectname:"CFTemplateRadioButton",object:CFTemplateRadioButton};CFTemplateTaxNumber=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n);Affinity.taxnumber.processNew()}});window.cfTemplateTypes.taxnumber={name:"taxnumber",objectname:"CFTemplateTaxNumber",object:CFTemplateTaxNumber};CFTemplateText=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.text={name:"text",objectname:"CFTemplateText",object:CFTemplateText};CFTemplateTitle=new Class({Extends:CFTemplateBase,initialize:function(n){this.parent(n)}});window.cfTemplateTypes.title={name:"title",objectname:"CFTemplateTitle",object:CFTemplateTitle};CFTemplateYoutube=new Class({Extends:CFTemplateBase,Binds:["processYoutubeId","returnYoutbeId","returnYoutubeEmbed","testEmbed"],initialize:function(n){this.parent(n)},youtubeWidth:446,youtubeHeight:251,initted:function(){document.id("youtubeUrl")&&document.id("testYoutubeEmbed")&&document.id("youtubeId")&&(document.id("youtubeUrl").addEvent("keyup",function(){document.id("youtubeId").value=this.processYoutubeId(document.id("youtubeUrl"),document.id("testYoutubeEmbed"))}.bind(this)),document.id("youtubeId").value!=""&&(document.id("youtubeUrl").value="http://www.youtube.com/watch?v="+document.id("youtubeId").value,this.processYoutubeId(document.id("youtubeUrl"),document.id("testYoutubeEmbed"))))},processYoutubeId:function(n,t){var i=this.returnYoutbeId(n.value),r;return i?(r=this.returnYoutubeEmbed(i),this.testEmbed(t,r),i):""},returnYoutbeId:function(n){if(n=="")return!1;var t=n.match(/^.*((youtu.be\/)|(v\/)|(\/u\/\w\/)|(embed\/)|(watch\?))\??v?=?([^#\&\?]*).*/);return t&&t[7].length>=11?t[7]:!1},returnYoutubeEmbed:function(n){return new Element("iframe",{width:this.youtubeWidth,height:this.youtubeHeight,src:"//www.youtube.com/embed/"+n+"?autoplay=0&controls=1&rel=0&showinfo=0&theme=light&modestbranding=1",frameborder:0,allowfullscreen:!1})},testEmbed:function(n,t){n.empty();n.adopt(t)}});window.cfTemplateTypes.video={name:"video",objectname:"CFTemplateYoutube",object:CFTemplateYoutube};Affinity.Components=Affinity.Components||{};Affinity.Components.ZelosInit={Version:"1.0.0.0",Name:"Zelos Init",File:"ui.zelos.init.js",Jira:""};!1 in window&&(window.Affinity={});Affinity.zelos={};Affinity.zelos.Elements={};ZelosError.prototype=Error.prototype;ZelosInit=new Class({Implements:[Options,Events],Binds:["loadHtmlTemplate","htmlTemplateLoadError","htmlTemplayeLoaded"],options:{htmlTemplateUrl:"/Content/html/ZelosHtmlTemplates.html",requiredUiComponenets:["UITabs","UIGrid","UIHelpBubble","UIHelpIcon","UITooltips","UIDrawPanels","UIModal","UIPompts","UISelectLookup","UIUplaodersMulti","UIDateCalendar","UIValidation","UIHidables"],requiredZelosComponenets:["ZelosTemplateLoad","ZelosTemplateProcess"]},initialize:function(n){this.setOptions(n);var r,i=this.options.requiredUiComponenets.combine(this.options.requiredZelosComponenets),t=[];if(Array.each(i,function(n){typeOf(window[n])!="class"&&t.push(n)}),t.length>0)throw new ZelosError("There are components missing that are required for Zelos to run:\n"+t.join("\n")+"\nPlease refer to 'Setting up Zelos UI' in documentation.");delete r;delete i;delete t;Affinity.zelos.getElement=this.getElement;Affinity.zelos.getElementFromData=this.getElementFromData;this.loadHtmlTemplate()},loadHtmlTemplate:function(){this.fireEvent("request",mybasepath+this.options.htmlTemplateUrl);new Request.HTML({url:mybasepath+this.options.htmlTemplateUrl,evalScripts:!1,onFailure:this.htmlTemplateLoadError,onError:this.htmlTemplateLoadError,onSuccess:this.htmlTemplayeLoaded}).get()},htmlTemplateLoadError:function(){ga&&ga("send","event","Zelos","HtmlTemplate","load failed ("+mybasepath+this.options.htmlTemplateUrl+")");Affinity.prompts.hide();this.fireEvent("error",'"'+mybasepath+this.options.htmlTemplateUrl+'" must exist in your project.')},htmlTemplayeLoaded:function(n){var t;Array.each(n,function(n){(typeOf(n)=="element"||typeOf(n)=="table")&&n.get("data-form-element")&&n.get("data-form-element")!=""&&(Affinity.zelos.Elements[n.get("data-form-element")]=n.hasClass("get-tr")?n.getElement("tr"):n)});delete t;this.fireEvent("complete")},setTemplateElement:function(n,t){Affinity.zelos.Elements[n]=t},getElement:function(n){return Affinity.zelos.Elements[n]?Affinity.zelos.Elements[n].clone():!1},getElementFromData:function(n){if(typeOf(n)!=="null"){var t=n.ElementType?n.ElementType:n.InputType,i=n.ElementType?"ElementType":"InputType";if(typeOf(Affinity.zelos.Elements[t])==="class")return Affinity.zelos.Elements[t];if(n.ElementType=="FieldEdit"||n.ElementType=="FieldDisplay")switch(n.InputType){case"Currency":if(Affinity.zelos.Elements.CurrencyInput)return Affinity.zelos.Elements.CurrencyInput.clone();default:return Affinity.zelos.Elements[t].clone()}if(Affinity.zelos.Elements[t])return Affinity.zelos.Elements[t].clone()}return!1}}),function(n,t,i,r,u,f,e){n.GoogleAnalyticsObject=u;n[u]=n[u]||function(){(n[u].q=n[u].q||[]).push(arguments)};n[u].l=1*new Date;f=t.createElement(i);e=t.getElementsByTagName(i)[0];f.async=1;f.src=r;e.parentNode.insertBefore(f,e)}(window,document,"script","//www.google-analytics.com/analytics.js","ga");ga("create","UA-45869305-1","teampayoffice.com");ga("create","UA-45869305-1",{cookieDomain:"none"});ga("send","pageview");Affinity.Components=Affinity.Components||{};Affinity.Components.ZelosTemplateLoad={Version:"1.0.0.0",Name:"Zelos Template Load",File:"ui.zelos.template.load.js",Jira:""};ZelosTemplateLoad=new Class({Implements:[Options,Events],Binds:["loadTemplate","templateLoaded","loadFailed","cancel"],options:{},initialize:function(n){this.setOptions(n);var t=new Date;log("&#x2794; attempting ZelosLoader template load (0) ...");this.formTemplateRequest=new Request.JSON({method:"get",timeout:12e4,onRequest:function(){log("&#x2794; ZelosLoader template load requested ("+t.elapsed()+") - "+this.logUrl+" ...",{color:"blue"});this.fireEvent("request",this.formTemplateRequest.options.url)}.bind(this),onFailure:function(n){var i="",r;switch(n.status){case 401:i="Api unauthorized.";break;case 404:i="API path not found.";break;case 500:try{r=JSON.decode(n.responseText)}catch(u){r=!1;i=n.responseText}r&&(i=r.error?r.error:n.responseText);delete r;break;default:i=n.statusText}i.contains(401)||i.toLowerCase().contains("unauthorized")?(log("&#x270B; attempted ZelosLoader template load unauthorized &#x270B;",{color:"red"}),window.fireEvent("unauthorized"),this.loadFailed(i)):(log("&#x2718; attempted ZelosLoader template load failed ("+t.elapsed()+") - "+this.logUrl+" - "+i,{color:"red"}),this.loadFailed(i));delete i}.bind(this),onError:function(n){log("&#x2718; attempted ZelosLoader template load failed with errors ("+t.elapsed()+") - "+this.logUrl+" - "+n,{color:"red"});this.loadFailed(n)}.bind(this),onException:function(n,i){log("&#x2718; attempted ZelosLoader template load failed with exception ("+t.elapsed()+") - "+this.logUrl+" - "+n+": "+i,{color:"red"});this.loadFailed("Exception on "+n+": "+i)}.bind(this),onTimeout:function(){log("&#x2718; attempted ZelosLoader template load timed out ("+t.elapsed()+") - "+this.logUrl,{color:"red"});this.loadFailed("Load reached timeout limit.")}.bind(this),onSuccess:function(n){JSON.Unauthorized(n,"Zelos Loader, initialize - "+this.formTemplateRequest.url)||(n.error?typeOf(n.error)==="object"?(log("&#x2718; attempted ZelosLoader template load succeeded with errors ("+t.elapsed()+") - "+this.logUrl+" - "+JSON.stringify(n.error),{color:"red"}),this.loadFailed(JSON.stringify(n.error))):(log("&#x2718; attempted ZelosLoader template load succeeded with errors ("+t.elapsed()+") - "+this.logUrl+" - "+n.error.split("\r\n").join(", "),{color:"red"}),this.loadFailed(n.error.split("\r\n").join("<br />"))):(log("&#x2714; attempted ZelosLoader template load succeeded ("+t.elapsed()+") - "+this.logUrl,{color:"green"}),this.templateLoaded(n)))}.bind(this)})},attemptUrl:"no url set",loadFailed:function(n){this.formTemplateRequest.isRunning()&&this.formTemplateRequest.cancel();this.fireEvent("error",n);ga&&ga("send","event","Zelos","FormTemplate","load failed ("+this.attemptUrl+")")},loadTemplate:function(n){this.attemptUrl=n;this.attemptUrl.contains("ran")||(this.attemptUrl=Affinity.GetCacheSafePath(this.attemptUrl));this.formTemplateRequest.url=this.formTemplateRequest.options.url=this.attemptUrl;this.formTemplateRequest.send()},templateLoaded:function(n){typeOf(n.success)==="boolean"&&n.success===!1?this.loadFailed():(this.template=n,this.fireEvent("complete",this.template),ga&&ga("send","event","Zelos","FormTemplate","From Loaded ("+this.attemptUrl+")"))},isRunning:function(){return this.formTemplateRequest&&this.formTemplateRequest.isRunning()?!0:!1},cancel:function(){this.formTemplateRequest&&this.formTemplateRequest.isRunning()&&this.formTemplateRequest.cancel();this.fireEvent("cancel","Form was canceled.")},destroy:function(){}});Affinity.Components=Affinity.Components||{};Affinity.Components.ZelosTemplateProcess={Version:"1.0.1.1",Name:"Zelos Template Process",File:"ui.zelos.template.process.js",Jira:"Add autocomplete to off on fields and forms"};ZelosTemplateProcess=new Class({Implements:[Options,Events],Binds:["processTemplate","writeField","readField","readDirectValue","submit","cancel","cancelForm","validationFailed","onPost","updateDocument","sanatisePostJson","validationPassed","postFailed","postSuccess","getLookupDependancies","setLookupDependancies","processChild"],options:{getApi:null,putApi:null,getEmptyTimesheetApi:null,insertAddTimesheetForm:!0,target:document.body,viewOnly:!1,frameless:!1,dateDisplayFormat:"%a %e %b %Y"},fieldProcessor:!1,hasValidation:!1,processorId:!1,initialize:function(n){if(this.setOptions(n),this.processorId=String.uniqueID(),this.icons={},this.icons.save=Affinity.icons.Save||"&#xe093;",this.icons.cancel=Affinity.icons.Cancel||"&#xe070;",Affinity.zelos.Elements==null)throw new ZelosError("Zelos HTML Elements must be compiled. See ui.zelos.init.js");if(!this.options.viewOnly&&this.options.putApi==null)throw new ZelosError("Zelos needs a put API path in options.");this.target=this.options.target;this.fieldProcessor=new ZelosProcessFileds({zelosProcessor:this})},getValue:function(n){return this.fieldProcessor?this.fieldProcessor.getValue(n):!1},getAttributes:function(n){return this.fieldProcessor?this.fieldProcessor.getValue(n):!1},getLookupDependancies:function(n){return this.fieldProcessor?this.fieldProcessor.getLookupDependancies(n):!1},setLookupDependancies:function(n,t,i){this.fieldProcessor&&this.fieldProcessor.setLookupDependancies(n,t,i)},processTemplate:function(n){var t,i;typeOf(n)=="string"&&(n=JSON.encode(n));typeOf(n)==="object"&&(this.template=n,this.fieldProcessor.template=n,t=n,typeOf(t.Children)=="array"&&(t.Children.sort(function(n,t){return parseInt(n.Layout.Rank,10)-parseInt(t.Layout.Rank,10)}),Array.each(t.Children,this.processSection.bind(this))),i=this.options.target.getElements(".zelos-button"),i.length>0?(this.form=new Element("form"),this.form.adopt(this.target.getChildren()),this.form.inject(this.target),this.form.set("autocomplete","off"),this.buttonBox=this.options.target.getElement(".form-row.buttons"),this.loaderBox=new Element("div",{"class":"form-row hidden"}).adopt(new Element("img",{src:Affinity.loaders.light})).inject(this.buttonBox,"after"),this.errorScroll=new Fx.Scroll(window),this.validation=new UIFormValidation({target:this.form,onPost:this.onPost,onValidateFailCallback:this.validationFailed,onValidateCallback:this.validationPassed}),i.addEvent("click",function(n){var t=n.target.hasClass("zelos-button")?n.target:n.target.getParent(".zelos-button");t.get("data-type")&&(t.get("data-type")!=="Cancel"?(this.buttonClickedName=t.get("data-name"),this.submit(n)):this.cancelForm())}.bind(this))):(this.form=this.target,this.form.set("autocomplete","off")),this.options.frameless,Array.each(this.form.getElements(".has-dependencies"),function(n){n.retrieve("dependencies").setEvents()}),Affinity.formhideables&&Affinity.formhideables.processNew(),Affinity.tooltips&&Affinity.tooltips.processNew(),Affinity.lookups&&Affinity.lookups.processNew({jsonp:!0}),Affinity.displaylookups&&Affinity.displaylookups.processNew({jsonp:!0}),Affinity.uiDrawPanels&&Affinity.uiDrawPanels.processNew(),this.fireEvent("complete",this.options.target))},submit:function(n){document.getElements(".error").removeClass("error");document.getElements(".errorstr").destroy();this.loaderBox&&this.loaderBox.removeClass("hidden");this.buttonBox&&this.buttonBox.addClass("hidden");this.buttonClicked=n.target.hasClass("button")?n.target:n.target.getParent(".button");var t=!0;this.options.beforSave&&(t=this.options.beforSave({button:this.buttonClicked}));t?this.validation?this.validation.validate():this.validationPassed():(this.loaderBox&&this.loaderBox.addClass("hidden"),this.buttonBox&&this.buttonBox.removeClass("hidden"))},cancel:function(){this.cancelForm()},cancelForm:function(){this.fireEvent("cancel")},validationFailed:function(){(function(){this.buttonBox&&this.buttonBox.removeClass("hidden");this.loaderBox&&this.loaderBox.addClass("hidden");this.errorScroll.toElement(document.getElement(".errorstr").getParent(".form-row"))}).delay(1e3,this)},onPost:function(){this.loaderBox.removeClass("hidden");this.buttonBox.addClass("hidden")},updateDocument:function(){var n=Object.clone(this.template);return n.Children&&typeOf(n.Children)=="array"&&Array.each(n.Children,function(t,i){t.Children&&typeOf(t.Children)=="array"&&Array.each(t.Children,function(t,r){this.readField(n,i,r,t)}.bind(this))}.bind(this)),n},sanatisePostJson:function(n){var t=JSON.encode(n);return t=t.replace(new RegExp("&amp;","gi"),"%26"),t=t.replace(new RegExp("&","gi"),"%26"),escape(t)},validationPassed:function(){var n=this.updateDocument(),t;this.fireEvent("validated",{document:n,buttonClicked:this.buttonClicked});this.options.putApi!=="none"&&(t=this.sanatisePostJson(n),new Request.JSON({method:"POST",url:this.options.putApi,onFailure:this.postFailed,onError:this.postFailed,onSuccess:this.postSuccess}).post("="+t))},postFailed:function(){this.loaderBox&&this.loaderBox.addClass("hidden");this.buttonBox&&this.buttonBox.removeClass("hidden");this.fireEvent("saveError")},postSuccess:function(n){var t,u,f,e;if(typeOf(n)=="string"&&(n=JSON.decode(n)),typeOf(n)!="object")throw new ZelosError("returned Json is not a valid object");this.loaderBox&&this.loaderBox.addClass("hidden");this.buttonBox&&this.buttonBox.removeClass("hidden");var o="cleverform",i=!1,r=[];n.Attribute&&n.Attribute.IsError&&(r.push(n.Attribute.ErrorMessage),i=!0);n.Children&&Array.each(n.Children,function(s){s.Attribute&&s.Attribute.IsError&&(r.push(s.name+": "+s.Attribute.ErrorMessage),i=!0);Array.each(s.Children,function(s){if(s.ElementType&&s.ElementType==="TimesheetTable"){if(o="timesheets",s.Attribute&&s.Attribute.IsError){if(i){window.fireEvent("processorDocumentError",{document:n,processorId:this.processorId});return}i=!0}}else s.Attribute&&s.Attribute.IsError&&(i=!0,t=document.id(s.Name)?document.id(s.Name):!1,t?(t.get("data-widget")?(u=t.retrieve("widget"),u&&"processErrors"in u&&(f=t.retrieve("widget").processErrors(n)),f.length>0?(i=!0,e=f.join(", ")):e=s.Attribute.ErrorMessage):(t.getPrevious("label,.lable")?t=t.getPrevious("label,.lable"):t.getParent().getElement("label,.lable")&&(t=t.getParent().getElement("label,.lable")),e=s.Attribute.ErrorMessage),t.addClass("error"),t.hasClass("suppress-errors")||new Element("div",{"class":"errorstr",html:e}).inject(t,"before")):r.push(s.Name+": "+s.Attribute.ErrorMessage))}.bind(this))}.bind(this));i?(o=="timesheets"&&window.fireEvent("processorDocumentError",{document:n,processorId:this.processorId}),r.length>0?this.fireEvent("saveError","<br />"+r.join("<br />")):this.fireEvent("saveError","")):(this.fireEvent("save",n),window.fireEvent("processorDocumentSaved",{document:n,processorId:this.processorId}));delete t;delete u;delete f;delete i;delete r},processChild:function(n,t,i,r){i=typeOf(i)==="null"?null:i;var u=this.fieldProcessor.returnField(n,t,r);return i!==null&&u&&(i.getElement(".default-form").adopt(u),u.fireEvent("inDom")),u},processSection:function(n,t){if(n.ElementType=="SectionHeading"){if(n.Attribute&&n.Attribute.IsHidden)return;var r=!1,i=Affinity.zelos.getElementFromData(n);this.options.frameless&&i.addClass("frameless");this.options.target.adopt(i);i.getElement(".section-title").set("html",n.Description.ShortText);n.Layout&&n.Layout.HideTitle&&i.getElement(".section-header")&&i.getElement(".section-header").addClass("hidden");typeOf(n.Children)=="array"&&(n.Children.sort(function(n,t){return parseInt(n.Layout.Rank,10)-parseInt(t.Layout.Rank,10)}),Array.each(n.Children,function(n,u){n.ElementType&&n.ElementType=="WorkflowButton"&&(r=!0);this.processChild(n,u,i,t)}.bind(this)));typeOf(n.Layout.HideMessage)==="null"||n.Layout.HideMessage||i.getElement(".required-message").removeClass("hidden");i.getElement(".required")&&r&&new Element("div",{"class":"form-row buttons"}).inject(i.getElement(".required-message"),"after").adopt(i.getElements(".button-wrapper"));n.Layout.IsHideable&&i.addClass("is-hideable").addClass("ui-hideable-id-"+n.Name.trim().toLowerCase().replace(/ /g,"-"))}},readDirectValue:function(n,t){return this.fieldProcessor.readField(n,t)},writeField:function(n,t){this.fieldProcessor.writeField(n,t)},readField:function(n,t,i,r,u){if(typeOf(u)==="null"&&(u=this.form),u.getElement("#"+r.Name)){var f=u.getElement("#"+r.Name);this.buttonClickedName&&(this.fieldProcessor.buttonClickedName=this.buttonClickedName);n.Children[t].Children[i]=this.fieldProcessor.readField(r,f);delete f}}})