"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Dashboard"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.Dashboard={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Dashboard"in Affinity2018.Apps||(Affinity2018.Apps.Dashboard={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Apps.Dashboard.Wrapper=class{_options(){this.building=!1,this.UseModernIcons=!1,this.IsDebug=location.host.toLowerCase().contains("test")||location.host.toLowerCase().contains("localhost")}constructor(){this._options(),["_init","SetSize","ToggleMenu","ShowMenu","HideMenu","ToggleNav","ShowNav","HideNav","ToggleSubMenu","HideSubMenu","ShowSubMenu","Logout","LogoutLinkClicked","_gotUserData","_getConfig","_gotConfig","_setTemplate","_windowClicked","_templates"].bindEach(this),this._templates(),Affinity2018.UiReady?this._init():window.addEventListener("MainInit",this._init)}_init(){document.body.classList.add("dashboard","show-dashboard-nav"),Affinity2018.CheckDarkMode(),this.PageWrapperNode=document.querySelector("div.pagewrapper"),this.WrapperNode=document.createElement("div"),this.WrapperNode.id="dashWrapper",this.WrapperNode.innerHTML=this.PreWrapperTemplate.format({year:(new Date).getFullYear()}),document.body.appendChild(this.WrapperNode),document.body.appendChild(this.WrapperNode.querySelector("#dashFooter")),this.FooterNode=document.querySelector("#dashFooter"),window.addEventListener("resize",this.SetSize,Affinity2018.PassiveEventProp),this.SetSize(),"ResizeSensor"in window&&this.PageWrapperNode&&new ResizeSensor(this.PageWrapperNode,this.SetSize),window.addEventListener("GotDashboardUser",this._gotUserData),axios({method:"POST",url:Affinity2018.Path+"Api/GetUser"}).then(function(e){window.dispatchEvent(new CustomEvent("GotDashboardUser",{detail:e}))}.bind(this)).catch((function(e){console.log(e)}))}SetSize(e){var s=document.querySelector("#dashFooter"),i=this.PageWrapperNode.clientHeight+80;$a.getPageSize().height>i+50&&(i=$a.getPageSize().height-50),s.style.top=i+"px",s.classList.contains("hidden")&&(s.style.bottom="auto",s.classList.remove("hidden"))}ToggleMenu(e){this.MenuNode.classList.contains("show")?this.HideMenu(e):this.ShowMenu(e)}ShowMenu(e){e&&e.stop(),this.MenuNode.classList.add("show"),this.MenuNode.addEventListener("mouseleave",this.HideMenu),window.addEventListener("click",this._windowClicked)}HideMenu(e){e&&e.stop(),window.removeEventListener("click",this._windowClicked),this.MenuNode.removeEventListener("mouseleave",this.HideMenu),this.MenuNode.classList.remove("show")}ToggleNav(){document.body.classList.contains("show-dashboard-nav")?this.HideNav():this.ShowNav()}ShowNav(){document.body.classList.add("show-dashboard-nav")}HideNav(){document.body.classList.remove("show-dashboard-nav")}ToggleSubMenu(e){var s=e.closest(".dash-nav-item");if(s.classList.contains("has-sub-nav")){var i=s.querySelector(".sub-nav");i&&(s.classList.contains("expanded")?this.HideSubMenu(i):this.ShowSubMenu(i))}}HideSubMenu(e){e.style.height="0px",e.closest(".dash-nav-item").classList.remove("expanded")}ShowSubMenu(e){e.style.height=42.72*e.querySelectorAll(".dash-nav-item").length+"px",e.closest(".dash-nav-item").classList.add("expanded")}Logout(){axios({method:"GET",url:Affinity2018.Apps.Dashboard.Config.LogoutUrl}).then((function(e){document.location.reload(!0)})).catch((function(e){console.log(e)}))}LogoutLinkClicked(){Affinity2018.ShowPageLoader()}_gotUserData(e){Affinity2018.Apps.Dashboard.Config.UserProfile=e.detail.data,this._setTemplate()}_setTemplate(){var e=Affinity2018.Apps.Dashboard.Config.LogoutUrl;"CleverForms"===Affinity2018.Apps.Dashboard.Config.AppName&&(e="/Authentication/SignOut"),this.WrapperNode.innerHTML=this.WrapperTemplate.format({logoPath:"https://dashboard."+(this.IsDebug?"test":"")+"affinitylogon.com/Root/Logo",companyNumner:Affinity2018.Apps.Dashboard.Config.UserProfile.CompanyNumber,employeeNumber:Affinity2018.Apps.Dashboard.Config.UserProfile.EmployeeNumber,employeeName:Affinity2018.Apps.Dashboard.Config.UserProfile.Commonname,position:Affinity2018.Apps.Dashboard.Config.UserProfile.PositionTitle,logoutUrl:e}),this.NavButtonNode=this.WrapperNode.querySelector(".dash-header-nav-button"),this.LogoNode=this.WrapperNode.querySelector(".dash-header-logo"),this.MenuNodeNode=this.WrapperNode.querySelector(".dash-header-menu-button"),this.MenuNode=this.WrapperNode.querySelector(".dash-header-menu"),this.NavNode=this.WrapperNode.querySelector(".dash-nav"),this.FooterNode=this.PageWrapperNode.querySelector(".dash-footer"),this.NavButtonNode.addEventListener("click",this.ToggleNav),this.MenuNodeNode.addEventListener("click",this.ToggleMenu),this._getConfig(),this.SetSize()}_getConfig(){window.addEventListener("GotDashboardConfig",this._gotConfig),axios({method:"GET",url:Affinity2018.Apps.Dashboard.Config.ConfigApi}).then(function(e){window.dispatchEvent(new CustomEvent("GotDashboardConfig",{detail:e}))}.bind(this)).catch((function(e){console.log(e)}))}_gotConfig(e){if(!this.building){this.building=!0;var s,i,t,n,a,o=e.detail.data;$a.isNullOrEmpty(o.Url)||((s=document.createElement("div")).classList.add("dash-nav-item"),s.innerHTML=this.NavTemplate.format({link:o.Url,click:"",target:"_self",icon:this.UseModernIcons?"icon-dashboard":"old-icons icon-gauge",label:"Dashboard",selected:"Dashboard"===Affinity2018.Apps.Dashboard.Config.AppName?" selected":""}),this.NavNode.appendChild(s));for(var d=0;d<o.Apps.length;d++)if(n=o.Apps[d],(s=document.createElement("div")).classList.add("dash-nav-item"),n.Link.Menu.length>0&&s.classList.add("has-sub-nav"),n.Link.Expanded&&s.classList.add("expanded"),n.Link.Enabled||s.classList.add("disabled"),n.Link.Menu.length>0?s.innerHTML=this.NavWithMenuTemplate.format({icon:this._getIcon(n.Link.Icon),label:n.Link.Text,selected:Affinity2018.Apps.Dashboard.Config.AppName===n.Name?" selected":""}):s.innerHTML=this.NavTemplate.format({link:n.Link.Menu.length>0?"#":n.Link.Url,target:n.External?"_blank":"_self",icon:this._getIcon(n.Link.Icon),label:n.Link.Text,selected:Affinity2018.Apps.Dashboard.Config.AppName===n.Name?" selected":""}),this.NavNode.appendChild(s),n.Link.Menu.length>0){i=s.querySelector(".sub-nav");for(var r=0;r<n.Link.Menu.length;r++)a=n.Link.Menu[r],(t=document.createElement("div")).classList.add("dash-nav-item"),a.Enabled||t.classList.add("disabled"),t.innerHTML=this.NavTemplate.format({link:a.Url,click:"",target:a.External?"_blank":"_self",icon:this._getIcon(a.Icon),label:a.Text,selected:""}),i.appendChild(t)}for(d=0;d<o.Forms.length;d++)n=o.Forms[d],(s=document.createElement("div")).classList.add("dash-nav-item"),n.Enabled||s.classList.add("disabled"),s.innerHTML=this.NavTemplate.format({link:n.Url,target:n.External?"_blank":"_self",icon:this._getIcon(n.Icon),label:n.Text,selected:Affinity2018.Apps.Dashboard.Config.AppName===n.Name?" selected":""}),this.NavNode.appendChild(s);document.body.classList.add("dash-animate")}}_getIcon(e){if(this.UseModernIcons){var s={guage:"dashboard",docs:"file-cog-black","user-boss":"user"};return e=s.hasOwnProperty(e)?s[e]:e,window.hasOwnProperty("Affinity2018")&&Affinity2018.icons.hasOwnProperty(this._getIconKey(e))?"icon-"+e:"old-icons icon-"+e}return"old-icons icon-"+e}_getIconKey(e){return e.toCamelCase()}_windowClicked(e){e.target.closest(".dash-header-menu")?e.stop():this.HideMenu()}_templates(){this.PreWrapperTemplate='\n      <div class="dash-header">\n        <div class="dash-header-nav-button"><icon class="icon-menu"></icon></div>\n      </div>\n      <div class="dash-nav">\n      </div>\n      <div id="dashFooter" class="hidden">\n        Â© Copyright {year} Affinity - <a href="http://www.affinityteam.co.nz/" target="affinity">Affinity Employer Services</a> <a href="http://www.affinityteam.co.nz/" target="affinity"><span class="dash-footer-logo"></span></a>\n      </div>\n    ',this.WrapperTemplate='\n      <div class="dash-header">\n        <div class="dash-header-nav-button"><icon class="icon-menu"></icon></div>\n        <div class="dash-header-logo">\n          <img src="{logoPath}?company={companyNumner}&employee={employeeNumber}" />\n        </div>\n        <div class="dash-header-title displayname">{employeeName}</div>\n        <div class="dash-header-menu-button"><icon class="icon-menu-dots"></icon></div>\n        <div class="dash-header-menu">\n          <div class="dash-header-menu-top">\n            <div class="dash-header-menu-avatar">\n              <img src="{logoPath}?company={companyNumner}&amp;employee={employeeNumber}" />\n            </div>\n            <p>{employeeName}</p>\n            <p>{position}</p>\n            <p>Employee Number: <strong>{employeeNumber}</strong></p>\n            <p>Company Number: <strong>{companyNumner}</strong></p>\n          </div>\n          <a class="button orange" href="javascript:void(0)" onClick="Affinity2018.Apps.Dashboard.Wrapper.Logout();"><icon class="icon-logout"></icon><text>Logout</text></a>\n        </div>\n      </div>\n      <div class="dash-nav-scroller">\n        <div class="dash-nav">\n          <div class="dash-nav-item logout">\n            <span class="dash-nav-item-inner">\n              <a href="{logoutUrl}" class="button-item" onClick="Affinity2018.Apps.Dashboard.Wrapper.LogoutLinkClicked();"><icon class="icon-logout"></icon><text>Logout</text></a>\n            </span>\n          </div>\n        </div>\n      </div>\n    ',this.NavTemplate='\n      <span class="dash-nav-item-inner">\n        <a href="{link}" target="{target}" class="button-item{selected}"><icon class="{icon}"></icon><text>{label}</text></a>\n      </span>\n    ',this.NavWithMenuTemplate='\n      <span class="dash-nav-item-inner">\n        <span class="button-item{selected}" onclick="Affinity2018.Apps.Dashboard.Wrapper.ToggleSubMenu(this)"><icon class="{icon}"></icon><text>{label}</text></span>\n        <span class="sub-nav-arrow icon-arrow-line-small-down{selected}"></span>\n        <span class="sub-nav"></span>\n      </span>\n    '}},Affinity2018.Apps.Dashboard.Wrapper=new Affinity2018.Classes.Apps.Dashboard.Wrapper;