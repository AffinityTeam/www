(function(){var ieVersion=-1,ieVersionData=navigator.userAgent.match(/(?:MSIE |Trident.*rv:|Edge\/)(\d+(\.\d+)?)/)||[],prototype;if(ieVersionData.length>0&&(ieVersion=parseFloat(ieVersionData[1])),ieVersion>-1&&ieVersion<18)return void alert("This version of IE or Edge is not suported ("+ieVersion+"). Please use latest Chrome, Firefox, Safari, Brave or MS Edge v18 or newer.");if(window.hasOwnProperty("Affinity2018")||(window.Affinity2018={}),Affinity2018.hasOwnProperty("Classes")||(Affinity2018.Classes={}),Affinity2018.Classes.hasOwnProperty("Plugins")||(Affinity2018.Classes.Plugins={}),Affinity2018.hasOwnProperty("Apps")||(Affinity2018.Apps={}),Affinity2018.Apps.hasOwnProperty("Plugins")||(Affinity2018.Apps.Plugins={}),Affinity2018.hasOwnProperty("Plugins")||(Affinity2018.Plugins={}),Affinity2018.hasOwnProperty("ApiEndpoints")||(Affinity2018.ApiEndpoints={}),Affinity2018.hasOwnProperty("UserProfile")||(Affinity2018.UserProfile={}),Affinity2018.Domain="Affinity",Affinity2018.Name="UI 2018",Affinity2018.Id="ui.2018",Affinity2018.Version="0.0.6",Affinity2018.Language="english",Affinity2018.hasOwnProperty("Path")||(Affinity2018.Path="//cdn.source63.com/affinity/beta1"),Affinity2018.hasOwnProperty("ContentPath")||(Affinity2018.ContentPath="//cdn.source63.com/affinity/beta1"),Affinity2018.hasOwnProperty("WebWorkerPath")||(Affinity2018.WebWorkerPath="//cdn.source63.com/affinity/beta1/scripts/plugins/"),Affinity2018.hasOwnProperty("HideAllTemplates")||(Affinity2018.HideAllTemplates=!1),Affinity2018.hasOwnProperty("DisablePlugins")||(Affinity2018.DisablePlugins=[]),Affinity2018.UiReady=!1,Affinity2018.HasCitrix=!1,Affinity2018.PreloadResources={Scripts:["https://cdnjs.cloudflare.com/ajax/libs/fontfaceobserver/2.0.13/fontfaceobserver.js","https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.min.js","https://cdn.polyfill.io/v2/polyfill.min.js?features=Intl.~locale.en","https://cdnjs.cloudflare.com/ajax/libs/datejs/1.0/date.min.js","https://cdnjs.cloudflare.com/ajax/libs/luxon/1.25.0/luxon.min.js","https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js","https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/TweenLite.min.js","https://cdnjs.cloudflare.com/ajax/libs/css-element-queries/1.2.3/ResizeSensor.js"],Extentions:["https://cdnjs.cloudflare.com/ajax/libs/gsap/2.0.1/plugins/ScrollToPlugin.min.js"],Styles:["https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.css"],Fonts:["Montserrat","Roboto Mono"],Images:[],Audio:[],Video:[]},Affinity2018.icons={graphLinefill:"&#xe912;",thermometer:"&#xe913;",progressHalf:"&#xe914;",brogressThird:"&#xe915;",progressFull:"&#xe917;",progressEmpty:"&#xe918;",browser:"&#xe919;",gauge:"&#xe91a;",box:"&#xe91c;",pageEmpty:"&#xe91d;",news:"&#xe91f;",pageBlack:"&#xe920;",page:"&#xe924;",arrowLeftSmall:"&#xe908;",arrowRightSmall:"&#xe909;",arrowUpSmall:"&#xe90a;",arrowDownSmall:"&#xe907;",arrowLeftCircle:"&#xe90c;",arrowRightCircle:"&#xe90e;",arrowUpCircle:"&#xe910;",arrowDownCircle:"&#xe90b;",arrowBoldLeft:"&#xe904;",arrowBoldRight:"&#xe905;",arrowBoldUp:"&#xe906;",arrowBoldDown:"&#xe903;",question:"&#xe925;",tools:"&#xe933;",vcard:"&#xe92a;",graphStatistics:"&#xe900;",graphBars:"&#xe901;",graphPie:"&#xe902;",ticket:"&#xe929;",trophy:"&#xe934;",lab:"&#xe931;",droplet:"&#xe92c;",qrcode:"&#xe911;",brightness:"&#xe1ae;",popupSolid:"&#xe150;",drive:"&#xe875;",new:"&#xe05e;",resizeText:"&#xe25e;",flashlight:"&#xe25f;",hourglassEmpty:"&#xe88b;",hourglass:"&#xe88c;",inboxEmpty:"&#xe158;",cart:"&#xe8cc;",upskill:"&#xe54b;",inbox:"&#xe16a;",outbox:"&#xe16b;",publish:"&#xe89d;",install:"&#xe0df;",rss:"&#xe0e5;",basket:"&#xe8cb;",sort:"&#xe165;",sortAlpha:"&#xe053;",drives:"&#xe1dc;",language:"&#xe8e2;",voicemail:"&#xe0e2;",networkLock:"&#xe62f;",wireless:"&#xe63e;",arrowLeft:"&#xe5c4;",arrowRight:"&#xe5c8;",arrowUp:"&#xe5d8;",arrowDown:"&#xe5db;",arrowLineSmallLeft:"&#xe314;",arrowLineSmallRight:"&#xe315;",arrowLineSmallUp:"&#xe316;",arrowLineSmallDown:"&#xe313;",unfoldMore:"&#xe5d7;",scaleup:"&#xe5e1;",resizeEnlarge:"&#xe5e2;",unfoldLess:"&#xe5d6;",scaledown:"&#xe5e3;",resizeShrink:"&#xe5e4;",code:"&#xe86f;",chevronLeft:"&#xe573;",chevronRight:"&#xe574;",chevronUp:"&#xe575;",chevronDown:"&#xe576;",download:"&#xe884;",upload:"&#xe2c6;",replyAll:"&#xe15f;",reply:"&#xe15e;",forward:"&#xe162;",sync:"&#xe041;",trendingFlat:"&#xe8e4;",return:"&#xe31b;",returnBack:"&#xe31c;",subdirectoryArrowLeft:"&#xe5d9;",subdirectoryArrowRight:"&#xe5da;",switchVert:"&#xe8d5;",switch:"&#xe8d6;",shuffle:"&#xe043;",workFlowMultiple:"&#xe0b6;",workFlow:"&#xe252;",trendingUp:"&#xe8e5;",trendingDown:"&#xe8e3;",undo:"&#xe577;",swap:"&#xe0d7;",refresh:"&#xe5d5;",cycle:"&#xe86a;",update:"&#xe863;",syncDot:"&#xe8ba;",restore:"&#xe8b3;",history:"&#xe923;",ccw:"&#xe419;",cw:"&#xe41a;",share:"&#xe80d;",timeline:"&#xe922;",flow:"&#xe260;",tickAll:"&#xe877;",tick:"&#xe5ca;",tickSquare:"&#xe834;",tickRound:"&#xe86c;",tickShield:"&#xe8e8;",tickTag:"&#xe52d;",cross:"&#xe5cd;",crossSquare:"&#xe5c9;",crossRound:"&#xe5cb;",crossOctagon:"&#xe578;",plus:"&#xe145;",plusSquare:"&#xe146;",plusRound:"&#xe147;",minus:"&#xe15b;",minusSquare:"&#xe92d;",minusRound:"&#xe15c;",infoRound:"&#xe88e;",infoRoundLight:"&#xe88f;",info:"&#xe645;",helpRound:"&#xe887;",helpRoundLight:"&#xe8fd;",error:"&#xe000;",errorLight:"&#xe001;",warning:"&#xe002;",stop:"&#xe160;",danger:"&#xe031;",search:"&#xe8b6;",zoomIn:"&#xe8ff;",zoomOut:"&#xe930;",searchRefresh:"&#xe8fa;",cog:"&#xe8b8;",settings:"&#xe8b9;",wrench:"&#xe869;",tune:"&#xe429;",login:"&#xe879;",logout:"&#xe87c;",export:"&#xe89e;",house:"&#xe88a;",lock:"&#xe897;",lockOpen:"&#xe899;",blockLock:"&#xe641;",addLock:"&#xe63f;",key:"&#xe0da;",shield:"&#xe32a;",clock:"&#xe8b5;",alarm:"&#xe855;",alarmAdd:"&#xe856;",snooze:"&#xe046;",timer:"&#xe425;",watch:"&#xe334;",bell:"&#xe7f4;",bellAdd:"&#xe003;",bellRing:"&#xe7f7;",bellOff:"&#xe7f6;",bellSnooze:"&#xe7f8;",money:"&#xe227;",cash:"&#xe53e;",creditCard:"&#xe8a1;",wallet:"&#xe850;",accountBox:"&#xe851;",accountCircle:"&#xe853;",userBossRound:"&#xe854;",user:"&#xe7fd;",userAdd:"&#xe7fe;",userDel:"&#xe7ff;",userCheck:"&#xe800;",userBlock:"&#xe801;",users:"&#xe7fb;",usersAdd:"&#xe7f0;",contact:"&#xe0cf;",treeView:"&#xe579;",emptyInbox:"&#xe156;",moveInbox:"&#xe168;",archive:"&#xe149;",unarchive:"&#xe169;",cloud:"&#xe42d;",cloudTick:"&#xe2bf;",cloudDownload:"&#xe2c0;",cloudUpload:"&#xe2c3;",dashboard:"&#xe8f1;",layout:"&#xe8f2;",grid:"&#xe42b;",guage:"&#xe640;",graphs:"&#xe6df;",timelapse:"&#xe422;",equalizer:"&#xe01d;",graphLine:"&#xe6e1;",infinity:"&#xeb3d;",fullscreen:"&#xe5d0;",fullscreenExit:"&#xe5d1;",pencil:"&#xe254;",edit:"&#xe255;",save:"&#xe161;",trash:"&#xe872;",delete:"&#xe92b;",calendar:"&#xe916;",schedule:"&#xe926;",date:"&#xe24f;",dateCheck:"&#xe614;",dateNote:"&#xe616;",dateCross:"&#xe615;",dateSearch:"&#xe57a;",dateHeart:"&#xe57b;",dateEdit:"&#xe57c;",scheduleTime:"&#xe57d;",dateAlert:"&#xe57e;",mailLight:"&#xe0e1;",mail:"&#xe159;",mailOpen:"&#xe151;",mailTick:"&#xe57f;",mailSearch:"&#xe580;",mailAdd:"&#xe581;",mailAlert:"&#xe582;",mailLock:"&#xe583;",paperclip:"&#xe226;",attachment:"&#xe2bc;",link:"&#xe157;",flag:"&#xe153;",ribbon:"&#xe8e6;",tag:"&#xe54e;",tagHeart:"&#xe89a;",tags:"&#xe41d;",bookmark:"&#xe431;",bookmarks:"&#xe432;",chat:"&#xe8af;",prompt:"&#xe0ca;",comment:"&#xe0cb;",promptInfo:"&#xe0d8;",promptText:"&#xe0b7;",promptMessage:"&#xe0c9;",promptBlock:"&#xe92f;",promptList:"&#xe8cd;",promptAlert:"&#xe85a;",promptImage:"&#xe618;",promptVideo:"&#xe62e;",promptEdit:"&#xe560;",blocked:"&#xe033;",blockedLeft:"&#xe611;",cancel:"&#xe14a;",moreLeft:"&#xe619;",moreRight:"&#xe61a;",label:"&#xe892;",more:"&#xe5d3;",dotsVert:"&#xe5d4;",menuDots:"&#xe5dc;",menu:"&#xe5d2;",clearAll:"&#xe0b8;",suitcase:"&#xe8f9;",briefcase:"&#xeb3f;",bag:"&#xe54c;",gift:"&#xe8b1;",cake:"&#xe7e9;",heartFull:"&#xe87d;",heartEmpty:"&#xe87e;",starFull:"&#xe838;",starEmpty:"&#xe83a;",dart:"&#xe584;",paperplane:"&#xe163;",lockSubmitted:"&#xe164;",thumbsUp:"&#xe8dc;",lockApproved:"&#xe8df;",thumbsDown:"&#xe8db;",lockDeclined:"&#xe8de;",thumbsUpDown:"&#xe8dd;",dollarRound:"&#xe263;",paid:"&#xe265;",lockPaid:"&#xe264;",codeA:"&#xe56b;",codeH:"&#xe56d;",codeD:"&#xe56e;",codeR:"&#xe56f;",codeM:"&#xe570;",codeP:"&#xe571;",codeS:"&#xe572;",pin:"&#xe921;",coffeeFull:"&#xeb44;",coffeeEmpty:"&#xe586;",meal:"&#xe56c;",car:"&#xe531;",incident:"&#xe3f3;",incidentCross:"&#xe548;",holiday:"&#xeb3e;",beach:"&#xeb40;",plane:"&#xe539;",traffic:"&#xe565;",directions:"&#xe52e;",location:"&#xe8b4;",locationPin:"&#xe55e;",locationArrow:"&#xe569;",target:"&#xe55c;",compass:"&#xe87a;",map:"&#xe55b;",network:"&#xe894;",earth:"&#xe80b;",server:"&#xe1db;",database:"&#xe587;",databaseTick:"&#xe588;",databaseAdd:"&#xe589;",databaseMinus:"&#xe58a;",databaseDelete:"&#xe58b;",databaseLock:"&#xe590;",databaseSearch:"&#xe58c;",databaseEdit:"&#xe5e5;",databaseImport:"&#xe5e6;",databaseExport:"&#xe5e7;",databaseRefresh:"&#xe5e8;",databaseSync:"&#xe5e9;",cpu:"&#xe322;",nfc:"&#xe1bb;",eye:"&#xe8f4;",eyeBlock:"&#xe8f5;",palette:"&#xe40a;",brush:"&#xe3ae;",power:"&#xe8ac;",powerMore:"&#xe8c6;",flaskContent:"&#xe58d;",flaskFull:"&#xe58e;",lightBulb:"&#xe90f;",bug:"&#xe868;",extension:"&#xe87b;",plugin:"&#xe63c;",book:"&#xe0e0;",docWord:"&#xe58f;",doc:"&#xe874;",docs:"&#xe873;",fileCabinet:"&#xe599;",zipBlack:"&#xe5ea;",zip:"&#xe5eb;",executableBlack:"&#xe5ec;",executable:"&#xe5ed;",fileBlack:"&#xe24d;",docBlack:"&#xe24d;",file:"&#xe24e;",fileTextBlack:"&#xe5ee;",fileText:"&#xe5ef;",fileSearchBlack:"&#xe880;",fileSearch:"&#xe881;",fileAddBlack:"&#xe89c;",fileAdd:"&#xe89f;",fileAlertBlack:"&#xe5f0;",fileAlert:"&#xe5f1;",fileImageBlack:"&#xe594;",fileImage:"&#xe5f2;",fileStatsBlack:"&#xe596;",fileStats:"&#xe5f3;",fileCheckBlack:"&#xe5f4;",fileCheck:"&#xe5f5;",fileKeyBlack:"&#xe5f6;",fileKey:"&#xe5f7;",fileQuestionBlack:"&#xe5f8;",fileQuestion:"&#xe5f9;",fileCancelBlack:"&#xe5fa;",fileCancel:"&#xe592;",fileLockBlack:"&#xeae1;",fileLock:"&#xe593;",fileStarBlack:"&#xeadf;",fileStar:"&#xeae2;",fileCogBlack:"&#xeae3;",fileCog:"&#xeae4;",fileSourceBlack:"&#xeae5;",fileSource:"&#xe595;",fileVideoBlack:"&#xe5fb;",fileVideo:"&#xe598;",fileAudioBlack:"&#xe5fc;",fileAudio:"&#xe5fd;",filePdfBlack:"&#xe5fe;",filePdf:"&#xe5ff;",fileWordBlack:"&#xe600;",fileWord:"&#xe601;",fileExcelBlack:"&#xe602;",fileExcel:"&#xe603;",filePowerpointBlack:"&#xe604;",filePowerpoint:"&#xe605;",fileExeBlack:"&#xe606;",fileExe:"&#xe607;",fileSettingsBlack:"&#xe608;",fileSettings:"&#xe609;",filesBlack:"&#xe60a;",files:"&#xe60b;",fileDelete:"&#xe597;",clipboard:"&#xe14f;",copy:"&#xe14d;",popup:"&#xe883;",folder:"&#xe2c7;",newFolder:"&#xe2cc;",folderEmpty:"&#xe2c8;",folderPictures:"&#xe8a7;",picture:"&#xe410;",pictures:"&#xe413;",pictureSize:"&#xe433;",camera:"&#xe412;",video:"&#xe404;",music:"&#xe3a1;",cut:"&#xe14e;",fingerprint:"&#xe90d;",cd:"&#xe019;",education:"&#xe80c;",hand:"&#xe92e;",sun:"&#xe1ad;",moon:"&#xe3a7;",parental:"&#xeb42;",print:"&#xe8ad;",lightning:"&#xe3e7;",quoteOpen:"&#xe0d6;",quoteClose:"&#xe244;",quote:"&#xe245;",sentimentVerySatisfied:"&#xe815;",sentimentSatisfied:"&#xe813;",sentimentNeutral:"&#xe812;",sentimentDissatisfied:"&#xe811;",sentimentVeryDissatisfied:"&#xe7f3;",sentimentDead:"&#xe814;",kiwi:"&#xe59a;",atom:"&#xe59b;",brain:"&#xe1c1;",deathstarIncomplete:"&#xe1c2;",deathstar:"&#xe1c3;",poop:"&#xe59c;",easterEgg:"&#xe59d;",easterEggFull:"&#xe59e;",dragHorizontal:"&#xe59f;",dragVertical:"&#xe5a0;",drag:"&#xe5a1;",twitterCircle:"&#xe5a2;",twitterSquare:"&#xe5a3;",facebookSquare:"&#xe5a4;",facebook:"&#xe5a5;",twitter:"&#xe5a6;",uploadNetwork:"&#xe5a7;",play:"&#xe037;",pause:"&#xe034;",previous:"&#xe020;",next:"&#xe01f;",first:"&#xe045;",last:"&#xe044;",repeat:"&#xe040;",record:"&#xe061;",eject:"&#xe8fb;",capslock:"&#xe318;",mute:"&#xe04f;",volume:"&#xe050;",volumeUp:"&#xe050;",sound:"&#xe050;",volumeDown:"&#xe04d;",volumeMute:"&#xe04e;",mic:"&#xe029;",microphoneOff:"&#xe02b;",micVoice:"&#xe8c8;",microphoneNone:"&#xe02a;",field:"&#xe3c0;",fieldEdit:"&#xe3c1;",list:"&#xe896;",bulletList:"&#xe898;",addToList:"&#xe03b;",tickList:"&#xe065;",sendList:"&#xe05f;",reorderList:"&#xe16d;",mouse:"&#xe323;",keyboard:"&#xe312;",screen:"&#xe333;",desktop:"&#xe30c;",desktopDashboard:"&#xe0d9;",desktopTowerMonitor:"&#xe0db;",desktopTower:"&#xe0dc;",laptop:"&#xe31e;",phone:"&#xe0cd;",mobile:"&#xe324;",mobileSettings:"&#xe0de;",tablet:"&#xe331;",portrait:"&#xe0dd;",landscape:"&#xe0d5;",landscapeLock:"&#xe1be;",portraitLock:"&#xe1bf;",rotationLock:"&#xe1c0;",rotation:"&#xe1c4;",chrome:"&#xe5a8;",firefox:"&#xe5a9;",safari:"&#xe5aa;",egde:"&#xe5ab;",google:"&#xe5ac;",googleDrive:"&#xe5ad;",adobe:"&#xe5ae;",viewJs:"&#xe5af;",amazon:"&#xe5b0;",icomoon:"&#xe585;",cfDrag:"&#xe5b1;",cfSection:"&#xe5b2;",cfAffinityField:"&#xe5b3;",cfAffinityKey:"&#xe5e0;",cfAddress:"&#xe5b4;",cfAttach:"&#xe5b5;",cfAttachMulti:"&#xe5b6;",cfBankAccount:"&#xe5b7;",cfCurrency:"&#xe5b8;",cfDate:"&#xe5b9;",cfDraw:"&#xe5ba;",cfDropDown:"&#xe5bb;",cfEffectiveDate:"&#xe5bc;",cfEmail:"&#xe5bd;",cfDocsign:"&#xe591;",cfExplanation:"&#xe5be;",cfLink:"&#xe5bf;",cfMemo:"&#xe5c0;",cfMultiCheckbox:"&#xe5c1;",cfNumberDecimal:"&#xe5c2;",cfNumber:"&#xe5c3;",cfParagraph:"&#xe5c5;",cfRadioButtonList:"&#xe5c6;",cfPageBreak:"&#xe5c7;",cfCheckbox:"&#xe5cc;",cfTaxNumber:"&#xe5df;",cfHeading:"&#xe5ce;",cfTableContents:"&#xe5cf;",cfTextbox:"&#xe5dd;",cfYoutube:"&#xe5de;"},Array.prototype.forEach||(Array.prototype.forEach=function(e){var t,i,s,o,a;if(null==this)throw new TypeError("this is null or not defined");if("function"!=typeof e)throw new TypeError(e+" is not a function");for(o=(s=Object(this)).length>>>0,arguments.length>1&&(t=arguments[1]),i=0;i<o;)i in s&&(a=s[i],e.call(t,a,i,s)),i++}),Array.prototype.removeEmpty||(Array.prototype.removeEmpty=function(){return this.filter((function(e){return null!=e&&(!Affinity2018.isString(e)||""!==e)}))}),Array.prototype.removeDuplicates||(Array.prototype.removeDuplicates=function(){var e={boolean:{},number:{},string:{}},t=[];return this.filter((function(i){var s=typeof i;return s in e?!e[s].hasOwnProperty(i)&&(e[s][i]=!0):!(t.indexOf(i)>=0)&&t.push(i)}))}),window.NodeList&&!NodeList.prototype.forEach&&Array.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach),prototype=Element.prototype,prototype.hasAttribute=prototype.hasAttribute||function(e){return!(!this.attributes[e]||!this.attributes[e].specified)},Date.prototype.clone||(Date.prototype.clone=function(){return new Date(this.getTime())}),Date.prototype.isValid||(Date.prototype.isValid=function(){return this instanceof Date&&!isNaN(this)}),window.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(e){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null})),String.prototype.startsWith||Object.defineProperty(String.prototype,"startsWith",{value:function(e,t){var i=t>0?0|t:0;return this.substring(i,i+e.length)===e}}),String.prototype.endsWith||(String.prototype.endsWith=function(e,t){return(void 0===t||t>this.length)&&(t=this.length),this.substring(t-e.length,t)===e}),Affinity2018.hasOwnProperty("type")||(Affinity2018.ClasstTypes={},"Boolean Number String Function Array Date RegExp Object Error Event CustomEvent HTMLElement".split(" ").forEach((function(e,t){Affinity2018.ClasstTypes["[object "+e+"]"]=e.toLowerCase()})),Affinity2018.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?e instanceof HTMLElement?"HTMLElement":Affinity2018.ClasstTypes[toString.call(e)]||"object":typeof e},Affinity2018.Type=Affinity2018.type),Affinity2018.hasOwnProperty("uuid")||(Affinity2018.uuid=function(){return String("ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz").charAt(Math.round(52*Math.random()))+Math.random().toString(36).substr(2,9)}),Affinity2018.hasOwnProperty("isNull")||(Affinity2018.isNull=function(e){return null==e}),Affinity2018.hasOwnProperty("isDomElement")||(Affinity2018.isDomElement=function(e){try{return e instanceof HTMLElement}catch(t){return"object"==typeof e&&1===e.nodeType&&"object"==typeof e.style&&"object"==typeof e.ownerDocument}},Affinity2018.isDomElementReturn=function(e){return!!Affinity2018.isDomElement(e)&&e},Affinity2018.isNode=Affinity2018.isElement=Affinity2018.isDomElement),Affinity2018.hasOwnProperty("isArray")||(Affinity2018.isArray=function(e){return Array.isArray(e)},Affinity2018.isArrayReturn=function(e){return!!Affinity2018.isArray(e)&&e}),Affinity2018.hasOwnProperty("isNumeric")||(Affinity2018.isNumeric=function(e){return!isNaN(parseFloat(e))},Affinity2018.isNumericReturn=function(e){return!!Affinity2018.isNumeric(e)&&e}),Affinity2018.hasOwnProperty("isInt")||(Affinity2018.isInt=function(e){return Affinity2018.isNumeric(e)&&!e.toString().contains(".")},Affinity2018.isIntReturn=function(e){return!!Affinity2018.isInt(e)&&e}),Affinity2018.hasOwnProperty("isFunction")||(Affinity2018.isFunction=function(e){return"function"==typeof e&&e},Affinity2018.isFunctionReturn=function(e){return!!Affinity2018.isFunction(e)&&e},Affinity2018.isMethod=Affinity2018.isFunction,Affinity2018.isMethodReturn=Affinity2018.isFunctionReturn),Affinity2018.hasOwnProperty("isDate")||(Affinity2018.isDate=function(e){return"[object Date]"===Object.prototype.toString.call(e)},Affinity2018.isDateReturn=function(e){return!!Affinity2018.isDate(e)&&e}),Affinity2018.hasOwnProperty("isDateValid")||(Affinity2018.isDateValid=function(e){return null!==e&&!1!==e&&void 0!==e&&Affinity2018.isDate(e)&&e.isValid()}),Affinity2018.hasOwnProperty("isBool")||(Affinity2018.isBool=function(e){return null!==e&&"boolean"==typeof e},Affinity2018.isBoolReturn=function(e){return!!Affinity2018.isBool(e)&&e}),Affinity2018.hasOwnProperty("isWindow")||(Affinity2018.isWindow=function(e){return null!=e&&e===e.window},Affinity2018.isWindowReturn=function(e){return!!Affinity2018.isWindow(e)&&e}),Affinity2018.hasOwnProperty("isClass")||(Affinity2018.isClass=function(e){return e&&e instanceof Object&&e.constructor&&e.constructor.name&&(Affinity2018.Classes.contains(e.constructor.name)||Affinity2018.Classes.Plugins.contains(e.constructor.name))}),Affinity2018.hasOwnProperty("isObject")||(Affinity2018.isObject=function(e){return!(null===e||"object"!=typeof e||e.nodeType||Affinity2018.isWindow(e)||e.constructor&&!hasOwnProperty.call(e.constructor.prototype,"isPrototypeOf"))},Affinity2018.isObjectReturn=function(e){return!!Affinity2018.isObject(e)&&e}),Affinity2018.hasOwnProperty("isStringifiedObject")||(Affinity2018.isStringifiedObject=function(e){if(Affinity2018.isString(e)&&""!==e.trim())try{var t=JSON.parse(e.trim());return Affinity2018.isObject(t)||Affinity2018.isArray(t)}catch(e){}return!1}),Affinity2018.hasOwnProperty("isUrl")||(Affinity2018.isUrl=function(e){return"string"==typeof e&&(""!==e.trim()&&(e=e.trim(),!!new RegExp("(https?://(?:www.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|www.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9].[^s]{2,}|https?://(?:www.|(?!www))[a-zA-Z0-9]+.[^s]{2,}|www.[a-zA-Z0-9]+.[^s]{2,})").test(e)))},Affinity2018.isUrlReturn=function(e){return!!Affinity2018.isUrl(e)&&e}),Affinity2018.hasOwnProperty("isEmptyObject")||(Affinity2018.isEmptyObject=function(e){for(var t in e)return!1;return!0}),Affinity2018.hasOwnProperty("isString")||(Affinity2018.isString=function(e){return"string"==typeof e}),Affinity2018.hasOwnProperty("isEvent")||(Affinity2018.isEvent=function(e){return!(!e||null==e||"undefined"===e||Affinity2018.isString(e)||Affinity2018.isBool(e)||Affinity2018.isDate(e)||Affinity2018.isMethod(e)||!(e&&e instanceof Event)&&!(e&&"originalEvent"in e&&e.originalEvent instanceof Event))}),Affinity2018.hasOwnProperty("isPropString")||(Affinity2018.isPropString=function(e,t){return!("object"!=typeof e||!e.hasOwnProperty(t)||"string"!=typeof e[t]||Affinity2018.isNull(e[t]))}),Affinity2018.hasOwnProperty("isPropInt")||(Affinity2018.isPropInt=function(e,t){return!!(Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Affinity2018.isNumeric(e[t]))}),Affinity2018.hasOwnProperty("isPropBool")||(Affinity2018.isPropBool=function(e,t){return!!(Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Affinity2018.isBool(e[t]))}),Affinity2018.hasOwnProperty("isPropArray")||(Affinity2018.isPropArray=function(e,t){return!!(Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Array.isArray(e[t]))&&e[t]}),Affinity2018.hasOwnProperty("isPropObject")||(Affinity2018.isPropObject=function(e,t){return!!(Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Affinity2018.isObject(e[t]))&&e[t]}),Affinity2018.hasOwnProperty("isPropFunction")||(Affinity2018.isPropFunction=function(e,t){return!!(Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Affinity2018.isFunction(e[t]))&&e[t]},Affinity2018.isPropMethod=Affinity2018.isPropFunction),Affinity2018.hasOwnProperty("padLeft")||(Affinity2018.padLeft=function(e,t,i){for(e+="";e.length<i;)e=t+e;return e},Affinity2018.PadLeft=Affinity2018.padLeft),Affinity2018.hasOwnProperty("padRight")||(Affinity2018.padRight=function(e,t,i){for(e+="";e.length<i;)e+=t;return e},Affinity2018.PadRight=Affinity2018.padRight),Affinity2018.hasOwnProperty("getPosition")||(Affinity2018.getPosition=function(e){let t=e.getBoundingClientRect(),i=window.pageXOffset||document.documentElement.scrollLeft,s=window.pageYOffset||document.documentElement.scrollTop;return{top:t.top+s,left:t.left+i}}),Affinity2018.hasOwnProperty("getSize")||(Affinity2018.getSize=function(e){let t=e.getBoundingClientRect();return{width:t.width,height:t.height}}),Affinity2018.hasOwnProperty("getOffsetRect")||(Affinity2018.getOffsetRect=function(e){let t=window.pageXOffset||document.documentElement.scrollLeft,i=window.pageYOffset||document.documentElement.scrollTop,s=e.parentNode.getBoundingClientRect(),o=e.getBoundingClientRect();return{width:o.width,height:o.height,top:o.top-s.top+i,right:o.right-s.right,bottom:o.bottom-s.bottom,left:o.left-s.left+t,x:o.right-s.right,y:o.top-s.top}}),Affinity2018.hasOwnProperty("getWindowSize")||(Affinity2018.getWindowSize=function(){var e={x:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,y:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight};return e.width=e.x,e.height=e.y,e}),Affinity2018.hasOwnProperty("getPageSize")||(Affinity2018.getPageSize=function(){var e={x:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clienWidth,document.documentElement.clientWidth),y:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)};return e.width=e.x,e.height=e.y,e}),Affinity2018.hasOwnProperty("getParent")||(Affinity2018.getParent=function(e,t,i){var s=0;if(i=isNaN(parseInt(i))?5:parseInt(i),t=t.replace(".","").replace("#","").trim(),!e||!t||""===t.trim())return!1;if(e.className.split(" ").filter((function(e){return e})).contains(t))return e;if(e.tagName.toLowerCase()===t.trim().toLowerCase())return e;if(e.id.toLowerCase()===t.trim().toLowerCase())return e;for(;e.parentElement;){if(e.parentElement.className.split(" ").filter((function(e){return e})).contains(t))return e.parentElement;if(e.parentElement.tagName.toLowerCase()===t.trim().toLowerCase())return e.parentElement;if(e=e.parentElement,++s>=i)return!1}return!1}),Affinity2018.getDate=function(e,t){if(t=Affinity2018.paramOrDefault(t,!1,"string"),Affinity2018.isDate(e))return t?luxon.DateTime.fromJSDate(e).toFormat(t):e;var i,s,o;if(Affinity2018.isString(e)){if(e.startsWith("/Date(")&&e.endsWith(")/"))return i=e.slice(6,-2),s=parseInt(i),o=luxon.DateTime.fromMillis(s,{zone:"utc"}),t?o.toLocal().toFormat(t):o.toLocal().toJSDate();if((o=luxon.DateTime.fromJSDate(Date.parse(e),{zone:"local"})).isValid)return t?o.toFormat(t):o.toJSDate()}return t?luxon.DateTime.local().toFormat(t):new Date},Affinity2018.hasOwnProperty("stringToDate")||(Affinity2018.stringToDate=function(e,t){if(!Affinity2018.isString(e)||Affinity2018.isString(e)&&""===e.trim())return null;if(t=Affinity2018.paramOrDefault(t,null),e.length>10&&!e.startsWith("/Date("))return e=e.replace("st","").replace("nd","").replace("rd","").replace(",",""),Affinity2018.isDateValid(Date.parse(e))?Date.parse(e):t;if((e=e.replace(/\s+/g,"")).startsWith("/Date("))return new Date(parseInt(e.replace(/\/Date\((-?\d+)\)\//,"$1")));if(2!==e.countString("/")&&2!==e.countString("\\")&&2!==e.countString("-")&&2!==e.countString(".")||(e=e.replace(/[^0-9]/g,"-")),2!==e.countString("-"))return t;var i=e.split("-");if(3!==i.length)return t;var s=parseInt(i[2]),o=parseInt(i[1]),a=parseInt(i[0]);if(isNaN(s+o+a))return t;if(s<100)return t;if(o>12&&a>12)return t;o>12&&a<=12&&(i=[o,a,s]);var n=new Date(i[2],i[1]-1,i[0],0,0,0);return n.isValid()?n:t}),Affinity2018.hasOwnProperty("stringToObject")||(Affinity2018.stringToObject=function(e){return Affinity2018.isObject(e)?e:Affinity2018.isString(e)&&Affinity2018.isStringifiedObject(e)?JSON.parse(e):null}),Affinity2018.hasOwnProperty("setObjectToDataset")||(Affinity2018.setObjectToDataset=function(e,t,i){return Affinity2018.isObject(i)?(e.dataset[t]=window.btoa(JSON.stringify(i)),e.dataset[t]):Affinity2018.isString(i)&&Affinity2018.isStringifiedObject(i)?(e.dataset[t]=window.btoa(i),e.dataset[t]):null}),Affinity2018.hasOwnProperty("getObjectFromDataset")||(Affinity2018.getObjectFromDataset=function(e,t){if(e.dataset[t]){var i=null;try{var s=e.dataset[t],o=window.atob(s);if(i=JSON.parse(o),Affinity2018.isObject(i))return i}catch(e){console.warn(e)}}return null}),Affinity2018.hasOwnProperty("stopEvent")||(Affinity2018.stopEvent=function(e){try{e.preventDefault()}catch(e){console.warn("failed to prevent default")}try{e.stopPropagation()}catch(e){console.warn("failed to stop propagation")}try{e.returnValue=!1}catch(e){}try{e.cancelBubble=!0}catch(e){}if("detail"in this&&"keyboardEvent"in this.detail){try{this.detail.keyboardEvent.preventDefault()}catch(e){console.warn("failed to prevent default")}try{this.detail.keyboardEvent.stopPropagation()}catch(e){console.warn("failed to stop propagation")}}},Affinity2018.StopEvent=Affinity2018.stopEvent,Affinity2018.StopEvents=Affinity2018.stopEvent,Affinity2018.stopEvents=Affinity2018.stopEvent,Event.prototype.stop||(Event.prototype.stop=function(){Affinity2018.StopEvent(this)}),CustomEvent.prototype.stop||(CustomEvent.prototype.stop=function(){Affinity2018.StopEvent(this)})),Affinity2018.hasOwnProperty("getUrlData")||(Affinity2018.getHrefData=function(e){var t,i=document.createElement("a");return e.toLowerCase().trim().startsWith("http")||e.toLowerCase().trim().startsWith("ftp")||(e="http://"+e),i.href=e,t={original:e,protocol:i.protocol,hostname:i.hostname,port:i.port,pathname:i.pathname,search:i.search,hash:i.hash,host:i.host},i=null,t},Affinity2018.getUrlData=function(e){var t=Affinity2018.getHrefData(e),i=Affinity2018.getHrefData("null");return i.pathname=i.pathname.replace("null",""),t.current=i.host,t},Affinity2018.returnFormattedUrl=function(e){var t=$a.getUrlData(e),i=""!==t.port?":"+t.port:"",s=""!==t.search?("?"===t.search.charAt(0)?"":"?")+t.search:"",o=""!==t.hash?("#"===t.hash.charAt(0)?"":"#")+t.hash:"";return newUrl="{0}//{1}{2}{3}{4}{5}".format(t.protocol,t.hostname,i,t.pathname,s,o),newUrl="/"===newUrl.charAt(newUrl.length-1)?newUrl.substring(0,newUrl.length-1):newUrl,newUrl}),Affinity2018.hasOwnProperty("getBaseUrl")||(Affinity2018.getBaseUrl=function(){let e="";return e+=document.location.protocol,e+="//",e+=document.location.hostname,e+="80"===document.location.port?"":":"+document.location.port,e},Affinity2018.GetBaseUrl=Affinity2018.getBaseUrl),Affinity2018.hasOwnProperty("localiseUrl")||(Affinity2018.localiseUrl=function(e){if(!Affinity2018.isString(e))return e;var t=e.split("/"),i=t[0],s=t[2],o=i+"//"+s;return i=(t=window.location.href.split("/"))[0],s=t[2],e.replace(o,i+"//"+s)},Affinity2018.LocaliseUrl=Affinity2018.localiseUrl),Affinity2018.hasOwnProperty("jsonCloneObject")||(Affinity2018.jsonCloneObject=function(e){if(!Affinity2018.isObject(e)&&Affinity2018.isArray(e))return e;try{return JSON.parse(JSON.stringify(e))}catch(e){}return e}),Affinity2018.hasOwnProperty("objectDeepMerge")||(Affinity2018.objectDeepMerge=function(e){function t(e){return e&&"object"==typeof e&&"[object RegExp]"!==Object.prototype.toString.call(e)&&"[object Date]"!==Object.prototype.toString.call(e)}function i(e){return Array.isArray(e)?[]:{}}function s(e,s){return s&&!0===s.clone&&t(e)?n(i(e),e,s):e}function o(e,i,o){var a=e.slice();return i.forEach((function(i,r){void 0===a[r]?a[r]=s(i,o):t(i)?a[r]=n(e[r],i,o):-1===e.indexOf(i)&&a.push(s(i,o))})),a}function a(e,i,o){var a={};return t(e)&&Object.keys(e).forEach((function(t){a[t]=s(e[t],o)})),Object.keys(i).forEach((function(r){t(i[r])&&e[r]?a[r]=n(e[r],i[r],o):a[r]=s(i[r],o)})),a}function n(e,t,i){var n=Array.isArray(t),r=(i||{arrayMerge:o}).arrayMerge||o;return n?Array.isArray(e)?r(e,t,i):s(t,i):a(e,t,i)}n.all=function(e,t){if(!Array.isArray(e)||e.length<2)throw new Error("first argument should be an array with at least two elements");return e.reduce((function(e,i){return n(e,i,t)}))};var r,l=[];if(Array.isArray(arguments[0])&&1===arguments.length)for(r=0;r<arguments[0].length;r++)l.push(arguments[0][r]);else for(r=0;r<arguments.length;r++)l.push(arguments[r]);return n.all(l)}),Affinity2018.hasOwnProperty("getParent")||(Affinity2018.getParent=function(e,t,i){if(!Affinity2018.isNode(e))return!1;if(!Affinity2018.isString(t)||Affinity2018.isString(t)&&""===t.trim())return!1;var s=0;if(i=isNaN(parseInt(i))?5:parseInt(i),t=t.replace(".","").replace("#","").trim(),!e||!t||""===t.trim())return!1;if(e.className.split(" ").filter((function(e){return e})).contains(t))return e;if(e.tagName.toLowerCase()===t.trim().toLowerCase())return e;if(e.id.toLowerCase()===t.trim().toLowerCase())return e;for(;e.parentElement;){if(e.parentElement.className.split(" ").filter((function(e){return e})).contains(t))return e.parentElement;if(e.parentElement.tagName.toLowerCase()===t.trim().toLowerCase())return e.parentElement;if(e=e.parentElement,++s>=i)return!1}return!1},Affinity2018.GetParent=Affinity2018.getParent),Affinity2018.hasOwnProperty("getEventNode")||(Affinity2018.getEventNode=function(e,t){return!!(e&&"target"in e&&Affinity2018.isNode(e.target))&&Affinity2018.getParent(e.target,t,10)},Affinity2018.GetEventNode=Affinity2018.getEventNode),Affinity2018.hasOwnProperty("isNullOrEmpty")||(Affinity2018.isNullOrEmpty=function(e){return null===e||"string"==typeof e&&""===e.trim()},Affinity2018.GetEventNode=Affinity2018.getEventNode),Affinity2018.hasOwnProperty("FormatString")||(Affinity2018.FormatString=function(e,t){if("object"==typeof e&&(e=Object.keys(e).map((function(t){return e[t]})).join("")),1===t.length&&Affinity2018.isObject(t[0])){var i,s=t[0];for(i in s)s.hasOwnProperty(i)&&(e=e.replace(new RegExp("{"+i+"}","g"),s[i]));return e}return e.replace(/{(\d+)}/g,(function(e,i){return void 0!==t[i]?t[i]:e}))}),Affinity2018.hasOwnProperty("Trace")||(Affinity2018.Trace=function(e,t,i){var s=function(){try{throw Error("")}catch(e){return e}}(),o="stack"in s&&"string"==typeof s.stack?s.stack.split("\n"):[],a=o.length>3?o[3].toString():o.length>0?o[o.length-1].toString():"",n="",r="",l="";a.trim().startsWith("at ")&&(n=(a=a.trim().replace("at ","")).substring(0,a.indexOf(" ")),l=(r=a.replace(n,"").replace("(","").replace(")","").trim()).split(":").length>1?r.split(":")[r.split(":").length-2]:"");var d,h,c="#f19880",u="#390c00",p="#ff8540",f="#3a2e27",m="#ffda8a",y="#402d05",g="#c6e59a",v="#23330d",A="#8be0f9",w="#06303d",N="#b3b3b3",b="#333333",S="#d9d9d9",D="#242424",C="",_="----------------------------------------------------------------------------";switch(i.trim().toLowerCase()){case"critical":C="color:"+c+";font-weight:bold;background:"+u;break;case"error":C="color:"+c+";font-weight:normal;background:"+u;break;case"important":C="color:"+p+";font-weight:bold;background:"+f;break;case"warning":C="color:"+p+";font-weight:normal;background:"+f;break;case"medium":case"low":C="color:"+m+";font-weight:normal;background:"+y;break;case"ok":case"success":C="color:"+g+";font-weight:normal;background:"+v;break;case"info":C="color:"+A+";font-weight:normal;background:"+w;break;case"note":C="color:"+N+";font-weight:normal;background:"+b;break;default:C="color:"+S+";font-weight:normal;background:"+D}C="color:#8be0f9;font-weight:bold;background:#06303d",console.groupCollapsed("%c"+e+" "+_.substr(e.length+1),C),console.log("%c"+n+" at line "+l,C),console.log("%c"+r,C),t&&Affinity2018.isArray(t)&&(d=0,t.forEach((function(e){"string"===Affinity2018.type(e[0])&&e[0].length>d&&(d=e[0].length)})),h="".padLeft(" ",d+1),t.forEach((function(e){"string"===Affinity2018.type(e[0])?console.log("%c"+e[0]+h.substr(e[0].length)+" : ",C,e[1]):console.log(e[0],e[1])}))),console.log("%c"+_.substr(0,_.length-2),C),console.groupEnd()}),Affinity2018.hasOwnProperty("LogError")||(Affinity2018.LogError=function(e,t,i,s){var o=function(){try{throw Error("")}catch(e){return e}}(),a="stack"in o&&"string"==typeof o.stack?o.stack.split("\n"):[],n=a.length>3?a[3].toString():a.length>0?a[a.length-1].toString():"",r="",l="",d="";n.trim().startsWith("at ")&&(r=(n=n.trim().replace("at ","")).substring(0,n.indexOf(" ")),d=(l=n.replace(r,"").replace("(","").replace(")","").trim()).split(":").length>1?l.split(":")[l.split(":").length-2]:"");var h="#f19880",c="#390c00",u="#ff8540",p="#3a2e27",f="#ffda8a",m="#402d05",y="#c6e59a",g="#23330d",v="#8be0f9",A="#06303d",w="#b3b3b3",N="#333333",b="#d9d9d9",S="#242424",D="";switch(t.toLowerCase()){case"critical":D="color:"+h+";font-weight:bold;background:"+c;break;case"error":D="color:"+h+";font-weight:normal;background:"+c;break;case"important":D="color:"+u+";font-weight:bold;background:"+p;break;case"warning":D="color:"+u+";font-weight:normal;background:"+p;break;case"medium":case"low":D="color:"+f+";font-weight:normal;background:"+m;break;case"ok":case"success":D="color:"+y+";font-weight:normal;background:"+g;break;case"info":D="color:"+v+";font-weight:normal;background:"+A;break;case"note":D="color:"+w+";font-weight:normal;background:"+N;break;default:D="color:"+b+";font-weight:normal;background:"+S}if(console.groupCollapsed("%c"+e+" ["+t.toUpperCase()+"]",D),console.log("%c"+r+" at line "+d,D),console.log("%c"+l,D),console.log("%c"+i,D),messages=[],s){if("string"==typeof s)try{s=JSON.parse(s)}catch(o){}Affinity2018.isObject(s)&&(s=JSON.stringify(s,null,2)),messages.push(s)}i=messages.join("\n"),console.log("%c"+i,D),console.groupEnd()}),Affinity2018.hasOwnProperty("ThrowError")||(Affinity2018.ThrowError=function(e,t,i,s){var o=function(){try{throw Error("")}catch(e){return e}}(),a="stack"in o&&"string"==typeof o.stack?o.stack.split("\n"):[],n=a.length>3?a[3].toString():a.length>0?a[a.length-1].toString():"",r=i.replace(/\n/g,"<br />"),l="",d="",h="";if(n.trim().startsWith("at ")&&(l=(n=n.trim().replace("at ","")).substring(0,n.indexOf(" ")),h=(d=n.replace(l,"").replace("(","").replace(")","").trim()).split(":").length>1?d.split(":")[d.split(":").length-2]:""),Affinity2018.HidePageLoader(),s){if("string"==typeof s)try{s=JSON.parse(s)}catch(o){}Affinity2018.isObject(s)&&(s=JSON.stringify(s,null,2)),i=i+="\n"+s}throw""!==l&&(i=i+="\n"+l+" at line "+h),""!==d&&(i=i+="\n"+d),r=i.replace(/\n/g,"<br />"),{name:e,level:"["+t+"]",message:i,htmlMessage:r,toString:function(){return this.name+": "+this.message}}}),Affinity2018.hasOwnProperty("ForceSectionTop")||(Affinity2018.ForceSectionTop=function(e){Affinity2018.isNode(e)&&e.closest(".section")&&(document.querySelectorAll(".section.step-up").forEach((function(e){e.classList.remove("step-up")})),e.closest(".section").classList.add("step-up"))}),Affinity2018.hasOwnProperty("ResetForceSectionTop")||(Affinity2018.ResetForceSectionTop=function(e){Affinity2018.isNode(e)&&e.closest(".section")&&e.closest(".section").classList.remove("step-up")}),Affinity2018.hasOwnProperty("valueOrDefault")||(Affinity2018.valueOrDefault=function(e,t,i){return void 0!==t&&void 0!==e&&void 0!==i&&Affinity2018.isString(t)&&""!==t.trim()&&Affinity2018.isObject(e)&&e.hasOwnProperty(t)&&Affinity2018.type(e[t])==Affinity2018.type(i)?e[t]:void 0!==i?i:void console.error("defaultValue not set")}),Affinity2018.hasOwnProperty("paramOrDefault")||(Affinity2018.paramOrDefault=function(e,t,i){return(i="string"===Affinity2018.type(i)&&""!==i.trim()&&i)?Affinity2018.type(e)==i?e:t:Affinity2018.type(e)==Affinity2018.type(t)?e:t}),Affinity2018.hasOwnProperty("toBoolean")||(Affinity2018.toBoolean=function(e){if("boolean"===Affinity2018.type(e))return e;if("string"===Affinity2018.type(e)){if("true"===e.trim().toLowerCase())return!0;if("false"===e.trim().toLowerCase())return!1}return void 0===e&&null!==e}),Affinity2018.hasOwnProperty("decodeHTML ")||(Affinity2018.decodeHTML=function(e){if(Affinity2018.isString(e)){e=e.replace(/\<br.*?\>/gi,"\n");var t=document.createElement("textarea");t.innerHTML=e,e=t.value,t=null}return e}),Affinity2018.hasOwnProperty("lockBodyScroll")||(Affinity2018.lockBodyScroll=function(){document.body.classList.contains("disable-scroll")||(Affinity2018.lockBodyScroll_lastScrollY=(window.pageYOffset||document.documentElement.scrollTop)-(document.documentElement.clientTop||0),document.body.style.top=0-Affinity2018.lockBodyScroll_lastScrollY+"px",document.body.classList.add("disable-scroll"))},Affinity2018.unlockBodyScroll=function(){document.body.classList.contains("disable-scroll")&&(document.body.classList.remove("disable-scroll"),document.body.removeAttribute("style"),window.scrollTo(0,Affinity2018.lockBodyScroll_lastScrollY))}),Affinity2018.hasOwnProperty("ClassEvents")||(Affinity2018.ClassEvents=class{constructor(){["addEventListener","removeEventListener","dispatchEvent"].bindEach(this),this.eventListerners={}}addEventListener(e,t){"string"==typeof e&&"function"==typeof t&&(this.eventListerners.hasOwnProperty(e.toLowerCase())||(this.eventListerners[e.toLowerCase()]=[]),this.eventListerners[e.toLowerCase()].contains(t)||this.eventListerners[e.toLowerCase()].push(t))}removeEventListener(e,t){if("string"==typeof e&&"function"==typeof t&&this.eventListerners.hasOwnProperty(e.toLowerCase())&&Array.isArray(this.eventListerners[e.toLowerCase()]))for(var i=0;i<this.eventListerners[e.toLowerCase()].length;i++)if(this.eventListerners[e.toLowerCase()][i]===t){this.eventListerners[e.toLowerCase()][i]=null,this.eventListerners[e.toLowerCase()].splice(i,1);break}}dispatchEvent(e){if(e instanceof Event&&this.eventListerners.hasOwnProperty(e.type.toLowerCase()))for(var t=0;t<this.eventListerners[e.type.toLowerCase()].length;t++)"function"==typeof this.eventListerners[e.type.toLowerCase()][t]&&(e.hasOwnProperty("detail")&&e.detail.hasOwnProperty("dispatchObject")?this.eventListerners[e.type.toLowerCase()][t](e.detail.dispatchObject):this.eventListerners[e.type.toLowerCase()][t](e))}}),!Affinity2018.hasOwnProperty("GetMimeType")){for(var key in Affinity2018.FileTypeGroupData={Spreadsheet:{Name:"Spreadsheet",Description:"MS Excel files",Icon:Affinity2018.icons.fileExcelBlack,IconClass:"icon-file-excel-black",TypeData:[{Types:["xl","xls","xlsx","xll"],Mime:"application/excel"},{Types:["csv"],Mime:"application/vnd.ms-excel"}]},Word:{Name:"Word",Description:"MS Word files",Icon:Affinity2018.icons.fileWordBlack,IconClass:"icon-file-word-black",TypeData:[{Types:["doc","docx","dot","word","w6w"],Mime:"application/msword"},{Types:["rtx"],Mime:"text/richtext"}]},Presentation:{Name:"Presentation",Description:"MS PowerPoint files",Icon:Affinity2018.icons.filePowerpointBlack,IconClass:"icon-file-powerpoint-black",TypeData:[{Types:["ppt","pptx","pot"],Mime:"application/powerpoint"}]},PDF:{Name:"PDF",Description:"PDF files",Icon:Affinity2018.icons.filePdfBlack,IconClass:"icon-file-pdf-black",TypeData:[{Types:["pdf"],Mime:"application/pdf"}]},Code:{Name:"Code",Description:"Code and Script files",Icon:Affinity2018.icons.fileSourceBlack,IconClass:"icon-file-source-black",TypeData:[{Types:["ps1","py","cs","js"],Mime:"text/plain"},{Types:["xml"],Mime:"text/xml"},{Types:["htm","htmls","shtml","xshtml","xhtml","html"],Mime:"application/xml+xhtml"},{Types:["wrl","wrz"],Mime:"x-world/x-vrml"}]},Text:{Name:"Text",Description:"Plain text files",Icon:Affinity2018.icons.fileTextBlack,IconClass:"icon-file-text-black",TypeData:[{Types:["txt","text","ini","cfg","config","json"],Mime:"text/plain"},{Types:["rtf","rtx"],Mime:"application/rtf"}]},Images:{Name:"Images",Description:"Image format files",Icon:Affinity2018.icons.fileImageBlack,IconClass:"icon-file-image-black",TypeData:[{Types:["webp"],Mime:"image/webp"},{Types:["png"],Mime:"image/png"},{Types:["jpg","jpe","jfif","pjpeg","pjp"],Mime:"image/jpeg"},{Types:["gif"],Mime:"image/gif"},{Types:["tif","tiff"],Mime:"image/tiff"},{Types:["bmp"],Mime:"image/x-windows-bmp"},{Types:["pic"],Mime:"image/x-pict"},{Types:["pbm"],Mime:"image/x-portable-bitmap"},{Types:["eps"],Mime:"application/postscript"}]},Vector:{Name:"Vector",Description:"Vector image, Adobe Illustrator files",Icon:Affinity2018.icons.fileImageBlack,IconClass:"icon-file-image-black",TypeData:[{Types:["svg"],Mime:"image/svg+xml"},{Types:["ai","eps"],Mime:"application/postscript"}]},Video:{Name:"Video",Description:"Video format files",Icon:Affinity2018.icons.fileVideoBlack,IconClass:"icon-file-video-black",TypeData:[{Types:["webm"],Mime:"video/webm"},{Types:["mp4"],Mime:"video/mp4"},{Types:["mp4","mpg","mpeg","mpe","m1v","mp2","mpa"],Mime:"video/mpeg"},{Types:["mkv"],Mime:"video/mp4"},{Types:["avi"],Mime:"video/x-msvideo"},{Types:["wmv","wmx"],Mime:"video/x-ms-wmx"},{Types:["flv"],Mime:"video/x-flv"},{Types:["mov","qt"],Mime:"video/quicktime"},{Types:["3gp"],Mime:"video/3gpp"},{Types:["m3u8"],Mime:"application/x-mpegURL"},{Types:["movie"],Mime:"video/x-sgi-movie"},{Types:["swf"],Mime:"application/x-shockwave-flash"}]},Audio:{Name:"Audio",Description:"Audio format files",Icon:Affinity2018.icons.fileAudioBlack,IconClass:"icon-file-audio-black",TypeData:[{Types:["aac"],Mime:"audio/aac"},{Types:["mp3"],Mime:"audio/mpeg"},{Types:["m3u"],Mime:"audio/x-mpegurl"},{Types:["wav"],Mime:"audio/vnd.wav"},{Types:["pcm"],Mime:"audio/L24"},{Types:["ogg","aif"],Mime:"audio/ogg"},{Types:["aiff"],Mime:"audio/x-aiff"},{Types:["au"],Mime:"audio/basic"},{Types:["ra","ram"],Mime:"audio/vnd.rn-realaudio"}]},Archives:{Name:"Archives",Description:"Archive and compressed files",Icon:Affinity2018.icons.fileZipBlack,IconClass:"icon-file-zip-black",TypeData:[{Types:["zip"],Mime:"application/zip"},{Types:["rar"],Mime:"application/x-rar-compressed"},{Types:["gzip","gz"],Mime:"aapplication/x-gzip"},{Types:["7z"],Mime:"application/x-7z-compressed"},{Types:["bz"],Mime:"application/x-7z-bzip"},{Types:["bz2"],Mime:"application/x-7z-bzip2"},{Types:["cab","bin"],Mime:"application/octet-stream"}]},Executables:{Name:"Executables",Description:"Executable files and stand-alone apps",Icon:Affinity2018.icons.executableBlack,IconClass:"icon-executable-black",TypeData:[{Types:["exe","msi"],Mime:"application/octet-stream"},{Types:["bat"],Mime:"text/plain"}]},Unknown:{Name:"Unknown",Description:"Any file types that is not known to Affinity2018",Icon:Affinity2018.icons.fileBlack,IconClass:"icon-file-black",TypeData:[{Types:[],Mime:"text/plain"}]}},Affinity2018.FileTypeGroups=[],Affinity2018.FileTypeGroupData)if(Affinity2018.FileTypeGroupData.hasOwnProperty(key)){Affinity2018.FileTypeGroups.push(key),Affinity2018.FileTypeGroupData[key].Types=[];for(var t=0;t<Affinity2018.FileTypeGroupData[key].TypeData.length;t++)Affinity2018.FileTypeGroupData[key].Types=Affinity2018.FileTypeGroupData[key].Types.concat(Affinity2018.FileTypeGroupData[key].TypeData[t].Types)}Affinity2018.GetMimeType=function(e){for(var t in e=(e=Affinity2018.isString(e)&&""!==e.trim()?e.toLowerCase().trim():"").replace(".",""),Affinity2018.FileTypeGroupData)if(Affinity2018.FileTypeGroupData.hasOwnProperty(t)&&Affinity2018.FileTypeGroupData[t].Types.contains(e))for(var i=0;i<Affinity2018.FileTypeGroupData[t].TypeData.length;i++)if(Affinity2018.FileTypeGroupData[t].TypeData[i].Types.contains(e))return Affinity2018.FileTypeGroupData[t].TypeData[i].Mime},Affinity2018.GetDocFileData=function(e){var i="";if(!Affinity2018.isString(e)||Affinity2018.isString(e)&&""===e.trim())return{type:Affinity2018.FileTypeGroupData.Unknown.Name,mime:Affinity2018.FileTypeGroupData.Unknown.TypeData[0].Mime,icon:Affinity2018.FileTypeGroupData.Unknown.Icon,iconClass:Affinity2018.FileTypeGroupData.Unknown.IconClass,ext:i};if((i=e.trim().toLowerCase()).contains(".")&&(i=(i=i.substring(i.lastIndexOf("."))).replace(".","")),""!==i)for(key in Affinity2018.FileTypeGroupData)if(Affinity2018.FileTypeGroupData.hasOwnProperty(key)&&Affinity2018.FileTypeGroupData[key].Types.contains(i))for(t=0;t<Affinity2018.FileTypeGroupData[key].TypeData.length;t++)if(Affinity2018.FileTypeGroupData[key].TypeData[t].Types.contains(i))return{type:Affinity2018.FileTypeGroupData[key].Name,mime:Affinity2018.FileTypeGroupData[key].TypeData[t].Mime,icon:Affinity2018.FileTypeGroupData[key].Icon,iconClass:Affinity2018.FileTypeGroupData[key].IconClass,ext:i};return{type:Affinity2018.FileTypeGroupData.Unknown.Name,mime:Affinity2018.FileTypeGroupData.Unknown.TypeData[0].Mime,icon:Affinity2018.FileTypeGroupData.Unknown.Icon,iconClass:Affinity2018.FileTypeGroupData.Unknown.IconClass,ext:i}}}Affinity2018.StringDistance=function(e,t){var i,s,o=e.toLowerCase(),a=t.toLowerCase(),n=[];if(0===o.length)return a.length;if(0===a.length)return o.length;for(i=0;i<=a.length;i++)n[i]=[i];for(s=0;s<=o.length;s++)n[0][s]=s;for(i=1;i<=a.length;i++)for(s=1;s<=o.length;s++)a.charAt(i-1)==o.charAt(s-1)?n[i][s]=n[i-1][s-1]:n[i][s]=Math.min(n[i-1][s-1]+1,Math.min(n[i][s-1]+1,n[i-1][s]+1));return n[a.length][o.length]},Affinity2018.Soundex=function(e){var t,i,s,o,a,n,r="";for("H"!=(a=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=e=e.toUpperCase()).replace(/[^A-Z]/gi," ")).replace(/^\s*/g,"")).replace(/\s*$/g,"")).replace(/^GH/g,"G")).replace(/DG/g,"G")).replace(/GH/g,"H")).replace(/GN/g,"N")).replace(/KN/g,"N")).replace(/PH/g,"F")).replace(/MP([STZ])/g,"M$1")).replace(/^PS/g,"S")).replace(/^PF/g,"F")).replace(/MB/g,"M")).replace(/TCH/g,"CH")).substr(0,1))&&"W"!=a||(r="-"+r.substr(1)),o=(r=(r=(r=(r=(r=(r=(r=r.replace(/[AEIOUYHW]/g,"0")).replace(/[BPFV]/g,"1")).replace(/[CSGJKQXZ]/g,"2")).replace(/[DT]/g,"3")).replace(/[L]/g,"4")).replace(/[MN]/g,"5")).replace(/[R]/g,"6")).length,s="",t="",n=0;n<o;n++)(i=r.charAt(n))==s?t+=" ":(t+=i,s=i);return r=(r=(r=(r=t).substr(1)).replace(/\s/g,"")).replace(/0/g,""),(r=a+(r+="0000000000")).substr(0,5)},Affinity2018.Md5Object=new class{constructor(){this.hex_chr="0123456789abcdef".split(""),"5d41402abc4b2a76b9719d911017c592"!==this.md5("hello")&&(this.add32=function(e,t){var i=(65535&e)+(65535&t);return(e>>16)+(t>>16)+(i>>16)<<16|65535&i})}md5cycle(e,t){var i=e[0],s=e[1],o=e[2],a=e[3];i=this.ff(i,s,o,a,t[0],7,-680876936),a=this.ff(a,i,s,o,t[1],12,-389564586),o=this.ff(o,a,i,s,t[2],17,606105819),s=this.ff(s,o,a,i,t[3],22,-1044525330),i=this.ff(i,s,o,a,t[4],7,-176418897),a=this.ff(a,i,s,o,t[5],12,1200080426),o=this.ff(o,a,i,s,t[6],17,-1473231341),s=this.ff(s,o,a,i,t[7],22,-45705983),i=this.ff(i,s,o,a,t[8],7,1770035416),a=this.ff(a,i,s,o,t[9],12,-1958414417),o=this.ff(o,a,i,s,t[10],17,-42063),s=this.ff(s,o,a,i,t[11],22,-1990404162),i=this.ff(i,s,o,a,t[12],7,1804603682),a=this.ff(a,i,s,o,t[13],12,-40341101),o=this.ff(o,a,i,s,t[14],17,-1502002290),s=this.ff(s,o,a,i,t[15],22,1236535329),i=this.gg(i,s,o,a,t[1],5,-165796510),a=this.gg(a,i,s,o,t[6],9,-1069501632),o=this.gg(o,a,i,s,t[11],14,643717713),s=this.gg(s,o,a,i,t[0],20,-373897302),i=this.gg(i,s,o,a,t[5],5,-701558691),a=this.gg(a,i,s,o,t[10],9,38016083),o=this.gg(o,a,i,s,t[15],14,-660478335),s=this.gg(s,o,a,i,t[4],20,-405537848),i=this.gg(i,s,o,a,t[9],5,568446438),a=this.gg(a,i,s,o,t[14],9,-1019803690),o=this.gg(o,a,i,s,t[3],14,-187363961),s=this.gg(s,o,a,i,t[8],20,1163531501),i=this.gg(i,s,o,a,t[13],5,-1444681467),a=this.gg(a,i,s,o,t[2],9,-51403784),o=this.gg(o,a,i,s,t[7],14,1735328473),s=this.gg(s,o,a,i,t[12],20,-1926607734),i=this.hh(i,s,o,a,t[5],4,-378558),a=this.hh(a,i,s,o,t[8],11,-2022574463),o=this.hh(o,a,i,s,t[11],16,1839030562),s=this.hh(s,o,a,i,t[14],23,-35309556),i=this.hh(i,s,o,a,t[1],4,-1530992060),a=this.hh(a,i,s,o,t[4],11,1272893353),o=this.hh(o,a,i,s,t[7],16,-155497632),s=this.hh(s,o,a,i,t[10],23,-1094730640),i=this.hh(i,s,o,a,t[13],4,681279174),a=this.hh(a,i,s,o,t[0],11,-358537222),o=this.hh(o,a,i,s,t[3],16,-722521979),s=this.hh(s,o,a,i,t[6],23,76029189),i=this.hh(i,s,o,a,t[9],4,-640364487),a=this.hh(a,i,s,o,t[12],11,-421815835),o=this.hh(o,a,i,s,t[15],16,530742520),s=this.hh(s,o,a,i,t[2],23,-995338651),i=this.ii(i,s,o,a,t[0],6,-198630844),a=this.ii(a,i,s,o,t[7],10,1126891415),o=this.ii(o,a,i,s,t[14],15,-1416354905),s=this.ii(s,o,a,i,t[5],21,-57434055),i=this.ii(i,s,o,a,t[12],6,1700485571),a=this.ii(a,i,s,o,t[3],10,-1894986606),o=this.ii(o,a,i,s,t[10],15,-1051523),s=this.ii(s,o,a,i,t[1],21,-2054922799),i=this.ii(i,s,o,a,t[8],6,1873313359),a=this.ii(a,i,s,o,t[15],10,-30611744),o=this.ii(o,a,i,s,t[6],15,-1560198380),s=this.ii(s,o,a,i,t[13],21,1309151649),i=this.ii(i,s,o,a,t[4],6,-145523070),a=this.ii(a,i,s,o,t[11],10,-1120210379),o=this.ii(o,a,i,s,t[2],15,718787259),s=this.ii(s,o,a,i,t[9],21,-343485551),e[0]=this.add32(i,e[0]),e[1]=this.add32(s,e[1]),e[2]=this.add32(o,e[2]),e[3]=this.add32(a,e[3])}cmn(e,t,i,s,o,a){return t=this.add32(this.add32(t,e),this.add32(s,a)),this.add32(t<<o|t>>>32-o,i)}ff(e,t,i,s,o,a,n){return this.cmn(t&i|~t&s,e,t,o,a,n)}gg(e,t,i,s,o,a,n){return this.cmn(t&s|i&~s,e,t,o,a,n)}hh(e,t,i,s,o,a,n){return this.cmn(t^i^s,e,t,o,a,n)}ii(e,t,i,s,o,a,n){return this.cmn(i^(t|~s),e,t,o,a,n)}md51(e){var t,i=e.length,s=[1732584193,-271733879,-1732584194,271733878];for(t=64;t<=e.length;t+=64)this.md5cycle(s,this.md5blk(e.substring(t-64,t)));e=e.substring(t-64);var o=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0];for(t=0;t<e.length;t++)o[t>>2]|=e.charCodeAt(t)<<(t%4<<3);if(o[t>>2]|=128<<(t%4<<3),t>55)for(this.md5cycle(s,o),t=0;t<16;t++)o[t]=0;return o[14]=8*i,this.md5cycle(s,o),s}md5blk(e){var t,i=[];for(t=0;t<64;t+=4)i[t>>2]=e.charCodeAt(t)+(e.charCodeAt(t+1)<<8)+(e.charCodeAt(t+2)<<16)+(e.charCodeAt(t+3)<<24);return i}rhex(e){for(var t="",i=0;i<4;i++)t+=this.hex_chr[e>>8*i+4&15]+this.hex_chr[e>>8*i&15];return t}hex(e){for(var t=0;t<e.length;t++)e[t]=this.rhex(e[t]);return e.join("")}md5(e){return this.hex(this.md51(e))}add32(e,t){return e+t&4294967295}},Affinity2018.md5=function(e){return Affinity2018.Md5Object.md5(e)},NodeList.prototype.indexOf||(NodeList.prototype.indexOf=function(e){if(!Affinity2018.isDomElement(e))throw"the passed element is not a Dom Element (type:"+typeof e+")";return Array.prototype.indexOf.call(this,e)}),Array.prototype.unique||(Array.prototype.unique=function(){return this.filter((function(e,t,i){return i.indexOf(e)===t}))}),Array.prototype.diff||(Array.prototype.diff=function(e){return this.filter((function(t){return e.indexOf(t)<0}))}),Array.prototype.contains||(Array.prototype.contains=function(e){return-1!==this.indexOf(e)}),Array.prototype.includes||(Array.prototype.includes=Array.prototype.contains),Array.prototype.bindEachToClassScope||(Array.prototype.bindEachToClassScope=function(e){this.forEach(function(t){e[t]&&"function"==typeof e[t]&&(e[t]=e[t].bind(e))}.bind(e))}),Array.prototype.bindEach||(Array.prototype.bindEach=Array.prototype.bindEachToClassScope),String.prototype.includes||(String.prototype.includes=function(e,t){"use strict";return"number"!=typeof t&&(t=0),!(t+e.length>this.length)&&-1!==this.indexOf(e,t)}),String.prototype.isEither||(String.prototype.isEither=function(){var e=[].slice.call(arguments);return!(!e||!Affinity2018.isArray(e))&&e.contains(this.toString())}),String.prototype.contains||(String.prototype.contains=function(e){return new RegExp(e.escapeRegExp(),"gi").test(this)}),String.prototype.padLeft||(String.prototype.padLeft=function(e,t){return Affinity2018.padLeft(this,e,t)}),String.prototype.padRight||(String.prototype.padRight=function(e,t){return Affinity2018.padRight(this,e,t)}),String.prototype.toCamelCase||(String.prototype.toCamelCase=function(e){return this.toLowerCase().replace(/(_|-)([a-z])/g,(function(e){return e[1].toUpperCase()}))}),String.prototype.toTitleCase||(String.prototype.toTitleCase=function(){return this.replace(/\b\w+/g,(function(e){return e.charAt(0).toUpperCase()+e.substr(1).toLowerCase()}))}),String.prototype.toUpperFirst||(String.prototype.toUpperFirst=function(){return""!==this.trim()?str.trim().charAt(0).toUpperCase()+str.trim().slice(1):str}),String.prototype.splitCamelCase||(String.prototype.splitCamelCase=function(){return""!==this.trim()?this.trim().charAt(0).toUpperCase()+this.trim().slice(1).replace(/([A-Z])/g," $1"):this}),String.prototype.countString||(String.prototype.countString=function(e){return(this.match(new RegExp(e.escapeRegExp(),"g"))||[]).length}),String.prototype.firstWord||(String.prototype.firstWord=function(){return this.split(" ")[0]}),String.prototype.lastWord||(String.prototype.lastWord=function(e){return this.replace(/  /g," ").split(" ")[this.split(" ").length-1]}),"escapeRegExp"in String||(String.prototype.escapeRegExp=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),String.prototype.escapeRegExpString||(String.prototype.escapeRegExpString=function(){return this.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}),String.prototype.isNullOrEmpty||(String.prototype.isNullOrEmpty=function(){return Affinity2018.isNullOrEmpty(this)}),String.prototype.format||(String.prototype.format=function(){var e=[].slice.call(arguments);return Affinity2018.FormatString(this,e)}),String.format||(String.format=function(){var e=[].slice.call(arguments);return Source63.FormatString(this,e)}),String.prototype.soundex=function(){return Affinity2018.Soundex(this)},String.prototype.distance=function(e){if("string"!=typeof e)throw"String.distance requires a string to compare";return Affinity2018.StringDistance(this,e)},String.prototype.md5=function(){return Affinity2018.Md5Object.md5(this)},Number.prototype.md5=function(){return Affinity2018.Md5Object.md5(this)},Affinity2018.CookieMonster=new class{constructor(){["Read","Write","Delete","_exists"].bindEach(this)}Read(e){if(this._exists(e))return function(e){try{return JSON.parse(e)}catch(t){return e}}(document.cookie.match(new RegExp(e+"=([^;]+)"))[1])}Write(e,t,i){var s,o=window.location.host,a=new Date;"object"==typeof t&&(t=JSON.stringify(t)),t=escape(t);try{return void 0!==i&&!isNaN(i)&&parseFloat(i)>0?(s=new Date(a.getTime()+6e4*i).toUTCString(),window.location.host.toLowerCase().contains("localhost")?document.cookie=e+"="+t+"; expires="+s+"; domain:NULL; secure; SameSite=Strict":document.cookie=e+"="+t+"; expires="+s+"; domain:"+o+"; secure; SameSite=Strict",t):(document.cookie=e+"="+t+"; secure; SameSite=Strict",t)}catch(e){console.error(e)}return null}Delete(e){if(this._exists(e))try{return document.cookie=e+"=; expires=Thu, 01 Jan 1970 00:00:00 GMT",!0}catch(e){console.error(e)}return!1}_exists(e){return!!document.cookie.split(";").filter((function(t){return 0==t.trim().indexOf(e+"=")})).length}},Affinity2018.Storage=new class{constructor(){this.Session={},this.Session.Has=this.HasSession,this.Session.Get=this.GetSession,this.Session.Set=this.SetSession,this.Session.Del=this.DelSession,this.Local={},this.Local.Has=this.HasLocal,this.Local.Get=this.GetLocal,this.Local.Set=this.SetLocal,this.Local.Del=this.DelLocal}HasSession(e){return null!==window.sessionStorage.getItem(e)}GetSession(e){let t=window.sessionStorage.getItem(e);if(null!==t){if(Affinity2018.isString(t)&&["true","false"].contains(t.trim().toLowerCase())){if("true"===t.trim().toLowerCase())return!0;if("false"===t.trim().toLowerCase())return!1}if(Affinity2018.isNumeric(t)&&Affinity2018.isString(t)&&t.contains("."))return parseFloat(t);if(Affinity2018.isNumeric(t)&&Affinity2018.isString(t)&&!t.contains("."))return parseInt(t);try{return JSON.parse(unescape(t))}catch(e){}return unescape(t)}return!1}SetSession(e,t){Affinity2018.isString(t)||(t=JSON.stringify(t)),window.sessionStorage.setItem(e,escape(t))}DelSession(e){window.sessionStorage.removeItem(e)}HasLocal(e){return null!==window.localStorage.getItem(e)}GetLocal(e){let t=window.localStorage.getItem(e);if(null!==t){try{return JSON.parse(unescape(t))}catch(e){}return t}return!1}SetLocal(e,t){Affinity2018.isString(t)||(t=JSON.stringify(t)),window.localStorage.setItem(e,escape(t))}DelLocal(e){window.localStorage.removeItem(e)}},Affinity2018.languages={english:{}},Affinity2018.Classes.Lang=class{constructor(){["Process","Load","CheckPath","ReturnPath","_returnIcon","_returnLabel","_retuenMethodRef","_processString","_check","_process"].bindEach(this),this.Loaded=!1}Process(){var e,t,i;this.Loaded&&(document.querySelectorAll("[data-lang],[data-lang-tooltip]").forEach(function(s){e=null,s.dataset.langTooltip?(i=!0,e=s.dataset.langTooltip):(i=!1,e=s.dataset.lang),null!==e&&(e=(e=(e=(e=e.replace(/^app\./,"application.")).replace(/^apps\./,"application.")).replace(".ts.",".timesheets.")).replace(".cf.",".cleverfroms."),this.CheckPath(e)?(t=this.ReturnPath(e),Affinity2018.isString(t)?""!=t.trim()&&(i?(s.classList.add("ui-has-tooltip"),s.dataset.tooltip=t):s.innerHTML=t):console.log('Language path "{0}" is not string:'.format(e),t)):console.log("Language can not find value for '"+e+"'")),s.removeAttribute("data-lang"),s.removeAttribute("data-lang-tooltip")}.bind(this)),window.hasOwnProperty("Affinity")&&Affinity.hasOwnProperty("tooltips")&&Affinity.tooltips.processNew(),Affinity2018.hasOwnProperty("Tooltips")&&Affinity2018.Tooltips.Apply())}Load(){axios.get("../../Content/v2/languages/english.json").then(function(e){this._process(e.data)}.bind(this))}CheckPath(e){for(var t,i=Affinity2018.languages.english,s=e.replace("l:","").replace("join:","").split("."),o=0;o<s.length;o++){if("app"===(t=s[o])&&(t=t.replace("app","application")),"apps"===t&&(t=t.replace("apps","application")),"ts"===t&&(t=t.replace("ts","timesheets")),"cf"===t&&(t=t.replace("cf","cleverfroms")),!i.hasOwnProperty(t))return!1;i=i[t]}return null!=i}ReturnPath(e,t){for(var i,s=Affinity2018.languages.english,o=e.replace("l:","").replace("join:","").split("."),a=0;a<o.length;a++)"app"===(i=o[a])&&(i=i.replace("app","application")),"apps"===i&&(i=i.replace("apps","application")),"ts"===i&&(i=i.replace("ts","timesheets")),"cf"===i&&(i=i.replace("cf","cleverfroms")),s.hasOwnProperty(i)&&(s=s[i]);return null!=s?(Affinity2018.isString(s)&&(s=this._processString(s,t)),s):null}_returnIcon(e,t){for(var i=window,s=t.replace("i:","").split("."),o=0;o<s.length;o++)i.hasOwnProperty(s[o])&&(i=i[s[o]]);return null!=i&&"string"==typeof i?e.replace("{{"+t+"}}",i):e}_returnLabel(e,t){for(var i=Affinity2018.languages.english,s=t.contains("join:"),o=t.replace("l:","").replace("join:","").split("."),a=0;a<o.length;a++)i.hasOwnProperty(o[a])&&(i=i[o[a]]);if(null!=i){if(s&&Array.isArray(i))return e.replace("{{"+t+"}}",i.join(" "));if(!s&&("string"==typeof i||"number"==typeof i))return e.replace("{{"+t+"}}",i)}return e}_retuenMethodRef(e,t){for(var i=window,s=t.replace("m:","").split("."),o=0;o<s.length;o++)i.hasOwnProperty(s[o])&&(i=i[s[o]]);return null!=i&&"function"==typeof i?i:function(){}}_processString(e,t){if(e.contains("{{")&&e.contains("}}")){var i,s,o=e.match(/[^{{\}}]+(?=}})/g);if(null!==o)for(i=0;i<o.length;i++)switch((s=o[i]).substr(0,2)){case"i:":e=this._returnIcon(e,s);break;case"l:":e=this._returnLabel(e,s);break;case"m:":e=this._retuenMethodRef(e,s);break;case"v:":if(t&&Affinity2018.isObject(t)){var a=s.replace("v:","").trim(),n="{{"+s+"}}";t.hasOwnProperty(a)&&(e=e.replace(n,t[a]))}}}return e}_check(e){if("object"==typeof e)for(var t in e)"object"==typeof e[t]?this._check(e[t]):"string"==typeof e[t]&&(e[t]=this._processString(e[t]));return e}_process(e){e.hasOwnProperty("languages")&&e.languages.hasOwnProperty("english")&&"object"==typeof e.languages.english&&(Affinity2018.languages.english=Affinity2018.objectDeepMerge([Affinity2018.languages.english,e.languages.english]),Affinity2018.languages.english=this._check(Affinity2018.languages.english)),this.Loaded=!0;let t=new Event("LangComplete");window.dispatchEvent(t),this.Process()}},Affinity2018.Classes.Tooltips=class{constructor(){if(["init","Apply","_applyTo","Show","Hide"].bindEach(this),this.enabled=!1,!document.getElementById("tooltip"))return!1;this.enabled=!0,this.head=document.getElementsByTagName("head")[0],this.body=document.getElementsByTagName("body")[0],this.tooltipEl=document.getElementById("tooltip"),this.references={},Affinity2018.Apps.Plugins.Tooltips=this}Apply(e){if(!this.enabled)return!1;null!=e?this._applyTo(e):document.querySelectorAll(".ui-has-tooltip").forEach(this._applyTo)}_applyTo(e){if(!this.enabled)return!1;if(Affinity2018.isDomElement(e)&&!Affinity2018.isNull(e.dataset.tooltip)){let t={id:"tt"+(Object.keys(this.references).length+1),el:e,tooltip:e.dataset.tooltip.trim(),direction:Affinity2018.isNull(e.dataset.tooltipDir)?"top":e.dataset.tooltipDir};this.references[t.id]=t,e.classList.add("tt"),e.dataset.ttid=t.id,e.addEventListener("mouseover",this.Show,!1),e.addEventListener("mouseout",this.Hide,!1),e.removeAttribute("data-tooltip"),e.removeAttribute("data-tooltip-direction"),e.removeAttribute("data-tooltip-dir"),e.classList.remove("ui-has-tooltip")}}Show(e){if(!this.enabled)return!1;let t,i,s,o=Affinity2018.getParent(e.target,"tt").dataset.ttid,a=!(!o||!this.references.hasOwnProperty(o))&&this.references[o],n=!!a&&Affinity2018.getPosition(a.el),r=!!a&&Affinity2018.getSize(a.el);if(a){switch(Affinity2018.Body.classList.contains("disable-scroll")&&(n.top+=-1*parseInt(Affinity2018.Body.style.top)),this.tooltipEl.innerHTML=a.tooltip,this.tooltipEl.classList.add("show"),this.tooltipEl.classList.remove("top","top-right","left","bottom","right"),t=Affinity2018.getSize(this.tooltipEl),a.direction){case"top-right":s=n.left,i=n.top-t.height-10,this.tooltipEl.classList.add("top-right");break;case"left":s=n.left-t.width-10,i=n.top+r.height/2-t.height/2,this.tooltipEl.classList.add("left");break;case"bottom":s=n.left+r.width/2-t.width/2,i=n.top+r.height+15,this.tooltipEl.classList.add("bottom");break;case"right":s=n.left+r.width+10,i=n.top+r.height/2-t.height/2,this.tooltipEl.classList.add("right");break;default:s=n.left+r.width/2-t.width/2,i=n.top-t.height-10,this.tooltipEl.classList.add("top")}this.tooltipEl.style.top=i+"px",this.tooltipEl.style.left=s+"px"}}Hide(e){if(!this.enabled)return!1;this.tooltipEl.classList.remove("show")}},Affinity2018.Classes.Dialog=class{constructor(){if(["Position","Set","Reset","Show","Hide","_setMessage","_setInput","_setButtons","_okClicked","_okContinue","_cancelClicked","_cancelContinue","_bgClicked"].bindEach(this),this.enabled=!1,!document.getElementById("dialog")||!document.getElementById("dialog-bg"))return!1;this.enabled=!0,this.Open=!1,this.default={message:"Default message",buttons:{ok:{show:!0,icon:"tick",text:"OK",color:"blue"},cancel:{show:!0,icon:"cross",text:"Cancel",color:"grey"}},input:{show:!1,placeholder:"",default:"",lines:1},textAlign:"center",canBackgroundClose:!0,showOk:!0,showCancel:!0,showInput:!1,inputLines:1,onOk:function(){},onCancel:function(){},onClose:function(){}},this.data=Affinity2018.objectDeepMerge({},this.default),this.resetTimeout=!1,this.head=document.getElementsByTagName("head")[0],this.body=document.getElementsByTagName("body")[0],this.dialogBgEl=document.getElementById("dialog-bg"),this.dialogEl=document.getElementById("dialog"),this.ContentNode=document.getElementById("dialog-content"),this.buttonsEl=document.getElementById("dialog-buttons"),this.cancelButton=document.getElementById("dialog-cancel"),this.okButton=document.getElementById("dialog-ok"),this.inputEl=document.getElementById("dialog-inputs"),this.inputBox=document.getElementById("dialog-input"),this.textareaBox=document.getElementById("dialog-textarea"),this.dialogBgEl.addEventListener("click",this._bgClicked),this.cancelButton.addEventListener("click",this._cancelClicked),this.okButton.addEventListener("click",this._okClicked),this.Reset()}Position(){if(!this.enabled)return!1;let e=Affinity2018.getSize(this.dialogEl),t=0-e.width/2,i=0-e.height/2;this.dialogEl.style.marginLeft=t+"px",this.dialogEl.style.marginTop=i+"px"}Reset(){if(!this.enabled)return!1;clearTimeout(this._resetTimeout),this._resetTimeout=null,this.ContentNode.innerHTML="",this.data=Affinity2018.objectDeepMerge({},this.default)}Set(e){if(!this.enabled)return!1;if(clearTimeout(this.resetTimout),Affinity2018.isDomElement(e))this.ContentNode.appendChild(e);else{let t=this.ContentNode.innerHTML;this.ContentNode.innerHTML=t+e}}Show(e){if(!this.enabled)return!1;this.Reset(),"string"===Affinity2018.Type(e)?this.data=Affinity2018.objectDeepMerge(this.default,{message:e.toString()}):"object"===Affinity2018.Type(e)?this.data=Affinity2018.objectDeepMerge(this.default,e):this.data=Affinity2018.objectDeepMerge({},this.default),this.data.onOk=function(){},this.data.onCancel=function(){},this.data.onClose=function(){},e.hasOwnProperty("onOk")&&Affinity2018.isFunction(e.onOk)&&(this.data.onOk=e.onOk),e.hasOwnProperty("onCancel")&&Affinity2018.isFunction(e.onCancel)&&(this.data.onCancel=e.onCancel),e.hasOwnProperty("onOk")&&Affinity2018.isFunction(e.onClose)&&(this.data.onClose=e.onClose),this._setMessage(this.data),this._setInput(this.data),this._setButtons(this.data),this.dialogBgEl.classList.add("show"),this.dialogEl.classList.add("show"),this.Position(),this.Open=!0}Hide(){if(!this.enabled)return!1;clearTimeout(this._resetTimeout),this.dialogBgEl.classList.remove("show"),this.dialogEl.classList.remove("show"),this.data.onClose(),this._resetTimeout=setTimeout(this.Reset,300),this.Open=!1}_setMessage(){this.ContentNode.innerHTML="",this.ContentNode.classList.add(this.data.textAlign.replace(/\s/gi,"").trim()),this.Set(this.data.message)}_setInput(){this.inputEl.classList.add("hidden"),this.inputBox.classList.add("hidden"),this.textareaBox.classList.add("hidden"),this.data.hasOwnProperty("input")&&Affinity2018.isPropObject(this.data,"input")&&Affinity2018.isPropBool(this.data.input,"show")&&this.data.input.show?this.data.input.lines>1?(this.textareaBox.rows=this.data.input.lines,this.textareaBox.placeholder=this.data.input.placeholder,this.textareaBox.value=this.data.input.default,this.textareaBox.classList.remove("hidden"),this.textareaBox.parentElement.classList.remove("hidden")):(this.inputBox.placeholder=this.data.input.placeholder,this.inputBox.value=this.data.input.default,this.inputBox.classList.remove("hidden"),this.inputBox.parentElement.classList.remove("hidden")):this.data.showInput&&(1===this.data.inputLines?this.inputBox.classList.remove("hidden"):(this.textareaBox.rows=this.data.inputLines,this.textareaBox.classList.remove("hidden")),this.inputEl.classList.remove("hidden"))}_setButtons(){var e=!1,t=!1;this.data.buttons&&(this.data.buttons.ok&&(this.data.buttons.ok.hasOwnProperty("show")&&"boolean"==typeof this.data.buttons.ok.show&&!0===this.data.buttons.ok.show?(this.okButton.innerHTML='<span class="icon-'+this.data.buttons.ok.icon+'"></span>'+this.data.buttons.ok.text,this.okButton.className="button ok",this.okButton.classList.add(this.data.buttons.ok.color),this.buttonsEl.classList.remove("hidden"),e=!0):this.okButton.classList.add("hidden")),this.data.buttons.cancel&&(this.data.buttons.cancel.hasOwnProperty("show")&&"boolean"==typeof this.data.buttons.cancel.show&&!0===this.data.buttons.cancel.show?(this.cancelButton.innerHTML='<span class="icon-'+this.data.buttons.cancel.icon+'"></span>'+this.data.buttons.cancel.text,this.cancelButton.className="button cancel",this.cancelButton.classList.add(this.data.buttons.cancel.color),this.buttonsEl.classList.remove("hidden"),t=!0):this.cancelButton.classList.add("hidden"))),this.data.showOk||(this.okButton.classList.add("hidden"),e=!1),this.data.showCancel||(this.cancelButton.classList.add("hidden"),t=!1),!1===e&&!1===t&&this.buttonsEl.classList.add("hidden")}_okClicked(){this.Hide(),this.inputBox.classList.contains("hidden")?this.textareaBox.classList.contains("hidden")?this.data.onOk():this.data.onOk(this.textareaBox.value):this.data.onOk(this.inputBox.value)}_cancelClicked(){this.Hide(),this.data.onCancel()}_bgClicked(){this.data.canBackgroundClose&&this.Hide()}},Affinity2018.Classes.Avatar=class{constructor(){["Reset","Set","_clearFile","_editClicked","_imageAdded","_setNewImage"].bindEach(this),this.enabled=!1,document.getElementsByClassName("avatar-image")&&(this.enabled=!0),this.supportedExt=["png","jpg","jpeg","gif"],this.maxSize=2097152,this.maxWidth=1e3,this.maxHeight=1e3,this.head=document.getElementsByTagName("head")[0],this.body=document.getElementsByTagName("body")[0],this.avatarEditButton=document.getElementById("avatar-edit"),this.avatarEditFileInput=document.createElement("input"),this.avatarEditFileInput.setAttribute("type","file"),this.avatarEditButton.addEventListener("click",this._editClicked),this.avatarEditFileInput.addEventListener("change",this._imageAdded),Affinity2018.Tooltips&&Affinity2018.Tooltips.Apply()}Reset(){if(!this.enabled)return!1;let e,t,i=document.getElementsByClassName("avatar-image"),s=0;if(i.length>0)for(;s<i.length;s++)e=i[s],e.classList.add("default"),e.removeAttribute("style"),e.getElementsByClassName("avatar-edit")&&(t=e.getElementsByClassName("avatar-edit")[0],t.classList.remove("small"))}Get(){}Set(e){if(!this.enabled)return!1;let t,i,s=document.getElementsByClassName("avatar-image"),o=0;if(s.length>0)for(;o<s.length;o++)t=s[o],t.classList.remove("default"),t.style.backgroundImage="url("+e+")",t.getElementsByClassName("avatar-edit")&&(i=t.getElementsByClassName("avatar-edit")[0],i.classList.add("small"));console.log(e)}_clearFile(){this.avatarEditFileInput.value="",this.crooperObj&&this.crooperObj.destroy()}_editClicked(){if(!this.enabled)return!1;Affinity2018.ShowPageLoader();let e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),s=this.avatarEditFileInput;if(t.innerHTML="Drag an image below",i.classList.add("drag-box"),s.type="file",s.classList.add("obscured-file-input"),i.appendChild(s),e.appendChild(t),e.appendChild(t),e.appendChild(i),window.hasOwnProperty("Cropper"))Affinity2018.HidePageLoader(),Affinity2018.Dialog.Show({message:e,onCancel:this._clearFile});else{let t=document.createElement("script"),i=document.createElement("link");i.setAttribute("href","https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.3.6/cropper.min.css"),i.setAttribute("rel","stylesheet"),t.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.3.6/cropper.min.js"),t.onload=function(){Affinity2018.HidePageLoader(),Affinity2018.Dialog.Show({message:e,onCancel:this._clearFile})}.bind(this),this.head.appendChild(i),this.body.appendChild(t)}}_imageAdded(){let e=document.createElement("div"),t=document.createElement("div"),i=document.createElement("div"),s=document.createElement("img"),o=document.createElement("img"),a=new FileReader,n=this.avatarEditFileInput.files[0],r=n.type.replace("image/","").toLowerCase(),l=new FileReader,d=new Image;return this.supportedExt.includes(r)?n.size>this.maxSize?(Affinity2018.Dialog.Show({message:"Your image must be no bigger than "+Math.round(this.maxSize/1024)+"kb. Yours is "+Math.round(n.size/1024)+"kb",onOk:this._editClicked}),void this._clearFile()):(l.onload=function(){d.onload=function(){if(d.width>this.maxWidth||d.height>this.maxHeight)return Affinity2018.Dialog.Show({message:"Your image can be no larger than "+this.maxWidth+"x"+this.maxHeight+". Yours is "+d.width+"x"+d.height+".",onOk:this._editClicked}),void this._clearFile();Affinity2018.ShowPageLoader(),e.classList.add("avatar-crop"),t.classList.add("avatar-cropper"),i.classList.add("avatar-crop-preview"),s.width=100,s.height=100,i.appendChild(s),t.appendChild(o),e.appendChild(i),e.appendChild(t),a.addEventListener("load",function(){o.src=a.result,Affinity2018.Dialog.Reset(),this.crooperObj=new Cropper(o,{autoCrop:!0,dragMode:"move",aspectRatio:1,autoCropArea:.8,viewMode:0,preview:i,rotatable:!1,scalable:!0,zoomable:!0,toggleDragModeOnDblclick:!1,minContainerWidth:100,minContainerHeight:100,minCanvasWidth:100,minCanvasHeight:100,minCropBoxWidth:100,minCropBoxHeight:100,ready:function(){Affinity2018.HidePageLoader(),Affinity2018.Dialog.Position()}}),Affinity2018.Dialog.Show({message:e,onOk:this._setNewImage,onCancel:this._clearFile})}.bind(this),!1),a.readAsDataURL(n)}.bind(this),d.src=l.result}.bind(this),void l.readAsDataURL(n)):(Affinity2018.Dialog.Show({message:'Your image must be a "'+this.supportedExt.join('","')+'"',onOk:this._editClicked}),void this._clearFile())}_setNewImage(){let e=this.crooperObj.getCroppedCanvas().toDataURL(),t=document.createElement("div"),i=document.createElement("div"),s=new Image;t.appendChild(i),t.appendChild(s),i.innerHTML="Save this image as your avatar?<br /><br />",s.width=100,s.height=100,s.onload=function(){this._clearFile(),Affinity2018.Dialog.Show({message:t,onOk:function(){let e=document.createElement("canvas"),t=e.getContext("2d");e.width=100,e.height=100,t.drawImage(s,0,0,100,100),Affinity2018.Avatar.Set(e.toDataURL()),this._clearFile()}.bind(this),onCancel:this._clearFile})}.bind(this),s.src=e}},Affinity2018.Classes.Login=class{constructor(){["showLogin","hideLogin","checkEnterLogin","doLogin","loginCaptureEscape","logout","showOptions","showQuestions","showEmail","showEmailSent","showSms","showSmsSent","showReset","disableClose","enableClose","disableLogin","enableLogin","getUsername","getPassword","overrideAction"].bindEach(this),this.isInline=!1,this.enabled=!1,this.IsOverriden=!1,document.getElementById("affinity-login")&&(this.enabled=!0),this.head=document.getElementsByTagName("head")[0],this.body=document.getElementsByTagName("body")[0],this.loginShakeRemoveTimer,this.loginPanel=document.querySelector("#affinity-login"),this.loginInnerPanel=this.loginPanel.querySelector(".affinity-login-box.login"),this.loginForm=this.loginInnerPanel.querySelector("form, .form"),this.loginPanel.querySelector(".affinity-login-box.options")?(this.optionsInnerPanel=this.loginPanel.querySelector(".affinity-login-box.options"),this.optionsForm=this.optionsInnerPanel.querySelector("form"),this.questionsInnerPanel=this.loginPanel.querySelector(".affinity-login-box.questions"),this.questionsForm=this.questionsInnerPanel.querySelector("form"),this.emailInnerPanel=this.loginPanel.querySelector(".affinity-login-box.email"),this.emailForm=this.emailInnerPanel.querySelector("form"),this.emailSentInnerPanel=this.loginPanel.querySelector(".affinity-login-box.email-sent"),this.emailSentForm=this.emailSentInnerPanel.querySelector("form"),this.smsInnerPanel=this.loginPanel.querySelector(".affinity-login-box.sms"),this.smsForm=this.smsInnerPanel.querySelector("form"),this.smsSentInnerPanel=this.loginPanel.querySelector(".affinity-login-box.sms-sent"),this.smsSentForm=this.smsSentInnerPanel.querySelector("form"),this.resetInnerPanel=this.loginPanel.querySelector(".affinity-login-box.reset"),this.resetForm=this.resetInnerPanel.querySelector("form"),this.optionsButtons=this.loginPanel.querySelectorAll(".recovery-options"),this.questionsButtons=this.loginPanel.querySelectorAll(".recovery-questions"),this.emailButtons=this.loginPanel.querySelectorAll(".recovery-email"),this.emailSentButtons=this.loginPanel.querySelectorAll(".recovery-email-sent"),this.smsButtons=this.loginPanel.querySelectorAll(".recovery-sms"),this.smsSentButtons=this.loginPanel.querySelectorAll(".recovery-sms-sent"),this.nextButtons=this.loginPanel.querySelectorAll(".recovery-reset"),this.loginButtons=this.loginPanel.querySelectorAll(".recovery-login")):(this.loginForm.querySelector(".form-row.remember").classList.add("hidden"),this.loginForm.querySelector(".form-row.forgot").classList.add("hidden"),this.loginInnerPanel.classList.add("basic"),this.loginPanel.querySelector("p.error-message")?(this.loginInnerPanel.classList.add("error"),clearTimeout(this.loginShakeRemoveTimer),this.loginInnerPanel.classList.remove("shake"),this.loginInnerPanel.classList.add("shake"),this.loginShakeRemoveTimer=setTimeout(function(){this.loginInnerPanel.classList.remove("shake")}.bind(this),500)):this.loginInnerPanel.classList.remove("error")),this.userBox=this.loginForm.querySelector("input[type=text]"),this.passBox=this.loginForm.querySelector("input[type=password]"),this.loginButton=this.mobileLoginButton=this.logoutButton=this.mobileLogoutButton=!1,document.querySelector("#avatar-login-button")&&(this.loginButton=document.querySelector("#avatar-login-button")),document.querySelector("#avatar-mobile-login-button")&&(this.mobileLoginButton=document.querySelector("#avatar-mobile-login-button")),document.querySelector("#avatar-logout-button")&&(this.logoutButton=document.querySelector("#avatar-logout-button")),document.querySelector("#avatar-mobile-logout-button")&&(this.mobileLogoutButton=document.querySelector("#avatar-mobile-logout-button")),this.loginPanelLoginButton=document.querySelector("#affinity-login-button"),this.closeButtons=document.querySelectorAll(".login-close"),this.loginPanelCloseButton=this.loginInnerPanel.querySelector(".login-close"),this.loginButton&&this.loginButton.addEventListener("click",this.showLogin),this.mobileLoginButton&&this.mobileLoginButton.addEventListener("click",this.showLogin),this.logoutButton&&this.logoutButton.addEventListener("click",this.logout),this.mobileLogoutButton&&this.mobileLogoutButton.addEventListener("click",this.logout),this.loginPanelLoginButton.addEventListener("click",this.doLogin),this.closeButtons.forEach(function(e){e.addEventListener("click",this.hideLogin)}.bind(this)),this.optionsInnerPanel&&(this.optionsButtons.forEach(function(e){e.addEventListener("click",this.showOptions)}.bind(this)),this.questionsButtons.forEach(function(e){e.addEventListener("click",this.showQuestions)}.bind(this)),this.emailButtons.forEach(function(e){e.addEventListener("click",this.showEmail)}.bind(this)),this.emailSentButtons.forEach(function(e){e.addEventListener("click",this.showEmailSent)}.bind(this)),this.smsButtons.forEach(function(e){e.addEventListener("click",this.showSms)}.bind(this)),this.smsSentButtons.forEach(function(e){e.addEventListener("click",this.showSmsSent)}.bind(this)),this.nextButtons.forEach(function(e){e.addEventListener("click",this.showReset)}.bind(this)),this.loginButtons.forEach(function(e){e.addEventListener("click",this.showLogin)}.bind(this))),this.userBox.addEventListener("keyup",this.checkEnterLogin),this.passBox.addEventListener("keyup",this.checkEnterLogin),Affinity2018.Tooltips&&Affinity2018.Tooltips.Apply()}showLogin(){if(!this.enabled)return!1;window.removeEventListener("keyup",this.loginCaptureEscape),window.addEventListener("keyup",this.loginCaptureEscape),this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.loginPanel.classList.add("enabled"),this.loginInnerPanel.classList.add("show")}checkEnterLogin(e){if(!this.enabled)return!1;"key"in e&&"enter"===e.key.toLowerCase()&&this.userBox.value.length>0&&this.passBox.value.length>0&&this.doLogin()}resetUserDisplay(){if(!this.enabled)return!1;let e=document.getElementsByClassName("user-display"),t=0;if(e.length>0)for(;t<e.length;t++)e[t].innerHTML="";document.getElementsByClassName("avatar-label user-display")[0].innerHTML="Login"}setUserDisplay(e){if(!this.enabled)return!1;let t=document.getElementsByClassName("user-display"),i=0;if(t.length>0)for(;i<t.length;i++)t[i].innerHTML=e}doLogin(e){if(Affinity2018.stopEvent(e),!this.enabled)return!1;if(this.loginInnerPanel.querySelector("p.error-message")&&this.loginInnerPanel.querySelector("p.error-message").parentNode.removeChild(this.loginInnerPanel.querySelector("p.error-message")),this.loginInnerPanel.classList.remove("error"),this.userBox.value.length>0&&this.passBox.value.length>0)this.loginPanel.classList.contains("native-form")?(this.loginPanelLoginButton.classList.add("disabled"),this.loginInnerPanel.classList.add("bounce"),document.querySelector("form").submit()):(this.loginButton&&this.loginButton.classList.add("hidden"),this.mobileLoginButton&&this.mobileLoginButton.classList.add("hidden"),this.logoutButton&&this.logoutButton.classList.remove("hidden"),this.mobileLogoutButton&&this.mobileLogoutButton.classList.remove("hidden"),this.isInline||this.hideLogin(),this.setUserDisplay("John Doe"),Affinity2018.Avatar&&Affinity2018.Avatar.Get(this.userBox.value),this.IsOverriden||window.dispatchEvent(new Event("loggedin")));else{clearTimeout(this.loginShakeRemoveTimer),this.loginInnerPanel.classList.add("error");var t=this.loginInnerPanel.querySelector("p.highlight"),i=document.createElement("p");i.classList.add("error-message"),i.innerHTML="You must enter a username and password",t.parentNode.insertBefore(i,t),this.loginInnerPanel.classList.remove("shake"),this.loginInnerPanel.classList.add("shake"),this.loginShakeRemoveTimer=setTimeout(function(){this.loginInnerPanel.classList.remove("shake")}.bind(this),500)}}loginCaptureEscape(e){if(!this.enabled)return!1;"key"in e&&"escape"===e.key.toLowerCase()&&this.hideLogin()}hideLogin(){if(!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),window.removeEventListener("keyup",this.loginCaptureEscape),this.userBox.value="",this.passBox.value="",this.loginPanel.classList.remove("enabled")}logout(){if(!this.enabled)return!1;this.resetUserDisplay(),this.loginButton&&this.loginButton.classList.remove("hidden"),this.mobileLoginButton&&this.mobileLoginButton.classList.remove("hidden"),this.logoutButton&&this.logoutButton.classList.add("hidden"),this.mobileLogoutButton&&this.mobileLogoutButton.classList.add("hidden"),Affinity2018.Avatar.Reset(),this.IsOverriden||window.dispatchEvent(new Event("loggedout"))}preventLinkEvent(e){"object"==typeof e&&e.target&&e.target.tagName&&("a"===e.target.tagName.toLowerCase()||Affinity2018.getParent(e.target,"a"))&&(e.preventDefault(),e.stopPropagation())}showOptions(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.optionsInnerPanel.classList.add("show")}showQuestions(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.questionsInnerPanel.classList.add("show")}showEmail(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.emailInnerPanel.classList.add("show")}showEmailSent(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.emailSentInnerPanel.classList.add("show")}showSms(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.smsInnerPanel.classList.add("show")}showSmsSent(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.smsSentInnerPanel.classList.add("show")}showReset(e){if(this.preventLinkEvent(e),!this.enabled)return!1;this.loginPanel.querySelectorAll(".affinity-login-box").forEach((function(e){e.classList.remove("show")})),this.resetInnerPanel.classList.add("show")}disableClose(){this.loginPanelCloseButton.classList.add("hidden")}enableClose(){this.loginPanelCloseButton.classList.remove("hidden")}disableLogin(){this.loginPanelCloseButton.classList.add("hidden")}enableLogin(){this.loginPanelCloseButton.classList.remove("hidden")}getUsername(){return this.userBox.value.trim()}getPassword(){return this.passBox.value.trim()}overrideAction(e){e&&"function"==typeof e&&(this.loginPanelLoginButton.removeEventListener("click",this.doLogin),this.loginPanelLoginButton.addEventListener("click",e),this.IsOverriden=!0)}},Affinity2018.Classes.RateUs=class{constructor(){if(["rate","results"].bindEach(this),this.enabled=!1,!document.getElementById("rate-us"))return;this.enabled=!0,this.ratings=[0,1,27,59,102],this.ratingLabels=["Very Dissatisfied","Dissatisfied","Neutral","Satisfied","Very Satisfied"],this.rateBox=document.getElementById("rate-us"),this.titleBox=this.rateBox.getElementsByClassName("rate-title")[0],this.rateIconBox=this.rateBox.getElementsByClassName("rate-sentiments")[0],this.rateResultBox=this.rateBox.getElementsByClassName("rate-results")[0],this.rateIcons=Array.prototype.slice.call(this.rateIconBox.getElementsByClassName("rate-sentiment")),this.rateBars=Array.prototype.slice.call(this.rateResultBox.getElementsByClassName("rate-result"));let e,t=0;if(this.rateIcons&&this.rateIcons.length>0)for(;t<this.rateIcons.length;t++)e=this.rateIcons[t],e.addEventListener("click",this.rate);Affinity2018.Tooltips&&Affinity2018.Tooltips.Apply()}rate(e){if(!this.enabled)return!1;let t=Affinity2018.getParent(e.target,"rate-sentiment"),i=this.rateIcons.indexOf(t);t&&i>-1&&i<this.ratings.length&&this.ratings[i]++,this.results()}results(){if(!this.enabled)return!1;let e,t,i,s=0,o=Math.max.apply(null,this.ratings),a=this.ratings.reduce((function(e,t){return e+t}),0);if(this.rateBars&&this.rateIcons.length>0)for(;s<this.rateBars.length;s++)e=this.ratings[s]/a*100,t=this.ratings[s]/o*100,i=this.rateBars[s].getElementsByClassName("bar")[0],i.style.height=t+"%",i.dataset.tooltip=Number.parseFloat(e).toFixed(2)+"% are "+this.ratingLabels[s],Affinity2018.Tooltips.Apply(i);this.titleBox.innerHTML="User Satisfaction",this.rateIconBox.classList.add("hidden"),this.rateResultBox.classList.remove("hidden")}},Affinity2018.Classes.Pagination=class{constructor(){["Apply","Remove","_applyTo"].bindEach(this),this.enabled=!0,this.paginationControllers={}}Apply(e){if(!this.enabled)return!1;null!=e?this._applyTo(e):document.querySelectorAll(".ui-pagination").forEach(this._applyTo)}_applyTo(e){if(Affinity2018.isDomElement(e)&&e.hasAttribute("data-pages-total")){let t,i,s=!1;for(t in this.paginationControllers)if(i=this.paginationControllers[t],i.el===e){s=!0,i.controller.Update();break}if(!s){let t={id:"pg"+Affinity2018.uuid(),el:e,pages:parseInt(e.dataset.pagesTotal),controller:new Affinity2018.Classes.PaginationControler(e)};e.dataset.pagesId=t.id,this.paginationControllers[t.id]=t}}}Remove(e){if(Affinity2018.isDomElement(e)){let t,i;for(t in this.paginationControllers)if(i=this.paginationControllers[t],i.el===e){i.controller.Destroy(),this.paginationControllers[i.id]=null,delete this.paginationControllers[i.id];break}}}},Affinity2018.Classes.PaginationControler=class{constructor(e){if(!Affinity2018.isDomElement(e))return;e.classList.remove("ui-pagination"),e.classList.add("pg"),["Update","Back","Forward","JumpPage","_goPage","_moreBack","_moreForward","_resetPages","Destroy"].bindEach(this),this.container=e;let t=this.container.querySelectorAll("a.page, a.current");this.totalPages=parseInt(this.container.dataset.pagesTotal),this.currentPage=parseInt(this.container.dataset.pagesCurrent),this.container.removeAttribute("data-pages-total"),this.container.removeAttribute("data-pages-current"),this.backEl=this.container.querySelector("a.back"),this.forwardEl=this.container.querySelector("a.forward"),this.quickBackEl=this.container.querySelector("a.first-page"),this.quickFormardEl=this.container.querySelector("a.last-page"),this.moreBackEl=this.container.querySelector("a.more-back"),this.moreFormardEl=this.container.querySelector("a.more-forward"),t.forEach(function(e){e.addEventListener("click",this._goPage,!1)}.bind(this)),this.backEl&&this.backEl.addEventListener("click",this.Back,!1),this.quickBackEl&&this.quickBackEl.addEventListener("click",this._goPage,!1),this.moreBackEl&&this.moreBackEl.addEventListener("click",this._moreBack,!1),this.moreFormardEl&&this.moreFormardEl.addEventListener("click",this._moreForward,!1),this.quickFormardEl&&this.quickFormardEl.addEventListener("click",this._goPage,!1),this.forwardEl&&this.forwardEl.addEventListener("click",this.Forward,!1),[this.backEl,this.quickBackEl,this.moreBackEl,this.moreFormardEl,this.quickFormardEl,this.forwardEl].forEach(function(e){e&&e.addEventListener("mousedown",this._preventEvent,!1),e&&e.addEventListener("dblclick",this._preventSelection,!1)}.bind(this)),1!==this.currentPage&&this.JumpPage(this.currentPage)}Update(){}Back(e){let t=e.target,i=this.currentPage-1<1?1:this.currentPage-1;t.classList.contains("disabled")||this._resetPages(i),e&&this._preventEvent(e)}Forward(e){let t=e.target,i=this.currentPage+1>this.totalPages?this.totalPages:this.currentPage+1;t.classList.contains("disabled")||this._resetPages(i),e&&this._preventEvent(e)}JumpPage(e){this._resetPages(e)}_preventEvent(e){e.stopPropagation(),e.preventDefault()}_preventSelection(e){window.getSelection?window.getSelection().removeAllRanges():document.selection&&document.selection.empty()}_goPage(e){let t=e.target,i=parseInt(t.innerHTML);t.classList.contains("current")||this._resetPages(i),e&&this._preventEvent(e)}_moreForward(e){let t=this.currentPage+4>this.totalPages?this.totalPages:this.currentPage+4;this._resetPages(t),e&&this._preventEvent(e)}_moreBack(e){let t=this.currentPage-4>0?this.currentPage-4:1;this._resetPages(t),e&&this._preventEvent(e)}_resetPages(e){let t=this.currentPage!==e,i=e+0;this.currentPage=e,this.backEl.classList.add("disabled"),this.forwardEl.classList.add("disabled"),e>1&&this.backEl.classList.remove("disabled"),e<this.totalPages&&this.forwardEl.classList.remove("disabled"),e<4&&(i=1),e>3&&(i=e-2),e+4>=this.totalPages&&(i=this.totalPages-4),this.container.querySelectorAll("a.page, a.current").forEach((function(t){t.classList.add("page"),t.classList.remove("current"),i===e&&(t.classList.remove("page"),t.classList.add("current")),t.innerHTML=i++})),this.quickBackEl.innerHTML=1,this.quickFormardEl.innerHTML=this.totalPages,e<4?(this.moreBackEl.classList.add("hide"),this.quickBackEl.classList.add("hide")):(this.moreBackEl.classList.remove("hide"),this.quickBackEl.classList.remove("hide")),i>this.totalPages?(this.moreFormardEl.classList.add("hide"),this.quickFormardEl.classList.add("hide")):(this.moreFormardEl.classList.remove("hide"),this.quickFormardEl.classList.remove("hide")),this._preventSelection(),t&&this.container.dispatchEvent(new CustomEvent("change",{detail:e}))}Destroy(){this.enabled=!1,this.container.removeAttribute.remove("data-pages-id"),this.container.classList.remove("pg"),this.container.Controller=null,this.container.querySelectorAll("a.page, a.current").forEach(function(e){e.removeEventListener("click",this._goPage,!1),e.removeEventListener("mousedown",this._preventEvent,!1),e.removeEventListener("dblclick",this._preventSelection,!1),e=null}.bind(this)),this.backEl&&this.backEl.removeEventListener("click",this.Back,!1),this.quickBackEl&&this.quickBackEl.removeEventListener("click",this._goPage,!1),this.moreBackEl&&this.moreBackEl.removeEventListener("click",this._moreBack,!1),this.moreFormardEl&&this.moreFormardEl.removeEventListener("click",this._moreForward,!1),this.quickFormardEl&&this.quickFormardEl.removeEventListener("click",this._goPage,!1),this.forwardEl&&this.forwardEl.removeEventListener("click",this.Forward,!1),[this.backEl,this.quickBackEl,this.moreBackEl,this.moreFormardEl,this.quickFormardEl,this.forwardEl].forEach(function(e){e&&e.removeEventListener("mousedown",this._preventEvent,!1),e&&e.removeEventListener("dblclick",this._preventSelection,!1),e=null}.bind(this)),this.backEl=null,this.quickBackEl=null,this.moreBackEl=null,this.moreFormardEl=null,this.quickFormardEl=null,this.forwardEl=null,this.container.innerHTML=!1,delete this.container.Controller,Affinity2018.Pagination&&Affinity2018.Pagination.Remove(this.container),this.container=null,delete this.container}},Affinity2018.Classes.UserInfo=class{options(){}constructor(){this.options(),["Apply"].bindEach(this),this.Apply()}Apply(){}},Affinity2018.Classes.HelpLinks=class{options(){this.link=Affinity2018.Lang.ReturnPath("generic.contact.email")}constructor(){this.options(),["Apply"].bindEach(this),this.Apply()}Apply(){this.link=Affinity2018.Lang.ReturnPath("generic.contact.email"),Affinity2018.isString(this.link)&&document.querySelectorAll("a.help-link").forEach(function(e,t){e.setAttribute("href","mailto:"+this.link),e.innerHTML=this.link}.bind(this))}},new class{constructor(){["init","onkey","set"].bindEach(this),this.scrollStyleNode=!1,Affinity2018.DarkMode=!1,document.body?this.init():document.addEventListener("DOMContentLoaded",this.init)}init(){document.querySelector("style.scrollbars")||(this.scrollStyleNode=document.createElement("style"),document.body.appendChild(this.scrollStyleNode)),Affinity2018.DarkMode=!!document.body.classList.contains("dark"),Affinity2018.Storage.Local.Has("dark-mode")&&(Affinity2018.DarkMode=Affinity2018.Storage.Local.Get("dark-mode")),window.location.href.contains("#dark")&&(Affinity2018.DarkMode=!0,Affinity2018.Storage.Local.Set("dark-mode",Affinity2018.DarkMode)),this.set(),window.addEventListener("keyup",this.onkey),Affinity2018.CheckDarkMode=this.set}onkey(e){e.ctrlKey&&e.altKey&&("d"===e.key||"D"===e.key)&&(Affinity2018.DarkMode=!Affinity2018.DarkMode,Affinity2018.Storage.Local.Set("dark-mode",Affinity2018.DarkMode),this.set())}set(){if(Affinity2018.DarkMode){var e="#222";document.body.classList.contains("dashboard")&&(e="#222"),document.body.classList.add("dark");var t="\n        ::-webkit-scrollbar-track {\n          background: {0};\n        }\n        ::-webkit-scrollbar-thumb {\n          border: 2px solid {0};\n        }\n        ::-webkit-resizer {\n          background: {0};\n        }\n        ";this.scrollStyleNode.innerHTML=t.format(e)}else e="#f5fafe",document.body.classList.contains("dashboard")&&(e="#ddd"),document.body.classList.remove("dark"),t="\n        ::-webkit-scrollbar-track {\n          background: {0};\n        }\n        ::-webkit-scrollbar-thumb {\n          border: 2px solid {0};\n        }\n        ::-webkit-resizer {\n          background: {0};\n        }\n        ",this.scrollStyleNode.innerHTML=t.format(e)}},Affinity2018.MobileChecked=!1,Affinity2018.IsMobile=!1,Affinity2018.Device="desktop",Affinity2018.MobileDetect=new class{constructor(){Affinity2018.Browser={userAgent:navigator.userAgent,platform:"Unknown",renderer:"Unknown",name:"Unknown",version:"?",major:-1,minor:-1,isie:!1,isedge:!1,isfirefox:!1,issafari:!1,ischrome:!1,ismac:!1},document.querySelector("body")?this.getBrowser():setTimeout(this.checkBody,10)}checkBody(){document.querySelector("body")?Affinity2018.MobileDetect.getBrowser():setTimeout(Affinity2018.MobileDetect.checkBody,10)}getBrowser(){let e=function(){let e=(new UAParser).getResult();Affinity2018.Browser.platform=e.os.name+(void 0!==e.os.version?" "+e.os.version:""),Affinity2018.Browser.renderer=e.engine.name,Affinity2018.Browser.name=e.browser.name,Affinity2018.Browser.version=e.browser.version,Affinity2018.Browser.major=parseInt(e.browser.major),Affinity2018.Browser.minor=e.browser.version.replace(e.browser.major,""),Affinity2018.Browser.minor=0===Affinity2018.Browser.minor.indexOf(".")?Affinity2018.Browser.minor.substr(1):Affinity2018.Browser.minor,Affinity2018.Browser.minor=0===Affinity2018.Browser.minor.indexOf("0.")?Affinity2018.Browser.minor.substr(2):Affinity2018.Browser.minor,Affinity2018.Browser.minor=parseFloat(Affinity2018.Browser.minor),Affinity2018.Browser.name.toLowerCase().contains("ie")&&(Affinity2018.Browser.isie=!0),Affinity2018.Browser.name.toLowerCase().contains("edge")&&(Affinity2018.Browser.isedge=!0),Affinity2018.Browser.name.toLowerCase().contains("chrome")&&(Affinity2018.Browser.ischrome=!0),Affinity2018.Browser.name.toLowerCase().contains("safari")&&(Affinity2018.Browser.issafari=!0),Affinity2018.Browser.name.toLowerCase().contains("firefox")&&(Affinity2018.Browser.isfirefox=!0),Affinity2018.Browser.platform.toLowerCase().contains("mac")&&(Affinity2018.Browser.ismac=!0),Affinity2018.MobileDetect.getWurfl()},t=document.createElement("script");t.type="text/javascript",t.readyState?t.onreadystatechange=function(){"loaded"===t.readyState||"complete"===t.readyState?(t.onreadystatechange=null,e()):console.log(t.readyState)}:(t.onload=e,t.onerror=function(e){console.warn("UAParser failed to load"),console.warn(e),Affinity2018.MobileDetect.getWurfl()}),t.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/0.7.20/ua-parser.min.js"),document.head.appendChild(t)}getWurfl(){let e=document.createElement("script"),t=document.querySelector("body");e.type="text/javascript",e.src="//wurfl.io/wurfl.js",e.onload=function(){Affinity2018.MobileChecked=!0,Affinity2018.IsMobile=WURFL.is_mobile,Affinity2018.Device=WURFL.form_factor.toLowerCase(),t.classList.remove("mobile","tablet","desktop","edge","ie","firefox","mac"),t.classList.add(Affinity2018.IsMobile?"mobile":"desktop"),Affinity2018.Browser.isie&&t.classList.add("ie"+parseInt(Affinity2018.Browser.major)),Affinity2018.Browser.isie&&!isNaN(parseInt(Affinity2018.Browser.major))&&t.classList.add("ie"+parseInt(Affinity2018.Browser.major)),Affinity2018.Browser.isedge&&t.classList.add("edge"),Affinity2018.Browser.isfirefox&&t.classList.add("firefox"),Affinity2018.Browser.ismac&&t.classList.add("mac"),window.dispatchEvent(new Event("MobileChecked"))},e.onerror=function(){console.error("WURFL failed to load"),Affinity2018.MobileChecked=!0,Affinity2018.IsMobile=!1,Affinity2018.Device="unknown",t.classList.remove("mobile","tablet","desktop","edge","ie","firefox","mac"),t.classList.add("desktop"),window.dispatchEvent(new Event("MobileChecked"))},t.appendChild(e)}},Affinity2018.FeatureChecks={ScrollBarWidth:function(){var e,t,i,s;return(e=document.createElement("p")).style.width="100%",e.style.height="200px",(t=document.createElement("div")).style.position="absolute",t.style.top="0px",t.style.left="0px",t.style.visibility="hidden",t.style.width="200px",t.style.height="150px",t.style.overflow="hidden",t.appendChild(e),document.body.appendChild(t),i=e.offsetWidth,t.style.overflow="scroll",i==(s=e.offsetWidth)&&(s=t.clientWidth),document.body.removeChild(t),Affinity2018.scrollBarSize=i-s,Affinity2018.scrollBarSize},DataListTest:function(){var e=document.createElement("datalist");e&&"options"in e&&(Affinity2018.SupportsDatalist=!0),e=null},PassiveEvents:function(){var e=!1;try{document.addEventListener("test",null,{get passive(){e=!0}})}catch(e){}Affinity2018.SupportsPassiveEvents=e,Affinity2018.PassiveEventProp=!!Affinity2018.SupportsPassiveEvents&&{passive:!0}},CheckWebWorkers:function(){Affinity2018.hasOwnProperty("CheckForWorkers")||(Affinity2018.CheckForWorkers=!0),Affinity2018.CheckForWorkers&&(Affinity2018.CheckForWorkers=!(Affinity2018.isie&&Affinity2018.ieversion<=11)&&Affinity2018.CheckForWorkers),Affinity2018.CheckForWorkers&&(Affinity2018.SupportsWebWorkers=!!window.Worker),delete Affinity2018.CheckForWorkers},CheckCanvas:function(){Affinity2018.SupportsCanvas=!!window.CanvasRenderingContext2D},CheckWebGL:function(){var e;Affinity2018.SupportsWebGL=!1,Affinity2018.SupportsWebGL2=!1;try{e=document.createElement("canvas"),Affinity2018.SupportsWebGL=!(!window.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl")),e=null}catch(e){}try{e=document.createElement("canvas"),Affinity2018.SupportsWebGL2=!(!window.WebGL2RenderingContext||!e.getContext("webgl2")),e=null}catch(e){}},CheckFileApi:function(){Affinity2018.SupportsFileApi=!!(window.File&&window.FileReader&&window.FileList&&window.Blob)},CheckMouseEvents:function(){Affinity2018.WheelEvent="onwheel"in document.createElement("div")?"wheel":void 0!==document.onmousewheel?"mousewheel":"DOMMouseScroll"},CheckElementScrollTo:function(){if(Element.hasOwnProperty("scrollTo")||Element.prototype.hasOwnProperty("scrollTo"))Affinity2018.SupportsElementScrollTo=!0;else{Affinity2018.SupportsElementScrollTo=!1;var e=document.createElement("script");e.src="https://polyfill.io/v3/polyfill.min.js?features=Element.prototype.scroll%2CElement.prototype.scrollIntoView%2CElement.prototype.scrollBy",e.onerror=function(){Element.prototype.scrollTo=function(e,t){void 0!==e&&void 0!==t&&Affinity2018.isNumeric(e)&&Affinity2018.isNumeric(t)&&(this.scrollLeft=e,this.scrollTop=t),void 0===t&&Affinity2018.isObject(e)&&(e.hasOwnProperty("left")&&(this.scrollLeft=e.left),e.hasOwnProperty("top")&&(this.scrollTop=e.top))}},document.head.appendChild(e)}},CheckAsyncAwait:function(){if(Affinity2018.SupportsAsync=!1,Affinity2018.IsMobile?(Affinity2018.Browser.name.toLowerCase().contains("chrome")&&Affinity2018.Browser.major>79||Affinity2018.Browser.name.toLowerCase().contains("android")&&Affinity2018.Browser.major>4&&Affinity2018.Browser.minor>4.4||Affinity2018.Browser.name.toLowerCase().contains("samsung")&&Affinity2018.Browser.major>6&&Affinity2018.Browser.minor>1||Affinity2018.Browser.name.toLowerCase().contains("opera"))&&(Affinity2018.SupportsAsync=!0):(Affinity2018.Browser.ischrome&&Affinity2018.Browser.major>54||Affinity2018.Browser.isfirefox&&Affinity2018.Browser.major>51||Affinity2018.Browser.isedge&&Affinity2018.Browser.major>13||Affinity2018.Browser.issafari&&Affinity2018.Browser.major>10||Affinity2018.Browser.isie&&Affinity2018.Browser.major>11||Affinity2018.Browser.name.toLowerCase().contains("chromium")&&Affinity2018.Browser.major>54||Affinity2018.Browser.name.toLowerCase().contains("opera")&&Affinity2018.Browser.major>41)&&(Affinity2018.SupportsAsync=!0),!Affinity2018.SupportsAsync)try{eval("async () => {}"),Affinity2018.SupportsAsync=!0}catch(e){}},CheckES6:function(){Affinity2018.SupportsES6=function(){try{return new Function("(a = 0) => a"),!0}catch(e){return!1}}(),Affinity2018.ES6Only&&Affinity2018.SupportsES6},DashboardWrapper:function(){for(var e,t=["Dashboard","dashboard","IsDashboard","isDashboard","isdashboard","HasDashboard","hasDashboard","hasdashboard"],i=!1,s=0;s<t.length;s++)e=t[s],Affinity2018.hasOwnProperty(e)&&("boolean"==typeof Affinity2018[e]?i=Affinity2018[e]:Affinity2018[e]&&(i=!0));return Affinity2018.hasOwnProperty("hasDashboardWrapper")||(Affinity2018.hasDashboard=i,Affinity2018.hasDashboardWrapper=function(){return Affinity2018.hasDashboard}),i}},Affinity2018.Classes.ResourcePreloader=class{options(){this.Total=0,this.Loaded=0,this.IsReady=!1,this.Resources={Scripts:{},Extentions:{},Styles:{},Fonts:{},Images:{},Audio:{},Video:{}}}constructor(){if(["Start","AddScripts","AddExtentions","AddStyles","AddFonts","AddImages","AddAudio","AddVideo","Complete","Progress","ResourceLoaded","ResourceFailed","LoadScripts","LoadExtentions","LoadStyles","LoadFonts","LoadImages","LoadAudio","LoadVideo","options"].bindEach(this),this.options(),Affinity2018.hasOwnProperty("PreloadResources")&&Affinity2018.isObject(Affinity2018.PreloadResources)){for(var e in Affinity2018.PreloadResources)Affinity2018.PreloadResources.hasOwnProperty(e)&&Affinity2018.isArray(Affinity2018.PreloadResources[e])&&this.Resources.hasOwnProperty(e)&&(this.Resources[e].Injected=0,this.Resources[e].Loaded=0,this.Resources[e].Total=Affinity2018.PreloadResources[e].length,this.Resources[e].Paths=Affinity2018.jsonCloneObject(Affinity2018.PreloadResources[e]),this.Total+=this.Resources[e].Total);Affinity2018.PreloadResources=null,delete Affinity2018.PreloadResources,Affinity2018.ResourcePreloader=this,Affinity2018.Body.classList.contains("prevent-autoload")?window.dispatchEvent(new CustomEvent("ResourecePreloaderReady")):this.Start()}}Start(){this.Progress(),this.LoadScripts()}AddScript(e){""!==e.trim()&&(this.Resources.Scripts.Total++,this.Resources.Scripts.Paths.push(e.trim()),this.Total++)}AddExtention(e){""!==e.trim()&&(this.Resources.Extentions.Total++,this.Resources.Extentions.Paths.push(e.trim()),this.Total++)}AddStyle(e){""!==e.trim()&&(this.Resources.Styles.Total++,this.Resources.Styles.Paths.push(e.trim()),this.Total++)}AddFont(e){""!==e.trim()&&(this.Resources.Fonts.Total++,this.Resources.Fonts.Paths.push(e.trim()),this.Total++)}AddImage(e){""!==e.trim()&&(this.Resources.Images.Total++,this.Resources.Images.Paths.push(e.trim()),this.Total++)}AddAudio(e){""!==e.trim()&&(this.Resources.Audio.Total++,this.Resources.Audio.Paths.push(e),this.Total++)}AddVideo(e){""!==e.trim()&&(this.Resources.Video.Total++,this.Resources.Video.Paths.push(e),this.Total++)}Complete(){this.Progress(),document.querySelectorAll(".image-preloader,.audio-preloader,.video-preloader").forEach((function(e){domNode.parentNode.removeChild(e)})),Affinity2018.ResourcePreloader=null,delete Affinity2018.ResourcePreloader,Affinity2018.MainStarter=new Affinity2018.Classes.MainStarter}Progress(){window.dispatchEvent(new CustomEvent("ResourecePreloaderProgress",{detail:{total:this.Total,progress:this.Loaded,per:this.Loaded/this.Total}}))}ResourceLoaded(e){let t="target"in e&&"dataset"in e.target?e.target.dataset.group:"family"in e&&"string"==typeof e.family?"Fonts":"";this.Resources.hasOwnProperty(t)&&(this.Loaded++,this.Resources[t].Loaded++,this.Resources[t].Loaded===this.Resources[t].Total&&this.hasOwnProperty("Load"+t)&&Affinity2018.isMethod(this["Load"+t])&&this["Load"+t](),this.Progress())}ResourceFailed(e){this.ResourceLoaded(e)}LoadScripts(){this.Resources.Scripts.Loaded!==this.Resources.Scripts.Total?0===this.Resources.Scripts.Injected&&this.Resources.Scripts.Paths.length>0&&this.Resources.Scripts.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Scripts.Injected++;let t=document.createElement("script");t.setAttribute("src",e),t.dataset.group="Scripts",t.onload=Affinity2018.ResourcePreloader.ResourceLoaded,t.onerror=Affinity2018.ResourcePreloader.ResourceFailed,Affinity2018.Head.appendChild(t)})):this.LoadExtentions()}LoadExtentions(){this.Resources.Extentions.Loaded!==this.Resources.Extentions.Total?0===this.Resources.Extentions.Injected&&this.Resources.Extentions.Paths.length>0&&this.Resources.Extentions.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Extentions.Injected++;let t=document.createElement("script");t.setAttribute("src",e),t.dataset.group="Extentions",t.onload=Affinity2018.ResourcePreloader.ResourceLoaded,t.onerror=Affinity2018.ResourcePreloader.ResourceFailed,Affinity2018.Head.appendChild(t)})):this.LoadStyles()}LoadStyles(){this.Resources.Styles.Loaded!==this.Resources.Styles.Total?0===this.Resources.Styles.Injected&&this.Resources.Styles.Paths.length>0&&this.Resources.Styles.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Styles.Injected++;let t=document.createElement("link");t.setAttribute("href",e),t.setAttribute("rel","stylesheet"),t.dataset.group="Styles",t.onload=Affinity2018.ResourcePreloader.ResourceLoaded,t.onerror=Affinity2018.ResourcePreloader.ResourceFailed,Affinity2018.Head.appendChild(t)})):this.LoadFonts()}LoadFonts(){this.Resources.Fonts.Loaded!==this.Resources.Fonts.Total?0===this.Resources.Fonts.Injected&&this.Resources.Fonts.Paths.length>0&&this.Resources.Fonts.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Fonts.Injected++,new FontFaceObserver(e).load().then(Affinity2018.ResourcePreloader.ResourceLoaded).catch(Affinity2018.ResourcePreloader.ResourceFailed)})):this.LoadImages()}LoadImages(){this.Resources.Images.Loaded!==this.Resources.Images.Total?0===this.Resources.Images.Injected&&this.Resources.Images.Paths.length>0&&this.Resources.Images.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Images.Injected++;let t=document.createElement("img");t.setAttribute("src",e),t.classList.add("obscured image-preloader"),t.dataset.group="Images",t.onload=Affinity2018.ResourcePreloader.ResourceLoaded,t.onerror=Affinity2018.ResourcePreloader.ResourceFailed,Affinity2018.Body.appendChild(t)})):this.LoadAudio()}LoadAudio(){this.Resources.Audio.Loaded!==this.Resources.Audio.Total?0===this.Resources.Audio.Injected&&this.Resources.Audio.Paths.length>0&&this.Resources.Audio.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Audio.Injected++;let t=document.createElement("audio");t.setAttribute("src",e),t.classList.add("obscured audio-preloader"),t.dataset.group="Audio",Affinity2018.iOS?Affinity2018.ResourcePreloader.ResourceLoaded({target:t}):t.addEventListener("canplaythrough",Affinity2018.ResourcePreloader.ResourceLoaded,!0),Affinity2018.Body.appendChild(t)})):this.LoadVideo()}LoadVideo(){this.Resources.Video.Loaded!==this.Resources.Video.Total?0===this.Resources.Video.Injected&&this.Resources.Video.Paths.length>0&&this.Resources.Video.Paths.forEach((function(e){Affinity2018.ResourcePreloader.Resources.Video.Injected++;let t=document.createElement("video");t.setAttribute("src",e),t.classList.add("obscured video-preloader"),t.dataset.group="Video",Affinity2018.iOS?Affinity2018.ResourcePreloader.ResourceLoaded({target:t}):t.addEventListener("canplaythrough",Affinity2018.ResourcePreloader.ResourceLoaded,!0),Affinity2018.Body.appendChild(t)})):this.Complete()}},Affinity2018.Classes.MainStarter=class{options(){this.tabbox=!1,this.tabs=!1,this.escapeKeyCapture=!1}constructor(){for(var e in this.options(),["checkMobile","setupPlugins","completeSetup","setTab","setUserDisplay","resetUserDisplay","showLoadLock","hideLoadLock","setloadLocToElementClick","showMobileMenu","hideMobileMenu"].bindEach(this),Affinity2018.Path=Affinity2018.localiseUrl(Affinity2018.Path),Affinity2018.ApiPath=Affinity2018.localiseUrl(Affinity2018.ApiPath),Affinity2018.ContentPath=Affinity2018.localiseUrl(Affinity2018.ContentPath),Affinity2018.TemplatesPath=Affinity2018.localiseUrl(Affinity2018.TemplatesPath),Affinity2018.WebWorkerPath=Affinity2018.localiseUrl(Affinity2018.WebWorkerPath),Affinity2018.ApiEndpoints)Affinity2018.ApiEndpoints.hasOwnProperty(e)&&(Affinity2018.ApiEndpoints[e]=Affinity2018.localiseUrl(Affinity2018.ApiEndpoints[e]));Object.keys(Affinity2018.FeatureChecks).map((function(e,t){Affinity2018.FeatureChecks[e]()})),Affinity2018.FeatureChecks=null,delete Affinity2018.FeatureChecks,this.enabled=!1,Affinity2018.ShowPageLoader=this.showLoadLock,Affinity2018.HidePageLoader=this.hideLoadLock,Affinity2018.Id=Affinity2018.Name.trim().toLowerCase().replace(new RegExp(" ","gi"),"."),Affinity2018.ShowPageLoader(),this.templatesHtml=!1,document.getElementById("affinity-login")?this.checkMobile():axios.get(Affinity2018.TemplatesPath+"templates.html").then(function(e){this.templatesHtml=e.data,this.checkMobile()}.bind(this)).catch((function(e){console.log(e)}))}checkMobile(){Affinity2018.MobileChecked?this.setupPlugins():window.addEventListener("MobileChecked",this.setupPlugins,!1)}setupPlugins(){if(window.removeEventListener("MobileChecked",this.setupPlugins,!1),Affinity2018.Browser.isie&&parseInt(Affinity2018.Browser.major)<11&&document.getElementsByTagName("body")[0].classList.add("not-supported"),Affinity2018.isTeampayoffice=-1!==window.location.href.toLowerCase().indexOf("teampayoffice"),Affinity2018.isTeampayofficeBranch=!!Affinity2018.isTeampayoffice&&-1!==window.location.href.toLowerCase().indexOf("/tb"),this.templatesHtml&&Affinity2018.Body.insertAdjacentHTML("beforeend",this.templatesHtml),Affinity2018.Lang=new Affinity2018.Classes.Lang,Affinity2018.DisablePlugins.contains("Tooltips")||(Affinity2018.Tooltips=new Affinity2018.Classes.Tooltips),Affinity2018.DisablePlugins.contains("Dialog")||(Affinity2018.Dialog=new Affinity2018.Classes.Dialog),Affinity2018.DisablePlugins.contains("Pagination")||(Affinity2018.Pagination=new Affinity2018.Classes.Pagination),Affinity2018.DisablePlugins.contains("UserInfo")||(Affinity2018.UserInfo=new Affinity2018.Classes.UserInfo),Affinity2018.DisablePlugins.contains("HelpLinks")||(Affinity2018.HelpLinks=new Affinity2018.Classes.HelpLinks),Affinity2018.Classes.Plugins.hasOwnProperty("SelectLookups")&&!Affinity2018.DisablePlugins.contains("SelectLookups")&&(Affinity2018.SelectLookups=new Affinity2018.Classes.Plugins.SelectLookups),Affinity2018.Classes.Plugins.hasOwnProperty("Autocompletes")&&!Affinity2018.DisablePlugins.contains("SelectLookups")&&(Affinity2018.Autocompletes=new Affinity2018.Classes.Plugins.Autocompletes),Affinity2018.Classes.Plugins.hasOwnProperty("Calendars")&&!Affinity2018.DisablePlugins.contains("SelectLookups")&&(Affinity2018.Calendars=new Affinity2018.Classes.Plugins.Calendars),document.getElementsByClassName("tabs").length>0){let e,t=0;if(document.getElementsByClassName("tabs")&&(this.tabbox=document.getElementsByClassName("tabs")[0]),this.tabbox&&this.tabbox.getElementsByClassName("tab")&&(this.tabs=this.tabbox.getElementsByClassName("tab")),this.tabs&&this.tabs.length>0)for(;t<this.tabs.length;t++)e=this.tabs[t],e.addEventListener("click",this.setTab)}if(document.getElementById("mobile-menu-button")&&document.getElementById("mobile-menu-bg")&&(this.mobileMenuButton=document.getElementById("mobile-menu-button"),this.mobileMenuBg=document.getElementById("mobile-menu-bg"),this.mobileMenuButton.addEventListener("click",this.showMobileMenu),this.mobileMenuBg.addEventListener("click",this.hideMobileMenu)),document.getElementById("avatar-menu")&&document.getElementById("tabs")){var e=Array.prototype.slice.call(document.getElementById("avatar-menu").getElementsByTagName("a"));e.forEach(this.setloadLocToElementClick),(e=Array.prototype.slice.call(document.getElementById("tabs").getElementsByTagName("a"))).forEach(this.setloadLocToElementClick)}this.enabled=!0,window.addEventListener("LangComplete",this.completeSetup,!1),Affinity2018.Lang.Load()}completeSetup(){window.removeEventListener("LangComplete",this.completeSetup,!1),this.showLogin=function(){},this.hideLogin=function(){},document.getElementById("affinity-login")&&(Affinity2018.Login=new Affinity2018.Classes.Login,this.showLogin=Affinity2018.Login.showLogin,this.hideLogin=Affinity2018.Login.hideLogin),document.getElementById("affinity-login")&&document.getElementById("avatar")&&(Affinity2018.Avatar=new Affinity2018.Classes.Avatar),document.getElementById("content")&&(Affinity2018.RateUs=new Affinity2018.Classes.RateUs),Affinity2018.hasOwnProperty("Tooltips")&&Affinity2018.Tooltips.Apply(),Affinity2018.hasOwnProperty("Pagination")&&Affinity2018.Pagination.Apply(),Affinity2018.hasOwnProperty("UserInfo")&&Affinity2018.UserInfo.Apply(),Affinity2018.hasOwnProperty("HelpLinks")&&Affinity2018.HelpLinks.Apply(),Affinity2018.hasOwnProperty("SelectLookups")&&Affinity2018.SelectLookups.Apply(),Affinity2018.hasOwnProperty("Autocompletes")&&Affinity2018.Autocompletes.Apply(),Affinity2018.hasOwnProperty("Calendars")&&Affinity2018.Calendars.Apply(),Affinity2018.HidePageLoader(),Affinity2018.UiReady=!0,window.dispatchEvent(new Event("MainInit"))}setTab(e){if(!this.enabled)return!1;let t=!1;e&&(t=Affinity2018.getParent(e.target,"tab")),t&&t.classList.contains("tab-button")&&(t=t.parentElement),t&&[].forEach.call(this.tabs,(function(e){e.classList.remove("selected"),e===t&&e.classList.add("selected")}))}showLoadLock(){document.body.classList.add("load-lock")}hideLoadLock(){document.body.classList.remove("load-lock")}setloadLocToElementClick(e){e.addEventListener("click",Affinity2018.ShowPageLoader)}showMobileMenu(){if(!this.enabled)return!1;document.body.classList.add("menu")}hideMobileMenu(){if(!this.enabled)return!1;document.body.classList.remove("menu")}};let globalinit=function(){if(Affinity2018.HideAllTemplates){var e=document.createElement("style");e.innerHTML="\n        #affinity-login,\n        #dialog-bg,\n        #dialog,\n        #loader-bg,\n        #loader,\n        #mobile-menu-bg,\n        #loading-toast {\n          display: none !important;\n        }\n      ",document.head.appendChild(e)}document.removeEventListener("DOMContentLoaded",globalinit,!1),Affinity2018.Head=document.getElementsByTagName("head")[0],Affinity2018.Body=document.getElementsByTagName("body")[0],Affinity2018.Body.classList.add("load-lock"),Affinity2018.UserProfile.CommonName=null,Affinity2018.UserProfile.CompanyNumber=null,Affinity2018.UserProfile.EmployeeNumber=null,document.getElementById("citrixlogin")&&(Affinity2018.HasCitrix=!0,Affinity2018.Body.classList.add("show-citrix"),document.getElementById("citrixlogin").classList.add("hidden")),$a=Affinity2018,new Affinity2018.Classes.ResourcePreloader};document.getElementsByTagName("head")[0]&&document.getElementsByTagName("body")[0]?globalinit():document.addEventListener("DOMContentLoaded",globalinit,!1)})(),"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Apps.CleverForms.Default=class{_options(){this.TypeMap=[],this.AllowedGlobalKeys=[],this.MasterfileTableBlacklist=[],this.PseudoGlobalElementTypes=[],this.AffnityFieldModeTypes={},this.AffnityFieldModeEnums={},this.ArrowTypes={},this.DocumentCategories=[],this.GetElementDataApi=Affinity2018.Path+"FormElement/GetAvailableItems",this.FielddSearchApi=Affinity2018.Path+"FieldDefinition/get",this.GetTemplateApi=Affinity2018.Path+"TemplateV2/GetItems",this.GetInstanceApi=Affinity2018.Path+"Instancev2/GetItems",this.SubmitFormApi=Affinity2018.Path+"Instancev2/Save",this.SaveDataApi=Affinity2018.Path+"FormElement/Save",this.GetDocumentCategory=Affinity2018.Path+"Document/GetDocumentCategoriesTemplateless",this.GetDocumentTypes=Affinity2018.Path+"Document/GetDocumentTypes",this.GetLookupApi=Affinity2018.Path+"Lookup/Get",this.GetModelApi=Affinity2018.Path+"Lookup/GetModel",this.GetGenericGroupLookupApi=Affinity2018.Path+"GenericGroup/Get",this.GetDocumentSigningTemplatesApi=Affinity2018.Path+"DocumentSigning/GetTemplates",this.DocumentSigningPostApi=Affinity2018.Path+"DocumentSigning/Send",this.DocumentSigningCancelApi=Affinity2018.Path+"DocumentSigning/Cancel",this.GetAllAvaiableForms=Affinity2018.Path+"Inbox/GetAvailableForms",this.DesignerPath=Affinity2018.Path+"Inbox",this.InboxPath=Affinity2018.Path,this.PreviewPath=Affinity2018.Path+"TemplateV2/Preview",this.CreateInstancePath=Affinity2018.Path+"Instance/Create",this.FormDetailsApi=Affinity2018.Path+"TemplateV2/Edit",this.BankValidationApi=Affinity2018.Path+"Api/ValidateBankNumber",this.TaxValidationApi=Affinity2018.Path+"Api/ValidateTaxNumber",this.FileGetApi=Affinity2018.Path+"Document/Download",this.FileGetInfoApi=Affinity2018.Path+"Document/GetFileIdNamePairs",this.FilePostApi=Affinity2018.Path+"Document/UploadMulti",this.FileDeleteApi=Affinity2018.Path+"Document/Delete",this.FileDeleteSingleApi=Affinity2018.Path+"Document/DeleteSingle",this.GetUserDataApi=Affinity2018.Path+"Api/GetLoginData",this.defaultConfig={TemplateModel:{Id:null,Name:"",Description:"",Revision:"",Type:"",DashboardTemplate:!1,UserInstructions:"",WorkflowDefinitionIds:""},OnInit:function(){},OnError:function(){}}}constructor(e){if(this._options(),["_init","_getUserData","_gotUserData","_getUserDataError","_loadHtmlTemplates","_templatesLoaded","_loadHtmlTemplatesError","IsGlobalKey","IsPseudoGlobalKey","IsKey","IsReadOnly","IskeyWithNoRequiredKeys","IsMasterFile","IsLookup","SelectDefaultModeOnFieldSearch","__THIS_IS_A_TEMP_TRANSMUTER_FOR_G_G_G_GET_DATA_UNTIL_GET_DATA_MATCHES_NEW_STRUCTURE","__THIS_IS_A_TEMP_TRANSMUTER_FOR_P_P_P_POST_DATA_UNTIL_POST_DATA_MATCHES_NEW_STRUCTURE"].bindEach(this),e&&Affinity2018.isObject(e)){var t=Affinity2018.objectDeepMerge(this.defaultConfig,e);for(i in t)this[i]=t[i];delete this.defaultConfig}for(var i in this)this.hasOwnProperty(i)&&Affinity2018.isString(this[i])&&this[i].startsWith("http")&&(this[i]=Affinity2018.localiseUrl(this[i]));for(var i in this.ArrowTypeEnum={},this.ArrowTypes)this.ArrowTypes.hasOwnProperty(i)&&(this.ArrowTypeEnum[this.ArrowTypes[i].Enum]=this.ArrowTypes[i]);var s=Affinity2018.hasOwnProperty("EnablePost")?Affinity2018.EnablePost.toLowerCase().trim():"";Affinity2018.EnablePost="false"!==s,Affinity2018.ApiEndpoints.BankValidationApi=this.BankValidationApi,Affinity2018.ApiEndpoints.TaxValidationApi=this.TaxValidationApi,Affinity2018.ApiEndpoints.GetUserDataApi=this.GetUserDataApi,Affinity2018.UiReady?this._init():window.addEventListener("MainInit",this._init)}_init(){Affinity2018.ShowPageLoader();var e=Affinity2018.Path+"/Scripts/V2/apps/cleverforms/Elements.json";axios({url:e,method:"get"}).then(function(t){if($a.isPropObject(t,"data")&&$a.isPropObject(t.data,"Elements")&&$a.isPropArray(t.data,"TableTypes")){for(var i in this.DefaultPostObject={},this.ElementKeys=Object.keys(t.data.Elements),this.ElementData=t.data.Elements,this.TableTypes=t.data.TableTypes,this.ArrowTypes=t.data.ArrowTypes,this.TypeMap=t.data.TypeMap,this.DocumentCategories=t.data.DocumentCategories,this.ElementControllerMap={},this.TableTypes.sort((function(e,t){return e.Value<t.Value?-1:e.Value>t.Value?1:0})),this.AffnityFieldModeTypes=t.data.AffnityFieldModeTypes,this.AffnityFieldModeEnums={},this.AffnityFieldModeTypes)this.AffnityFieldModeTypes.hasOwnProperty(i)&&(this.AffnityFieldModeEnums[this.AffnityFieldModeTypes[i].Enum]=this.AffnityFieldModeTypes[i]);var s,o;for(s in this.ElementData)this.ElementData.hasOwnProperty(s)&&(o=this.ElementData[s],Affinity2018.Classes.Apps.CleverForms.Elements.hasOwnProperty(o.Type)?o.hasOwnProperty("TableTypes")&&(this.ElementData[o.Type].TableTypes=$a.jsonCloneObject(this.TableTypes)):$a.LogError('Missing Element Component for "'+o.Type+'".',"important",'Missing Element Component for "'+o.Type+'".'),o.Cloned=!1,this.DefaultPostObject=Object.assign({},this.DefaultPostObject,o.Details));for(var a=0;a<this.TypeMap.length;a++)this.ElementData.hasOwnProperty(this.TypeMap[a].From)&&!this.ElementData.hasOwnProperty(this.TypeMap[a].To)&&(this.ElementData[this.TypeMap[a].To]=$a.jsonCloneObject(this.ElementData[this.TypeMap[a].From]),this.ElementData[this.TypeMap[a].To].Cloned=!0,this.ElementControllerMap[this.TypeMap[a].To]=this.TypeMap[a].From);this.AllowedGlobalKeys=t.data.AllowedGlobalKeys,this.PseudoGlobalElementTypes=t.data.PseudoGlobalElementTypes,this.MasterfileTableBlacklist=t.data.MasterfileTableBlacklist,this.GenderFields=t.data.GenderFields,this.BooleanToRadioFields=t.data.BooleanToRadioFields,this._getUserData()}else $a.LogError("Element Error","critical","Failed to get Element data from source ("+e+").")}.bind(this)).catch(function(e){$a.LogError("Element Error","critical","Failed to load Element data.",e)}.bind(this))}GetInstanceGuid(){return document.querySelector("#InstanceId")&&"value"in document.querySelector("#InstanceId")&&"string"==typeof document.querySelector("#InstanceId").value&&""!==document.querySelector("#InstanceId").value.trim()?document.querySelector("#InstanceId").value.trim():this.GetInstanceGuidFromAddressBar()}GetInstanceGuidFromAddressBar(){var e=window.location.href.toLowerCase();return!(2!==e.split("/edit/").length||!$s.isString(e.split("/edit/")[1])||""===e.split("/edit/")[1].trim())&&e.split("/edit/")[1].trim()}GetTemplateGuid(){return document.querySelector("#TemplateId")&&"value"in document.querySelector("#TemplateId")&&"string"==typeof document.querySelector("#TemplateId").value&&""!==document.querySelector("#TemplateId").value.trim()?document.querySelector("#TemplateId").value.trim():this.GetTemplateGuidFromAddressBar()}GetTemplateGuidFromAddressBar(){var e,t,i=window.location.search.toLowerCase(),s=!1,o=0;if(i.contains("templateId=")){for(e=i.split("&");o<e.length;o++)if("templateId"===(t=e[o].split("="))[0]){s=t[1];break}if(s)return s}return!1}BackfillConfig(e){!e.hasOwnProperty("Type")&&e.hasOwnProperty("ElementType")&&(e.Type=e.ElementType),e.hasOwnProperty("ElementType")&&delete e.ElementType;var t=$a.jsonCloneObject(this.ElementData[e.Type]);for(var i in t)t.hasOwnProperty(i)&&"Details"!==i&&(e.hasOwnProperty(i)&&null!==e[i]||(e[i]=t[i]));if($a.isPropObject(t,"Details")&&$a.isPropObject(e,"Details")){for(i in t.Details)t.Details.hasOwnProperty(i)&&"AffinityField"!==i&&(e.Details.hasOwnProperty(i)&&null!==e.Details[i]||(e.Details[i]=t.Details[i]));null!==e.Label&&null===e.Details.Label&&(e.Details.Label=e.Label)}return e}ReturnClassSafeString(e){return!!$a.isString(e)&&e.trim().toLowerCase().replace(/ |_/gi,"-").trim()}CheckResponseForErrorPage(e){var t="OK";if(e&&"string"===$a.type(e)&&""!==e)if(e.contains("This is not a page!"))t="Response is a 404 error page";else if(this.IsErrorPage(e)||e.contains('<div class="error-info">')){var i;if((i=this.GetDetailsFromErrorPage(e))&&""!==i.Details)return i.Details;var s=e.indexOf("<h1>",e.indexOf('<div class="error-info">'))+4,o=e.indexOf("</h1>",s);t=e.substring(s,o).trim()}return this.IsErrorPage(e)&&(i=this.GetDetailsFromErrorPage(e))&&""!==i.Details?i.Details:t}IsGlobalKey(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!!this.AllowedGlobalKeys.contains(e.Details.AffinityField.FieldName)}IsPseudoGlobalKey(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!!this.PseudoGlobalElementTypes.contains(e.Type)}IsKey(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!!e.Details.AffinityField.IsKeyField}IsReadOnly(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!!e.Details.AffinityField.IsReadOnly}IskeyWithNoRequiredKeys(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!(!e.Details.AffinityField.IsKeyField||"array"!==$a.type(e.Details.AffinityField.KeyFields)||0!==e.Details.AffinityField.KeyFields.length)}IsMasterFile(e){return!(!($a.isPropObject(e,"Details")&&$a.isPropObject(e.Details,"AffinityField")&&$a.isPropString(e.Details.AffinityField,"ModelName"))||this.MasterfileTableBlacklist.contains(e.Details.AffinityField.ModelName))}IsLookup(e){return!!e.hasOwnProperty("Details")&&!!e.Details.hasOwnProperty("AffinityField")&&!(!$a.isString(e.Details.AffinityField.LookupTable)||""===e.Details.AffinityField.LookupTable.trim())}ReturnExisitingModelKeyNode(e,t){var i=null;if(Affinity2018.Apps.CleverForms.hasOwnProperty("Designer")){var s,o=Affinity2018.Apps.CleverForms.Designer.RightListNode;null!==i&&(s='li[data-type="AffinityField"][data-model="{0}"].is-global-key'.format(e),o.querySelector(s)&&(i=o.querySelector(s))),null!==i&&(s='li[data-type="AffinityField"][data-model="{0}"].is-key-field'.format(e),o.querySelector(s)&&(i=o.querySelector(s)))}return i}ReturnExisitingModelNode(e,t){var i=this.ReturnExisitingModelKeyNode(e,t);if(null===i&&Affinity2018.Apps.CleverForms.hasOwnProperty("Designer")){var s,o=Affinity2018.Apps.CleverForms.Designer.RightListNode;s='li[data-type="AffinityField"][data-model="{0}"]'.format(e),o.querySelector(s)&&(i=o.querySelector(s))}return i}SelectDefaultModeOnFieldSearch(e){var t=$a.jsonCloneObject(this.AffnityFieldModeTypes),i=0,s="Create",o=this.IsGlobalKey(e),a=this.IsKey(e),n=this.IsLookup(e),r=this.IsMasterFile(e),l=this.IskeyWithNoRequiredKeys(e),d=this.IsReadOnly(e);o&&(t.Edit.Show=!1,t.Select.Show=!0,t.Create.Show=!0,t.Hidden.Show=!0,t.Initiator.Show=!0,i=4),!o&&r&&(d&&!a?(t.Edit.Show=!1,t.Select.Show=n,t.Create.Show=!1,t.Display.Show=!0,i=n?4:2):d&&a?(t.Edit.Show=!1,t.Select.Show=!0,t.Create.Show=!0,t.Display.Show=!0,i=0):l?(t.Edit.Show=!1,t.Select.Show=!0,t.Create.Show=!0,i=0,n&&(t.Create.Show=!1,t.Display.Show=!1,i=4)):!l&&a&&n?(t.Create.Show=!1,t.Display.Show=!1,i=4):n?(t.Create.Show=!1,t.Edit.Show=!1,t.Select.Show=!0,i=4):(t.Create.Show=!0,t.Edit.Show=!0,i=0)),r||(n?(t.Edit.Show=!1,t.Select.Show=!0,t.Display.Show=!1,t.Create.Show=!1,i=4):(t.Select.Show=!1,t.Display.Show=!1,t.Create.Show=!0,i=0)),(a||o)&&(t.Display.Show=!1);var h=this.ReturnExisitingModelKeyNode(e.Details.AffinityField.ModelName),c=!1;if(h&&r){var u=h.controller.Config.Details.AffinityField.Mode,p=null!==u?this.AffnityFieldModeEnums[u].Name:null;if(p&&(!n&&[1,4].contains(u)?1!==i&&t.Edit.Show?i=1:t[p].Show?i=u:c=!0:!n||0!==u&&1!==u?t[p].Show?i=u:c=!0:i=4),c){var f='ERROR! Can not select default Mode "{0}" ({1}). Option is Hidden.'.format(p,u);console.log("%c"+f,"color:#e33100;font-weight:bold"),Affinity2018.ThrowError("Mode Error","critical",f)}}if(t.Hidden.Show=!1,null!==i){for(var m in s=this.AffnityFieldModeEnums[i].Name,console.groupCollapsed("%cDefault Mode & Mode Options Selected:","color:#b27e0f"),console.log('%cDefault Mode: "'+s+'" ('+i+")","color:#b27e0f"),console.log("%cDefault Mode Options:","color:#b27e0f"),e.Details.AffinityField.Mode=i,e.Details.AffinityField.ModeOptions=[],t){var y=t[m];y.Show?(e.Details.AffinityField.ModeOptions.push(y.Enum),console.log("%c\t"+y.Name+" is Available","color:#b27e0f")):console.log("%c\t"+y.Name+" is Hidden","color:#b27e0f")}console.groupEnd()}else e.Details.AffinityField.Mode=-1,e.Details.AffinityField.ModeOptions=[];return e}OrderObject(e){var t=function(e){var i={},s=Object.keys(e);s.sort();for(var o=0;o<s.length;o++){var a=s[o],n=e[a];if($a.isObject(n))i[a]=t(n);else if($a.isArray(n)){i[a]=[];for(var r=0;r<n.length;r++){var l=n[r];$a.isObject(l)||$a.isArray(l)?i[a][r]=t(l):i[a][r]=l}i[a].sort()}else i[a]=e[a]}return i};return t(e)}IsErrorPage(e){return Affinity2018.isString(e)?e.contains("<!DOCTYPE html>"):!!(e&&e.hasOwnProperty("response")&&$a.isObject(e.response)&&e.response.hasOwnProperty("data")&&$a.isString(e.response.data)&&e.response.data.contains("<!DOCTYPE html>"))}GetDetailsFromErrorPage(e){var t=null;if(this.IsErrorPage(e)){var i,s,o,a,n;t={Title:"",Source:"",Description:"",Details:"",Lines:[]};var r=function(e){return(e=(e=(e=(e=e.replace(/(\<br\>)/g," - ")).replace(/(\<b\>)/g,"")).replace(/(\<\/b\>)/g,"")).replace(/(\&nbsp\;)/g," ")).replace(/  +/g," ").trim()};e&&e.hasOwnProperty("response")&&$a.isObject(e.response)&&e.response.hasOwnProperty("data")&&$a.isString(e.response.data)&&e.response.data.contains("<!DOCTYPE html>")&&(e=e.response.data),e.contains("<title>")&&e.contains("</title>")&&(i=e.indexOf("<title>")+7,s=e.indexOf("</title>",i),""!==(o=e.substr(i,s-i).trim()).trim()&&(t.Title=r(o))),e.contains("<b> Source File: </b>")&&(i=e.indexOf("<b> Source File: </b>")+11,s=e.indexOf("<br>",i),""!==(o=e.substr(i,s-i).trim()).trim()&&(t.Source=r(o.replace("File:","")))),e.contains("<b> Description: </b>")&&(i=e.indexOf("<b> Description: </b>")+21,s=e.indexOf("<br>",i),""!==(o=e.substr(i,s-i).trim()).trim()&&(t.Description=r(o))),e.contains("<b> Exception Details: </b>")&&(i=e.indexOf("<b> Exception Details: </b>")+27,s=e.indexOf("<br>",i),""!==(o=e.substr(i,s-i).trim()).trim()&&(t.Details=r(o))),e.contains("pre")&&(i=e.indexOf("<pre>")+4,s=e.indexOf("</pre>",i),e.substr(i,s-i).split("\n").forEach((function(e){n="",e.contains("Line ")&&e.contains(":")?(i=e.indexOf("Line ")+5,s=e.indexOf(":"),n="Line "+e.substr(i,s-i)+": ",a=e.substr(s+1).trim()):a=e.trim(),"{"!==a&&"}"!==a&&">"!==a&&""!==a&&t.Lines.push(r(n+a))})))}return t}GetErrorPageOutputString(e){var t="";if(this.IsErrorPage(e)&&(e=this.GetDetailsFromErrorPage(e)),$a.isObject(e)){var i=[];if(e.hasOwnProperty("Title")&&""!==e.Title?i.push(e.Title):i.push("Error"),e.hasOwnProperty("Details")&&""!==e.Details&&i.push(e.Details),e.hasOwnProperty("Description")&&""!==e.Description&&i.push(e.Description),e.hasOwnProperty("Source")&&""!==e.Source&&i.push(e.Source),e.hasOwnProperty("Lines")&&e.Lines.length>0)for(var s=0;s<e.Lines.length;s++)$a.isString(e.Lines[s])&&""!==e.Lines[s]&&i.push("\t"+$a.decodeHTML(e.Lines[s]));t=i.join("\n")}return t}_getUserData(){var e=null;Affinity2018.isPropObject(Affinity2018,"ApiEndpoints")&&Affinity2018.isPropString(Affinity2018.ApiEndpoints,"GetUserDataApi")&&""!==Affinity2018.ApiEndpoints.GetUserDataApi.trim()?(e=Affinity2018.ApiEndpoints.GetUserDataApi+"",window.addEventListener("GotUser",this._gotUserData),axios({method:"GET",url:e}).then(function(e){window.dispatchEvent(new CustomEvent("GotUser",{detail:e}))}.bind(this)).catch(this._getUserDataError)):this._getUserDataError("Failed to get API")}_gotUserData(e){window.removeEventListener("GotUser",this._gotUserData),"detail"in e&&(e=e.detail),Affinity2018.isPropObject(e,"data")&&Affinity2018.isPropInt(e.data,"EmployeeNumber")?(Affinity2018.UserProfile={},Affinity2018.UserProfile.CompanyNumber=e.data.CompanyNumber.toString(),Affinity2018.UserProfile.EmployeeNumber=e.data.EmployeeNumber.toString(),Affinity2018.UserProfile.UserGuid="e"+Affinity2018.UserProfile.EmployeeNumber.padLeft("0",7)+"-"+Affinity2018.UserProfile.CompanyNumber+"-0000-0000-000000000000",window.dispatchEvent(new Event("GotUserData")),this.OnInit()):this._getUserDataError("Failed to get data from response")}_getUserDataError(e){var t="Could not get logged in user data. "+e+". CleverForms Default failed.";Affinity2018.LogError("Bootstrap Error","critical",t),this.OnError(t)}__THIS_IS_A_TEMP_TRANSMUTER_FOR_G_G_G_GET_DATA_UNTIL_GET_DATA_MATCHES_NEW_STRUCTURE(e,t){var i;if(e.hasOwnProperty("Type")){if((i=$a.jsonCloneObject(this.ElementData[e.Type])).Name=e.Name,i.Elements=e.Elements,i.hasOwnProperty("Details")&&(i.Details.Rank=e.Rank,e.hasOwnProperty("UserText")&&i.Details.hasOwnProperty("Label")&&(i.Details.Label=e.UserText),e.hasOwnProperty("Text")&&i.Details.hasOwnProperty("Label")&&(i.Details.Label=e.Text),e.hasOwnProperty("Tooltip")&&i.Details.hasOwnProperty("HelpText")&&e.Tooltip!==i.Tooltip&&(i.Details.HelpText=e.Tooltip),i=this.__PORT_G_G_G_GET_DETAILS(e,"HelpText",i,"HelpText"),i=this.__PORT_G_G_G_GET_DETAILS(e,"Required",i,"Required"),i=this.__PORT_G_G_G_GET_DETAILS(e,"DateTimeType",i,"DateTimeType"),i=this.__PORT_G_G_G_GET_DETAILS(e,"SetDefaultValue",i,"SetDefaultValue"),i=this.__PORT_G_G_G_GET_DETAILS(e,"VideoId",i,"VideoId"),i=this.__PORT_G_G_G_GET_DETAILS(e,"FileName",i,"FileName"),i=this.__PORT_G_G_G_GET_DETAILS(e,"UrlLink",i,"UrlLink"),i=this.__PORT_G_G_G_GET_DETAILS(e,"DecimalNumber",i,"DecimalNumber"),i=this.__PORT_G_G_G_GET_DETAILS(e,"ArrowDirection",i,"ArrowDirection"),i=this.__PORT_G_G_G_GET_DETAILS(e,"ExternalTemplateId",i,"ExternalTemplateId"),i=this.__PORT_G_G_G_GET_DETAILS(e,"Recipients",i,"Recipients"),i=this.__PORT_G_G_G_GET_DETAILS(e,"File",i,"FileId"),i=this.__PORT_G_G_G_GET_DETAILS(e,"FileId",i,"FileId"),i=this.__PORT_G_G_G_GET_DETAILS(e,"LongText",i,"Text"),i=this.__PORT_G_G_G_GET_ITEMSOURCE(e,i),i=this.__PORT_G_G_G_GET_FIELSETTING(e,i),"Section"===(i=this.__PORT_G_G_G_GET_SECTIONWORKFLOWVISIBILITYSETTINGS(e,i)).Type&&(i.Details.Label=e.Details.Title,i.Details.ShowTitle=e.Details.ShowTitle,i.Details.StartCollapsed=e.Details.StartCollapsed,delete i.Details.Title),"Title"===i.Type&&(i.Details.Label=e.Details.Text,i.Label=e.Details.Text),"AffinityField"===i.Type))if(e.Details.hasOwnProperty("AffinityField")&&null!==e.Details.AffinityField){if(i=this.__PORT_G_G_G_GET_AFFINITYFIELD_DATA(e,i),e.Details.AffinityField.hasOwnProperty("RequiresKeys")&&(e.Details.AffinityField.KeyFields=e.Details.AffinityField.RequiresKeys),$a.isArray(e.Details.AffinityField.KeyFields)&&($a.isArray(i.Details.AffinityField.KeyFields)||(i.Details.AffinityField.KeyFields=[]),0===i.Details.AffinityField.KeyFields.length&&e.Details.AffinityField.KeyFields.length>0))for(var s,o,a,n,r,l=0;l<e.Details.AffinityField.KeyFields.length;l++)for(s=e.Details.AffinityField.KeyFields[l],o=0;o<t.length;o++)if(t[o].Elements.length>0)for(a=0;a<t[o].Elements.length;a++)"AffinityField"===t[o].Elements[a].ElementType&&t[o].Elements[a].Details.AffinityField.FieldName===s&&((n={}).Detail={},n.Details.AffinityField=$a.jsonCloneObject(t[o].Elements[a].Details.AffinityField),r=$a.jsonCloneObject(this.ElementData.AffinityField),(r=this.__PORT_G_G_G_GET_AFFINITYFIELD_DATA(n,r)).Details.AffinityField.KeyFields=[],i.Details.AffinityField.KeyFields.push($a.jsonCloneObject(r.Details.AffinityField)))}else console.warn("trying to parse old AffinityField cofing to new when ther is no AffinityField data",e);return i}return e}__PORT_G_G_G_GET_DETAILS(e,t,i,s){return e.hasOwnProperty("Details")&&$a.isObject(e.Details)&&e.Details.hasOwnProperty(t)&&i.hasOwnProperty("Details")&&$a.isObject(i.Details)&&i.Details.hasOwnProperty(s)&&(i.Details[s]=e.Details[t]),i}__PORT_G_G_G_GET_ITEMSOURCE(e,t){return e.hasOwnProperty("Details")&&$a.isObject(e.Details)&&e.Details.hasOwnProperty("ItemSource")&&$a.isObject(e.Details.ItemSource)&&e.Details.ItemSource.hasOwnProperty("Items")&&(t.Details.ItemSource=e.Details.ItemSource,e.Details.ItemSource.hasOwnProperty("TableType")||(t.Details.ItemSource.TableType=null)),t}__PORT_G_G_G_GET_FIELSETTING(e,t){return e.hasOwnProperty("Details")&&$a.isObject(e.Details)&&e.Details.hasOwnProperty("FileSetting")&&$a.isObject(e.Details.FileSetting)&&(this.DocumentCategories.hasOwnProperty(e.Details.FileSetting.DocumentCategory)?this.DocumentCategories.forEach(function(i){i&&i.hasOwnProperty("Key")&&i.hasOwnProperty("Value")&&i.Key===e.Details.FileSetting.DocumentCategory&&(t.Details.DocumentCategory=i.Value)}.bind(this)):t.Details.DocumentCategory=e.Details.FileSetting.DocumentCategory,t.Details.DocumentType=e.Details.FileSetting.DocumentType,t.Details.SecurityLevel=e.Details.FileSetting.SecurityLevel),t.Details.hasOwnProperty("AttachFormOnly")&&(t.Details.AttachFormOnly=e.Details.AttachFormOnly),t}__PORT_G_G_G_GET_SECTIONWORKFLOWVISIBILITYSETTINGS(e,t){if(e.hasOwnProperty("Details")&&$a.isObject(e.Details)&&e.Details.hasOwnProperty("SectionWorkflowVisibilitySettings")&&$a.isArray(e.Details.SectionWorkflowVisibilitySettings)){var i=0;for(t.Details.SectionWorkflowVisibilitySettings=[];i<e.Details.SectionWorkflowVisibilitySettings.length;i++)t.Details.SectionWorkflowVisibilitySettings.push(e.Details.SectionWorkflowVisibilitySettings[i])}return t}__PORT_G_G_G_GET_AFFINITYFIELD(e,t,i,s){return e.hasOwnProperty("Details")&&$a.isObject(e.Details)&&e.Details.hasOwnProperty("AffinityField")&&$a.isObject(e.Details.AffinityField)&&e.Details.AffinityField.hasOwnProperty(t)&&i.hasOwnProperty("Details")&&$a.isObject(i.Details)&&i.Details.hasOwnProperty("AffinityField")&&$a.isObject(i.Details.AffinityField)&&i.Details.AffinityField.hasOwnProperty(s)&&(i.Details.AffinityField[s]=e.Details.AffinityField[t]),i}__PORT_G_G_G_GET_AFFINITYFIELD_DATA(e,t){return!$a.isPropObject(e,"Details")||$a.isPropObject(e,"Details")&&!$a.isPropObject(e.Details,"AffinityField")?(console.warn("trying to parse old AffinityField cofing to new when ther is no AffinityField data",e),e):(t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"DataType",t,"DataType"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"FieldDescription",t,"FieldDescription"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"FieldName",t,"FieldName"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"DisplayLabel",t,"DisplayLabel"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"IsKeyField",t,"IsKeyField"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"IsMandatory",t,"IsRequired"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"IsReadOnly",t,"IsReadOnly"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MaxLength",t,"MaxLength"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MaxValue",t,"MaxValue"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MinLength",t,"MinLength"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MinValue",t,"MinValue"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MaximumValue",t,"MaxValue"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"MinimumValue",t,"MinValue"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"PropertyType",t,"PropertyType"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"LookupTable",t,"LookupTable"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"GenericGroupId",t,"GenericGroupId"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"LinkedTemplateId",t,"LinkedTemplateId"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"FieldDecimal",t,"FieldDecimal"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"FieldPrecision",t,"FieldPrecision"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"CleverFormsDisplayType",t,"CleverFormsDisplayType"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"Mode",t,"Mode"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"ModeOptions",t,"ModeOptions"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"KeyFields",t,"KeyFields"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"IsMasterfileData",t,"IsMasterfileData"),$a.isString(t.Details.AffinityField.MaxValue)&&!isNaN(parseInt(t.Details.AffinityField.MaxValue))&&(t.Details.AffinityField.MaxValue=parseInt(t.Details.AffinityField.MaxValue)),$a.isString(t.Details.AffinityField.MinValue)&&!isNaN(parseInt(t.Details.AffinityField.MinValue))&&(t.Details.AffinityField.MinValue=parseInt(t.Details.AffinityField.MinValue)),$a.isString(t.Details.AffinityField.MaxLength)&&!isNaN(parseInt(t.Details.AffinityField.MaxLength))&&(t.Details.AffinityField.MaxLength=parseInt(t.Details.AffinityField.MaxLength)),$a.isString(t.Details.AffinityField.MinLength)&&!isNaN(parseInt(t.Details.AffinityField.MinLength))&&(t.Details.AffinityField.MinLength=parseInt(t.Details.AffinityField.MinLength)),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"ModelName",t,"ModelName"),t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"TableName",t,"ModelName"),$a.isPropObject(e,"Details")&&$a.isPropObject(e.Details,"AffinityField")&&!$a.isPropString(e.Details.AffinityField,"CleverFormsDisplayType")&&(t=this.__PORT_G_G_G_GET_AFFINITYFIELD(e,"DataType",t,"CleverFormsDisplayType")),t.hasOwnProperty("RequiresKeys")&&(t.RequiresKeys=null,delete t.RequiresKeys),$a.isPropObject(e,"Details")&&$a.isPropObject(e.Details,"AffinityField")&&e.Details.AffinityField.hasOwnProperty("RequiresKeys")&&(t.Details.AffinityField.RequiresKeys=null,delete t.Details.AffinityField.RequiresKeys),t.Hidden=e.Hidden,t.Disabled=e.Disabled,t)}__THIS_IS_A_TEMP_TRANSMUTER_FOR_P_P_P_POST_DATA_UNTIL_POST_DATA_MATCHES_NEW_STRUCTURE(e){var t=document.querySelector(".cf-d2-bottom-right ul .item-"+e.Name),i=t?t.closest('li[data-type="Section"]'):null,s=t?t.controller:null,o=!1,a={};if(null===t||null===s){if(console.groupEnd(),!e.hasOwnProperty("Name")||null===e.Name||!1===e.Name)throw new Error("Node was not found because config has no Name");throw new Error("Node was not found")}switch("Section"===e.ViewType?o=s.Delete?"delete-section":s.Saved?"edit-section":"create-section":"Layout"===e.ViewType?o=s.Delete?"delete-layout":s.Saved?"edit-layout":"create-layout":"Question"===e.ViewType&&(o=s.Delete?"delete-question":s.Saved?"edit-question":"create-question"),a.TemplateId=this.GetTemplateGuid(),a.SectionName="Section"===e.Type?e.Name:i?i.controller.Name:t.controller.SectionName,a.Name=e.Name,a.Rank=e.Details.Rank,a.ShortText=e.Details.Label,a.HelpText=e.Details.HelpText,a.Required="boolean"==typeof e.Details.IsRequired&&!0===e.Details.IsRequired,a.IsRequired="boolean"==typeof e.Details.IsRequired&&!0===e.Details.IsRequired?"True":"False",a.ElementType=e.Type,"AffinityField"===e.Type?(a.CleverFormsDisplayType=e.Details.AffinityField.CleverFormsDisplayType,a.DataType=e.Details.AffinityField.DataType,a.PropertyType=e.Details.AffinityField.PropertyType,a.ModelName=e.Details.AffinityField.ModelName,a.DisplayLabel=e.Details.AffinityField.DisplayLabel,a.FieldName=e.Details.AffinityField.FieldName,a.FileId=e.Details.AffinityField.FileId,a.GenericGroupId=e.Details.AffinityField.GenericGroupId,a.LookupTable=e.Details.AffinityField.LookupTable,a.IsKeyField=e.Details.AffinityField.IsKeyField,a.IsReadOnly=e.Details.AffinityField.IsReadOnly,a.IsMasterfileData=e.Details.AffinityField.IsMasterfileData,a.LinkedTemplateId=e.Details.AffinityField.LinkedTemplateId,a.KeyFields=e.Details.AffinityField.KeyFields,a.Mode=e.Details.AffinityField.Mode,a.ModeOptions=e.Details.AffinityField.ModeOptions,a.MaxLength=e.Details.AffinityField.MaxLength,a.MinLength=e.Details.AffinityField.MinLength,a.MaxValue=e.Details.AffinityField.MaxValue,a.MinValue=e.Details.AffinityField.MinValue,a.Hidden=e.Hidden):(a.DataType=e.Type,a.PropertyType=e.Type,a.ModelName=null,a.FieldName=null,a.AffinityField=null,a.CleverFormsDisplayType=e.Type),""===a.HelpText&&(a.HelpText=null),"Title"===e.Type&&(a.Text=e.Details.Label,a.Label=e.Details.Label,a.LongText=e.Details.Label),"Section"===e.Type&&(a.SectionName=e.Name,a.Title=e.Details.Label,a.Label=e.Details.Label,a.ShortText=e.Details.Label,a.Text=e.Details.Label,a.ShowTitle=e.Details.ShowTitle,a.StartCollapsed=e.Details.StartCollapsed,a.SectionWorkflowVisibilitySettings=e.Details.SectionWorkflowVisibilitySettings),e.Details.hasOwnProperty("Label")&&(a.ShortText=e.Details.Label),e.Details.hasOwnProperty("HelpText")&&(a.HelpText=e.Details.HelpText),e.Details.hasOwnProperty("Required")&&(a.IsRequired=!0===e.Details.Required?"true":"false"),e.Details.hasOwnProperty("Required")&&(a.Required=e.Details.Required),e.Details.hasOwnProperty("Text")&&(a.LongText=e.Details.Text),e.Details.hasOwnProperty("ItemSource")&&(e.Details.ItemSource.hasOwnProperty("CustomList")&&(a.CustomList=e.Details.ItemSource.CustomList),e.Details.ItemSource.hasOwnProperty("ItemSourceType")&&(a.ItemSourceType=e.Details.ItemSource.ItemSourceType),e.Details.ItemSource.hasOwnProperty("TableType")&&(a.AffinityTableType=e.Details.ItemSource.TableType),"Custom"!==a.ItemSourceType||void 0!==a.CustomList&&null!==a.CustomList&&a.CustomList!==[]||!e.Details.ItemSource.hasOwnProperty("Items")||(a.CustomList=e.Details.ItemSource.Items)),e.Details.hasOwnProperty("ElementTypeEnum")&&(a.ElementTypeEnum=e.Details.ElementTypeEnum),e.Details.hasOwnProperty("Type")&&(a.ElementType=e.Details.Type),e.Details.hasOwnProperty("DocumentCategory")&&(a.DocumentCategory=e.Details.DocumentCategory),e.Details.hasOwnProperty("DocumentType")&&(a.DocumentType=e.Details.DocumentType),e.Details.hasOwnProperty("SecurityLevel")&&(a.SecurityLevel=e.Details.SecurityLevel),e.Details.hasOwnProperty("AttachFormOnly")&&(a.AttachFormOnly=e.Details.AttachFormOnly),e.Details.hasOwnProperty("FileId")&&(a.FileId=e.Details.FileId),e.Details.hasOwnProperty("FileName")&&(a.FileName=e.Details.FileName),e.Details.hasOwnProperty("DecimalNumber")&&(a.DecimalNumber=e.Details.DecimalNumber),e.Details.hasOwnProperty("ArrowDirection")&&(a.ArrowDirection=e.Details.ArrowDirection),e.Details.hasOwnProperty("DateTimeType")&&(a.DateTimeType=e.Details.DateTimeType),e.Details.hasOwnProperty("SetDefaultValue")&&(a.SetDefaultValue=e.Details.SetDefaultValue),e.Details.hasOwnProperty("UrlLink")&&(a.UrlLink=e.Details.UrlLink),e.Details.hasOwnProperty("VideoId")&&(a.VideoId=e.Details.VideoId),e.Details.hasOwnProperty("ExternalTemplateId")&&(a.ExternalTemplateId=e.Details.ExternalTemplateId),e.Details.hasOwnProperty("Recipients")&&(a.Recipients=e.Details.Recipients),o){case"edit-section":a.Action="Edit",a.ActionType="Section";break;case"create-section":a.Action="Create",a.ActionType="Section";break;case"delete-section":a.Action="Delete",a.ActionType="Section";break;case"edit-question":a.Action="Edit",a.ActionType="Question";break;case"create-question":a.Action="Create",a.ActionType="Question";break;case"delete-question":a.Action="Delete",a.ActionType="Question";break;case"edit-layout":a.Action="Edit",a.ActionType="Layout";break;case"create-layout":a.Action="Create",a.ActionType="Layout";break;case"delete-layout":a.Action="Delete",a.ActionType="Layout"}return console.log(JSON.stringify(a)),a}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Apps.CleverForms.DesignerElementEdit=class{_options(){this.Designer=null,this.SearchApi=null,this.Search=null,this.PopupNode=null,this.SearchNode=null,this.SettingsNode=null,this.OnUpdate=function(){},this.OnCancel=function(){},this.data=!1,this.DragNode=!1,this.defaultConfig={SearchApi:null,OnUpdate:function(){},OnCancel:function(){}}}constructor(e){if(this._options(),["_init","Set","JumpSearch","GotoSearch","JumpSettings","GotoSettings","Show","Hide","Cancel","SearchSelected","_resetSettings","_populateSettings","_resetSettings","_searchSelected","_togglePreview","_clearAndSearch","_update","_updateFromModeSwitch","_checkOkToContinue","_close"].bindEach(this),this._templates(),e&&Affinity2018.isObject(e)){var t,i=Affinity2018.objectDeepMerge(this.defaultConfig,e);for(t in i)this[t]=i[t];delete this.defaultConfig}this.CleverForms=Affinity2018.Apps.CleverForms.Default,this._init()}_init(){this.body=document.querySelector("body"),this.PopupNode=document.createElement("div"),this.PopupNode.classList.add("cf-designer-element-popup","popup"),this.PopupNode.innerHTML=this.Template,this.body.appendChild(this.PopupNode),this.CloseButtonNode=this.PopupNode.querySelector(".close"),this.SearchViewNode=this.PopupNode.querySelector(".search"),this.SettingsViewNode=this.PopupNode.querySelector(".settings"),this.SearchNode=this.SearchViewNode.querySelector(".search-box"),this.SettingsNode=this.SettingsViewNode.querySelector(".settings-box"),this.SettingsNode.innerHTML=this.SettingsTemplate.format({nameLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.name_lable"),helpLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.help_label"),createLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.create_label"),selectabel:$a.Lang.ReturnPath("app.cf.design_items.edit.select_label"),editLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.edit_label"),displayLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.display_label"),hiddenLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.hidden_label"),formuserLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.formuser_label"),hideLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.hide_label"),requiredLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.btons.required_label"),cancelLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.cancel_label"),searchLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.search_label"),okLabel:$a.Lang.ReturnPath("app.cf.design_items.edit.ok_label")}),this.PreviewNode=this.PopupNode.querySelector(".example-template"),this.PreviewToggleNode=this.PreviewNode.querySelector(".toggle-preview"),this.PreviewBoxNode=this.PreviewNode.querySelector(".preview"),this.HelptextNode=this.SettingsViewNode.querySelector(".helptext-row"),this.FiltersNode=this.SettingsViewNode.querySelector(".filters"),this.FilterRadiosBoxNode=this.FiltersNode.querySelector(".radios"),this.FilterSelectsBoxNode=this.FiltersNode.querySelector(".selects"),this.RequiredBoxNode=this.SettingsViewNode.querySelector(".edit-required"),this.HiddenBoxNode=this.PopupNode.querySelector(".edit-hidden"),this.FilterModeWrapperCreate=this.FilterRadiosBoxNode.querySelector(".mode-create-wrapper"),this.filterModeWrapperUpdate=this.FilterRadiosBoxNode.querySelector(".mode-update-wrapper"),this.FilterModeWrapperEdit=this.FilterRadiosBoxNode.querySelector(".mode-edit-wrapper"),this.FilterModeWrapperDisplay=this.FilterRadiosBoxNode.querySelector(".mode-display-wrapper"),this.FilterModeWrapperHidden=this.FilterRadiosBoxNode.querySelector(".mode-hidden-wrapper"),this.ListSourceSelectNode=!1,this.BackButtonNode=this.SettingsNode.querySelector(".button.back"),this.CancelButtonNode=this.SettingsNode.querySelector(".button.cancel"),this.OkButtonNode=this.SettingsNode.querySelector(".button.ok"),this.TemplateNode=this.SettingsNode.querySelector(".edit-template"),this.customList=!1,this.plugins=["Autocompletes","Calendars","Selects","SelectLookups","Strings","Numbers","BankNumber","TaxNumber","Address","DrawPanel","ListBuilder","FileUpload","Tooltips"],this.cfPlugins=[],this.plugins.forEach((function(e){!Affinity2018.Apps.Plugins.hasOwnProperty(e)&&Affinity2018.Classes.Plugins.hasOwnProperty(e)&&(Affinity2018.Apps.Plugins[e]=new Affinity2018.Classes.Plugins[e])})),this.cfPlugins.forEach((function(e){!Affinity2018.Apps.Plugins.hasOwnProperty(e)&&Affinity2018.Classes.Apps.CleverForms.hasOwnProperty(e)&&(Affinity2018.Apps.Plugins[e]=new AAffinity2018.Classes.Apps.CleverForms[e])})),this.Search=new Affinity2018.Classes.Plugins.BigSearch,this.Search.SetApi(this.SearchApi),this.Search.SetResultCallback(this._searchSelected),this.Search.SetParams({userInput:"Query",pageSize:"Size",pageNumber:"Page",grandTotal:"Total",type:"Type",results:"Results"}),this.Search.Insert(this.SearchNode,$a.Lang.ReturnPath("app.cf.design_items.search_message"),[],[]),this.CloseButtonNode.addEventListener("click",this._close),this.PreviewToggleNode.addEventListener("click",this._togglePreview),this.BackButtonNode.addEventListener("click",this._clearAndSearch),this.OkButtonNode.addEventListener("click",this._update),this.CancelButtonNode.addEventListener("click",this.Cancel)}Set(e,t){this.Config=e,this.DragNode=t||!1,this.SearchViewNode.querySelector("h3").innerHTML=e.Label,this.SearchViewNode.querySelector("p").innerHTML=e.Description,this.SettingsViewNode.querySelector("h3").innerHTML=e.Label,this.SettingsViewNode.querySelector("p").innerHTML=e.Description,this._populateSettings()}JumpSearch(){this.Search.Reset(),this.PopupNode.classList.remove("goto-settings","settings","goto-search","search"),this.PopupNode.classList.add("search"),this.PopupNode.classList.add("large"),this.PopupNode.classList.remove("medium"),this.Search.InputNode.focus()}GotoSearch(){this.Search.Reset(),this.PopupNode.classList.remove("goto-settings","settings","goto-search","search"),this.PopupNode.classList.add("goto-search"),this.PopupNode.classList.add("large"),this.PopupNode.classList.remove("medium"),this.Search.InputNode.focus()}JumpSettings(){this.PopupNode.classList.remove("goto-settings","settings","goto-search","search"),this.PopupNode.classList.add("settings"),this.PopupNode.focus()}GotoSettings(){this.PopupNode.classList.remove("goto-settings","settings","goto-search","search"),this.PopupNode.classList.add("goto-settings"),this.PopupNode.focus()}Show(){this.PopupNode.classList.add("show"),Affinity2018.lockBodyScroll()}Hide(){clearTimeout(this._resetOnHideTimer),this.DragNode&&this.DragNode.controller.UnsetDesignEditor(),this.AllFormGroupLookup&&this.AllFormGroupLookup.hasOwnProperty("cancelToken")&&this.AllFormGroupLookup.cancelToken.source.cancel(!0),this.GenericGroupLookup&&this.GenericGroupLookup.hasOwnProperty("cancelToken")&&this.GenericGroupLookup.cancelToken.source.cancel(!0),this.PopupNode.querySelector("select.ui-autocomplete")&&this.PopupNode.querySelectorAll("select.ui-autocomplete").forEach((function(e){e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("Autocomplete")&&e.widgets.Autocomplete.Destroy()})),this._resetOnHideTimer=setTimeout(this._resetSettings,260),this.PopupNode.classList.remove("show"),Affinity2018.unlockBodyScroll()}Cancel(){this._close()}SearchSelected(e,t){this._searchSelected(e,t)}_populateSettings(e){void 0===e?e=this.Config:this.Config=e,this._resetSettings(),this.DragNode&&this.DragNode.controller.SetDesignEditor(this),clearTimeout(this._enableOkButtonTimer),this._enableOkButtonTimer=setTimeout(function(){this.OkButtonNode.classList.remove("disabled")}.bind(this),1e3),setTimeout(function(){this.plugins.forEach((function(e){Affinity2018.Apps.Plugins.hasOwnProperty(e)&&Affinity2018.Apps.Plugins[e].Apply()}))}.bind(this),600)}_resetSettings(){clearTimeout(this._enableOkButtonTimer),clearTimeout(this._resetOnHideTimer),this.PreviewNode.classList.add("hidden"),this.PreviewBoxNode.classList.add("hide"),this.PreviewBoxNode.innerHTML="",this.HelptextNode.classList.remove("hidden"),this.SettingsNode.querySelector(".edit-template").classList.add("hidden"),this.SettingsNode.querySelector(".edit-template").innerHTML="",this.FiltersNode.classList.remove("hidden"),this.FilterRadiosBoxNode.classList.add("hidden"),this.FilterSelectsBoxNode.classList.remove("hidden"),this.FilterModeWrapperCreate.classList.add("hidden"),this.FilterModeWrapperCreate.querySelector("input").checked=!1,this.filterModeWrapperUpdate.classList.add("hidden"),this.filterModeWrapperUpdate.querySelector("input").checked=!1,this.FilterModeWrapperEdit.classList.remove("hidden"),this.FilterModeWrapperEdit.querySelector("input").checked=!0,this.FilterModeWrapperDisplay.classList.remove("hidden"),this.FilterModeWrapperDisplay.querySelector("input").checked=!1,this.FilterModeWrapperHidden.classList.remove("hidden"),this.FilterModeWrapperHidden.querySelector("input").checked=!1,this.RequiredBoxNode.classList.remove("hidden"),this.RequiredBoxNode.querySelector("input").checked=!1,this.RequiredBoxNode.querySelector("input").disabled=!1,this.HiddenBoxNode.classList.add("hidden"),this.HiddenBoxNode.querySelector("input").checked=!1,this.BackButtonNode.classList.add("hidden"),this.OkButtonNode.classList.add("disabled"),this.PopupNode.classList.remove("has-list"),this.PopupNode.classList.remove("medium"),this.PopupNode.classList.remove("large"),this.ListSourceSelectNode&&(this.ListSourceSelectNode.removeEventListener("change",this._listSourceChanged),this.ListSourceSelectNode=!1),this.SearchViewNode.querySelector("h3").innerHTML=this.CleverForms.ElementData.AffinityField.Label,this.SearchViewNode.querySelector("p").innerHTML=this.CleverForms.ElementData.AffinityField.Description,this.Search.Reset()}_searchSelected(e,t){if(t=$a.paramOrDefault(t,!1),e.hasOwnProperty("data")){var i=this.CleverForms.__PORT_G_G_G_GET_AFFINITYFIELD_DATA({Details:{AffinityField:e.data}},$a.jsonCloneObject(this.CleverForms.ElementData.AffinityField)),s=i.Details.AffinityField,o=s.FieldName,a=s.ModelName,n='li[data-field="{field}"][data-model="{model}"]'.format({field:o,model:a}),r=this.DragNode?this.DragNode:this.CleverForms.Designer.RightListNode.querySelector(n),l=r?this.CleverForms.Designer.GetElementSectionFilterMode(r):null;if(r)return null!==l&&(i.Details.AffinityField.Mode=l),i.Label=s.DisplayLabel,i.Details.Label=s.DisplayLabel,i.Display=this.CleverForms.ElementData[s.CleverFormsDisplayType],i=this.CleverForms.SelectDefaultModeOnFieldSearch(i),r.hasOwnProperty("controller")&&(r.controller.Config=i),void(this.CleverForms.Designer.CanAllowAffinityField(r,!t,!0)&&(this._populateSettings(i),this.GotoSettings()));Affinity2018.Dialog.Show({message:"It looks like we can't use this Affinity Field.<br />Please try another or contact Affinity for help.",showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",color:"green",text:"Search Again"}},onOk:function(){this.JumpSearch()}.bind(this)})}}_togglePreview(){this.PreviewBoxNode.classList.contains("hide")?(this.PreviewBoxNode.classList.remove("hide"),this.PreviewToggleNode.innerHTML="Hide Example"):(this.PreviewBoxNode.classList.add("hide"),this.PreviewToggleNode.innerHTML="Show Example")}_clearAndSearch(){this._resetSettings(),this.GotoSearch()}_update(){this.DragNode&&this.DragNode.controller.BackupConfig()&&this.DragNode.controller.GetFromDesignEditor(!1)&&(this._checkOkToContinue(!1)?(this.DragNode.controller.Saved&&this.DragNode.controller.Changed&&this.Designer.CheckSave(),this.Config=this.DragNode.controller.Config,"AffinityField"===this.DragNode.controller.Config.Type&&(!this.DragNode.controller.Config.Details.AffinityField.ModelName&&this.DragNode.controller.Config.Details.AffinityField.TableName&&(this.DragNode.controller.Config.Details.AffinityField.ModelName=this.DragNode.controller.Config.Details.AffinityField.TableName),this.DragNode.dataset.model=this.Config.Details.AffinityField.ModelName,this.DragNode.dataset.field=this.Config.Details.AffinityField.FieldName,this.DragNode.dataset.mode=this.Config.Details.AffinityField.Mode),this.OnUpdate(this.Config,this.DragNode),this.Hide()):this.DragNode.controller.RestoreBackup())}_updateFromModeSwitch(){this.DragNode&&(this.DragNode.controller.removeEventListener("ModesSwitched",this._updateFromModeSwitch),this.Config=this.DragNode.controller.Config,this.OnUpdate(this.Config,this.DragNode))}_checkOkToContinue(e){if(!(e=$a.paramOrDefault(e,!1))&&"AffinityField"===this.Config.Type&&this.DragNode&&!this.CleverForms.Designer.CanAllowAffinityField(this.DragNode,!0,!1))return!1;var t,i=this.TemplateNode.querySelector('input[type="file"]')||!1;return!($a.isNode(i)&&(t=!(!i.hasOwnProperty("widgets")||!i.widgets.hasOwnProperty("FileUpload"))&&i.widgets.FileUpload)&&!(e?t.HasSavedFiles():t.HasFiles())&&this.Config.Details.Required&&(Affinity2018.Dialog.Show({message:"You must select a file to attach.",showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"}),1))}_close(){this._checkOkToContinue(!0)&&(this.OnCancel(this.Config,this.DragNode),this.Hide())}_templates(){this.Template='\n    <div class="inner">\n      <div class="search">\n        <h3>Name</h3>\n        <p>Description</p>\n        <hr />\n        <div class="search-box"></div>\n      </div>\n      <div class="settings">\n        <h3>Name</h3>\n        <p>Description</p>\n        <div class="example-template hidden">\n          <a class="toggle-preview" href="javascript:void(0);">Show Example</a>\n          <div class="preview hide"></div>\n        </div>\n        <hr />\n        <div class="settings-box"></div>\n      </div>\n      <div class="close icon-cross"></div>\n    </div>\n    ',this.SettingsTemplate='\n    <div class="form">\n      <div class="form-row label-row">\n        <label>{nameLabel}</label>\n        <input type="text" class="label" name="ShortText" />\n      </div>\n      <div class="form-row helptext-row">\n        <label>{helpLabel}</label>\n        <input type="text" class="helptext" name="HelpText" />\n      </div>\n      <div class="filters">\n        <div class="radios hidden">\n          <span class="mode-wrapper mode-create-wrapper hidden"><input data-mode="0" id="-mode-create" type="radio" class="mode-create" name="mode" value="0" /><label for="-mode-create">{createLabel}</label></span>\n          <span class="mode-wrapper mode-update-wrapper hidden"><input data-mode="4" id="-mode-update" type="radio" class="mode-update" name="mode" value="4" /><label for="-mode-update">{selectabel}</label></span>\n          <span class="mode-wrapper mode-edit-wrapper"><input data-mode="1" id="-mode-edit" type="radio" class="mode-edit" name="mode" value="1" checked /><label for="-mode-edit">{editLabel}</label></span>\n          <span class="mode-wrapper mode-display-wrapper"><input data-mode="2" id="-mode-display" type="radio" class="mode-display" name="mode" value="2" /><label for="-mode-display">{displayLabel}</label></span>\n          <span class="mode-wrapper mode-hidden-wrapper"><input data-mode="3" id="-mode-hidden" type="radio" class="mode-hidden" name="mode" value="3" /><label for="-mode-hidden">{hiddenLabel}</label></span>\n          <span class="mode-wrapper mode-initiator-wrapper"><input data-mode="5" id="-mode-initiator" type="radio" class="mode-initiator" name="mode" value="5" /><label for="-mode-initiator">{formuserLabel}</label></span>\n        </div>\n        <div class="selects hidden">\n        </div>\n      </div>\n    </div>\n    <div class="edit-hidden form hidden">\n      <div class="check-row">\n        <input type="checkbox" class="" id="-hidden" /><label for="-hidden">{hideLabel}</label>\n      </div>\n    </div>\n    <div class="edit-template form hidden"></div>\n    <div class="edit-required form hidden">\n      <div class="check-row">\n        <input type="checkbox" class="required" id="-required" /><label for="-required">{requiredLabel}</label>\n      </div>\n    </div>\n    <div class="buttons">\n      <div class="button grey cancel"><span class="icon-cross"></span>{cancelLabel}</div>\n      <div class="button blue back hidden"><span class="icon-back"></span>{searchLabel}</div>\n      <div class="button green ok disabled"><span class="icon-tick"></span>{okLabel}</div>\n    </div>\n    ',this.SelectFilterTemplate='\n    <div class="edit-row top">\n      <label>Source</label>\n      <div class="select">\n        <select class=""></select>\n      </div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Apps.CleverForms.Designer=class{_options(){this.EnablePost=!0,this.EnableLeftAutoScroll=!0,this.UseFormDataPost=!1,this.RankOrder=1,this.PostLocked=!1,this.DragScrollEdge=100,this.DragScrollMaxStep=30,this.Editor=null,this.Dragger=null,this.TopNode=null,this.LeftListNode=null,this.RightListNode=null,this.MaximiseRightHeight=!1,this.AllowMultipleDisplayFields=!1,this.OpenPreviewInNewWindow=!1,this.LastModifiedTime=Date.now(),this.LastPostTime=Date.now()}constructor(e){this._options(),["_init","Add","LockAffinityNonMasterFileSection","GetElementSectionNode","GetElementSectionFilterMode","GetElementSectionNodelName","CanAllowAffinityField","Save","_ready","_insertFormElements","_insertElement","_clearForm","_loadTemplate","_loadTemplateError","_processTemplate","_insertFormElement","_updateFormElement","_updateDroppedElement","_attemptSetElementAsKey","_setSectionModelNameLabels","_injectDefaultSection","_editElement","_editUpdated","_editCanceled","_editElementClicked","_removeElementClicked","_clearRemove","_removeElement","_setElementForDelete","_disableAllDeleteButtons","_enableAllDeleteButtons","_updateFormDetails","_setupLeftListPositionOnScroll","_loadPreview","_setupDrag","_canCopy","_canDrop","_dragStart","_dragMove","_checkDragScroll","_adjustDragScroll","_dragEnd","_dropped","_checkSave","_checkSaveThrottled","_post","_postThen","_postCatch","_setPosted","_postComplete","_postFailed","_download","_upload","_uploadAfterDelete","_saveAfterUpload","_templates"].bindEach(this),this._templates(),this.CleverForms=Affinity2018.Apps.CleverForms.Default,this.CleverForms.Designer=this,Affinity2018.hasOwnProperty("RequestQueue")||(Affinity2018.RequestQueue=new Affinity2018.Classes.Plugins.RequestQueue),this.Uploading=!1,Affinity2018.UiReady?this._init():window.addEventListener("MainInit",this._init)}_init(){this.Editor=new Affinity2018.Classes.Apps.CleverForms.DesignerElementEdit({Designer:this,SearchApi:this.CleverForms.FielddSearchApi,OnUpdate:this._editUpdated,OnCancel:this._editCanceled}),this.TopNode=document.querySelector(".cf-d2-top"),this.LeftListNode=document.querySelector(".cf-d2-bottom-left ul"),this.RightListNode=document.querySelector(".cf-d2-bottom-right ul"),this.DesignerSavingNode=document.querySelector("#loading-toast"),this.TopNode.querySelector("input.form-name").addEventListener("blur",this._updateFormDetails),this.TopNode.querySelector("input.form-instructions").addEventListener("blur",this._updateFormDetails),this.TopNode.querySelector("input.form-revision").addEventListener("blur",this._updateFormDetails),Affinity2018.Numbers||(Affinity2018.Numbers=new Affinity2018.Classes.Plugins.Numbers),Affinity2018.Numbers.Apply(),this.TopNode.querySelector(".button.preview").addEventListener("click",this._loadPreview),this.TopNode.querySelector(".button.download")&&this.TopNode.querySelector(".button.upload")&&this.TopNode.querySelector("input.upload-file")&&(this.TopNode.querySelector(".button.download").addEventListener("click",this._download),this.TopNode.querySelector(".button.upload").addEventListener("click",(function(){document.querySelector(".cf-d2-top input.upload-file").click()})),this.TopNode.querySelector("input.upload-file").addEventListener("change",this._upload)),Affinity2018.ShowPageLoader(),this._insertFormElements(),""!==this.TopNode.querySelector("input.form-name").value.trim()&&(document.title="Design "+this.TopNode.querySelector("input.form-name").value.trim())}_ready(){Affinity2018.Tooltips.Apply(),this._setupLeftListPositionOnScroll()}Add(e,t,i,s,o){if(this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]')){var a=this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]'),n=a.cloneNode();if(n.innerHTML=a.innerHTML,n=this._updateDroppedElement(n,e,t),this.CleverForms.PseudoGlobalElementTypes.contains(e.Type)&&this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]')&&this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]').classList.add("disabled"),n.hasOwnProperty("controller")){if("after"===s){if(!o)return Affinity2018.ThrowError("Design Error","Blocker",'Can not Add "'+e.Type+'" element after NULL. A "referenceNode" must be passed in and be a vlaid DOM element.'),!1;i.insertBefore(n,o.nextSibling)}else i.insertBefore(n,i.querySelector("li"));return"section"===e.Type.toLowerCase()&&this.Dragger.containers.push(n.querySelector("ul")),this.LockAffinityNonMasterFileSection(n),"section"===e.Type.toLowerCase()&&this._setSectionModelNameLabels(),"section"!==e.Type.toLowerCase()&&this._setElementModeLabel(n),"AffinityField"===e.Type&&"LINK_ID"===e.Details.AffinityField.FieldName&&n.classList.add("hidden"),n}}return!1}LockAffinityNonMasterFileSection(e){if(e){var t=this.GetElementSectionNode(e),i=!!t&&t.querySelectorAll('li[data-type="AffinityField"]'),s=0;if(t&&(t.classList.remove("locked"),i&&i.length>0))for(;s<i.length;s++)if(this.CleverForms.MasterfileTableBlacklist.contains(i[s].dataset.model))return void t.classList.add("locked")}}GetElementSectionNode(e,t){t=$a.paramOrDefault(t,!1,"bool");var i=!!$a.isNode(e)&&e.classList.contains("cf-designer-element"),s=!0;return t&&(s=!!isNode&&this.RightListNode.querySelector(".cf-designer-element.item-"+e.dataset.name)),!!(i&&s&&e.closest('li[data-type="Section"]'))&&e.closest('li[data-type="Section"]')}GetElementSectionFilterMode(e){var t=this.GetElementSectionNode(e);if(t){var i=t.querySelectorAll('li[data-type="AffinityField"].is-key-field');if(i.length>0)return i[0].controller.Config.Details.AffinityField.Mode;var s=t.querySelectorAll('li[data-type="AffinityField"]');if(s.length>0)return s[0].controller.Config.Details.AffinityField.Mode}return!1}GetElementSectionNodelName(e){if(e){var t,i=this.GetElementSectionNode(e),s=e.controller.GetModeName();if(i){if((t=i.querySelectorAll('li[data-type="AffinityField"][data-model="'+s+'"].is-key-field:not(.is-global-key)')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName;if((t=i.querySelectorAll('li[data-type="AffinityField"][data-model="'+s+'"].is-key-field')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName;if((t=i.querySelectorAll('li[data-type="AffinityField"][data-model="'+s+'"]')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName;if((t=i.querySelectorAll('li[data-type="AffinityField"].is-key-field:not(.is-global-key)')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName;if((t=i.querySelectorAll('li[data-type="AffinityField"].is-key-field')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName;if((t=i.querySelectorAll('li[data-type="AffinityField"]')).length>0)return t[0].controller.Config.Details.AffinityField.ModelName}}return!1}CanAllowAffinityField(e,t,i,s,o,a){if($a.isNode(e)){t=$a.paramOrDefault(t,!0),i=$a.paramOrDefault(i,!1),s=$a.paramOrDefault(s,!1);var n,r,l,d,h,c,u,p,f,m,y,g,v,A,w,N,b=e.hasOwnProperty("controller")?e.controller.Config:null,S=null!=b&&"AffinityField"===b.Type?b.Details.AffinityField:null;if(null!=b&&"AffinityField"===b.Type&&b.Details.Label,null!=S&&(n=this.CleverForms.Designer.GetElementSectionNode(e),r=!!s&&this.GetElementSectionNodelName(o.querySelector('li[data-type="AffinityField"]')),null!==n)){if(this.GetElementSectionFilterMode(e),l=this.GetElementSectionNodelName(e),d=S.ModelName,h=S.Mode,c=$a.isNumeric(h)?this.CleverForms.AffnityFieldModeEnums[h].Label:null,p=null!==(u=S.FieldName)?u.toLowerCase():null,f=b.Details.Label,g=null!==(y=null!==(m=null===(m=this.RightListNode.querySelector('li[data-model="{0}"].is-global-key'.format(h)))?this.RightListNode.querySelector('li[data-model="{0}"].is-key-field'.format(d)):null)?m.controller.Config.Details.AffinityField.Mode:null)?this.CleverForms.AffnityFieldModeEnums[y].Label:null,v=null!==m?m.controller.Config.Details.Label:null,A=!e.controller.Saved,w="",!s){if(!i&&S.IsMasterfileData){if(null!==y&&h!==y&&0===y&&4!==h)return t&&(w=$a.Lang.ReturnPath("app.cf.designer.error_mix_modes",{fieldLabel:v,mode:g}),Affinity2018.Dialog.Show({message:w,showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}})),!1;if(null!==y&&0===h&&0!==y)return t&&(w=$a.Lang.ReturnPath("app.cf.designer.error_section_not_create",{fieldLabel:v,mode:g}),Affinity2018.Dialog.Show({message:w,showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}})),!1}if(A&&S.IsKeyField){var D=!1;if(this.CleverForms.AllowedGlobalKeys.contains(u)?(N='li.is-key-field[data-field="{field}"]'.format({field:u}),this.RightListNode.querySelector(N)&&this.RightListNode.querySelector(N)!==e&&(D=!0,w=$a.Lang.ReturnPath("app.cf.designer.error_duplicate_global_key",{fieldLabel:f}))):S.IsMasterfileData?(N='li.is-key-field[data-field="{field}"][data-model="{model}"]'.format({field:u,model:d}),this.RightListNode.querySelector(N)&&(D=!0,w=$a.Lang.ReturnPath("app.cf.designer.error_duplicate_key_form"))):(N='li.is-key-field[data-field="{field}"]'.format({field:u}),n&&n.querySelector(N)&&(D=!0,w=$a.Lang.ReturnPath("app.cf.designer.error_duplicate_key_section"))),D)return t&&Affinity2018.Dialog.Show({message:w,showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:!1}}),!1}if(!i&&S.IsMasterfileData&&null!==u&&null!==h&&null!==c){if(this.AllowMultipleDisplayFields&&h===this.CleverForms.AffnityFieldModeTypes.Display.Enum)return!0;if(N='li[data-field="{field}"][data-model="{model}"][data-mode="{mode}"]'.format({field:u,model:d,mode:h}),this.RightListNode.querySelector(N)&&this.RightListNode.querySelector(N)!==e){if(t){var C=this.RightListNode.querySelector(N),_=C.controller.Config.Details.AffinityField.Mode,L=this.CleverForms.AffnityFieldModeEnums[_].Label;w=$a.Lang.ReturnPath("app.cf.designer.error_one_masterfile",{label:C.controller.Config.Details.Label,mode:L}),Affinity2018.Dialog.Show({message:w,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}})}return!1}}}if(i){if(A&&l&&l!==d&&!this.CleverForms.AllowedGlobalKeys.contains(u))return w=$a.Lang.ReturnPath("app.cf.designer.error_duplicate_field",{model:l}),Affinity2018.Dialog.Show({message:w,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}}),!1;if(A&&this.CleverForms.PseudoGlobalElementTypes.contains(u)&&n.querySelector('li[data-name="'+u+'"]'))return Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.designer.error_one_pseudo_key_per_section",{label:b.Label}),showOk:!0,showCancel:!1,showInput:!1,buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}}),!1;if(A&&S.IsKeyField&&this.CleverForms.AllowedGlobalKeys.contains(u)&&this.RightListNode.querySelector(".is-global-key"))return Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.designer.error_one_pseudo_key_per_form",{label:b.Label}),showOk:!0,showCancel:!1,showInput:!1,buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{shoe:!1}}}),!1;if(t&&p.contains("address")&&!p.startsWith("complete")&&!p.endsWith("complete")){var E=this.Editor.Search.InputNode.value.trim();return console.log(b),Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.design_items.edit.address_suggestion"),showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",color:"green",text:$a.Lang.ReturnPath("app.cf.design_items.edit.address_button_use_single",{fieldName:b.Details.AffinityField.DisplayLabel})},cancel:{show:!0,icon:"search",color:"blue",text:$a.Lang.ReturnPath("app.cf.design_items.edit.address_button_use_auto")}},onOk:function(){this.Editor.SearchSelected({data:b.Details.AffinityField},!0)}.bind(this),onCancel:function(){this.Editor.JumpSearch(),this.Editor.Search.Search("Complete "+E)}.bind(this)}),!1}}if(s&&o&&a){if(this.CleverForms.AllowedGlobalKeys.contains(u))return this.DragEndMessage=!1,this.DragEndCallback=!1,!0;if(!e.classList.contains("is-global-key")&&o!==a&&a!==this.LeftListNode&&"Section"===o.parentNode.dataset.type&&"Section"===a.parentNode.dataset.type&&(o.closest('li[data-type="Section"]').classList.contains("locked")||a.closest('li[data-type="Section"]').classList.contains("locked")))return this.DragEndMessage=$a.Lang.ReturnPath("app.cf.designer.error_bad_drag_operation"),this.DragEndCallback=!1,!1;if(!e.controller.Saved&&(N='li.is-key-field[data-field="{field}"][data-model="{model}"]'.format({field:u,model:d}),n&&b.Details.AffinityField.IsKeyField&&this.RightListNode.querySelector(fieldQuery)))return this.DragEndMessage=$a.Lang.ReturnPath("app.cf.designer.error_bad_drag_operation_unique",{label:this.RightListNode.querySelector(fieldQuery).controller.Details.Label}),this.DragEndCallback=!1,!1;if(!this.CleverForms.IsMasterFile(b)&&o!==a&&!this.CleverForms.AllowedGlobalKeys.contains(u))return o.classList.contains("items-only")&&(this.DragEndMessage=$a.Lang.ReturnPath("app.cf.designer.error_bad_drag_operation_non_masterfile")),this.DragEndCallback=!1,!1;if(!1!==r&&r!==d)return this.DragEndMessage=$a.Lang.ReturnPath("app.cf.designer.error_bad_drag_operation_mix_tables",{sectionModel:l,newFieldLabel:b.Details.Label,newFieldModel:d}),this.DragEndCallback=!1,!1;if(this.CleverForms.PseudoGlobalElementTypes.contains(this.CleverForms.ElementData[e.dataset.type].Type)&&this.RightListNode.querySelector(".is-pseudo-global-key:not(.gu-transit)"))return this.DragEndMessage=$a.Lang.ReturnPath("app.cf.designer.error_bad_drag_operation_one_pseudo",{label:this.CleverForms.ElementData[e.dataset.type].Label}),this.DragEndCallback=this.Editor.Cancel,!1}}}return!0}CheckSave(){this._checkSave()}Save(e){var t;e&&$a.isArray(e)?(this.PostData=[],e.length>0&&console.groupCollapsed("%c🖪 SAVING ...","color:#ff5c00"),e.forEach(function(i){if(t=$a.jsonCloneObject(i.controller.Config),console.log('%c  Saving "'+t.Details.Label+'"',"color:#ff5c00"),console.log("%c      node ","color:#ff5c00",i),console.log("%c    config ","color:#ff5c00",t),(!(t=this.CleverForms.__THIS_IS_A_TEMP_TRANSMUTER_FOR_P_P_P_POST_DATA_UNTIL_POST_DATA_MATCHES_NEW_STRUCTURE(t)).hasOwnProperty("Rank")||t.hasOwnProperty("Rank")&&isNaN(parseInt(t.Rank)))&&(t.Rank=this._returnRank(i)),this.PostData.push($a.jsonCloneObject(t)),"Section"===t.Type){var s=this.RightListNode.querySelector("li.item-"+i.UniqueName);s&&s.querySelectorAll("ul li.is-key-field").forEach((function(t){t&&t.controller&&t.controller.Config&&(e.contains(t)||(console.log("%c      this was missing from post data","color:#ff5c00",t),this.PostData.push($a.jsonCloneObject(this.CleverForms__THIS_IS_A_TEMP_TRANSMUTER_FOR_P_P_P_POST_DATA_UNTIL_POST_DATA_MATCHES_NEW_STRUCTURE(t.controller.Config)))))}))}}.bind(this)),e.length>0&&console.groupEnd(),this.PostData.length>0&&this._post()):this._checkSave()}_insertFormElements(){var e,t;this.breakAdded=!1;var i=[];for(e in this.CleverForms.ElementData){var s;this.CleverForms.ElementData.hasOwnProperty(e)&&((s=$a.jsonCloneObject(this.CleverForms.ElementData[e])).Cloned||(s.Key=e,s.hasOwnProperty("Type")&&this.CleverForms.PseudoGlobalElementTypes.contains(s.Type)&&(s.Icon.Color="green",this.CleverForms.ElementData[s.Key].Icon.Color="green"),i.contains(s)||i.push(s)))}for(i.sort(this._sortByElementRank),t=0;t<i.length;t++)s=i[t],this._insertElement(this.CleverForms.ElementData[s.Key]);this._setupDrag(),this._loadTemplate(),this.MaximiseRightHeight&&(this.RightListNode.style.minHeight=this.LeftListNode.getBoundingClientRect().height-50+"px"),this._ready()}_insertElement(e){if(this.LeftListNode){var t;if(this.breakAdded||"blue"!==e.Icon.Color.trim().toLowerCase()||(t=document.createElement("hr"),this.LeftListNode.appendChild(t),this.breakAdded=!0),t=document.createElement("li"),"section"===e.Type.trim().toLowerCase()){var i=$a.Lang.ReturnPath("application.cleverfroms.designer.section_required_fields_message"),s="";""===i.trim()&&(s=" none"),t.innerHTML=this.sectionTemplate.format({edit:$a.Lang.ReturnPath("application.cleverfroms.designer.element_edit_button"),message:i,messageClass:s})}else t.innerHTML=this.elementTemplate.format({edit:$a.Lang.ReturnPath("application.cleverfroms.designer.element_edit_button")});return t.dataset.type=e.Type,"green"===e.Icon.Color.trim().toLowerCase()&&this.breakAdded?this.LeftListNode.insertBefore(t,this.LeftListNode.querySelector("hr")):this.LeftListNode.appendChild(t),this.CleverForms.PseudoGlobalElementTypes.contains(e.Type)&&t.classList.add("pseudo-global-key"),t.querySelector(".main-icon").classList.add(e.Icon.Color,"icon-cf-"+e.Icon.Name.replace("icon-","").replace("cf-","")),t.querySelector(".label").innerHTML=e.Label,t.classList.add("cf-designer-element","ui-has-tooltip"),t.dataset.tooltip=e.Tooltip,t.dataset.tooltipDir="right",e.Details.Divide&&t.classList.add("divide"),!0}return!1}_clearForm(){var e=this.RightListNode.querySelectorAll('li[data-type="Section"]'),t=0,i=!1;if(e.length>0)for(;t<e.length;t++)i=e[t].controller.RemoveDesignerElement(this._removeElement);else i=!0;return!!i&&(this.RightListNode.innerHTML="",!0)}_loadTemplate(){this.TemplateData=!1,$a.ShowPageLoader();var e=function(){window.removeEventListener("DesignerGotTemplate",e),this.TemplateData&&(this._processTemplate(),e=null)}.bind(this);window.addEventListener("DesignerGotTemplate",e);var t,i=this.CleverForms.GetTemplateGuid();return i&&(t=this.CleverForms.GetTemplateApi+"?templateId="+i,$a.ShowPageLoader(),axios({method:"get",url:t}).then(function(e){if(e&&$a.isObject(e.data)){var t=!1;e.data.hasOwnProperty("sectionWorkflowVisibilitySettings")&&(this.CleverForms.SectionWorkflowVisibilitySettings=e.data.sectionWorkflowVisibilitySettings),e.data.hasOwnProperty("SectionWorkflowVisibilitySettings")&&(this.CleverForms.SectionWorkflowVisibilitySettings=e.data.SectionWorkflowVisibilitySettings),e.data.hasOwnProperty("elementTemplateMerged")&&$a.isArray(e.data.elementTemplateMerged)&&(this.TemplateData=e.data.elementTemplateMerged,window.dispatchEvent(new Event("DesignerGotTemplate")),t=!0),e.data.hasOwnProperty("Data")&&$a.isArray(e.data.Data)&&(this.TemplateData=e.data.Data,window.dispatchEvent(new Event("DesignerGotTemplate")),t=!0),t||this._loadTemplateError($a.Lang.ReturnPath("application.cleverfroms.designer.error_template_not_recognised"))}else this._loadTemplateError($a.Lang.ReturnPath("application.cleverfroms.designer.error_template_not_recognised"))}.bind(this)).catch(function(){this._loadTemplateError($a.Lang.ReturnPath("application.cleverfroms.designer.error_template_fail"))}.bind(this))),!0}_loadTemplateError(e){clearInterval(this._tempLoadCheckTimer),delete this._tempLoadCheckTimer,$a.HidePageLoader(),$a.LogError("Design Error","Critical",e+"\n"+this.CleverForms.GetTemplateApi+"?templateId="+this.CleverForms.GetTemplateGuid()),$a.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.error_template"),showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"})}_processTemplate(){$a.ShowPageLoader();var e=!1,t=[];if($a.isArray(this.TemplateData)&&0===this.TemplateData.length&&(e=!0),this._clearForm()){if(e)this._injectDefaultSection();else{var i,s,o,a;if(1===this.TemplateData.length){var n=this.TemplateData[0];console.info(n),n.hasOwnProperty("Elements")&&$a.isArray(n.Elements)&&0===n.Elements.length&&"Default"===n.Details.Title&&(this.TemplateData[0].Details.Title=$a.Lang.ReturnPath("application.cleverfroms.designer.default_form_section_name"))}this.TemplateData.sort(this._sortByRank),this.TemplateData.forEach(function(e,n){e=this.CleverForms.BackfillConfig(e),"Section"===(e=this.CleverForms.__THIS_IS_A_TEMP_TRANSMUTER_FOR_G_G_G_GET_DATA_UNTIL_GET_DATA_MATCHES_NEW_STRUCTURE(e,this.TemplateData)).Type&&(this._sectionRequiresworkflowSettings(e)&&(e.Details.SectionWorkflowVisibilitySettings=$a.jsonCloneObject(this.CleverForms.SectionWorkflowVisibilitySettings)),i=this.Add(e,!1,this.RightListNode,"top"),this.Uploading?i.controller.Saved=!1:(i.controller.Saved=!0,i.controller.Changed=!1,i.controller.Changes=[],i.controller.ConfigStringCheck=JSON.stringify(i.controller.Config)),s=!0,i&&e.hasOwnProperty("Elements")&&$a.isArray(e.Elements)&&e.Elements.length>0&&(e.Elements.sort(this._sortByRank),e.Elements=e.Elements.reverse(),e.Elements.forEach(function(e,n){e=this.CleverForms.BackfillConfig(e),"Section"!==(e=this.CleverForms.__THIS_IS_A_TEMP_TRANSMUTER_FOR_G_G_G_GET_DATA_UNTIL_GET_DATA_MATCHES_NEW_STRUCTURE(e,this.TemplateData)).Type&&($a.isPropObject(e.Details,"ItemSource")&&$a.isPropArray(e.Details.ItemSource,"Items")&&(e.hasOwnProperty("Display")||(e.Display={}),e.Display.LastCustomList=e.Details.ItemSource.Items),"AffinityField"===e.Type&&$a.isObject(e.Details.AffinityField)&&((this.CleverForms.IsGlobalKey(e)||this.CleverForms.IsKey(e))&&e.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(console.log(e),t.push({Name:e.Details.Label,From:this.CleverForms.AffnityFieldModeEnums[e.Details.AffinityField.Mode].Label,To:this.CleverForms.AffnityFieldModeTypes.Select.Label}),e.Details.AffinityField.Mode=this.CleverForms.AffnityFieldModeTypes.Select.Enum),e.Display=$a.jsonCloneObject(this.CleverForms.ElementData[e.Details.AffinityField.CleverFormsDisplayType]),e.Details.AffinityField.IsKeyField&&(e.Icon.Code=$a.icons.cfAffinityField,e.Icon.Name="cf-affinity-field",e.Icon.Color="green",this.CleverForms.AllowedGlobalKeys.contains(e.Details.AffinityField.FieldName)&&(e.Icon.Code=$a.icons.cfAffinityKey,e.Icon.Name="cf-affinity-key",e.Icon.Color="green"))),s?(o=this.Add(e,!1,i.querySelector("ul"),"top"),s=!1):s||(a=i.querySelectorAll("li"),(o=a.length>0&&a[a.length-1])?o=this.Add(e,!1,i.querySelector("ul"),"after",o):o=this.Add(e,!1,i.querySelector("ul"),"top")),o&&"Section"!==o.dataset.type&&(this.Uploading?o.controller.Saved=!1:(o.controller.Saved=!0,o.controller.Changed=!1,o.controller.Changes=[],o.controller.ConfigStringCheck=JSON.stringify(o.controller.Config))))}.bind(this))))}.bind(this))}if(t.length>0){var r;if(1===t.length)r=$a.Lang.ReturnPath("application.cleverfroms.designer.mode_conversion_message_not_allowed",{name:t[0].Name,mode:t[0].To});else{for(var l="",d=0;d<t.length;d++)l+="'"+t[d].Name+"' changed to '"+t[d].To+"'<br>";r=$a.Lang.ReturnPath("application.cleverfroms.designer.mode_conversion_message",{keylist:l})}Affinity2018.Dialog.Show({message:r,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"})}return this.Uploading||setTimeout($a.HidePageLoader,250),!0}return setTimeout($a.HidePageLoader,250),!1}_sectionRequiresworkflowSettings(e){if(!$a.isPropObject(e,"Details"))return!1;if(!$a.isPropArray(e.Details,"SectionWorkflowVisibilitySettings"))return!0;if(0===e.Details.SectionWorkflowVisibilitySettings.length)return!0;for(var t,i,s=0;s<e.Details.SectionWorkflowVisibilitySettings.length;s++){if(null!==(t=e.Details.SectionWorkflowVisibilitySettings[s]).WorkflowDefinitionId)return!1;if(null!==t.WorkflowDefinitionName)return!1;for(i=0;i<t.WorkflowStateSettings.length;i++)if(null!==t.WorkflowStateSettings[i].WorkflowStateName)return!1}return!0}_injectDefaultSection(){var e=$a.jsonCloneObject(this.CleverForms.ElementData.Section);e.Details.Label=$a.Lang.ReturnPath("application.cleverfroms.designer.default_form_section_name"),e.Details.Title=$a.Lang.ReturnPath("application.cleverfroms.designer.default_form_section_name"),console.info("Lang Check:"),console.info("Method: '_injectDefaultSection'"),console.info("Set confgi label to value of lang path 'app.cf.designer.default_form_section_name'."),console.info($a.Lang.ReturnPath("application.cleverfroms.designer.default_form_section_name")),console.info(e),console.info(""),this.Add(e,!1,this.RightListNode,"top")}_setSectionModelNameLabels(){this.RightListNode.querySelectorAll('li[data-type="Section"]').forEach(function(e){var t=null,i="",s=e?e.querySelector("p.section-message em"):null;null!=s&&(e.querySelector('li[data-type="AffinityField"]')&&(e.querySelector('li[data-type="AffinityField"]:not(.is-key-field)')?t=e.querySelector('li[data-type="AffinityField"]:not(.is-key-field)'):e.querySelector('li[data-type="AffinityField"].is-key-field:not(.is-global-key)')?t=e.querySelector('li[data-type="AffinityField"].is-key-field:not(.is-global-key)'):e.querySelector('li[data-type="AffinityField"].is-global-key')&&(t=e.querySelector('li[data-type="AffinityField"].is-global-key')),t&&t.hasOwnProperty("controller")&&(i="<br />"+$a.Lang.ReturnPath("application.cleverfroms.designer.section_mode_message",{model:t.controller.Config.Details.AffinityField.ModelName}))),s.innerHTML=i)}.bind(this))}_setElementModeLabel(e){if(e&&$a.isNode(e)&&e.controller&&"AffinityField"===e.controller.Config.Type)if(e.controller.Config.Details.AffinityField.IsKeyField)e.querySelector(".label").innerHTML=e.controller.Config.Details.Label+" <em>("+e.controller.GetModeName()+")</em>";else{var t=e.controller.Config.Details.AffinityField.FieldName,i=e.controller.Config.Details.AffinityField.ModelName,s=e.controller.Name,o=this.RightListNode.querySelectorAll('li[data-field="{0}"][data-model="{1}"]'.format(t,i,s));o.length>0&&o.forEach((function(e){e.querySelector(".label").innerHTML=e.controller.Config.Details.Label+" <em>("+e.controller.GetModeName()+")</em>"}))}}_updateDroppedElement(e,t,i){if(i=!$a.isBool(i)||i,e.hasOwnProperty("controller"))e.controller.SetSection(),this._attemptSetElementAsKey(e),this._setElementModeLabel(e),this._setSectionModelNameLabels();else{var s=e.querySelector(".del"),o=e.querySelector(".edit");e.removeAttribute("data-ttid"),e.classList.remove("tt"),e.dataset.type=t?t.Type:e.dataset.type,s.addEventListener("click",this._removeElementClicked),o.addEventListener("click",this._editElementClicked),!1!==t&&void 0!==t&&$a.isObject(t)||(t=$a.jsonCloneObject(this.CleverForms.ElementData[e.dataset.type])),t&&Affinity2018.Classes.Apps.CleverForms.Elements.hasOwnProperty(t.Type)?("Section"===t.Type&&this._sectionRequiresworkflowSettings(t)&&(t.Details.SectionWorkflowVisibilitySettings=$a.jsonCloneObject(this.CleverForms.SectionWorkflowVisibilitySettings)),e.controller=new Affinity2018.Classes.Apps.CleverForms.Elements[t.Type](t),e.classList.add("item-"+e.controller.UniqueName),e.dataset.name=e.controller.Name,e.querySelector(".label")&&t.hasOwnProperty("Details")&&null!==t.Details.Label&&$a.isString(t.Details.Label)&&""!==t.Details.Label.trim()?e.querySelector(".label").innerHTML=t.Details.Label:e.querySelector(".label").innerHTML=t.Label,e.controller.SetSection(),this._attemptSetElementAsKey(e),this._setElementModeLabel(e),this._setSectionModelNameLabels()):$a.LogError("Element Error","critical",'Failed to get Element Class for "'+t.Type+'".')}return e&&t&&"AffinityField"===t.Type&&(!t.Details.AffinityField.ModelName&&t.Details.AffinityField.TableName&&(t.Details.AffinityField.ModelName=t.Details.AffinityField.TableName),t.Details.AffinityField.ModelName&&(e.dataset.model=t.Details.AffinityField.ModelName),t.Details.AffinityField.FieldName&&(e.dataset.field=t.Details.AffinityField.FieldName),null!==t.Details.AffinityField.Mode&&(e.dataset.mode=t.Details.AffinityField.Mode)),i?this._editElement(e,t):this._checkSave(),this.LockAffinityNonMasterFileSection(e),e}_attemptSetElementAsKey(e,t){var i=e.controller.Config;if("AffinityField"===i.Type&&null!==i.Details.AffinityField.FieldName&&i.Details.AffinityField.IsKeyField){var s=e.controller.Config.Icon.Color;e.controller.Config.Icon.Name,s="green",t&&(s="green"),e.classList.add("is-key-field"),this.CleverForms.AllowedGlobalKeys.contains(i.Details.AffinityField.FieldName)&&(e.classList.add("is-global-key"),s="yellow"),e.querySelector(".main-icon").className="main-icon "+s+" icon-cf-affinity-key"}return this.CleverForms.PseudoGlobalElementTypes.contains(i.Type)&&(e.querySelector(".main-icon").className="main-icon "+e.controller.Config.Icon.Color+" icon-"+e.controller.Config.Icon.Name,e.classList.add("is-pseudo-global-key")),this._setElementModeLabel(e),e}_editElement(e,t){if(e&&(clearTimeout(this.dragScrollTimer),t&&e&&e.hasOwnProperty("controller"))){var i=e.controller;return this.Editor.Set(Affinity2018.jsonCloneObject(t),e),this.Editor.Show(),void("AffinityField"!==t.Type||i.Saved?this.Editor.JumpSettings():this.Editor.JumpSearch())}Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.error_element_data"),showOk:!0,showCancel:!1,showInput:!1})}_editUpdated(e,t){!$a.isNode(t)&&e.hasOwnProperty("UniqueName")&&(t=this.RightListNode.querySelector(".item-"+e.UniqueName)),t&&t.hasOwnProperty("controller")&&t.controller.Changed&&(t.querySelector(".buttons .edit").classList.add("disabled"),t.querySelector(".buttons .edit").classList.add("disabled"),t.controller.Changed&&(this.LastModifiedTime=Date.now(),this._checkSave()),t.querySelector(".buttons .edit").classList.remove("disabled"),t.querySelector(".buttons .edit").classList.remove("disabled")),this.CleverForms.PseudoGlobalElementTypes.contains(e.Type)&&this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]')&&this.LeftListNode.querySelector('li[data-type="'+e.Type+'"]').classList.add("disabled"),this._attemptSetElementAsKey(t,!0),this._setSectionModelNameLabels(),this.LockAffinityNonMasterFileSection(t),this._checkSave()}_editCanceled(e,t){!$a.isNode(t)&&$a.isObject(e)&&e.hasOwnProperty("UniqueName")&&(t=this.RightListNode.querySelector(".item-"+e.UniqueName)),t&&t.hasOwnProperty("controller")&&!t.controller.Saved&&this._removeElement(t)}_editElementClicked(e){var t=e.target.closest(".cf-designer-element");t&&this._editElement(t,this._getElementDataFromNode(t))}_removeElementClicked(e){var t,i=$a.getEventNode(e,"cf-designer-element"),s=(i.controller.Config,[]),o=!1;if(i){if("Section"===i.dataset.type&&!i.querySelector("ul li"))return void this._setElementForDelete(i);var a=this.RightListNode.querySelector(".is-global-key");if("Section"===i.dataset.type&&a&&a.parentNode===i.querySelector("ul"))return void Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.error_section_remove_with_global",{label:a.controller.Config.Details.Label.replace(" ","&nbsp;")}),showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"});if(t="",t+=$a.Lang.ReturnPath("application.cleverfroms.designer.confirm_section_delete",{type:"Section"===i.dataset.type?"section":"field"}),"Section"===i.dataset.type){if(i.querySelector(".is-global-key")&&(i.querySelectorAll('li[data-type="AffinityField"]:not(.is-global-key)').length>0?o=!0:this.RightListNode.querySelectorAll('li[data-type="Section"]').forEach((function(e){e!==i&&e.querySelectorAll('li[data-type="AffinityField"]').length>0&&(o=!0)}))),!0===o)return i.querySelector(".is-global-key").controller.Config,void Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.error_section_remove_with_global",{label:a.controller.Config.Details.Label.replace(" ","&nbsp;")}),showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"});i.querySelectorAll(".cf-designer-element").length>0&&(t+=$a.Lang.ReturnPath("application.cleverfroms.designer.confirm_remove_reminder"))}else if("AffinityField"===i.dataset.type&&(i.classList.contains("is-global-key")||i.classList.contains("is-key-field"))){var n=null;i.classList.contains("is-key-field")&&(n=this._getDependantFields(i.controller.Config)),i.classList.contains("is-global-key")&&(n=this._getDependantFields(a.controller.Config)),null!=n&&(s=n.nodes,n.nodes.length>0&&(t=$a.Lang.ReturnPath("app.cf.designer.confirm_element_remove_with_key",{keyField:i.controller.Config.Details.Label,fields:n.list,plural:n.plural,listPlural:n.listPlural})))}this._disableAllDeleteButtons(),Affinity2018.Dialog.Show({message:t,showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{cancel:{show:!0,icon:"cross",text:$a.Lang.ReturnPath("generic.buttons.cancel")},ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.remove")}},onOk:function(){if(s.length>0)for(var e=0;e<s.length;e++)this._setElementForDelete(s[e]);this._setElementForDelete(i),this._setSectionModelNameLabels()}.bind(this),onCancel:this._clearRemove,onClose:this._clearRemove})}}_getDependantFields(e){var t,i,s=this.RightListNode.querySelectorAll('li[data-type="AffinityField"]:not(.is-global-key)'),o=[],a=[],n="",r="s",l="";if(s.forEach(function(s){if(t=s.controller.Config,"array"===$a.type(t.Details.AffinityField.KeyFields)&&t.Details.AffinityField.KeyFields.length>0)for(i=0;i<t.Details.AffinityField.KeyFields.length;i++)t.Details.AffinityField.KeyFields[i].FieldName===e.Details.AffinityField.FieldName&&(o.push(s),a.push(s.controller.Config.Details.Label))}.bind(this)),a.length>0&&(l="'<strong>"+a.join("</strong>'","'<strong>")+"</strong>'",a.length>1)){n="s",r="";var d=a.pop();l="'<strong>"+a.join("</strong>', '<strong>")+"</strong>', and '<strong>"+d+"</strong>'"}return{nodes:o,list:l,plural:n,listPlural:r}}_clearRemove(){this._enableAllDeleteButtons()}_removeElement(e){if(e){var t=!!e.hasOwnProperty("controller")&&$a.jsonCloneObject(e.controller.Config),i=this.GetElementSectionNode(e);if(e.querySelector("ul"))for(var s=0,o=e.querySelectorAll("ul li");s<o.length;s++)o[s].hasOwnProperty("controller")&&o[s].controller.RemoveDesignerElement(this._removeElement);e.querySelector(".del").removeEventListener("click",this._removeElementClicked),e.querySelector(".edit").removeEventListener("click",this._editElementClicked),e.innerHTML="",e.parentElement.removeChild(e),this.CleverForms.PseudoGlobalElementTypes.contains(t.Type)&&this.LeftListNode.querySelector('li[data-type="'+t.Type+'"]')&&this.LeftListNode.querySelector('li[data-type="'+t.Type+'"]').classList.remove("disabled"),e=null,this._setSectionModelNameLabels(),i&&this.LockAffinityNonMasterFileSection(i)}this._enableAllDeleteButtons()}_setElementForDelete(e){e&&e.controller&&(e.controller.Saved?(e.controller.Delete=!0,e.controller.Changed=!0,e.controller.Hide(),this._checkSave()):this._removeElement(e))}_disableAllDeleteButtons(){this.RightListNode.querySelectorAll("li .buttons .del").forEach((function(e){e.classList.add("disabled")}))}_enableAllDeleteButtons(){this.RightListNode.querySelectorAll("li .buttons .del").forEach((function(e){e.classList.remove("disabled")}))}_disableAllButtons(){this.RightListNode.querySelectorAll("li .buttons .del, li .buttons .edit").forEach((function(e){e.classList.add("disabled")})),this.TopNode.querySelectorAll(".button").forEach((function(e){e.classList.add("disabled")}))}_enableAllButtons(){this.RightListNode.querySelectorAll("li .buttons .del,li .buttons .edit").forEach((function(e){e.classList.remove("disabled")})),this.TopNode.querySelectorAll(".button").forEach((function(e){e.classList.remove("disabled")}))}_updateFormDetails(e){var t=$a.jsonCloneObject(this.CleverForms.TemplateModel);t.Description=this.TopNode.querySelector("input.form-name").value.trim(),t.UserInstructions=this.TopNode.querySelector("input.form-instructions").value.trim(),t.Revision=this.TopNode.querySelector("input.form-revision").value.trim(),t.WorkflowDefinitionIds=[],this.CleverForms.hasOwnProperty("TemplateModel")&&$a.isObject(this.CleverForms.TemplateModel)&&($a.isPropString(this.CleverForms.TemplateModel,"WorkflowDefinitionIds")?t.WorkflowDefinitionIds=this.CleverForms.TemplateModel.WorkflowDefinitionIds.split(","):$a.isPropArray(this.CleverForms.TemplateModel,"WorkflowDefinitionIds")&&(t.WorkflowDefinitionIds=this.CleverForms.TemplateModel.WorkflowDefinitionIds),t.WorkflowDefinitionIds=t.WorkflowDefinitionIds.removeEmpty(),t.WorkflowDefinitionIds=t.WorkflowDefinitionIds.removeDuplicates()),JSON.stringify(t)!==JSON.stringify(this.lastUpdateFormDetails)&&(this.updatingFromDetails=!0,this.DesignerSavingNode.classList.add("show"),this.CleverForms.TemplateModel=t,axios({method:"post",url:this.CleverForms.FormDetailsApi,data:{model:this.CleverForms.TemplateModel}}).then(function(e){this.lastUpdateFormDetails=t,this.DesignerSavingNode.classList.remove("show")}.bind(this)).catch(function(e){this.DesignerSavingNode.classList.remove("show")}.bind(this)))}_setupLeftListPositionOnScroll(){this.EnableLeftAutoScroll&&(this.ld={top:$a.getPosition(this.LeftListNode).top,viewHeight:0,lastScroll:0,currentScroll:0,locked:!1},["_windowScroll"].bindEach(this),window.addEventListener("scroll",this._windowScroll,Affinity2018.PassiveEventProp))}_windowScroll(e){if(this.EnableLeftAutoScroll){if($a.getSize(this.LeftListNode).height>=$a.getSize(this.RightListNode).height)return"scrollTo"in this.LeftListNode?this.LeftListNode.scrollTo(0,0):this.LeftListNode.scrollTop=0,this.LeftListNode.style.position=null,this.LeftListNode.style.bottom=null,this.LeftListNode.style.height=null,this.LeftListNode.style.overflow=null,void(this.ld.locked=!1);this.ld.currentScroll=window.pageYOffset||document.documentElement.scrollTop,this.ld.viewHeight=$a.getWindowSize().height,this.ld.currentScroll>this.ld.lastScroll?this.ld.scrollDirection="down":this.ld.scrollDirection="up";var t=0;if(document.body.classList.contains("dashboard")&&document.querySelector("#dashFooter")){var i=document.querySelector("#dashFooter"),s=$a.getSize(i).height,o=$a.getPageSize().height-this.ld.viewHeight;this.ld.currentScroll>o-s-10&&(t=this.ld.currentScroll-(o-s-10))}if("down"===this.ld.scrollDirection&&(!this.ld.locked&&this.ld.currentScroll>=this.ld.top-15&&(this.LeftListNode.style.position="fixed",this.LeftListNode.style.bottom=15+t+"px",this.LeftListNode.style.height=this.ld.viewHeight-40+"px",this.LeftListNode.style.overflow="hidden",this.ld.locked=!0),this.ld.locked)){var a=this.LeftListNode.scrollTop;"scrollTo"in this.LeftListNode&&this.LeftListNode.scrollTo(0,a+(this.ld.currentScroll-this.ld.lastScroll)),this.LeftListNode.scrollTop=a+(this.ld.currentScroll-this.ld.lastScroll),this.LeftListNode.style.bottom=15+t+"px"}"up"===this.ld.scrollDirection&&(this.ld.locked&&(a=this.LeftListNode.scrollTop,0===t&&("scrollTo"in this.LeftListNode&&this.LeftListNode.scrollTo(0,a-(this.ld.lastScroll-this.ld.currentScroll)),this.LeftListNode.scrollTop=a-(this.ld.lastScroll-this.ld.currentScroll)),this.LeftListNode.style.bottom=15+t+"px"),this.ld.locked&&this.ld.currentScroll<=this.ld.top-15&&("scrollTo"in this.LeftListNode?this.LeftListNode.scrollTo(0,0):this.LeftListNode.scrollTop=0,this.LeftListNode.style.position=null,this.LeftListNode.style.bottom=null,this.LeftListNode.style.height=null,this.LeftListNode.style.overflow=null,this.ld.locked=!1)),this.ld.lastScroll=this.ld.currentScroll<=0?0:this.ld.currentScroll}}_elementExists(e){return!!this.RightListNode.querySelector(".item-"+e.UniqueName)}_getElementDataFromName(e){return!!this.RightListNode.querySelector(".item-"+e)&&this.RightListNode.querySelector(".item-"+e).controller.Config}_getElementDataFromNode(e){return!!e.hasOwnProperty("controller")&&e.controller.Config}_loadPreview(){var e,t=this.CleverForms.GetTemplateGuid();t&&(e=this.CleverForms.PreviewPath+"/"+t,window.location.hash&&(e+=window.location.hash),this.OpenPreviewInNewWindow?window.open(e,"Designer").location:window.location=e)}_setupDrag(){var e=[];return e.push(this.LeftListNode),e.push(this.RightListNode),this.RightListNode.querySelectorAll('li[data-type="Section"] ul, li[data-type="section"] ul').forEach((function(t){e.push(t)})),this.Dragger=dragula({containers:e,copy:this._canCopy,accepts:this._canDrop}),this.Dragger.on("drag",this._dragStart),this.Dragger.on("dragend",this._dragEnd),this.Dragger.on("drop",this._dropped),!0}_canCopy(e,t){return t===this.LeftListNode}_canDrop(e,t,i){return this.DragEndMessage=!1,this.DragEndCallback=!1,t!==this.LeftListNode&&(!(!t||"Section"!==e.dataset.type||!t.classList.contains("sections-only"))||!["Section","AffinityField"].contains(e.dataset.type)&&!t.classList.contains("sections-only")||!(t&&"Section"===e.dataset.type&&!t.classList.contains("sections-only"))&&!(t&&"Section"!==e.dataset.type&&!t.classList.contains("items-only"))&&("AffinityField"===e.dataset.type?this.CanAllowAffinityField(e,!1,!1,!0,t,i):(this.DragEndMessage=!1,this.DragEndCallback=!1,!1)))}_dragStart(){Affinity2018.supportsPassiveEvents?window.addEventListener("mousemove",this._dragMove,{passive:!0}):window.addEventListener("mousemove",this._dragMove,!1),clearTimeout(this.dragScrollTimer),this.dragScrollTimer=!1}_dragMove(e){if(this.dragScrollData={},this.dragScrollData.viewportX=e.clientX,this.dragScrollData.viewportY=e.clientY,this.dragScrollData.viewportWidth=document.documentElement.clientWidth,this.dragScrollData.viewportHeight=document.documentElement.clientHeight,this.dragScrollData.edgeTop=this.DragScrollEdge,this.dragScrollData.edgeLeft=this.DragScrollEdge,this.dragScrollData.edgeBottom=this.dragScrollData.viewportHeight-this.DragScrollEdge,this.dragScrollData.edgeRight=this.dragScrollData.viewportWidth-this.DragScrollEdge,this.dragScrollData.isInLeftEdge=this.dragScrollData.viewportX<this.dragScrollData.edgeLeft,this.dragScrollData.isInRightEdge=this.dragScrollData.viewportX>this.dragScrollData.edgeRight,this.dragScrollData.isInTopEdge=this.dragScrollData.viewportY<this.dragScrollData.edgeTop,this.dragScrollData.isInBottomEdge=this.dragScrollData.viewportY>this.dragScrollData.edgeBottom,!(this.dragScrollData.isInLeftEdge||this.dragScrollData.isInRightEdge||this.dragScrollData.isInTopEdge||this.dragScrollData.isInBottomEdge))return clearTimeout(this.dragScrollTimer),void(this.dragScrollTimer=!1);this.dragScrollData.documentWidth=Math.max(document.body.scrollWidth,document.body.offsetWidth,document.body.clientWidth,document.documentElement.scrollWidth,document.documentElement.offsetWidth,document.documentElement.clientWidth),this.dragScrollData.documentHeight=Math.max(document.body.scrollHeight,document.body.offsetHeight,document.body.clientHeight,document.documentElement.scrollHeight,document.documentElement.offsetHeight,document.documentElement.clientHeight),this.dragScrollData.maxScrollX=this.dragScrollData.documentWidth-this.dragScrollData.viewportWidth,this.dragScrollData.maxScrollY=this.dragScrollData.documentHeight-this.dragScrollData.viewportHeight,this.dragScrollTimer||this._checkDragScroll()}_checkDragScroll(){clearTimeout(this.dragScrollTimer),this._adjustDragScroll()&&(this.dragScrollTimer=setTimeout(this._checkDragScroll,30))}_adjustDragScroll(){var e,t=window.pageXOffset,i=window.pageYOffset,s=i>0,o=i<this.dragScrollData.maxScrollY,a=t>0,n=t<this.dragScrollData.maxScrollX,r=t,l=i;return this.dragScrollData.isInLeftEdge&&a?(e=(this.dragScrollData.edgeLeft-this.dragScrollData.viewportX)/this.DragScrollEdge,r-=this.DragScrollMaxStep*e):this.dragScrollData.isInRightEdge&&n&&(e=(this.dragScrollData.viewportX-this.dragScrollData.edgeRight)/this.DragScrollEdge,r+=this.DragScrollMaxStep*e),this.dragScrollData.isInTopEdge&&s?(e=(this.dragScrollData.edgeTop-this.dragScrollData.viewportY)/this.DragScrollEdge,l-=this.DragScrollMaxStep*e):this.dragScrollData.isInBottomEdge&&o&&(e=(this.dragScrollData.viewportY-this.dragScrollData.edgeBottom)/this.DragScrollEdge,l+=this.DragScrollMaxStep*e),r=Math.max(0,Math.min(this.dragScrollData.maxScrollX,r)),l=Math.max(0,Math.min(this.dragScrollData.maxScrollY,l)),(r!==t||l!==i)&&(window.scrollTo(r,l),!0)}_dragEnd(){clearTimeout(this.dragScrollTimer),this.dragScrollTimer=!1,Affinity2018.supportsPassiveEvents?window.removeEventListener("mousemove",this._dragMove,{passive:!0}):window.removeEventListener("mousemove",this._dragMove,!1),this.DragEndMessage&&(this.DragEndCallback&&$a.isFunction(this.DragEndCallback)&&this.DragEndCallback(),Affinity2018.Dialog.Show({message:this.DragEndMessage,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")}}}),this.DragEndMessage=!1,this.DragEndCallback=!1)}_dropped(e,t,i,s){if(clearTimeout(this.dragScrollTimer),null!==t){if("section"===e.dataset.type.toLowerCase()&&(this.Dragger.containers.contains(e.querySelector("ul"))||this.Dragger.containers.push(e.querySelector("ul"))),!this._getElementDataFromNode(e))return void this._updateDroppedElement(e,!1,!0);var o=this._getElementDataFromNode(e);this._updateDroppedElement(e,o,!1),this.lastModifiedTime=Date.now()}}_checkSave(){clearTimeout(this._checkSaveTimer),this._checkSaveTimer=setTimeout(this._checkSaveThrottled,250)}_returnRank(e){var t,i=-99;return"Section"===e.dataset.type?(t=this.RightListNode.querySelector("li.item-"+e.dataset.name))&&(i=this.RightListNode.querySelectorAll('li[data-type="Section"]').indexOf(t)):(t=this.RightListNode.querySelector("li.item-"+e.dataset.name))&&(i=this.GetElementSectionNode(e).querySelectorAll("ul li.cf-designer-element").indexOf(t)),i}_checkSaveThrottled(){clearTimeout(this._checkSaveTimer);var e,t,i,s,o,a=[],n=[];this.RightListNode.querySelectorAll('li.cf-designer-element[data-type="Section"]').forEach(function(r){r.controller&&(e=r.controller.Config.Details.Rank+0,t=-99===e||!r.controller.Saved,i=this._returnRank(r),o=r.controller.ReturnChanges(),t||e===i?0===o.length&&!0===r.controller.Changed&&o.unshift("Force save from Change = true"):o.unshift('"Rank": '+e.toString().padLeft(" ",2)+' => "Rank": '+i.toString().padLeft(" ",2)),(o.length>0||r.controller.Delete)&&(r.controller.Config.Details.Rank=i,r.controller.Changed=!0,a.push(r),n.push(["%c\t"+'SECTION "{label}" CHANGED'.format({label:r.controller.Config.Details.Label}),"font-weight:bold;color:#8dca35"]),t&&n.push(["%c\t\tNew Section","font-weight:bold;color:#8dca35"]),r.controller.Delete?n.push(["%c\t\tDeleting Section","font-weight:bold;color:#e33100"]):!t&&o.length>0&&n.push(["%c\t\t"+o.join("\n\t\t"),"font-weight:bold;color:#8dca35"])),r.controller.Delete||r.querySelectorAll('li.cf-designer-element:not([data-type="Swcrion"])').forEach(function(i){i.controller&&(e=i.controller.Config.Details.Rank+0,t=-99===e||!i.controller.Saved,s=this._returnRank(i),o=i.controller.ReturnChanges(),t||e===s?0===o.length&&!0===i.controller.Changed&&o.unshift("Force save from Change = true"):o.unshift('"Rank": '+e.toString().padLeft(" ",2)+' => "Rank": '+s.toString().padLeft(" ",2)),(o.length>0||i.controller.Delete)&&(i.controller.Config.Details.Rank=s,i.controller.Changed=!0,a.push(i),n.push(["%c\t"+'ELEMENT "{label}" CHANGED'.format({label:i.controller.Config.Details.Label}),"font-weight:bold;color:#8dca35"]),t&&n.push(["%c\t\tNew Element","font-weight:bold;color:#8dca35"]),i.controller.Delete?n.push(["%c\t\tDeleting Element","font-weight:bold;color:#e33100"]):!t&&o.length>0&&n.push(["%c\t\t"+o.join("\n\t\t"),"font-weight:bold;color:#8dca35"])))}.bind(this)))}.bind(this)),a.length>0?console.groupCollapsed("%c🖪 We have Changes to Save!","font-weight:bold;color:#8dca35"):console.groupCollapsed("%c👍 No Changes to Save","color:#16c1f3");for(var r=0;r<n.length;r++)console.log(n[r][0],n[r][1]);return console.groupEnd(),a.length>0&&(this.Save(a),!0)}_packageFormData(e,t,i){var s=new FormData;return function e(t,o){if(!function(e){return Array.isArray(i)&&i.some((function(t){return t===e}))}(o))if(o=o||"",t instanceof File)s.append(o,t);else if(Array.isArray(t))for(var a=0;a<t.length;a++)e(t[a],o+"["+a+"]");else if(t&&"object"==typeof t)for(var n in t)t.hasOwnProperty(n)&&e(t[n],""===o?n:o+"."+n);else null!=t&&s.append(o,t)}(e,t),s}_post(){if(Object.keys(this.PostData).length>0)if(this.DesignerSavingNode.classList.add("show"),this.PostLocked=!0,this.LastPostTime=Date.now(),this.UseFormDataPost){var e=this._packageFormData(this.PostData,"FormElements");for(var t of(console.groupCollapsed("%c✉ FORM POST DATA =========================================","color:#16c1f3"),this.PostData.entries()))console.log(t[0]+", "+t[1]);console.groupEnd(),this.EnablePost?axios({method:"POST",url:this.CleverForms.SaveDataApi,data:e,headers:{"Content-Type":"multipart/form-data"}}).then(this._postThen).catch(this._postCatch):this._postThen({status:200,config:{data:{FormElements:this.PostData}}})}else console.groupCollapsed("%c✉ FORM POST DATA =========================================","color:#16c1f3"),console.log({formElements:{FormElements:this.PostData}}),console.log("Post Payload"),console.log(JSON.stringify({formElements:{FormElements:this.PostData}})),this.EnablePost?axios({method:"POST",url:this.CleverForms.SaveDataApi,data:{formElements:{FormElements:this.PostData}}}).then(this._postThen).catch(this._postCatch):this._postThen({status:200,config:{data:{FormElements:this.PostData}}})}_postThen(e){if("object"==typeof e&&e.hasOwnProperty("status")){if(205===e.status)return this.PostLocked=!1,$a.ShowPageLoader(),this.DesignerSavingNode.classList.add("show"),this._loadTemplate(),!0;if([204,200].contains(e.status)){var t=!1,i=!1;return $a.isPropObject(e,"config")&&e.config.hasOwnProperty("data")&&($a.isPropObject(e.config,"data")&&(i=e.config.data),$a.isPropString(e.config,"data")&&(i=JSON.parse(e.config.data)),console.log("Response Payload"),console.log(JSON.stringify(i))),i&&!this._setPosted(i)||(this._postComplete(),!0)}}this._postFailed(t,"unknown error")}_postCatch(e){var t="",i={},s="unknown error";"object"==typeof e&&(e.hasOwnProperty("config")&&(i=""===(t=e.config.data)?{}:JSON.parse(t)),e.hasOwnProperty("statusText")&&(s=e.statusText)),this._postFailed(i,s)}_setPosted(e,t){if(this.LastPostTime<this.LastModifiedTime)return console.log("%c    last mod was "+(this.LastModifiedTime-this.LastPostTime)+' ms after last post.. block "modified=true" resets and try posting again...',"color:#099"),clearTimeout(this.statePostTimer),this.PostLocked=!1,this._checkSave(),!1;$a.isObject(e.formElements)||(e={formElements:e}),$a.isArray(e.formElements.FormElements)||(e={formElements:{FormElements:[e.formElements.FormElements]}});for(var i,s,o=0;o<e.formElements.FormElements.length;o++)i=e.formElements.FormElements[o].Name,(s=this.RightListNode.querySelector("li.item-"+i))&&(s.controller.Delete?this._removeElement(s):(s.controller.Saved=!0,s.controller.Changed=!1,s.controller.Changes=[],s.ConfigStringCheck=JSON.stringify(s.controller.Config)));return this.DesignerSavingNode.classList.remove("show"),!0}_postComplete(){return this._enableAllButtons(),this.RightListNode.querySelector('li[data-type="Section"]')||this.Uploading||this._injectDefaultSection(),this.PostLocked=!1,this.DesignerSavingNode.classList.remove("show"),this.Uploading||$a.HidePageLoader(),console.groupEnd(),window.dispatchEvent(new Event("posted")),!0}_postFailed(e,t){this._postComplete();var i=$a.Lang.ReturnPath("application.cleverfroms.designer.error_save",{error:t});Affinity2018.Dialog.Show({message:i,showOk:!0,showCancel:!1,showInput:!1,canBackgroundClose:!1,textAlign:"left"}),Affinity2018.LogError("Design Error","Blocker","Post failed: "+t+"."),console.groupEnd()}_sortByLabel(e,t){return e.Label<t.Label?-1:e.Label>t.Label?1:0}_sortByName(e,t){return e.Name>t.Name?-1:e.Name<t.Name?1:0}_sortByDate(e,t){return e.Date>t.Date?-1:e.Date<t.Date?1:0}_sortByRank(e,t){if(e.hasOwnProperty("Rank")){if(e.Rank>t.Rank)return-1;if(e.Rank<t.Rank)return 1}else if(e.hasOwnProperty("Details")&&e.Details.hasOwnProperty("Rank")){if(e.Details.Rank>t.Details.Rank)return-1;if(e.Details.Rank<t.Details.Rank)return 1}return 0}_sortByElementRank(e,t){return e.Details.Rank>t.Details.Rank?1:e.Details.Rank<t.Details.Rank?-1:0}_download(){var e=JSON.stringify(this.TemplateData,!1,2),t=this.TopNode.querySelector("input.form-name").value.trim()+" Template.json";$a.Dialog.Show({message:"Save as",buttons:{ok:{show:!0,icon:"download",text:"Download",color:"blue"},cancel:{show:!0,icon:"cross",text:"Cancel",color:"grey"}},input:{show:!0,placeholder:"",default:t,lines:1},textAlign:"left",canBackgroundClose:!1,onOk:function(t){if(""!==(t=t.trim())){".json"!==t.toLowerCase().substring(t.length-5,t.length)&&(t+=".json");var i=document.createElement("a"),s=new Blob([e],{type:"octet/stream"}),o=window.URL.createObjectURL(s);document.body.appendChild(i),i.href=o,i.download=t,i.click(),window.URL.revokeObjectURL(o),document.body.removeChild(i),i=null}}.bind(this)})}_upload(e){var t,i,s=this.TopNode.querySelector("input.upload-file").files[0];if(s)if(i=(s.size/1024/1024).toFixed(4),"json"===(t=/(?:\.([^.]+))?$/.exec(s.name)[1].toLowerCase())&&i<=20)$a.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.upload_template_message"),textAlign:"left",buttons:{ok:{show:!0,icon:"tick",color:"green",text:"Continue"},cancel:{show:!0,icon:"cross",color:"grey",text:"Cancel"}},onOk:function(){this.Uploading=!0,this._disableAllButtons(),this.RightListNode.querySelectorAll('li[data-type="Section"]').forEach((function(e){e.controller.Delete=!0})),window.addEventListener("posted",this._uploadAfterDelete),this._checkSave()}.bind(this)});else{var o=$a.Lang.ReturnPath("application.cleverfroms.designer.upload_template_error");i>20?o=$a.Lang.ReturnPath("application.cleverfroms.designer.upload_template_error_large"):"json"!==t&&(o=$a.Lang.ReturnPath("application.cleverfroms.designer.upload_template_error_format")),$a.Dialog.Show({buttons:{cancel:!1},message:o})}}_uploadAfterDelete(){window.removeEventListener("posted",this._uploadAfterDelete);var e=new FileReader;e.onload=function(){this.TopNode.querySelector("input.upload-file").value=null;var t=e.result;try{this.TemplateData=JSON.parse(t),t.contains("AffinityField")?$a.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.repair_message"),buttons:{ok:{show:!0,icon:"arrow-right",text:$a.Lang.ReturnPath("application.cleverfroms.designer.button_no_repair"),color:"dark-blue"},cancel:{show:!0,icon:"incident",text:$a.Lang.ReturnPath("application.cleverfroms.designer.button_repair"),color:"dark-green"}},textAlign:"center",canBackgroundClose:!1,onOk:this._saveAfterUpload,onCancel:function(){this._saveAfterUpload(!0)}.bind(this)}):this._saveAfterUpload()}catch(e){console.log(e),this._enableAllButtons()}}.bind(this),e.readAsBinaryString(this.TopNode.querySelector("input.upload-file").files[0])}_saveAfterUpload(e){e=$a.paramOrDefault(e,!1);var t,i,s,o,a=0;for(this.TemplateData=this.TemplateData.reverse(),this.UploadSectionsDone=[];a<this.TemplateData.length;a++)for(this.TemplateData[a].Name=this.TemplateData[a].Type+"-"+$a.uuid(),-99===this.TemplateData[a].Rank&&(this.TemplateData[a].Rank=a),this.TemplateData[a].Details.Rank=this.TemplateData[a].Rank,this.TemplateData[a].Elements.sort(this._sortByRank),this.TemplateData[a].Elements=this.TemplateData[a].Elements.reverse(),this.UploadSectionsDone[a]=!1,t=0;t<this.TemplateData[a].Elements.length;t++)this.TemplateData[a].Elements[t].Name=this.TemplateData[a].Elements[t].Type+"-"+$a.uuid(),this.TemplateData[a].Elements[t].Section=this.TemplateData[a].Name,-99===this.TemplateData[a].Elements[t].Rank&&(this.TemplateData[a].Elements[t].Rank=t),this.TemplateData[a].Elements[t].Details.Rank=this.TemplateData[a].Elements[t].Rank,e&&((i=this.TemplateData[a].Elements[t]).hasOwnProperty("Type")&&"AffinityField"===i.Type&&((s=i.Details.AffinityField.Mode)!==(o=(i=this.CleverForms.SelectDefaultModeOnFieldSearch(i)).Details.AffinityField.Mode)&&i.Details.AffinityField.ModeOptions.contains(s)&&(i.Details.AffinityField.Mode=s),i.Details.AffinityField.Mode!==s&&console.log("%cChanged {name} Mode from {oldMode} tp {newMode}".format({name:i.Details.Name,oldMode:this.CleverForms.AffnityFieldModeEnums[s].Label,newMode:this.CleverForms.AffnityFieldModeEnums[o].Label}),"color:#b27e0f;font-weight:bold;")),this.TemplateData[a].Elements[t]=i);var n=function(){window.removeEventListener("posted",n),this.Uploading=!1,$a.HidePageLoader()};["reset"].bindEach(this),window.addEventListener("posted",n),this._processTemplate()}_templates(){this.sectionTemplate='\n      <div class="main-icon"></div>\n      <div class="label border"></div>\n      <div class="buttons">\n        <span class="edit">{edit}</span>\n        <span class="del">X</span>\n      </div>\n      <div class="drag-handle icon-cf-drag"></div>\n      <p class="section-message{messageClass}">{message} <em></em><br></p>\n      <ul class="droppable items-only"></ul>\n    ',this.elementTemplate='\n      <div class="main-icon"></div>\n      <div class="label"></div>\n      <div class="buttons">\n        <span class="edit">{edit}</span>\n        <span class="del">X</span>\n      </div>\n      <div class="buttons"></div>\n      <div class="drag-handle icon-cf-drag"></div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Apps.CleverForms.Form=class{_options(){this.ViewType="Form",this.FormNode=null,this.LogElementOutput=!1,this.RequestCheckCount=0,this.RequestCheckCountMax=50,this.Ready=!1,this.TestErrorStub=!1}constructor(){this._options(),["_init","Add","ResizeSection","Save","_initTemplatesLoaded","_hasValue","_getValue","_celanValue","_getLabel","_getTemplateInfo","_initTemplatesLoaded","_loadElementData","_gotElementData","_loadTemplate","_processTemplate","_loadTemplateError","_loadinstance","_processInstance","_loadInstanceError","_processHistory","_getWorkflowButtons","_gotWorkflowButtons","_getWorkflowButtonsFailed","_checkIdentitySelects","_showComments","_hideComments","_submit","_save","_getPostData","_post","_postCatch","_postThen","_setPosted","_postComplete","_postFailed","_submit","_print","_close","_ready","_checkWidgetsLoaded","_widgetsLoaded","_checkRequests","_templates"].bindEach(this),this._templates(),this.CleverForms=Affinity2018.Apps.CleverForms.Default,this.CleverForms.Form=this,this.ViewType=window.location.href.toString().toLowerCase().contains("/preview")?"Preview":this.ViewType,this.ViewType=window.location.href.toString().toLowerCase().contains("/viewonly")?"ViewOnly":this.ViewType,this.CleverForms.ViewType=this.ViewType,document.body.classList.add("cform"),Affinity2018.hasOwnProperty("RequestQueue")||(Affinity2018.RequestQueue=new Affinity2018.Classes.Plugins.RequestQueue),Affinity2018.Apps.Plugins.Strings=new Affinity2018.Classes.Plugins.Strings,Affinity2018.Apps.Plugins.Numbers=new Affinity2018.Classes.Plugins.Numbers,Affinity2018.Apps.Plugins.Address=new Affinity2018.Classes.Plugins.Address,Affinity2018.Apps.Plugins.BankNumber=new Affinity2018.Classes.Plugins.BankNumber,Affinity2018.Apps.Plugins.TaxNumber=new Affinity2018.Classes.Plugins.TaxNumber,Affinity2018.Apps.Plugins.FileUpload=new Affinity2018.Classes.Plugins.FileUpload,Affinity2018.Apps.Plugins.DrawPanel=new Affinity2018.Classes.Plugins.DrawPanel,Affinity2018.UiReady?this._init():window.addEventListener("MainInit",this._init)}_init(){if(Affinity2018.ShowPageLoader(),!document.querySelector("#form"))return Affinity2018.HidePageLoader(),void Affinity2018.ThrowError("Form Error","Blocker",'Could not find From DOM Node (<div id="form">). Form init faild.');if(this.FormNode=document.querySelector("#form"),this.ButtonsNode=document.querySelector("#buttons"),this.CommentNode=this.ButtonsNode.querySelector(".comments"),this.CommentInputNode=this.ButtonsNode.querySelector("textarea"),this.HistoryNode=document.querySelector("#history"),this.UserInstructionsNode=document.querySelector(".user-instructions"),this.RequiredMessageNode=document.querySelector(".required-message"),this.ButtonsNode.classList.add("locked"),"Preview"===this.ViewType){var e=document.querySelector(".preview-top-buttons");if(e){var t=document.createElement("div"),i=this.buttonTemplate.format({Type:"Button",DestinationStateId:"",SateType:0,ActionType:"back",Name:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_back_button"),Color:"blue",Icon:"arrow-left",Path:null,visible:!0});t.innerHTML=i;var s=t.querySelector("div");s.addEventListener("click",this._close),e.appendChild(s),t=null,s=null,e.classList.remove("hidden")}this._loadTemplate()}"Form"===this.ViewType&&this._loadInstance(),"ViewOnly"===this.ViewType&&this._loadInstance(),document.querySelector("input.form-name")&&""!==document.querySelector("input.form-name").value.trim()&&(document.title="Edit "+document.querySelector("input.form-name").value.trim())}Add(e,t,i){var s=null,o=[],a=!0;if(o.push("add "+e+" element..."),o.push(e),o.push(i),Affinity2018.Classes.Apps.CleverForms.Elements.hasOwnProperty(e)){o.push("form has object for "+e);var n=!!t.Details.hasOwnProperty("IsReadOnly")&&t.Details.IsReadOnly,r=this.CleverForms.BackfillConfig($a.jsonCloneObject(t));(r=this.CleverForms.__THIS_IS_A_TEMP_TRANSMUTER_FOR_G_G_G_GET_DATA_UNTIL_GET_DATA_MATCHES_NEW_STRUCTURE(r,this.FormData)).Details.IsReadOnly=n,(!r.Details.hasOwnProperty("Value")||r.Details.hasOwnProperty("Value")&&null===r.Details.Value)&&(r.Details.Value=""),t.hasOwnProperty("Value")&&null!==t.Value&&(r.Details.Value=t.Value),o.push(r),s=new Affinity2018.Classes.Apps.CleverForms.Elements[e](r).SetFormRow(i)}else a=!1,o.push("form does NOT has object for "+e),o.push("no config");return this.LogElementOutput&&(a?console.groupCollapsed("%c"+o[0],"color:green"):console.groupCollapsed("%c"+o[0],"color:red"),console.log(o[1]),console.log(o[2]),a?console.log("%c"+o[3],"color:green"):console.log("%c"+o[3],"color:red"),console.log(o[4]),console.groupEnd()),o=null,s}ResizeSection(e){var t;if($a.isNode(e)){var i=!1,s=e.closest("div.section");s.querySelector(".collapser")&&(s.querySelector(".section-body").style.maxHeight=null,s.classList.contains("collapsed")&&(i=!0,s.classList.remove("collapsed")),(t=Affinity2018.getSize(s.querySelector(".section-body"))).height>0&&(s.querySelector(".section-body").style.maxHeight=Math.ceil(t.height+60)+"px"),i&&s.classList.add("collapsed"))}else document.querySelectorAll(".section").forEach(function(e){e.querySelector(".collapser")&&(t=Affinity2018.getSize(e.querySelector(".section-body")),e.querySelector(".collapser").addEventListener("click",this._toggleSection),t.height>0&&(e.querySelector(".section-body").style.maxHeight=Math.ceil(t.height+60)+"px"),e.classList.contains("start-collapsed")&&(e.classList.remove("start-collapsed"),e.classList.add("collapsed")))}.bind(this))}Save(e){var t=$a.jsonCloneObject(this.SaveButtonData);this._post(t,e)}_ready(){this.widgetData=[],Affinity2018.Tooltips.Apply(),Affinity2018.SelectLookups.Apply(),Affinity2018.Apps.Plugins.Numbers.Apply(),Affinity2018.Apps.Plugins.Strings.Apply(),Affinity2018.Apps.Plugins.BankNumber.Apply(),Affinity2018.Apps.Plugins.TaxNumber.Apply(),Affinity2018.Pagination.Apply(),this.widgetData[0]=Affinity2018.Autocompletes.Apply(),this.widgetData[1]=Affinity2018.Calendars.Apply(),this.widgetData[2]=Affinity2018.Apps.Plugins.Address.Apply(),this.widgetData[3]=Affinity2018.Apps.Plugins.DrawPanel.Apply(),this.widgetData[4]=Affinity2018.Apps.Plugins.FileUpload.Apply(),this._checkWidgetsLoaded()}_checkWidgetsLoaded(){clearTimeout(this._widgetLoadCheckTimer);for(var e=0,t=0,i=0,s=0;i<this.widgetData.length;i++)e+=this.widgetData[i].total;for(i=0;i<this.widgetData.length;i++)for(s=0;s<this.widgetData[i].widgets.length;s++)this.widgetData[i].widgets[s].Ready&&t++;return t!==e?(this._widgetLoadCheckTimer=setTimeout(this._checkWidgetsLoaded,100),!1):(this._widgetsLoaded(),!0)}_widgetsLoaded(){clearTimeout(this._widgetLoadCheckTimer),this.widgetData=null,this.ResizeSection(),this._checkRequests(),this._processHistory()}_checkRequests(){if(clearTimeout(this._requestsCheckTimer),this.RequestCheckCount++,Affinity2018.RequestQueue&&"running"===Affinity2018.RequestQueue.GetStatus())return this.RequestCheckCount>this.RequestCheckCountMax?(console.log("%cRequests took to long","color:#ff5c00"),Affinity2018.HidePageLoader(),this.ButtonsNode.classList.remove("locked"),void(this.Ready=!0)):void(this._requestsCheckTimer=setTimeout(this._checkRequests,100));Affinity2018.HidePageLoader(),this.ButtonsNode.classList.remove("locked"),this.Ready=!0}_loadTemplate(){this.FormData=!1,this.ButtonData=[];var e,t=this.CleverForms.GetTemplateGuid(),i=function(){window.removeEventListener("FormGotTemplate",i),this.FormData&&this._processTemplate()}.bind(this);window.addEventListener("FormGotTemplate",i),t&&(e=this.CleverForms.GetTemplateApi+"?templateId="+t,axios({method:"get",url:e}).then(function(e){if(e&&(Affinity2018.isArray(e.data)||Affinity2018.isObject(e.data)))return e.data.hasOwnProperty("elementTemplateMerged")&&$a.isArray(e.data.elementTemplateMerged)&&(this.FormData=e.data.elementTemplateMerged,window.dispatchEvent(new Event("FormGotTemplate"))),void(e.data.hasOwnProperty("Data")&&$a.isArray(e.data.Data)&&(this.FormData=e.data.Data,window.dispatchEvent(new Event("FormGotTemplate"))));this._loadTemplateError()}.bind(this)).catch(function(e){console.warn(e),this._loadTemplateError()}.bind(this)))}_loadTemplateError(){var e=$a.Lang.ReturnPath("app.cf.form.error_template_get_fail");Affinity2018.HidePageLoader(),Affinity2018.LogError("Form Error","Critical","Could not load form data. Form init failed."),Affinity2018.Dialog.Show({message:e,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{show:!1}}})}_processTemplate(){if(Affinity2018.isArray(this.FormData)){var e,t=!1;this.FormData.sort(this._sortByRank),this.FormData.reverse(),this.FormData.forEach(function(i){"Section"===i.ElementType&&(e=this.Add("Section",i,this.FormNode))&&i.hasOwnProperty("Elements")&&Affinity2018.isArray(i.Elements)&&i.Elements.length>0&&(i.Elements.sort(this._sortByRank),i.Elements=i.Elements.reverse(),i.Elements.forEach(function(i){"Section"!==i.ElementType&&(this.Add(i.ElementType,i,e.querySelector(".default-form")),Affinity2018.isPropObject(i,"Details")&&i.Details.Required&&(t=!0))}.bind(this)))}.bind(this))}t&&(this.RequiredMessageNode.classList.remove("hidden"),this.UserInstructionsNode.classList.remove("hidden")),this._getWorkflowButtons()}_loadInstance(){this.FormData=!1,this.ButtonData=[];var e,t=this.CleverForms.GetInstanceGuid(),i=function(){window.removeEventListener("FormGotTemplate",i),this.FormData&&this._processInstance()}.bind(this);window.addEventListener("FormGotTemplate",i),t&&(e=this.CleverForms.GetInstanceApi+"/"+t,axios({method:"get",url:e}).then(function(e){e&&(Affinity2018.isArray(e.data)||Affinity2018.isObject(e.data))?e.data.hasOwnProperty("Data")&&$a.isArray(e.data.Data)&&(this.TemplateData=e.data.Template,this.FormData=e.data.Data,this.ButtonData=e.data.hasOwnProperty("Actions")?e.data.Actions:[],this.HistoryData=e.data.hasOwnProperty("History")?e.data.History:[],window.dispatchEvent(new Event("FormGotTemplate"))):this._loadInstanceError()}.bind(this)).catch(function(e){console.warn(e),this._loadInstanceError()}.bind(this)))}_loadInstanceError(){var e=$a.Lang.ReturnPath("app.cf.form.error_template_get_fail");Affinity2018.HidePageLoader(),Affinity2018.LogError("Form Error","Critical","Could not load form data. Form init failed."),Affinity2018.Dialog.Show({message:e,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{show:!1}}})}_processInstance(){if(Affinity2018.isArray(this.FormData)){var e,t=!1;this.FormData.sort(this._sortByRank),this.FormData.reverse(),this.FormData.forEach(function(i){"Section"===i.ElementType&&(e=this.Add("Section",i,this.FormNode))&&i.hasOwnProperty("Elements")&&Affinity2018.isArray(i.Elements)&&i.Elements.length>0&&(i.Elements.sort(this._sortByRank),i.Elements=i.Elements.reverse(),i.Elements.forEach(function(i){"Section"!==i.ElementType&&("ViewOnly"===this.ViewType&&"AffinityField"===i.ElementType&&(i.Details.AffinityField.Mode=this.CleverForms.AffnityFieldModeTypes.Display.Enum,i.Details.AffinityField.IsRequired=!1,i.Details.AffinityField.IsReadOnly=!0,i.Details.Required=!1,i.Details.IsReadOnly=!0),"ViewOnly"===this.ViewType&&"AffinityField"!==i.ElementType&&(i.Details.IsReadOnly=!0,i.Details.Required=!1),this.Add(i.ElementType,i,e.querySelector(".default-form")),Affinity2018.isPropObject(i,"Details")&&i.Details.Required&&(t=!0))}.bind(this)))}.bind(this))}if(t&&(this.RequiredMessageNode.classList.remove("hidden"),this.UserInstructionsNode.classList.remove("hidden")),this.TemplateData){var i=this.TemplateData.Description,s=this.TemplateData.Description;$a.isNullOrEmpty(this.TemplateData.Revision)||(s+=" <small>V "+this.TemplateData.Revision+"</small>",i+="  v"+this.TemplateData.Revision),document.querySelector(".form-name").innerHTML=s,document.title="Edit "+i,$a.isNullOrEmpty(this.TemplateData.UserInstructions)||(document.querySelector(".form-instructions").innerHTML=this.TemplateData.UserInstructions)}["Form","ViewOnly"].contains(this.ViewType)?this._getWorkflowButtons():this._ready()}_processHistory(){var e,t;this.HistoryNode&&Affinity2018.isArray(this.HistoryData)&&this.HistoryData.length>0&&(this.HistoryData.forEach(function(i,s){e=document.createElement("div"),t=this.historyTemplate.format({ActionTaken:i.ActionTaken,AssigneeName:i.AssigneeName,Comment:null===i.Comment?"":i.Comment,OriginatorName:i.OriginatorName,Date:$a.getDate(i.EnteredAtUtc,"dd.MM.yyyy"),Time:$a.getDate(i.EnteredAtUtc,"h:mma").toLowerCase()}),e.innerHTML=t,i.Originator!==i.Assignee&&e.querySelector(".history-to").classList.remove("hidden"),$a.isString(i.Comment)&&""!==i.Comment.trim()&&e.querySelector(".history-comment").classList.remove("hidden"),this.HistoryNode.querySelector(".section-body").appendChild(e)}.bind(this)),this.HistoryNode.classList.remove("hidden"))}_getWorkflowButtons(){var e=[];if("Form"===this.ViewType)if(this.SaveButtonData={Name:"Save Form",Name:$a.Lang.ReturnPath("application.cleverfroms.designer.save_button"),Type:"FormButton",ActionType:"save",DestinationStateId:"",SateType:0,Identities:[],Color:"dark-green",Icon:"save",Path:null,visible:!0},e.push(this.SaveButtonData),this.ButtonData.length>0){e.push({});var t=null,i=null;this.ButtonData.forEach((function(s,o){var a={Name:s.hasOwnProperty("Name")?s.Name:"Unknown",Type:"WorkflowButton",ActionType:"post",DestinationStateId:s.hasOwnProperty("DestinationStateId")?s.DestinationStateId:"",SateType:s.hasOwnProperty("StateType")?s.StateType:0,Identities:s.hasOwnProperty("Identities")?s.Identities:[],Color:s.hasOwnProperty("Name")?"green":"light-grey",Icon:s.hasOwnProperty("Name")?"paperplane":"cancel",Path:null,visible:!0};for(var n in s)s.hasOwnProperty(n)&&(a.hasOwnProperty(n)||(a[n]=s[n]));s.Name.toLowerCase().contains("cancel")?(a.Color="light-grey",a.Icon="blocked",t=a):s.Name.toLowerCase().contains("decline")?(a.Color="red",a.Icon="cross",i=a):e.push(a)})),null!==t&&e.push(t),null!==i&&e.push(i),null===t&&null===i||e.push({})}else e.push({Type:"WorkflowButton",Name:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_validation_button"),DestinationStateId:"",SateType:0,ActionType:"post",Color:"green",Icon:"tick",Path:null,visible:!0});"Preview"===this.ViewType&&(this.SaveButtonData={Name:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_validation_button"),Type:"FormButton",ActionType:"post",DestinationStateId:"",SateType:0,Identities:[],Color:"green",Icon:"save",Path:null,visible:!0},e.push(this.SaveButtonData)),e.push({Type:"Button",DestinationStateId:"",SateType:0,ActionType:"print",Name:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_print_button"),Color:"dark-blue",Icon:"print",Path:null,visible:!0});var s={Type:"Button",DestinationStateId:"",SateType:0,ActionType:"back",Name:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_back_button"),Color:"blue",Icon:"arrow-left",Path:null,visible:!0};""!==document.referrer?null!==window.opener?(s.Name=$a.Lang.ReturnPath("generic.buttons.close"),s.Color="orange",s.Icon="cross",s.Path=null):(s.Name=$a.Lang.ReturnPath("generic.buttons.back"),s.Color="blue",s.Icon="arrow-left",s.Path=null):(["Preview"].contains(this.ViewType)&&(s.Name=$a.Lang.ReturnPath("application.cleverfroms.designer.designer_back_button"),s.Color="blue",s.Icon="brush",s.Path=null),["Form","ViewOnly"].contains(this.ViewType)&&(s.Name=$a.Lang.ReturnPath("application.cleverfroms.designer.inbox_back_button"),s.Color="blue",s.Icon="empty-inbox",s.Path=null)),e.push(s),this._gotWorkflowButtons(e)}_gotWorkflowButtons(e){if($a.isArray(e)&&e.length>0){var t,i,s,o,a,n=document.createElement("div");e.forEach(function(e){if(0===Object.keys(e).length&&null!==t)(o=document.createElement("div")).classList.add("splitter"),t.appendChild(o);else{if(i="button-"+$a.uuid(),null===e.Path?(s=this.buttonTemplate.format(e),n.innerHTML=s,o=n.querySelector("div")):(e.hasOwnProperty("Target")||(e.Target="_self"),s=this.buttonLinkTemplate.format(e),n.innerHTML=s,o=n.querySelector("a")),t=this.ButtonsNode.querySelector(".section-body .buttons"),["FormButton","WorkflowButton"].contains(e.Type)&&!["blocked","cross"].contains(e.Icon)&&(t=this.ButtonsNode.querySelector(".section-body .workflow-buttons")),e.id=i,o.dataset.id=i,"save"===e.ActionType&&o.addEventListener("click",this._save),"post"===e.ActionType&&o.addEventListener("click",this._submit),"print"===e.ActionType&&o.addEventListener("click",this._print),"back"===e.ActionType&&o.addEventListener("click",this._close),t.appendChild(o),"WorkflowButton"===e.Type&&e.Identities){var r,l=document.createElement("div");1===e.Identities.length?(l.innerHTML=this.buttonSingleListTemplate.format({guid:e.Identities[0].Identifier,user:e.Identities[0].Name}),(a=l.querySelector("div")).dataset.refId=i,a.value=e.Identities[0].Identifier,t.appendChild(a),e.Identities[0].Identifier.toLowerCase()===Affinity2018.UserProfile.UserGuid.toLowerCase()&&a.classList.add("hidden")):e.Identities.length>1&&(l.innerHTML=this.buttonListTemplate,a=l.querySelector("div"),e.Identities.forEach((function(e){e.hasOwnProperty("Name")&&e.hasOwnProperty("Identifier")&&""!==e.Name.trim()&&""!==e.Identifier.trim()&&((r=document.createElement("option")).innerHTML=e.Name,r.value=e.Identifier,e.Identifier===Affinity2018.UserProfile.UserGuid&&(r.selected=!0),a.querySelector("select").appendChild(r))})),a.querySelector("select").addEventListener("change",this._checkIdentitySelects),a.querySelector("select").dataset.refId=i,t.appendChild(a),e.Identities[0].Identifier.toLowerCase()===Affinity2018.UserProfile.UserGuid.toLowerCase()&&a.classList.add("hidden"))}o.dataset.id=i,o.buttonData=e,"a"===o.tagName.toLowerCase()&&((["{target}","#"].contains(o.target)||""===o.target)&&o.removeAttribute("target"),(["{Path}","#"].contains(o.href)||""===o.href)&&o.removeAttribute("href"))}}.bind(this)),n.innerHTML="",n=null,this.ButtonsNode.classList.remove("hidden"),this._checkIdentitySelects()}this._ready()}_getWorkflowButtonsFailed(){Affinity2018.HidePageLoader()}_checkIdentitySelects(){var e=!1,t=document.querySelectorAll(".identity");t.length>0&&t.forEach((function(t){t.value!==Affinity2018.UserProfile.UserGuid&&(e=!0)})),e&&this._showComments()}_showComments(){if(this.Ready&&$a.isNode(this.CommentNode)){var e=setInterval((function(){window.scrollTo(0,document.body.scrollHeight)}),30);this.CommentNode.classList.remove("hide"),setTimeout((function(){clearInterval(e)}),500)}}_hideComments(){$a.isNode(this.CommentNode)&&this.CommentNode.classList.add("hide")}_submit(e){$a.isEvent(e)&&$a.stopEvent(e);var t,i,s,o,a=$a.getEventNode(e,"button").buttonData,n={row:!1,index:999999},r={row:!1,index:999999},l=!1,d=0;$a.ShowPageLoader(),document.querySelectorAll(".form-row.error").forEach((function(e){e.classList.remove("error","flash-error")})),document.querySelectorAll(".form-row.required").forEach((function(e,a){var l=!1;if(t=e.querySelector("input,select,textarea"),i=t.closest(".form-row"),t&&!i.classList.contains("hidden")){if(t.hasOwnProperty("widgets")){var h=t.widgets;for(s in t.widgets.hasOwnProperty("TaxNumber")?h={TaxNumber:t.widgets.TaxNumber}:t.widgets.hasOwnProperty("Address")&&(h={Address:t.widgets.Address}),h)t.widgets.hasOwnProperty(s)&&(o=t.widgets[s])&&(o.hasOwnProperty("Valid")&&$a.isBool(o.Valid)?(o.hasOwnProperty("IsValid")&&$a.isMethod(o.IsValid)&&o.IsValid(),o.Valid||(l=!0,e.classList.add("error"),e.closest(".section").classList.contains("collapsed")&&(e.closest(".section").classList.remove("collapsed"),d=.25),n.row||(n.row=e,n.index=a))):e.querySelector('input[type="file"]')&&0===o.GetFiles().length&&(l=!0,e.classList.add("error"),n.row=e,n.index=a))}else $a.isMethod(e.controller.IsValid)&&(e.controller.IsValid()||(l=!0,e.classList.add("error"),e.closest(".section").classList.contains("collapsed")&&(e.closest(".section").classList.remove("collapsed"),d=.25),n.row||(n.row=e,n.index=a)));if(!l&&e.classList.contains("required")&&(!l&&e.querySelectorAll(".radio-label-pair").length>1&&(e.querySelector(".radio-label-pair input:checked")||(l=!0,e.classList.add("error"),e.closest(".section").classList.contains("collapsed")&&(e.closest(".section").classList.remove("collapsed"),d=.25),a<n.index&&(n.row=e,n.index=a),a<r.index&&(r.row=e,r.index=a))),!l&&e.querySelectorAll(".check-label-pair").length>1&&(e.querySelector(".check-label-pair input:checked")||(l=!0,e.classList.add("error"),e.closest(".section").classList.contains("collapsed")&&(e.closest(".section").classList.remove("collapsed"),d=.25),a<n.index&&(n.row=e,n.index=a),a<r.index&&(r.row=e,r.index=a))),!l&&e.querySelector('input:not([type="checkbox"]):not([type="radio"]),textarea,select'))){var c="",u=!1;e.querySelector(".select.hidden:not(.no-validate)")?(c=e.querySelector(".select.hidden select:not(.no-validate)").value,u=!0):e.querySelector('input[type="hidden"]:not(.countrycode):not(.no-validate)')?(c=e.querySelector('input[type="hidden"]:not(.countrycode):not(.no-validate)').value,u=!0):e.querySelector('input:not([type="file"]):not(.no-validate),textarea:not(.no-validate),select:not(.no-validate)')&&(c=e.querySelector('input:not([type="file"]):not(.no-validate),textarea:not(.no-validate),select:not(.no-validate)').value,u=!0),u&&""===c.toString().trim()?(e.classList.add("error"),a<n.index&&(n.row=e,n.index=a),a<r.index&&(r.row=e,r.index=a)):e.classList.remove("error","flash-error")}}})),r.row||n.row?(r.row&&!n.row?l=r.row:n.row&&!r.row?l=n.row:r.row&&n.row&&(r.index===n.index||r.index<n.index?l=r.row:n.index<r.index&&(l=n.row)),l&&setTimeout((function(){l.classList.add("flash-error"),TweenLite.to(window,.5,{scrollTo:$a.getPosition(l).top-30})}),d),$a.HidePageLoader()):(document.querySelectorAll(".form-row.error").forEach((function(e){e.classList.remove("error","flash-error")})),"Preview"===this.ViewType?($a.Dialog.Show({message:$a.Lang.ReturnPath("application.cleverfroms.designer.preview_test_validation_message"),buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{show:!1}}}),$a.HidePageLoader(),this._getPostData()):this._post(a))}_save(e){$a.isEvent(e)&&$a.stopEvent(e);var t=$a.jsonCloneObject(this.SaveButtonData);t.Name=$a.Lang.ReturnPath("generic.buttons.save"),$a.ShowPageLoader(),this._post(t)}_getPostData(){this.PostData={Sections:[]};var e,t,i,s=[];return document.querySelectorAll("div.section.row-section").forEach(function(o){s.contains(o.controller.Name)||"Section"===o.controller.Config.Type&&(e=o.controller.GetFromFormRow(),o.querySelectorAll("div.form-row").forEach(function(o){s.contains(o.controller.Name)||"Section"!==(t=o.controller.Config).Type&&"Question"===t.ViewType&&("AffinityField"===t.Type?t.Details.AffinityField.Mode!==this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(i=o.controller.GetFromFormRow(),e.Elements.push(i)):(i=o.controller.GetFromFormRow(),e.Elements.push(i))),s.push(o.controller.Name)}.bind(this)),this.PostData.Sections.push(e)),s.push(o.controller.Name)}.bind(this)),this.PostData}_post(e,t){if(e=$a.paramOrDefault(e,{Name:"Unknown",DestinationStateId:""},"object"),this.suppressPostMessage=$a.paramOrDefault(t,!1,"boolean"),this.SubmitActionName=e.Name,this.PostData=this._getPostData(),this.PostData.InstanceId=this.CleverForms.GetInstanceGuid(),this.PostData.Comment=this.CommentInputNode.value.trim(),this.PostData.ActionName=e.Name,this.PostData.DestinationStateId=e.DestinationStateId,document.querySelector('.identity[data-ref-id="'+e.id+'"]')){var i=document.querySelector('.identity[data-ref-id="'+e.id+'"]');i.dataset.guid?this.PostData.SelectedIdentity=i.dataset.guid:this.PostData.SelectedIdentity=i.value}"Preview"!==this.ViewType&&(console.groupEnd(),console.groupCollapsed("%c✉ FORM POST ("+this.SubmitActionName+") =========================================","color:#16c1f3"),console.log(this.PostData),Affinity2018.EnablePost?axios({method:"POST",url:this.CleverForms.SubmitFormApi,data:this.PostData}).then(this._postThen).catch(this._postCatch):this._postThen({status:200,config:{data:this.PostData},data:{Success:!0,Data:[]}}))}_postThen(e){if(this.CleverForms.IsErrorPage(e)&&(console.log("_postThen Error"),console.log(this.CleverForms.GetErrorPageOutputString(e)),console.log("")),"object"==typeof e&&e.hasOwnProperty("status")){if(205===e.status)return this._postComplete(),!0;if([204,200].contains(e.status)){var t=!1;if($a.isPropObject(e,"config")&&e.config.hasOwnProperty("data")&&($a.isPropObject(e.config,"data")&&(t=e.config.data),$a.isPropString(e.config,"data")&&(t=JSON.parse(e.config.data)),console.log(JSON.stringify(t))),t){this.TestErrorStub&&(e.data=this.TestErrorStub);var i=this.CleverForms.CheckResponseForErrorPage(e.data);return"OK"===i?this._setPosted(e)?(this._postComplete(),!0):(this._postFailed(this.PostData,!1,e),!0):(this._postFailed(this.PostData,i),!0)}return this._postComplete(),!0}}return this._postFailed(this.PostData,"Unknown error"),!0}_setPosted(e){return this.PostedErrors=[],document.querySelectorAll(".form-row.error").forEach((function(e){e.classList.remove("error","flash-error")})),$a.isPropObject(e,"data")&&$a.isPropBool(e.data,"Success")&&!e.data.Success&&$a.isPropArray(e.data,"ErrorMessages")?(this.PostedErrors=e.data.ErrorMessages,!1):($a.isPropObject(e,"data")&&$a.isPropBool(e.data,"Success")&&!e.data.Success&&$a.isPropArray(e.data,"Data")&&e.data.Data.length>0&&(this.PostedErrors=e.data.Data),!(this.PostedErrors.length>0))}_postComplete(){if(console.groupEnd(),"Form"===this.ViewType&&"Save"!==this.SubmitActionName&&Affinity2018.EnablePost&&0===this.PostedErrors.length)if(Affinity2018.DashboardTemplate)Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.form.dashboard_submit"),showOk:!0,showCancel:!1,showInput:!1,textAlign:"center"});else{var e=this.CleverForms.InboxPath;window.location.hash&&(e+=window.location.hash),window.open(e,"_self").location}return"Save"===this.SubmitActionName&&this.suppressPostMessage&&Affinity2018.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.form.saved"),showOk:!0,showCancel:!1,showInput:!1,textAlign:"center"}),this.suppressPostMessage=!1,$a.HidePageLoader(),!0}_postCatch(e){var t="",i={},s="unknown error";return this.CleverForms.IsErrorPage(e)?(console.log("_postCatch Error"),console.log(this.CleverForms.GetErrorPageOutputString(e)),console.log(""),void this._postFailed(this.PostData,this.CleverForms.GetErrorPageOutputString(e))):"error"!==$a.type(e)?"object"===$a.type(e)?(e.hasOwnProperty("config")&&(i=""===(t=e.config.data)?{}:JSON.parse(t)),e.hasOwnProperty("statusText")&&(s=e.statusText),void this._postFailed(i,s)):void("string"!==$a.type(e)?this._postFailed(this.PostData,"Unknown error"):this._postFailed(this.PostData,e)):void this._postFailed(this.PostData,e.message)}_postFailed(e,t,i){console.groupEnd(),clearTimeout(this._postFailedThrottle),this._postFailedThrottle=setTimeout(function(){var s=!0;t?this.CleverForms.IsErrorPage(t)&&(t=this.CleverForms.GetErrorPageOutputString(i)):t="";var o=$a.Lang.ReturnPath("app.cf.form.error_template_post_fail",{message:t});if(null!=i&&$a.isPropObject(i,"data")&&$a.isPropBool(i.data,"Success")&&!i.data.Success)if($a.isPropArray(i.data,"ErrorMessages")){i.data.ErrorMessages.length>0&&(this.PostedErrors=i.data.ErrorMessages),o=0===this.PostedErrors.length?$a.Lang.ReturnPath("app.cf.form.error_template_post_fail_with_error"):$a.Lang.ReturnPath("app.cf.form.error_template_post_fail_with_errors")+"<br>"+this.PostedErrors.join("<br>");var a="",n="",r=[];for(var l in i.data)if(i.data.hasOwnProperty(l)&&!["Success","ErrorMessages"].contains(l)&&$a.isArray(i.data[l])&&i.data[l].length>0){var d=l.toLowerCase().trim();$a.Lang.CheckPath("app.cf.generic_errors."+d)&&(a=$a.Lang.ReturnPath("app.cf.generic_errors."+d)),""!=a&&(o+="<br><br>"+a),$a.Lang.CheckPath("app.cf.generic_errors."+d+"_suffix")&&(n=$a.Lang.ReturnPath("app.cf.generic_errors."+d+"_suffix"));for(var h=0;h<i.data[l].length;h++)if(i.data[l][h].hasOwnProperty("ModelName")){var c=i.data[l][h].ModelName.toLowerCase();$a.Lang.CheckPath("app.cf.backend_sub_names."+c)?r.push($a.Lang.ReturnPath("app.cf.backend_sub_names."+c)):r.push(c.toTitleCase())}}if(i.data.ErrorMessages.length>0||r.length>0){var u="&nbsp;&nbsp;&nbsp;&nbsp;";if(r.length>0){o+="<br>";var p=u+r.join("<br>"+u);if(r.length>11){var f=r.slice(0,10);f.push("..."),f.push(r[r.length-1]),p='<div class="indent">'+(r=f).join(", ")+"</div>"}o+=p}r.length>0&&""!==n&&(o+="<br><br>"+n),0===r.length&&""!==n&&(o+="<br>"+n),t=o,s=!1}}else if($a.isPropArray(i.data,"Data")&&i.data.Data.length>0){if(this.PostedErrors=i.data.Data,o=0===this.PostedErrors.length?$a.Lang.ReturnPath("app.cf.form.error_template_post_fail_with_error"):$a.Lang.ReturnPath("app.cf.form.error_template_post_fail_with_errors"),this.PostedErrors.length>=2){for(var m=new RegExp(/^(.*)\s?[.,:]{1}$/m),y=0;y<this.PostedErrors.length;y++)m.test(this.PostedErrors[y])&&(this.PostedErrors[y]=this.PostedErrors[y].substr(0,this.PostedErrors[y].length-1));var g=this.PostedErrors[this.PostedErrors.length-1];g=g[0].toLowerCase()+g.substr(1);var v=$a.jsonCloneObject(this.PostedErrors);v.splice(v.indexOf(g),1),o+=v.join(",<br>"),o+=",<br>And, "+g+"<br><br>"}else o+=this.PostedErrors[0];t=o,s=!1}Affinity2018.Dialog.Show({message:o,showOk:!0,showCancel:!1,showInput:!1,canBackgroundClose:!1,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:$a.Lang.ReturnPath("generic.buttons.ok")},cancel:{show:!1}}}),s&&e&&$a.isObject(e)&&!$a.isEmptyObject(e)&&console.error(e),s&&console.error("Form Post ({0})\nError:\n{1}\n ".format(this.SubmitActionName,t.replace(/\<br\>/g,"\n").replace(/\&nbsp\;/g," "))),$a.HidePageLoader()}.bind(this),500)}_print(e){$a.isEvent(e)&&$a.stopEvent(e),window.print()}_close(e){var t,i;return $a.isEvent(e)&&$a.stopEvent(e),""!==document.referrer?null===window.opener?(i=document.referrer,window.location.hash&&(i+=window.location.hash),void window.open(i,"_self").location):void window.close():"Preview"===this.ViewType&&(t=this.CleverForms.GetTemplateGuid())?(i=this.CleverForms.DesignerPath+"?templateId="+t,window.location.hash&&(i+=window.location.hash),void window.open(i,"_self").location):"Form"===this.ViewType&&this.CleverForms.GetInstanceGuid()?(i=this.CleverForms.InboxPath,window.location.hash&&(i+=window.location.hash),void window.open(i,"_self").location):void 0}_sortByRank(e,t){return e.Rank>t.Rank?-1:e.Rank<t.Rank?1:0}_templates(){this.formStartTemplate='\n    <div class="form-starter hidden">\n      <form action="/Inbox/Create" method="post" target="_blank">\n      <input type="hidden" name="templateAndWorkflowIds" value="" />\n      Or start <button type="submit">...</button> form.\n      </form>\n    <div>\n    ',this.buttonTemplate='\n    <div class="button {Color}" data-type="{Type}">\n      <icon class="icon-{Icon}"></icon>{Name}\n    </div>\n    ',this.buttonLinkTemplate='\n    <a href="{Path}" target="{Target}" class="button {Color}" data-type="{Type}">\n      <icon class="icon-{Icon}"></icon>{Name}\n    </a>\n    ',this.buttonListTemplate='\n    <div class="button-list">\n      <span>To</span>\n      <div class="select">\n        <select class="ui-has-autocomplete ui-autocomplete-force-top identity-list identity"></select>\n      </div>\n    </div>\n    ',this.buttonSingleListTemplate='\n    <div class="button-list identity" data-guid="{guid}">\n      <span>To</span>{user}\n    </div>\n    ',this.historyTemplate='\n    <span class=history-date">On <strong>{Date}</strong> at {Time},</span>\n    <strong>{OriginatorName}</strong> selected <strong>{ActionTaken}</strong>\n    <span class="history-to hidden"> to {AssigneeName}</span>\n    <span class="history-comment hidden">, with comment: <em>{Comment}</em></span>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase=class extends Affinity2018.ClassEvents{_options(){this.Type=null,this.SectionName=null,this.Saved=!1,this.Changed=!0,this.Changes=[],this.Delete=!1,this.Ready=!1,this.Designer=!1,this.DesignerNode=!1,this.FormRowNode=!1,this.FormNode=!1,this.BlankLabelSetToDefault=!1,this.ConfigStringCheck="",this.ConfigBackup=null,this.Plugins={Address:".ui-address",Autocompletes:".ui-autocomplete",BankNumber:".ui-banknumber",Calendars:".ui-calendar",DrawPanel:".ui-drawpanel",Numbers:".nv",SelectLookups:".ui-lookup",Strings:".sv",TaxNumber:".ui-taxnumber"}}constructor(e){if(super(),["Hide","SetSection","BackupConfig","RestoreBackup","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","InsertRow","InsertEditForm","InsertEditExample","InsertFormRow","SetFormRow","GetFromFormRow","SetFromValue","SetPosted","HasChanged","HasSaved","ReturnChanges","CheckChanges","CheckLabelOverflow","_getFileIds","_setupFileNode","_fileResized","_fileUploaded","_fileDeleted","_fileDeleteFailed","_fileWidgetReady","_listSourceChanged","_gotNewSourceList","_gotNewSourceListFail","_listBuilderModified","_options","_templates"].bindEach(this),this._options(!0),this._templates(),!e||!Affinity2018.isObject(e))return Affinity2018.ThrowError("No Config","critical","Form element has no config"),!1;this.Config=Affinity2018.objectDeepMerge({},e),Affinity2018.isEmptyObject(e)||(this.CleverForms=Affinity2018.Apps.CleverForms.Default,this.Designer=void 0!==Affinity2018.Apps.CleverForms.Designer&&Affinity2018.Apps.CleverForms.Designer,this.Type=this.Config.Type,this.Config.Name?(this.UniqueName=this.Config.Name,this.Name=this.Config.Name):(this.UniqueName=this.Type+"-"+$a.uuid(),this.Name=this.UniqueName,this.Config.Name=this.Name),"Section"===this.Type&&(this.SectionName=this.Name),this.Rank=this.Config.Details.Rank,this.IsReadOnly=!1,this.Config.Details.hasOwnProperty("IsReadOnly")&&$a.isBool(this.Config.Details.IsReadOnly)&&(this.IsReadOnly=this.Config.Details.IsReadOnly),!this.DesignerNode&&document.querySelector(".item-"+this.UniqueName)&&(this.DesignerNode=document.querySelector(".item-"+this.UniqueName)),this.ItemSourcesTemplate=this.ItemSourcesTemplate.format({listLabel:$a.Lang.ReturnPath("generic.list_builder.list_label"),listCustom:$a.Lang.ReturnPath("generic.list_builder.custom_label")}))}Hide(){this.DesignerNode||(this.DesignerNode=document.querySelector(".item-"+this.UniqueName)),this.DesignerNode?this.DesignerNode.classList.add("hidden"):console.log("hide what??? ("+this.UniqueName+")")}SetSection(){if(void 0!==Affinity2018.Apps.CleverForms.Designer&&(this.Designer=Affinity2018.Apps.CleverForms.Designer),this.DesignerNode||(this.DesignerNode=document.querySelector(".item-"+this.UniqueName)),this.DesignerNode){var e=this.Designer.GetElementSectionNode(this.DesignerNode),t=!!e&&e.dataset.name;t&&this.SectionName!==t&&(this.SectionName=t,this.Changed=!0)}}BackupConfig(){return this.ConfigBackup=$a.jsonCloneObject(this.Config),!0}RestoreBackup(){return null!==this.ConfigBackup&&(this.Config=$a.jsonCloneObject(this.ConfigBackup)),this.ConfigBackup=null,!0}SetDesignEditor(){var e,t=this.Config.hasOwnProperty("Details")?this._isNullOrEmpty(this.Config.Details.Label)?this.Config.Label:this.Config.Details.Label:"",i=this.Config.hasOwnProperty("Details")?this.Config.Details.HelpText:null;if(""===t&&(t=this.Config.Label),this.PopupNode=document.querySelector(".cf-designer-element-popup"),this.EditNode=document.querySelector(".cf-designer-element-popup"),this.SearchViewNode=this.PopupNode.querySelector(".search"),this.SettingsViewNode=this.PopupNode.querySelector(".settings"),this.LabelNode=this.PopupNode.querySelector(".label-row"),this.HelptextNode=this.SettingsViewNode.querySelector(".helptext-row"),this.PreviewNode=this.PopupNode.querySelector(".example-template"),this.PreviewToggleNode=this.PreviewNode.querySelector(".toggle-preview"),this.PreviewBoxNode=this.PreviewNode.querySelector(".preview"),this.TemplateNode=this.SettingsViewNode.querySelector(".edit-template"),this.FiltersNode=this.SettingsViewNode.querySelector(".filters"),this.FilterRadiosBoxNode=this.FiltersNode.querySelector(".radios"),this.RequiredBoxNode=this.SettingsViewNode.querySelector(".edit-required"),this.BackButtonNode=this.SettingsViewNode.querySelector(".button.back"),this.DesignerNode||(this.DesignerNode=document.querySelector(".item-"+this.UniqueName)),this.TemplateNode.classList.add("hidden"),this.HtmlEditTemplate&&""!==this.HtmlEditTemplate.trim()){var s=this.HtmlEditTemplate.trim().format({filterlabel:$a.Lang.ReturnPath("app.cf.design_items.filter_label"),linkmessage:$a.Lang.ReturnPath("app.cf.design_items.link_message"),selectlabel:$a.Lang.ReturnPath("app.cf.design_items.link_select_label"),sectionHidetitleLable:$a.Lang.ReturnPath("app.cf.design_items.section_hide_title_lebel"),sectionCollapseLable:$a.Lang.ReturnPath("app.cf.design_items.section_collapse_lebel"),listLabel:$a.Lang.ReturnPath("generic.list_builder.list_label"),listCustom:$a.Lang.ReturnPath("generic.list_builder.custom_label")});this.TemplateNode.innerHTML=s,this.TemplateNode.classList.remove("hidden")}return this.LabelNode.classList.add("hidden"),this.HelptextNode.classList.add("hidden"),this.Config&&"Layout"!==this.Config.ViewType&&(this.LabelNode.classList.remove("hidden"),this.HelptextNode.classList.remove("hidden")),this.Config&&"Link"===this.Config.Type&&this.LabelNode.classList.remove("hidden"),this.FilterRadiosBoxNode.classList.add("hidden"),this.BackButtonNode.classList.add("hidden"),"AffinityField"===this.Config.Type&&(this.FilterRadiosBoxNode.classList.remove("hidden"),this.BackButtonNode.classList.remove("hidden")),this.RequiredBoxNode.classList.add("hidden"),"Section"!==this.Config.Type&&this.Config.Details.hasOwnProperty("Required")&&(this.RequiredBoxNode.classList.remove("hidden"),this.RequiredBoxNode.querySelector("input").checked=!1,this.RequiredBoxNode.querySelector("input").removeAttribute("checked"),this.Config.Details.Required&&(this.RequiredBoxNode.querySelector("input").checked=!0)),this.PreviewNode.classList.add("hidden"),this.PreviewBoxNode.classList.add("hide"),this.PreviewBoxNode.innerHTML="",this.PreviewToggleNode.innerHTML="Show Example",this.hasOwnProperty("HtmlEditExampleTemplate")&&""!==this.HtmlEditExampleTemplate.trim()&&(this.PreviewBoxNode.innerHTML=this.HtmlEditExampleTemplate,this.PreviewNode.classList.remove("hidden")),this.FileNode=this.TemplateNode.querySelector('input[type="file"]')?this.TemplateNode.querySelector('input[type="file"]'):null,this.FileWidget=null,null!==this.FileNode&&(this._setupFileNode(),this.FileNode.hasOwnProperty("widgets")&&this.FileNode.widgets.hasOwnProperty("FileUpload")?this._fileWidgetReady():this.FileNode.addEventListener("widgetReady",this._fileWidgetReady)),this.SettingsViewNode.querySelector("h3").innerHTML=this.Config.Label,this.SettingsViewNode.querySelector("p").innerHTML=this.Config.Description,this.SettingsViewNode.querySelector("input.label").value=t,this.SettingsViewNode.querySelector("input.helptext").value=null!==i?i:"",this.ListSourceSelectNode=this.TemplateNode.querySelector("select.list-source")?this.TemplateNode.querySelector("select.list-source"):null,null!==this.ListSourceSelectNode&&(Affinity2018.Apps.Plugins.ListBuilder.Reset(),this.customList=[],$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&(this.customList=this.Config.Details.ItemSource.Items),this.CleverForms.TableTypes.forEach(function(t){t&&t.hasOwnProperty("Key")&&t.hasOwnProperty("Value")&&""!==t.Key.toString().trim()&&""!==t.Value.toString().trim()&&!t.Value.contains("DirectReport")&&!t.Value.contains("IndirectReport")&&((e=document.createElement("option")).value=t.Value.trim(),e.dataset.key=t.Key.toString().trim(),t.hasOwnProperty("Display")?e.innerHTML=t.Display:e.innerHTML=t.Value.toString().trim().splitCamelCase(),"Affinity"!==this.Config.Details.ItemSource.ItemSourceType||this.Config.Details.ItemSource.TableType!==t.Key-1&&this.Config.Details.ItemSource.TableType.toString().toLowerCase().trim()!==t.Value.toString().toLowerCase().trim()||(e.selected="selected"),this.ListSourceSelectNode.appendChild(e))}.bind(this)),[1,"Custom"].contains(this.Config.Details.ItemSourceType)&&(this.ListSourceSelectNode.value="custom"),this.Config.hasOwnProperty("Display")&&this.Config.Display.hasOwnProperty("LastCustomList")&&this.Config.Display.LastCustomList?Affinity2018.Apps.Plugins.ListBuilder.SetBackup(this.Config.Display.LastCustomList):Affinity2018.Apps.Plugins.ListBuilder.SetBackup([]),Affinity2018.Apps.Plugins.ListBuilder.Render(this.TemplateNode,this.customList,function(){this.ListSourceSelectNode.removeEventListener("change",this._listSourceChanged),this.ListSourceSelectNode.addEventListener("change",this._listSourceChanged),Affinity2018.Apps.Plugins.ListBuilder.ModifiedCallback=this._listBuilderModified,1!==this.Config.Details.ItemSourceType&&this._listSourceChanged()}.bind(this)),this.PopupNode.classList.add("large","has-list")),!0}UnsetDesignEditor(){if(null!==this.FileNode&&null!==this.FileWidget&&(this.FileNode.removeEventListener("widgetReady",this._fileWidgetReady),this.FileWidget.removeEventListener("postSuccess",this._fileUploaded),this.FileWidget.removeEventListener("deleteSuccess",this._fileDeleted),this.FileWidget.removeEventListener("deleteFailed",this._fileDeleteFailed),this.FileWidget.Destroy()),null!==this.ListSourceSelectNode&&Affinity2018.Apps.Plugins.ListBuilder.Reset(),this.TemplateNode)for(var e in this.Plugins)Affinity2018.Apps.Plugins.hasOwnProperty(e)&&this.TemplateNode.querySelector(this.Plugins[e])&&this.TemplateNode.querySelectorAll(this.Plugins[e]).forEach((function(t){Affinity2018.Apps.Plugins[e].Remove(t)}));return!0}GetFromDesignEditor(e){if(e=$a.paramOrDefault(e,!0,"boolean"),this.PopupNode=document.querySelector(".cf-designer-element-popup"),this.SettingsNode=document.querySelector(".cf-designer-element-popup"),this.Config.hasOwnProperty("Details")&&this.Config.Details.hasOwnProperty("Label")&&(this.Config.Details.Label=this.SettingsNode.querySelector("input.label").value.trim()),this.BlankLabelSetToDefault=!1,""===this.Config.Details.Label.trim()&&(this.BlankLabelSetToDefault=!0,this.Config.Details.Label=this.Config.Label),this.Config.hasOwnProperty("Details")&&this.Config.Details.hasOwnProperty("HelpText")&&(""!==this.SettingsNode.querySelector("input.helptext").value.trim()?this.Config.Details.HelpText=this.SettingsNode.querySelector("input.helptext").value.trim():this.Config.Details.HelpText=null),this.Config.Details.hasOwnProperty("Required")&&(this.Config.Details.Required=this.RequiredBoxNode.querySelector("input").checked),null!==this.ListSourceSelectNode){this.Config.Details.ItemSource.TableType=this.TemplateNode.querySelector(".list-source").value,this.Config.Details.ItemSource.ItemSourceType=["0",0].contains(this.Config.Details.ItemSource.TableType.toLowerCase().trim())?"Custom":"Affinity";var t=Affinity2018.Apps.Plugins.ListBuilder.SanatiseData(),i=Affinity2018.Apps.Plugins.ListBuilder.GetBackup();this.Config.hasOwnProperty("Display")||(this.Config.Display={}),"Custom"!==this.Config.Details.ItemSource.ItemSourceType?(this.Config.Details.ItemSource.Items=null,this.Config.Display.LastCustomList=i,this.Config.Details.ItemSource.CustomList=i):(this.Config.Details.ItemSource.Items=t,this.Config.Display.LastCustomList=t,this.Config.Details.ItemSource.CustomList=t)}if(this.DesignerNode&&(this.DesignerNode.querySelector(".label").innerHTML=this.Config.Details.Label),null!==this.FileNode&&this.FileWidget){var s=this.FileWidget.GetFiles(),o=[],a=[];s.forEach((function(e){o.push(e.FileName),a.push(e.FileId)})),this.Config.Details.FileName=o.join(","),this.Config.Details.FileId=a.join(","),this.FileWidget.HasUnsavedFiles()&&this.FileWidget.PostFiles()}return this.Config.hasOwnProperty("Name")||(this.Config.Name=this.Name),this.Config.Details.hasOwnProperty("Rank")||(this.Config.Details.Rank=-99),this.Saved||(this.Changed=!0),this.CheckChanges(e),this.Config}RemoveDesignerElement(){var e=document.querySelector(".item-"+this.UniqueName);return!!e&&(e.parentNode.removeChild(e),!0)}SetFormRow(e,t){var i=this.Config.Details.IsReadOnly,s=!1;"AffinityField"===this.Config.Type&&this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(i=!0),"AffinityField"===this.Config.Type&&this.Config.Disabled&&(i=!0),"AffinityField"===this.Config.Type&&this.Config.Hidden&&(s=!0),this.IsReadOnly=i,this.IsHidden=s;var o=document.createElement("div");o.innerHTML=t,this.FormRowNode=o.querySelector("div"),this.FormRowNode.dataset.name=this.UniqueName,this.FormRowNode.dataset.type=this.Config.Type,this.FormRowNode.controller=this,e.appendChild(this.FormRowNode),o=null,this.FormRowNode.classList.add("row-"+this.Config.Type.toLowerCase().trim().replace(/ /g,"-")),s&&this.FormRowNode.classList.add("hidden");var a,n,r=[];if($a.isPropObject(this.Config,"Details")&&($a.isPropString(this.Config.Details,"HelpText")&&""!==this.Config.Details.HelpText.trim()&&r.push(this.Config.Details.HelpText.trim()),this.Config.Details.Required&&($a.isPropString(this.Config.Details,"ValidationString")&&""!==this.Config.Details.ValidationString.trim()?r.push(this.Config.Details.ValidationString):r.push(this.Config.Details.Label+" is required"))),this.FormRowNode.querySelector("label")){if(this.FormRowNode.querySelector("label").innerHTML=this.Config.Details.Label,$a.isPropString(this.Config.Details,"HelpText")&&""!==this.Config.Details.HelpText.trim()&&((a=document.createElement("span")).className="help icon-help-round",a.dataset.tooltip=this.Config.Details.HelpText.trim(),a.dataset.tooltipDir="top-right",a.classList.add("ui-has-tooltip"),this.FormRowNode.classList.add("hashelp"),this.FormRowNode.querySelector("label").appendChild(a)),this.Config.Details.Required&&!i){var l="required-message required";document.querySelector(".required-message .required")&&(l=document.querySelector(".required-message .required").className),(n=document.createElement("span")).className=l,$a.isPropString(this.Config.Details,"ValidationString")&&""!==this.Config.Details.ValidationString.trim()?n.dataset.tooltip=this.Config.Details.ValidationString:n.dataset.tooltip=this.FormRowNode.querySelector("label").innerText.trim()+" is required",n.dataset.tooltipDir="top-right",n.classList.add("ui-has-tooltip"),this.FormRowNode.classList.add("required"),this.FormRowNode.querySelector("label").appendChild(n)}i&&this.FormRowNode.querySelector("input")&&(this.FormRowNode.querySelector("input").disabled=!0),this.CheckLabelOverflow(this.FormRowNode.querySelector("label"))}else r.length>0&&(this.FormRowNode.dataset.tooltip=r.join("<br />"),this.FormRowNode.dataset.tooltipDir="top-right",this.FormRowNode.classList.add("ui-has-tooltip"));return this.FileNode=this.FormRowNode.querySelector('input[type="file"]')?this.FormRowNode.querySelector('input[type="file"]'):null,this.FileWidget=null,null!==this.FileNode&&(this._setupFileNode(),this.FileNode.hasOwnProperty("widgets")&&this.FileNode.widgets.hasOwnProperty("FileUpload")?this._fileWidgetReady():this.FileNode.addEventListener("widgetReady",this._fileWidgetReady)),this.FormRowNode}GetFromFormRow(){return this.FormData={Name:this.Name},"Section"===this.Config.Type?this.FormData.Elements=[]:(this.FormData.ElementType=this.Config.Type,this.FormData.Value=""),this.FormData}SetFromValue(e){e=$a.isString(e)?e.trim():e.toString(),this.FormRowNode&&(this.FormRowNode.querySelector('input[type="text"]')&&(this.FormRowNode.querySelector('input[type="text"]').value=e),this.FormRowNode.querySelector('input[type="number"]')&&(this.FormRowNode.querySelector('input[type="number"]').value=e))}HasChanged(){return this.CheckChanges(!1)}HasSaved(){return this.Saved}SetPosted(){this.Saved=!0,this.Changed=!1}ReturnChanges(){this.Changes=[];var e,t,i,s,o,a,n,r=$a.jsonCloneObject(this.Config),l=""!==this.ConfigStringCheck.trim()?JSON.parse(this.ConfigStringCheck):{};if("Section"===this.Config.Type&&(r.Elements=[],l!=={}&&(l.Elements=[])),r=this.CleverForms.OrderObject(r),l=this.CleverForms.OrderObject(l),0===Object.keys(l).length)return["New Element"];var d=function(e){return e.filter((function(e){return"{"!==e.trim()&&"}"!==e.trim()&&"},"!==e.trim()&&"["!==e.trim()&&"]"!==e.trim()&&"],"!==e.trim()&&""!==e.trim()&&!e.trim().endsWith(": {")&&!e.trim().endsWith(": [")}))};if(JSON.stringify(r)!==JSON.stringify(l)){for(e=JSON.stringify(r,null,2).trim().split("\n"),t=JSON.stringify(l,null,2).trim().split("\n"),i=d(e.concat(t)).unique(),s=[],v=0;v<i.length;v++)e.contains(i[v])&&t.contains(i[v])||s.push(i[v].replace(/,/g,"").trim());for(v=0;v<s.length/2;v++)o=s[v+s.length/2],a=s[v],n=($a.isString(o)?o:"(not set)")+" -> "+a,this.Changes.contains(n)||this.Changes.push(n);if("Section"===this.Config.Type&&0===this.Changes.length){var h,c,u=r.Details.SectionWorkflowVisibilitySettings.sort(),p=l.Details.SectionWorkflowVisibilitySettings.sort(),f={},m={};for(h=0;h<u.length;h++)f[(c=this.CleverForms.OrderObject(u[h])).WorkflowDefinitionId]={name:c.WorkflowDefinitionName,lines:d(JSON.stringify(c,null,2).trim().split("\n"))};for(h=0;h<p.length;h++)m[(c=this.CleverForms.OrderObject(p[h])).WorkflowDefinitionId]={name:c.WorkflowDefinitionName,lines:d(JSON.stringify(c,null,2).trim().split("\n"))};if(Object.keys(f).join(",")!==Object.keys(m).join(","))n="Workflow config changed",this.Changes.contains(n)||this.Changes.push(n);else{var y=Object.keys(f);for(h=0;h<y.length;h++)for(var g=y[h],v=0;v<f[g].lines.length;v++){var A=f[g].lines[v].trim(),w=m[g].lines[v].trim();A!==w&&(n="Workflow "+(o="("+m[g].name+") "+w)+" -> "+(a=A),this.Changes.contains(n)||this.Changes.push(n))}}}}return this.Changes}CheckChanges(e){return e=$a.paramOrDefault(e,!0),this._checkChanges(e)}_getFileIds(){var e;return e=void 0===Affinity2018.Apps.CleverForms.Designer?null==this.Config.Details.Value?[]:$a.isStringifiedObject(this.Config.Details.Value)?$a.stringToObject(this.Config.Details.Value):this.Config.Details.Value:[this.Config.Details.FileId],$a.isString(e)&&e.contains(",")&&(e=e.split(",")),$a.isString(e)&&!e.contains(",")&&(e=[e]),$a.isArray(e)||(e=[]),e}_setupFileNode(){if(this.FileNode){var e=this._getFileIds();this.FileNode.dataset.fileIds=e.removeEmpty().removeDuplicates().join(","),this.FileNode.dataset.fileNames=[],this.FileNode.dataset.getApi=this.CleverForms.FileGetApi,this.FileNode.dataset.getIdParam="fileIds",$a.setObjectToDataset(this.FileNode,"getParams",{fileIds:[]}),this.FileNode.dataset.getInfoApi=this.CleverForms.FileGetInfoApi,this.FileNode.dataset.getInfoIdParam="fileIds",$a.setObjectToDataset(this.FileNode,"getInfoParams",{fileIds:[]}),this.FileNode.dataset.downloadApi=this.CleverForms.FileGetApi,this.FileNode.dataset.downloadIdParam="documentId",$a.setObjectToDataset(this.FileNode,"downloadParams",{documentId:""}),this.FileNode.dataset.postApi=!1,$a.setObjectToDataset(this.FileNode,"postParams",{fileTag:!1===this.CleverForms.GetTemplateGuid()?this.CleverForms.GetInstanceGuid():this.CleverForms.GetTemplateGuid(),questionName:this.Config.Name,securityLevel:this.Config.Details.SecurityLevel}),void 0===Affinity2018.Apps.CleverForms.Designer?(this.FileNode.dataset.deleteApi=this.CleverForms.FileDeleteApi,this.FileNode.dataset.deleteIdParam="fileId",$a.setObjectToDataset(this.FileNode,"deleteParams",{fileId:[],instanceId:this.CleverForms.GetInstanceGuid(),questionName:this.Config.Name})):(this.FileNode.dataset.deleteApi=this.CleverForms.FileDeleteApi,this.FileNode.dataset.deleteIdParam="fileId",$a.setObjectToDataset(this.FileNode,"deleteParams",{fileId:[]})),this.FileNode.dataset.allowMultiple=!1,$a.isPropBool(this.Config.Details,"AllowMultiple")&&(this.FileNode.dataset.allowMultiple=this.Config.Details.AllowMultiple),$a.isPropString(this.Config.Details,"RestrictTypes")&&Affinity2018.FileTypeGroupData.hasOwnProperty(this.Config.Details.RestrictTypes)&&(this.FileNode.dataset.allowTypes=Affinity2018.FileTypeGroupData[this.Config.Details.RestrictTypes].Name)}}_fileUploaded(e){var t=[],i=[];e&&"detail"in e&&"dispatchObject"in e.detail&&(t=e.detail.dispatchObject.FileId,$a.isString(t)&&(t=t.split(","))),t=t.map((function(e){return e+""})),this.CleverForms.hasOwnProperty("Designer")&&null!==this.Config.Details.FileId&&""!==this.Config.Details.FileId&&(i=this.Config.Details.FileId.split(",")),this.CleverForms.hasOwnProperty("Form")&&(i=this.Config.Details.Value),$a.isString(i)&&(i=(i=i.split(",")).map((function(e){return e+""}))),i=i.concat(t).removeDuplicates().removeEmpty(),this.CleverForms.hasOwnProperty("Designer")&&(this.Config.Details.FileId=i.join(","),this.CleverForms.Designer.Save([this.DesignerNode])),this.CleverForms.hasOwnProperty("Form")&&(this.Config.Details.Value=i,this.CleverForms.Form.ResizeSection(this.FormRowNode))}_fileDeleted(e){var t,i,s=[];e&&"detail"in e&&"dispatchObject"in e.detail&&(s=e.detail.dispatchObject.FileId,$a.isString(s)&&(s=s.split(","))),s=(s=s.map((function(e){return e+""}))).removeDuplicates().removeEmpty(),this.CleverForms.hasOwnProperty("Designer")&&(t=this.Config.Details.FileId.split(",")),this.CleverForms.hasOwnProperty("Form")&&(t=this.Config.Details.Value),$a.isString(t)&&(t=t.split(",")),t=(t=t.map((function(e){return e+""}))).removeDuplicates().removeEmpty();for(i=0;i<s.length;i++)t.contains(s[i])&&t.splice(t.indexOf(s[i]),1);this.CleverForms.hasOwnProperty("Designer")&&(this.Config.Details.FileId=t.join(","),this.CleverForms.Designer.Save([this.DesignerNode])),this.CleverForms.hasOwnProperty("Form")&&(this.Config.Details.Value=t,this.CleverForms.Form.ResizeSection(this.FormRowNode))}_fileDeleteFailed(e){var t="Oops! Something went wrong deleting this file.";e&&"detail"in e&&"Success"in e.detail&&!e.detail.Success&&(t="You are not allowed to delete this file."),$a.HidePageLoader(),Affinity2018.Dialog.Show({message:t,showCancel:!1,buttons:{ok:{text:"Ok"}}})}_fileResized(){this.CleverForms.hasOwnProperty("Form")&&this.CleverForms.Form.ResizeSection(this.FormRowNode)}_fileWidgetReady(){null!==this.FileNode&&(this.FileWidget=this.FileNode.widgets.FileUpload,this.FileWidget&&(this.FileWidget.PostApi=this.CleverForms.FilePostApi,this.FileWidget.addEventListener("resized",this._fileResized),this.FileWidget.addEventListener("postSuccess",this._fileUploaded),this.FileWidget.addEventListener("deleteSuccess",this._fileDeleted),this.FileWidget.addEventListener("deleteFailed",this._fileDeleteFailed)))}_listSourceChanged(){var e=this.ListSourceSelectNode.value,t=this.CleverForms.GetLookupApi+"?modelName="+e;if("0"===this.ListSourceSelectNode.value)return Affinity2018.Apps.Plugins.ListBuilder.RestoreBackup(),void(this.ListSourceSelected=this.ListSourceSelectNode.value);$a.ShowPageLoader(),$a.RequestQueue.Add(t,this._gotNewSourceList,this._gotNewSourceListFail,1)}_gotNewSourceList(e){$a.isArray(e)&&$a.Apps.Plugins.hasOwnProperty("ListBuilder")?($a.Apps.Plugins.ListBuilder.ModifiedCallback=this._listBuilderModified,"custom"===this.ListSourceSelected&&$a.Apps.Plugins.ListBuilder.Backup(),$a.Apps.Plugins.ListBuilder.Render(this.TemplateNode,e),$a.Apps.Plugins.ListBuilder.ResetModified(),$a.HidePageLoader(),this.ListSourceSelected=this.ListSourceSelectNode.value):"string"===$a.type(e)?this._gotNewSourceListFail('Response is string "'+e+'" (not a list)'):this._gotNewSourceListFail("Response is not a list",e)}_gotNewSourceListFail(e,t){var i=e;t&&(i=t,"string"===$a.type(t)&&"OK"===(i=this.CleverForms.CheckResponseForErrorPage(t))&&t.length<1e3&&(i=t.trim())),console.warn("List Source Lookup failed.",i),$a.HidePageLoader()}_listBuilderModified(e){$a.Apps.Plugins.ListBuilder&&["clear","manipulation","csv"].contains(e)&&this.ListSourceSelectNode&&(this.ListSourceSelectNode.selectedIndex=0,this.ListSourceSelectNode.value="custom","widgets"in this.ListSourceSelectNode&&this.ListSourceSelectNode.widgets.hasOwnProperty("Autocomplete")&&this.ListSourceSelectNode.widgets.Autocomplete.setValue("custom",!1))}CheckLabelOverflow(e){var t=this.Config.Details.Label;if(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth){e.dataset.tooltip=t,e.dataset.tooltipDir="top-right",e.classList.add("ui-has-tooltip"),e.classList.add("overflow"),e.parentNode.classList.add("overflow");var i=e.querySelectorAll("span");if(i.length>0)for(var s=i.length-1;s>-1;s--)e.parentNode.insertBefore(i[s],e.nextSibling)}}_isNullOrEmpty(e){return null==e||"string"==typeof e&&""===e.trim()}_getErrorValue(e){var t=Affinity2018.Type(e).toLowerCase();switch(t){case"string":case"number":case"int":case"float":return e;default:return t}}_checkChanges(e){return e=$a.paramOrDefault(e,!0,"boolean"),this.ReturnChanges().length>0&&(this.Changed=!0,e&&this.CleverForms.Designer.CheckSave()),this.Changed}_templates(){this.ItemSourcesTemplate='\n    <div class="edit-row">\n      <label>{listLabel}</label>\n      <div class="select">\n        <select class="list-source ui-has-autocomplete">\n          <option value="0" selected>{listCustom}</option>\n        </select>\n      </div>\n    </div>\n    <div class="edit-row">\n      <div class="list-builder"></div>\n    </div>\n    <input type="hidden" name="ListData" />\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Address=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Address"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:this.CleverForms.ElementData.hasOwnProperty(this.Config.Type)?this.CleverForms.ElementData[this.Config.Type].Label:"Address",placeholder:$a.Lang.ReturnPath("app.cf.design_items.address_placeholder")}),!!super.SetDesignEditor()&&(this.PopupNode.classList.add("large"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);return t&&$a.isFunction(e)&&e(t),!0}}SetFormRow(e){var t=this.Config.Details.Value,i=null,s="";if($a.isObject(t)?(i=t,t=""):$a.isStringifiedObject(t)&&(i=$a.stringToObject(t),t=""),this.IsReadOnly){for(var o=[],a=Object.keys(i),n=0;n<a.length;n++)i.hasOwnProperty(a[n])&&""!==(i[a[n]]+"").trim()&&o.push((i[a[n]]+"").trim());s=this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,value:o.join(", ")})}else s=this.HtmlRowTemplate.format({label:this.Config.Details.Label,placeholder:$a.Lang.ReturnPath("app.cf.design_items.address_placeholder"),value:t});if(this.FormRowNode=super.SetFormRow(e,s),this.IsReadOnly||null===i||$a.setObjectToDataset(this.FormRowNode.querySelector("input"),"address",i),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-address").widgets.Address;return this.FormData.Value=JSON.stringify(e.GetAddressData()),this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){var t=this.FormRowNode.querySelector("input.ui-address").widgets.Address;!this.IsReadOnly&&t&&(null===e||$a.isString(e)&&(""===e.trim()||"null"===e)?t.SetAddress({Street:"",Suburb:"",City:"",State:"",Country:"",Postcode:""}):t.SetAddress(e))}_templates(){super._templates(),this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <input type="text" class="ui-has-address" data-position="fixed" placeholder="{placeholder}" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" class="ui-has-address" placeholder="{placeholder}"" value="{value}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.AffinityField=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options(),this.DoDeepDiveLogic=!1,this.EnableModeSwitching=!1,this.MaxDialogListSize=5,this.MaxDialogListTab="&nbsp;&nbsp;&nbsp;&nbsp;",this.DefaultFilterOptions={},this.FilterOptions={}}constructor(e){return super(e,"AffinityField"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","GetModelName","_filterSelected","_gotGenericList","_getGenericListFailed","_gotFormList","_getFormListFailed","_modeSelected","_continueModeSelect","_insertDesignerKey","_formRowLookupChanged","_lookupModelLoaded","_lookupModelFailed","_modelLookupChanged"].bindEach(this),this._options(),this._templates(),this.CleverForms=Affinity2018.Apps.CleverForms.Default,this}SetDesignEditor(){if(super.SetDesignEditor()){if(this.PopupNode.classList.add("large"),this.RightListNode=document.querySelector(".cf-d2-bottom-right ul"),this.PopupNode=document.querySelector(".cf-designer-element-popup"),this.SettingsViewNode=this.PopupNode.querySelector(".settings"),this.FiltersNode=this.SettingsViewNode.querySelector(".filters"),this.FilterRadiosBoxNode=this.FiltersNode.querySelector(".radios"),this.FilterModeWrapperCreate=this.FilterRadiosBoxNode.querySelector(".mode-create-wrapper"),this.FilterModeWrapperSelect=this.FilterRadiosBoxNode.querySelector(".mode-update-wrapper"),this.FilterModeWrapperEdit=this.FilterRadiosBoxNode.querySelector(".mode-edit-wrapper"),this.FilterModeWrapperDisplay=this.FilterRadiosBoxNode.querySelector(".mode-display-wrapper"),this.FilterModeWrapperHidden=this.FilterRadiosBoxNode.querySelector(".mode-hidden-wrapper"),this.FilterModeWrapperInitiator=this.FilterRadiosBoxNode.querySelector(".mode-initiator-wrapper"),this.TemplateNode=this.SettingsViewNode.querySelector(".edit-template"),this.GenericGroupNode=this.TemplateNode.querySelector(".affinity-generic-group"),this.GenericGroupSelectNode=this.GenericGroupNode.querySelector("select"),this.FormLinkNode=this.TemplateNode.querySelector(".affinity-form-link"),this.FormLinkSelectNode=this.FormLinkNode.querySelector("select"),this.RequiredBoxNode=this.SettingsViewNode.querySelector(".edit-required"),this.HiddenBoxNode=this.PopupNode.querySelector(".edit-hidden"),this.Config.Details.AffinityField.IsRequired&&this.CleverForms.IsMasterFile(this.Config)&&(this.RequiredBoxNode.classList.remove("hidden"),this.RequiredBoxNode.querySelector("input").disabled=!0),this.RequiredBoxNode.classList.remove("hidden"),this.CleverForms.IsMasterFile(this.Config)&&(this.CleverForms.PseudoGlobalElementTypes.contains(this.Config.Type)||this.CleverForms.IsGlobalKey(this.Config)||this.CleverForms.IsKey(this.Config)||this.Config.Details.AffinityField.IsRequired)&&(this.Config.Details.Required=!0,this.RequiredBoxNode.classList.remove("hidden"),this.RequiredBoxNode.querySelector("input").checked=!0,this.RequiredBoxNode.querySelector("input").disabled=!0),this.GenericGroupNode.classList.add("hide"),this.GenericGroupNode.classList.add("hidden"),this.CleverForms.IsLookup(this.Config)||this.CleverForms.IsGlobalKey(this.Config)){var e=this.CleverForms.GetGenericGroupLookupApi+"?ModelName="+this.Config.Details.AffinityField.ModelName+"&PropertyName="+this.Config.Details.AffinityField.FieldName;Affinity2018.RequestQueue.Add(e,this._gotGenericList,this._getGenericListFailed)}if(this.FormLinkNode.querySelector("select")&&this.Config.Details.hasOwnProperty("AffinityField")&&null!==this.Config.Details.AffinityField.FieldName&&(this.FormLinkNode.classList.add("hidden"),Affinity2018.RequestQueue.Add(this.CleverForms.GetAllAvaiableForms,this._gotFormList,this._getFormListFailed)),this.HiddenBoxNode.querySelector("input").checked=!1,this.CleverForms.IsGlobalKey(this.Config)&&(this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Initiator.Enum&&this.HiddenBoxNode.classList.remove("hidden"),this.Config.Hidden&&(this.HiddenBoxNode.querySelector("input").checked=!0)),this.Config.Details.AffinityField.hasOwnProperty("CleverFormsDisplayType")){var t=this.Config.Details.AffinityField,i=Affinity2018.Classes.Apps.CleverForms.Elements,s=null;if(i.hasOwnProperty(t.CleverFormsDisplayType))switch(s=new i[t.CleverFormsDisplayType]({}),t.CleverFormsDisplayType){case"Address":case"TaxNumber":this.PopupNode.classList.add("large")}null===s&&this.CleverForms.IsLookup(this.Config)&&(s=new i.SingleSelectDropdown({})),null!==s&&s.hasOwnProperty("HtmlEditExampleTemplate")&&""!==s.HtmlEditExampleTemplate.trim()&&(this.PreviewBoxNode.innerHTML=s.HtmlEditExampleTemplate,this.PreviewNode.classList.remove("hidden"))}if(this.Config.hasOwnProperty("Display")){var o=this._isNullOrEmpty(this.Config.Details.Label)?this.Config.Label:this.Config.Details.Label,a=this.CleverForms.ElementData.AffinityField.Description,n=this.Config.Display?this.Config.Display.Description.charAt(0).toLowerCase()+this.Config.Display.Description.substr(1):a,r=a.substring(0,a.indexOf("."));r+=" ("+(n.endsWith(".")?n.substring(0,n.length-1):n)+").",r+="<br /><br />";var l=$a.Lang.ReturnPath("app.cf.design_items.affinity_field_desc",{fieldName:this.Config.Details.AffinityField.FieldName});null!==this.Config.Details.AffinityField.ModelName&&(l=$a.Lang.ReturnPath("app.cf.design_items.affinity_field_desc_with_table",{fieldName:this.Config.Details.AffinityField.FieldName,tableName:this.Config.Details.AffinityField.ModelName})),r+=l,this.SettingsViewNode.querySelector(".settings h3").innerHTML=o,this.SettingsViewNode.querySelector(".settings p").innerHTML=r}var d=$a.jsonCloneObject(this.CleverForms.AffnityFieldModeTypes),h=this.Config.Details.AffinityField.ModelName,c=this.Config.Details.AffinityField.Mode,u=this.CleverForms.AffnityFieldModeEnums[c].Label,p=this.Config.Details.AffinityField.ModeOptions,f=this.CleverForms.ReturnExisitingModelKeyNode(h,this.DesignerNode),m=null!==f?f.controller.Config.Details.AffinityField.Mode:null,y=null!==m?this.CleverForms.AffnityFieldModeEnums[m].Label:null,g=null!==this.Config.Details.AffinityField.LookupTable;for(var v in d){var A,w=d[v],N=this["FilterModeWrapper"+v];$a.isNode(N)&&null!==N.querySelector("input")&&(N.classList.add("hidden"),(A=N.querySelector("input")).removeEventListener("click",this._modeSelected),A.removeAttribute("disabled"),A.checked=!1,m===this.CleverForms.AffnityFieldModeTypes.Hidden.Enum&&(m=this.CleverForms.AffnityFieldModeTypes.Display.Enum),v!==w.Enum&&(m===this.CleverForms.AffnityFieldModeTypes.Create.Enum?p.contains(w.Enum)&&(c===w.Enum&&(A.checked=!0),N.classList.remove("hidden"),"Create"===v||g||4===c?"Select"!==v&&g?A.setAttribute("disabled","disabled"):(A.checked=!0,A.addEventListener("click",this._modeSelected)):A.setAttribute("disabled","disabled")):p.contains(w.Enum)&&(N.classList.remove("hidden"),A.addEventListener("click",this._modeSelected),c==w.Enum&&(A.checked=!0))))}if(!this.FiltersNode.querySelector("input:checked:not(:disabled)"))if(this.FiltersNode.querySelector("input:checked:disabled")){this.FiltersNode.querySelector("input:checked").checked=!1,this["FilterModeWrapper"+y].querySelector("input").checked=!0;var b='Warning! You currenty have "{0}" selected.<br />Becuase you have the key "{1}" set as "{2}", you must select "{2}" here too.'.format(u,f.controller.Config.Details.Label,y);null!==this.RightListNode.querySelector('li[data-field="{0}"][data-mode="{1}"]'.format(this.Config.Details.AffinityField.FieldName,m))&&(b='Warning! You currenty have "{0}" selected.<br />There is already a "{1}" field set to "{2}". You can only have one of each field as "{2}", so delete this or one of the others.'.format(u,this.Config.Details.AffinityField.FieldName,y)),Affinity2018.Dialog.Show({message:b,textAlign:"left",buttons:{cancel:!1}})}else{var S='ERROR! Affinity Field "{0}" ({1}) can not select Mode "{2}" ({3}). Option is Hidden.'.format(this.Config.Details.Label,this.Config.Details.AffinityField.FieldName,w.Name,w.Enum);console.groupCollapsed("%c"+S,"color:#e33100;font-weight:bold"),console.log(this.Config),console.groupEnd(),Affinity2018.ThrowError("Mode Error","critical",S)}return this.PopupNode.querySelectorAll(".mode-wrapper:not(.hidden)").length<=1&&this.RequiredBoxNode.classList.add("hidden"),c===this.CleverForms.AffnityFieldModeTypes.Display.Enum?this.RequiredBoxNode.classList.add("hidden"):this.RequiredBoxNode.classList.remove("hidden"),this.FilterModeWrapperHidden.classList.add("hidden"),!0}return!1}UnsetDesignEditor(){return!!super.UnsetDesignEditor()&&(this.FiltersNode.querySelectorAll(".radios input").forEach(function(e){e.removeEventListener("click",this._modeSelected)}.bind(this)),!0)}GetFromDesignEditor(e){e=$a.paramOrDefault(e,!0,"boolean"),this.Config=super.GetFromDesignEditor(e),(""===this.Config.Details.Label.trim()||this.BlankLabelSetToDefault)&&(this.Config.Details.Label=this.Config.Details.AffinityField.DisplayLabel,this.DesignerNode&&(this.DesignerNode.querySelector(".label").innerHTML=this.Config.Details.Label)),"Date"===this.Config.Details.AffinityField.CleverFormsDisplayType&&(this.Config.Details.AffinityField.hasOwnProperty("DataType")?this.Config.Details.DateTimeType=this.Config.Details.AffinityField.DataType.toLowerCase():this.Config.Details.DateTimeType="date",this.Config.Details.SetDefaultValue=!1);var t=1;if(this.FilterRadiosBoxNode.querySelectorAll('input[type="radio"]').forEach(function(e){e===this.FilterModeWrapperCreate.querySelector("input")&&e.checked&&(t=0),e===this.FilterModeWrapperEdit.querySelector("input")&&e.checked&&(t=1),e===this.FilterModeWrapperDisplay.querySelector("input")&&e.checked&&(t=2),e===this.FilterModeWrapperHidden.querySelector("input")&&e.checked&&(t=3),e===this.FilterModeWrapperSelect.querySelector("input")&&e.checked&&(t=4),e===this.FilterModeWrapperInitiator.querySelector("input")&&e.checked&&(t=5)}.bind(this)),this.Config.Details.AffinityField.Mode=t,this.TemplateNode.querySelector(".affinity-generic-group:not(.hide) select")&&(this.Config.Details.AffinityField.GenericGroupId=this.TemplateNode.querySelector(".affinity-generic-group select").value,$a.isString(this.Config.Details.AffinityField.GenericGroupId)&&$a.isNumeric(this.Config.Details.AffinityField.GenericGroupId)&&(this.Config.Details.AffinityField.GenericGroupId=parseInt(this.Config.Details.AffinityField.GenericGroupId))),this.TemplateNode.querySelector(".affinity-form-link select")){var i=this.TemplateNode.querySelector(".affinity-form-link select").value;"0"===i&&(i=null),this.Config.Details.AffinityField.LinkedTemplateId=i}this.Config.Hidden=!1,this.CleverForms.IsGlobalKey(this.Config)&&(this.Config.Hidden=this.HiddenBoxNode.querySelector("input").checked);var s,o,a,n,r,l,d,h,c=0;if(this.Config.Details.AffinityField.hasOwnProperty("KeyFields")&&$a.isArray(this.Config.Details.AffinityField.KeyFields)&&this.Config.Details.AffinityField.KeyFields.length>0)for(;c<this.Config.Details.AffinityField.KeyFields.length;c++)s=!0,(o=this.Config.Details.AffinityField.KeyFields[c]).hasOwnProperty("TableName")&&null!==o.TableName&&""!==o.TableName.trim()&&(o.ModelName=o.TableName),a=o.FieldName,this.CleverForms.ReturnClassSafeString(a),this.CleverForms.AllowedGlobalKeys.contains(a)?(n=!0,r=this.CleverForms.Designer.RightListNode):(n=!1,r=this.DesignerNode.closest('li[data-type="Section"] ul')),(o.IsKeyField&&this.CleverForms.AllowedGlobalKeys.contains(o.FieldName)&&this.CleverForms.Designer.RightListNode.querySelector('li.is-key-field[data-field="'+o.FieldName+'"]')||o.IsKeyField&&this.DesignerNode.closest('li[data-type="Section"] ul').querySelector('li.is-key-field[data-field="'+o.FieldName+'"]'))&&(s=!1),s&&(l=this.CleverForms.AllowedGlobalKeys.contains(a)?this.CleverForms.Designer.RightListNode.querySelector('li[data-type="Section"] ul'):r,h=this.DesignerNode,d=n?"top":"above",this._insertDesignerKey(a,l,d,h,o));return this.CheckChanges(e),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.Config.Details.AffinityField.CleverFormsDisplayType,i=this.Config.Details.Value,s=this.CleverForms.IsGlobalKey(this.Config),o=this.CleverForms.IsLookup(this.Config),a=this.Config.Details.IsReadOnly||this.Config.Disabled||this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum;this.IsReadOnly=a,this.Config.Details.IsReadOnly=a,this.Config.Details.AffinityField.Mode==this.CleverForms.AffnityFieldModeTypes.Hidden.Enum&&(this.Config.Details.AffinityField.Mode=this.CleverForms.AffnityFieldModeTypes.Display.Enum,a=!0),(s||o)&&(t=[this.CleverForms.AffnityFieldModeTypes.Edit.Enum,this.CleverForms.AffnityFieldModeTypes.Select.Enum].contains(this.Config.Details.AffinityField.Mode)?"SingleSelectDropdown":this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum?"Text":"Integer"),!o&&this.CleverForms.IskeyWithNoRequiredKeys(this.Config)&&[this.CleverForms.AffnityFieldModeTypes.Edit.Enum,this.CleverForms.AffnityFieldModeTypes.Select.Enum].contains(this.Config.Details.AffinityField.Mode)&&(t="SingleSelectDropdown");var n=Affinity2018.Classes.Apps.CleverForms.Elements;if(n.hasOwnProperty(t)||this.CleverForms.ElementControllerMap.hasOwnProperty(t)&&(t=this.CleverForms.ElementControllerMap[t]),this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(["Address","BankNumber","TaxNumber","Date"].contains(t)||(t="Text")),this.CleverForms.GenderFields.contains(this.Config.Details.AffinityField.FieldName)&&(t="SingleSelectRadio",this.Config.Details.ItemSource={Inline:!0,DefaultNone:null,Items:[["Male","M"],["Female","F"],["Other","O"]]}),this.CleverForms.BooleanToRadioFields.contains(this.Config.Details.AffinityField.FieldName)&&(t="SingleSelectRadio",this.Config.Details.ItemSource={Inline:!0,DefaultNone:"false",Items:[["True","true"],["False","false"]]}),/^RATE[1-9]{1}$/.test(this.Config.Details.AffinityField.FieldName)&&(t="Float",this.Config.Details.DecimalNumber=5,this.Config.Details.Rounding="round"),n.hasOwnProperty(t)&&("Date"===t&&((!$a.isString(this.Config.Details.DateTimeType)||$a.isString(this.Config.Details.DateTimeType)&&!["date","time","datetime"].contains(this.Config.Details.DateTimeType))&&(this.Config.Details.DateTimeType="date"),$a.isBool(this.Config.Details.SetDefaultValue)||(this.Config.Details.SetDefaultValue=!1)),this.ElementControllerType=t,this.ElementController=new n[t](this.Config),this.FormRowNode=this.ElementController.SetFormRow(e),"SingleSelectDropdown"===t&&(this.Config.Details.AffinityField.IsKeyField||this.Config.Details.AffinityField.IsGlobalKey)&&null===this.Config.Details.AffinityField.LookupTable?this.IsReadOnly||this.FormRowNode.querySelector("select").addEventListener("change",this._formRowLookupChanged):s||window.addEventListener("ModelLookupChanged",this._modelLookupChanged)),this.FormRowNode){var r=this.Config.Details.AffinityField.LinkedTemplateId,l=$a.isString(r)?r.split(";"):[""],d=l[0].trim(),h=2===l.length?l[1].trim():"",c="",u="";if($a.isString(d)&&""!==d.trim()&&Affinity2018.RequestQueue.Add(this.CleverForms.GetAllAvaiableForms,function(e){for(var t=0;t<e.length;t++)if(""===h){if(e[t].TemplateId===d){c=e[t].TemplateDescription,u=e[t].WorkflowName,h=e[t].WorkflowDefinitionId;break}}else if(e[t].TemplateId===d&&e[t].WorkflowDefinitionId===h){c=e[t].TemplateDescription,u=e[t].WorkflowName,h=e[t].WorkflowDefinitionId;break}if(""!==c){var i=document.createElement("div");i.classList.add("start-link"),i.innerHTML=this.HTMLLinkFormTemplate.format({url:Affinity2018.Path+"Inbox/Create/?templateAndWorkflowIds="+d+";"+h,label:c+" - "+u}),this.FormRowNode.appendChild(i)}}.bind(this),(function(){})),this.FormRowNode.dataset.model=this.Config.Details.AffinityField.ModelName,this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Create.Enum&&this.CleverForms.IsGlobalKey(this.Config)&&(null==i||$a.isString(i)&&""===i.trim())&&(this.FormRowNode.querySelector("input").value=0),!a&&this.FormRowNode.querySelector("input")&&["number","text"].contains(this.FormRowNode.querySelector("input").type.toLowerCase())){var p={MaxLength:isNaN(parseFloat(this.Config.Details.AffinityField.MaxLength))?Number.MAX_SAFE_INTEGER:parseFloat(this.Config.Details.AffinityField.MaxLength),MinLength:isNaN(parseFloat(this.Config.Details.AffinityField.MinLength))?0:parseFloat(this.Config.Details.AffinityField.MinLength),MaxValue:isNaN(parseFloat(this.Config.Details.AffinityField.MaxValue))?Number.MAX_SAFE_INTEGER:parseFloat(this.Config.Details.AffinityField.MaxValue),MinValue:isNaN(parseFloat(this.Config.Details.AffinityField.MinValue))?Number.MIN_SAFE_INTEGER:parseFloat(this.Config.Details.AffinityField.MinValue)};p.MaxLength===Number.MAX_SAFE_INTEGER&&0===p.MinLength||(this.FormRowNode.querySelector("input").classList.add("ui-has-sentence"),this.FormRowNode.querySelector("input").classList.add("ui-has-length"),this.FormRowNode.querySelector("input").dataset.maxLength=p.MaxLength,this.FormRowNode.querySelector("input").dataset.minLength=p.MinLength),p.MaxValue===Number.MAX_SAFE_INTEGER&&p.MinValue===Number.MIN_SAFE_INTEGER||(this.FormRowNode.querySelector("input").classList.add("ui-has-minmax"),this.FormRowNode.querySelector("input").dataset.maxValue=p.MaxValue,this.FormRowNode.querySelector("input").dataset.minValue=p.MinValue)}return"LINK_ID"===this.Config.Details.AffinityField.FieldName&&this.FormRowNode.classList.add("hidden"),this.FormRowNode}}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData=this.ElementController.GetFromFormRow(),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){console.log("this should never get hit"),console.log(e)}GetModelName(){if(this.Config.Details.hasOwnProperty("AffinityField")){if(this.Config.Details.AffinityField.hasOwnProperty("ModelName")&&null!==this.Config.Details.AffinityField.ModelName)return this.Config.Details.AffinityField.ModelName;if(this.Config.Details.AffinityField.hasOwnProperty("TableName")&&null!==this.Config.Details.AffinityField.TableName)return this.Config.Details.AffinityField.TableName}return!1}GetModeName(){if(this.Config.Details.hasOwnProperty("AffinityField"))for(var e in this.CleverForms.AffnityFieldModeTypes)if(this.CleverForms.AffnityFieldModeTypes[e].Enum===this.Config.Details.AffinityField.Mode)return this.CleverForms.AffnityFieldModeTypes[e].Label}_filterSelected(e){console.log(e.detail),e.stopPropagation(),e.preventDefault()}_modeSelected(e){var t=this.Config.Details.AffinityField.Mode,i=parseInt(e.target.dataset.mode);if(this.CleverForms.IsKey(this.Config)&&t!==i&&t===this.CleverForms.AffnityFieldModeTypes.Create.Enum&&i===this.CleverForms.AffnityFieldModeTypes.Select.Enum){for(var s='li[data-model="'+this.Config.Details.AffinityField.ModelName+'"]:not(.is-key-field)',o=document.querySelectorAll(s),a=[],n=0;n<o.length;n++)o[n].controller.Config.Details.AffinityField.Mode!==i&&a.push(o[n]);if(a.length>0){var r=[];for(n=0;n<a.length;n++)r.push(a[n].controller.Config.Details.Label);var l="&nbsp;&nbsp;&nbsp;&nbsp;",d=l+r.join("<br>"+l);if(r.length>11){var h=r.slice(0,10);h.push("..."),h.push(r[r.length-1]),d='<div class="indent">'+(r=h).join(", ")+"</div>"}var c=$a.Lang.ReturnPath("app.cf.designer.affinityfield_mode_switch_keys",{modeFrom:this.CleverForms.AffnityFieldModeEnums[t].Label,modeTo:this.CleverForms.AffnityFieldModeEnums[i].Label,keylist:d});Affinity2018.Dialog.Show({message:c,textAlign:"left",buttons:{ok:{show:!0,icon:"tick",text:"Continue",color:"blue"},cancel:{show:!0,icon:"cross",text:"Cancel",color:"grey"}},onOk:function(){this._continueModeSelect(i)}.bind(this),onCancel:function(){this["FilterModeWrapper"+this.CleverForms.AffnityFieldModeEnums[t].Name].querySelector("input").checked=!0}.bind(this)})}else this._continueModeSelect(i)}else this._continueModeSelect(i)}_continueModeSelect(e){var t=this.CleverForms.AffnityFieldModeEnums[e];(this.CleverForms.IsLookup(this.Config)||this.CleverForms.IsGlobalKey(this.Config))&&(t.Enum===this.CleverForms.AffnityFieldModeTypes.Select.Enum?this.GenericGroupNode.classList.remove("hide"):this.GenericGroupNode.classList.add("hide")),t.Enum===this.CleverForms.AffnityFieldModeTypes.Display.Enum?this.RequiredBoxNode.classList.add("hidden"):this.RequiredBoxNode.classList.remove("hidden"),this.HiddenBoxNode.classList.add("hidden"),this.CleverForms.IsGlobalKey(this.Config)&&t.Enum===this.CleverForms.AffnityFieldModeTypes.Initiator.Enum&&this.HiddenBoxNode.classList.remove("hidden")}_insertDesignerKey(e,t,i,s,o){if($a.isObject(o)){var a=$a.jsonCloneObject(this.CleverForms.ElementData.AffinityField);a=this._setAffinityFieldConfigFromKeyConfig(a,o),a=this.CleverForms.SelectDefaultModeOnFieldSearch(a);var n=!1,r="";if(this.CleverForms.IsMasterFile(this.Config)?(r='li.is-key-field[data-field="'+a.Details.AffinityField.FieldName+'"][data-model="'+o.ModelName+'"]',n=null!==this.CleverForms.Designer.RightListNode.querySelector(r)):(r=".item-"+e,n=null!==t.querySelector(r)),n)return;console.groupCollapsed("%c🔑 AUTO INSERT REQUIRED KEY","color:#ffb515"),console.log("%c  keyName         ","color:#ffb515",e),console.log("%c  targetNode      ","color:#ffb515",t),console.log("%c  position        ","color:#ffb515",i),console.log("%c  referenceNode   ","color:#ffb515",s),console.log("%c  keyData         ","color:#ffb515",o),console.log("%c  Already exists? ","color:#ffb515",n),console.groupEnd();var l=s.controller.Config,d=l.Details.AffinityField.Mode,h=this.CleverForms.AffnityFieldModeTypes.Edit.Enum,c=this.CleverForms.AffnityFieldModeTypes.Select.Enum,u=this.CleverForms.AffnityFieldModeTypes.Create.Enum,p=this.CleverForms.AffnityFieldModeTypes.Display.Enum;d===h&&this.CleverForms.IsMasterFile(l)||this.CleverForms.IsKey(a)&&d===p?d=c:this.CleverForms.IsMasterFile(l)||!this.CleverForms.IsLookup(a)&&!this.CleverForms.IsGlobalKey(a)||d!==u||(d=c),a.Details.AffinityField.Mode=d,this.CleverForms.Designer.Add(a,!1,t,i,s)}}_setAffinityFieldConfigFromKeyConfig(e,t){for(var i in e.Details.AffinityField)e.Details.AffinityField.hasOwnProperty(i)&&t.hasOwnProperty(i)&&(e.Details.AffinityField[i]=t[i]);if(!this.CleverForms.AllowedGlobalKeys.contains(t.FieldName)&&t.FieldName!==this.Config.Details.AffinityField.FieldName&&null===t.KeyFields){var s=$a.jsonCloneObject(this.Config.Details.AffinityField);t.KeyFields=[];for(var o=0;o<s.KeyFields.length;o++)s.KeyFields[o].FieldName!==this.Config.Details.AffinityField.FieldName&&s.KeyFields[o].FieldName!==t.FieldName&&t.KeyFields.push(s.KeyFields[o]);s.IsKeyField&&t.KeyFields.push(s),e.Details.AffinityField.KeyFields=t.KeyFields}return(e=this.CleverForms.__PORT_G_G_G_GET_AFFINITYFIELD_DATA({Details:{AffinityField:t}},e)).Details.AffinityField.TableName=t.TableName,e.Label=t.DefaultLabel,e.Details.Label=t.DefaultLabel,e.Details.HelpText=t.FieldHint,e.Details.Required=this.CleverForms.IsMasterFile(t)?t.IsMandatory:this.Config.Details.Required,e.Details.IsReadOnly=t.IsReadOnly,e.Details.AffinityField.IsKeyField&&(e.Icon.Code=Affinity2018.icons.cfAffinityKey,e.Icon.Name="cf-affinity-key",e.Icon.Color="grey"),e}_gotGenericList(e){if($a.isArray(e)&&this.GenericGroupNode.querySelector("select")){this.GenericGroupSelectNode.innerHTML="";var t,i,s=0,o=0;if(e.length>0){for((i=document.createElement("option")).value="",i.innerHTML="None",this.GenericGroupSelectNode.appendChild(i);s<e.length;s++)t=e[s],$a.isObject(t)&&($a.isString(t.Value)&&!t.Value.isNullOrEmpty()||$a.isNumeric(t.Value))&&($a.isString(t.Key)&&!t.Key.isNullOrEmpty()||$a.isNumeric(t.Key))&&(t=e[s],(i=document.createElement("option")).innerHTML=t.Value,i.value=t.Key,this.Config.Details.AffinityField.GenericGroupId.toString()===t.Key.toString()&&(i.selected="selected"),this.GenericGroupSelectNode.appendChild(i),o++);o>0?(this.GenericGroupSelectNode.classList.add("ui-has-autocomplete","ui-autocomplete-force-top"),Affinity2018.Autocompletes.Apply(this.GenericGroupSelectNode),this.GenericGroupNode.classList.remove("hidden"),this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Select.Enum&&this.GenericGroupNode.classList.remove("hide")):(this.GenericGroupSelectNode.innerHTML="",this.GenericGroupNode.classList.add("hidden"))}else this.GenericGroupSelectNode.innerHTML="",this.GenericGroupNode.classList.add("hidden")}else this._getGenericListFailed(resposne)}_getGenericListFailed(e){this.GenericGroupNode.classList.add("hide"),this.GenericGroupNode.classList.add("hidden")}_gotFormList(e){if($a.isArray(e)&&this.FormLinkNode.querySelector("select")){var t,i,s=0,o=!1,a=0;if(e.length>0){var n=this.Config.Details.AffinityField.LinkedTemplateId,r=$a.isString(n)?n.split(";"):[""],l=r[0].trim(),d=2===r.length?r[1].trim():"";for((i=document.createElement("option")).innerHTML="None",i.value=0,""===l&&(i.selected="selected",o=!0),this.FormLinkSelectNode.appendChild(i);a<e.length;a++)t=e[a],""===d?(d=t.WorkflowDefinitionId,(i=document.createElement("option")).innerHTML=t.TemplateDescription+" - "+t.WorkflowName,i.value=t.TemplateId+";"+t.WorkflowDefinitionId,o||t.TemplateId!==l||(i.selected="selected",i.setAttribute("selected","selected"),this.FormLinkSelectNode.dataset.defaultValue=l+";"+d,o=!0),this.FormLinkSelectNode.appendChild(i),s++):((i=document.createElement("option")).innerHTML=t.TemplateDescription+" - "+t.WorkflowName,i.value=t.TemplateId+";"+t.WorkflowDefinitionId,o||t.TemplateId!==l||t.WorkflowDefinitionId!==d||(i.selected="selected",i.setAttribute("selected","selected"),this.FormLinkSelectNode.dataset.defaultValue=l+";"+d,o=!0),this.FormLinkSelectNode.appendChild(i),s++);s>0?(this.FormLinkNode.classList.remove("hidden"),this.FormLinkSelectNode.classList.add("ui-has-autocomplete","ui-autocomplete-force-top"),Affinity2018.Autocompletes.Apply(this.FormLinkSelectNode)):(this.FormLinkSelectNode.innerHTML="",this.FormLinkNode.classList.add("hidden"))}else this.FormLinkSelectNode.innerHTML="",this.FormLinkNode.classList.add("hidden")}else this._getFormListFailed(e)}_getFormListFailed(e){this.FormLinkNode.classList.add("hidden"),console.log(e)}_formRowLookupChanged(e){var t=this.FormRowNode.querySelector("select"),i=this.Config.Details.AffinityField.ModelName;if(document.querySelectorAll('div[data-model="'+i+'"].row-affinityfield').length>0){$a.ShowPageLoader();var s=encodeURIComponent(t.value.trim());this.FormLookupApi="{api}?modelName={modelName}&key={key}&instanceId={instanceId}".format({api:this.CleverForms.GetModelApi.trim(),modelName:this.Config.Details.AffinityField.ModelName,key:s,instanceId:this.CleverForms.GetInstanceGuid()}),$a.RequestQueue.Add(this.FormLookupApi,this._lookupModelLoaded,this._lookupModelFailed)}}_lookupModelLoaded(e){var t=new CustomEvent("ModelLookupChanged",{detail:{FieldKey:this.FormRowNode.querySelector("select").value,Model:this.Config.Details.AffinityField.ModelName,Data:e}});$a.HidePageLoader(),window.dispatchEvent(t)}_lookupModelFailed(e){$a.HidePageLoader();var t="#ffb515";console.group("%cForm Lookup Hook Failed","color:#ffb515;font-weight:bold;"),console.log("%c"+this.FormLookupApi,"color:"+t);var i=this.CleverForms.GetDetailsFromErrorPage(e);null!==i&&(""!==i.Title&&console.log("%cTitle: "+i.Title,"color:"+t),""!==i.Source&&console.log("%cSource: "+i.Source,"color:"+t),""!==i.Description&&console.log("%cDescription: "+i.Description,"color:"+t),""!==i.Details&&console.log("%cDetails: "+i.Details,"color:"+t),i.Lines.length>0&&i.Lines.forEach((function(e){console.log("%c\t"+e,"color:"+t)}))),console.groupEnd()}_modelLookupChanged(e){var t,i,s=e.detail.Model,o=e.detail.Data;e.detail.FieldKey,this.Config.Details.AffinityField.ModelName===s&&Object.keys(o).contains(this.Config.Name)&&(null!==o[this.Config.Name]?(t="#8dca35",i='Change "{Label}" ({FieldName} - {Type} Element) to "{Value}"'.format({Label:this.Config.Details.Label,FieldName:this.Config.Details.AffinityField.FieldName,Type:this.ElementControllerType,Value:o[this.Config.Name]}),console.groupCollapsed("%c"+i,"color:"+t+";font-weight:bold;"),console.log(o),this.ElementController.SetFromValue(o[this.Config.Name])):(t="#8dca35",i='Change "{Label}" ({FieldName} - {Type} Element) was cleared because value is null'.format({Label:this.Config.Details.Label,FieldName:this.Config.Details.AffinityField.FieldName,Type:this.ElementControllerType}),console.groupCollapsed("%c"+i,"color:"+t+";font-weight:bold;"),console.log(o),this.ElementController.SetFromValue("")),console.groupEnd())}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row top affinity-generic-group hidable hide hidden">\n      <label>{filterlabel}</label>\n      <div class="select working">\n        <select class=""></select>\n      </div>\n    </div>\n    <p class="affinity-form-link-desc">{linkmessage}</p>\n    <div class="edit-row affinity-form-link hidden">\n      <label>{selectlabel}</label>\n      <div class="select working">\n        <select class=""></select>\n      </div>\n    </div>\n    ',this.HtmlEditExampleTemplate="\n\n    ",this.HtmlRowTemplate="\n    ",this.HTMLLinkFormTemplate='\n    <form action="{url}" method="post" target="_blank">\n      Start form <a href="#" onclick="this.parentNode.submit();return false;">{label}</a>\n    </form>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.AttachInstructions=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"AttachInstructions"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_setLink"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("generic.buttons.uploadfile"),choose:$a.Lang.ReturnPath("generic.buttons.choosefile")}),!!super.SetDesignEditor()&&(this.PopupNode.classList.add("large","has-list"),this.SettingsViewNode.querySelector(".edit-required").classList.add("hidden"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t,i;if(null==this.Config.Details.FileId||""==this.Config.Details.FileId)t=this.HtmlRowTemplate.format(this.Config.Details.Label,"#");else{i=null!==this.Config.Details.FileId?this.CleverForms.FileGetApi+"?documentId="+this.Config.Details.FileId:"#",t=this.HtmlRowTemplate.format(this.Config.Details.Label,i);var s=this.CleverForms.FileGetInfoApi+"?fileIds="+this.Config.Details.FileId;axios({method:"GET",url:s}).then(function(e){$a.isObject(e)&&$a.isPropObject(e,"data")&&$a.isPropObject(e.data,"data")&&e.data.data.hasOwnProperty("")&&this._setLink(e.data.data[this.Config.Details.FileId],i)}.bind(this)).catch((function(){}))}if(this.FormRowNode=super.SetFormRow(e,t),null!=this.Config.Details.FileId&&""!=this.Config.Details.FileId||this._setLink("File Name Here","#"),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_setLink(e,t){this.FormRowNode.innerHTML=this.HtmlRowLinkTemplate.format({label:this.Config.Details.Label,link:t,name:e}),"#"==t&&(this.FormRowNode.querySelector("a").href="javascript:void(0)")}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <label class="ui-has-file">\n        <input type="file" name="FileId" data-allow-multiple="false" />\n        <div class="button blue upload"><span class="icon-file-black"></span>{choose}</div>\n      </label>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <a href="#">Download Document</a>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <a href="{1}">{0}</a>\n    </div>\n    ',this.HtmlRowLinkTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <div class="row-content">\n        <a href="{link}">{name}</a>\n      </div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.BankNumber=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options(),this.CountryCodes=["AU","NZ"],this.DefaultCountryCode="AU",this.CountryCodeMap={A:"AU",N:"NZ"}}constructor(e){return super(e,"BankNumber"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_getFormRowHtml","_gotNewUserProfile"].bindEach(this),this._options(),this._templates(),window.addEventListener("GotUser",this._gotNewUserProfile),this}SetDesignEditor(){return!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=$a.isArray(this.Config.Details.Value)&&2===this.Config.Details.Value.length?this.Config.Details.Value[0]:"",i=$a.isArray(this.Config.Details.Value)&&2===this.Config.Details.Value.length?this.Config.Details.Value[1]:"AU";1===i.length&&this.CountryCodeMap.hasOwnProperty(i.toUpperCase())&&(i=this.CountryCodeMap[i.toUpperCase()]);var s;if(s=this.IsReadOnly?this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,value:t+", "+i}):this._getFormRowHtml(t,i),this.FormRowNode=super.SetFormRow(e,s),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-banknumber").widgets.BankNumber;return this.FormData.Value=e.GetData(),this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){var t=this.FormRowNode.querySelector("input.ui-banknumber").widgets.BankNumber;!this.IsReadOnly&&t&&(null===e||$a.isString(e)&&(""===e.trim()||"null"===e)?t.Set(""):t.Set(e))}_getFormRowHtml(e,t){var i=!0;return $a.isPropObject(Affinity2018.UserProfile,"Selected")&&$a.isPropBool(Affinity2018.UserProfile.Selected,"HasPayPoint")&&(Affinity2018.SelectedProfile.Selected.HasPayPoint&&(i=!1),$a.isPropString(Affinity2018.UserProfile.Selected,"PayPointCountryCode")&&(t=Affinity2018.UserProfile.Selected.CountryCode)),i||"AffinityField"!==this.Config.Type||this.Config.Details.AffinityField.Mode!==this.CleverForms.AffnityFieldModeTypes.Create.Enum||(i=!0),this.HtmlRowTemplate.format({label:this.Config.Details.Label,value:e,country:t,status:i?"show":"hide"})}_gotNewUserProfile(e){if(this.FormRowNode&&$a.isPropObject(Affinity2018.UserProfile,"Selected")){var t=this.FormRowNode.querySelector("input.ui-taxnumber").widgets.TaxNumber,i=t.GetData(),s=i[0],o=i[1],a=this._getFormRowHtml(s,o);t.Destroy(),this.FormRowNode.innerHTML=a,Affinity2018.Apps.Plugins.BankNumber.Apply()}}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>Bank Account</label>\n        <input type="text" class="ui-has-banknumber" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" class="ui-has-banknumber" value="{value}" data-country="{country}" data-country-status="{status}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.CheckBox=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"CheckBox"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","IsValid"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({example:$a.Lang.ReturnPath("app.cf.design_items.checkbox_example")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Value,"check-"+this.Config.Name,this.Config.Details.Label);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData.Value=!!this.FormRowNode.querySelector("input").checked,this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}IsValid(){return!this.Config.Details.Required||this.FormRowNode.querySelector('input[type="checkbox"]').checked}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <div class="check-label-pair">\n          <input type="checkbox" id="_SingleCheckExample" /><label for="_SingleCheckExample" class="right">{example}</label>\n        </div>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <div class="check-label-pair">\n        <input type="checkbox" value="{0}" id="{1}" /><label for="{1}" class="right">{2}</label>\n      </div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Currency=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Currency"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.currency_example_label"),value:$a.Lang.ReturnPath("app.cf.design_items.currency_example_value")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.currency_decimal_label")}),!!super.SetDesignEditor()&&(this.TemplateNode.querySelector("select.DecimalNumber").value=this.Config.Details.DecimalNumber,!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.DecimalNumber=isNaN(parseInt(this.TemplateNode.querySelector("select.DecimalNumber").value))?2:parseInt(this.TemplateNode.querySelector("select.DecimalNumber").value),this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.Value);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormRowNode&&!isNaN(parseFloat(this.FormRowNode.querySelector("input.nv").value))?this.FormData.Value=parseFloat(this.FormRowNode.querySelector("input.nv").value):this.FormData.Value=null,this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){super.SetFromValue(e)}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <div class="select">\n        <select class="DecimalNumber">\n          <option selected value="2">2</option>\n          <option value="3">3</option>\n          <option value="4">4</option>\n          <option value="5">5</option>\n        </select>\n      </div>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <div class="currencybox">\n          <div class="symbol"><strong>$</strong></div>\n          <input type="text" class="ui-has-currency" value="{value}" />\n        </div>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n        <div class="currencybox">\n          <div class="symbol"><strong>$</strong></div>\n          <input type="text" class="ui-has-currency" value="{1}" />\n        </div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Date=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Date"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.date_example_label")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({showDateLabel:$a.Lang.ReturnPath("app.cf.design_items.date_show_date_label"),showTimeLabel:$a.Lang.ReturnPath("app.cf.design_items.date_show_time_label"),currentLabel:$a.Lang.ReturnPath("app.cf.design_items.date_default_current_label")}),!!super.SetDesignEditor()&&(this.ShowDateNode=this.TemplateNode.querySelector("#_DateTimeTypeAndDate"),this.ShowTimeNode=this.TemplateNode.querySelector("#_DateTimeTypeAndTime"),this.DefaultValueNode=this.TemplateNode.querySelector("#_DateTimeDefaultValue"),this.ShowDateNode.checked=null,this.ShowTimeNode.checked=null,null!==this.Config.Details.DateTimeType&&(this.Config.Details.DateTimeType.toLowerCase().contains("date")&&(this.ShowDateNode.checked="checked"),this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(this.ShowTimeNode.checked="checked")),!0===this.Config.Details.SetDefaultValue||"string"===$a.type(this.Config.Details.SetDefaultValue)&&"true"===this.Config.Details.SetDefaultValue.toString().toLowerCase().trim()?this.DefaultValueNode.checked="checked":this.DefaultValueNode.checked=null,this.ShowDateNode.checked||this.ShowTimeNode.checked||(this.ShowDateNode.checked="checked"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){this.Config=super.GetFromDesignEditor();var e=this.ShowDateNode.checked,t=this.ShowTimeNode.checked;return e&&t&&(this.Config.Details.DateTimeType="datetime"),e&&!t&&(this.Config.Details.DateTimeType="date"),!e&&t&&(this.Config.Details.DateTimeType="time"),this.Config.Details.SetDefaultValue=this.DefaultValueNode.checked,this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t="",i="",s="",o="";if("AffinityField"===this.Config.Type&&this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(this.IsReadOnly=!0,this.Config.Details.IsReadOnly=!0),i=null,($a.isPropString(this.Config.Details,"SetDefaultValue")&&"true"===this.Config.Details.SetDefaultValue.toLowerCase().trim()||$a.isPropBool(this.Config.Details,"SetDefaultValue")&&!0===this.Config.Details.SetDefaultValue)&&(i=Date.today()),$a.isPropString(this.Config.Details,"Value")&&""!==this.Config.Details.Value.trim()&&(i=$a.stringToDate(this.Config.Details.Value)),this.IsReadOnly){var a="";null!==i&&(t="",this.Config.Details.DateTimeType.toLowerCase().contains("date")&&(t+="ddd dS MMM, yyyy"),this.Config.Details.DateTimeType.toLowerCase().contains("date")&&this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(t+=" -"),this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(t+=" h:mm:ss tt"),a=i.toString(t)),o=this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,value:a})}else t="",this.Config.Details.DateTimeType.toLowerCase().contains("date")&&(t+="dd/MM/yyyy"),this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(t+=" HH:mm:ss"),""!==t.trim()&&(s+=' data-calendar-return-format="'+t+'"'),null!==i&&(s+=' data-start-date="'+i.toString(t)+'"',i=i.toString(t)),s+=' data-calendar-nullable="true"',o=this.HtmlRowTemplate.format({label:this.Config.Details.Label,type:this.Config.Details.DateTimeType,date:i,dataset:s.trim()});if(this.FormRowNode=super.SetFormRow(e,o),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-calendar"),t=(e.parentNode.parentNode,e.widgets.DateTime),i=t.getRawDate();return""!==e.value.trim()&&!1!==i?this.FormData.Value=i.toString(t.outputFormat):this.FormData.Value="",this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){var t="",i=this.IsReadOnly?this.FormRowNode.querySelector("input"):this.FormRowNode.querySelector("input.ui-calendar"),s=!this.IsReadOnly&&i.widgets.DateTime;!$a.isString(e)||""!==e.trim()&&"null"!==e.trim()?($a.isString(e)&&$a.isDateValid($a.stringToDate(e))&&(e=$a.stringToDate(e)),$a.isDateValid(e)&&(s?s.setDate(e):(this.Config.Details.DateTimeType.toLowerCase().contains("date")&&(t+="ddd dS MMM, yyyy"),this.Config.Details.DateTimeType.toLowerCase().contains("date")&&this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(t+=" -"),this.Config.Details.DateTimeType.toLowerCase().contains("time")&&(t+=" h:mm tt"),""!==t.trim()?i.value=e.toString(t):i.value=""))):s?s.setNone():i.value=""}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row inline-check">\n      <input type="checkbox" id="_DateTimeTypeAndDate" data-task="updateDateTimeType" checked />\n      <label for="_DateTimeTypeAndDate">{showDateLabel}</label>\n    </div>\n    <div class="edit-row inline-check">\n      <input type="checkbox" id="_DateTimeTypeAndTime" data-task="updateDateTimeType" />\n      <label for="_DateTimeTypeAndTime">{showTimeLabel}</label>\n    </div>\n    <div class="edit-row inline-check">\n      <input type="checkbox" id="_DateTimeDefaultValue" name="SetDefaultValue" checked />\n      <label for="_DateTimeDefaultValue">{currentLabel}</label>\n    </div>\n    <input type="hidden" name="DateTimeType" value="date" />\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row calendar">\n        <label>{label}</label>\n        <input type="text" class="ui-has-calendar" data-type="datetime" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row calendar">\n      <label>{label}</label>\n      <input type="text" class="ui-has-calendar" data-type="{type}" {dataset} value="{date}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.DocumentSigning=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options(),this.FormMode=!1,this.IsOnlyRow=!1,this.SectionTitle="",this.DocSignSelectNode=!1,this.DocSignSelectWrapperNode=!1,this.DocSignDescNode=!1,this.DocSignErrorNode=!1,this.LastPostedDocsignTemplateId=null,this.LastPostState="",this.CanSend=!0,this.ValidOnlyIfSent=!0,this.ShortenFieldLists=!1}constructor(e){if(super(e),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","GetSigningTemplateId","GetSigningRecipients","_loadIds","_idsLoaded","_idsFailed","_idChanged","_postDoc","_postedDoc","_postDocError","_postDocCancel","_postDocCanceled","_postDocCancelError","_setReadyOnly","_unsetReadyOnly","_checkRecipientValidation","_checkDocSignButtons"].bindEach(this),this._options(),this._templates(),Affinity2018.Apps.CleverForms.hasOwnProperty("Form")&&(this.FormMode=!0),this.FormMode){var t,i,s=Affinity2018.Apps.CleverForms.Form.FormData;if(s&&$a.isArray(s))for(var o=0;o<s.length;o++)if((t=s[o])&&$a.isObject(t)&&t.hasOwnProperty("Elements")&&$a.isArray(t.Elements)&&t.Elements.length>0)for(var a=0;a<t.Elements.length;a++)if((i=t.Elements[a])&&$a.isObject(i)&&i.hasOwnProperty("Name")&&$a.isString(i.Name)&&i.Name==this.Config.Name){1===t.Elements.length&&(this.IsOnlyRow=!0),this.SectionTitle=t.Details.Title;break}}return this.Config.Details.ValidationString=$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_validation",{button:$a.Lang.ReturnPath("app.cf.design_items.docsign_send_label")}),this}SetDesignEditor(){return this.HtmlEditTemplate=this.HtmlEditTemplate.format({templateLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_template_label")}),this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({blockClass:this.IsOnlyRow?"":"form-row-block grey-block",label:this.CleverForms.ElementData.hasOwnProperty(this.Config.Type)?this.CleverForms.ElementData[this.Config.Type].Label:"Document Signing",templateLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_template_label"),recipientLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_recipient_label"),cancelLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_cancel_label"),sendLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_send_label")}),!!super.SetDesignEditor()&&(this.PopupNode.classList.add("large"),this._loadIds(),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return super.GetFromDesignEditor()&&this.DocSignSelectNode&&(this.Config.Details.ExternalTemplateId=this.GetSigningTemplateId()),this.Config}SetFromValue(e){}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format({templateLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_template_label"),recipientLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_recipient_label"),required:this.Config.Details.Required?'<span class="required icon-star-full"></span>':"",cancelLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_cancel_label"),sendLabel:$a.Lang.ReturnPath("app.cf.design_items.docsign_send_label")});if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.IsOnlyRow&&this.Config.Details.Label.toLowerCase().trim()===this.SectionTitle.toLowerCase().trim()&&(this.FormRowNode.querySelector("label").classList.add("hidden"),this.FormRowNode.querySelector(".help")&&this.FormRowNode.querySelector(".help").classList.add("hidden")),this.IsOnlyRow||this.FormRowNode.classList.add("indent"),this._loadIds(),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.Config.Details.Value.hasOwnProperty("SignatureRequestId")&&this.Config.Details.Value.SignatureRequestId?this.Config.Details.Value.SignatureRequestId:null;return this.FormData.Value=JSON.stringify({ExternalTemplateId:this.GetSigningTemplateId(),Recipients:this.GetSigningRecipients(),CanSend:this.CanSend,SignatureRequestId:e}),this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}IsValid(){return!this.Config.Details.Required||""!==this.GetSigningTemplateId()&&this.GetSigningRecipients().length>0&&(!this.ValidOnlyIfSent||!!this.Config.Details.Value.hasOwnProperty("CanSend")&&!this.Config.Details.Value.CanSend)}GetSigningTemplateId(){return this.DocSignSelectNode?this.DocSignSelectNode.value:this.FormMode&&"Form"===this.CleverForms.Form.ViewType&&this.Config.Details.hasOwnProperty("Value")&&$a.isObject(this.Config.Details.Value)&&this.Config.Details.Value.hasOwnProperty("ExternalTemplateId")&&this.Config.Details.Value.hasOwnProperty("Recipients")?this.Config.Details.Value.ExternalTemplateId:this.Config.Details.ExternalTemplateId}GetSigningRecipients(){var e=[];return this.FormRowNode&&this.FormRowNode.querySelector(".docsign-row input.sv")&&this.FormRowNode.querySelectorAll(".docsign-row input.sv").forEach((function(t){t&&""!==t.value.trim()&&!t.classList.contains("error")&&e.push({EmailAddress:t.value.trim()})})),""===e.join("").trim()?[]:e}_loadIds(){$a.ShowPageLoader();var e=this.FormRowNode;this.Designer&&(e=this.EditNode),this.DocSignSelectNode=e.querySelector("select.docsign-template-ids")||!1,this.DocSignDescNode=e.querySelector("p.docsign-template-desc")||!1,this.DocSignSelectWrapperNode=!!this.DocSignSelectNode&&this.DocSignSelectNode.closest(".select"),this.DocSignErrorNode=!(!this.Designer||!this.DocSignSelectNode)&&this.DocSignSelectNode.closest(".edit-row").querySelector(".docsign-error"),this.DocSignErrorNode=!this.Designer&&this.DocSignSelectNode?this.DocSignSelectNode.closest(".form-row").querySelector(".docsign-error"):this.DocSignErrorNode,this.DocSignFieldsNode=!this.Designer&&e.querySelector(".docsign-fields"),$a.RequestQueue.Get(this.CleverForms.GetDocumentSigningTemplatesApi,this._idsLoaded,this._idsFailed,1)}_idsLoaded(e){if($a.isArray(e)){if(this.DocSignSelectNode){var t=this.Config.Details.ExternalTemplateId||null,i=[];if(this.FormMode&&"Form"===this.CleverForms.Form.ViewType&&this.Config.Details.hasOwnProperty("Value")&&$a.isObject(this.Config.Details.Value)&&this.Config.Details.Value.hasOwnProperty("ExternalTemplateId")&&this.Config.Details.Value.hasOwnProperty("Recipients")?(t=this.Config.Details.Value.ExternalTemplateId,i=this.Config.Details.Value.Recipients,this.Config.Details.Value.hasOwnProperty("CanSend")&&!this.Config.Details.Value.CanSend&&(this.CanSend=!1)):this.FormMode&&"ViewOnly"===this.CleverForms.Form.ViewType&&this.Config.Details.Value.hasOwnProperty("Recipients")&&(i=this.Config.Details.Value.Recipients),this.DocSignSelectWrapperNode.classList.remove("hidden"),this.DocSignErrorNode.classList.add("hidden"),this.DocSignErrorNode.innerHTML="",this.DocSignFieldsNode&&this.DocSignFieldsNode.classList.remove("hidden"),e.length>0){this.DocSignSelectNode.removeEventListener("change",this._idChanged),this.DocSignSelectNode&&this.DocSignSelectNode.addEventListener("change",this._idChanged);var s,o=!1;this.DocSignSelectNode.hasOwnProperty("widgets")&&this.DocSignSelectNode.widgets.hasOwnProperty("Autocomplete")&&(o=this.DocSignSelectNode.widgets.Autocomplete),this.DocSignSelectNode.innerHTML="",(s=document.createElement("option")).innerHTML=$a.Lang.ReturnPath("app.cf.design_items.docsign_select_default"),s.value="",this.DocSignSelectNode.appendChild(s),e.forEach(function(e){e.Enabled&&null!==e.ExternalTemplateId&&$a.isString(e.ExternalTemplateId)&&""!==e.ExternalTemplateId.trim()&&((s=document.createElement("option")).innerHTML=e.Title,s.value=e.ExternalTemplateId,s.data=e,e.ExternalTemplateId===t&&s.setAttribute("selected","selected"),this.DocSignSelectNode.appendChild(s))}.bind(this)),this.DocSignSelectNode&&this._idChanged(),o?o.refreshFromSelect():Affinity2018.hasOwnProperty("Autocompletes")?Affinity2018.Autocompletes.Apply(this.DocSignSelectNode):Affinity2018.Apps.Plugins.Autocompletes.Apply(this.DocSignSelectNode)}else this.DocSignFieldsNode&&this.DocSignFieldsNode.classList.add("hidden"),this.DocSignSelectWrapperNode.classList.add("hidden"),this.DocSignErrorNode.classList.remove("hidden"),this.DocSignErrorNode.innerHTML=$a.Lang.ReturnPath("app.cf.design_items.docsign_not_signed_up");if(this.FormMode){Affinity2018.Apps.Plugins.Strings.Apply(),this.PostDocCancelButtonNode=this.FormRowNode.querySelector(".button.send-doc-cancel"),this.PostDocButtonNode=this.FormRowNode.querySelector(".button.send-doc"),this.PostDocCancelButtonNode.removeEventListener("click",this._postDocCancel),this.PostDocButtonNode.removeEventListener("click",this._postDoc),this.PostDocCancelButtonNode.addEventListener("click",this._postDocCancel),this.PostDocButtonNode.addEventListener("click",this._postDoc);var a=this.FormRowNode.querySelectorAll(".docsign-row input.sv");if(4===a.length){for(var n=0;n<a.length;n++)a[n].removeEventListener("keyup",this._checkDocSignButtons),a[n].addEventListener("keyup",this._checkDocSignButtons),i[n]&&(a[n].value=i[n].EmailAddress,a[n].recipientData=i[n]);this.DocSignSelectNode.removeEventListener("change",this._checkDocSignButtons),this.DocSignSelectNode.addEventListener("change",this._checkDocSignButtons),this._checkDocSignButtons()}}}}else this._idsFailed(e);$a.HidePageLoader()}_idsFailed(e){this.CleverForms.IsErrorPage(e)&&(e=this.CleverForms.GetDetailsFromErrorPage(e)),e=$a.Lang.ReturnPath("app.cf.design_items.docsign_load_failed");var t=this._returnBackendErrors(e);t!==e&&(e=t),this.DocSignFieldsNode&&this.DocSignFieldsNode.classList.add("hidden"),this.DocSignSelectWrapperNode.classList.add("hidden"),this.DocSignErrorNode.classList.remove("hidden"),this.DocSignErrorNode.innerHTML=e,$a.HidePageLoader()}_idChanged(e){if(this.DocSignSelectNode){$a.isObject(this.Config.Details.Value)||(this.Config.Details.Value={ExternalTemplateId:"",Recipients:[]});var t=this.DocSignSelectNode.options[this.DocSignSelectNode.selectedIndex],i=!!t.hasOwnProperty("data")&&t.data;i&&i.hasOwnProperty("Description")?this.DocSignDescNode&&(this.DocSignDescNode.innerHTML=i.Description,this.DocSignDescNode.classList.remove("hidden")):this.DocSignDescNode&&(this.DocSignDescNode.innerHTML="",this.DocSignDescNode.classList.add("hidden"))}}_postDoc(){if("Form"===this.CleverForms.Form.ViewType&&""!==this.DocSignSelectNode.value){var e=this.GetSigningRecipients();if(JSON.stringify(e.sort())!==JSON.stringify(e.unique().sort()))return void $a.Dialog.Show({message:$a.Lang.ReturnPath("app.cf.design_items.docsign_duplicate_emails"),showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"});e.length>0&&($a.ShowPageLoader(),this.PostDocCancelButtonNode.classList.remove("hidden"),this.PostDocCancelButtonNode.classList.add("disabled"),this.PostDocButtonNode.classList.remove("hidden"),this.PostDocButtonNode.classList.add("disabled"),this.LastPostedDocsignTemplateId=this.GetSigningTemplateId(),this.LastPostedDocsignRecipients=this.GetSigningRecipients(),this.LastPostedDocsignRecipients=this.LastPostedDocsignRecipients.map((e=>"string"==typeof e?{EmailAddress:e}:e)),axios({method:"post",url:this.CleverForms.DocumentSigningPostApi,data:{InstanceId:this.CleverForms.GetInstanceGuid(),ExternalTemplateId:this.LastPostedDocsignTemplateId,QuestionName:this.Config.Name,Recipients:this.LastPostedDocsignRecipients}}).then(this._postedDoc).catch(this._postDocError))}}_postedDoc(e){if("Form"===this.CleverForms.Form.ViewType){var t,i=$a.Lang.ReturnPath("app.cf.design_items.docsign_send_success");$a.isObject(e.data)&&e.data.hasOwnProperty("Success")?e.data.Success?(i=$a.Lang.ReturnPath("app.cf.design_items.docsign_send_success"),this.CanSend=!1,this.Config.Details.Value.CanSend=!1,this.Config.Details.Value.Recipients=this.LastPostedDocsignRecipients,$a.isPropString(e.data,"SignatureRequestId")&&""!==e.data.SignatureRequestId.trim()&&(this.Config.Details.Value.SignatureRequestId=e.data.SignatureRequestId),this.FormRowNode&&this.FormRowNode.classList.contains("error")&&this.FormRowNode.classList.remove("error")):(i=$a.isPropString(e.data,"ErrorMessage")&&""!==e.data.ErrorMessage.trim()?e.data.ErrorMessage:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_send_error"),(t=this._returnBackendErrors(i))!==i&&(i=t),e.data.hasOwnProperty("MissingCustomFields")&&$a.isArray(e.data.MissingCustomFields)&&e.data.MissingCustomFields.length>0&&(this.CanSend=!0,i=this._getMissingFieldsMessage(e.data.MissingCustomFields))):(i=$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_send_error"),(t=this._returnBackendErrors(i))!==i&&(i=t),this.CanSend=!0),$a.HidePageLoader(),$a.Dialog.Show({message:i,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"}),this._checkDocSignButtons()}}_postDocError(e){this.CleverForms.IsErrorPage(e)&&console.error("Post DocSign Error (_postDocError)\nError:\n{0}\n ".format(this.CleverForms.GetErrorPageOutputString(e))),$a.HidePageLoader(),this.CanSend=!0;var t=$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_send_error"),i=this._returnBackendErrors(t);i!==t&&(t=i),$a.Dialog.Show({message:t,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"}),this._checkDocSignButtons()}_postDocCancel(){"Form"===this.CleverForms.Form.ViewType&&($a.ShowPageLoader(),this.PostDocCancelButtonNode.classList.remove("hidden"),this.PostDocCancelButtonNode.classList.add("disabled"),this.PostDocButtonNode.classList.remove("hidden"),this.PostDocButtonNode.classList.add("disabled"),axios({method:"post",url:this.CleverForms.DocumentSigningCancelApi,data:{InstanceId:this.CleverForms.GetInstanceGuid(),QuestionName:this.Config.Name}}).then(this._postDocCanceled).catch(this._postDocCancelError))}_postDocCanceled(e){if("Form"===this.CleverForms.Form.ViewType){var t,i=$a.Lang.ReturnPath("app.cf.design_items.docsign_cancel_success");$a.isObject(e.data)&&e.data.hasOwnProperty("Success")?e.data.Success?(i=$a.Lang.ReturnPath("app.cf.design_items.docsign_cancel_success"),this.CanSend=!0,$a.isPropBool(e.data,"CanSend")&&(this.Config.Details.Value.CanSend=!0),this.Config.Details.Value.Recipients=this.LastPostedDocsignRecipients,this.FormRowNode&&this.FormRowNode.classList.contains("error")&&this.FormRowNode.classList.remove("error")):(i=e.data.hasOwnProperty("ErrorMessage")&&""===e.data.ErrorMessage.trim()?e.data.ErrorMessage:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_cancel_error"),(t=this._returnBackendErrors(i))!==i&&(i=t),e.data.hasOwnProperty("MissingCustomFields")&&$a.isArray(e.data.MissingCustomFields)&&e.data.MissingCustomFields.length>0&&(i=this._getMissingFieldsMessage(e.data.MissingCustomFields),this.CanSend=!1)):(i=$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_cancel_error"),(t=this._returnBackendErrors(i))!==i&&(i=t),this.CanSend=!1),$a.HidePageLoader(),$a.Dialog.Show({message:i,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"}),this._checkDocSignButtons()}}_postDocCancelError(e){this.CleverForms.IsErrorPage(e)&&(console.log("_postDocCancelError"),console.log(this.CleverForms.GetErrorPageOutputString(e)),console.log("")),$a.HidePageLoader(),this.CanSend=!1;var t=$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_cancel_error"),i=this._returnBackendErrors(t);i!==t&&(t=i),$a.Dialog.Show({message:t,showOk:!0,showCancel:!1,showInput:!1,textAlign:"left"}),this._checkDocSignButtons()}_getMissingFieldsMessage(e){var t,i,s=[],o=[],a="",n="&nbsp;&nbsp;&nbsp;&nbsp;",r=null,l=null;return e.forEach(function(e){document.querySelector('div[data-name="{0}"]'.format(e.QuestionName))?(t=document.querySelector('div[data-name="{0}"]'.format(e.QuestionName)),i=t.querySelector("label")?t.querySelector("label").innerText.trim():"",t.querySelector("input, select, textarea"),t.classList.add("error"),""!==i?s.push(i):s.push(e.FieldName)):o.push(e.FieldName)}.bind(this)),s.length+o.length>0&&(s.length+o.length>14?(s.length>0&&(r='<div class="indent">'+s.join(", ")+"</div>"),o.length>0&&(l='<div class="indent">'+o.join(", ")+"</div>")):(this.ShortenFieldLists&&(s.length>7&&((e=s.slice(0,5)).push("..."),e.push(s[s.length-1]),s=e),o.length>7&&((e=o.slice(0,5)).push("..."),e.push(o[o.length-1]),o=e)),s.length>0&&(r=s.join("<br>"+n)),o.length>0&&(l=o.join("<br>"+n)))),null!==r&&(a+="{prefix}<br>{tab}{list}<br>{suffix}".format({tab:n,prefix:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_invalid_fields"),list:r,suffix:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_invalid_fields_message")})),null!==l&&(null!==r&&(a+="<br><br>"),a+="{prefix}<br>{tab}{list}<br>{suffix}".format({tab:n,prefix:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_missing_fields"),list:l,suffix:$a.Lang.ReturnPath("app.cf.design_items.docsign_generic_missing_fields_message")})),a}_returnBackendErrors(e){var t,i,s,o=e;return("send error"==(e=e.toLowerCase().trim())||e.contains("Error while sending signature request")||e.contains("send your request. Please try again later"))&&(t="app.cf.backend_sub_errors.send_error",o=$a.Lang.ReturnPath(t)),("deleted"==e||e.contains("This resource has been deleted")||e.contains("already been cancelled"))&&(t="app.cf.backend_sub_errors.deleted",o=$a.Lang.ReturnPath(t)),("cancel error: already completed"==e||e.contains("???")||e.contains("???"))&&(t="app.cf.backend_sub_errors.cancel_error_already_completed",o=$a.Lang.ReturnPath(t)),(e.startsWith("not enough recipients. required:")||e.contains("you need to provide "))&&(i=1,isNaN(parseInt(e.replace(/\D/g,"")))||(i=parseInt(e.replace(/\D/g,""))),e.contains(":")&&(i=parseInt(e.split(":")[1])),t="app.cf.backend_sub_errors.not_enough_recipients",o=$a.Lang.ReturnPath(t,{num:i})),(e.startsWith("too many recipients. max required:")||e.contains("you have entered more than the required")||e.contains("please remove the extra signatories"))&&(s=1,isNaN(parseInt(e.replace(/\D/g,"")))||(s=parseInt(e.replace(/\D/g,""))),e.contains(":")&&(s=parseInt(e.split(":")[1])),t="app.cf.backend_sub_errors.too_many_recipients_1_required",s>1&&(t="app.cf.backend_sub_errors.too_many_recipients_n_required"),o=$a.Lang.ReturnPath(t,{max:s})),o}_setReadyOnly(){this.DocSignSelectNode&&(this.DocSignSelectNode.setAttribute("disabled","disabled"),this.DocSignSelectNode.hasOwnProperty("widgets")&&this.DocSignSelectNode.widgets.hasOwnProperty("Autocomplete")&&$a.isNode(this.DocSignSelectNode.widgets.Autocomplete.displayNode)&&this.DocSignSelectNode.widgets.Autocomplete.displayNode.setAttribute("disabled","disabled")),this.FormRowNode&&this.FormRowNode.querySelector(".docsign-row input.sv")&&this.FormRowNode.querySelectorAll(".docsign-row input.sv").forEach((function(e){e.setAttribute("disabled","disabled")}))}_unsetReadyOnly(){this.DocSignSelectNode&&(this.DocSignSelectNode.removeAttribute("disabled"),this.DocSignSelectNode.hasOwnProperty("widgets")&&this.DocSignSelectNode.widgets.hasOwnProperty("Autocomplete")&&$a.isNode(this.DocSignSelectNode.widgets.Autocomplete.displayNode)&&this.DocSignSelectNode.widgets.Autocomplete.displayNode.removeAttribute("disabled")),this.FormRowNode&&this.FormRowNode.querySelector(".docsign-row input.sv")&&this.FormRowNode.querySelectorAll(".docsign-row input.sv").forEach((function(e){e.removeAttribute("disabled")})),this._checkRecipientValidation()}_checkRecipientValidation(){if(this.FormRowNode&&""!==this.DocSignSelectNode.value){for(var e=!1,t=!1,i=this.FormRowNode.querySelectorAll(".docsign-row input.sv"),s=0;s<i.length;s++){if(i[s]&&""!==i[s].value.trim()&&i[s].classList.contains("error")){e=!0;break}i[s]&&""!==i[s].value.trim()&&!i[s].classList.contains("error")&&(t=!0)}if(e||!t)return void this.PostDocButtonNode.classList.add("disabled");!e&&t&&this.PostDocButtonNode.classList.remove("disabled")}this.FormRowNode&&""===this.DocSignSelectNode.value&&this.PostDocButtonNode.classList.add("disabled")}_checkDocSignButtons(){"ViewOnly"===this.CleverForms.Form.ViewType?(this.PostDocCancelButtonNode.classList.add("disabled"),this.PostDocCancelButtonNode.classList.remove("hidden"),this.PostDocButtonNode.classList.add("disabled"),this.PostDocButtonNode.classList.remove("hidden"),this._setReadyOnly()):this.CanSend?(this.PostDocCancelButtonNode.classList.add("disabled"),this.PostDocCancelButtonNode.classList.remove("hidden"),this.PostDocButtonNode.classList.remove("disabled"),this.PostDocButtonNode.classList.remove("hidden"),this._unsetReadyOnly()):(this.PostDocCancelButtonNode.classList.remove("disabled"),this.PostDocCancelButtonNode.classList.remove("hidden"),this.PostDocButtonNode.classList.add("disabled"),this.PostDocButtonNode.classList.add("hidden"),this._setReadyOnly())}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{templateLabel}</label>\n      <div class="select working">\n        <select class="docsign-template-ids"></select>\n      </div>\n      <span class="docsign-error red inline hidden"></span>\n      <p class="desc docsign-template-desc"></p>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <div class="docsign-fields">\n        <div class="docsign-row">\n          <label>{templateLabel}</label>\n          <div class="select">\n            <select class="docsign-template-ids"></select>\n          </div>\n        </div>\n        <div class="docsign-row">\n          <label>{recipientLabel} 1{required}</label>\n          <input type="text" class="ui-has-email no-row-error" value="" />\n        </div>\n        <div class="docsign-row">\n          <label>{recipientLabel} 2</label>\n          <input type="text" class="ui-has-email required-override no-row-error" value="" />\n        </div>\n        <div class="docsign-row">\n          <label>{recipientLabel} 3</label>\n          <input type="text" class="ui-has-email required-override no-row-error" value="" />\n        </div>\n        <div class="docsign-row">\n          <label>{recipientLabel} 4</label>\n          <input type="text" class="ui-has-email required-override no-row-error" value="" />\n        </div>\n        <div class="docsign-row">\n          <label></label>\n          <div class="row-inline-buttons">\n            <div class="button grey send-doc-cancel hidden"><span class="icon-cross"></span>{cancelLabel}</div>\n            <div class="button dark-blue send-doc hidden"><span class="icon-mail-tick"></span>{sendLabel}</div>\n          </div>\n      </div>\n      <span class="docsign-error red inline hidden"></span>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row row-documentsigning">\n        <label class="solo">{label}</label>\n        <div class="docsign-fields">\n          <div class="docsign-row">\n            <label>{templateLabel}</label>\n            <div class="select">\n              <select class="">\n                <option>Employee Contract</option>\n              </select>\n            </div>\n          </div>\n          <div class="docsign-row">\n            <label>{recipientLabel} 1</label>\n            <input type="text" class="ui-has-email no-row-error" value="name@email.com" />\n          </div>\n          <div class="docsign-row">\n            <label>{recipientLabel} 2</label>\n            <input type="text" class="ui-has-email no-row-error" value="name@email.com" />\n          </div>\n          <div class="docsign-row">\n            <label>{recipientLabel} 3</label>\n            <input type="text" class="ui-has-email no-row-error" value="name@email.com" />\n          </div>\n          <div class="docsign-row">\n            <label>{recipientLabel} 4</label>\n            <input type="text" class="ui-has-email no-row-error" value="name@email.com" />\n          </div>\n          <div class="docsign-row">\n            <label></label>\n            <div class="row-inline-buttons">\n              <div class="button grey send-doc-cancel"><span class="icon-cross"></span>{cancelLabel}</div>\n              <div class="button dark-blue send-doc"><span class="icon-mail-tick"></span>{sendLabel}</div>\n            </div>\n          </div>\n        <div>\n      </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Drawpanel=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Drawpanel"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_imageSet"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.drawpanel_example_label")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("generic.buttons.uploadimages"),choose:$a.Lang.ReturnPath("generic.buttons.chooseimages")}),!!super.SetDesignEditor()&&(this.PopupNode.classList.add("large"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t;if(this.IsReadOnly){var i=null===this.Config.Details.Value||""===this.Config.Details.Value.trim()?"hidden":"";t=this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,src:"hidden"===i?"":this.Config.Details.Value,state:i}),this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode.querySelector("img").onload=function(){this.FormRowNode&&this.CleverForms.Form&&this.CleverForms.Form.ResizeSection(this.FormRowNode)}.bind(this)}else t=this.HtmlRowTemplate.format({label:this.Config.Details.Label,value:$a.isString(this.Config.Details.Value)&&this.Config.Details.Value.startsWith("data:image")?this.Config.Details.Value:"",fileIds:null!==this.Config.Details.FileId?this.Config.Details.FileId:"",fileNames:null!==this.Config.Details.FileName?this.Config.Details.FileName:"",getApi:this.CleverForms.FileGetInfoApi,downloadApi:this.CleverForms.FileGetApi}),this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode.querySelector("input").addEventListener("imageSet",this._imageSet);if(this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-drawpanel").widgets.DrawPanel;return this.FormData.Value=e.Get(),this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_imageSet(e){this.FormRowNode&&Affinity2018.Apps.CleverForms.Form&&Affinity2018.Apps.CleverForms.Form.ResizeSection(this.FormRowNode)}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <label class="ui-has-file">\n        <input type="file" name="FileId" data-allow-multiple="true" data-file-ids="" />\n        <div class="button blue upload"><span class="icon-file-black"></span>{choose}</div>\n      </label>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <input type="text" value="" class="ui-has-drawpanel" />\n      </div>\n      </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" value="{value}" class="ui-has-drawpanel" data-file-ids="{fileIds}" data-file-names="{fileNames}" data-get-api="{getApi}" data-download-api="{downloadApi}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <img src="{src}" class="{state}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.EffectiveDate=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"EffectiveDate"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t="",i="",s="",o="";if("AffinityField"===this.Config.Type&&this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(this.IsReadOnly=!0,this.Config.Details.IsReadOnly=!0),i=null,$a.isPropString(this.Config.Details,"Value")&&""!==this.Config.Details.Value.trim()&&(i=$a.stringToDate(this.Config.Details.Value)),this.IsReadOnly){var a="";null!==i&&(a=i.toString("ddd dS MMM, yyyy")),o=this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,value:a})}else s+=' data-calendar-return-format="'+(t="dd/MM/yyyy")+'"',null!==i&&(s+=' data-start-date="'+i.toString(t)+'"',i=i.toString(t)),s+=' data-calendar-nullable="true"',o=this.HtmlRowTemplate.format({label:this.Config.Details.Label,type:this.Config.Details.DateTimeType,date:i,dataset:s.trim()});if(this.FormRowNode=super.SetFormRow(e,o),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-calendar"),t=(e.parentNode.parentNode,e.widgets.DateTime),i=t.getRawDate();return""!==e.value.trim()&&!1!==i?this.FormData.Value=i.toString(t.outputFormat):this.FormData.Value="",this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){var t="",i=this.IsReadOnly?this.FormRowNode.querySelector("input"):this.FormRowNode.querySelector("input.ui-calendar"),s=!this.IsReadOnly&&i.widgets.DateTime;!$a.isString(e)||""!==e.trim()&&"null"!==e.trim()?($a.isString(e)&&$a.isDateValid($a.stringToDate(e))&&(e=$a.stringToDate(e)),$a.isDateValid(e)&&(s?s.setDate(e):(t="",t+="ddd dS MMM, yyyy",i.value=e.toString(t)))):s?s.setNone():i.value=""}_templates(){super._templates(),this.HtmlEditTemplate="\n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>Date</label>\n        <input type="text" class="ui-has-calendar effective-date" data-type="date" data-start-date="now" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row calendar">\n      <label>{label}</label>\n      <input type="text" class="ui-has-calendar" data-type="{type}" {dataset} value="{date}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Email=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Email"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.Value);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData.Value=this.FormRowNode.querySelector("input.sv").value,this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){super.SetFromValue(e)}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>Email</label>\n        <input type="text" value="name@email.com" class="ui-has-email" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <input type="text" class="ui-has-email" value="{1}"/>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Explanation=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Explanation"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){if(this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({example:$a.Lang.ReturnPath("app.cf.design_items.explaination_example")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.explaination_label"),arrowLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_arrow_label"),noneLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_none_label"),topLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_top_label"),rightLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_right_label"),bottomLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_bottom_label"),leftLabel:$a.Lang.ReturnPath("app.cf.design_items.explaination_left_label")}),super.SetDesignEditor()){var e=-1,t=this.Config.Details.Text||"";return this.TemplateNode.querySelector("textarea").value=t.trim(),$a.isPropString(this.Config.Details,"ArrowDirection")?isNaN(parseInt(this.Config.Details.ArrowDirection))?this.TemplateNode.querySelector("select.ArrowDirection").value=this.Config.Details.ArrowDirection.toLowerCase().trim():e=parseInt(this.Config.Details.ArrowDirection):isNaN(parseInt(this.Config.Details.ArrowDirection))||(e=parseInt(this.Config.Details.ArrowDirection)),-1!==e&&this.CleverForms.ArrowTypeEnum.hasOwnProperty(e)&&(this.TemplateNode.querySelector("select.ArrowDirection").value=this.CleverForms.ArrowTypeEnum[e].value),!0}return!1}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.Text=this.TemplateNode.querySelector("textarea").value,this.Config.Details.ArrowDirection=this.TemplateNode.querySelector("select.ArrowDirection").value,this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.ArrowDirection.toLowerCase().trim(),this.Config.Details.Text);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</div>\n      <textarea class="LongText"></textarea>\n    </div>\n    <br />\n    <br />\n    <div class="edit-row">\n      <label>{arrowLabel}</label>\n      <div class="select">\n        <select class="ArrowDirection">\n          <option value="none">{noneLabel}</option>\n          <option value="top">{topLabel}</option>\n          <option value="right">{rightLabel}</option>\n          <option value="bottom">{bottomLabel}</option>\n          <option value="left">{leftLabel}</option>\n        </select>\n      </div>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <div class="help-bubble explain bottom">{example}</div>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n      <div class="form-row">\n        <div class="help-bubble explain {0}">{1}</div>\n      </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.FileUploadMulti=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options(),this.DocumentCategories=null,this.DocumentTypes=null,this.UseAutocomplets=!0}constructor(e){return super(e,"FileUploadMulti"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_checkHideables","_getDocumentCategories","_getDocumentTypes","_loadNames"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditTemplate=this.HtmlEditTemplate.format({empLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_radio_employee_label"),posLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_radio_position_label"),formOnlyLable:$a.Lang.ReturnPath("app.cf.design_items.file_upload_radio_formonly_label"),catLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_category_label"),typeLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_type_label"),secLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_security_label"),secEmpLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_security_emp_label"),secManLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_security_manager_label"),secPayrollLabel:$a.Lang.ReturnPath("app.cf.design_items.file_upload_security_payroll_label")}),this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("generic.buttons.uploadfile"),choose:$a.Lang.ReturnPath("generic.buttons.choosefile")}),!!super.SetDesignEditor()&&(this.AttachOnlyTrueNode=this.PopupNode.querySelector("input.attach-employee"),this.AttachOnlyFalseNode=this.PopupNode.querySelector("input.attach-form"),this.AttachPositionNode=this.PopupNode.querySelector("input.attach-position"),this.DocCatsNode=this.TemplateNode.querySelector(".document-category div.select"),this.DocCatsSelectNode=this.DocCatsNode.querySelector("select"),this.DocTypeNode=this.TemplateNode.querySelector(".document-type div.select"),this.DocTypeSelectNode=this.DocTypeNode.querySelector("select"),this.DocSecurityLevelNode=this.TemplateNode.querySelector(".document-security-level div.select"),this.DocSecurityLevelSelectNode=this.DocSecurityLevelNode.querySelector("select"),void 0===this.Config.Details.SecurityLevel?this.DocSecurityLevelSelectNode.value="20":this.DocSecurityLevelSelectNode.value=this.Config.Details.SecurityLevel,this.UseAutocomplets&&Affinity2018.Apps.Plugins.Autocompletes.Apply(this.DocSecurityLevelSelectNode),this.Config.Details.AttachFormOnly?(this.AttachOnlyTrueNode.checked=!1,this.AttachOnlyFalseNode.checked=!0,this.AttachPositionNode.checked=!1,this.AttachOnlyTrueNode.removeAttribute("checked"),this.AttachPositionNode.removeAttribute("checked")):(this.AttachOnlyTrueNode.checked=!0,this.AttachOnlyFalseNode.checked=!1,this.AttachPositionNode.checked=!1,this.AttachOnlyFalseNode.removeAttribute("checked"),this.AttachPositionNode.removeAttribute("checked"),this.DocSecurityLevelNode.classList.remove("hide")),[11,"11","Position"].contains(this.Config.Details.DocumentCategory)&&(this.AttachOnlyTrueNode.checked=!1,this.AttachOnlyFalseNode.checked=!1,this.AttachPositionNode.checked=!0,this.AttachOnlyTrueNode.removeAttribute("checked"),this.AttachOnlyFalseNode.removeAttribute("checked")),this.PreselctCategory="",this.DocCatsSelectNode.addEventListener("change",this._getDocumentTypes),this.AttachOnlyTrueNode.addEventListener("click",this._checkHideables),this.AttachOnlyFalseNode.addEventListener("click",this._checkHideables),this.AttachPositionNode.addEventListener("click",this._checkHideables),this._checkHideables(),this._getDocumentCategories(),this.PopupNode.classList.add("large"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()&&(this.DocCatsSelectNode.removeEventListener("change",this._getDocumentTypes),this.AttachOnlyTrueNode.removeEventListener("click",this._checkHideables),this.AttachOnlyFalseNode.removeEventListener("click",this._checkHideables),!0)}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.DocumentCategory=this.DocCatsSelectNode.value,this.Config.Details.DocumentType=this.DocTypeSelectNode.value,this.Config.Details.SecurityLevel=this.DocSecurityLevelSelectNode.value,this.AttachOnlyTrueNode.checked&&(this.Config.Details.AttachFormOnly=!1),this.AttachOnlyFalseNode.checked&&(this.Config.Details.DocumentCategory="",this.Config.Details.AttachFormOnly=!0),this.AttachPositionNode.checked&&(this.Config.Details.DocumentCategory="Position",this.Config.Details.AttachFormOnly=!1),this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){this.DocTypeSelectNode&&$a.isNode(this.DocTypeSelectNode)&&(this.DocTypeSelectNode.innerHTML=""),this.DocCatsSelectNode&&$a.isNode(this.DocCatsSelectNode)&&(this.DocCatsSelectNode.value="");var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t,i="";t=(t=(t=this.Config.Details.Value.toString()).split(",").removeEmpty().removeDuplicates()).map((function(e){return e+""})),this.IsReadOnly||"ViewOnly"===this.CleverForms.ViewType?(i=this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,fileids:t.length>0?"File Ids: "+t.join(", "):"No Files.",choose:$a.Lang.ReturnPath("generic.buttons.choosefile")}),this._loadNames()):i=this.HtmlRowTemplate.format({label:this.Config.Details.Label,fileids:this.Config.Details.Value,choose:$a.Lang.ReturnPath("generic.buttons.choosefile")}),this.FormRowNode=super.SetFormRow(e,i),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return $a.isNode(this.FileNode)&&null!==this.FileWidget&&(this.FormData.Value=this.FileWidget.GetFileIds()),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_checkHideables(){this.PreselctCategory="",this.AttachOnlyFalseNode.checked?(this.DocCatsNode.parentNode.classList.add("hide"),this.DocTypeNode.parentNode.classList.add("hide"),this.DocSecurityLevelNode.parentNode.classList.add("hide")):this.AttachOnlyTrueNode.checked?(this.PreselctCategory="Employee",this.DocCatsNode.parentNode.classList.remove("hide"),this.DocTypeNode.parentNode.classList.remove("hide"),this.DocSecurityLevelNode.parentNode.classList.remove("hide"),this._getDocumentTypes()):this.AttachPositionNode.checked&&(this.PreselctCategory="Position",this.DocCatsNode.parentNode.classList.add("hide"),this.DocTypeNode.parentNode.classList.remove("hide"),this.DocSecurityLevelNode.parentNode.classList.remove("hide"),this._getDocumentTypes())}_getDocumentCategories(){var e,t,i=null;if(null===this.DocumentCategories)this.DocCatsNode.classList.add("working"),axios({url:this.CleverForms.GetDocumentCategory,method:"GET"}).then(function(s){if("data"in s&&["object","array"].contains($a.type(s.data))){for(e in this.DocCatsSelectNode.hasOwnProperty("widgets")&&this.DocCatsSelectNode.widgets.hasOwnProperty("Autocomplete")&&this.DocCatsSelectNode.widgets.Autocomplete.Destroy(),this.DocumentCategories={},this.DocCatsSelectNode.innerHTML="",s.data)this.DocumentCategories[e]=e.splitCamelCase(),s.data.hasOwnProperty(e)&&"Position"!==e&&"Performance"!==e&&((t=document.createElement("option")).innerHTML=this.DocumentCategories[e],t.value=e,this.Config.Details.DocumentCategory===e&&(t.selected="selected",i=e),this.DocCatsSelectNode.appendChild(t));null!==i&&(this.DocCatsSelectNode.value=i,this._getDocumentTypes()),null===i&&null!==this.DocCatsSelectNode.value&&this._getDocumentTypes()}this.DocCatsNode.classList.remove("working"),this.UseAutocomplets&&Affinity2018.Apps.Plugins.Autocompletes.Apply(this.DocCatsSelectNode)}.bind(this)).catch(function(e){console.log("GetDocumentCategory ERROR"),console.log(e),this.DocCatsNode.classList.remove("working")}.bind(this));else{for(e in this.DocCatsSelectNode.hasOwnProperty("widgets")&&this.DocCatsSelectNode.widgets.hasOwnProperty("Autocomplete")&&this.DocCatsSelectNode.widgets.Autocomplete.Destroy(),this.DocCatsSelectNode.innerHTML="",this.DocumentCategories)this.DocumentCategories.hasOwnProperty(e)&&"Position"!==e&&"Performance"!==e&&((t=document.createElement("option")).innerHTML=this.DocumentCategories[e],t.value=e,this.Config.Details.DocumentCategory===e&&(t.selected="selected",i=e),this.DocCatsSelectNode.appendChild(t));null!==i?(this.DocCatsSelectNode.value=i,this._getDocumentTypes()):this.DocCatsSelectNode.value="",this.DocCatsNode.classList.remove("working"),this.UseAutocomplets&&Affinity2018.Apps.Plugins.Autocompletes.Apply(this.DocCatsSelectNode)}}_getDocumentTypes(){if(""===this.PreselctCategory.trim())this.DocTypeSelectNode.hasOwnProperty("widgets")&&this.DocTypeSelectNode.widgets.hasOwnProperty("Autocomplete")&&this.DocTypeSelectNode.widgets.Autocomplete.Destroy(),this.DocTypeNode.parentNode.classList.add("hide"),this.DocTypeNode.classList.remove("working"),this.DocTypeSelectNode.innerHTML="";else{this.DocTypeSelectNode.hasOwnProperty("widgets")&&this.DocTypeSelectNode.widgets.hasOwnProperty("Autocomplete")&&this.DocTypeSelectNode.widgets.Autocomplete.Destroy(),this.DocTypeNode.parentNode.classList.remove("hide"),this.DocTypeNode.classList.add("working");var e="Position"===this.PreselctCategory.trim()?this.PreselctCategory.trim():this.DocCatsSelectNode.value,t=null!=e&&$a.isString(e)&&""!==e.trim()?e.trim():"";if(null===t||""===t)return;axios({url:this.CleverForms.GetDocumentTypes+"?documentCategory="+t,method:"GET"}).then(function(e){this.DocTypeSelectNode.innerHTML="";var t,i=null;if((t=document.createElement("option")).innerHTML="Any",t.value="0",this.DocTypeSelectNode.appendChild(t),$a.isPropArray(e,"data"))for(var s=0;s<e.data.length;s++)(t=document.createElement("option")).innerHTML=e.data[s].Name,t.value=e.data[s].Id,this.Config.Details.DocumentType!==e.data[s].Id&&parseInt(this.Config.Details.DocumentType)!=e.data[s].Id||(t.selected="selected",i=e.data[s].Id),this.DocTypeSelectNode.appendChild(t);this.DocTypeSelectNode.value=null!==i?i:0,this.DocTypeNode.classList.remove("working"),this.UseAutocomplets&&Affinity2018.Apps.Plugins.Autocompletes.Apply(this.DocTypeSelectNode)}.bind(this)).catch(function(e){console.log("GetDocumentTypes ERROR"),console.log(e),this.DocTypeNode.classList.remove("working")}.bind(this))}}_loadNames(){var e=this.Config.Details.Value.toString().split(",").removeEmpty().removeDuplicates();axios({method:"GET",url:this.CleverForms.FileGetInfoApi+"?fileIds="+e}).then(function(t){if($a.isPropObject(t,"data")&&$a.isPropObject(t.data,"data")){for(var i=t.data.data,s=0,o=[];s<e.length;s++)i.hasOwnProperty(e[s])?o.push('<a href="'+this.CleverForms.FileGetApi+"?documentId="+e[s]+'" target="_blank">'+i[e[s]]+"</a>"):o.push(e[s]);o.length>0&&(this.FormRowNode.innerHTML=this.HtmlRowReadOnlyNamesTemplate.format({label:this.Config.Details.Label,links:o.join("<br />")}))}}.bind(this)).catch((function(){}))}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row inline-radio">\n      <input type="radio" name="AttachOptions" class="attach-employee" id="_AttachFormOnlyFalse" checked />\n      <label for="_AttachFormOnlyFalse">{empLabel}</label>\n    </div>\n    <div class="edit-row inline-radio">\n      <input type="radio" name="AttachOptions" class="attach-position" id="_AttachPosition" />\n      <label for="_AttachPosition">{posLabel}</label>\n    </div>\n    <div class="edit-row inline-radio">\n      <input type="radio" name="AttachOptions" class="attach-form" id="_AttachFormOnlyTrue" />\n      <label for="_AttachFormOnlyTrue">{formOnlyLable}</label>\n    </div>\n    <div class="edit-row document-category hidable">\n      <label>{catLabel}</label>\n      <div class="select working">\n        <select class="DocumentCategory" name="DocumentCategory">\n          <option value=""></option>\n        </select>\n      </div>\n    </div>\n    <div class="edit-row document-type hidable">\n      <label>{typeLabel}</label>\n      <div class="select working">\n        <select class="DocumentType" name="DocumentType">\n          <option value=""></option>\n        </select>\n      </div>\n    </div>\n    <div class="edit-row document-security-level hidable">\n      <label>{secLabel}</label>\n      <div class="select">\n         <select class="SecurityLevel" name="SecurityLevel">\n           <option value="0">{secEmpLabel}</option>\n           <option value="10">{secManLabel}</option>\n           <option value="20">{secPayrollLabel}</option>\n         </select>\n       </div>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div data-template-name="FileUploadMulti" class="template template-FileUploadMulti form-row upload-multi">\n      <label>{label}</label>\n      <label class="ui-has-file">\n        <input type="file" data-allow-multiple="true" />\n        <div class="button blue upload">\n          <span class="icon-file-black"></span>{choose}\n        </div>\n      </label>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <label class="ui-has-file" data-files="{fileids}">\n        <input type="file" data-allow-multiple="true" />\n        <div class="button blue upload">\n          <span class="icon-file-black"></span>{choose}\n        </div>\n      </label>\n    </div>\n    ',this.HtmlRowWithDescTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <p class="inline">{desc}</p>\n      <label></label>\n      <label class="ui-has-file" data-files="{fileids}">\n        <input type="file" data-allow-multiple="true" />\n        <div class="button blue upload">\n          <span class="icon-file-black"></span>{choose}\n        </div>\n      </label>\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{fileids}" />\n    </div>\n    ',this.HtmlRowReadOnlyWithDescTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <p class="inline">{desc}</p>\n      <label></label>\n      <input type="text" disabled value="{fileids}" />\n    </div>\n    ',this.HtmlRowReadOnlyNamesTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <div class="row-content">{links}</div>\n    </div>\n    ',this.HtmlRowReadOnlyNamesWithDescTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <p class="inline">{desc}</p>\n      <label></label>\n      <div class="row-content">{links}</div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Float=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Float"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.float_example_label"),value:$a.Lang.ReturnPath("app.cf.design_items.float_example_value")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.float_decimal_label")}),!!super.SetDesignEditor()&&(this.TemplateNode.querySelector("select.DecimalNumber").value=this.Config.Details.DecimalNumber,!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.DecimalNumber=isNaN(parseInt(this.TemplateNode.querySelector("select.DecimalNumber").value))?2:parseInt(this.TemplateNode.querySelector("select.DecimalNumber").value),this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.Config.Details.DecimalNumber||2,i=this.Config.Details.Rounding||"round",s=this.HtmlRowTemplate.format({label:this.Config.Details.Label,decimals:t,rounding:i,value:this.Config.Details.Value});if(this.FormRowNode=super.SetFormRow(e,s),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormRowNode&&!isNaN(parseFloat(this.FormRowNode.querySelector("input.nv").value))?this.FormData.Value=parseFloat(this.FormRowNode.querySelector("input.nv").value):this.FormData.Value=null,this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){super.SetFromValue(e)}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <div class="select">\n        <select class="DecimalNumber">\n          <option value="1">1</option>\n          <option selected value="2">2</option>\n          <option value="3">3</option>\n          <option value="4">4</option>\n          <option value="5">5</option>\n        </select>\n      </div>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <input type="text" class="ui-has-float" value="{value}" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" class="ui-has-float" data-decimals="{decimals}" data-rounding="{rounding}" value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Integer=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Integer"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.integer_example_label"),value:$a.Lang.ReturnPath("app.cf.design_items.integer_example_value")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.Value);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormRowNode&&!isNaN(parseInt(this.FormRowNode.querySelector("input.nv").value))?this.FormData.Value=parseInt(this.FormRowNode.querySelector("input.nv").value):this.FormData.Value=null,this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){super.SetFromValue(e)}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <input type="number" class="ui-has-integer" value="{value}" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <input type="number" class="ui-has-integer" value="{1}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Link=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Link"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.link_label")}),this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({link:$a.Lang.ReturnPath("app.cf.design_items.link_example")}),!!super.SetDesignEditor()&&($a.isPropString(this.Config.Details,"UrlLink")&&(this.TemplateNode.querySelector("input").value=this.Config.Details.UrlLink.trim()||""),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.UrlLink=this.TemplateNode.querySelector("input").value.trim(),this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.UrlLink);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){super.SetFromValue(e)}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <input type="text" class="ui-has-url" />\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <a href="#" target="_blank" class="link">{link}</a>\n        <div class="print-only link"></div>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <a href="{1}" target="_blank" class="link">{0}</a>\n      <div class="print-only link">{0} : {1}</div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Memo=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Memo"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.memo_example_lebel"),example:$a.Lang.ReturnPath("app.cf.design_items.memo_example")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format({label:this.Config.Details.Label,value:this.Config.Details.Value,disabled:"ViewOnly"===this.CleverForms.ViewType?"disabled":""});if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData.Value=this.FormRowNode.querySelector("textarea").value.trim(),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <br />\n        <textarea rows="3" class="memo">{example}</textarea>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <br />\n      <textarea rows="3" class="memo" {disabled}>{value}</textarea>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.MultiSelect=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"MultiSelect"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","IsValid"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.multiselect_example_label"),example1:$a.Lang.ReturnPath("app.cf.design_items.multiselect_example_1"),example2:$a.Lang.ReturnPath("app.cf.design_items.multiselect_example_2"),example3:$a.Lang.ReturnPath("app.cf.design_items.multiselect_example_3")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode){var i,s,o,a,n;if("Preview"===this.CleverForms.ViewType)i=$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0?this.Config.Details.ItemSource.Items:[{Key:"",Value:"Check Example One"},{Key:"",Value:"Check Example Two"},{Key:"",Value:"Check Example Three"}],o=Object.keys(i[0]),i.forEach(function(e,t){(s=document.createElement("div")).classList.add("radio-label-pair"),s.innerHTML=this.HtmlCheckboxRowTemplate.format({id:"check-"+this.Config.Name+"-"+t,name:this.Config.Name,value:e[o[1]],label:e[o[0]],disabled:"ViewOnly"===this.CleverForms.ViewType?"disabled":""}),this.FormRowNode.appendChild(s)}.bind(this));else if($a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0&&(o=Object.keys(this.Config.Details.ItemSource.Items[0]),(i=this.Config.Details.ItemSource.Items).forEach(function(e,t){(s=document.createElement("div")).classList.add("radio-label-pair"),s.innerHTML=this.HtmlCheckboxRowTemplate.format({id:"check-"+this.Config.Name+"-"+t,name:this.Config.Name,value:e[o[1]],label:e[o[0]],disabled:"ViewOnly"===this.CleverForms.ViewType?"disabled":""}),this.FormRowNode.appendChild(s)}.bind(this)),a=$a.stringToObject(this.Config.Details.Value),$a.isArray(a)))for(var r=0;r<a.length;r++)a[r].hasOwnProperty("Value")&&$a.isBool(a[r].Value)&&(n="check-"+this.Config.Name+"-"+r,a[r].Value&&this.FormRowNode.querySelector("input#"+n)&&(this.FormRowNode.querySelector("input#"+n).checked=!0));return this.FormRowNode}}GetFromFormRow(){if(super.GetFromFormRow()){var e=[];return this.FormRowNode.querySelectorAll('input[type="checkbox"]').forEach(function(t){e.push({Key:t.value,Value:t.checked})}.bind(this)),this.FormData.Value=JSON.stringify(e),this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){$a.isString(e)&&$a.isStringifiedObject(e)&&(e=$a.stringToObject(e)),$a.isString(e)&&e.isNullOrEmpty()&&this.FormRowNode.querySelectorAll('input[type="checkbox"]:checked').forEach((function(e){e.checked=!1})),$a.isArray(e)&&e.length>0&&(this.FormRowNode.querySelectorAll('input[type="checkbox"]:checked').forEach((function(e){e.checked=!1})),keys=Object.keys(e[0]),dataList=this.Config.Details.ItemSource.Items,dataList.forEach(function(e,t){this.FormRowNode.querySelector('input[type="checkbox"][value="'+e[keys[1]]+'"]')&&(this.FormRowNode.querySelector('input[type="checkbox"][value="'+e[keys[1]]+'"]').checked=!0)}.bind(this)))}IsValid(){return!this.Config.Details.Required||null!=this.FormRowNode.querySelector('input[type="checkbox"]:checked')}_templates(){super._templates(),this.HtmlEditTemplate=this.ItemSourcesTemplate,this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label class="solo">{label}</label>\n        <div class="check-label-pair">\n          <input type="checkbox" id="afgadadfscheck1" name="afgadadfscheck1" />\n          <label for="afgadadfscheck1" class="right">{example1}</label>\n        </div>\n        <div class="check-label-pair">\n          <input type="checkbox" id="afgadadfscheck2" name="afgadadfscheck2" />\n          <label for="afgadadfscheck2" class="right">{example2}</label>\n        </div>\n        <div class="check-label-pair">\n          <input type="checkbox" id="afgadadfscheck3" name="afgadadfscheck3" />\n          <label for="afgadadfscheck3" class="right">{example3}</label>\n        </div>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label class="solo">{0}</label>\n    </div>\n    ',this.HtmlCheckboxRowTemplate='\n    <input type="checkbox" id="{id}" value="{value}" {disabled}/><label for="{id}" class="right">{label}</label>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Paragraph=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Paragraph"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){if(this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({example:$a.Lang.ReturnPath("app.cf.design_items.paragraph_example")}),this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.paragraph_label")}),super.SetDesignEditor()){var e=this.Config.Details.Text||"";return this.TemplateNode.querySelector("textarea").value=e.trim(),!0}return!1}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.Text=this.TemplateNode.querySelector("textarea").value.trim(),this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Text);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</div>\n      <textarea></textarea>\n    </div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <p>{example}</p>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <p>{0}</p>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Section=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_toggleSectionCollapse"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){if(super.SetDesignEditor()){this.PopupNode.classList.add("medium"),this.WorflowStatesListNode=this.PopupNode.querySelector(".worflow-states-list"),this.HideTitleCheckNode=this.PopupNode.querySelector("#_HideSectionTitle"),this.StartCollapsedCheckNode=this.PopupNode.querySelector("#_StartSectionCollapsed"),this.HelptextNode.classList.add("hidden"),this.WorflowStatesListNode.classList.add("hidden");var e,t,i,s,o,a,n,r=!1;if(this.Config.Details.hasOwnProperty("SectionWorkflowVisibilitySettings")&&$a.isArray(this.Config.Details.SectionWorkflowVisibilitySettings))for(e=0;e<this.Config.Details.SectionWorkflowVisibilitySettings.length;e++)if(null!==(i=this.Config.Details.SectionWorkflowVisibilitySettings[e]).WorkflowDefinitionName&&0!==i.WorkflowDefinitionId)for((o=document.createElement("div")).classList.add("workflow-header"),o.innerHTML=i.WorkflowDefinitionName,this.WorflowStatesListNode.appendChild(o),t=0;t<i.WorkflowStateSettings.length;t++)null!==(s=i.WorkflowStateSettings[t]).WorkflowStateName&&(o=document.createElement("div"),a=s.WorkflowStateName.toTitleCase(),n=s.IsHidden?"":" checked",o.classList.add("worflow-state","worflow-"+i.WorkflowDefinitionId+"-state-"+s.WorkflwoStateId),o.dataset.stateId=s.WorkflwoStateId,o.dataset.stateName=s.WorkflowStateName,o.innerHTML=this.HtmlWorkflowStateTemplate.format({stateChecked:n,stateLabel:$a.Lang.ReturnPath("app.cf.design_items.section_workflow_state_label",{stateName:a})}),this.WorflowStatesListNode.appendChild(o),r=!0);return r&&this.WorflowStatesListNode.classList.remove("hidden"),!1===this.Config.Details.ShowTitle?this.HideTitleCheckNode.checked=!0:(this.HideTitleCheckNode.checked=!1,this.HideTitleCheckNode.removeAttribute("checked")),this.Config.Details.StartCollapsed?this.StartCollapsedCheckNode.checked=!0:(this.StartCollapsedCheckNode.checked=!1,this.StartCollapsedCheckNode.removeAttribute("checked")),!0}return!1}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){if(super.GetFromDesignEditor()){var e,t,i,s,o;if(this.Config.Details.hasOwnProperty("SectionWorkflowVisibilitySettings"))for(e=0;e<this.Config.Details.SectionWorkflowVisibilitySettings.length;e++)for(i=this.Config.Details.SectionWorkflowVisibilitySettings[e],t=0;t<i.WorkflowStateSettings.length;t++)s=i.WorkflowStateSettings[t],o=this.WorflowStatesListNode.querySelector(".worflow-"+i.WorkflowDefinitionId+"-state-"+s.WorkflwoStateId+" input"),this.Config.Details.SectionWorkflowVisibilitySettings[e].WorkflowStateSettings[t].IsHidden=!o.checked;this.Config.Details.ShowTitle=!this.HideTitleCheckNode.checked,this.Config.Details.StartCollapsed=this.StartCollapsedCheckNode.checked}return this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);return t&&$a.isFunction(e)&&e(t),!0}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.Config.Details.ShowTitle?this.FormRowNode.classList.remove("hide-title"):this.FormRowNode.classList.add("hide-title"),this.Config.Details.StartCollapsed?this.FormRowNode.classList.add("start-collapsed"):this.FormRowNode.classList.remove("start-collapsed"),this.FormRowNode.querySelector(".collapser").addEventListener("click",this._toggleSectionCollapse),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_toggleSectionCollapse(){var e=!1;this.FormRowNode.classList.contains("collapsed")?(this.FormRowNode.classList.remove("collapsed"),this.FormRowNode.classList.add("animating"),e=!0):this.FormRowNode.classList.contains("collapsed")||(this.FormRowNode.classList.add("collapsed"),this.FormRowNode.classList.add("animating"),e=!0),e&&setTimeout(function(){this.FormRowNode.classList.remove("animating")}.bind(this),500)}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row inline-check">\n      <input type="checkbox" id="_HideSectionTitle" />\n      <label for="_HideSectionTitle">{sectionHidetitleLable}</label>\n    </div>\n    <div class="edit-row inline-check">\n      <input type="checkbox" id="_StartSectionCollapsed" />\n      <label for="_StartSectionCollapsed">{sectionCollapseLable}</label>\n    </div>\n    <div class="edit-row worflow-states-list-wrapper">\n      <div class="worflow-states-list">\n      </div>\n    </div>\n    ',this.HtmlWorkflowStateTemplate='\n    <div class="workflow-state-check"><input type="checkbox"{stateChecked} /><label>{stateLabel}</label></div>\n    ',this.HtmlEditExampleTemplate="\n\n    ",this.HtmlRowTemplate='\n    <div class="section shadow collapsable">\n      <div class="section-header">\n        <span class="section-title">{0}</span>\n      </div>\n      <div class="section-body">\n        <div class="default-form"></div>\n      </div>\n      <div class="collapser icon-unfold-less"></div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Separator=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return!!super.SetDesignEditor()&&(this.PopupNode.querySelector(".form-row.label-row").classList.add("hidden"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return super.GetFromDesignEditor(),this.Config}SetFromValue(e){}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate;if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlRowTemplate='\n    <div class="form-row">\n      <hr />\n    </div>\n\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.SingleSelectDropdown=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"SingleSelectDropdown"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","IsValid","_customListSelectWidgetReady"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=null;if(this.IsReadOnly||this.Config.Details.IsReadOnly)if(this.Config.Details.hasOwnProperty("ItemSource")&&this.Config.Details.ItemSource.hasOwnProperty("ItemSourceType")){if($a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0){var i=this.Config.Details.ItemSource.Items;for(var s in i){var o=i[s];if(null!==o&&o.Value===this.Config.Details.Value){t="Custom"===this.Config.Details.ItemSource.ItemSourceType?this.HtmlRowReadOnlyTemplate.format(this.Config.Details.Label,o.Key):this.HtmlRowReadOnlyTemplate.format(this.Config.Details.Label,o.Key.replace(" - ",", "));break}}}null===t&&(t=this.HtmlRowReadOnlyTemplate.format(this.Config.Details.Label,this.Config.Details.Value))}else t=this.HtmlRowReadOnlyTemplate.format(this.Config.Details.Label,this.Config.Details.Value);else t=this.HtmlRowTemplate.format(this.Config.Details.Label);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode&&!this.IsReadOnly){var a,n,r,l,d,h,c=this.FormRowNode.querySelector("select");if("Preview"===this.CleverForms.ViewType)c.classList.remove("ui-has-lookup","do-autocomplete"),c.classList.add("ui-has-autocomplete"),$a.getPosition(this.FormRowNode).top>$a.getWindowSize().height/2&&c.classList.add("ui-autocomplete-force-top"),r=$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0?this.Config.Details.ItemSource.Items:[{Key:"List Example One",Value:"1",Selected:!1},{Key:"List Example Two",Value:"2",Selected:!0},{Key:"List Example Three",Value:"3",Selected:!1}],l=!1,n=Object.keys(r[0]),r.forEach((function(e){(d=document.createElement("option")).value=e[n[1]],d.innerHTML=e[n[0]],!l&&$a.isBool(e.Selected)&&!0===e.Selected&&(d.selected="selected",l=!0),c.appendChild(d)})),l||(c.value=r[0][n[1]]);else if("ViewOnly"===this.CleverForms.ViewType){if(l="Not Set",$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0)for(r=this.Config.Details.ItemSource.Items,h=0;h<r.length;h++)if(r[h].Value===this.Config.Details.Value){l=r[h].Key;break}this.FormRowNode.querySelector("input").value=l}else $a.getPosition(this.FormRowNode).top>$a.getWindowSize().height/2&&c.classList.add("ui-autocomplete-force-top"),this.CleverForms.IsGlobalKey(this.Config)||!this.CleverForms.IsLookup(this.Config)&&this.CleverForms.IskeyWithNoRequiredKeys(this.Config)?(c.classList.remove("ui-has-autocomplete"),c.classList.add("prevent-autocomplete"),0!==this.Config.Details.AffinityField.GenericGroupId&&"0"!==this.Config.Details.AffinityField.GenericGroupId?c.dataset.api="{api}?modelName={modelName}&genericGroupId={groupid}".format({api:this.CleverForms.GetLookupApi,modelName:this.Config.Details.AffinityField.ModelName,groupid:this.Config.Details.AffinityField.GenericGroupId}):c.dataset.api="{api}?modelName={modelName}".format({api:this.CleverForms.GetLookupApi,modelName:this.Config.Details.AffinityField.ModelName}),a={DataKey:"Value",DisplayKey:"Key",IncludeDataInDisplay:!0,AddEmpty:!0,EmptyKey:null,EmptyDisplay:"None",Value:null},this.Config.Details.hasOwnProperty("Value")&&$a.isString(this.Config.Details.Value)&&""!==this.Config.Details.Value.trim()&&(a.Value=this.Config.Details.Value,c.dataset.defaultValue=this.Config.Details.Value),c.dataset.config=JSON.stringify(a)):this.CleverForms.IsLookup(this.Config)?(c.classList.remove("ui-has-autocomplete"),c.classList.add("prevent-autocomplete"),0!==this.Config.Details.AffinityField.GenericGroupId&&"0"!==this.Config.Details.AffinityField.GenericGroupId?c.dataset.api="{api}?modelName={modelName}&propertyName={propertyName}&genericGroupId={groupid}".format({api:this.CleverForms.GetLookupApi,modelName:this.Config.Details.AffinityField.ModelName,propertyName:this.Config.Details.AffinityField.FieldName,groupid:this.Config.Details.AffinityField.GenericGroupId}):c.dataset.api="{api}?modelName={modelName}&propertyName={propertyName}".format({api:this.CleverForms.GetLookupApi,modelName:this.Config.Details.AffinityField.ModelName,propertyName:this.Config.Details.AffinityField.FieldName}),a={DataKey:"Value",DisplayKey:"Key",IncludeDataInDisplay:!0,AddEmpty:!0,EmptyKey:null,EmptyDisplay:"None",Value:null},this.Config.Details.hasOwnProperty("Value")&&$a.isString(this.Config.Details.Value)&&""!==this.Config.Details.Value.trim()&&(a.Value=this.Config.Details.Value,c.dataset.defaultValue=this.Config.Details.Value),c.dataset.config=JSON.stringify(a)):(c.classList.remove("ui-has-lookup","do-autocomplete"),c.classList.add("ui-has-autocomplete"),$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0&&(a=!1,this.Config.Details.hasOwnProperty("Value")&&$a.isString(this.Config.Details.Value)&&""!==this.Config.Details.Value.trim()&&(a=this.Config.Details.Value,c.dataset.defaultValue=this.Config.Details.Value),n=Object.keys(this.Config.Details.ItemSource.Items[0]),r=this.Config.Details.ItemSource.Items,l=!1,r.forEach(function(e){(d=document.createElement("option")).value=e[n[1]],d.innerHTML=e[n[0]],!l&&e.Selected&&(d.selected="selected",l=!0),l||e[n[1]]!==a||(d.selected="selected",l=!0),c.appendChild(d)}.bind(this))));return this.FormRowNode}}GetFromFormRow(){if(super.GetFromFormRow())return this.FormRowNode.querySelector("div.select.hidden select")&&(this.FormData.Value=this.FormRowNode.querySelector("div.select.hidden select").value),this.FormRowNode.querySelector('input[type="text"]:disabled')&&(this.FormData.Value=this.FormRowNode.querySelector('input[type="text"]:disabled').value),"null"===this.FormData.Value.toLowerCase().trim()&&(this.FormData.Value=null),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){this.FormRowNode&&this.FormRowNode.querySelector("select")&&(this.FormRowNode.querySelector("select").widgets?this.FormRowNode.querySelector("select").widgets.Autocomplete.setValue(e,!1):this.FormRowNode.querySelector("select").value=e)}IsValid(){var e=this.Config.Details.Required;return"AffinityField"===this.Config.ElementType&&this.Config.Details.AffinityField.IsRequired&&(e=!0),!e||"null"!==this.FormRowNode.querySelector("div.select.hidden select").value.toLowerCase().trim()}_customListSelectWidgetReady(){this._customListSelectWidgetValue&&(this.CustomListSelectNode.widgets.Autocomplete.setValue(this._customListSelectWidgetValue),this.CustomListSelectNode.widgets.Autocomplete.removeEventListener("ready",this._customListSelectWidgetReady),this._customListSelectWidgetValue=null,delete this._customListSelectWidgetValue)}_templates(){super._templates(),this.HtmlEditTemplate=this.ItemSourcesTemplate,this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>Select from a list</label>\n        <div class="select">\n          <select class="ui-has-autocomplete">\n            <option>Example One</option>\n            <option>Example Two</option>\n            <option>Example Three</option>\n          </select>\n        </div>\n      </div>\n      </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <div class="select working">\n        <select class="ui-has-lookup do-autocomplete"></select>\n      </div>\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <input type="text" disabled value="{1}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.SingleSelectRadio=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"SingleSelectRadio"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","IsValid"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({example1:$a.Lang.ReturnPath("app.cf.design_items.radio_example_1"),example2:$a.Lang.ReturnPath("app.cf.design_items.radio_example_2")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t,i,s,o,a,n,r=this.HtmlRowTemplate.format(this.Config.Details.Label);if(this.FormRowNode=super.SetFormRow(e,r),this.FormRowNode)return"Preview"===this.CleverForms.ViewType?$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0?(s=this.Config.Details.Value,o=this.Config.Details.ItemSource.hasOwnProperty("DefaultNone")?this.Config.Details.ItemSource.DefaultNone:s,a=!!this.Config.Details.ItemSource.hasOwnProperty("Inline")&&this.Config.Details.ItemSource.Inline,n=Object.keys(this.Config.Details.ItemSource.Items[0]),(t=this.Config.Details.ItemSource.Items).forEach(function(e,t){(i=document.createElement("div")).classList.add("radio-label-pair"),a&&i.classList.add("inline"),i.innerHTML=this.HtmlRadioRowTemplate.format({id:"radio-"+this.Config.Name+"-"+t,name:this.Config.Name,value:e[n[1]],label:e[n[0]]}),(s===e[n[1]]||[null,""].contains(s)&&o===e[n[1]])&&(i.querySelector("input").checked=!0),this.FormRowNode.appendChild(i)}.bind(this)),a&&this.FormRowNode.querySelector("label").classList.remove("solo")):(t=[{Key:"",Value:"Radio Example One"},{Key:"",Value:"Radio Example Two"},{Key:"",Value:"Radio Example Three"}],n=Object.keys(t[0]),t.forEach(function(e,t){(i=document.createElement("div")).classList.add("radio-label-pair"),i.innerHTML=this.HtmlRadioRowTemplate.format({id:"radio-"+this.Config.Name+"-"+t,name:this.Config.Name,value:e[n[1]],label:e[n[0]],disabled:"ViewOnly"===this.CleverForms.ViewType?"disabled":""}),this.FormRowNode.appendChild(i)}.bind(this))):$a.isPropObject(this.Config.Details,"ItemSource")&&$a.isPropArray(this.Config.Details.ItemSource,"Items")&&this.Config.Details.ItemSource.Items.length>0&&(s=this.Config.Details.Value,o=this.Config.Details.ItemSource.hasOwnProperty("DefaultNone")?this.Config.Details.ItemSource.DefaultNone:s,a=!!this.Config.Details.ItemSource.hasOwnProperty("Inline")&&this.Config.Details.ItemSource.Inline,n=Object.keys(this.Config.Details.ItemSource.Items[0]),(t=this.Config.Details.ItemSource.Items).forEach(function(e,t){(i=document.createElement("div")).classList.add("radio-label-pair"),a&&i.classList.add("inline"),i.innerHTML=this.HtmlRadioRowTemplate.format({id:"radio-"+this.Config.Name+"-"+t,name:this.Config.Name,value:e[n[1]],label:e[n[0]],disabled:"ViewOnly"===this.CleverForms.ViewType?"disabled":""}),(s===e[n[1]]||[null,""].contains(s)&&o===e[n[1]])&&(i.querySelector("input").checked=!0),this.FormRowNode.appendChild(i)}.bind(this)),a&&this.FormRowNode.querySelector("label").classList.remove("solo")),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormRowNode.querySelector('input[type="radio"]:checked')?this.FormData.Value=this.FormRowNode.querySelector('input[type="radio"]:checked').value:$a.isPropObject(this.Config.Details,"ItemSource")&&this.Config.Details.ItemSource.hasOwnProperty("DefaultNone")&&(this.FormData.Value=this.Config.Details.ItemSource.DefaultNone),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){this.FormRowNode.querySelector('input[type="radio"][value="'+e+'"]')?this.FormRowNode.querySelector('input[type="radio"][value="'+e+'"]').checked=!0:this.FormRowNode.querySelector('input[type="radio"]:checked')&&(this.FormRowNode.querySelector('input[type="radio"]:checked').checked=!1)}IsValid(){return!this.Config.Details.Required||null!=this.FormRowNode.querySelector('input[type="radio"]:checked')}_templates(){super._templates(),this.HtmlEditTemplate=this.ItemSourcesTemplate,this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label class="solo">Gender</label>\n        <div class="radio-label-pair">\n          <input type="radio" id="afgadadfsradio1" name="afgadadfsradio1" />\n          <label for="afgadadfsradio1" class="right">{example1}</label>\n        </div>\n        <div class="radio-label-pair">\n          <input type="radio" id="afgadadfsradio2" name="afgadadfsradio2" />\n          <label for="afgadadfsradio2" class="right">{example2}</label>\n        </div>\n        ...\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label class="solo">{0}</label>\n    </div>\n    ',this.HtmlRadioRowTemplate='\n    <input type="radio" name="{name}" id="{id}" value="{value}" {disabled}/><label for="{id}" class="right">{label}</label>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.TaxNumber=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options(),this.CountryCodes=["AU","NZ","A","N"],this.DefaultCountryCode="AU",this.CountryCodeMap={A:"AU",N:"NZ"},this.DisableDepnedancy=!1}constructor(e){return super(e,"TaxNumber"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","_getFormRowHtml","_gotNewUserProfile","_setupEvents","_setupCountry","_countrySet","_setFromTax","_autocompleteWorkerDone"].bindEach(this),this._options(),this._templates(),window.addEventListener("GotUser",this._gotNewUserProfile),this}SetDesignEditor(){return!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=$a.isArray(this.Config.Details.Value)&&2===this.Config.Details.Value.length?this.Config.Details.Value[0]:"",i=$a.isArray(this.Config.Details.Value)&&2===this.Config.Details.Value.length?this.Config.Details.Value[1]:"AU";1===i.length&&this.CountryCodeMap.hasOwnProperty(i.toUpperCase())&&(i=this.CountryCodeMap[i.toUpperCase()]);var s;if(s=this.IsReadOnly?this.HtmlRowReadOnlyTemplate.format({label:this.Config.Details.Label,value:t+" - "+i}):this._getFormRowHtml(t,i),this.FormRowNode=super.SetFormRow(e,s),this.FormRowNode)return this.IsReadOnly||(this.FormRowNode.querySelector("input.ui-has-taxnumber")?this.FormRowNode.querySelector("input.ui-has-taxnumber").addEventListener("widgetReady",this._setupEvents):this.FormRowNode.querySelector("input.ui-taxnumber")?this.FormRowNode.querySelector("input.ui-taxnumber").addEventListener("widgetReady",this._setupEvents):console.warn('Tax Number element "'+this.Config.Details.Label+'" has no field to check.')),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow()){var e=this.FormRowNode.querySelector("input.ui-taxnumber").widgets.TaxNumber.GetData();return $a.isArray(e)&&(e[0]=e[0].replace(/\-/g,"").trim()),this.FormData.Value=e,this.FormData}throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){this.DisableDepnedancy=!0;var t=this.FormRowNode.querySelector("input.ui-taxnumber").widgets.TaxNumber;!this.IsReadOnly&&t&&(null===e||$a.isString(e)&&(""===e.trim()||"null"===e)?t.Set(""):t.Set(e)),setTimeout(function(){this.DisableDepnedancy=!1}.bind(this),250)}_getFormRowHtml(e,t){var i=!0;return $a.isPropObject(Affinity2018.UserProfile,"Selected")&&$a.isPropBool(Affinity2018.UserProfile.Selected,"HasPayPoint")&&(Affinity2018.SelectedProfile.Selected.HasPayPoint&&(i=!1),$a.isPropString(Affinity2018.UserProfile.Selected,"PayPointCountryCode")&&(t=Affinity2018.UserProfile.Selected.CountryCode)),i||"AffinityField"!==this.Config.Type||this.Config.Details.AffinityField.Mode!==this.CleverForms.AffnityFieldModeTypes.Create.Enum||(i=!0),this.HtmlRowTemplate.format({label:this.Config.Details.Label,value:e,country:t,status:i?"show":"hide"})}_gotNewUserProfile(e){if(this.FormRowNode&&$a.isPropObject(Affinity2018.UserProfile,"Selected")){var t=this.FormRowNode.querySelector("input.ui-taxnumber").widgets.TaxNumber,i=t.GetData(),s=i[0],o=i[1],a=this._getFormRowHtml(s,o);t.Destroy(),this.FormRowNode.innerHTML=a,Affinity2018.Apps.Plugins.TaxNumber.Apply()}}_setupEvents(){this.IsReadOnly||(this.SectionNode=this.FormRowNode.closest("div.default-form"),this.SectionNode.querySelector('select[data-api*="propertyName=TAX_CODE"]')?(this.TaxCodeInputNode=this.SectionNode.querySelector('select[data-api*="propertyName=TAX_CODE"]'),this.TaxCodeWidget=this.TaxCodeInputNode.widgets.Autocomplete,void 0===this.TaxCodeWidget?this.TaxCodeInputNode.addEventListener("ready",this._setupCountry):this.TaxCodeWidget=!1):(this.TaxCodeInputNode=!1,this._setupCountry()))}_setupCountry(){this.IsReadOnly||(this.TaxCodeInputNode?(this.TaxOptions=this.TaxCodeInputNode.querySelectorAll("option"),this.TaxNumberInputNode=this.FormRowNode.querySelector("input.ui-taxnumber"),this.TaxNumberInputNode.addEventListener("countryChanged",this._countrySet),this.TaxCodeInputNode.widgets.Autocomplete&&(this.TaxCodeWidget=this.TaxCodeInputNode.widgets.Autocomplete,this.TaxCodeInputNode.removeEventListener("complete",this._setupCountry),this.TaxCodeInputNode.addEventListener("change",this._setFromTax))):this.TaxCodeWidget=!1)}_countrySet(e){if(!this.IsReadOnly&&e&&"detail"in e&&"Country"in e.detail){clearTimeout(this.filterTimeout);var t="- "+e.detail.Country.toUpperCase()+" ";if(this.TaxCodeWidget){this.SetMatch=t.contains("NZ")?"- NZ ":t.contains("AU")?"- AU ":null;var i=t.contains("NZ")?"- AU ":t.contains("AU")?"- NZ ":null;this.DisableDepnedancy||(this.DisableDepnedancy=!0,this.TaxCodeInputNode.addEventListener("workerComplete",this._autocompleteWorkerDone),this.TaxCodeWidget.filterList(i))}}}_autocompleteWorkerDone(){this.IsReadOnly||(this.TaxCodeInputNode.removeEventListener("workerComplete",this._autocompleteWorkerDone),this.TaxCodeWidget.setFirst(this.SetMatch,!1),this.DisableDepnedancy=!1)}_setFromTax(e){if(!this.IsReadOnly){if(this.DisableDepnedancy)return;var t,i=this.TaxCodeWidget.getDisplayValue(),s=0;for(s=0;s<this.CountryCodes.length;s++)if(i.toUpperCase().contains("- "+this.CountryCodes[s].toUpperCase())){t=this.CountryCodes[s];break}if(""!==t){this.TaxNumberInputNode.removeEventListener("countryChanged",this._countrySet);var o=this.FormRowNode.querySelector("input.ui-taxnumber").widgets.TaxNumber;o.Clear(),o.SetCountry(t),this.TaxNumberInputNode.addEventListener("countryChanged",this._countrySet)}}}_templates(){super._templates(),this.HtmlEditTemplate="\n\n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>Tax Number</label>\n        <input type="text" class="ui-has-taxnumber" data-country="NZ" data-country-status="show" placeholder="Enter your tax number" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" class="ui-has-taxnumber" value="{value}" data-country="{country}" data-country-status="{status}" />\n    </div>\n    ',this.HtmlRowReadOnlyTemplate='\n    <div class="form-row">\n      <label>{label}</label>\n      <input type="text" disabled value="{value}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Text=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Text"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.text_example_label"),value:$a.Lang.ReturnPath("app.cf.design_items.text_example_value")}),!!super.SetDesignEditor()}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.Value);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return"AffinityField"===this.Config.Type&&this.Config.Details.AffinityField.Mode===this.CleverForms.AffnityFieldModeTypes.Display.Enum&&(this.FormRowNode.querySelector("input").disabled=!0),this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData.Value=this.FormRowNode.querySelector("input").value.trim(),this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){this.FormRowNode.querySelector("input")&&(this.FormRowNode.querySelector("input").value=e)}_templates(){super._templates(),this.HtmlEditTemplate="\n      \n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <label>{label}</label>\n        <input type="text" value="{value}" />\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <label>{0}</label>\n      <input type="text" value="{1}" />\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Title=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Title"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){if(this.HtmlEditExampleTemplate=this.HtmlEditExampleTemplate.format({example:$a.Lang.ReturnPath("app.cf.design_items.title_example")}),super.SetDesignEditor()){var e=this.Config.Details.Label||"";return this.PopupNode.querySelector(".label-row label").innerHTML=$a.Lang.ReturnPath("app.cf.design_items.title_label"),this.PopupNode.querySelector("input.label").value=e.trim(),this.PopupNode.querySelector(".label-row").classList.remove("hidden"),!0}return!1}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.Label=this.PopupNode.querySelector("input.label").value.trim(),this.Config.Label=this.Config.Details.Label,this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.Label,this.Config.Details.Value);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}_templates(){super._templates(),this.HtmlEditTemplate="\n    ",this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="form-row">\n        <span>Some text</span>\n        <div class="section-title">{example}</div>\n        <span>Some text</span>\n      </div>\n    </div>\n    ',this.HtmlRowTemplate='\n    <div class="form-row">\n      <div class="section-title">{0}</div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Apps"in Affinity2018.Classes||(Affinity2018.Classes.Apps={}),"CleverForms"in Affinity2018.Classes.Apps||(Affinity2018.Classes.Apps.CleverForms={}),"Elements"in Affinity2018.Classes.Apps.CleverForms||(Affinity2018.Classes.Apps.CleverForms.Elements={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Elements"in Affinity2018.Apps||(Affinity2018.Apps.Elements={}),Affinity2018.Classes.Apps.CleverForms.Elements.Video=class extends Affinity2018.Classes.Apps.CleverForms.Elements.ElementBase{_options(){super._options()}constructor(e){return super(e,"Video"),["_options","_templates","SetDesignEditor","UnsetDesignEditor","GetFromDesignEditor","RemoveDesignerElement","RemoveDesignerElement","SetFormRow","GetFromFormRow","SetFromValue","Reset","GetID","GetEmbed","_validateId","_valid","_invalid","_delayInvalid","_extractId","_delayExtract"].bindEach(this),this._options(),this._templates(),this}SetDesignEditor(){return this.HtmlEditTemplate=this.HtmlEditTemplate.format({label:$a.Lang.ReturnPath("app.cf.design_items.video_label"),idLabel:$a.Lang.ReturnPath("app.cf.design_items.video_id_label"),videoLabel:$a.Lang.ReturnPath("app.cf.design_items.video_video_label")}),!!super.SetDesignEditor()&&(this.FullUrlNode=this.TemplateNode.querySelector(".youtube-url"),this.IdNode=this.TemplateNode.querySelector(".youtube-id"),this.EmbedNode=this.TemplateNode.querySelector(".youtube-embed"),this.TickNode=this.TemplateNode.querySelector(".icon-tick"),this.CrossNode=this.TemplateNode.querySelector(".icon-cross"),this.FullUrlNode&&this.FullUrlNode.addEventListener("keyup",this._extractId),this.Config.Details.hasOwnProperty("VideoId")&&"string"===$a.type(this.Config.Details.VideoId)&&(this.Config.Details.VideoId.length>7&&(this.FullUrlNode.value="https://www.youtube.com/watch?v="+this.Config.Details.VideoId),this.IdNode.value=this.Config.Details.VideoId),this._extractId(),this.PopupNode.classList.add("large"),!0)}UnsetDesignEditor(){return!!super.UnsetDesignEditor()}GetFromDesignEditor(){return this.Config=super.GetFromDesignEditor(),this.Config.Details.VideoId=this.IdNode.value,this.CheckChanges(!0),this.Config}RemoveDesignerElement(e){if(super.RemoveDesignerElement()){var t=document.querySelector(".item-"+this.UniqueName);t&&$a.isFunction(e)&&e(t)}}SetFormRow(e){var t=this.HtmlRowTemplate.format(this.Config.Details.VideoId);if(this.FormRowNode=super.SetFormRow(e,t),this.FormRowNode)return this.FormRowNode}GetFromFormRow(){if(super.GetFromFormRow())return this.FormData;throw'{0} "{1}" ({2}) could not get base post data for form post'.format(this.Config.Type,this.Config.Details.Label,this.Config.UniqueName)}SetFromValue(e){}GetID(e){return e?(this.FullUrlNode.value=e.trim(),this._extractId()):this.IdNode.value.trim()}GetEmbed(){return this.IdNode.value.length>7?(this.EmbedNode.innerHTML='<iframe src="https://www.youtube.com/embed/'+this.IdNode.value+'" frameborder="0"></iframe>',this.EmbedNode.innerHTML):""}_validateId(e){"string"==typeof e&&e.length>7?(this.validating=e,axios({method:"GET",url:"https://www.googleapis.com/youtube/v3/videos?part=id&id="+this.validating+"&key=AIzaSyBVSe319zTapARUojfwVf1cDAiQ7G3kAqk"}).then(function(t){Affinity2018.isObject(t)&&200===t.status&&Affinity2018.isPropObject(t,"data")&&Affinity2018.isPropArray(t.data,"items")&&t.data.items.length>0?this._valid(e):this._invalid()}.bind(this)).catch(this._invalid)):this._invalid()}_valid(e){clearTimeout(this._invalidTimer),this.CrossNode.classList.add("hidden"),this.TickNode.classList.remove("hidden"),this.IdNode.value=e,this.EmbedNode.innerHTML='<iframe src="https://www.youtube.com/embed/'+this.IdNode.value+'" frameborder="0"></iframe>',this.Valid=!0}_invalid(){clearTimeout(this._invalidTimer),this._invalidTimer=setTimeout(this._delayInvalid,250),this.Valid=!1}_delayInvalid(){this.TickNode.classList.add("hidden"),this.CrossNode.classList.remove("hidden"),this.IdNode.value="",this.EmbedNode.innerHTML=""}_extractId(){clearTimeout(this._extractTimer),this._extractTimer=setTimeout(this._delayExtract,500)}_delayExtract(){clearTimeout(this._extractTimer);for(var e,t=this.FullUrlNode.value.trim(),i=t.substr(t.indexOf("?")+1).split("&"),s=0,o=!1;s<t.length;++s)if(2===(e=i[s].split("=",2)).length&&"v"===e[0].toLowerCase().trim()){o=decodeURIComponent(e[1].replace(/\+/g," "));break}return"string"==typeof o&&o.length>7?(this._validateId(o),o):(this._invalid(),"")}_templates(){super._templates(),this.HtmlEditTemplate='\n    <div class="edit-row">\n      <label>{label}</label>\n      <input type="text" class="youtube-url" />\n    </div>\n    <div class="edit-row youtube">\n      <label>{idLabel}</label>\n      <input class="youtube-id validate" name="VideoId" type="text" data-validate-method="hasvalue" disabled="disabled" />\n      <span class="icon-tick hidden"></span>\n      <span class="icon-cross"></span>\n    </div>\n    <div class="youtube-embed">{videoLabel}</div>\n    ',this.HtmlEditExampleTemplate='\n    <div class="default-form">\n      <div class="no-preview form-row">\n        <iframe src="https://www.youtube.com/embed/bgjjkKqWEzo" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope;" allowfullscreen></iframe>\n      </div>\n    </div>\n    ',this.HtmlEditExampleTemplate="\n\n    ",this.HtmlRowTemplate='\n    <div class="form-row">\n      <iframe class="video" src="https://www.youtube.com/embed/{0}" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope;" allowfullscreen></iframe>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.Address=class{options(){Affinity2018.GoogleApikey="AIzaSyDX7vRyaNWfkZQfj0xx9Kthii3HBXk5DGc",this.Ready=!1,this._waitingNodes=[]}constructor(){this.options(),["Apply","Remove","_apply","_loadScript","_scriptLoaded","_templates"].bindEach(this),this._templates(),this.Ready=!1,this._loadScript()}Apply(e){var t=[];return Affinity2018.isDomElement(e)&&"input"===e.tagName?t=[this._apply(e)]:document.querySelectorAll(".ui-has-address").forEach(function(e){t.push(this._apply(e))}.bind(this)),{total:t.length,widgets:t}}Remove(e){e.classList.contains("ui-address")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("Address")&&e.widgets.Address.Destroy()}_apply(e){return new Affinity2018.Classes.Plugins.AddressWidget(e)}_loadScript(){this.scriptNode=document.createElement("script"),this.scriptNode.onload=this._scriptLoaded,this.scriptNode.type="text/javascript",this.scriptNode.src="https://maps.googleapis.com/maps/api/js?key="+Affinity2018.GoogleApikey+"&libraries=places",document.head.appendChild(this.scriptNode),this._loadScriptFailTimer=setTimeout(function(){this.Ready=!0,console.warn("google maps api failed to load")}.bind(this),1e4)}_scriptLoaded(){clearTimeout(this._loadScriptFailTimer),this.Ready=!0}_templates(){}},Affinity2018.Classes.Plugins.AddressWidget=class{_options(){this.WidgetName="Address",this.bounds=[-36.847605,174.7485493,3696e3],this.formComponents={Default:{subpremise:{type:"long_name",formMap:"subpremise"},street_number:{type:"long_name",formMap:"street_number"},route:{type:"long_name",formMap:"street"},sublocality_level_1:{type:"long_name",formMap:"suburb"},locality:{type:"long_name",formMap:"city"},administrative_area_level_1:{type:"long_name",formMap:"state"},country:{type:"long_name",formMap:"country"},postal_code:{type:"long_name",formMap:"postal_code"}},NZ:{subpremise:{type:"long_name",formMap:"subpremise"},street_number:{type:"long_name",formMap:"street_number"},route:{type:"long_name",formMap:"street"},sublocality_level_1:{type:"long_name",formMap:"suburb"},locality:{type:"long_name",formMap:"city"},administrative_area_level_1:{type:"long_name",formMap:"state"},country:{type:"long_name",formMap:"country"},postal_code:{type:"long_name",formMap:"postal_code"}},AU:{subpremise:{type:"long_name",formMap:"subpremise"},street_number:{type:"long_name",formMap:"street_number"},route:{type:"long_name",formMap:"street"},locality:{type:"long_name",formMap:"suburb"},administrative_area_level_2:{type:"long_name",formMap:"city"},administrative_area_level_1:{type:"long_name",formMap:"state"},country:{type:"long_name",formMap:"country"},postal_code:{type:"long_name",formMap:"postal_code"}},US:{subpremise:{type:"long_name",formMap:"subpremise"},street_number:{type:"long_name",formMap:"street_number"},route:{type:"long_name",formMap:"street"},neighborhood:{type:"long_name",formMap:"suburb"},locality:{type:"long_name",formMap:"city"},sublocality_level_1:{type:"long_name",formMap:"state"},country:{type:"long_name",formMap:"country"},postal_code:{type:"long_name",formMap:"postal_code"}},GB:{subpremise:{type:"long_name",formMap:"subpremise"},street_number:{type:"long_name",formMap:"street_number"},route:{type:"long_name",formMap:"street"},neighborhood:{type:"long_name",formMap:"suburb"},locality:{type:"long_name",formMap:"city"},administrative_area_level_1:{type:"long_name",formMap:"state"},country:{type:"long_name",formMap:"country"},postal_code:{type:"long_name",formMap:"postal_code"}}},this.StartAddressObject=null,this.Valid=!1}constructor(e){if(this._options(),["GetAddressData","GetAddress","SetAddress","IsValid","_waitUntilready","_ready","_userUpdateAddress","_checkAddress","_getCountryFromPLace","_fillAddress","_templates","Destroy"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){this.Ready=!1,e.classList.remove("ui-has-address"),e.classList.add("ui-address","no-validate"),this.lookupNode=e,this.lookupNode.classList.add("ui-address-lookup");var t,i,s=Affinity2018.getObjectFromDataset(this.lookupNode,"address");for(t in Affinity2018.isObject(s)&&(this.StartAddressObject=s),this.lookupNode.hasOwnProperty("widgets")||(this.lookupNode.widgets={}),this.lookupNode.widgets.Address=this,this.AutocompleteListener=null,this.addressNode=document.createElement("div"),this.addressNode.classList.add("ui-address-fields"),this.addressNode.innerHTML=this.addressTemplate,this.lookupNode.parentNode.appendChild(this.addressNode),this.iconNode=this.addressNode.querySelector(".address-indicator"),this.formComponents.Default)i=this.formComponents.Default[t],this.addressNode.querySelector("."+i.formMap)&&(this.addressNode.querySelector("."+i.formMap).addEventListener("keyup",this._userUpdateAddress),this.addressNode.querySelector("."+i.formMap).addEventListener("blur",this._userUpdateAddress));Affinity2018.Apps.Plugins.Address.Ready?this._ready():this._waitUntilready()}else console.error("No valid element was passed to AddressWidget, dummy!")}IsValid(){return this.Valid}SetAddress(e){if("object"===$a.type(e)){var t=[];e.hasOwnProperty("Street")&&$a.isString(e.Street)&&t.push(e.Street.trim()),e.hasOwnProperty("Suburb")&&$a.isString(e.Suburb)&&t.push(e.Suburb.trim()),e.hasOwnProperty("City")&&$a.isString(e.City)&&t.push(e.City.trim()),e.hasOwnProperty("State")&&$a.isString(e.State)&&t.push(e.State.trim()),e.hasOwnProperty("Country")&&$a.isString(e.Country)&&t.push(e.Country.trim()),e.hasOwnProperty("Postcode")&&$a.isString(e.Postcode)&&t.push(e.Postcode.trim()),""===t.join("").trim()?(this.lookupNode.value="",this.addressNode.querySelector("input.street_number").value="",this.addressNode.querySelector("input.street").value="",this.addressNode.querySelector("input.suburb").value="",this.addressNode.querySelector("input.city").value="",this.addressNode.querySelector("input.state").value="",this.addressNode.querySelector("input.country").value="",this.addressNode.querySelector("input.postal_code").value="",this.iconNode.classList.remove("valid","icon-tick"),this.iconNode.classList.add("invalid","icon-cross")):(this.lookupNode.value=t.join(","),google.maps.event.trigger(this.Autocomplete,"place_changed"))}else if("string"===$a.type(e))try{var i=JSON.parse(e);if("object"===$a.type(i))return void this.SetAddress(i);this.lookupNode.value=e,google.maps.event.trigger(this.Autocomplete,"place_changed")}catch(e){this.addressNode.querySelector("input.street_number").value="",this.addressNode.querySelector("input.street").value="",this.addressNode.querySelector("input.suburb").value="",this.addressNode.querySelector("input.city").value="",this.addressNode.querySelector("input.state").value="",this.addressNode.querySelector("input.country").value="",this.addressNode.querySelector("input.postal_code").value="",this.lookupNode.value=t.join(""),this.iconNode.classList.remove("valid","icon-tick"),this.iconNode.classList.add("invalid","icon-cross")}}GetAddressData(){return{street:(this.addressNode.querySelector("input.street_number").value+" "+this.addressNode.querySelector("input.street").value).trim(),suburb:this.addressNode.querySelector("input.suburb").value,city:this.addressNode.querySelector("input.city").value,state:this.addressNode.querySelector("input.state").value,country:this.addressNode.querySelector("input.country").value,postcode:this.addressNode.querySelector("input.postal_code").value}}GetAddress(){var e,t,i,s=this.addressNode.querySelector(".countrycode").value,o=this.formComponents[s]?this.formComponents[s]:this.formComponents.Default,a="",n="";if(o){for(e in o)t=o[e],this.addressNode.querySelector("."+t.formMap)&&""!==(i=this.addressNode.querySelector("."+t.formMap)?this.addressNode.querySelector("."+t.formMap).value.trim():"")&&(a+=n+i,n="street_number"===e?" ":", ");return a.trim()}return this.lookupNode.value.trim()}_waitUntilready(){clearTimeout(this._waitingTimer),Affinity2018.Apps.Plugins.Address.Ready?this._ready():this._waitingTimer=setTimeout(this._waitUntilready,100)}_ready(){clearTimeout(this._waitingTimer);var e=new google.maps.LatLng(this.bounds[0],this.bounds[1]),t=new google.maps.Circle({center:e,radius:this.bounds[2]}),i=document.querySelectorAll(".pac-container").length;if(this.Autocomplete=new google.maps.places.Autocomplete(this.lookupNode),this.Autocomplete.setOptions({types:["geocode"],fields:["address_components"],bounds:t.getBounds(),strictBounds:!0}),document.querySelectorAll(".pac-container").length===i)var s=setInterval(function(){var e=document.querySelectorAll(".pac-container");e.length>i&&(clearInterval(s),this.PacContaner=e[e.length-1],s=null,i=null,"fixed"===this.lookupNode.dataset.position&&this.PacContaner.classList.add("force-fixed"))}.bind(this),10);var o=!1;if(""!==this.lookupNode.value.trim()&&(this._checkAddress(),o=!0),null!==this.StartAddressObject){var a=[];this.StartAddressObject.hasOwnProperty("Street")&&a.push(this.StartAddressObject.Street),this.StartAddressObject.hasOwnProperty("Suburb")&&a.push(this.StartAddressObject.Suburb),this.StartAddressObject.hasOwnProperty("City")&&a.push(this.StartAddressObject.city),this.StartAddressObject.hasOwnProperty("State")&&a.push(this.StartAddressObject.State),this.StartAddressObject.hasOwnProperty("Country")&&a.push(this.StartAddressObject.Country),this.StartAddressObject.hasOwnProperty("Postcode")&&a.push(this.StartAddressObject.Postcode),(a=a.filter((function(e){return null!=e&&""!==e.trim()}))).length>1&&(this.lookupNode.value=a.join(", "),this._checkAddress(),o=!0)}o||(this.AutocompleteListener=google.maps.event.addListener(this.Autocomplete,"place_changed",this._checkAddress)),this.Ready=!0,this.lookupNode.dispatchEvent(new CustomEvent("Ready"))}_userUpdateAddress(){this.lookupNode.value=this.GetAddress()}_checkAddress(){axios.get("https://maps.googleapis.com/maps/api/geocode/json?address="+this.lookupNode.value.trim()+"&key="+Affinity2018.GoogleApikey).then(function(e){e.hasOwnProperty("data")&&e.data.hasOwnProperty("results")&&(e.data.results.length>0?this._fillAddress(e.data.results[0]):this._fillAddress())}.bind(this)).catch(function(e){this._fillAddress()}.bind(this))}_getCountryFromPLace(e){var t,i=0;if(e&&e.hasOwnProperty("address_components"))for(;i<e.address_components.length;i++)if(t=e.address_components[i],JSON.stringify(t.types).toLowerCase().contains("country"))return t.short_name.toUpperCase();return!1}_fillAddress(e){if(null!=(e=e||this.Autocomplete.getPlace())){var t,i,s,o,a=this._getCountryFromPLace(e),n=this.formComponents[a]?this.formComponents[a]:this.formComponents.Default,r=!1,l=!1,d=[],h=0,c=0;for(t in n)this.addressNode.querySelector("."+n[t].formMap)&&(this.addressNode.querySelector("."+n[t].formMap).value="",this.addressNode.querySelector("."+n[t].formMap).disabled=!1);if(n){for(;h<e.address_components.length;h++)for(i=(t=e.address_components[h]).types,t.types.contains("subpremise")&&(r=t.long_name),t.types.contains("street_number")&&(l=t.long_name),t.types.contains("country")&&(i=["country"],this.addressNode.querySelector(".countrycode").value=t.short_name.toUpperCase().trim()),d.push(t.long_name),d.push(t.short_name),c=0;c<i.length;c++)n[s=i[c]]&&this.addressNode.querySelector("."+n[s].formMap)&&(o=t[n[s].type],this.addressNode.querySelector("."+n[s].formMap).value=o);if(r&&l)this.addressNode.querySelector(".street_number").value=r+"/"+l;else if(l&&(l=RegExp("[^\\s,]*("+l+")[^\\s,]*").exec(this.lookupNode.value.trim())[0])&&(this.addressNode.querySelector(".street_number").value=l),!l){for(l=this.lookupNode.value.trim().toLowerCase(),h=0;h<d.length;h++)l=l.replace(d[h].toLowerCase(),"");l=l.replace(/[^0-9\/\-\\]+/g,"").replace(/[\s]+/g," ").trim(),this.addressNode.querySelector(".street_number").value=l}this.lookupNode.value=this.GetAddress(),this.iconNode.classList.remove("invalid","icon-cross"),this.iconNode.classList.add("valid","icon-tick"),this.Valid=!0}else this.iconNode.classList.remove("valid","icon-tick"),this.iconNode.classList.add("invalid","icon-cross"),this.Valid=!1;null===this.AutocompleteListener&&(this.AutocompleteListener=google.maps.event.addListener(this.Autocomplete,"place_changed",this._checkAddress))}}Destroy(){var e;for(t in clearTimeout(this._waitingTimer),google.maps.event.removeListener(this.AutocompleteListener),google.maps.event.clearInstanceListeners(this.Autocomplete),this.PacContaner.innerHTML="",this.PacContaner.parentNode.removeChild(this.PacContaner),this.lookupNode.classList.remove("ui-address"),this.formComponents.Default)e=this.formComponents.Default[t],this.addressNode.querySelector("."+e.formMap)&&(this.addressNode.querySelector("."+e.formMap).removeEventListener("keyup",this._userUpdateAddress),this.addressNode.querySelector("."+e.formMap).removeEventListener("blur",this._userUpdateAddress));for(var t in this.addressNode.innerHTML="",this.addressNode.parentNode.removeChild(this.addressNode),delete this.lookupNode.widgets.Address,this)this.hasOwnProperty(t)&&(this[t]=null,delete this[t])}_templates(){this.addressTemplate='\n    <div class="address-indicator invalid icon-cross"></div>\n    <div class="address-fields-row steet-fields">\n      <input type="text" class="field street_number" placeholder="Number" />\n      <input type="text" class="field street" placeholder="Street"/>\n    </div>\n    <div class="address-fields-row">\n      <input type="text" class="field suburb" placeholder="Suburb"/>\n    </div>\n    <div class="address-fields-row">\n      <input type="text" class="field city" placeholder="City" />\n    </div>\n    <div class="address-fields-row">\n      <input type="text" class="field state" placeholder="State" />\n    </div>\n    <div class="address-fields-row country-fields">\n      <input type="text" class="field country" placeholder="Country"/>\n      <input type="text" class="field postal_code" placeholder="Postcode" />\n    </div>\n    <input type="hidden" class="countrycode" />\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.Autocompletes=class{_options(){this.widgets=[]}constructor(){this._options(),["Apply","Remove","_apply","_templates"].bindEach(this),this._templates(),this.Ready=!0}Apply(e){var t=[];return null!=e?t=[this._apply(e)]:document.querySelectorAll(".ui-has-autocomplete").forEach(function(e){t.push(this._apply(e))}.bind(this)),{total:t.length,widgets:t}}Remove(e){e.classList.contains("ui-autocomplete")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("Autocomplete")&&e.widgets.Autocomplete.Destroy()}HideAll(e){var t,i;for(t in this.widgets)this.widgets.hasOwnProperty(t)&&(i=this.widgets[t],"object"==typeof e&&e.hasOwnProperty("uuid")?i.uuid!==e.uuid&&i.hide():i.hide())}_apply(e){return new Affinity2018.Classes.Plugins.AutocompleteWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.AutocompleteWidget=class extends Affinity2018.ClassEvents{_options(){this.WidgetName="Autocomplete",this.Ready=!1,this.enabled=!0,this.uuid="",this.debug=!1,this.webworkerpath=Affinity2018.WebWorkerPath+"autocomplete.web.worker.js",this.selectmax=2e3,this.filter=null,this.keeplist=!0,this.elementChangedOnly=!1,this.stopInitialChange=!1,this.fuzzyRunning=!1,this.workerComplete=!0,this.status="closed"}constructor(e){super(),this._options(),["_init","getValue","getDisplayValue","setValue","setFirst","filterList","obscure","reveal","show","hide","forceDefaultSelection","isDefaultSelected","defaultSelected","refreshFromSelect","_fuzzyWorkerComplete","_updateOptions","_processOptions","_continueProcessOptions","_fuzzySearch","_continueWithFuzzySearch","_getTopVisibleElement","_getBottomVisibleElement","_scrollToTop","_scrollToBottom","_elementKeySetHeld","_elementKeyUp","_doFocus","_doClick","_doKeyDown","_doKeyUp","_elementDown","_elementUp","_itemClicked","_restoreSelectedList","_clearList","_scrolled","_position","_setPosition","_cleanDisplay","_resetListEvents","_setListEvents","_fireWindowChangeEvent","_escapeRegExp","_stopEvents","_clearShowHideEvents","_windowClicked","_show","_hide","_reset","Destroy","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)?e.classList.contains("ui-has-lookup")||e.classList.contains("prevent-autocomplete")||(this.targetNode=e,this.uuid=this.targetNode.id?this.targetNode.id:Affinity2018.uuid(),this.killid="ac-destroy-"+this.uuid,Affinity2018.hasOwnProperty("Autocompletes")&&!Affinity2018.Autocompletes.widgets.hasOwnProperty(this.uuid)&&(Affinity2018.Autocompletes.widgets[this.uuid]=this),this.targetNode.classList.remove("ui-has-autocomplete"),this.targetNode.classList.add("ui-autocomplete"),this.targetNode.tabindex=5e3,this.targetNode.id=this.uuid,this.targetNode.hasOwnProperty("widgets")||(this.targetNode.widgets={}),this.targetNode.widgets.Autocomplete=this,this.autocompleteNode=document.createElement("div"),this.autocompleteNode.classList.add("ui-autocomplete-container"),this.autocompleteNode.innerHTML=this.autocompleteTemplate,this.targetNode.parentNode.classList.contains("select")?this.targetNode.parentNode.parentNode.querySelector("label")?this.targetNode.parentNode.parentNode.querySelector("label").nextSibling?this.targetNode.parentNode.parentNode.insertBefore(this.autocompleteNode,this.targetNode.parentNode.parentNode.querySelector("label").nextSibling):this.targetNode.parentNode.parentNode.appendChild(this.autocompleteNode):this.targetNode.parentNode.parentNode.insertBefore(this.autocompleteNode,this.targetNode.parentNode.nextSibling):this.targetNode.parentNode.insertBefore(this.autocompleteNode,this.targetNode.nextSibling),this.displayNode=this.autocompleteNode.querySelector("input"),this.iconNode=this.autocompleteNode.querySelector(".ui-ac-display-icon"),this.listNode=this.autocompleteNode.querySelector("ul"),this.targetNode.parentNode.classList.contains("select")?this.targetNode.parentNode.classList.add("hidden"):this.targetNode.classList.add("hidden"),this.useWebWorkers=Affinity2018.SupportsWebWorkers,this.useWebWorkers&&(this.fuzzyWorker=new Worker(this.webworkerpath),this.fuzzyWorker.onmessage=this._fuzzyWorkerComplete),this.searchMode=!!Affinity2018.IsMobile,this.center=!1,this.targetNode.classList.contains("ui-autocomplete-center")&&(this.targetNode.classList.remove("ui-autocomplete-center"),this.center=!0),this.autowidth=!1,this.targetNode.classList.contains("ui-autocomplete-autowidth")&&(this.targetNode.classList.remove("ui-autocomplete-autowidth"),this.autowidth=!0),this.forceTop=!1,this.targetNode.classList.contains("ui-autocomplete-force-top")&&(this.targetNode.classList.remove("ui-autocomplete-force-top"),this.forceTop=!0),this.bestguess=null,this.fieldType=this.targetNode.id?this.targetNode.id.substring(this.targetNode.id.lastIndexOf("-")+1):"none",this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("form-row")&&this.targetNode.parentNode.classList.add("autocomplete"),this.debug&&(console.log("! START Debug Enabled !"),console.log("! Autocomplete "+this.uuid+" !"),console.log(this.targetNode),console.log(this.listNode),console.log(this.displayNode),console.log("! END Debug Enabled !")),this._init()):console.error("No valid element was passed to AutocompleteWidget, dummy!")}_init(){Affinity2018.IsMobile&&window.addEventListener("mobileback",function(){this.hide()}.bind(this)),this.displayNode.addEventListener("focus",this._doFocus),document.addEventListener("scroll",this._scrolled,Affinity2018.PassiveEventProp),document.addEventListener("resize",this._position,Affinity2018.PassiveEventProp),this.autocompleteNode.addEventListener("mouseenter",this._mouseEnter),this.autocompleteNode.addEventListener("mouseleave",this._mouseLeave),this._processOptions()}getValue(){return this.targetNode.value}setValue(e,t){if(!this.enabled)return!1;if(t="boolean"!=typeof t||t,e=this._cleaValue(e),this.listNode&&Affinity2018.isDomElement(this.listNode)&&(this.searchMode&&(this.searchMode=!1),!this.searchMode)){if(!e||""===e||void 0===this._fuzzySearchItems||null===this._fuzzySearchItems||!1===this._fuzzySearchItems){if(this.listNode.querySelector("li")){if(this.listNode.querySelector('li[data-value="'+e+'"]'))return this._itemClicked({target:this.listNode.querySelector('li[data-value="'+e+'"]'),fireEvents:t}),this.listNode.querySelector('li[data-value="'+e+'"]').dataset.value;this._itemClicked({target:this.listNode.querySelector("li"),fireEvents:t})}return this.listNode.querySelector("li").dataset.value}for(var i=!1,s=0;s<this._fuzzySearchItems.length;s++)if(this._fuzzySearchItems[s].value+""==e+""){i=document.querySelector("#"+this._fuzzySearchItems[s].id);break}return i?(this._itemClicked({target:i,fireEvents:t}),i.dataset.value):(this._itemClicked({target:this.listNode.querySelector("li"),fireEvents:t}),this.listNode.querySelector("li").dataset.value)}}setFirst(e,t){var i=this.listNode.querySelectorAll('li[data-display*="'+e+'"]');return i.length>0||(i=this.listNode.querySelectorAll('li[data-value*="'+e+'"]')).length>0?this.setValue(i[0].dataset.value,t):null}getDisplayValue(){return this._cleanDisplay(this.displayNode.value)}filterList(e,t){void 0===t&&(t=this.targetNode.dataset.defaultValue||this.targetNode.value),this.filter=e,this.workerComplete=!1,this.fuzzyWorker.postMessage({job:"getList",html:this.targetNode.innerHTML,defaultValue:t,filter:this.filter,uuid:this.uuid})}obscure(){this.enabled=!1,this.hide(),this.iconElement&&this.iconElement.classList.add("hidden"),this.displayNode&&this.displayNode.classList.add("hidden")}reveal(){this.enabled=!0,this.iconElement&&this.iconElement.classList.remove("hidden"),this.displayNode&&this.displayNode.classList.remove("hidden")}show(e){this._show(e)}hide(e){this._hide(e)}forceDefaultSelection(){if(this.defaultValue&&this.targetNode&&this.displayNode){var e=this._cleanDisplay(this.defaultValue.innerText);this.listNode.querySelector("li.selected")&&this.listNode.querySelector("li.selected").classList.remove("selected"),this.defaultValue.classList.add("selected"),this.displayNode.value=e,this.targetNode.selectedIndex=this.defaultValue.dataset.index,this.targetNode.value=this.defaultValue.dataset.value}}isDefaultSelected(){if(this.defaultValue){if(this.targetNode.value!==this.defaultValue.dataset.value)return!1;if(this.displayNode&&this.displayNode.value!==this.defaultValue.innerText)return!1}return!(!this.defaultValue||!this.displayNode)}defaultSelected(e){if(!this.enabled)return!1;var t,i=!(!e||!("target"in e))&&e.target;return!!i&&(t=this._cleanDisplay(i.innerText),this.listNode.querySelector("li.selected")&&this.listNode.querySelector("li.selected").classList.remove("selected"),i.classList.add("selected"),this.displayNode.value=t,this.targetNode.selectedIndex=i.dataset.index,this.targetNode.value=i.dataset.value,!0)}refreshFromSelect(){this.displayNode.value="",this._updateOptions()}_fuzzyWorkerComplete(e){var t=e.data;switch(this.debug&&(console.log("! Autocomplete fuzzyWorkerComplete: "),console.log("! \t returned data : ",e),console.log("! \t job           : ",t.job)),t.job){case"getOptions":this.searchMode,this.workerComplete=!0;break;case"getList":if(!this.enabled)return!1;this._resetListEvents();var i=!1;this.listNode&&Affinity2018.isNode(this.listNode)?(this.listNode.innerHTML=t.html,this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listNode.querySelectorAll("li"),this._position(0,"worker getList"),this._setListEvents(),t.data.defaultID&&(i=!(!this.listNode||!$a.isNode(this.listNode))&&this.listNode.querySelector("#"+e.data.data.defaultID))&&(this.defaultValue=i,this.lastSelected=i,this.defaultChangeValue=i.dataset.value),this._continueProcessOptions(i,!0)):this.workerComplete=!0;break;case"getSelectedList":this._resetListEvents(),this.listNode.innerHTML=t.html,this.fuzzySearchItemsTotal=t.data.items.length,this.fuzzySearchItems=t.data.items,this.items=this.listNode.querySelectorAll("li"),this._setListEvents(),this._position(0,"worker getSelectedList"),this.workerComplete=!0;break;case"resetList":var s=!1;this.listNode.innerHTML=t.html,this._position(0,"worker resetList"),this.displayNode.value="",this.listNode.scrollTo(0,0),this.targetNode.selectedIndex=0,t.select&&(s=this.listNode.querySelector("#"+t.select))&&(this.lastSelected=s,this.defaultValue=s,this.bestguess=s,this.targetNode.value=s.value,this.targetNode.selectedIndex=parseInt(s.dataset.index),this.listNode.scrollTo(0,Affinity2018.getOffsetRect(s).y-5)),this.defaultChangeValue=this.defaultValue.value,this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listNode.querySelectorAll("li"),this._setListEvents(),this._fireWindowChangeEvent("autocomplete _fuzzyWorkerComplete resetList"),this.workerComplete=!0;break;case"doSearch":if(!this.enabled)return!1;this._resetListEvents();var o=!1;this.listNode.innerHTML=t.html,this._position(0,"worker doSearch"),t.bestguess&&(o=document.querySelector("#"+t.bestguess))&&(this.bestguess=o),this.items=this.listNode.querySelectorAll("li"),this._setListEvents(),this.workerComplete=!0;break;case"terminate":this.fuzzyWorker.onmessage=null,this.fuzzyWorker.terminate(),this.fuzzyWorker=!1,this.workerComplete=!0}this.iconNode&&this.iconNode.classList.remove("working")}_updateOptions(){this._clearList(),this._processOptions()}_processOptions(){if(!Affinity2018.isDomElement(this.targetNode)||!this.targetNode)return!1;var e,t,i,s=!1,o=this.targetNode.querySelectorAll("option"),a=!1;return(o.length>this.selectmax||this.targetNode.classList.contains("massive"))&&(this.searchMode=!0),this.searchMode,navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.displayNode.setAttribute("autocomplete","off"),this.targetNode.classList.contains("has-message-icon")&&this.displayNode.classList.add("has-message-icon"),this.targetNode.dataset.displayId=this.uuid+"-Display",this.autowidth&&this.listNode.classList.add("auto-width"),(this.displayNode.classList.contains("width-auto")||this.displayNode.classList.contains("width-full"))&&(this.listNode.styles.width=Affinity2018.getBoundingClientRect().width+"px"),this._resetListEvents(),this.listNode.innerHTML="",this.listNode.classList.remove("show"),this.items=[],this.fuzzySearchItems=[],this.defaultValue=null,this.useWebWorkers?(this.iconNode&&this.iconNode.classList.add("working"),this.workerComplete=!1,this.fuzzyWorker.postMessage({job:"getList",html:this.targetNode.innerHTML,defaultValue:this.targetNode.dataset.defaultValue||this.targetNode.value,filter:this.filter,uuid:this.uuid}),s=!0):(this.targetNode.querySelectorAll("option").forEach(function(s,o){e=this._cleanDisplay(s.innerHTML.replace(/\,/g," - ")),t=s.value,(i=document.createElement("li")).innerHTML=e,i.dataset.dataValue=t,i.dataset.value=t,i.dataset.index=o,i.className="visible",i.id=this.uuid+"-li-"+o,s.dataset.filterCss&&s.dataset.filterCss.split(" ").forEach((function(e){i.classList.add(e)})),i.addEventListener("click",this._itemClicked),this.listNode.appendChild(i),s.selected&&(a=i,this.defaultValue=i,i.classList.add("selected"),this.lastSelected=i,this.defaultChangeValue=s.value),this.fuzzySearchItems.push({id:this.uuid+"-li-"+o,html:e,klass:"visible",searchstr:e,value:s.value})}.bind(this)),s=this._continueProcessOptions(a)),s}_continueProcessOptions(e,t){return t=void 0!==t&&t,this.searchMode=!1,this.searchMode||(this.useWebWorkers||(this.fuzzySearchItemsTotal=this.fuzzySearchItems.length),this.iconElement&&this.iconElement.classList.remove("working"),this.fuzzySearchLargeDataDelay=100,this.fuzzySearchItemsTotal>=2e3&&this.fuzzySearchItemsTotal<3e3&&(this.fuzzySearchLargeDataDelay=250),this.fuzzySearchItemsTotal>=3e3&&this.fuzzySearchItemsTotal<5e3&&(this.fuzzySearchLargeDataDelay=500),this.fuzzySearchItemsTotal>=5e3&&(this.fuzzySearchLargeDataDelay=1e3),Affinity2018.isie&&11===Affinity2018.ieversion&&(this.fuzzySearchLargeDataDelay=1001),null===this.defaultValue&&(this.defaultValue=this.listNode.querySelector("li")),this.keyHeldCheck=!1,this.keyHeld=!1,this.keyHeldDelay=null,this.displayNode.addEventListener("keydown",this._doKeyDown),this.displayNode.addEventListener("keyup",this._doKeyUp),null!==e&&!1!==e?this.defaultSelected({target:e}):this.listNode.querySelector('li[data-value="'+this.targetNode.value+'"]')?(this.defaultSelected({target:this.listNode.querySelector('li[data-value="'+this.targetNode.value+'"]')}),this.defaultChangeValue=this.targetNode.value):this.defaultSelected({target:this.listNode.querySelector("li")}),this.dispatchEvent(new CustomEvent("complete",{detail:{dispatchObject:this}})),this.dispatchEvent(new CustomEvent("ready")),this.targetNode.dispatchEvent(new Event("ready")),this.targetNode.value!==this.defaultChangeValue?(this.defaultChangeValue=this.targetNode.value,this.changed=!0):this.changed=!1,this.stopInitialChange&&this.targetNode.dispatchEvent(new Event("change"))),this.Ready=!0,t&&(this.targetNode.dispatchEvent(new Event("workerComplete")),this.workerComplete=!0),!0}_fuzzySearch(e,t,i,s){if(!this.enabled)return!1;if(!this.fuzzyRunning){this.fuzzyRunning=!0;var o=[];if(this.useWebWorkers)this.fuzzyDoSearchData={searchData:e,target:s},this.iconElement&&this.iconElement.classList.add("working"),this.debug&&(console.log("! Autocomplete _fuzzySearch: "),console.log("! \t target      : ",s),console.log("! \t search key  : ",t),console.log("! \t search for  : ",i),console.log("! \t search data : ",e)),this.workerComplete=!1,this.fuzzyWorker.postMessage({job:"doSearch",data:e,searchKey:t,searchFor:i,perfDelay:this.fuzzySearchLargeDataDelay,filter:this.filter});else{var a,n,r,l,d,h,c,u,p,f,m,y,g,v,A=[];isNaN(i)?e.forEach(function(e,s){n=document.querySelector("#"+e.id),r=0,i=i.toLowerCase(),d=e[t].toLowerCase().trim(),h=i===d,c=d.indexOf(i)>-1,f=i.split(" "),u=f.length,h?(p=u,l=99999,r=99999,n.classList.remove("hidden"),n.classList.add("visible"),this.fuzzySearchLargeDataDelay||(v="<strong>"+this._cleanDisplay(n.innerText)+"</strong>",n.innerHTML=v,n.classList.remove("hidden"),n.classList.add("visible"))):!h&&c?(p=d.split(i).length-1||0,r=(l=p)+100,this.fuzzySearchLargeDataDelay?(n.classList.remove("hidden"),n.classList.add("visible")):(v=(v=this._cleanDisplay(n.innerText)).replace(new RegExp("("+this._escapeRegExp(i)+")","gi"),"<strong>$1</strong>"),n.innerHTML=v,n.classList.remove("hidden"),n.classList.add("visible"))):this.fuzzySearchLargeDataDelay<1001&&(m=d.split(" "),p=0,f.forEach((function(e){m.forEach((function(t){" "!==e&&""!==e&&(y=e.soundex(),g=t.soundex(),0==y.distance(g)&&(p+=1))}))})),r=p,l=Math.round(p/u*100)/100||0,r>=0&&(this.fuzzySearchLargeDataDelay?(n.classList.remove("hidden"),n.classList.add("visible")):(v=this._cleanDisplay(n.innerText),n.innerHTML=v,n.classList.remove("hidden"),n.classList.add("visible")))),a={originalIndex:s,score:r,wordScore:l},A.push(a)}.bind(this)):e.forEach(function(e,s){n=document.querySelector("#"+e.id),e[t].contains(i)?(l=e[t].split(i).length-1||0,m=e[t].split(" "),A.push({originalIndex:s,score:l,wordScore:l/m}),n.classList.remove("hidden"),n.classList.add("visible")):(n.classList.remove("visible"),n.classList.add("hidden"))}.bind(this)),A.sort((function(e,t){return parseFloat(e.score)===parseFloat(t.score)?parseFloat(e.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(e.score)<parseFloat(t.score)?1:-1}));var w,N=!1;A.forEach((function(t){(w=e[t.originalIndex]).score=t.score,w.wordScore=t.wordScore,o.push(w),n=document.querySelector("#"+w.id),t.score>0?(s.appendChild(n),N=!0):(n.classList.remove("visible"),n.classList.add("hidden"))})),!N&&A.length>0&&A[0].originalIndex&&e[A[0].originalIndex]&&e[A[0].originalIndex].id&&(this.bestguess=document.querySelector("#"+e[A[0].originalIndex].id))}return this.fuzzyRunning=!1,o}}_continueWithFuzzySearch(){this._fuzzySearch(this.fuzzySearchItems,"searchstr",this._cleanDisplay(this.displayNode.value.toLowerCase()),this.listNode),this._position(null,"continueWithFuzzySearch")}_getTopVisibleElement(){var e,t,i=this.listNode.querySelectorAll("li.visible");for(e=0;e<i.length;e++)if(t=i[e],Affinity2018.getOffsetRect(t).y>=0)return t}_getBottomVisibleElement(){var e,t,i=this.listNode.getBoundingClientRect().height,s=this.listNode.querySelectorAll("li.visible");for(e=s.length-1;e>0;e--)if(t=s[e],Affinity2018.getOffsetRect(t).y<=i)return t}_scrollToTop(e){if(Affinity2018.isDomElement(e)){var t=this.listNode.scrollTop,i=Affinity2018.getOffsetRect(e),s=e.getBoundingClientRect().height;i.y<0&&this.listNode.scrollTo(0,t+i.y-s+10)}}_scrollToBottom(e){if(Affinity2018.isDomElement(e)){var t=this.listNode.scrollTop,i=this.listNode.getBoundingClientRect().height,s=Affinity2018.getOffsetRect(e),o=e.getBoundingClientRect().height;s.y>i-o&&this.listNode.scrollTo(0,t+(s.y-i)+o+5)}}_elementKeySetHeld(e){this.keyHeld=!0,this._elementKeyUp(e)}_elementKeyUp(e){if(!this.enabled)return!1;clearTimeout(this._elementKeyUpTimer);var t=this._cleanDisplay(this.displayNode.value.toLowerCase()),i=this.listNode.querySelector("li.visible.selected")||!1;return 13===e.keyCode&&i?(this._stopEvents(e),void this._itemClicked({target:i})):40===e.keyCode||38===e.keyCode?("closed"==this.status&&(this._position(null,"key up / down"),this.show("key up / down")),this._stopEvents(e),40===e.keyCode&&this._elementDown(e),38===e.keyCode&&this._elementUp(e),void(this.keyHeld&&(this._elementKeyUpTimer=setTimeout(this._elementKeyUp,50,e)))):void((8===e.keyCode||16===e.keyCode||32===e.keyCode||46===e.keyCode||e.keyCode>=48&&e.keyCode<=57||e.keyCode>=65&&e.keyCode<=90||e.keyCode>=96&&e.keyCode<=105)&&("closed"==this.status&&(this._position(null,"typing"),this.show("typing")),this.debug&&(console.log("! Autocomplete keyup: "),console.log("! \t key code : ",e.code),console.log("! \t compare  : ",t)),""!==t?(this.listNode.querySelector("li.selected")&&this.listNode.querySelector("li.selected").classList.remove("selected"),this.listNode.scrollTo(0,0),i&&(this.lastSelected=i),this.fuzzySearchLargeDataDelay?(clearTimeout(this._fuzzySearchDelay),this._fuzzySearchDelay=setTimeout(this._continueWithFuzzySearch,this.fuzzySearchLargeDataDelay)):this._continueWithFuzzySearch(),this._position(null,"element up")):this.useWebWorkers?(this.workerComplete=!1,this.fuzzyWorker.postMessage({job:"resetList"})):(this.items.forEach(function(e,t){this.listNode.appendChild(e),e.innerHTML=this._cleanDisplay(li.innerText),e.classList.remove("selected","hidden"),e.classList.add("visible"),""===e.innerHTML.trim()&&(e.classList.add("selected"),i!==e&&(this.changed=!0),this.lastSelected=e,this.defaultValue=e,this.targetNode.value="",this.targetNode.selectedIndex=0,this.listNode.scrollTo(0,0),this.defaultChangeValue=this.targetNode.querySelector("option").value)}.bind(this)),this.bestguess=this.defaultValue,this._fireWindowChangeEvent("autocomplete _elementKeyUp"))))}_doFocus(){if(!this.enabled)return!1;clearTimeout(this._focusDelay),this._focusDelay=setTimeout(function(){"closed"==this.status&&(this._position(0,"displayNode focus"),this.show("displayNode focus"))}.bind(this),100),Affinity2018.ismobile&&(this.displayNode.selectionStart=0,this.displayNode.selectionEnd=999999)}_doClick(e){if(!this.enabled)return!1;this._stopEvents(e),this.displayNode.select()}_doKeyDown(e){if(!this.enabled)return!1;if(9===e.keyCode&&this.hide("on key down tab"),9!==e.keyCode)if(13!==e.keyCode){if(40===e.keyCode||38===e.keyCode){if(this.keyHeldCheck||this.keyHeld)return void this._stopEvents(e);this.keyHeldCheck||this.keyHeld||(this.keyHeldCheck=!0,this.keyHeldDelay=setTimeout(this._elementKeySetHeld,500,e))}}else this._stopEvents(e)}_doKeyUp(e){if(!this.enabled)return!1;9===e.keyCode||e.shiftKey||(9===e.keyCode&&this.hide("on key up tab"),clearTimeout(this.keyHeldDelay),this.keyHeld||this._elementKeyUp(e),this.keyHeld=!1,this.keyHeldCheck=!1)}_elementDown(){if(!this.enabled)return!1;if(0!==this.listNode.querySelectorAll("li.visible").length){var e=this.listNode.querySelector("li.visible.selected"),t=this._getTopVisibleElement(),i=this._getBottomVisibleElement(),s=-1,o=this.listNode.querySelectorAll("li.visible");e&&Affinity2018.isDomElement(e)&&(s=Array.prototype.indexOf.call(o,e),e.classList.remove("selected")),s<Array.prototype.indexOf.call(o,t)?t&&Affinity2018.isDomElement(t)&&t.classList.add("selected"):s<o.length-1?o[s+1]&&Affinity2018.isDomElement(o[s+1])&&(o[s+1].classList.add("selected"),this._scrollToBottom(o[s+1])):this.listNode.scrollHeight==this.listNode.clientHeight?t&&Affinity2018.isDomElement(t)&&t.classList.add("selected"):i&&Affinity2018.isDomElement(i)&&i.classList.add("selected")}else this.hide("elementDown with empty list")}_elementUp(){if(!this.enabled)return!1;if(0!==this.listNode.querySelectorAll("li.visible").length){var e=this.listNode.querySelector("li.visible.selected"),t=this._getTopVisibleElement(),i=this._getBottomVisibleElement(),s=-1,o=this.listNode.querySelectorAll("li.visible");e&&(s=Array.prototype.indexOf.call(o,e),e.classList.remove("selected")),s>Array.prototype.indexOf.call(o,i)?i&&Affinity2018.isDomElement(i)&&i.classList.add("selected"):s>0?o[s-1]&&Affinity2018.isDomElement(o[s-1])&&(o[s-1].classList.add("selected"),this._scrollToTop(o[s-1])):this.listNode.scrollHeight==this.listNode.clientHeight?i&&Affinity2018.isDomElement(i)&&i.classList.add("selected"):t&&Affinity2018.isDomElement(t)&&t.classList.add("selected"),this._fireWindowChangeEvent("autocomplete _elementUp")}else this.hide("elementUp with empty list")}_itemClicked(e){if(!this.enabled)return!1;clearTimeout(this._kepListDelay),this.hide("item clicked");var t=!(!e||!$a.isNode(e.target))&&("li"==e.target.tagName?e.target:e.target.closest("li")),i=!e.hasOwnProperty("fireEvents")||"boolean"!=typeof e.fireEvents||e.fireEvents;t&&(this.listNode.querySelector("li.selected")&&this.listNode.querySelector("li.selected").classList.remove("selected"),t.classList.add("selected"),this.lastSelected=t,this.displayNode.value=this._cleanDisplay(t.innerText),this.targetNode.selectedIndex=t.dataset.index,this.targetNode.value=t.dataset.value,this.targetNode.value!==this.defaultChangeValue?(this.defaultChangeValue=this.targetNode.value,this.changed=!0):this.changed=!1,this.elementChangedOnly?i&&this.dispatchEvent(new CustomEvent("elementChanged",{detail:{dispatchObject:this.targetNode.value}})):i&&(null!==this.targetNode.onchange?this.targetNode.onchange():this.targetNode.dispatchEvent(new Event("change")),this._fireWindowChangeEvent("autocomplete _itemClicked"),this.dispatchEvent(new CustomEvent("elementChanged",{detail:{dispatchObject:this.targetNode.value}}))),this.keeplist&&(this._kepListDelay=setTimeout(this._restoreSelectedList,1e3)))}_restoreSelectedList(){this.fuzzyWorker&&"postMessage"in this.fuzzyWorker&&(this.workerComplete=!1,this.fuzzyWorker.postMessage({job:"getSelectedList",defaultValue:this.targetNode.value,filter:this.filter,uuid:this.uuid}))}_clearList(){this.listNode&&(this._resetListEvents(),this.listNode.innerHTML="")}_scrolled(e){this._stopEvents(e),this._position(null,"scroll")}_position(e,t){clearTimeout(this._positionDelay),this.forceTop?this.listNode.classList.add("above"):(e="number"==typeof e?e:100,this._positionDelay=setTimeout(this._setPosition,e,t))}_setPosition(e){if(clearTimeout(this._positionDelay),this.forceTop)this.listNode.classList.add("above");else if(this.displayNode&&this.listNode&&"open"===this.status){this.listNode.classList.remove("above");var t=this.listNode.getBoundingClientRect(),i=Affinity2018.getWindowSize(),s=document.body.scrollTop||0;parseFloat(t.top)+parseFloat(t.height)+s>i.height-50&&this.listNode.classList.add("above")}}_cleanDisplay(e){return"string"==typeof e&&""!==e.trim()?e.trim().replace(/&amp;/gi,"&"):e}_cleaValue(e){return"string"==typeof e&&""!==e.trim()?e.replace(/&amp;/gi,"&"):e}_resetListEvents(){return!(!this.listNode||!this.listNode.querySelector("li")||(this.listNode.querySelectorAll("li").forEach(function(e){e.removeEventListener("click",this._itemClicked)}.bind(this)),0))}_setListEvents(){return!(!this.listNode||!this.listNode.querySelector("li")||(this.listNode.querySelectorAll("li").forEach(function(e){e.removeEventListener("click",this._itemClicked),e.addEventListener("click",this._itemClicked)}.bind(this)),0))}_fireWindowChangeEvent(e){var t=new Event("elementChanged");t.element=this.targetNode,t.callee=e,window.dispatchEvent(t)}_escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}_stopEvents(e){e&&(e.stopPropagation(),"scroll"===e.type&&Affinity2018.SupportsPassiveEvents||e.preventDefault())}_clearShowHideEvents(){clearTimeout(this.bgEventListenerDelay),window.removeEventListener("click",this._windowClicked),this.displayNode.removeEventListener("click",this._stopEvents),this.autocompleteNode.removeEventListener("click",this._stopEvents)}_setHideShowEvents(){clearTimeout(this.bgEventListenerDelay),this._clearShowHideEvents(),this.bgEventListenerDelay=setTimeout(function(){window.addEventListener("click",this._windowClicked)}.bind(this),100),this.displayNode.addEventListener("click",this._stopEvents),this.autocompleteNode.addEventListener("click",this._stopEvents)}_windowClicked(e){document.activeElement!==this.displayNode&&this.hide()}_show(e){if("open"!==this.status&&Affinity2018.isDomElement(this.listNode)&&this.listNode.querySelectorAll("li.visible").length>0){if(Affinity2018.Calendars&&Affinity2018.Calendars.HideAll(),Affinity2018.Autocompletes.HideAll(this),clearTimeout(this._focusDelay),this.listNode.classList.add("show"),this.status="open",this.listNode.querySelectorAll("li.visible.selected")){var t=this.listNode.querySelector("li.visible.selected");t&&(this.listNode.scrollTo(0,0),this.listNode.scrollTo(0,Affinity2018.getOffsetRect(t).y-5))}this._setPosition("show"),this._setHideShowEvents(),Affinity2018.hasOwnProperty("ForceSectionTop")&&Affinity2018.ForceSectionTop(this.listNode)}}_hide(e){"closed"!==this.status&&(clearTimeout(this._focusDelay),clearTimeout(this._fuzzySearchDelay),clearTimeout(this._hideResetTimer),this.listNode.classList.remove("show"),this.status="closed",this._hideResetTimer=setTimeout(function(){Affinity2018.isDomElement(this.listNode)&&this.listNode.querySelector("li.visible.selected")&&(this.lastSelected=this.listNode.querySelector("li.visible.selected")),this._reset()}.bind(this),250),this._clearShowHideEvents(),Affinity2018.hasOwnProperty("ResetForceSectionTop")&&Affinity2018.ResetForceSectionTop(this.listNode))}_reset(){if(this.searchMode=!1,!this.searchMode){var e=!1;Affinity2018.isDomElement(this.defaultValue)&&"li"===this.defaultValue.tagName.toLowerCase()&&(e=this.defaultValue),Affinity2018.isDomElement(this.lastSelected)&&"li"===this.lastSelected.tagName.toLowerCase()&&(e=this.lastSelected),this.items.forEach(function(t,i){this.listNode.appendChild(t),this.listNode.classList.remove("selected","hidden","visible"),this.fuzzySearchLargeDataDelay||(t.innerHTML=this._cleanDisplay(t.innerText)),e&&t===e&&(t.classList.add("selected"),this.listNode.scrollTo(0,Affinity2018.getOffsetRect(t).y-5),this.displayNode.value=this._cleanDisplay(e.innerText))}.bind(this))}}_mouseEnter(e){Affinity2018.lockBodyScroll()}_mouseLeave(e){var t=!0;e&&$a.isEvent(e)&&$a.isNode(e.target)&&e.target.closest(".popup")&&(t=!1),t&&Affinity2018.unlockBodyScroll()}Destroy(){for(var e in this._reset(),this._clearShowHideEvents(),clearTimeout(this._elementKeyUpTimer),clearTimeout(this._fuzzySearchDelay),clearTimeout(this._focusDelay),clearTimeout(this.keyHeldDelay),clearTimeout(this._positionDelay),clearTimeout(this.bgEventListenerDelay),clearTimeout(this._hideResetTimer),this.enabled=!1,this.targetNode.remove("ui-autocomplete"),window.removeEventListener("mobileback",function(){this.hide()}.bind(this)),document.removeEventListener("scroll",this._scrolled,Affinity2018.PassiveEventProp),document.removeEventListener("resize",this._position,Affinity2018.PassiveEventProp),this.autocompleteNode.removeEventListener("mouseenter",this._mouseEnter),this.autocompleteNode.removeEventListener("mouseleave",this._mouseLeave),this.fuzzyWorker&&(this.fuzzyWorker.onmessage=null,this.fuzzyWorker.terminate(),this.fuzzyWorker=!1),delete this.targetNode.widgets.Autocomplete,delete Affinity2018.Autocompletes.widgets[this.uuid],this.autocompleteNode.innerHTML="",this.autocompleteNode.parentNode.removeChild(this.autocompleteNode),this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e]);return!0}_templates(){this.autocompleteTemplate='\n      <div class="ui-ac-display-wrapper">\n        <input class="ui-ac-display" type="text">\n        <div class="ui-ac-display-icon icon-search"></div>\n        <div class="ui-ac-display-loader"></div>\n      </div>\n      <ul class="ui-autocomplete-list">\n      </ul>\n    '}};var fuzzyRunning=!1,fuzzySearchData=[],originalListHTML="",originalListItems=[],initialSelected="";function cleanDisplay(e,t){var i,s=e;return void 0===t&&-1!==e.indexOf(" (")&&(t=(t=e.substr(e.indexOf(" (")+2)).substring(0,t.length-1).trim(),e=e.substring(0,e.indexOf(" (")).trim()),e&&"string"==typeof e&&""!==e.trim()?"-"!==(i=(s=e.trim().replace(/&amp;/gi,"&")).charAt(s.length-1))&&"_"!==i&&":"!==i&&","!==i||(s=s.substring(0,s.length-1).trim()):s="Not Set",t&&"string"==typeof t&&""!==t.trim()&&-1===s.indexOf(t)&&(s=s+" ("+t+")"),s}function escapeRegExp(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}function stripTags(e){return"string"==typeof e&&""!==e.trim()?e.replace(/<(?:.|\n)*?>/gm,""):e}function contains(e,t){return e.indexOf(t)>-1&&e.indexOf(t)}function soundex(e){var t,i,s,o,a,n,r="";for("H"!=(a=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=(r=e=e.toUpperCase()).replace(/[^A-Z]/gi," ")).replace(/^\s*/g,"")).replace(/\s*$/g,"")).replace(/^GH/g,"G")).replace(/DG/g,"G")).replace(/GH/g,"H")).replace(/GN/g,"N")).replace(/KN/g,"N")).replace(/PH/g,"F")).replace(/MP([STZ])/g,"M$1")).replace(/^PS/g,"S")).replace(/^PF/g,"F")).replace(/MB/g,"M")).replace(/TCH/g,"CH")).substr(0,1))&&"W"!=a||(r="-"+r.substr(1)),o=(r=(r=(r=(r=(r=(r=(r=r.replace(/[AEIOUYHW]/g,"0")).replace(/[BPFV]/g,"1")).replace(/[CSGJKQXZ]/g,"2")).replace(/[DT]/g,"3")).replace(/[L]/g,"4")).replace(/[MN]/g,"5")).replace(/[R]/g,"6")).length,s="",t="",n=0;n<o;n++)(i=r.charAt(n))==s?t+=" ":(t+=i,s=i);return r=(r=(r=(r=t).substr(1)).replace(/\s/g,"")).replace(/0/g,""),(r=a+(r+="0000000000")).substr(0,5)}function distance(e,t){var i,s,o=e.toLowerCase(),a=t.toLowerCase(),n=[];if(0===o.length)return a.length;if(0===a.length)return o.length;for(i=0;i<=a.length;i++)n[i]=[i];for(s=0;s<=o.length;s++)n[0][s]=s;for(i=1;i<=a.length;i++)for(s=1;s<=o.length;s++)a.charAt(i-1)==o.charAt(s-1)?n[i][s]=n[i-1][s-1]:n[i][s]=Math.min(n[i-1][s-1]+1,Math.min(n[i][s-1]+1,n[i-1][s]+1));return n[a.length][o.length]}function returnSelectOptions(e,t,i,s){var o,a,n,r,l="";for(o=0;o<e.length;o++)((a=e[o]).Value.toLowerCase().indexOf(t.toLowerCase())>-1||i)&&(n=!0,null!==s&&new RegExp("("+s+")","gi").test(a.Value)&&(n=!1),n&&(r='<option value="'+a.Key+'">'+cleanDisplay(a.Value,a.Key)+"</option>",a.Value===t&&(r='<option value="'+a.Key+'" selected>'+cleanDisplay(a.Value,a.Key)+"</option>"),l+=r));postMessage({job:"getOptions",html:l})}function returnListItem(e){var t="<li";return e.hasOwnProperty("uuid")?t+=' id="'+e.uuid+"-li-"+e.originalIndex+'"':e.hasOwnProperty("id")&&(t+=' id="'+e.id+'"'),t+=' class="'+e.klass+'"',t+=' data-index="'+e.originalIndex+'"',t+=' data-value="'+e.value+'"',t+=' data-display="'+e.html+'"',t+=">",(t+=e.html)+"</li>"}function returnList(e,t,i,s){for(var o,a,n,r,l,d,h,c=t.split("</option>"),u=[],p={defaultID:!1,html:"",total:0},f="",m=0,y=0;m<c.length;m++)if(t=c[m],0===m||""!==t.trim()){if(n=cleanDisplay((a=t.substring(t.indexOf(">")+1)).replace(/\, /g," - ")),r=new RegExp('value="',"gi").test(t)?t.substring(t.indexOf('value="')+7,t.indexOf('"',t.indexOf('value="')+7)):"",o="visible",(new RegExp("selected","gi").test(t)||r+""==i+"")&&(o+=" selected",p.defaultID=e+"-li-"+m,initialSelected=e+"-li-"+m),new RegExp('data-filter-css="',"gi").test(t)){var g=t.indexOf('data-filter-css="')+17,v=t.indexOf('"',g),A=t.substr(g,v-g);"hidden"===A&&o.indexOf("visible")>-1&&(o=o.replace("visible","")),o+=" "+A}var w=!0;if(null!==s&&new RegExp("("+s+")","gi").test(n)&&(w=!1),w){for(l=returnListItem({uuid:e,klass:o,originalIndex:m,value:r,html:n}),p.html+=l,f+=l,u.push({id:e+"-li-"+m,html:l,klass:o,searchstr:a,value:r}),p.total++,d=a.trim().toLowerCase().replace(new RegExp(/ /g)," ").split(" "),h=[],y=0;y<d.length;y++)h.push(soundex(d[y]));fuzzySearchData.push({id:e+"-li-"+m,html:l,oghtml:l,klass:o,searchstr:a,value:r,words:d,wordCount:d.length,soundex:h,originalIndex:m})}}originalListHTML=f+"",originalListItems=JSON.parse(JSON.stringify(u)+""),p.items=u,postMessage({job:"getList",data:p,html:f})}function returnSelectedList(e,t,i){for(var s,o,a=(originalListHTML+"").replace(new RegExp(" selected","gi"),"").split("<li"),n=0,r="";n<a.length;n++)if(""!==(s=a[n]).trim()){var l=!0;null!==i&&new RegExp("("+i+")","gi").test(s)&&(l=!1),l&&(o=s.substring(s.indexOf(">")+1,s.indexOf("<",s.indexOf(">")+1)),(s="<li"+s.replace(new RegExp(escapeRegExp(o),"g"),cleanDisplay(stripTags(o)))).indexOf('data-value="'+t+'"')>-1&&(s=s.replace(new RegExp('class="visible"',"g"),'class="visible selected"')),r+=s)}r=(r=r.replace(new RegExp("<li<li","gi"),"<li")).replace(new RegExp("</li<li>","gi"),"</li>"),postMessage({job:"getSelectedList",html:r,data:{items:originalListItems}})}function returnResetList(){var e={items:originalListItems,total:originalListItems.length};postMessage({job:"resetList",data:e,html:originalListHTML,select:initialSelected})}function escapeRegExp(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}function filterClassExists(e){return""!==e.trim()&&(e.indexOf(" filters-")>-1||0===e.indexOf("filters-"))}function returnClassFilters(e){if(!filterClassExists(e))return[];for(var t=[],i=e.split(" "),s=0;s<i.length;s++)i[s].indexOf("filters-")>-1&&t.push(i[s]);return t.join(" ")}function addClassString(e,t){if(""===t.trim())return e;for(var i=!1,s=t.split(" "),o=0;o<s.length;o++)if(s[o]===e){i=!0;break}return i||s.push(e),s.join(" ")}function fuzzySearch(e,t,i,s,o){if(!fuzzyRunning){fuzzyRunning=!0,console.log(e);var a,n,r,l,d,h,c,u,p,f,m,y,g,v,A,w,N,b,S,D,C,_,L=[],E=[],F=!1,T=!1;if(isNaN(i)){if(e&&"object"==typeof e&&"length"in e&&e.length>0)for(g=0;g<e.length;g++)if(N=e[g]||!1,k=fuzzySearchData[g],n=!0,null!==o&&new RegExp("("+o+")","gi").test(k.value)&&(n=!1),n){if(C=filterClassExists(N?N.klass:k.klass),_=returnClassFilters(N?N.klass:k.klass),r=0,d=(i=i.toLowerCase())===(D=k[t].toLowerCase().trim()),h=D.indexOf(i)>-1,c=(f=i.split(" ")).length,p=D.trim().replace(/[ ]{2,}/gi," ").split(" ").length,d&&(u=c,l=99999,r=99999,k.klass="visible",k.html=s?cleanDisplay(stripTags(k.html)):"<strong>"+cleanDisplay(stripTags(k.html))+"</strong>"),!d)if(h)u=D.split(i).length-1||0,r=(l=Math.round(u/p*100)/100||0)+100,k.klass="visible",!s||s<101?(b=(b=this.cleanDisplay(stripTags(k.html))).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1</strong>"),k.html=b):k.html=this.cleanDisplay(stripTags(k.html));else if(!s||s<1001){for(m=k.words,u=0,v=0;v<f.length;v++)for(S=f[v],A=0;A<m.length;A++)(y=m[A])&&S&&"string"==typeof y&&"string"==typeof S&&""!==y.trim()&&""!==S.trim()&&0==distance(soundex(S),soundex(y))&&(u+=1);(r=(l=Math.round(u/p*100)/100||0)+u)>=0&&(k.klass="visible",!s||s<101?(b=(b=this.cleanDisplay(stripTags(k.html))).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1</strong>"),k.html=b):k.html=cleanDisplay(stripTags(k.html)))}C&&(k.klass=addClassString(_,k.klass)),a={uuid:k.id,originalIndex:g,html:k.html,value:k.value,klass:k.klass,score:r,wordScore:l},E.push(a)}}else for(g=0;g<fuzzySearchData.length;g++)w=g,N=e[g]||!1,k=fuzzySearchData[g],n=!0,null!==o&&new RegExp("("+o+")","gi").test(k.value)&&(n=!1),n&&(C=filterClassExists(N?N.klass:k.klass),_=returnClassFilters(N?N.klass:k.klass),-1!==k[t].indexOf(i)?(l=k[t].split(i).length-1||0,m=k.words,C&&(k.klass=addClassString(_,k.klass)),(a={uuid:k.uuid,originalIndex:w,html:k.html,value:k.value,klass:k.klass,score:l,wordScore:l/m}).html=s<101?cleanDisplay(stripTags(k.html)).replace(new RegExp("("+escapeRegExp(i)+")","gi"),"<strong>$1</strong>"):cleanDisplay(stripTags(k.html)),E.push(a),k.klass="visible"):k.klass="hidden",C&&(k.klass=addClassString(_,k.klass)));E.sort((function(e,t){return parseFloat(e.score)===parseFloat(t.score)?parseFloat(e.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(e.score)<parseFloat(t.score)?1:-1}));var k,P="";for(F=!1,g=0;g<E.length;g++)result=E[g],(k=fuzzySearchData[result.originalIndex]).score=result.score,k.wordScore=result.wordScore,k.originalIndex=result.originalIndex,k.html=result.html,k.klass=result.klass,C=filterClassExists(k.klass),_=returnClassFilters(k.klass),L.push(k),result.score>0?(k.klass="visible",F=!0):k.klass="hidden",C&&(k.klass=addClassString(_,k.klass)),k.html&&(P+=b=returnListItem(k));!F&&E.length>0&&E[0].originalIndex&&e[E[0].originalIndex]&&e[E[0].originalIndex].element&&(T=e[E[0].originalIndex].id),fuzzyRunning=!1,postMessage({job:"doSearch",data:L,gotone:F,bestguess:T,html:P})}}onmessage=function(e){var t=e.data;"getOptions"===t.job&&returnSelectOptions(t.data,t.searchFor,t.ismobile,t.filter),"getList"===t.job&&returnList(t.uuid,t.html,t.defaultValue,t.filter),"getSelectedList"===t.job&&returnSelectedList(t.uuid,t.defaultValue,t.filter),"resetList"===t.job&&returnResetList(),"doSearch"===t.job&&fuzzySearch(t.data,t.searchKey,t.searchFor,t.perfDelay,t.filter),"terminate"===t.job&&close()},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.BankNumber=class{_options(){}constructor(){this._options(),["Apply","Remove","_apply","_templates"].bindEach(this),this._templates()}Apply(e){null!=e?this._apply(e):document.querySelectorAll(".ui-has-banknumber").forEach(this._apply)}Remove(e){e.classList.contains("ui-banknumber")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("BankNumber")&&e.widgets.BankNumber.Destroy()}_apply(e){new Affinity2018.Classes.Plugins.BankNumberWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.BankNumberWidget=class{_options(){this.WidgetName="BankNumber",this.CountryCodes=["AU","NZ","A","N"],this.DefaultCountryCode="AU",this.CountryCodeMap={A:"AU",N:"NZ"},this.hasPayPoint=!1,this.PayPoint=!1,this.Valid=!1,this.pasting=!1}constructor(e){if(this._options(),["Get","GetData","Set","_clear","_stringToNodes","_stringFromNodes","_getCountryCode","_setupCountry","_setIcon","_userKey","_userKeyUp","_userValidate","_validate","Destroy","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){e.classList.remove("ui-has-banknumber"),e.classList.add("ui-banknumber","no-validate"),this.initInputNode=e,this.initInputNode.type="hidden",this.initInputNode.hasOwnProperty("widgets")||(this.initInputNode.widgets={}),this.initInputNode.widgets.BankNumber=this,this.banknumberNode=document.createElement("div"),this.banknumberNode.classList.add("banknumber-box","nz"),this.banknumberNode.innerHTML=this.template,this.countryNode=this.banknumberNode.querySelector(".select"),this.countrySelectNode=this.banknumberNode.querySelector("select.country"),this.inputBankNode=this.banknumberNode.querySelector("input.bank"),this.inputBranchkNode=this.banknumberNode.querySelector("input.branch"),this.inputAccountNode=this.banknumberNode.querySelector("input.account"),this.inputSuffixNode=this.banknumberNode.querySelector("input.suffix"),this.suffixNode=this.banknumberNode.querySelector(".suffix-span"),this.NamesBoxNode=this.banknumberNode.querySelector(".names"),this.bankNameNode=this.NamesBoxNode.querySelector(".bankname"),this.branchNameNode=this.NamesBoxNode.querySelector(".branchname"),this.iconNode=this.banknumberNode.querySelector(".tickcross"),this.initInputNode.widgets||(this.initInputNode.widgets={}),this.initInputNode.widgets.BankNumber=this;var t=!0;this.initInputNode.dataset.country&&(this.CountryCodes.contains(this.initInputNode.dataset.country.toUpperCase())&&(this.countryNode.value=this.initInputNode.dataset.country.toUpperCase()),this.initInputNode.dataset.country=null),this.initInputNode.dataset.countryStatus&&("hide"===this.initInputNode.dataset.countryStatus.trim().toLowerCase()&&(t=!1),this.initInputNode.dataset.countryStatus=null),t&&(this.countryNode.classList.remove("hidden"),this.countryNode.addEventListener("change",this._setupCountry),this._setupCountry()),this.banknumberNode.querySelectorAll('input[type="text"]').forEach(function(e){e.addEventListener("keydown",this._userKey),e.addEventListener("keyup",this._userKeyUp),e.addEventListener("blur",this._userValidate)}.bind(this)),this.initInputNode.parentNode.insertBefore(this.banknumberNode,this.initInputNode.nextSibling),Affinity2018.Apps.Plugins.hasOwnProperty("Numbers")&&Affinity2018.Apps.Plugins.Numbers.Apply(),""!==this.initInputNode.value.trim()?this.Set(this.initInputNode.value.trim()):this._validate()}else console.error("No valid element was passed to BankNumberWidget, dummy!")}Get(){return this.initInputNode.value=this._stringFromNodes(),this.initInputNode.value}GetData(){return[this.Get(),this.countrySelectNode.value]}Set(e){var t=this.DefaultCountryCode;if($a.isArray(e)&&2===e.length&&(e=e[1]+","+e[0]),$a.isString(e)||(e=e.toString().trim()),"null"===e.toLowerCase()&&(e=""),""===e.trim())return this.inputBankNode.value="",this.inputBranchkNode.value="",this.inputAccountNode.value="",this.inputSuffixNode.value="",void this._validate();e.contains(",")&&(t=e.split(",")[0],e=e.split(",")[1]),this.initInputNode.value=e,this.SetCountry(t),this._stringToNodes()}SetCountry(e){this.CountryCodes.contains(e)&&(this.countrySelectNode.value=e,this._setupCountry())}_clear(){this.inputBankNode.value="",this.inputBranchkNode.value="",this.inputAccountNode.value="",this.inputSuffixNode.value="",this.bankNameNode.innerHTML="",this.branchNameNode.innerHTML="",this.bankNameNode.classList.add("hidden"),this.branchNameNode.classList.add("hidden"),this._setIcon()}_stringToNodes(e){var t,i;1===(e=(e="string"==typeof e?e:this.initInputNode.value).replace(/\s/g,"")).countString(",")&&(2===(t=e.split(","))[1].length&&isNaN(parseFloat(t[1]))&&(this.countrySelectNode.value=t[1]),e=t[0]),i=e.split("-");var s=this._getCountryCode();3===i.length&&(s="AU"),4===i.length&&(s="NZ"),this.SetCountry(s),"AU"===s?(3===i.length?(this._clear(),this.inputBankNode.value=i[0],this.inputBranchkNode.value=i[1],this.inputAccountNode.value=i[2]):4===i.length&&(this._clear(),this.inputBankNode.value=i[0],this.inputBranchkNode.value=i[1],this.inputAccountNode.value=i[2]+i[3]),this._userValidate()):(4===i.length&&(this._clear(),this.inputBankNode.value=i[0].length>2?i[0].substring(0,2):i[0],this.inputBranchkNode.value=i[1],this.inputAccountNode.value=i[2],this.inputSuffixNode.value=i[3],i[2].length>7&&(this.inputAccountNode.value=i[2].substring(0,7),this.inputSuffixNode.value=i[2].substring(7,i[2].length))),this._userValidate())}_stringFromNodes(){var e=this.inputBankNode.value+"-"+this.inputBranchkNode.value+"-"+this.inputAccountNode.value+"-"+this.inputSuffixNode.value;return"-"===(e=(e=e.replace(/\s/g,"")).replace(/\-\-/g,"-"))[e.length-1]&&(e=e.substring(0,e.length-1)),"-"===e[0]&&(e=e.substring(1)),e}_getCountryCode(){try{return"-1"!==this.countrySelectNode.selectedIndex?this.countrySelectNode.options[this.countrySelectNode.selectedIndex].value:this.countrySelectNode.value}catch(e){}return"AU"}_setupCountry(){this._clear(),"AU"===this._getCountryCode()?(this.suffixNode.classList.add("hidden"),this.inputSuffixNode.classList.add("hidden"),this.inputBankNode.setAttribute("maxLength",3),this.inputBranchkNode.setAttribute("maxLength",4),this.inputAccountNode.setAttribute("maxLength",10),this.banknumberNode.classList.remove("nz"),this.banknumberNode.classList.add("au")):(this.suffixNode.classList.remove("hidden"),this.inputSuffixNode.classList.remove("hidden"),this.inputBankNode.setAttribute("maxLength",2),this.inputBranchkNode.setAttribute("maxLength",4),this.inputAccountNode.setAttribute("maxLength",7),this.banknumberNode.classList.remove("au"),this.banknumberNode.classList.add("nz"))}_setIcon(e){var t="reset";switch("boolean"==typeof e&&!0===e&&(t="valid"),"boolean"==typeof e&&!1===e&&(t="invalid"),this.iconNode.classList.remove("green","icon-tick","red","icon-cross","grey","icon-blocked"),t){case"valid":this.iconNode.classList.add("green","icon-tick");break;case"invalid":this.iconNode.classList.add("red","icon-cross");break;default:this.iconNode.classList.add("grey","icon-blocked")}}_userKey(e){e.target===this.inputBankNode&&e.ctrlKey&&86===e.keyCode&&(this.bankLimit=parseInt(this.inputBankNode.getAttribute("maxLength")),this.inputBankNode.widgets&&this.inputBankNode.widgets.Number&&this.inputBankNode.widgets.Number.disable(),this.inputBankNode.setAttribute("maxLength",22),this.pasting=!0)}_userKeyUp(e){if(this.pasting&&e&&e.target===this.inputBankNode){var t=this.inputBankNode.value.trim(),i=t.replace(/[^0-9]/gi,"").trim();this.inputBankNode.setAttribute("maxLength",this.bankLimit),this.inputBankNode.value=i.substring(0,this.bankLimit),this.inputBankNode.widgets&&this.inputBankNode.widgets.Number&&this.inputBankNode.widgets.Number.enable(),i.length>12&&this._stringToNodes(t),this.initInputNode.value=this._stringFromNodes()}this.pasting||e.shiftKey||"Tab"===e.key||"Shift"===e.key||(e.target===this.inputBankNode&&this.inputBankNode.value.trim().length===parseInt(this.inputBankNode.getAttribute("maxLength"))&&this.inputBranchkNode.focus(),e.target===this.inputBranchkNode&&this.inputBranchkNode.value.trim().length===parseInt(this.inputBranchkNode.getAttribute("maxLength"))&&this.inputAccountNode.focus(),e.target===this.inputAccountNode&&this.inputAccountNode.value.trim().length===parseInt(this.inputAccountNode.getAttribute("maxLength"))&&this.inputSuffixNode.focus()),this.pasting=!1,this.initInputNode.value=this._stringFromNodes(),this._userValidate()}_userValidate(){clearTimeout(this._userValidateDelay),this._userValidateDelay=setTimeout(this._validate,500)}_validate(){this.Valid=!1;var e=null,t=null;if(window.hasOwnProperty("Affinity2018")&&Affinity2018.isPropObject(Affinity2018,"UserProfile")&&Affinity2018.isPropString(Affinity2018.UserProfile,"EmployeeNumber")&&""!==Affinity2018.UserProfile.EmployeeNumber.trim()&&Affinity2018.isPropObject(Affinity2018,"ApiEndpoints")&&Affinity2018.isPropString(Affinity2018.ApiEndpoints,"BankValidationApi")&&""!==Affinity2018.ApiEndpoints.BankValidationApi.trim()){e=Affinity2018.ApiEndpoints.BankValidationApi+"",t=Affinity2018.UserProfile.EmployeeNumber+"";var i=new FormData;i.append("EmployeeNo",t),i.append("BankNumber",this._stringFromNodes()),i.append("CountryCode",this._getCountryCode()),this.iconNode.classList.add("validating"),this.validationLookup&&this.validationLookup.hasOwnProperty("cancelToken")&&this.validationLookup.cancelToken.source.cancel(!0),this.validationLookup=axios({method:"POST",url:e,data:i,cancelToken:new axios.CancelToken((function(){}))}).then(function(e){"object"==typeof e&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("success")&&"boolean"==typeof e.data.success&&(this.Valid=e.data.success,this._validated(e.data)),this.iconNode.classList.remove("validating")}.bind(this)).catch(function(e){this.Valid=!1,this._validated(),this.iconNode.classList.remove("validating")}.bind(this))}}_validated(e){this._setIcon(this.Valid),"object"==typeof e&&e.hasOwnProperty("bankName")&&e.hasOwnProperty("branchName")&&(this.bankNameNode.innerHTML="failed"!==e.bankName?e.bankName:"",this.branchNameNode.innerHTML="failed"!==e.branchName&&e.branchName!==e.bankName?e.branchName:"",""==this.bankNameNode.innerText.trim()?this.bankNameNode.classList.add("hidden"):this.bankNameNode.classList.remove("hidden"),""==this.branchNameNode.innerText.trim()?this.branchNameNode.classList.add("hidden"):this.branchNameNode.classList.remove("hidden"))}Destroy(){for(var e in clearTimeout(this._userValidateDelay),this.initInputNode.hasOwnProperty("widgets")&&this.initInputNode.widgets.hasOwnProperty("String")&&this.initInputNode.widgets.String.Destroy(),this.initInputNode.hasOwnProperty("widgets")&&this.initInputNode.widgets.hasOwnProperty("Number")&&this.initInputNode.widgets.Number.Destroy(),this.countryNode.removeEventListener("change",this._setupCountry),this.banknumberNode.querySelectorAll('input[type="text"]').forEach(function(e){e.removeEventListener("keydown",this._userKey),e.removeEventListener("keyup",this._userKeyUp),e.removeEventListener("blur",this._userValidate),e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("String")&&e.widgets.String.Destroy(),e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("Number")&&e.widgets.Number.Destroy()}.bind(this)),this.initInputNode.classList.remove("ui-banknumber"),this.initInputNode.type="text",this.banknumberNode.innerHTML="",this.banknumberNode.parentNode.removeChild(this.banknumberNode),delete this.initInputNode.widgets.BankNumber,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.template='\n    <div class="select hidden">\n      <select class="country">\n        <option value="AU" selected>AU</option>\n        <option value="NZ">NZ</option>\n      </select>\n    </div>\n    <input class="bank ui-has-integer" type="text" maxlength="2">\n    <span>-</span>\n    <input class="branch ui-has-integer" type="text" maxlength="4">\n    <span>-</span>\n    <input class="account ui-has-integer" type="text" maxlength="7">\n    <span class="suffix-span">-</span>\n    <input class="suffix ui-has-integer" type="text" maxlength="3">\n    <span class="tickcross grey icon-blocked"></span>\n    <div class="names">\n      <div class="bankname hidden"></div>\n      <div class="branchname hidden"></div>\n    </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.BigSearch=class{_options(){this.WidgetName="BigSearch",this.resultPageSize=10,this.useQueue=!0,this.api=!1,this.resultCallback=function(){},this.request=!1,this.maxPageSize=9999999,this.defaultParams={userInput:"q",pageSize:"size",pageNumber:"page",grandTotal:"total",type:"type",results:"results",customInputs:[]}}constructor(e,t){this._options(),["SetApi","SetResultCallback","SetParams","Insert","AddFilter","Reset","Clear","ProcessResults","InsertResult","_delayReset","_keySearch","_doLookup","_gotResults","_pagination","_paginationClicked","_showAll","_resultsClicked","_canceled","_requestCanceled","_filterLookupComplete","_reset","_clear"].bindEach(this),this._templates(),this.useQueue&&!Affinity2018.hasOwnProperty("RequestQueue")&&(Affinity2018.RequestQueue=new Affinity2018.Classes.Plugins.RequestQueue),this.api=!!Affinity2018.isUrl(e)&&e,this.resultCallback="function"==typeof t&&t,this.params=Affinity2018.jsonCloneObject(this.defaultParams),this.templateNode=document.createElement("div"),this.templateNode.classList.add("affinity2018","search-form-container"),this.templateNode.innerHTML=this.template,this.checkFilterBoxNode=this.templateNode.querySelector(".search-form-check-filters"),this.selectFilterBoxNode=this.templateNode.querySelector(".search-form-select-filters"),this.InputNode=this.templateNode.querySelector(".search-form-input input"),this.InputNode.hasOwnProperty("widgets")||(this.InputNode.widgets={}),this.InputNode.widgets.BigSearch=this,this.InputNode=this.templateNode.querySelector("input"),this.InputNode.classList.add("ui-bigsearch"),this.InputNode.addEventListener("keyup",this._keySearch),this.resultsInfoNode=this.templateNode.querySelector(".result-info"),this.showingNode=this.resultsInfoNode.querySelector(".search-showing"),this.showAllNode=this.resultsInfoNode.querySelector(".search-show-all"),this.searchResultsNode=this.templateNode.querySelector(".search-results"),this.paginationNode=this.templateNode.querySelector(".pagination"),this.paginationBackNode=this.paginationNode.querySelector(".back"),this.paginationForwardNode=this.paginationNode.querySelector(".forward"),this.loader=this.templateNode.querySelector(".search-loader"),this.searchResultsNode.addEventListener("click",this._resultsClicked),this.paginationNode.addEventListener("click",this._paginationClicked),this.showAllNode.addEventListener("click",this._showAll)}SetApi(e){this.api=Affinity2018.isUrl(e)?e:this.api,this._delayReset()}SetResultCallback(e){this.resultCallback="function"==typeof e?e:this.resultCallback,this._delayReset()}SetParams(e){var t,i;for(t in this.params={},this.defaultParams)if(this.defaultParams.hasOwnProperty(t))if(e.hasOwnProperty(t))if("customInputs"===t){if(this.params[t]=[],Array.isArray(e[t]))for(i=0;i<e[t].length;i++)this.params[t][i]=e[t][i]}else this.params[t]=e[t];else this.params[t]=this.defaultParams[t];this._delayReset()}Insert(e,t,i,s){if(!Affinity2018.isDomElement(e))return console.error("BigSearch Insert method first parameter must be a DOM element"),!1;e.appendChild(this.templateNode),"string"==typeof t&&(this.InputNode.placeholder=t),Array.isArray(i)&&i.forEach(this.AddFilter,"check"),Array.isArray(s)&&s.forEach(this.AddFilter,"select"),this.templateNode.classList.remove("fixed-height"),Affinity2018.Browser.isie&&Affinity2018.Browser.version<12?this.templateNode.style.height="":this.templateNode.style.height=null,e.classList.contains("fixed-height")&&this.templateNode.classList.add("fixed-height"),e.dataset.fixedHeight&&!isNaN(parseInt(e.dataset.fixedHeight))&&(this.templateNode.classList.add("fixed-height"),this.templateNode.style.height=parseInt(e.dataset.fixedHeight)+"px"),this._delayReset()}AddFilter(e,t){if(t=t||"select",Affinity2018.isPropString(e,"key")&&Affinity2018.isPropString(e,"label")){var i=document.createElement("div");i.classList.add("affinity2018","search-form-container","filter-"+e.key),"select"===t&&(i.innerHTML=this.selectFilterTemplate,i.querySelector("select").name=e.key,i.querySelector("label").innerHTML=e.label),this.filterBoxNode.appendChild(i),Affinity2018.isPropString(e,"api")&&Affinity2018.RequestQueue.Add(e.api,function(i){this._filterLookupComplete(e.key,i,t)}.bind(this)),Affinity2018.isPropArray(e,"data")&&this._filterLookupComplete(e.key,data,t)}}Search(e){this.InputNode.value=e,this._doLookup()}Reset(){this._reset()}Clear(){this._clear()}ProcessResults(e){if(this._clear(),this.params.results in e&&Affinity2018.isPropArray(e,this.params.results)){var t="",i=0,s=!1,o=!1,a=!1;if(!e||isNaN(parseInt(e[this.params.pageSize]))||isNaN(parseInt(e[this.params.pageNumber]))||isNaN(parseInt(e[this.params.grandTotal]))||(a={query:e[this.params.userInput],size:e[this.params.pageSize],page:e[this.params.pageNumber],total:e[this.params.grandTotal],type:e[this.params.type],results:e[this.params.results]}),a){for(s="string"!=typeof a.query||""===a.query.trim(),o=a.size===this.maxPageSize,a.results.length>0&&!o?this.showAllNode.classList.remove("hidden"):this.showAllNode.classList.add("hidden"),null==a.query&&this.showAllNode.classList.add("hidden"),this.resultsInfoNode.classList.remove("hidden"),t="",t+="Showing ",t+=(!s||o?a.results.length:"0")+" results from ",t+=a.total+" ",t+=this._plural(a.type,a.results.length),s||(t+=' matching "'+a.query+'"'),this.showingNode.innerHTML=t,!s&&null!==a.query||o||(e[this.params.grandTotal]=0,a.results=[]),this.ResultIndex=[];i<a.results.length;)this.InsertResult(a.results[i]),i++;this._pagination(e),this.searchResultsNode.classList.remove("hide"),a=null}else this.searchResultsNode.classList.add("hide")}else this.searchResultsNode.classList.add("hide")}InsertResult(e){var t=document.createElement("div");return t.innerHTML=this.resultTemplate,t.querySelector(".label").innerHTML="",t.querySelector(".info").innerHTML="",t.querySelector(".desc").innerHTML="",Affinity2018.isPropString(e,"Label")&&(t.querySelector(".label").innerHTML=e.Label),Affinity2018.isPropString(e,"Info")&&(t.querySelector(".info").innerHTML=e.Info),Affinity2018.isPropString(e,"Description")&&(t.querySelector(".desc").innerHTML=e.Description),t.querySelector("div").dataset.index=this.ResultIndex.length,this.ResultIndex.push(e),this.searchResultsNode.appendChild(t.querySelector("div")),!0}_reset(){this.InputNode.value="",this._clear(),this._delayReset()}_clear(){this.resultsInfoNode.classList.add("hidden"),this.showingNode.innerHTML="",this.searchResultsNode.innerHTML="",this.searchResultsNode.scrollTo(0,0),this.paginationNode.classList.add("hidden"),this.paginationNode.querySelectorAll("a.page, a.current").forEach(function(e){this.paginationNode.removeChild(e)}.bind(this))}_filterLookupComplete(e,t,i){var s,o,a=this.filterBoxNode.querySelector(".filter-"+e),n=0;if("object"==typeof t&&Array.isArray(t)&&t.length>0){switch(i){case"check":s=this.filterBoxNode;break;case"select":s=a.querySelector("select")}for(;n<t.length;){if(Affinity2018.isPropString(t[n],"key")&&Affinity2018.isPropString(t[n],"value"))switch(i){case"check":(o=document.createElement("div")).innerHTML=this.checkFilterTemplate,o.querySelector("label").innerHTML=t[n].value,o.querySelector("value").innerHTML=t[n].key,s.appendChild(o.querySelector("div"));break;case"select":(o=document.createElement("option")).innerHTML=t[n].value,o.value=t[n].key,s.appendChild(o.querySelector("div"))}n++}}}_keySearch(e){clearTimeout(this._lookupDelay),this._lookupDelay=setTimeout(this._doLookup,500),this.loader.classList.add("show")}_delayReset(){clearTimeout(this._lookupDelay),this._lookupDelay=setTimeout(this._doLookup,500,1,0,""),this.loader.classList.add("show")}_doLookup(e,t,i){if(!this.api)return!1;clearTimeout(this._lookupDelay),e="number"==typeof e?e:1,t="number"==typeof t?t:this.resultPageSize,i="string"==typeof i&&i.trim(),i=encodeURIComponent(i?i.trim():this.InputNode.value.trim());var s,o=this.api.indexOf("?")>1?this.api+"&":this.api+"?",a=0;for(o+=this.params.pageSize+"="+t,o+="&"+this.params.pageNumber+"="+e,o+="&"+this.params.userInput+"="+i;a<this.params.customInputs.length;a++)s=this.params.customInputs[a],this.templateNode.querySelector("."+s.inputParam)&&""!==this.templateNode.querySelector("."+s.inputParam).value.trim()&&(o+="&"+s.inputParam+"="+this.templateNode.querySelector("."+s.inputParam).value.trim());this.request&&this.request.hasOwnProperty("cancelToken")?this.request.cancelToken.source.cancel(!0):this.request=axios({method:"get",url:o,cancelToken:new axios.CancelToken(this._requestCanceled)}).then(this._gotResults).catch(function(e){this.loader.classList.remove("show"),console.error(e)}.bind(this))}_gotResults(e){e&&("status"in e&&200===e.status&&Affinity2018.isPropObject(e,"data")&&this.ProcessResults(e.data),"Results"in e&&Affinity2018.isPropArray(e,"Results")&&this.ProcessResults(e)),this.loader.classList.remove("show")}_gotResultsError(e){console.error(e),this.loader.classList.remove("show")}_resultsClicked(e){var t=e.target.classList.contains("search-result")?e.target:e.target.closest(".search-result");Affinity2018.isDomElement(t)&&t.dataset.index&&!isNaN(parseInt(t.dataset.index))&&this.ResultIndex[parseInt(t.dataset.index)]&&this.ResultIndex[parseInt(t.dataset.index)].hasOwnProperty("Data")&&"function"==typeof this.resultCallback&&this.resultCallback({target:t,event:e,data:this.ResultIndex[parseInt(t.dataset.index)].Data})}_showAll(){clearTimeout(this._lookupDelay),this.loader.classList.add("show"),this._doLookup(1,this.maxPageSize)}_pagination(e){this.paginationNode.classList.add("hidden"),this.paginationNode.querySelectorAll("a.page, a.current").forEach(function(e){this.paginationNode.removeChild(e)}.bind(this));var t=!1;if(e&&Affinity2018.isPropInt(e,this.params.pageSize)&&Affinity2018.isPropInt(e,this.params.pageNumber)&&Affinity2018.isPropInt(e,this.params.grandTotal)&&(t={size:e[this.params.pageSize],page:e[this.params.pageNumber],total:e[this.params.grandTotal],results:e[this.params.results]}),t){if(t.total>t.results.length){var i,s,o=Math.ceil(t.total/t.size),a=0;if(o>1){for(;a<o;)i=a+1===t.page?"current":"page",(s=document.createElement("a")).classList.add(i,"page"+(a+1)),s.dataset.page=a,s.innerHTML=a+1,this.paginationNode.insertBefore(s,this.paginationForwardNode),a++;this.paginationForwardNode.classList.remove("disabled"),1===t.page&&this.paginationBackNode.classList.add("disabled"),t.page>1&&this.paginationBackNode.classList.remove("disabled"),t.page>=o&&this.paginationForwardNode.classList.add("disabled"),this.paginationNode.dataset.pages=o,this.paginationNode.classList.remove("hidden")}}t=null}}_paginationClicked(e){var t="a"===e.target.tagName.toLowerCase()?e.target:e.target.closest("a");if(!t.classList.contains("disabled")){var i,s=parseInt(this.paginationNode.dataset.pages),o=parseInt(this.paginationNode.querySelector(".current").dataset.page)+1;t.classList.contains("back")?(i=(i=o-1)<1?1:i,this._doLookup(i,this.resultPageSize)):t.classList.contains("forward")?(i=(i=o+1)>s?s:i,this._doLookup(i,this.resultPageSize)):(i=parseInt(t.dataset.page)+1,this._doLookup(i,this.resultPageSize)),this.searchResultsNode.scrollTo(0,0)}}_requestCanceled(e){this.request=!1,(e="boolean"==typeof e&&e)&&this._doLookup(1,0,"")}_plural(e,t){return e+(1!==t?"s":"")}Destroy(){for(var e in this.InputNode.classList.remove("ui-bigsearch"),this.InputNode.removeEventListener("keyup",this._keySearch),this.searchResultsNode.removeEventListener("click",this._resultsClicked),this.paginationNode.removeEventListener("click",this._paginationClicked),this.showAllNode.removeEventListener("click",this._showAll),this.templateNode.innerHTML="",this.resultCallback=null,delete this.lookupNode.widgets.BifSearch,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.template='\n    <div class="search-form">\n      <div class="search-form-input">\n        <input type="text" placeholder="Search" />\n      </div>\n      <div class="search-form-check-filters"></div>\n      <div class="search-form-select-filters"></div>\n      <div class="result-info hidden">\n        <div class="search-showing"></div>\n        <div class="search-show-all">Show all results</div>\n      </div>\n    </div>\n    <div class="search-results hide">\n    </div>\n    <div class="search-loader">\n      <svg class="search-spinner" width="65px" height="65px" viewBox="0 0 66 66" xmlns="http://www.w3.org/2000/svg">\n        <circle class="search-circle" fill="none" stroke-width="6" stroke-linecap="round" cx="33" cy="33" r="30"></circle>\n      </svg>\n    </div>\n    <div class="pagination hidden">\n      <a class="back icon-arrow-line-small-left disabled"></a>\n      <a class="forward icon-arrow-line-small-right disabled"></a>\n    </div>\n    ',this.checkFilterTemplate='\n      <div class="filter-check">\n        <label></label>\n        <input type="checkbox" />\n      </div>\n    ',this.selectFilterTemplate='\n      <div class="filter-box">\n        <label></label>\n        <select></select>\n      </div>\n    ',this.resultTemplate='\n      <div class="search-result">\n        <div class="label"></div>\n        <div class="info"></div>\n        <div class="desc"></div>\n      </div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.Calendars=class{_options(){this.widgets=[]}constructor(){this._options(),["Apply","Remove","HideAll","_apply"].bindEach(this),this.Ready=!0}Apply(e){var t=[];return null!=e?t=[this._apply(e)]:document.querySelectorAll(".ui-has-calendar").forEach(function(e){t.push(this._apply(e))}.bind(this)),{total:t.length,widgets:t}}Remove(e){e.classList.contains("ui-calendar")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("DateTime")&&(delete this.widgets[e.widgets.DateTime.uuid],e.widgets.DateTime.Destroy())}HideAll(e){var t,i;for(t in this.widgets)this.widgets.hasOwnProperty(t)&&(i=this.widgets[t],"object"==typeof e&&e.hasOwnProperty("uuid")?i.uuid!==e.uuid&&i.hide():i.hide())}_apply(e){if(Affinity2018.isDomElement(e)){var t=Affinity2018.uuid();return this.widgets[t]=new Affinity2018.Classes.Plugins.CalendarWidget(e,t),this.widgets[t]}}},Affinity2018.Classes.Plugins.CalendarWidget=class extends Affinity2018.ClassEvents{_options(){this.WidgetName="Calendar",this.Ready=!1,this.uuid="",this.targetNode=null,this.preserveOriginalInput=!1,this.outputFormat="dd/MM/yyyy",this.dateFormat="ddd dS MMM, yyyy",this.timeFormat="h:mm tt",this.displayFormat=this.dateFormat+" "+this.timeFormat,this.showCalendar=!0,this.showTime=!1,this.startDate="none",this.hasStartDate=!1,this.showStartDate=!1,this.startDay=0,this.status="closed",this.mouseState="",this.labelName="",this.postId="",this.postName="",this.validationMethods="",this.validationErrorStr="",this.cssPosition="absolute",this.watchOutput=!1,this.nullable=!1,this.hoursmins=!1,this.showInline=!1,this.showRange=!1,this.enableAutoClose=!1,this.showCalendarFilterButtonsForMobile=!1,this.row=null,this.date=!1,this.__uiDate=!1}constructor(e,t){if(super(),this._options(),["_init","getValue","getDisplayValue","setTime","setDate","setToday","setNone","setTimeFromWidget","watchOutputChanges","show","hide","_buildCalendar","_cellClicked","_displayKeyUp","_displayBlur","_setDate","_setTime","_setDisplay","_setReturn","_setDateFromStr","_monthBackClicked","_monthForwardClicked","_monthClicked","_yearClicked","_monthsClicked","_yearsClicked","_timeClicked","_clearShowHideEvents","_setHideShowEvents","_scrolled","_position","_setPosition","_stopEvents","_windowClicked","Destroy","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){this.uuid=t||Affinity2018.uuid(),Affinity2018.Calendars&&!Affinity2018.Calendars.widgets.hasOwnProperty(this.uuid)&&(Affinity2018.Calendars.widgets[this.uuid]=this),this.targetNode=e,this.targetNode.classList.remove("ui-has-calendar"),this.targetNode.classList.add("ui-calendar"),this.targetNode.classList.add("hidden"),this.targetNode.hasOwnProperty("widgets")||(this.targetNode.widgets={}),this.targetNode.widgets.DateTime=this,this.displayNode=document.createElement("input"),this.displayNode.type="text",this.targetNode.parentNode.insertBefore(this.displayNode,this.targetNode.nextSibling),this.calendarNode=document.createElement("div"),this.calendarNode.classList.add("ui-calendar-container"),this.calendarNode.innerHTML=this.calendarTemplate,this.displayNode.parentNode.insertBefore(this.calendarNode,this.displayNode.nextSibling),this.datesNode=this.calendarNode.querySelector(".ui-cal-dates"),this.monthNode=this.datesNode.querySelector(".ui-cal-months"),this.yearNode=this.datesNode.querySelector(".ui-cal-years"),this.timeNode=this.calendarNode.querySelector(".ui-cal-time"),this.dateDisplayNode=this.calendarNode.querySelector(".ui-cal-display-date"),this.timeDisplayNode=this.calendarNode.querySelector(".ui-cal-display-time");for(var i,s,o,a,n=this.datesNode.querySelector(".ui-cal-cells-row"),r=this.calendarNode.querySelector(".ui-cal-months"),l=this.calendarNode.querySelector(".ui-cal-years"),d=0,h=0,c=(new Date).getFullYear()-100;d<6;d++)(i=document.createElement("div")).classList.add("ui-cal-cells-row","date-cells"),i.innerHTML=n.innerHTML+"",n.parentNode.appendChild(i);for(;h<12;h++)(s=new Date).setMonth(h),(o=document.createElement("span")).innerHTML=s.toString("MMMM"),o.dataset.value=h,o.classList.add("m-"+h),r.appendChild(o);for(;c<(new Date).getFullYear()+51;c++)(a=document.createElement("span")).innerHTML=c,a.dataset.value=c,a.classList.add("y-"+c),l.appendChild(a);this.calendarNode.querySelector(".ui-cal-cells").dataset.month="",this.calendarNode.querySelector(".ui-cal-cells").dataset.year="",this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("form-row")&&this.targetNode.parentNode.classList.add("calendar");var u=this.targetNode.hasOwnProperty("data-start-date")?this.targetNode.dataset.startDate.trim():"";switch(""!==u&&(2===u.countString("/")||2===u.countString("\\")||2===u.countString("-")||2===u.countString(".")?(this.startDate=this._processStandardDateStr(u),null===this.startDate&&(this.startDate=Date.parse(u))):this.startDate=!!Date.parse(u).isValid()&&Date.parse(u),this.startDate&&Affinity2018.isDate(this.startDate)&&this.startDate.isValid()?(this.hasStartDate=!0,this.showStartDate=!0):(this.startDate="none",this.hasStartDate=!1,this.showStartDate=!1)),this.postName=this.targetNode.name||"",this.postId=this.targetNode.id||"",this.hasStartDate=!!this.targetNode.dataset.startDate&&!!Date.parse(this.targetNode.dataset.startDate).isValid(),this.showStartDate=!!this.hasStartDate,this.startDate=this.hasStartDate?Affinity2018.stringToDate(this.targetNode.dataset.startDate,"none"):"none",this.validationMethods=this.targetNode.dataset.validateMethod||"",this.validationErrorStr=this.targetNode.dataset.validateErrorStr||"",this.showInline=!!this.targetNode.classList.contains("show-inline"),this.showInline=!(!this.targetNode.dataset.inline||"true"!==this.targetNode.dataset.inline.trim().toLowerCase()),this.displayFormat=this.targetNode.dataset.calendarDisplayFormat?this.targetNode.dataset.calendarDisplayFormat:this.displayFormat,this.outputFormat=this.targetNode.dataset.calendarReturnFormat?this.targetNode.dataset.calendarReturnFormat:this.outputFormat,this.nullable=!(!this.targetNode.dataset.calendarNullable||"true"!==this.targetNode.dataset.calendarNullable.trim().toLowerCase()),this.hoursmins=!(!this.targetNode.dataset.calendarHoursmins||"true"!==this.targetNode.dataset.calendarHoursmins.trim().toLowerCase()),this.preserveOriginalInput=!!this.targetNode.classList.contains("preserveOriginalInput"),this.showCalendarFilterButtonsForMobile=!!this.targetNode.hasAttribute("showCalendarFilterButtonsForMobile"),this.showInline&&(this.calendarNode.classList.remove("hidden"),this.calendarNode.classList.add("inline","show")),Affinity2018.isString(this.targetNode.dataset.startDate)&&""!==this.targetNode.dataset.startDate&&"false"!==this.targetNode.dataset.startDate.toLowerCase()&&(this.showStartDate=!0),Affinity2018.isBool(this.targetNode.dataset.startDate)&&!0===this.targetNode.dataset.startDate&&(this.showStartDate=!0),this.targetNode.dataset.type){case"date":this.showCalendar=!0,this.showTime=!1,this.datesNode.classList.remove("hidden"),this.dateDisplayNode.classList.remove("hidden"),this.enableAutoClose=!0;break;case"time":this.showCalendar=!1,this.showTime=!0,this.timeNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;case"datetime":this.showCalendar=!0,this.showTime=!0,this.datesNode.classList.remove("hidden"),this.timeNode.classList.remove("hidden"),this.dateDisplayNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;case"hoursmins":this.showCalendar=!0,this.showTime=!0,this.hoursmins=!0,this.timeNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;case"date-range":this.showCalendar=!0,this.showTime=!1,this.showRange=!0,this.datesNode.classList.remove("hidden"),this.dateDisplayNode.classList.remove("hidden");break;case"time-range":this.showCalendar=!1,this.showTime=!0,this.showRange=!0,this.timeNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;case"datetime-range":this.showCalendar=!0,this.showTime=!0,this.showRange=!0,this.datesNode.classList.remove("hidden"),this.timeNode.classList.remove("hidden"),this.dateDisplayNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;case"hoursmins-range":this.showCalendar=!0,this.showTime=!0,this.hoursmins=!0,this.showRange=!0,this.timeNode.classList.remove("hidden"),this.timeDisplayNode.classList.remove("hidden");break;default:this.showCalendar=!0,this.showTime=!1,this.datesNode.classList.remove("hidden")}this.hoursmins&&!this.targetNode.dataset.startDate&&(this.startDate.setMinutes(0),this.startDate.setHours(0),this.startDate.setSeconds(0),this.startDate.setMilliseconds(0)),this._init()}else console.error("No valid element was passed to CalendarWidget, dummy!")}_init(){if(this.showDefault="none"!==this.startDate,"none"===this.startDate)if(this.target&&"value"in this.targetNode&&""!==this.targetNode.value.trim()){var e=this._setDateFromStr(this.targetNode.value.trim(),!0);$a.isDate(e)&&e.isValid()?(this.startDate=e.toString(this.outputFormat),this.date=e,this.showDefault=!0):this.showDefault=!1}else this.showDefault=!1;else this.startDate&&["now","today"].contains(this.startDate.toLowerCase)?(this.date=new Date,this.startDate=this.date.toString(this.outputFormat)):$a.isString(this.startDate)&&(e=this._setDateFromStr(this.startDate.trim(),!0),$a.isDate(e)&&e.isValid()&&(this.startDate=e.toString(this.outputFormat),this.date=e));$a.isDateValid(this.date)||($a.isDateValid(this.startDate)?this.date=this.startDate:this.date=new Date),this.watchOutput=!!this.targetNode.classList.contains("uidate-watch")||this.watchOutput,this.watchOutput&&(this.watchTimer=setInterval(this.watchOutputChanges,500)),this.date?this.__uiDate=this.date:this.__uiDate=new Date,this._setDate(),this._setTime(),this._setDisplay(!0),this._setReturn(!0),this._buildCalendar(),this.timeWidget=!1,this.showTime&&(this.timeWidget=new Affinity2018.Classes.Plugins.TimeWidget({targetNode:this.calendarNode.querySelector(".ui-cal-time"),uuid:this.uuid,date:this.__uiDate.clone(),setCallback:this.setTimeFromWidget,hasCalendar:this.showCalendar,hideMethod:this.hide})),this.datesNode.querySelectorAll(".ui-cal-cells-row.date-cells .ui-cal-cell").forEach(function(e){e.addEventListener("click",this._cellClicked)}.bind(this)),this.calendarNode.querySelector(".ui-cal-back-month").addEventListener("click",this._monthBackClicked),this.calendarNode.querySelector(".ui-cal-forward-month").addEventListener("click",this._monthForwardClicked),this.calendarNode.querySelector(".ui-cal-current-month").addEventListener("click",this._monthClicked),this.calendarNode.querySelector(".ui-cal-current-year").addEventListener("click",this._yearClicked),this.calendarNode.querySelector(".ui-cal-months").addEventListener("click",this._monthsClicked),this.calendarNode.querySelector(".ui-cal-years").addEventListener("click",this._yearsClicked),this.displayNode.addEventListener("focus",this.show),this.displayNode.addEventListener("keyup",this._displayKeyUp),this.displayNode.addEventListener("blur",this._displayBlur),this.timeDisplayNode.addEventListener("click",this._timeClicked),Affinity2018.supportsPassiveEvents?(document.addEventListener("scroll",this._scrolled,{passive:!0}),document.addEventListener("resize",this._position,{passive:!0})):(document.addEventListener("scroll",this._scrolled,!1),document.addEventListener("resize",this._position,!1)),this.Ready=!0}getValue(){return this.date.toString(this.displayFormat)}getDisplayValue(){return this.date.toString(this.outputFormat)}getDate(){var e=this.getDateObject();return!!e&&e.toString(this.outputFormat)}getDateObject(){if(!this.nullable){if(this.date)return this.date;if(this.__uiDate)return this.__uiDate}return!1}getRawDate(){return(""!==this.displayNode.value.trim()||!this.nullable)&&(null!==$a.stringToDate(this.displayNode.value.trim())?$a.stringToDate(this.displayNode.value.trim()):Affinity2018.isDate(this.date)?this.date:null!==$a.stringToDate(this.targetNode.value.trim())&&$a.stringToDate(this.targetNode.value.trim()))}setTime(e){var t=this.date?this.date.clone():this.__uiDate.clone();t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(0),t.setMilliseconds(0),this.setDate(t)}setDate(e,t,i){t="boolean"!=typeof t||t,i="boolean"==typeof i&&i,Affinity2018.isDate(e)?this.date=e.clone():this.date=!this.nullable&&this.date,this.__uiDate=this.date?this.date:this.__uiDate,this._setAll(),this._buildCalendar(),t&&this._fireDateEvents(),this.showTime&&this.timeWidget&&!i&&(this.date?this.timeWidget.setTime(this.date):this.timeWidget.setTime(this.__uiDate))}setToday(){this.date=new Date,this.__uiDate=this.date.clone(),this._setAll(),this._buildCalendar(),this._fireDateEvents(),this.showTime&&this.timeWidget&&(this.date?this.timeWidget.setTime(this.date):this.timeWidget.setTime(this.__uiDate))}setNone(){this.date=this.__uiDate=new Date,this._setAll(),this._buildCalendar(),this.showTime&&this.timeWidget&&(this.date?this.timeWidget.setTime(this.date):this.timeWidget.setTime(this.__uiDate)),this.displayNode.value="",this.targetNode.value="",this.targetNode.dispatchEvent(new Event("change"))}setTimeFromWidget(e){var t=this.date?this.date.clone():this.__uiDate.clone();t.setHours(e.getHours()),t.setMinutes(e.getMinutes()),t.setSeconds(0),t.setMilliseconds(0),this.setDate(t,!0,!0)}watchOutputChanges(){var e=this.targetNode.value,t=Date.parse(e);Affinity2018.isDate(t)&&t!==this.date&&this.setDate(t,!1)}show(){this.showInline||(!this.showInline&&Affinity2018.Calendars&&Affinity2018.Calendars.HideAll(this),!this.showInline&&Affinity2018.Autocompletes&&Affinity2018.Autocompletes.HideAll(),this._setHideShowEvents(),this.showCalendar&&this.datesNode.classList.add("show"),!this.showCalendar&&this.showTime&&this.timeNode.classList.add("show"),this.calendarNode.classList.add("show"),this.status="open",this._setPosition("show"),Affinity2018.hasOwnProperty("ForceSectionTop")&&Affinity2018.ForceSectionTop(this.calendarNode))}hide(e){this._clearShowHideEvents(),this.showInline||(this.monthNode&&this.monthNode.classList.remove("show"),this.yearNode&&this.yearNode.classList.remove("show"),this.datesNode&&this.datesNode.classList.remove("show"),this.timeNode&&this.timeNode.classList.remove("show"),this.showTime&&this.timeWidget&&this.timeWidget.showHours(),this.calendarNode.classList.remove("show"),this.status="closed",this.mouseState="",Affinity2018.hasOwnProperty("ResetForceSectionTop")&&Affinity2018.ResetForceSectionTop(this.calendarNode))}_buildCalendar(e){if(e=Affinity2018.isDate(e)?e:Affinity2018.isDate(this.date)?this.date:this.__uiDate,this.calendarNode.querySelector(".ui-cal-cells").dataset.month+this.calendarNode.querySelector(".ui-cal-cells").dataset.year!==e.toString("MMM")+e.toString("yyyy")){var t=this.datesNode.querySelectorAll(".ui-cal-cells-row.date-cells .ui-cal-cell"),i=(Date.today().clearTime(),e.clone().moveToFirstDayOfMonth()),s=i.clone().clearTime(),o=Date.getDaysInMonth(i.getFullYear(),i.getMonth()),a=i.getDay()-this.startDay,n=0,r=1;a<0&&(a+=7);var l=this.calendarNode.querySelectorAll(".ui-cal-cells-row.date-days .ui-cal-cell"),d=["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sun","Mon","Tue","Wed","Thu","Fri","Sat"],h=new Date;for(h.setDate(h.getDate()-h.getDay()),n=0;n<7;n++)l[n].innerHTML=d[h.getDay()+this.startDay],h.setDate(h.getDate()+1);for(n=0;n<42;n++)t[n].className="ui-cal-cell",n<a||n>=a+o?(t[n].innerHTML="",delete t[n].dataset.date):(t[n].innerHTML=r,t[n].dataset.date=s.toString("d-MMM-yyyy HH:mm"),t[n].classList.add("active","date-"+s.toString("d-MMM-yyyy")),s.add({days:1}),r++);this.calendarNode.querySelector(".ui-cal-cells").dataset.month=e.toString("MMM"),this.calendarNode.querySelector(".ui-cal-cells").dataset.year=e.toString("yyyy")}this.datesNode.querySelector(".date-"+Date.today().clearTime().toString("d-MMM-yyyy"))&&this.datesNode.querySelector(".date-"+Date.today().clearTime().toString("d-MMM-yyyy")).classList.add("today"),this.date&&this.datesNode.querySelector(".date-"+this.date.toString("d-MMM-yyyy"))&&this.datesNode.querySelector(".date-"+this.date.toString("d-MMM-yyyy")).classList.add("selected"),this.date?(this.datesNode.querySelector(".ui-cal-current-month").innerHTML=this.date.toString("MMMM"),this.datesNode.querySelector(".ui-cal-current-year").innerHTML=this.date.toString("yyyy"),this.calendarNode.querySelector(".ui-cal-months span.selected")&&this.calendarNode.querySelector(".ui-cal-months span.selected").classList.remove("selected"),this.calendarNode.querySelector(".ui-cal-years span.selected")&&this.calendarNode.querySelector(".ui-cal-years span.selected").classList.remove("selected"),this.calendarNode.querySelector(".ui-cal-months .m-"+this.date.getMonth()).classList.add("selected"),this.calendarNode.querySelector(".ui-cal-years .y-"+this.date.getFullYear()).classList.add("selected")):(this.datesNode.querySelector(".ui-cal-current-month").innerHTML="",this.datesNode.querySelector(".ui-cal-current-year").innerHTML="")}_cellClicked(e){this.datesNode.querySelector(".ui-cal-cell.selected")&&this.datesNode.querySelector(".ui-cal-cell.selected").classList.remove("selected");var t,i=e.target.closest(".ui-cal-cell.active");i&&(t=Date.parse(i.dataset.date),i.classList.add("selected"),this.setDate(t),this.enableAutoClose&&this.hide())}_displayKeyUp(e){if(13===e.keyCode||9===e.keyCode||40===e.keyCode){if(this.nullable&&""===this.displayNode.value.trim())return;this._setDateFromStr(this.displayNode.value.trim())}}_displayBlur(){this.nullable&&""===this.displayNode.value.trim()||this._setDateFromStr(this.displayNode.value.trim())}_setAll(){this._setDate(),this._setTime(),this._setDisplay(),this._setReturn()}_setDate(){var e="";this.date&&Affinity2018.isDate(this.date)&&(e=this.date.toString(this.dateFormat)),this.dateDisplayNode.innerHTML=e,this._setDisplay(!1)}_setTime(){var e="";this.date&&Affinity2018.isDate(this.date)&&(e=this.date.toString(this.timeFormat)),this.timeDisplayNode.innerHTML=e,this._setDisplay(!1)}_setDisplay(e){var t="",i=!e||!this.nullable;e=!!Affinity2018.isBool(e)&&e,this.date&&Affinity2018.isDate(this.date)&&(this.showCalendar&&(t+=this.date.toString(this.dateFormat)),this.showCalendar&&this.showTime&&(t+=" "),this.showTime&&(t+=this.date.toString(this.timeFormat))),this.Ready?i&&(e&&!this.nullable&&(this.displayNode.value=t),e||(this.displayNode.value=t)):(this.showStartDate||this.showDefault)&&(this.displayNode.value=t)}_setReturn(e){var t="",i=!e||!this.nullable;e=!!Affinity2018.isBool(e)&&e,this.date&&Affinity2018.isDate(this.date)&&(t=this.date.toString(this.outputFormat)),i&&(this.targetNode.value=t)}_setDateFromStr(e,t){if(""!==e){var i,s=!1;if(e=(e=(e=(e=(t=$a.paramOrDefault(t,!1,"boolean"))?e:this.displayNode.value).replace(/the/gi,"")).replace(/\s\s+/g," ")).trim(),i=$a.stringToDate(e),t)return $a.isDateValid(i)?i:"none";$a.isDateValid(i)&&(this.date?i.toString("d-MMM-yyyy HH:mm")!==this.date.toString("d-MMM-yyyy HH:mm")&&(s=!0):s=!0),!0===s&&this.setDate(i),this._setTime(),this._setDisplay(!0),this._setReturn(!0),this.showCalendar&&!this.showTime&&(clearTimeout(this.hideDelay),this.hideDelay=setTimeout(this.hide,250))}else this.date=!1,this.setDate(!1),this._setTime(),this._setDisplay(!0),this._setReturn(!0),console.log(this.date),console.log(this.targetNode.value)}_fireDateEvents(){this.date&&Affinity2018.isDate(this.date)&&(this.dispatchEvent(new CustomEvent("dateClicked",{detail:{dispatchObject:this.date}})),this.dispatchEvent(new CustomEvent("dateChanged",{detail:{dispatchObject:this.date}})),this.targetNode.dispatchEvent(new Event("change")))}_clearShowHideEvents(){clearTimeout(this.bgEventListenerDelay),window.removeEventListener("click",this._windowClicked),this.displayNode.removeEventListener("click",this._stopEvents),this.calendarNode.removeEventListener("click",this._stopEvents)}_setHideShowEvents(){clearTimeout(this.bgEventListenerDelay),this._clearShowHideEvents(),this.bgEventListenerDelay=setTimeout(function(){window.addEventListener("click",this._windowClicked)}.bind(this),100),this.displayNode.addEventListener("click",this._stopEvents),this.calendarNode.addEventListener("click",this._stopEvents)}_monthBackClicked(){clearTimeout(this.hideDelay),this.date?this.date.add({months:-1}):this.__uiDate.add({months:-1}),this._buildCalendar()}_monthForwardClicked(){clearTimeout(this.hideDelay),this.date?this.date.add({months:1}):this.__uiDate.add({months:1}),this._buildCalendar()}_monthClicked(){clearTimeout(this.hideDelay),this.calendarNode.querySelector(".ui-cal-years").classList.remove("show"),this.calendarNode.querySelector(".ui-cal-months").classList.add("show")}_monthsClicked(e){clearTimeout(this.hideDelay);var t="span"===e.target.tagName.toLowerCase()&&e.target;t&&(this.date?this.date.setMonth(t.dataset.value):this.__uiDate.setMonth(t.dataset.value),this._setAll(),this._buildCalendar(),this.calendarNode.querySelector(".ui-cal-months").classList.remove("show"),this.calendarNode.querySelector(".ui-cal-years").classList.remove("show"))}_yearClicked(){clearTimeout(this.hideDelay);var e,t=this.date?this.date.getFullYear():(new Date).getFullYear(),i=this.calendarNode.querySelector(".ui-cal-years .y-"+t);i&&(i.parentNode.scrollTo(0,0),this.calendarNode.querySelector(".ui-cal-months").classList.remove("show"),this.calendarNode.querySelector(".ui-cal-years").classList.add("show"),e=Affinity2018.getOffsetRect(i),i.parentNode.scrollTo(0,e.y+e.height/2-i.parentNode.offsetHeight/2))}_yearsClicked(e){clearTimeout(this.hideDelay);var t="span"===e.target.tagName.toLowerCase()&&e.target;t&&(this.date?this.date.setYear(t.dataset.value):this.__uiDate.setYear(t.dataset.value),this._setAll(),this._buildCalendar(),this.calendarNode.querySelector(".ui-cal-months").classList.remove("show"),this.calendarNode.querySelector(".ui-cal-years").classList.remove("show"))}_timeClicked(){clearTimeout(this.hideDelay),this.showTime&&this.timeNode.classList.add("show")}_reveal(){this.calendarNode.classList.remove("hidden")}_obscure(){this.calendarNode.classList.add("hidden")}_scrolled(e){this._stopEvents(e),this._position(null,"scroll")}_position(e,t){clearTimeout(this._positionDelay),e="number"==typeof e?e:100,this._positionDelay=setTimeout(this._setPosition,e,t)}_setPosition(e){if(clearTimeout(this._positionDelay),this.calendarNode&&"open"===this.status){this.calendarNode.classList.remove("above");var t=this.calendarNode.getBoundingClientRect(),i=Affinity2018.getWindowSize(),s=document.body.scrollTop||0;parseFloat(t.top)+parseFloat(t.height)+s>i.height&&this.calendarNode.classList.add("above")}}_stopEvents(e){e&&(e.preventDefault(),e.stopPropagation())}_windowClicked(e){document.activeElement!==this.displayNode&&this.hide()}Destroy(){for(var e in this._clearShowHideEvents(),clearTimeout(this.watchTimer),clearTimeout(this.bgEventListenerDelay),clearTimeout(this._positionDelay),this.datesNode.querySelectorAll(".ui-cal-cells-row.date-cells .ui-cal-cell").forEach(function(e){e.removeEventListener("click",this._cellClicked)}.bind(this)),this.calendarNode.querySelector(".ui-cal-back-month").removeEventListener("click",this._monthBackClicked),this.calendarNode.querySelector(".ui-cal-forward-month").removeEventListener("click",this._monthForwardClicked),this.calendarNode.querySelector(".ui-cal-current-month").removeEventListener("click",this._monthClicked),this.calendarNode.querySelector(".ui-cal-current-year").removeEventListener("click",this._yearClicked),this.calendarNode.querySelector(".ui-cal-months").removeEventListener("click",this._monthsClicked),this.calendarNode.querySelector(".ui-cal-years").removeEventListener("click",this._yearsClicked),this.displayNode.removeEventListener("focus",this.show),this.displayNode.removeEventListener("keyup",this._displayKeyUp),this.displayNode.removeEventListener("blur",this._displayBlur),this.timeDisplayNode.removeEventListener("click",this._timeClicked),Affinity2018.supportsPassiveEvents&&document.removeEventListener("scroll",this._scrolled,{passive:!0}),Affinity2018.supportsPassiveEvents&&document.removeEventListener("resize",this._position,{passive:!0}),Affinity2018.supportsPassiveEvents||document.removeEventListener("scroll",this._scrolled,!1),Affinity2018.supportsPassiveEvents||document.removeEventListener("resize",this._position,!1),this.targetNode.classList.remove("ui-calendar"),this.targetNode.classList.remove("hidden"),this.timeWidget.Destroy(),this.displayNode.innerHTML="",this.displayNode.parentNode.removeChild(this.displayNode),this.calendarNode.innerHTML="",this.calendarNode.parentNode.removeChild(this.calendarNode),delete Affinity2018.Calendars.widgets[this.uuid],delete this.targetNode.widgets.DateTime,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.calendarTemplate='\n    <div class="ui-cal-inner">\n      <div class="ui-cal-dates hidden">\n        <div class="ui-cal-current">\n          <span class="ui-cal-back-month icon-arrow-left"></span>\n          <span class="ui-cal-current-month">Jan</span>\n          <span class="ui-cal-current-year">2019</span>\n          <span class="ui-cal-forward-month icon-arrow-right"></span>\n        </div>\n        <div class="ui-cal-cells">\n          <div class="ui-cal-cells-row date-days">\n            <div class="ui-cal-cell">Mon</div>\n            <div class="ui-cal-cell">Tue</div>\n            <div class="ui-cal-cell">Wed</div>\n            <div class="ui-cal-cell">Thu</div>\n            <div class="ui-cal-cell">Fri</div>\n            <div class="ui-cal-cell">Sat</div>\n            <div class="ui-cal-cell">Sun</div>\n          </div>\n        </div>\n        <div class="ui-cal-display">\n          <span class="ui-cal-display-date hidden"></span><span class="ui-cal-display-time hidden"></span>\n        </div>\n        <div class="ui-cal-months"></div>\n        <div class="ui-cal-years"></div>\n      </div>\n      <div class="ui-cal-time hidden"></div>\n    </div>\n    '}},Affinity2018.Classes.Plugins.TimeWidget=class{_options(){this.dialsize=200,this.default={targetNode:null,uuid:null,date:null,setCallback:null,hasCalendar:null,hideMethod:null}}constructor(e){if(this._options(),["_init","getTime","setTime","showHours","showMins","hide","show","_setDisplay","_gotoHours","_gotoMins","_amClicked","_pmClicked","_hourClicked","_minClicked","_showEdit","_attemptEdit","_editKeyUp","_hideEdit","_dialLineTo","_dialLabelOver","_dialLabelOut","_hoursFaceClicked","_minsFaceClicked","_okClicked","_cancelClicked","Destroy","_templates"].bindEach(this),this._templates(),this.data=Affinity2018.isObject(e)?Affinity2018.objectDeepMerge(this.default,e):Affinity2018.objectDeepMerge({},this.default),Affinity2018.isDomElement(this.data.targetNode)){var t,i,s,o,a,n,r,l,d,h,c;for(this.targetNode=this.data.targetNode,this.uuid="time-"+this.data.uuid,this.date=this.data.date.clone(),this.date.setSeconds(0),this.date.setMilliseconds(0),this.callback="function"==typeof this.data.setCallback?this.data.setCallback:function(){},this.hasCalendar="boolean"==typeof this.data.hasCalendar&&this.data.hasCalendar,this.parentHide="function"==typeof this.data.hideMethod?this.data.hideMethod:function(){},this.targetNode.innerHTML=this.timeTemplate,this.hoursCanvas=this.targetNode.querySelector(".ui-cal-time-hours-face canvas"),this.minsCanvas=this.targetNode.querySelector(".ui-cal-time-mins-face canvas"),this.hoursCanvas.width=this.dialsize,this.hoursCanvas.height=this.dialsize,this.minsCanvas.width=this.dialsize,this.minsCanvas.height=this.dialsize,this.hoursFaceNode=this.targetNode.querySelector(".ui-cal-time-hours-face"),this.hoursDialNode=this.hoursFaceNode.querySelector(".ui-cal-time-dial"),this.minsFaceNode=this.targetNode.querySelector(".ui-cal-time-mins-face"),this.minsDialNode=this.minsFaceNode.querySelector(".ui-cal-time-dial"),this.currentHourNode=this.targetNode.querySelector(".ui-cal-current-hour"),this.currentMinNode=this.targetNode.querySelector(".ui-cal-current-min"),this.amNode=this.targetNode.querySelector(".ui-cal-time-am"),this.pmNode=this.targetNode.querySelector(".ui-cal-time-pm"),this.editNode=this.targetNode.querySelector(".ui-cal-time-edit"),this.editInputNode=this.editNode.querySelector("input"),this.okNode=this.targetNode.querySelector(".ui-cal-time-ok"),this.cancelNode=this.targetNode.querySelector(".ui-cal-time-cancel"),s=(i=(t=Affinity2018.getOffsetRect(this.hoursDialNode).width)-40)/2,o=(t-i)/2,r=0,l=2*Math.PI/12,d=3,a=0;a<12;a++)(n=document.createElement("div")).classList.add("dial-label","h-"+d,"active"),n.innerHTML=d+0,this.hoursDialNode.appendChild(n),n.addEventListener("mouseover",this._dialLabelOver),n.addEventListener("mouseout",this._dialLabelOut),h=Math.round(i/2+s*Math.cos(r)-15)+o,c=Math.round(i/2+s*Math.sin(r)-15)+o,n.style.top=c+"px",n.style.left=h+"px",r+=l,++d>12&&(d=1);for(this.hoursDialNode.appendChild(this.hoursCanvas),this.hoursCanvasContext=this.hoursCanvas.getContext("2d"),r=0,l=2*Math.PI/60,d=15,a=0;a<60;a++)(n=document.createElement("div")).classList.add("dial-label","m-"+d),n.innerHTML=d+0,this.minsDialNode.appendChild(n),d%5==0&&n.classList.add("active"),n.addEventListener("mouseover",this._dialLabelOver),n.addEventListener("mouseout",this._dialLabelOut),h=Math.round(i/2+s*Math.cos(r)-15)+o,c=Math.round(i/2+s*Math.sin(r)-15)+o,n.style.top=c+"px",n.style.left=h+"px",r+=l,++d>=60&&(d=0);this.minsDialNode.appendChild(this.minsCanvas),this.minsCanvasContext=this.hoursCanvas.getContext("2d"),this._init()}else console.error("No valid element was passed to TimeWidget, dummy!")}_init(){this._gotoHours(),this.amNode.addEventListener("click",this._amClicked),this.pmNode.addEventListener("click",this._pmClicked),this.currentHourNode.addEventListener("click",this._hourClicked),this.currentMinNode.addEventListener("click",this._minClicked),this.currentHourNode.addEventListener("dblclick",this._showEdit),this.currentMinNode.addEventListener("dblclick",this._showEdit),this.editInputNode.addEventListener("keyup",this._editKeyUp),this.hoursDialNode.addEventListener("click",this._hoursFaceClicked),this.minsDialNode.addEventListener("click",this._minsFaceClicked),this.okNode.addEventListener("click",this._okClicked),this.cancelNode.addEventListener("click",this._cancelClicked)}getTime(){if(Affinity2018.isDate(this.date))return this.date.clone()}setTime(e){Affinity2018.isDate(e)&&(this.date=e.clone(),this._setDisplay(),this.callback(e.clone()))}showHours(){this._gotoHours()}showMins(){this._gotoMins()}_setDisplay(){this.hour=this.date.toString("h"),this.minunte=this.date.toString("mm"),this.ampm=parseInt(this.date.toString("H"))>12?"pm":"am",this.currentHourNode.innerHTML=this.hour,this.currentMinNode.innerHTML=this.minunte,this.currentHourNode.classList.remove("selected"),this.currentMinNode.classList.remove("selected"),"hours"===this.state?this.currentHourNode.classList.add("selected"):this.currentMinNode.classList.add("selected"),this.hoursDialNode.querySelector(".selected")&&this.hoursDialNode.querySelector(".selected").classList.remove("selected"),this.minsDialNode.querySelector(".selected")&&this.minsDialNode.querySelector(".selected").classList.remove("selected"),this.hoursDialNode.querySelector(".h-"+parseInt(this.hour))&&this.hoursDialNode.querySelector(".h-"+parseInt(this.hour)).classList.add("selected"),this.minsDialNode.querySelector(".m-"+parseInt(this.minunte))&&this.minsDialNode.querySelector(".m-"+parseInt(this.minunte)).classList.add("selected"),this.amNode.classList.remove("selected"),this.pmNode.classList.remove("selected"),"am"===this.ampm?this.amNode.classList.add("selected"):this.pmNode.classList.add("selected"),this.hoursDialNode.querySelector(".selected")&&this._dialLineTo(this.hoursDialNode.querySelector(".selected"),"#ff5c00"),this.minsDialNode.querySelector(".selected")&&this._dialLineTo(this.minsDialNode.querySelector(".selected"),"#ff5c00"),this.editInputNode.value=this.date.toString("h:mm tt")}_gotoHours(){this.state="hours",this.minsFaceNode.classList.remove("show"),this.hoursFaceNode.classList.add("show"),this._setDisplay()}_gotoMins(){this.state="mins",this.hoursFaceNode.classList.remove("show"),this.minsFaceNode.classList.add("show"),this._setDisplay()}_amClicked(){var e=parseInt(this.date.toString("H"));e>12&&this.date.setHours(e-12),this._setDisplay()}_pmClicked(){var e=parseInt(this.date.toString("H"));e<12&&this.date.setHours(e+12),this._setDisplay()}_hourClicked(){this._gotoHours()}_minClicked(){this._gotoMins()}_showEdit(){this.editNode.classList.add("show"),this.editInputNode.focus(),this.editInputNode.select()}_attemptEdit(){var e,t,i=this.editInputNode.value;i=(i=i.replace(/the/gi,"")).replace(/\s\s+/g," "),e=Date.parse(i),Affinity2018.isDate(e)&&((t=this.date.clone()).setHours(e.getHours()),t.setMinutes(e.getMinutes()),this.setTime(t),this._gotoHours(),this._hideEdit(),this.showCalendar&&!this.showTime&&this.hide())}_editKeyUp(e){switch(e.keyCode){case 13:case 9:case 40:this._attemptEdit();break;case 27:this._hideEdit()}}_hideEdit(){this.editNode.classList.remove("show")}_dialLineTo(e,t){var i,s,o,a,n;e&&(i=e.closest(".ui-cal-time-dial"))&&((s=i.querySelector("canvas").getContext("2d")).clearRect(0,0,this.dialsize,this.dialsize),a={x:(o=Affinity2018.getOffsetRect(i)).x+o.width/2,y:o.y+o.height/2},o=Affinity2018.getOffsetRect(e),n={x:parseInt(e.style.left)+o.width/2,y:parseInt(e.style.top)+o.height/2},Affinity2018.ismobile||(s.beginPath(),s.strokeStyle=t||"#5fd4f7",s.moveTo(a.x,a.y),s.lineTo(n.x,n.y),s.stroke()))}_dialLabelOver(e){var t=!!e.target.classList.contains("dial-label")&&e.target;t&&this._dialLineTo(t,"#5fd4f7")}_dialLabelOut(e){var t=!!e.target.classList.contains("dial-label")&&e.target;t&&(t=t.parentNode.querySelector(".dial-label.selected"))&&this._dialLineTo(t,"#ff5c00")}_hoursFaceClicked(e){var t=!!e.target.classList.contains("dial-label")&&e.target;t&&(this.date.setHours(parseInt(t.innerText)),"pm"===this.ampm&&this.date.setHours(parseInt(t.innerText)+12),this._gotoMins())}_minsFaceClicked(e){var t=!!e.target.classList.contains("dial-label")&&e.target;t&&(this.date.setMinutes(parseInt(t.innerText)),this._gotoHours())}_okClicked(){this.editNode.classList.contains("show")?this._attemptEdit():(this.callback(this.date.clone()),this.hide())}_cancelClicked(){this.hide()}Destroy(){for(var e in this.hoursDialNode.querySelectorAll("div").forEach(function(e){e.removeEventListener("mouseover",this._dialLabelOver),e.removeEventListener("mouseout",this._dialLabelOut)}.bind(this)),this.minsDialNode.querySelectorAll("div").forEach(function(e){e.removeEventListener("mouseover",this._dialLabelOver),e.removeEventListener("mouseout",this._dialLabelOut)}.bind(this)),this.amNode.removeEventListener("click",this._amClicked),this.pmNode.removeEventListener("click",this._pmClicked),this.currentHourNode.removeEventListener("click",this._hourClicked),this.currentMinNode.removeEventListener("click",this._minClicked),this.currentHourNode.removeEventListener("dblclick",this._showEdit),this.currentMinNode.removeEventListener("dblclick",this._showEdit),this.editInputNode.removeEventListener("keyup",this._editKeyUp),this.hoursDialNode.removeEventListener("click",this._hoursFaceClicked),this.minsDialNode.removeEventListener("click",this._minsFaceClicked),this.okNode.removeEventListener("click",this._okClicked),this.cancelNode.removeEventListener("click",this._cancelClicked),this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.timeTemplate='\n    <div class="ui-cal-time-display">\n      <div class="ui-cal-current-time">\n        <span class="ui-cal-current-hour"></span>:<span class="ui-cal-current-min"></span>\n      </div>\n      <div class="ui-cal-time-am">AM</div>\n      <div class="ui-cal-time-pm">PM</div>\n      <div class="ui-cal-time-edit"><input type="text" /></div>\n    </div>\n    <div class="ui-cal-time-hours-face show">\n      <div class="ui-cal-time-pointer"></div>\n      <div class="ui-cal-time-dial">\n        <canvas></canvas>\n      </div>\n    </div>\n    <div class="ui-cal-time-mins-face">\n      <div class="ui-cal-time-pointer"></div>\n      <div class="ui-cal-time-dial">\n        <canvas></canvas>\n      </div>\n    </div>\n    <div class="ui-cal-time-cancel">Cancel</div>\n    <div class="ui-cal-time-ok">OK</div>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Objects"in Affinity2018||(Affinity2018.Objects={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.DrawPanel=class{options(){}constructor(){this.options(),["Apply","Remove","_apply","_templates"].bindEach(this),this.Ready=!0,this._templates()}Apply(e){var t=[];return null!=e?t=[this._apply(e)]:document.querySelectorAll(".ui-has-drawpanel").forEach(function(e){t.push(this._apply(e))}.bind(this)),{total:t.length,widgets:t}}Remove(e){e.classList.contains("ui-drawpanel")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("DrawPanel")&&e.widgets.DrawPanel.Destroy()}_apply(e){return new Affinity2018.Classes.Plugins.DrawPanelWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.DrawPanelWidget=class{_options(){this.WidgetName="DrawPanel",this.Ready=!1,this.MinWidth=420,this.MinHeight=250,this.MinHeightMobile=150,this.MaxWidth=800,this.MaxHeight=600,this.FileIds=[],this.FileNames=[],this.BgImageData=[],this.InitNode=!1,this.GetApi=!1,this.DownloadApi=!1,this.Sketch=null}constructor(e,t){this._options(),["_options","_init","Clear","_loadFiles","_getFileInfo","_getFileFromIdOk","_gotFileFromIdFail","_loadImageData","_loadImageDataFromB64","_setData","_changeBgImage","_setBgImage","_canvasDown","_canvasUp","Destroy","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)?(e.classList.remove("ui-has-drawpanel"),e.classList.add("ui-drawpanel"),this.InitNode=e,$a.isString(this.InitNode.value)&&this.InitNode.value.startsWith("data:image")&&(this.Sketch=this.InitNode.value),Affinity2018.isObject(t)&&Affinity2018.isPropArray(t,"BgImageData")&&(this.BgImageData=t.BgImageData),this.InitNode.hasOwnProperty("widgets")||(this.InitNode.widgets={}),this.InitNode.widgets.DrawPanel=this,this.InitNode.dataset.getApi&&("false"!==this.InitNode.dataset.getApi.toLowerCase().trim()&&(this.GetApi=this.InitNode.dataset.getApi),delete this.InitNode.dataset.getApi),this.InitNode.dataset.downloadApi&&("false"!==this.InitNode.dataset.downloadApi.toLowerCase().trim()&&(this.DownloadApi=this.InitNode.dataset.downloadApi),delete this.InitNode.dataset.downloadApi),this.InitNode.dataset.fileIds||null!==this.Sketch?null!==this.Sketch?this.InitNode.dataset.fileIds?this._loadImageDataFromB64(this.Sketch,"Saved Image",this._loadFiles):this._loadImageDataFromB64(this.Sketch,"Saved Image",this._init):this._loadFiles():this._init()):console.error("No valid element was passed to DrawPanelWidget, dummy!")}_init(){var e=this.MinWidth,t=Affinity2018.IsMobile?this.MinHeightMobile:this.MinHeight,i=!!this.InitNode.closest(".form-row")&&this.InitNode.closest(".form-row");this.InnerNode=document.createElement("div"),this.InnerNode.classList.add("draw-panel-box"),i?(i.appendChild(this.InnerNode),i.classList.add("draw-panel"),this.InitNode.classList.add("hidden")):(this.InitNode.parentNode.insertBefore(this.InnerNode,this.InitNode.nextSibling),this.InitNode.classList.add("hidden")),this.InnerNode.innerHTML=this.template.replace("{{width}}",e).replace("{{height}}",t),this.CanvasNode=this.InnerNode.querySelector("canvas"),this.CanvasNode.width=e,this.CanvasNode.height=t,this.CanvasNode.style.width=e+"px",this.CanvasNode.style.height=t+"px",this.SelectBoxNode=this.InnerNode.querySelector(".bg-image-select"),this.SelectNode=this.SelectBoxNode.querySelector("select"),this.ClearButtonNode=this.InnerNode.querySelector("button.clear");var s=!1;if(this.BgImageData.length>0){s="none",this.SelectNode.innerHTML="";var o=document.createElement("option");o.value="none",o.innerHTML="No Image",o.selected="selected",this.SelectNode.appendChild(o),this.BgImageData.forEach(function(e,t){(o=document.createElement("option")).value=t,o.innerHTML=e.name+"&nbsp;&nbsp;&nbsp;","Saved Image"===e.name&&(s=t),this.SelectNode.appendChild(o)}.bind(this)),this.SelectBoxNode.classList.remove("hidden"),this.SelectNode.addEventListener("change",this._changeBgImage)}else this.SelectBoxNode.classList.add("hidden");this.DrawPad=new Affinity2018.Classes.Plugins.DrawPad(this.CanvasNode,{Panel:this,HasImages:this.BgImageData.length>0}),!1!==s&&(this.SelectNode.value=s,this._changeBgImage(!0)),this.Ready=!0,this.ClearButtonNode.addEventListener("click",this.Clear),this.CanvasNode.addEventListener("mousedown",this._canvasDown),this.CanvasNode.addEventListener("mouseup",this._canvasUp),document.addEventListener("mouseup",this._canvasUp),this.CanvasNode.addEventListener("CanvasReady",this._setData)}Clear(){this.BgImageData.length>0&&(this.SelectNode.selectedIndex=0,this.SelectNode.value="none",this._changeBgImage()),this.DrawPad.Clear(),this.InitNode.value=""}Get(){return this.InitNode.value=this.DrawPad.ToDataURL("image/png",1),this.InitNode.value}_loadFiles(){this.InitNode.dataset.fileIds&&(this.FileIds=this.InitNode.dataset.fileIds.split(","),this.FileIds=this.FileIds.removeEmpty().removeDuplicates(),this._getFileInfo(),delete this.InitNode.dataset.fileIds,delete this.InitNode.dataset.fileNames)}_getFileInfo(){this.FileIds.length>0&&axios({method:"GET",url:this.GetApi+"?fileIds="+this.FileIds.join(",")}).then(this._getFileFromIdOk).catch(this._gotFileFromIdFail)}_getFileFromIdOk(e){if(Affinity2018.isObject(e)&&Affinity2018.isPropObject(e,"data")&&Affinity2018.isPropObject(e.data,"data"))for(var t in this._total=Object.keys(e.data.data).length,this._loaded=0,e.data.data)e.data.data.hasOwnProperty(t)&&this._loadImageData(e.data.data[t],t);else Affinity2018.isObject(e)&&Affinity2018.isPropObject(e,"data")&&Affinity2018.isPropBool(e.data,"FileName")&&Affinity2018.isPropString(e.data,"FilePath")&&Affinity2018.isPropString(e.data,"FileId")&&this.BgImageData.push({name:e.data.FileName,path:e.data.FilePath,fileId:e.data.FileId}),this._init()}_gotFileFromIdFail(e){this._init()}_loadImageData(e,t){var i=new Image,s=this;e=(e=(e=(e=e.substring(0,e.lastIndexOf("."))).replace(/-/g," ")).replace(/_/g," ")).replace(/(^|\s)\S/g,(function(e){return e.toUpperCase()})),i.onload=function(){var t=this.naturalWidth,o=this.naturalHeight;(t>s.MaxWidth||o>s.MaxHeight)&&(t>o?(t=s.MaxWidth,o=s.MaxWidth/this.naturalWidth*this.naturalHeight):(t=s.MaxHeight/this.naturalHeight*this.naturalWidth,o=s.MaxHeight)),this.width=t,this.height=o;var a=document.createElement("canvas");a.width=t,a.height=o,a.getContext("2d").drawImage(this,0,0,t,o),s._loaded++,s.FileNames.push(e),s.BgImageData.push({name:e,width:t,height:o,image:a.toDataURL("image/png")}),s._loaded===s._total&&s._init(),a.getContext("2d").clearRect(0,0,a.width,a.height),a=null,i=null,s=null},i.src=this.DownloadApi+"?documentId="+t}_loadImageDataFromB64(e,t,i){var s=new Image,o=this;s.onload=function(){var e=this.naturalWidth,a=this.naturalHeight;(e>o.MaxWidth||a>o.MaxHeight)&&(e>a?(e=o.MaxWidth,a=o.MaxWidth/this.naturalWidth*this.naturalHeight):(e=o.MaxHeight/this.naturalHeight*this.naturalWidth,a=o.MaxHeight)),this.width=e,this.height=a;var n=document.createElement("canvas");n.width=e,n.height=a,n.getContext("2d").drawImage(this,0,0,e,a),o._loaded++,o.FileNames.push(t),o.BgImageData.push({name:t,width:e,height:a,image:n.toDataURL("image/png")}),n.getContext("2d").clearRect(0,0,n.width,n.height),i(),n=null,s=null,o=null},s.src=e}_setData(){this.InitNode.value=this.DrawPad.ToDataURL("image/png",1),this.InitNode.dispatchEvent(new Event("imageSet"))}_changeBgImage(e){!($a.isBool(e)&&!0===e||$a.isEvent(e))||isNaN(parseInt(this.SelectNode.value))?this._setBgImage():this._setBgImage(this.BgImageData[parseInt(this.SelectNode.value)])}_setBgImage(e){$a.isObject(e)||(e={name:"",width:this.MinWidth,height:Affinity2018.IsMobile?this.MinHeightMobile:this.MinHeight,image:null});var t=e.width,i=e.height;(t>this.MaxWidth||i>this.MaxHeight)&&(t>i?(t=this.MaxWidth,i=this.MaxWidth/e.width*e.height):(t=this.MaxHeight/e.height*e.width,i=this.MaxHeight)),this.CanvasNode.width=t,this.CanvasNode.height=i,this.CanvasNode.style.width=t+"px",this.CanvasNode.style.height=i+"px",this.DrawPad.Clear(),this.InitNode.value="",null!==e.image?this.DrawPad.FromDataURL(e.image):this.InitNode.dispatchEvent(new Event("imageSet")),this.Ready||(this.Ready=!0)}_canvasDown(){this._eventIsDown=!0}_canvasUp(){this._eventIsDown&&(this._eventIsDown=!1,this._setData())}Destroy(){for(var e in this.InitNode.classList.remove("ui-drawpanel"),this.SelectNode.removeEventListener("change",this._changeBgImage),this.ClearButtonNode.removeEventListener("click",this.Clear),this.CanvasNode.removeEventListener("mousedown",this._canvasDown),this.CanvasNode.removeEventListener("mouseup",this._canvasUp),document.removeEventListener("mouseup",this._canvasUp),this.CanvasNode.removeEventListener("CanvasReady",this._setData),this.DrawPad.Destroy(),this.InnerNode.innerHTML="",this.InnerNode.parentNode.removeChild(this.InnerNode),delete this.InitNode.widgets.DrawPanel,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.template='\n    <canvas width="{{width}}" height="{{height}}"></canvas>\n    <div class="bg-image-select hidden">\n      <label>Select Background</label>\n      <div class="select">\n        <select>\n          <option value="-1" selected>No Image</option>\n        </select>\n      </div>\n    </div>\n    <button class="orange clear"><icon class="icon-cancel"></icon>Clear</button>\n    '}},Affinity2018.Classes.Plugins.DrawPad=class{_options(){this.WidgetName="DrawPad",this.velocityFilterWeight=.7,this.minWidth=.5,this.maxWidth=2.5,this.dotSize=function(){return(this.minWidth+this.maxWidth)/2},this.penColor="rgba(0, 0, 0, 1)",this.backgroundColor="rgba(255, 255, 255, 0)",this.canvas=null,this.ctx=null,this.HasImages=!1}constructor(e,t){this._options(),["Clear","IsEmpty","ToDataURL","FromDataURL","_strokeUpdate","_strokeBegin","_strokeDraw","_strokeEnd","_createPoint","_addPoint","_calculateCurveControlPoints","_addCurve","_drawPoint","_drawCurve","_strokeWidth","_handleMouseEvents","_handleTouchEvents","_reset","Destroy"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)?t.hasOwnProperty("Panel")?(t.hasOwnProperty("HasImages")&&$a.isBool(t.HasImages)&&(this.HasImages=t.HasImages),t.hasOwnProperty("Panel")&&(this.Panel=t.Panel),this.velocityFilterWeight=t.velocityFilterWeight||this.velocityFilterWeight,this.minWidth=t.minWidth||this.minWidth,this.maxWidth=t.maxWidth||this.maxWidth,this.dotSize=t.dotSize||this.dotSize,this.penColor=t.penColor||this.penColor,this.backgroundColor=t.backgroundColor||this.backgroundColor,this.canvas=e,this.ctx=this.canvas.getContext("2d"),this.Clear(),Affinity2018.IsMobile?this._handleTouchEvents():this._handleMouseEvents()):console.error("No valid parent Panel controller was passed to DrawPanelWidget DrawPad"):console.error("No valid element was passed to DrawPanelWidget DrawPad")}SetColors(){}Clear(){"none"===this.Panel.SelectNode.value&&Affinity2018.DarkMode?(this.penColor="rgba(255, 255, 255, 1)",this.backgroundColor="rgba(0, 0, 0, 0.1)"):(this.penColor="rgba(0, 0, 0, 1)",this.backgroundColor="rgba(255, 255, 255, 0)"),this.ctx.fillStyle=this.backgroundColor,this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillStyle=this.penColor,this._reset()}IsEmpty(){return this._isEmpty}ToDataURL(e,t){return this.canvas.toDataURL.apply(this.canvas,arguments)}FromDataURL(e){this._reset();var t=new Image;t.onload=function(){this.ctx.drawImage(t,0,0,this.canvas.width,this.canvas.height),this.canvas.dispatchEvent(new CustomEvent("CanvasReady")),t=null}.bind(this),t.src=e,this._isEmpty=!1}_strokeUpdate(e){var t=this._createPoint(e);this._addPoint(t)}_strokeBegin(e){this._reset(),this._strokeUpdate(e)}_strokeDraw(e){var t="function"==typeof this.dotSize?this.dotSize():this.dotSize;this.ctx.beginPath(),this._drawPoint(e.x,e.y,t),this.ctx.closePath(),this.ctx.fill()}_strokeEnd(e){var t=this.points.length>2,i=this.points[0];!t&&i&&this._strokeDraw(i)}_createPoint(e){var t=this.canvas.getBoundingClientRect();return new Affinity2018.Objects.DrawPadPoint(e.clientX-t.left,e.clientY-t.top)}_addPoint(e){var t,i,s;this.points.push(e),this.points.length>2&&(3===this.points.length&&this.points.unshift(this.points[0]),t=this._calculateCurveControlPoints(this.points[0],this.points[1],this.points[2]).c2,i=this._calculateCurveControlPoints(this.points[1],this.points[2],this.points[3]).c1,s=new Affinity2018.Objects.DrawPadBezier(this.points[1],t,i,this.points[2]),this._addCurve(s),this.points.shift())}_calculateCurveControlPoints(e,t,i){var s=e.x-t.x,o=e.y-t.y,a=t.x-i.x,n=t.y-i.y,r=(e.x+t.x)/2,l=(e.y+t.y)/2,d=(t.x+i.x)/2,h=(t.y+i.y)/2,c=Math.sqrt(s*s+o*o),u=Math.sqrt(a*a+n*n),p=u/(c+u),f=d+(r-d)*p,m=h+(l-h)*p,y=t.x-f,g=t.y-m;return{c1:new Affinity2018.Objects.DrawPadPoint(r+y,l+g),c2:new Affinity2018.Objects.DrawPadPoint(d+y,h+g)}}_addCurve(e){var t,i,s=e.startPoint;t=e.endPoint.velocityFrom(s),t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(t),this._drawCurve(e,this._lastWidth,i),this._lastVelocity=t,this._lastWidth=i}_drawPoint(e,t,i){this.ctx.moveTo(e,t),this.ctx.arc(e,t,i,0,2*Math.PI,!1),this._isEmpty=!1}_drawCurve(e,t,i){var s,o,a,n,r,l,d,h,c,u,p,f=i-t;for(s=Math.floor(e.length()),this.ctx.beginPath(),a=0;a<s;a++)l=(r=(n=a/s)*n)*n,u=(c=(h=(d=1-n)*d)*d)*e.startPoint.x,u+=3*h*n*e.control1.x,u+=3*d*r*e.control2.x,u+=l*e.endPoint.x,p=c*e.startPoint.y,p+=3*h*n*e.control1.y,p+=3*d*r*e.control2.y,p+=l*e.endPoint.y,o=t+l*f,this._drawPoint(u,p,o);this.ctx.closePath(),this.ctx.fill()}_strokeWidth(e){return Math.max(this.maxWidth/(e+1),this.minWidth)}_handleMouseEvents(){this._mouseButtonDown=!1,["_handleMouseMouseDown","_handleMouseMove","_handleDocMouseUp"].bindEach(this),this.canvas.addEventListener("mousedown",this._handleMouseMouseDown),this.canvas.addEventListener("mousemove",this._handleMouseMove,Affinity2018.PassiveEventProp),document.addEventListener("mouseup",this._handleDocMouseUp)}_handleMouseMouseDown(e){1===e.which&&(this._mouseButtonDown=!0,this._strokeBegin(e))}_handleMouseMove(e){this._mouseButtonDown&&this._strokeUpdate(e)}_handleDocMouseUp(e){1===e.which&&this._mouseButtonDown&&(this._mouseButtonDown=!1,this._strokeEnd(e))}_handleTouchEvents(){["_handleTouchStart","_handleTouchMove","_handleDocTouchEnd"].bindEach(this),this.canvas.addEventListener("touchstart",this._handleTouchStart),this.canvas.addEventListener("touchmove",this._handleTouchMove,Affinity2018.PassiveEventProp),document.addEventListener("touchend",this._handleDocTouchEnd)}_handleTouchStart(e){var t=e.changedTouches[0];this._strokeBegin(t)}_handleTouchMove(e){e.preventDefault();var t=e.changedTouches[0];this._strokeUpdate(t)}_handleDocTouchEnd(e){e.target===this.canvas&&this._strokeEnd()}_reset(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0}Destroy(){for(var e in this._reset(),this.canvas.removeEventListener("mousedown",this._handleMouseMouseDown),this.canvas.removeEventListener("mousemove",this._handleMouseMove,Affinity2018.PassiveEventProp),document.removeEventListener("mouseup",this._handleDocMouseUp),this.canvas.removeEventListener("touchstart",this._handleTouchStart),this.canvas.removeEventListener("touchmove",this._handleTouchMove,Affinity2018.PassiveEventProp),document.removeEventListener("touchend",this._handleDocTouchEnd),this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){}},Affinity2018.Objects.DrawPadPoint=class{constructor(e,t,i){["velocityFrom","distanceTo"].bindEach(this),this.x=e,this.y=t,this.time=i||(new Date).getTime()}velocityFrom(e){return this.time!==e.time?this.distanceTo(e)/(this.time-e.time):1}distanceTo(e){return Math.sqrt(Math.pow(this.x-e.x,2)+Math.pow(this.y-e.y,2))}},Affinity2018.Objects.DrawPadBezier=class{constructor(e,t,i,s){["length","_point"].bindEach(this),this.startPoint=e,this.control1=t,this.control2=i,this.endPoint=s}length(){var e,t,i,s,o,a,n,r,l=0;for(e=0;e<=10;e++)t=e/10,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),s=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),e>0&&(n=i-o,r=s-a,l+=Math.sqrt(n*n+r*r)),o=i,a=s;return l}_point(e,t,i,s,o){return t*(1-e)*(1-e)*(1-e)+3*i*(1-e)*(1-e)*e+3*s*(1-e)*e*e+o*e*e*e}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.FileUpload=class{options(){}constructor(){this.options(),["Apply","Remove","_apply","_templates"].bindEach(this),this.Ready=!0,this._templates()}Apply(e){var t=[];return null!=e?t=[this._apply(e)]:document.querySelectorAll(".ui-has-file").forEach(function(e){t.push(this._apply(e))}.bind(this)),{total:t.length,widgets:t}}Remove(e){"input"===e.tagName.toLowerCase()&&e.classList.contains("ui-file")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("FileUpload")?e.widgets.FileUpload.Destroy():"input"!==e.tagName.toLowerCase()&&e.classList.contains("ui-file")&&e.querySelector("input.ui-file")&&this.Remove(e.querySelector("input.ui-file"))}_apply(e){return new Affinity2018.Classes.Plugins.FileUploadWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.FileUploadWidget=class extends Affinity2018.ClassEvents{_options(){this.WidgetName="FileUpload",this.Ready=!1,this.MaxFileSize=20,this.AllowMultiple=!0,this.AllowableFileTypes=[],this.GetApi=!1,this.GetInfoApi=!1,this.DownloadApi=!1,this.DeleteApi=!1,this.GetIdParam=!1,this.GetInfoIdParam=!1,this.DownloadIdParam=!1,this.PostIdParam=!1,this.DeleteIdParam=!1,this.GetParams={},this.GetInfoParams={},this.DownloadParams={},this.PostParams={},this.DeleteParams={},this.FileIds=[],this.BlockedFileTypes=["code","executable","unknown"],this.WhiteListTypes=[],this.UseFormDataPost=!0,this.Files=[]}constructor(e){if(super(),this._options(),["GetFiles","GetFileIds","HasFiles","HasSavedFiles","PostFiles","Destroy","_getGridCount","_sizeGrid","_addFile","_contunueAddFile","_gridClicked","_deleteRow","_getFileFromId","_getFileFromIdOk","_gotFileFromIdFail","_postFile","_postFileOk","_postFileFail","_postAllFiles","_deleteFileFromId","_deleteFileFromIdOk","_deleteFileFromIdFail","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){if(e.classList.remove("ui-has-file"),this.initNode=e,this.initNode.classList.add("ui-file"),this.fileNode=this.initNode.querySelector("input"),this.fileNode.classList.add("ui-file"),this.fileNode.widgets||(this.fileNode.widgets={}),this.fileNode.widgets.FileUpload=this,this.PostName=this.fileNode.name,this.descriptionNode=!1,this.initNode.parentNode&&this.initNode.parentNode.classList.contains("form-row")&&this.initNode.parentNode.querySelector("p")&&(this.descriptionNode=this.initNode.parentNode.querySelector("p")),this.fileNode.dataset.allowMultiple&&(this.AllowMultiple="false"!==this.fileNode.dataset.allowMultiple.toString().toLowerCase().trim()&&this.AllowMultiple,delete this.fileNode.dataset.allowMultiple,this.AllowMultiple?this.fileNode.setAttribute("multiple","multiple"):this.fileNode.removeAttribute("multiple")),this.fileNode.dataset.maxSize&&(isNaN(parseFloat(this.fileNode.dataset.maxSize))||(this.MaxFileSize=parseFloat(this.fileNode.dataset.maxSize),delete this.fileNode.dataset.maxSize)),this.fileNode.dataset.allowTypes){this.WhiteListTypes=[];for(var t=this.fileNode.dataset.allowTypes.split(","),i=0;i<t.length;i++)Affinity2018.FileTypeGroupData.hasOwnProperty(t[i])&&(this.WhiteListTypes=this.WhiteListTypes.concat(Affinity2018.FileTypeGroupData[t[i]].Types));t.length>1&&0===this.WhiteListTypes.length&&(this.WhiteListTypes=t.length),delete this.fileNode.dataset.allowTypes}if(this.fileNode.dataset.getApi&&(this.GetApi=this.fileNode.dataset.getApi,delete this.fileNode.dataset.getApi),this.fileNode.dataset.getIdParam&&(this.GetIdParam=this.fileNode.dataset.getIdParam,delete this.fileNode.dataset.getIdParam),this.fileNode.dataset.getParams&&(this.GetParams=Affinity2018.getObjectFromDataset(this.fileNode,"getParams"),delete this.fileNode.dataset.getParams),this.fileNode.dataset.getInfoApi&&(this.GetInfoApi=this.fileNode.dataset.getInfoApi,delete this.fileNode.dataset.getInfoApi),this.fileNode.dataset.getInfoIdParam&&(this.GetInfoIdParam=this.fileNode.dataset.getInfoIdParam,delete this.fileNode.dataset.getInfoIdParam),this.fileNode.dataset.getInfoParams&&(this.GetInfoParams=Affinity2018.getObjectFromDataset(this.fileNode,"getInfoParams"),delete this.fileNode.dataset.getInfoParams),this.fileNode.dataset.downloadApi&&(this.DownloadApi=this.fileNode.dataset.downloadApi,delete this.fileNode.dataset.downloadApi),this.fileNode.dataset.downloadIdParam&&(this.DownloadIdParam=this.fileNode.dataset.downloadIdParam,delete this.fileNode.dataset.downloadIdParam),this.fileNode.dataset.downloadParams&&(this.DownloadParams=Affinity2018.getObjectFromDataset(this.fileNode,"downloadParams"),delete this.fileNode.dataset.downloadParams),this.fileNode.dataset.postApi&&(this.PostApi=this.fileNode.dataset.getApi,delete this.fileNode.dataset.getApi),this.fileNode.dataset.postParams&&(this.PostParams=Affinity2018.getObjectFromDataset(this.fileNode,"postParams"),delete this.fileNode.dataset.postParams),this.fileNode.dataset.deleteApi&&(this.DeleteApi=this.fileNode.dataset.deleteApi,delete this.fileNode.dataset.deleteApi),this.fileNode.dataset.deleteIdParam&&(this.DeleteIdParam=this.fileNode.dataset.deleteIdParam,delete this.fileNode.dataset.deleteIdParam),this.fileNode.dataset.deleteParams&&(this.DeleteParams=Affinity2018.getObjectFromDataset(this.fileNode,"deleteParams"),delete this.fileNode.dataset.deleteParams),this.fileNode.dataset.fileIds){var s=this.fileNode.dataset.fileIds;this.FileIds=s.split(",").removeEmpty().removeDuplicates(),delete this.fileNode.dataset.fileIds}this._deleteThese=[],this.gridNode=document.createElement("div"),this.gridNode.classList.add("grid-wrapper","ui-file-list","hidden"),this.gridNode.innerHTML=this.gridTemplate,this.descriptionNode,this.initNode.parentNode.insertBefore(this.gridNode,this.initNode.nextSibling),this.gridBody=this.gridNode.querySelector("tbody"),this.fileNode.addEventListener("change",this._addFile),this.gridNode.addEventListener("click",this._gridClicked),this.GetApi&&this.FileIds.length>0?this._getFileFromId(this.FileIds):(this.Ready=!0,this.fileNode.dispatchEvent(new CustomEvent("widgetReady")))}else console.error("No valid element was passed to FileUploadWidget, dummy!")}GetFiles(){if(this.HasFiles()||this.HasSavedFiles()){var e=[];return this.gridBody.querySelectorAll("tr.from-doc-store").forEach(function(t){e.push({FileName:t.dataset.fileName||null,FileId:t.dataset.fileId||null})}.bind(this)),e}return[]}GetFileIds(){if(this.HasFiles()||this.HasSavedFiles()){var e,t=$a.jsonCloneObject(this.FileIds);return this.gridBody.querySelectorAll("tr.from-doc-store").forEach(function(i){null!==(e=isNaN(parseInt(i.dataset.fileId))?null:parseInt(i.dataset.fileId))&&t.push(e)}.bind(this)),t=(t=t.map((function(e){return e+""}))).removeDuplicates().removeEmpty()}return[]}HasFiles(){return this.gridBody.querySelectorAll("tr").length>0}HasUnsavedFiles(){return this.gridBody.querySelectorAll("tr:not(.from-doc-store)").length>0}HasSavedFiles(){return this.FileIds.length>0}PostFiles(){this.Files.length>0&&this._postAllFiles()}DeleteFiles(){this.Files.length>0&&this._deleteMissingFiles()}_getGridCount(e){return(e=$a.paramOrDefault(e,!1))?this.gridBody.querySelectorAll("tr.from-doc-store").length:this.gridBody.querySelectorAll("tr").length}_sizeOk(e){return!(e>1048576*this.maxSize)}_fileTypeOk(e){var t=$a.GetDocFileData(e);return"Unknown"!==t.type&&(this.WhiteListTypes.length>0?!!this.WhiteListTypes.contains(t.type)||!!this.WhiteListTypes.contains(t.ext):!this.BlockedFileTypes.contains(t.type))}_getExt(e){return e.substr(e.lastIndexOf(".")).replace(/\./g,"").toLowerCase().trim()}_sizeGrid(){var e,t=!1;this.initNode.closest('div[class*="row"]')&&(t=!!(e=this.initNode.closest('div[class*="row"]').querySelector("label"))&&parseInt(window.getComputedStyle(e).width)+parseInt(window.getComputedStyle(this.initNode).width)),t&&!isNaN(t)&&t>0&&(this.gridNode.style.minWidth=t+8+"px"),clearTimeout(this.resizeTimeout),this.resizeTimeout=setTimeout(function(){this.dispatchEvent(new CustomEvent("resized"))}.bind(this),1e3)}_addFile(e){this.AllowMultiple?this._contunueAddFile(e):this.Files.length>0?Affinity2018.Dialog.Show({message:"Are you sure you want to replace <strong><em>"+this.gridBody.querySelector("td.file").innerText+"</em></strong>?",showOk:!0,showCancel:!0,showInput:!1,buttons:{ok:{text:"Yes",icon:"delete"}},onOk:this._contunueAddFile}):this._contunueAddFile(e),this._contunueAddFile(e)}_contunueAddFile(e){var t,i,s,o=[],a=0,n=[];if(this.fileNode.files.length>0){for(;a<this.fileNode.files.length;a++)t=this.fileNode.files[a],i=$a.GetDocFileData(t.name),s=[],this._sizeOk(t.size)||s.push("<strong><em>"+t.name+"</em></strong> is to big. Files can not be larger than "+this.maxSize+"MB"),this._fileTypeOk(t.name)||s.push("We can't upload <strong><em>"+t.name+'</em></strong>. <span style="text-transform: capitalize">'+i.type+"</span> files can not be uploaded."),s.length>0?o=[].concat(o,s):n.push(t);if(o.length>0&&Affinity2018.Dialog.Show({message:o.join("<br />"),showOk:!0,showCancel:!1,showInput:!1}),n.length>0)if(this.dispatchEvent(new CustomEvent("uploaded")),this.AllowMultiple)this._addRemainingFiles(n);else{var r,l,d=!1,h=-1;this.FileIds.length>0?(r=this.gridBody.querySelector("tr.from-doc-store"))&&(l=r.dataset.fileName,h=r.dataset.fileId,d=!0):0===this.FileIds.length&&this._getGridCount()>0&&(r=this.gridBody.querySelector("tr"))&&(l=r.querySelector("td.file").innerText,h=-1,d=!0),d?Affinity2018.Dialog.Show({message:'File "'+l+'" wil be deleted and will be replaced with "'+n[0].name+'".<br />Are you sure you wish to continue?',showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{text:"Yes",icon:"tick"}},onOk:function(){-1!==h?this._deleteFileFromId(h):this._deleteRow(this.gridBody.querySelector("tr")),this._addRemainingFiles(n)}.bind(this),onCancel:function(){this._resetFileNode()}}):this._addRemainingFiles(n)}this._resetFileNode()}}_addRemainingFiles(e){var t,i=0;for(i=0;i<e.length;i++)t=e[i],$a.GetDocFileData(t.name),this.Files.push(t),this._insertRow(t.name);!1!==this.PostApi&&this._postAllFiles(),this._checkGrid(),this._resetFileNode()}_checkGrid(){this.gridNode.classList.add("hidden"),this.gridBody.querySelectorAll("tr").length>0&&(this._sizeGrid(),this.gridNode.classList.remove("hidden"))}_gridClicked(e){var t=e.target.closest(".button"),i=!!t&&t.closest("tr");i&&t.classList.contains("del")&&$a.Dialog.Show({message:"Are you sure you want to remove <strong><em>"+i.querySelector("td.file").innerText+"</em></strong>?",showOk:!0,showCancel:!0,showInput:!1,textAlign:"left",buttons:{ok:{text:"Yes",icon:"delete"}},onOk:function(){this._deleteRow(i)}.bind(this)})}_insertRow(e,t,i){var s;(s=document.createElement("tr")).innerHTML=this.rowTemplate,s.querySelector("td.file").innerHTML=e,t&&!t.isNullOrEmpty()&&(s.querySelector("td.file").innerHTML='<a href="'+t+'" target="_blank">'+e+"</a>"),($a.isString(i)&&!i.isNullOrEmpty()||$a.isInt(i))&&(s.classList.add("from-doc-store","id"+i),s.dataset.fileId=i,s.dataset.fileName=e),this.gridBody.appendChild(s),this.gridNode.classList.add("hidden"),this.gridBody.querySelectorAll("tr").length>0&&(this._sizeGrid(),this.gridNode.classList.remove("hidden"))}_updateSectionSize(){}_deleteRow(e){if(e&&"tr"===e.tagName.toLowerCase()&&e.parentNode===this.gridBody){if(this.DeleteApi&&e.classList.contains("from-doc-store")&&e.dataset.fileId)this._deleteFileFromId(e.dataset.fileId);else{this.gridBody.removeChild(e);for(var t=e.innerText.toLowerCase().trim(),i=0;i<this.Files.length;i++)if(this.Files[i].name.toLowerCase().trim()==t){this.Files.splice(i,1);break}}0===this.gridBody.querySelectorAll("tr").length&&(this.gridNode.classList.add("hidden"),this.Files=[]),this._resetFileNode()}}_resetFileNode(){try{this.fileNode.value=""}catch(e){}try{this.fileNode.value&&(this.fileNode.type="text",this.fileNode.type="file")}catch(e){}}_getFileFromId(e){if(this.GetApi&&this.DownloadApi){if($a.isString(e)&&e.contains(",")&&(e=e.split(",")),$a.isString(e)&&!e.contains(",")&&(e=[e]),!$a.isArray(e))return;e=(e=e.map((function(e){return e+""}))).removeDuplicates().removeEmpty();var t=Affinity2018.jsonCloneObject(this.GetInfoParams);for(var i in t)i===this.GetInfoIdParam&&(t[i]=e);var s=[];for(i in t)s.push(i+"="+t[i]);var o=this.GetInfoApi+"?"+s.join("&");axios({method:"GET",url:o}).then(this._getFileFromIdOk).catch(this._gotFileFromIdFail)}}_getFileFromIdOk(e){if(this._deleteThese=[],Affinity2018.isObject(e)&&Affinity2018.isPropObject(e,"data")&&Affinity2018.isPropObject(e.data,"data")){var t,i,s;for(t in e.data.data)if(e.data.data.hasOwnProperty(t))if(""!==(i=e.data.data[t]).trim()){var o=Affinity2018.jsonCloneObject(this.DownloadParams);for(var a in o)a===this.DownloadIdParam&&(o[a]=t);var n=[];for(a in o)o.hasOwnProperty(a)&&n.push(a+"="+o[a]);s=this.DownloadApi+"?"+n.join("&"),this._insertRow(i,s,t)}else this._deleteThese.push(t);if(this.Ready=!0,this.fileNode.dispatchEvent(new CustomEvent("widgetReady")),this._deleteThese.length>0){var r=deleteNameless[0];this._deleteThese=this._deleteThese.shift(),this._deleteFileFromId(r)}}else $a.isObject(e)&&$a.isPropObject(e,"data")&&$a.isPropBool(e.data,"FileName")&&$a.isPropString(e.data,"FilePath")&&$a.isPropString(e.data,"FileId")&&this._insertRow(e.data.FileName,e.data.FilePath,e.data.FileId),this._loaded++,this._loaded===this._loadTotal&&(this.Ready=!0)}_gotFileFromIdFail(e){this._loaded++,this._loaded===this._loadTotal&&(this.Ready=!0)}_postAllFiles(){var e,t;e=this.UseFormDataPost?new FormData:{};var i=Affinity2018.jsonCloneObject(this.PostParams);for(t in i)i.hasOwnProperty(t)&&(this.UseFormDataPost?e.append(t,i[t]):e[t]=i[t]);this.Files.forEach(function(i,s){t="file["+s+"]",this.UseFormDataPost?e.append(t,i):e[t]=i}.bind(this)),$a.ShowPageLoader(),axios({method:"POST",url:this.PostApi,data:e,headers:{"Content-Type":"multipart/form-data"}}).then(this._postFileOk).catch(this._postFileFail)}_postFileOk(e){var t,i=[];if($a.isObject(e)&&$a.isPropArray(e,"data"))if(e.data.length>0){for(var s=0;s<e.data.length;s++)t=e.data[s],$a.isInt(t.FileId)&&$a.isString(t.FileName)&&(this.FileIds.contains(t.FileId)||this.FileIds.push(t.FileId),i.push(t.FileName),this.gridBody.querySelectorAll("tr:not(.from-doc-store)").forEach(function(e){i.forEach(function(i){if(i===e.querySelector("td.file").innerText.trim()){this._deleteRow(e);var s=!!this.DownloadApi&&this.DownloadApi+"?documentId="+t.FileId;this._insertRow(t.FileName,s,t.FileId)}}.bind(this))}.bind(this)));e.data.length===i.length&&i.length>0&&(this.dispatchEvent(new CustomEvent("postSuccess",{detail:{dispatchObject:{FileName:i.join(","),FileId:this.FileIds.join(",")}}})),this._resetFileNode(),$a.HidePageLoader())}else this._postFileFail("No results returned");else this._postFileFail("Bad return data")}_postFileFail(e){console.log(e);for(var t=0,i=[];t<this.Files.length;t++)i.push(this.Files[t].name);this.dispatchEvent(new CustomEvent("postFailed",{detail:{dispatchObject:{FileName:i}}})),$a.HidePageLoader()}_deleteFileFromId(e){if(this.DeleteApi){var t;t=this.UseFormDataPost?new FormData:{};var i=Affinity2018.jsonCloneObject(this.DeleteParams);for(var s in i)s===this.DeleteIdParam&&(i[s]=[e]);for(s in i)i.hasOwnProperty(s)&&(this.UseFormDataPost?t.append(s,i[s]):t[s]=i[s]);this._deletingFileRow=!1,this.gridBody.querySelector(".from-doc-store.id"+e)&&(this._deletingFileRow=this.gridBody.querySelector(".from-doc-store.id"+e)),$a.ShowPageLoader(),axios({method:"POST",url:this.DeleteApi,data:t}).then(this._deleteFileFromIdOk).catch(this._deleteFileFromIdFail)}}_deleteFileFromIdOk(e){if($a.isObject(e)&&$a.isPropObject(e,"data")&&$a.isPropBool(e.data,"Success")&&!0===e.data.Success){if(this._deletingFileRow){var t,i=this._deletingFileRow.dataset.fileName,s=this._deletingFileRow.dataset.fileId;for(t=0;t<this.Files.length;t++)if(this.Files[t].name.toLowerCase().trim()==i){this.Files.splice(t,1);break}if(Array.isArray(this.FileIds)&&this.FileIds.length>0)for(this.FileIds=this.FileIds.map((function(e){return e+""})),this.FileIds=this.FileIds.removeDuplicates().removeEmpty(),t=0;t<this.FileIds.length;t++)if(this.FileIds[t]===s+""){this.FileIds.splice(t,1);break}this.gridBody.removeChild(this._deletingFileRow),0===this.gridBody.querySelectorAll("tr").length&&(this.gridNode.classList.add("hidden"),this.Files=[]),this._resetFileNode(),this._deletingFileRow=!1}if(this._deleteThese.length>0){var o=this._deleteThese[0];this._deleteThese=this._deleteThese.shift(),this._deleteFileFromId(o)}else this.dispatchEvent(new CustomEvent("deleteSuccess",{detail:{dispatchObject:{FileName:i,FileId:s}}})),$a.HidePageLoader()}else $a.isObject(e)&&$a.isPropObject(e,"data")&&$a.isPropBool(e.data,"Success")&&!1===e.data.Success?this.dispatchEvent(new CustomEvent("deleteFailed",{detail:{Success:!1,dispatchObject:{FileName:"",FileId:""}}})):(this.dispatchEvent(new CustomEvent("deleteFailed",{detail:{dispatchObject:{FileName:"",FileId:""}}})),$a.HidePageLoader())}_deleteFileFromIdFail(e){this.dispatchEvent(new CustomEvent("deleteFailed",{detail:{dispatchObject:{FileName:"",FileId:""}}})),$a.HidePageLoader()}Destroy(){this.fileNode.removeEventListener("change",this._addFile),this.gridNode.removeEventListener("click",this._gridClicked)}_templates(){this.gridTemplate='\n    <table class="grid">\n      <thead>\n        <tr>\n          <th class="file">File</th>\n          <th></th>\n        </tr>\n      </thead>\n      <tbody>\n      </tbody>\n    </table>\n    ',this.rowTemplate='\n    <td class="file"></td>\n    <td>\n      <div class="button orange del icon-delete"></div>\n      <input type="hidden" class="no-validate" />\n    </td>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.ListBuilder=class{options(){this.WidgetName="ListBuilder",this.ColumnHeaders={KeyHeader:$a.Lang.ReturnPath("generic.list_builder.design_items.key_header"),KeyHelp:$a.Lang.ReturnPath("generic.list_builder.design_items.key_help"),ValueHeader:$a.Lang.ReturnPath("generic.list_builder.design_items.value_header"),ValueHelp:$a.Lang.ReturnPath("generic.list_builder.design_items.value_help")},this.KeyNames={KeyName:"Key",ValueName:"Value"},this.targetNode=!1,this.listNode=!1,this.data=!1,this.NewRender=!0,this.AutoIncrement=0,this.StepOverDuplicates=!1,this.ModifyDuplicates=!0}constructor(e,t){this.options(),["Render","GetData","Backup","SetBackup","GetBackup","RestoreBackup","InsertBlankRow","SanatiseData","ResetModified","Clear","Apply","_getNextIncrement","_insertRow","_gridClicked","_cellKeyUp","_compare","_doCompare","_updateData","_downloadCSVTemplate","_clearTable","_downloadToCSV","_uploadCSV","Destroy"].bindEach(this),this.templates(),e&&(this.targetNode=e),"object"==typeof t&&Array.isArray(t)?this.data=t:this.data=[],this.backupData=[],this.IsModified=!1,this.ModifiedCallback=function(){},this.targetNode&&!this.targetNode.hasOwnProperty("widgets")&&(this.targetNode.widgets={}),this.targetNode&&(this.targetNode.widgets.ListBuilder=this,this.targetNode.classList.add("ui-listbuilder")),this.listTemplate=this.listTemplate.format({downloadCSV:$a.Lang.ReturnPath("generic.list_builder.download_csv_label"),downloadCSVTooltip:$a.Lang.ReturnPath("generic.list_builder.ownload_csv_tooltip"),uploadCSVTooltip:$a.Lang.ReturnPath("generic.list_builder.upload_csv_tooltip"),clearTooltip:$a.Lang.ReturnPath("generic.list_builder.clear_table_tooltip")}),this.listRowTemplate=this.listRowTemplate.format({descPlaceholder:$a.Lang.ReturnPath("generic.list_builder.desc_placeholder"),codePlaceholder:$a.Lang.ReturnPath("generic.list_builder.code_placeholder")})}Render(e,t,i){if(e&&(this.targetNode=e,this.targetNode.hasOwnProperty("widgets")||(this.targetNode.widgets={}),this.targetNode.widgets.hasOwnProperty("ListBuilder")||(this.targetNode.widgets.ListBuilder=this)),Array.isArray(t)&&(this.data=Affinity2018.jsonCloneObject(t)),this.targetNode){this.AutoIncrement=this._getNextIncrement(),this.listNode=this.targetNode.querySelector(".list-builder"),this.listNode.innerHTML=this.listTemplate.format({KeyHeader:this.ColumnHeaders.KeyHeader,KeyHelp:this.ColumnHeaders.KeyHelp,ValueHeader:this.ColumnHeaders.ValueHeader,ValueHelp:this.ColumnHeaders.ValueHelp}),""===this.ColumnHeaders.KeyHelp.trim()&&this.listNode.querySelector(".th.key-header").removeChild(this.listNode.querySelector(".th.key-header icon")),""===this.ColumnHeaders.ValueHelp.trim()&&this.listNode.querySelector(".th.value-header").removeChild(this.listNode.querySelector(".th.value-header icon")),this.gridBodyNode=this.listNode.querySelector("table tbody"),this.downloadTemplateNode=this.listNode.querySelector("a.download-template"),this.clearButtonNode=this.listNode.querySelector("button.reset"),this.downloadButtonNode=this.listNode.querySelector("button.download"),this.uploadButtonNode=this.listNode.querySelector("button.upload"),this.uploadFileNode=this.uploadButtonNode.querySelector('input[type="file"]'),this.downloadTemplateNode.addEventListener("click",this._downloadCSVTemplate),this.clearButtonNode.addEventListener("click",this._clearTable),this.downloadButtonNode.addEventListener("click",this._downloadToCSV),this.uploadFileNode.addEventListener("change",this._uploadCSV),this.NewRender=!0;var s,o=!1,a=[],n=0;if(Affinity2018.isArray(this.data))for(o=!1;n<this.data.length;n++)(t=this._isRowDataGood(this.data[n]))&&(a.contains(t[this.KeyNames.KeyName])||(o=!0,a.push(t[this.KeyNames.KeyName]),this._insertRow(t)));else if(Affinity2018.isObject(this.data))for(s in o=!1,this.data)t=this._returnEmptyData(),this.data.hasOwnProperty(s)&&""!==s.trim()&&""!==this.data[s].trim()&&(t[this.KeyNames.KeyName]=s.trim(),t[this.KeyNames.ValueName]=this.data[s].trim(),a.contains(t[this.KeyNames.KeyName])||(o=!0,a.push(t[this.KeyNames.KeyName]),this._insertRow(t)));o||(this.data=[],0===this.gridBodyNode.querySelectorAll("tr").length&&this.InsertBlankRow()),this.listNode.removeEventListener("click",this._gridClicked),this.listNode.addEventListener("click",this._gridClicked),this.IsModified=!1,Affinity2018.Apps.Plugins.Tooltips.Apply(),i&&Affinity2018.isFunction(i)&&i()}}GetData(){return this.data=this._updateData(),this.data}Backup(){this.backupData=Affinity2018.jsonCloneObject(this.data),console.log("backed up",this.backupData)}RestoreBackup(){this.Render(this.targetNode,this.backupData)}SetBackup(e){this.backupData=e}GetBackup(){return this.backupData}InsertBlankRow(){this._insertRow(this._returnEmptyData())}SanatiseData(e){e=Array.isArray(e)?e:this.GetData();for(var t,i,s=this.KeyNames,o=Math.max.apply(Math,e.map((function(e){return isNaN(parseFloat(e[s.ValueName]))?0:parseFloat(e[s.ValueName])})))+1,a=[],n={},r=0;r<e.length;r++)""!==e[r][s.KeyName].trim()&&(""===e[r][s.ValueName].trim()?((i={})[s.KeyName]=e[r][s.KeyName],i[s.ValueName]=o.toString().padLeft("0",4),a.push(i),o++,n[t="key-"+e[r][s.ValueName]]=0):(t="key-"+e[r][s.ValueName].trim().replace(/[\s."]/g,"-"),n.hasOwnProperty(t)?(n[t]++,this.StepOverDuplicates||((i={})[s.KeyName]=e[r][s.KeyName],this.ModifyDuplicates?i[s.ValueName]=e[r][s.ValueName].trim()+"-dup-"+n[t].toString().padLeft("0",4):i[s.ValueName]=e[r][s.ValueName].trim(),a.push(i))):((i={})[s.KeyName]=e[r][s.KeyName],i[s.ValueName]=e[r][s.ValueName].trim(),a.push(i),n[t]=0)));return JSON.stringify(e)!==JSON.stringify(a)&&(console.groupCollapsed("%c⥹>> Items Modified","color:#ff5c00"),console.log("%cOriginal:","color:#ff5c00"),console.log(e),console.log("%cFinal:","color:#ff5c00"),console.log(a),console.log("%cDuplicates:","color:#ff5c00"),console.log(n),console.groupEnd()),a}ResetModified(){this.NewRender=!0,this.IsModified=!1}Clear(){this._clearTable()}Reset(){this._clearTable(!1,!1),this.NewRender=!0,this.IsModified=!1,this.backupData=[]}Apply(){}_isRowDataGood(e){if(Affinity2018.isObject(e)){var t=e[this.KeyNames.KeyName],i=e[this.KeyNames.ValueName];if($a.isString(t)&&($a.isString(i)||$a.isNumeric(i)))return e}return!1}_returnEmptyData(){var e={};return e[this.KeyNames.KeyName]="",e[this.KeyNames.ValueName]=this.AutoIncrement.toString().padLeft("0",4),this.AutoIncrement++,e}_getNextIncrement(){if(this.data){var e=0;this.data.length>0&&(e=Math.max.apply(Math,this.data.map((function(e){return isNaN(parseFloat(e[Affinity2018.Apps.Plugins.ListBuilder.KeyNames.ValueName]))?0:parseFloat(e[Affinity2018.Apps.Plugins.ListBuilder.KeyNames.ValueName])})))),isNaN(e)||e===Number.POSITIVE_INFINITY||e===Number.NEGATIVE_INFINITY||(this.AutoIncrement=e)}return this.AutoIncrement++,this.AutoIncrement}_insertRow(e){var t;return!!(e=this._isRowDataGood(e))&&(""===e[this.KeyNames.ValueName].toString().trim()&&(e[this.KeyNames.ValueName]=this.AutoIncrement,this.AutoIncrement++),(t=document.createElement("tr")).innerHTML=this.listRowTemplate,t.querySelector("input.description").value=e[this.KeyNames.KeyName],t.querySelector("input.code").value=e[this.KeyNames.ValueName],t.querySelector("input.description").addEventListener("keyup",this._cellKeyUp),t.querySelector("input.code").addEventListener("keyup",this._cellKeyUp),this.gridBodyNode.appendChild(t),this._compare(),t)}_moveRowUp(e){this.gridBodyNode.querySelectorAll("tr").length>1&&this.gridBodyNode.querySelector("tr")!==e&&(e.parentNode.insertBefore(e,e.previousSibling),this._compare())}_moveRowDown(e){this.gridBodyNode.querySelectorAll("tr").length>1&&(e.nextSibling&&e.nextSibling.nextSibling?e.parentNode.insertBefore(e,e.nextSibling.nextSibling):e.parentNode.appendChild(e),this._compare())}_addRow(e){var t=this._insertRow(this._returnEmptyData());e.parentNode.insertBefore(t,e),e.parentNode.insertBefore(e,t),this._compare()}_deleteRow(e){e.querySelector("input.description").removeEventListener("keyup",this._cellKeyUp),e.querySelector("input.code").removeEventListener("keyup",this._cellKeyUp),e.parentNode.removeChild(e),this.gridBodyNode.querySelector("tr")||this._insertRow(this._returnEmptyData()),this._compare()}_gridClicked(e){var t=e.target.closest(".button");if(t)switch(t.dataset.do){case"up":this._moveRowUp(t.closest("tr"));break;case"down":this._moveRowDown(t.closest("tr"));break;case"add":this._addRow(t.closest("tr"));break;case"delete":this._deleteRow(t.closest("tr"))}}_cellKeyUp(){this._compare()}_updateData(){var e,t,i,s=[];return this.gridBodyNode.querySelectorAll("tr").forEach(function(o){e=o.querySelector("input.description").value.trim(),t=o.querySelector("input.code").value.trim(),(i={})[this.KeyNames.KeyName]=e,i[this.KeyNames.ValueName]=t,e.trim()+t.trim()!==""&&s.push(i)}.bind(this)),s}_compare(){clearTimeout(this._compareTimer),this._compareTimer=setTimeout(this._doCompare,250)}_doCompare(){JSON.stringify(this.data)!==JSON.stringify(this._updateData())?(this.IsModified=!0,this.NewRender?this.ModifiedCallback("render"):this.ModifiedCallback("manipulation")):this.IsModified=!1,this.NewRender=!1}_downloadCSVTemplate(){var e=document.createElement("a");e.setAttribute("href",encodeURI("data:text/csv;charset=utf-8,"+this.KeyNames.KeyName+","+this.KeyNames.ValueName+"\r\n")),e.setAttribute("download","list_template.csv"),document.body.appendChild(e),e.click(),document.body.removeChild(e),e=null}_clearTable(e,t){t=$a.paramOrDefault(t,!0,"boolean"),this.AutoIncrement=0,e=!$a.isBool(e)||e,this.gridBodyNode&&(this.gridBodyNode.querySelectorAll("tr").forEach(function(e){e.querySelector("input.description")&&e.querySelector("input.description").removeEventListener("keyup",this._cellKeyUp),e.querySelector("input.code")&&e.querySelector("input.code").removeEventListener("keyup",this._cellKeyUp)}.bind(this)),this.gridBodyNode.innerHTML="",e&&this.InsertBlankRow()),t&&this.ModifiedCallback("clear")}_downloadToCSV(){var e,t,i,s=this.GetData(),o="data:text/csv;charset=utf-8,";o+=this.KeyNames.KeyName+","+this.KeyNames.ValueName+"\r\n",s.forEach(function(t){(t=this._isRowDataGood(t))&&(e=t[this.KeyNames.KeyName]+","+t[this.KeyNames.ValueName],o+=e+"\r\n")}.bind(this)),t=encodeURI(o),$a.Dialog.Show({message:"Save as",buttons:{ok:{show:!0,icon:"download",text:"Download",color:"blue"},cancel:{show:!0,icon:"cross",text:"Cancel",color:"grey"}},input:{show:!0,placeholder:"",default:"grid_data.csv",lines:1},textAlign:"left",canBackgroundClose:!1,onOk:function(e){""!==(e=e.trim())&&(".csv"!==e.toLowerCase().substring(e.length-4,e.length)&&(e+=".csv"),(i=document.createElement("a")).setAttribute("href",t),i.setAttribute("download",e),document.body.appendChild(i),i.click(),document.body.removeChild(i),i=null)}.bind(this)})}_uploadCSV(){if(this.uploadFileNode.files&&this.uploadFileNode.files.length>0){var e,t,i,s,o,a,n=this.uploadFileNode.files[0],r=[],l=[];n&&(t=(n.size/1024/1024).toFixed(4),"csv"===(e=/(?:\.([^.]+))?$/.exec(n.name)[1].toLowerCase())&&t<=20?((i=new FileReader).onload=function(){(s=i.result.split(/\r\n|\n/)).length>0&&s.forEach(function(e){2===(o=e.split(",")).length&&o[0].toLowerCase().trim()!==this.KeyNames.KeyName.toLowerCase()&&o[1].toLowerCase().trim()!==this.KeyNames.ValueName.toLowerCase()&&((a={})[this.KeyNames.KeyName]=o[0].trim(),a[this.KeyNames.ValueName]=o[1].trim(),r.push(a))}.bind(this)),r.length>0?(this._clearTable(!1),r.forEach(function(e){this._insertRow(e)}.bind(this)),0===this.gridBodyNode.querySelectorAll("tr").length&&this.InsertBlankRow()):$a.Dialog.Show({message:l.join('We could not find any usable data in "'+n.name+'".')})}.bind(this),i.readAsBinaryString(n)):("csv"!==e&&l.push("You can only uplaod .csv files"),t>20&&l.push("Your file is too big. It must be 20MB or less."),$a.Dialog.Show({message:l.join("<br />")})))}try{this.uploadFileNode.value=""}catch(e){}try{this.uploadFileNode.value&&(this.uploadFileNode.type="text",this.uploadFileNode.type="file")}catch(e){}this.ModifiedCallback("csv")}Destroy(){for(var e in clearTimeout(this._compareTimer),this.backupData=[],this.IsModified=!1,this.listNode&&(this._clearTable(!1),this.downloadTemplateNode.removeEventListener("click",this._downloadCSVTemplate),this.listNode.removeEventListener("click",this._gridClicked),this.clearButtonNode.removeEventListener("click",this._clearTable),this.downloadButtonNode.removeEventListener("click",this._downloadToCSV),this.uploadFileNode.removeEventListener("change",this._uploadCSV),this.listNode.innerHTML="",this.listNode.parentNode.removeChild(this.listNode)),delete this.InputNode.widgets.ListBuilder,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}templates(){this.listTemplate='\n    <div class="grid-wrapper flat-bottom">\n      <table class="grid">\n        <thead>\n          <tr>\n            <th class="key-header">{KeyHeader} <icon class="icon-help-round ui-has-tooltip" data-tooltip="{KeyHelp}"></icon></th>\n            <th class="value-header">{ValueHeader} <icon class="icon-help-round ui-has-tooltip" data-tooltip="{ValueHelp}"></icon></th>\n            <th></th>\n          </tr>\n        </thead>\n        <tbody>\n        </tbody>\n      </table>\n    </div>\n    <div class="grid-buttons flat-top">\n      <a class="download-template" href="javascript:void(0)">{downloadCSV}</a>\n      <button class="blue download no-label ui-has-tooltip" data-tooltip="{downloadCSVTooltip}"><icon class="icon-download"></icon></button>\n      <button class="green upload no-label ui-has-tooltip" data-tooltip="{uploadCSVTooltip}">\n        <icon class="icon-upload"></icon>\n        <input type="file" accept=".csv" />\n      </button>\n      <button class="orange reset no-label ui-has-tooltip" data-tooltip="{clearTooltip}"><icon class="icon-trash"></icon></button>\n    </div>\n\n    ',this.listRowTemplate='\n    <td>\n      <input class="description" type="text" placeholder="{descPlaceholder}" />\n    </td>\n    <td>\n      <input class="code" type="text" placeholder="{codePlaceholder}" />\n    </td>\n    <td>\n      <div class="button blue icon-arrow-up" data-do="up"></div>\n      <div class="button blue icon-arrow-down" data-do="down"></div>\n      <div class="button green icon-plus" data-do="add"></div>\n      <div class="button orange icon-delete" data-do="delete"></div>\n    </td>\n    '}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.Numbers=class{constructor(){["Apply","Remove","_apply","_templates"].bindEach(this)}Apply(e){e?this._apply(e):(document.querySelectorAll(".ui-has-minmax").forEach(this._apply),document.querySelectorAll(".ui-has-integer").forEach(this._apply),document.querySelectorAll(".ui-has-float").forEach(this._apply),document.querySelectorAll(".ui-has-currency").forEach(this._apply),document.querySelectorAll(".ui-has-version").forEach(this._apply))}Remove(e){e.classList.contains("nv")&&e.widgets&&e.widgets.Number&&e.widgets.Number.Destroy&&e.widgets.Number.Destroy()}_apply(e){e.classList.contains("nv")||new Affinity2018.Classes.Plugins.NumberWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.NumberWidget=class{_options(){this.WidgetName="Number",this.WidgetType="none",this.Rounding=["round","ceil","floor","none"],this.type=null,this.InputNode=null,this.decimals=0,this.rounding="round",this.Valid=!0,this.SpecialValidation=!1,this.MaxValue=Number.MAX_SAFE_INTEGER,this.MinValue=0}constructor(e){if(this._options(),["ShowError","HideError","IsValid","disable","enable","_applyEvents","_keyDown","_keyUp","_keyIsOk","_blur","_validate","Destroy"].bindEach(this),Affinity2018.isDomElement(e)){if(this.InputNode=e,this.InputNode.classList.contains("ui-has-integer")&&(this.WidgetType="int",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-integer")),this.InputNode.classList.contains("ui-has-float")&&(this.WidgetType="float",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-float")),this.InputNode.classList.contains("ui-has-currency")&&(this.WidgetType="currency",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-currency")),this.InputNode.classList.contains("ui-has-version")&&(this.WidgetType="version",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-version")),this.InputNode.classList.contains("ui-has-minmax")&&(this.SpecialValidation=!0,this.WidgetType="float",this.type=this.WidgetType,this.MaxValue=isNaN(parseFloat(this.InputNode.dataset.maxValue))?Number.MAX_SAFE_INTEGER:parseFloat(this.InputNode.dataset.maxValue),this.MinValue=isNaN(parseFloat(this.InputNode.dataset.minValue))?Number.MIN_SAFE_INTEGER:parseFloat(this.InputNode.dataset.minValue),this.InputNode.classList.remove("ui-has-minmax"),delete this.InputNode.dataset.maxValue,delete this.InputNode.dataset.minValue),null===this.type)return this.WidgetType="none",this.type=null,void console.error("No valid number type could be found!",this.InputNode);this.InputNode.dataset.decimals&&!isNaN(parseInt(this.InputNode.dataset.decimals))&&(this.decimals=parseInt(this.InputNode.dataset.decimals),delete this.InputNode.dataset.decimals),this.InputNode.dataset.rounding&&this.Rounding.contains(this.InputNode.dataset.rounding.toLowerCase().trim())&&(this.rounding=this.InputNode.dataset.rounding.toLowerCase().trim(),delete this.InputNode.dataset.rounding),this.InputNode.hasOwnProperty("widgets")||(this.InputNode.widgets={}),this.InputNode.widgets.Number=this,this.InputNode.classList.add("nv"),this.ErrorNode=document.createElement("div"),this.ErrorNode.classList.add("ui-form-error"),this.InputNode.parentNode.appendChild(this.ErrorNode),this._applyEvents(),this.disabled=!1}else console.error("No valid element was passed to NumberWidget, dummy!")}IsValid(){return this._validate()}ShowError(e){this.ErrorNode.innerHTML=e,this.ErrorNode.classList.add("show")}HideError(){this.ErrorNode.classList.remove("show")}disable(){this.disabled=!0}enable(){this.disabled=!1}_applyEvents(){this.InputNode.removeEventListener("keydown",this._keyDown),this.InputNode.removeEventListener("keyup",this._keyUp),this.InputNode.removeEventListener("blur",this._blur),this.InputNode.addEventListener("keydown",this._keyDown),this.InputNode.addEventListener("keyup",this._keyUp),this.InputNode.addEventListener("blur",this._blur)}_keyDown(e){var t=e.keyCode||e.key;if(!this._keyIsOk(t,e.shiftKey))return e.stop(),!1}_keyUp(e){if(this.SpecialValidation&&this._validate(e),e.defaultPrevented)return e.stop(),!1}_keyIsOk(e,t){if(this.disabled)return!0;if((e="string"==typeof e?parseInt(e):e)>=48&&e<=57&&!t)return!0;if(e>=96&&e<=105&&!t)return!0;switch(e){case 188:if("int"===this.type)return!1;if("version"===this.type)return!1;if(this.InputNode.value.contains(","))return!1;break;case 190:case 110:if("int"===this.type)return!1;if(("float"===this.type||"currency"===this.type)&&this.InputNode.value.indexOf(".")>-1)return!1;break;case 107:case 187:if(187==e&&!t)return!1;if("version"===this.type)return!1;if(this.InputNode.value.length&&this.InputNode.selectionStart>0)return!1;if(this.InputNode.value.indexOf("+")>-1)return!1;break;case 109:case 189:case 45:if(45===e&&t)return!1;if("version"===this.type)return!1;if(this.InputNode.value.length>0&&0!==this.InputNode.selectionStart)return!1;if(this.InputNode.value.indexOf("-")>-1)return!1;break;case 8:case 9:case 13:case 35:case 36:case 37:case 38:case 39:case 40:case 45:case 46:return!0;default:return!1}return!0}_blur(){if(["float","decimal","currency"].contains(this.type)&&""!==this.InputNode.value.trim()){var e,t=isNaN(parseFloat(this.InputNode.value))?t:parseFloat(this.InputNode.value)+"";if(this.decimals>0)switch(e=10**this.decimals,this.rounding){default:t=Math.round(t*e)/e;break;case"ceil":t=Math.ceil(t*e)/e;break;case"floor":t=Math.floor(t*e)/e;break;case"none":var i=t.toString();i.contains(".")&&(t=parseFloat(i.split(".")[0]+"."+i.split(".")[1].substring(0,this.decimals)))}t="."===t.toString().charAt(0)?"0"+t:t,this.InputNode.value=t,this._validate()}}_validate(e){var t,i=this.InputNode.value.trim(),s=Affinity2018.getParent(this.InputNode,".form-row"),o=!0;this.Valid=!0,this.HideError(),this.InputNode.classList.remove("error"),s&&s.classList.remove("error"),isNaN(parseFloat(i))?(o=!1,t="Value must be a number."):this.SpecialValidation?(parseFloat(i)<this.MinValue||parseFloat(i)>this.MaxValue)&&(o=!1,t="Value must be between "+this.MinValue+" and "+this.MaxValue+"."):(parseFloat(i)<this.MinValue&&(o=!1,t="Value must be greater than or equal to "+this.MinValue+"."),parseFloat(i)>this.MaxValue&&(o=!1,t="Value must be less than or equal to "+this.MaxValue+".")),o||(this.InputNode.classList.add("error"),s&&s.classList.add("error"),this.ShowError(t),this.Valid=!1)}Destroy(){for(var e in this.InputNode.remove("nv"),this.InputNode.remove("error"),this.InputNode.removeEventListener("keydown",this._keyDown),this.InputNode.removeEventListener("keyup",this._keyUp),this.InputNode.removeEventListener("blur",this._blur),this.ErrorNode.innerHTML="",this.ErrorNode.parentNode.removeChild(this.ErrorNode),delete this.InputNode.widgets.Number,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.RequestQueue=class{options(){this.WidgetName="Request",this.requests={},this.status="stopped",this.maxRunning=5,this.maxRetryAttempts=5,this.apiObj={method:"get",url:"",props:{},onSuccess:!1,onFail:!1,priority:-1}}constructor(){this.options(),["Get","Post","Put","Add","Remove","GetKeyFromApi","KeyExists","ApiExists","StartQueue","StopQueue","ClearQueue","Keys","RunningKeys","RunningCount","WaitingKeys","WaitingCount","GetStatus","_add","_remove","_cancelQueuItem","_removeQueItem","_doRequest","_success","_fail"].bindEach(this),this._queueTimer=!1}Get(e,t,i,s){return this._add("get",e,!1,t,i,s)}Post(e,t,i,s,o){return this._add("post",e,t,i,s,o)}Put(e,t,i,s,o){return this._add("put",e,t,i,s,o)}Add(e,t,i,s){if("object"==typeof e&&e.constructor===Object){var o=Object.assign(this.apiObj,e);return this._add(o.method,o.url,o.props,o.onSuccess,o.onFail,o.priority)}return this._add("get",e,!1,t,i,s)}Remove(e,t){this._remove(e,t)}GetKeyFromApi(e,t,i){Affinity2018.isUrl(e)||(e=!1),t=t.trim().toLowerCase()||"get",i="string"==typeof i?JSON.parse(i):"object"==typeof i?i:{};var s=[];if(e&&e.contains("?")&&(s=new URL(e).search.replace("?","").toLowerCase().split("&"),e=e.substring(0,e.indexOf("?")).replace("?","").trim()),i!={})for(var o in i)i.hasOwnProperty(o)&&s.push((o+"="+i[o]).trim().toLowerCase());return s.length>0&&(s.sort(),i=s.join("&")),!!(e=!!e&&(""!==i?e+"?"+i:e))&&(t+"|"+e.toLowerCase().trim().replace(/^https?\:\/\//i,"").replace("www","").replace(/\?\&/g,"_").replace("=","-").replace(/\W/g,"")).trim().toLowerCase()}KeyExists(e){return e&&this.requests.hasOwnProperty(e)}ApiExists(e,t){return this.KeyExists(this.GetKeyFromApi(e,t))}StartQueue(){this._queueTimer&&this.StopQueue();var e,t=this.RunningCount();if(this.status="...",this.status=this.GetStatus(),t<=this.maxRunning)for(e in this.requests)if(this.requests.hasOwnProperty(e)&&0===this.requests[e].status){if(!(t<=this.maxRunning))break;this._doRequest(e)}this._queueTimer||(this._queueTimer=setInterval(this.StartQueue,100))}StopQueue(){this.status="stopped",this._queueTimer&&clearTimeout(this._queueTimer),this._queueTimer=!1}ClearQueue(){for(var e in this.status="stopped",this.requests)this.requests.hasOwnProperty(e)&&this._cancelQueuItem(e);return!0}Keys(){return Object.keys(this.requests)}RunningKeys(){var e=[];for(var t in this.requests)this.requests.hasOwnProperty(t)&&1===this.requests[t].status&&e.push(t);return e}RunningCount(){return this.RunningKeys().length}WaitingKeys(){var e=[];for(var t in this.requests)this.requests.hasOwnProperty(t)&&0===this.requests[t].status&&e.push(t);return e}WaitingCount(){return this.WaitingKeys().length}GetStatus(){return"stopped"===this.status?"stopped":this.RunningCount()>0||this.WaitingCount()>0?"running":"idle"}_add(e,t,i,s,o,a){if(Affinity2018.isUrl(t)){if(e=e.trim().toLowerCase()||"get",s=Affinity2018.isFunctionReturn(s),o=Affinity2018.isFunctionReturn(o),a=a||0,(n=this.GetKeyFromApi(t,e,i))&&s){if(this.KeyExists(n))switch(this.requests[n].status){case 2:s(this.requests[n].data);break;case 1:case 0:this.requests[n].successCallbacks.push(s),o&&this.requests[n].failCallbacks.push(o);break;case-1:o&&o(this.requests[n].error)}else{if("get"===e.toLowerCase().trim()&&i){var n,r=[];for(n in i)i.hasOwnProperty(n)&&r.push(n+"="+encodeURIComponent(i[n]));r.length>0&&(t+=t.contains("?")?"&":"?",t+=r.join("&"))}this.requests[n]={status:0,api:t,data:!1,error:!1,successCallbacks:[],failCallbacks:[],retryAttempts:0,axiosConfig:{method:e,url:(t.includes("?")||t.includes("&")?t+"&ran=":t+"?ran=")+Affinity2018.uuid()},axios:!1,_cancelToken:new axios.CancelToken(this._removeQueItem),_onSuccess:function(e){this._success(n,e)}.bind(this),_onFail:function(e){this._fail(n,e)}.bind(this)},this.requests[n].successCallbacks.push(s),o&&this.requests[n].failCallbacks.push(o),"post"===e.toLowerCase().trim()&&i&&(this.requests[n].axiosConfig.data=i),a>0&&this._doRequest(n)}return"running"!==this.status&&"idle"!==this.status&&this.StartQueue(),n}return!1}o("URL is invalid ("+t+")")}_remove(e,t){t=t.trim().toLowerCase()||"get",e=Affinity2018.isUrlReturn(e);var i=this.GetKeyFromApi(e,t);i&&this._cancelQueuItem(i)}_cancelQueuItem(e){e&&this.KeyExists(e)&&(this.requests[e].successCallbacks=[],this.requests[e].failCallbacks=[],this.requests[e].status=-2,this.requests[e].hasOwnProperty("_cancelToken")&&this.requests[e]._cancelToken.hasOwnProperty("source")&&this.requests[e]._cancelToken.source.hasOwnProperty("cancel")?this.requests[e]._cancelToken.source.cancel(e):this._removeQueItem(e))}_removeQueItem(e){this.KeyExists(e)&&(this.requests[e].successCallbacks=[],this.requests[e].failCallbacks=[],this.requests[e].status=!1,delete this.requests[e])}_doRequest(e){this.KeyExists(e)&&(this.status="running",this.requests[e].status=1,this.requests[e].axios=axios(this.requests[e].axiosConfig).then(function(t){this._success(e,t)}.bind(this)).catch(function(t){this.requests[e].axios.hasOwnProperty("isCancel")&&"function"==typeof this.requests[e].axios.isCancel&&this.requests[e].axios.isCancel(t)||this._fail(e,t)}.bind(this)))}_success(e,t){var i=!1;if(this.requests&&this.requests.hasOwnProperty(e))if(t&&"status"in t&&200===t.status&&"data"in t){var s,o=("string"==typeof t.data?t.data:JSON.stringify(t.data)).trim().toLowerCase().replace(/['"]+/g,"");try{["success:false","unauthorised","unauthorized"].forEach(function(s){if(!i&&o.includes(failStr))return i=!0,this._fail(e,t.data),void("stopped"!==this.status&&this.StartQueue())}.bind(this))}catch(e){}if(i)return;for(this.requests[e].data=t.data,this.requests[e].status=2,s=this.requests[e].successCallbacks.length;s--;)this.requests[e].successCallbacks[s](t.data),this.requests[e].successCallbacks.splice(s,1);this.requests[e].successCallbacks=[],this.requests[e].failCallbacks=[]}else this._fail(e,"unknown axios request failure")}_fail(e,t){if(this.requests&&this.requests.hasOwnProperty(e))if(this.requests[e].retryAttempts++,this.requests[e].retryAttempts>this.maxRetryAttempts){this.requests[e].status=-1,t=t.response?t.response.data+" ("+t.response.status+")":t.request?t.request.responseText+" ("+t.request.status+")":t.error?t.error:t.message,this.requests[e].error=t;for(var i=this.requests[e].failCallbacks.length;i--;)this.requests[e].failCallbacks[i](t),this.requests[e].failCallbacks.splice(i,1);this.requests[e].failCallbacks=[]}else this.requests[e].status=0;"stopped"!==this.status&&this.StartQueue()}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.SelectLookups=class{_options(){this.widgets=[]}constructor(){this._options(),["_init","Apply","Remove","_apply","_templates"].bindEach(this),this._templates(),Affinity2018.UiReady?this._init():window.addEventListener("MainInit",this._init)}_init(){Affinity2018.hasOwnProperty("RequestQueue")||(Affinity2018.RequestQueue=new Affinity2018.Classes.Plugins.RequestQueue)}Apply(e){Affinity2018.isDomElement(e)?this._apply(e):document.querySelectorAll("select.ui-has-lookup").forEach(this._apply)}Remove(e){e.classList.contains("ui-lookup")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("SelectLookup")&&e.widgets.SelectLookup.Destroy()}HideAll(e){var t,i;for(t in this.widgets)this.widgets.hasOwnProperty(t)&&(i=this.widgets[t],"object"==typeof e&&e.hasOwnProperty("uuid")?i.uuid!==e.uuid&&i.hide():i.hide())}_apply(e){Affinity2018.isDomElement(e)&&new Affinity2018.Classes.Plugins.SelectLookupWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.SelectLookupWidget=class extends Affinity2018.ClassEvents{_options(){this.WidgetName="SelectLookup",this.api=!1,this.useRequestQueue=!0,this.makeAutocomplete=!0,this.request=!1,this.DefaultConfig={DataKey:"Key",DisplayKey:"Value",IncludeDataInDisplay:!0,AddEmpty:!1,EmptyKey:"",EmptyDisplay:"",Filters:[]}}constructor(e,t,i){if(super(),this._options(),["_init","_gotResults","_gotResultsError","_requestCanceled","_clear","_processResults","_insertResult","_cleanValue","_processFilters","_insertFilter","_filterToggled","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){if((e.classList.contains("ui-has-autocomplete")||e.classList.contains("do-autocomplete"))&&(this.makeAutocomplete=!0,e.classList.remove("ui-has-autocomplete","do-autocomplete"),e.classList.add("prevent-autocomplete")),this.targetNode=e,this.api=$a.isUrl(t)?t.trim():!!$a.isUrl(this.targetNode.dataset.api)&&this.targetNode.dataset.api.trim(),!this.api)return console.error("No valid api path was passed to SelectLookupWidget, dummy!"),void console.error(this.targetNode);this.config=$a.isObject(i)?i:!!$a.isString(this.targetNode.dataset.config)&&JSON.parse(this.targetNode.dataset.config),$a.isObject(this.config)?this.config=$a.objectDeepMerge([$a.jsonCloneObject(this.DefaultConfig),this.config]):this.config=$a.jsonCloneObject(this.DefaultConfig),delete this.targetNode.dataset.config,this.targetNode.hasOwnProperty("widgets")||(this.targetNode.widgets={}),this.targetNode.widgets.SelectLookup=this,this.uuid=this.targetNode.id?this.targetNode.id:Affinity2018.uuid(),Affinity2018.hasOwnProperty("SelectLookups")&&!Affinity2018.SelectLookups.widgets.hasOwnProperty(this.uuid)&&(Affinity2018.SelectLookups.widgets[this.uuid]=this),this.targetNode.classList.remove("ui-has-lookup"),this.targetNode.classList.add("ui-lookup"),this.makeAutocomplete&&this.targetNode.classList.add("prevent-autocomplete"),this._init()}else console.error("No valid element was passed to SelectLookupWidget, dummy!")}_init(){this.targetNode.classList.add("working"),this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("select")&&this.targetNode.parentNode.classList.add("working"),this.useRequestQueue&&Affinity2018.RequestQueue?(Affinity2018.RequestQueue.Add(this.api,this._gotResults,this._gotResultsError),Affinity2018.RequestQueue.StartQueue()):(this.request&&this.request.hasOwnProperty("cancelToken")&&this.request.cancelToken.source.cancel(!0),this.request=axios({method:"get",url:this.api,cancelToken:new axios.CancelToken(this._requestCanceled)}).then(this._gotResults).catch(this._gotResultsError))}_gotResults(e){if(e){if(Affinity2018.isObject(e)&&e.hasOwnProperty("status")&&200===e.status){if(e.hasOwnProperty("data")&&Affinity2018.isPropArray(e,"data"))return void this._processResults(e.data);if(e.hasOwnProperty("results")&&Affinity2018.isPropArray(e,"results"))return void this._processResults(e.results)}if(Affinity2018.isArray(e))return void this._processResults(e)}this._gotResultsError("The lookup did not return usable data.")}_gotResultsError(e){var t=(t=(t=e||"Unknown reason ("+url+")").contains("<!DOCTYPE html>")?t.substring(0,t.indexOf("<!DOCTYPE html>")):t).contains("<html>")?t.substring(0,t.indexOf("<html")):t;Affinity2018.LogError("Lookup Error","Important",'Request failed on "'+this.api+'" ('+t.trim()+")."),this.targetNode.classList.remove("working"),this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("select")&&this.targetNode.parentNode.classList.remove("working")}_requestCanceled(){this.request=!1}_clear(){this.targetNode.innerHTML=""}_processResults(e){if(this._clear(),this.insertCount=0,this.hasSelected=!1,Array.isArray(e)){var t=0;if(this.config.AddEmpty){this.hasSelected=!1;var i={Selected:!0};i[this.config.DataKey]=this.config.EmptyKey,i[this.config.DisplayKey]=this.config.EmptyDisplay,this._insertResult(i)}for(;t<e.length;t++)this._insertResult(e[t])}this._processFilters(),this.makeAutocomplete&&Affinity2018.Autocompletes&&(this.targetNode.classList.remove("prevent-autocomplete"),Affinity2018.Autocompletes.Apply(this.targetNode)),this.targetNode.classList.remove("working"),this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("select")&&this.targetNode.parentNode.classList.remove("working")}_insertResult(e){var t=document.createElement("option"),i=this._cleanValue(e[this.config.DisplayKey],e[this.config.DataKey]);if(""!==i.trim()){if(t.innerHTML=i,t.value=e[this.config.DataKey],this.hasSelected||this.config.Value!==e[this.config.DataKey]||(t.selected=!0,this.targetNode.selectedIndex=this.insertCount,this.hasSelected=!0),!this.hasSelected&&$a.isPropBool(e,"Selected")&&!0===e.Selected&&(t.selected=!0,this.targetNode.selectedIndex=this.insertCount,this.hasSelected=!0),this.config.Filters.length>0)for(var s,o=0;o<this.config.Filters.length;o++)s=this.config.Filters[o],this._filterDataOk(s)&&e.hasOwnProperty(s.Key)&&e[s.Key]===s.FilterEndabldeValue&&(t.dataset[s.Key]=e[s.Key],t.dataset.filterCss=s.StartEnabled?s.FitlerEnabledCss:s.FilterDisabledCss);return this.targetNode.appendChild(t),this.insertCount++,!0}return!1}_processFilters(){if(this.config.Filters.length>0)for(var e=0;e<this.config.Filters.length;e++)this._insertFilter(this.config.Filters[e],e);return!0}_insertFilter(e,t){if(this._filterDataOk(e)){var i=document.createElement("div");i.classList.add("select-filter","check-label-pair"),i.dataset.index=t,i.innerHTML=this.FilterTemplate,i.querySelector("input").setAttribute("id",e.Key+"Filter"),i.querySelector("label").setAttribute("for",e.Key+"Filter"),i.querySelector("label").innerHTML=e.Name,i.querySelector("input").addEventListener("change",this._filterToggled),e.StartEnabled&&(i.querySelector("input").checked=!0,this._filterToggled({target:i}))}var s=this.targetNode.parentNode&&this.targetNode.parentNode.classList.contains("select")?this.targetNode.parentNode:this.targetNode;s.nextSibling?s.parentNode.insertBefore(i,s.nextSibling):s.parentNode.appendChild(i)}_filterToggled(e){var t,i,s,o=!1,a=-1;"target"in e&&$a.isDomElement(e.target)&&(o=e.target.classList.contains("select-filter")?e.target:e.target.closest(".select-filter"),t=parseInt(o.dataset.index),i=this.config.Filters[t],this._filterDataOk(i)&&(this.targetNode.querySelectorAll("option").forEach(function(e,t){e&&e.dataset[i.Key]?(s=e.dataset[i.Key],"string"===$a.type(s)&&("number"!==$a.type(i.FilterEndabldeValue)||isNaN(parseFloat(s))||(s=parseFloat(s)),"boolean"===$a.type(i.FilterEndabldeValue)&&["true","false"].contains(s.trim().toLowerCase())&&(s="true"===s.trim().toLowerCase()||"false"!==s.trim().toLowerCase()&&s)),s===i.FilterEndabldeValue&&(o.querySelector("input").checked?(-1===a&&!0===i.VisibleWhenEnabled&&(a=t),e.dataset.filterCss=i.FitlerEnabledCss):(-1===a&&!0===i.VisibleWhenDisabled&&(a=t),e.dataset.filterCss=i.FilterDisabledCss))):-1===a&&(a=t)}.bind(this)),-1===a&&(a=0),this.targetNode.selectedIndex=a,this.targetNode.value=this.targetNode.querySelectorAll("option")[a].value,this.targetNode.widgets.Autocomplete&&this.targetNode.widgets.Autocomplete.refreshFromSelect()))}_filterDataOk(e){return!!($a.isObject(e)&&$a.isPropString(e,"Key")&&""!==e.Key.trim()&&$a.isPropString(e,"Name")&&""!==e.Name.trim()&&$a.isPropBool(e,"StartEnabled")&&e.hasOwnProperty("FilterEndabldeValue")&&$a.isPropString(e,"FitlerEnabledCss")&&$a.isPropString(e,"FilterDisabledCss"))}_cleanValue(e,t){var i,s=e&&"string"==typeof e&&""!==e.trim()?e.trim():"",o=t&&"string"==typeof t&&""!==t.trim()?t.trim():"number"==typeof t?(t+"").trim():"";return""!==e?(i=(s=e.trim().replace(/&amp;/gi,"&")).charAt(s.length-1),[",","-","_",":"].contains(i)&&(s=s.substring(0,s.length-1).trim()),this.config.IncludeDataInDisplay&&(""===o||s.contains(o)||(s=s+" ("+o+")"))):s=""!==o?"Not Set - ("+t+")":"",s}Destroy(){for(var e in this.targetNode.classList.remove("ui-lookup"),this.targetNode.parentNode.querySelectorAll(".select-filter").forEach((function(e){e.querySelector("input").removeEventListener("change",this._filterToggled),e.parentNode.removeChild(e)})),this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.FilterTemplate='<input type="checkbox"><label></label>'}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.Strings=class{constructor(){["Apply","Remove","_apply","_templates"].bindEach(this)}Apply(e){e?this._apply(e):(document.querySelectorAll(".ui-has-length").forEach(this._apply),document.querySelectorAll(".ui-has-string").forEach(this._apply),document.querySelectorAll(".ui-has-sentence").forEach(this._apply),document.querySelectorAll(".ui-has-alphanumeric").forEach(this._apply),document.querySelectorAll(".ui-has-email").forEach(this._apply),document.querySelectorAll(".ui-has-url").forEach(this._apply))}Remove(e){e.classList.contains("sv")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("String")&&e.widgets.String.Destroy()}_apply(e){new Affinity2018.Classes.Plugins.StringWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.StringWidget=class{_options(){this.WidgetName="String",this.WidgetType="none",this.type=null,this.InputNode=null,this.Valid=!1,this.MaxLength=Number.MAX_SAFE_INTEGER,this.MinLength=0}constructor(e){if(this._options(),["ShowError","HideError","IsValid","_applyEvents","_isRequired","_stopEvents","_validate","Destroy"].bindEach(this),$a.isDomElement(e)){if(this.InputNode=e,this.InputNode.classList.contains("ui-has-string")&&(this.WidgetType="string",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-string")),this.InputNode.classList.contains("ui-has-sentence")&&(this.WidgetType="sentence",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-sentence")),this.InputNode.classList.contains("ui-has-alphanumeric")&&(this.WidgetType="alphanumeric",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-alphanumeric")),this.InputNode.classList.contains("ui-has-email")&&(this.WidgetType="email",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-email")),this.InputNode.classList.contains("ui-has-url")&&(this.WidgetType="url",this.type=this.WidgetType,this.InputNode.classList.remove("ui-has-url")),this.InputNode.classList.contains("ui-has-length")&&(this.type=this.WidgetType,this.MaxLength=isNaN(parseFloat(this.InputNode.dataset.maxLength))?Number.MAX_SAFE_INTEGER:parseFloat(this.InputNode.dataset.maxLength),this.MinLength=isNaN(parseFloat(this.InputNode.dataset.minLength))?0:parseFloat(this.InputNode.dataset.minLength),this.InputNode.classList.remove("ui-has-length"),delete this.InputNode.dataset.maxLength,delete this.InputNode.dataset.minLength),null===this.type)return this.WidgetType="none",this.type=null,void console.error("No valid string type could be found!",this.InputNode);this.InputNode.hasOwnProperty("widgets")||(this.InputNode.widgets={}),this.InputNode.widgets.String=this,this.InputNode.classList.add("sv"),this.ErrorNode=document.createElement("div"),this.ErrorNode.classList.add("ui-form-error"),this.InputNode.parentNode.appendChild(this.ErrorNode),this._applyEvents()}else console.error("No valid element was passed to StringWidget, dummy!")}IsValid(){return this._validate()}ShowError(e){this.ErrorNode.innerHTML=e,this.ErrorNode.classList.add("show")}HideError(){this.ErrorNode.classList.remove("show")}_applyEvents(){this.InputNode.removeEventListener("keyup",this._validate),this.InputNode.removeEventListener("blur",this._validate),this.InputNode.addEventListener("keyup",this._validate),this.InputNode.addEventListener("blur",this._validate)}_isRequired(){var e=Affinity2018.getParent(this.InputNode,".form-row");return!(!(this.InputNode.classList.contains("required")||e&&e.classList.contains("required"))||this.InputNode.classList.contains("required-override"))}_validate(e){var t,i,s=this.InputNode.value.trim(),o=Affinity2018.getParent(this.InputNode,".form-row"),a=e&&"keyup"===e.type?"keyboard":"none",n=!1,r=this._isRequired();switch(this.Valid=!0,this.HideError(),this.InputNode.classList.remove("error"),o&&o.classList.remove("error","error2"),this.type){case"string":t=/^[A-Za-z0-9_\-.]+$/g,i=$a.Lang.ReturnPath("generic.validation.strings.string"),n=!0;break;case"sentence":case"sentance":t=/^[a-zA-Z0-9_\-.,:;'\"!?@#$%\*\/\\|()\s]*$/g,i=$a.Lang.ReturnPath("generic.validation.strings.sentence"),n=!0;break;case"alphanumeric":t=/^[a-zA-Z0-9_\-.,:'!?$%\*\/\\|\s]+$/g,i=$a.Lang.ReturnPath("generic.validation.strings.alphanumeric"),n=!0;break;case"email":t=/^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/,i=$a.Lang.ReturnPath("generic.validation.strings.email");break;case"url":t=/^((ft|htt)ps?:\/\/)?((([a-z\d]([a-z\d-]*[a-z\d])*)\.)+[a-z]{2,}|(localhost)|((\d{1,3}\.){3}\d{1,3}))(\:\d+)?(\/[-a-z\d%@_.~+&:]*)*(\?[;&a-z\d%@_.,~+&:=-]*)?(\#[-a-z\d_]*)?$/gi,i=$a.Lang.ReturnPath("generic.validation.strings.url")}var l=!0;if(this["_"+this.type+"Test"]&&"function"==typeof this["_"+this.type+"Test"]?""!==s&&this["_"+this.type+"Test"](s,t)&&(l=!0):""===s||new RegExp(t).test(s)||(l=!1),""===s&&r&&(l=!1),(s.length<this.MinLength||s.length>this.MaxLength)&&(l=!1,n=!1,i=1===this.MinLength||0===this.MinLength||this.MinLength===Number.MIN_SAFE_INTEGER?"This must be shorter than "+(this.MaxLength+1)+" character(s)":"This must be between "+this.MinLength+" and "+this.MaxLength+" characters long."),l||(this.InputNode.classList.add("error"),o&&!this.InputNode.classList.contains("no-row-error")&&o.classList.add("error"),o&&!this.InputNode.classList.contains("no-row-error")&&n&&o.classList.add("error2"),this.ShowError(i),this.Valid=!1),"url"===this.type&&"keyboard"!==a&&this.Valid&&""!==s){var d=$a.returnFormattedUrl(s);d!==s&&(this.InputNode.value=d)}return this.Valid}_urlTest(e,t){if(""===e)return!0;var i,s=$a.returnFormattedUrl(e);if(!Affinity2018.Browser.isie||Affinity2018.Browser.isie&&Affinity2018.Browser.major>11){try{i=new URL(s)}catch(e){return!1}return["http:","https:","ftp:","sftp:","mailto:","callto:"].contains(i.protocol.toLowerCase())}return!!new RegExp(t).test(s)}Destroy(){for(var e in this.InputNode.remove("sv"),this.InputNode.remove("error"),this.InputNode.removeEventListener("keyup",this._validate),this.InputNode.removeEventListener("blur",this._validate),this.ErrorNode.innerHTML="",this.ErrorNode.parentNode.removeChild(this.ErrorNode),delete this.InputNode.widgets.String,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}},"Affinity2018"in window||(Affinity2018={}),"Classes"in Affinity2018||(Affinity2018.Classes={}),"Plugins"in Affinity2018.Classes||(Affinity2018.Classes.Plugins={}),"Apps"in Affinity2018||(Affinity2018.Apps={}),"Plugins"in Affinity2018.Apps||(Affinity2018.Apps.Plugins={}),Affinity2018.Classes.Plugins.TaxNumber=class{options(){}constructor(){this.options(),["Apply","Remove","_apply","_templates"].bindEach(this),this._templates()}Apply(e){null!=e?this._apply(e):document.querySelectorAll(".ui-has-taxnumber").forEach(this._apply)}Remove(e){e.classList.contains("ui-taxnumber")&&e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("TaxNumber")&&e.widgets.TaxNumber.Destroy()}_apply(e){new Affinity2018.Classes.Plugins.TaxNumberWidget(e)}_templates(){}},Affinity2018.Classes.Plugins.TaxNumberWidget=class{_options(){this.WidgetName="TaxNumber",this.CountryCodes=["AU","NZ"],this.DefaultCountryCode="AU",this.CountryCodeMap={A:"AU",N:"NZ"},this.lastCodes={NZ:"",AU:""},this.hasPayPoint=!1,this.PayPoint=!1,this.Valid=!1,this.pasting=!1}constructor(e){if(this._options(),["Get","GetData","Set","SetCountry","Clear","_clear","_stringToNodes","_stringFromNodes","_getCountryCode","_setupCountry","_setIcon","_userKey","_userKeyUp","_userValidate","_validate","Destroy","_templates"].bindEach(this),this._templates(),Affinity2018.isDomElement(e)){var t=e.value.trim(),i=!0;e.classList.remove("ui-has-taxnumber"),e.classList.add("ui-taxnumber","no-validate"),this.initInputNode=e,this.initInputNode.type="hidden",this.initInputNode.hasOwnProperty("widgets")||(this.initInputNode.widgets={}),this.initInputNode.widgets.TaxNumber=this,this.taxnumberNode=document.createElement("div"),this.taxnumberNode.classList.add("taxnumber-box","nz"),this.taxnumberNode.innerHTML=this.template,this.countryNode=this.taxnumberNode.querySelector(".select"),this.countrySelectNode=this.taxnumberNode.querySelector("select.country"),this.input1Node=this.taxnumberNode.querySelector("input.tax1"),this.input2Node=this.taxnumberNode.querySelector("input.tax2"),this.input3Node=this.taxnumberNode.querySelector("input.tax3"),this.iconNode=this.taxnumberNode.querySelector(".tickcross"),this.initInputNode.dataset.country&&(this.CountryCodes.contains(this.initInputNode.dataset.country.trim().toUpperCase())&&(this.countrySelectNode.value=this.initInputNode.dataset.country.trim().toUpperCase()),delete this.initInputNode.dataset.country),this.initInputNode.dataset.countryStatus&&("hide"===this.initInputNode.dataset.countryStatus.trim().toLowerCase()&&(i=!1),delete this.initInputNode.dataset.countryStatus),i&&(this.countryNode.classList.remove("hidden"),this.countryNode.addEventListener("change",this._setupCountry),this._setupCountry()),this.taxnumberNode.querySelectorAll('input[type="text"]').forEach(function(e){e.addEventListener("keydown",this._userKey),e.addEventListener("keyup",this._userKeyUp),e.addEventListener("blur",this._userValidate)}.bind(this)),this.initInputNode.parentNode.insertBefore(this.taxnumberNode,this.initInputNode.nextSibling),Affinity2018.Apps.Plugins.hasOwnProperty("Numbers")&&Affinity2018.Apps.Plugins.Numbers.Apply(),""!==t?this.Set(t):this._validate(),this.initInputNode.dispatchEvent(new CustomEvent("widgetReady"))}else console.error("No valid element was passed to TaxNumberWidget, dummy!")}Get(){return this.initInputNode.value=this._stringFromNodes(),this.initInputNode.value}GetData(){return[this.Get(),this.countrySelectNode.value]}Set(e){var t=this._getCountryCode();if($a.isArray(e)&&2===e.length&&(e=e[1]+","+e[0]),$a.isString(e)||(e=e.toString().trim()),"null"===e.toLowerCase()&&(e=""),"null,null"===e.toLowerCase()&&(e=""),e.contains(",")&&(t=e.split(",")[0],e=e.split(",")[1]),1===t.length&&(t=this.CountryCodeMap[t]),""!==e.trim()){if(!e.contains("-")){var i=[0,0,0];i[2]=e.substr(e.length-3).trim(),i[1]=e.replace(i[2],"").substr(e.replace(i[2],"").length-3).trim(),i[0]=e.replace(i[2],"").replace(i[1],"").trim(),e=i.join("-")}this.initInputNode.value=e,this.SetCountry(t),this._stringToNodes(e),this.lastCodes.hasOwnProperty(t)&&(this.lastCodes[t]=e)}else this.initInputNode.value="",this.SetCountry(t),this._stringToNodes(""),this.lastCodes.hasOwnProperty(t)&&(this.lastCodes[t]="")}SetCountry(e){this.CountryCodes.contains(e)&&(this.countrySelectNode.value=e,this._setupCountry()),this.CountryCodeMap.hasOwnProperty(e)&&(this.countrySelectNode.value=this.CountryCodeMap[e],this._setupCountry())}Clear(){this._clear()}_clear(){this.input1Node.value="",this.input2Node.value="",this.input3Node.value="",this._setIcon()}_stringToNodes(e){var t,i;if(""===(e=(e="string"==typeof e?e:this.initInputNode.value).replace(/\s/g,"")).trim())return this.input1Node.value="",this.input2Node.value="",this.input3Node.value="",void this._validate();1===e.countString(",")&&(2===(t=e.split(","))[1].length&&isNaN(parseFloat(t[1]))&&(this.countrySelectNode.value=t[1]),e=t[0]),i=e.split("-"),this.input1Node.value=i[0],this.input2Node.value=i[1],this.input3Node.value=i[2],this._validate()}_stringFromNodes(){var e=this.input1Node.value+"-"+this.input2Node.value+"-"+this.input3Node.value;return"-"===(e=(e=e.replace(/\s/g,"")).replace(/\-\-/g,"-"))[e.length-1]&&(e=e.substring(0,e.length-1)),"-"===e[0]&&(e=e.substring(1)),e}_getCountryCode(){try{return"-1"!==this.countrySelectNode.selectedIndex?this.countrySelectNode.options[this.countrySelectNode.selectedIndex].value:this.countrySelectNode.value}catch(e){}return"NZ"}_setupCountry(){this._clear();var e=this._getCountryCode();this.lastCodes.hasOwnProperty(e)&&""===this.Get().trim()&&""!==this.lastCodes[e].trim()&&this._stringToNodes(this.lastCodes[e]),this.initInputNode.dispatchEvent(new CustomEvent("countryChanged",{detail:{Country:e}}))}_setIcon(e){var t="reset";switch("boolean"==typeof e&&!0===e&&(t="valid"),"boolean"==typeof e&&!1===e&&(t="invalid"),this.iconNode.classList.remove("green","icon-tick","red","icon-cross","grey","icon-blocked"),t){case"valid":this.iconNode.classList.add("green","icon-tick");break;case"invalid":this.iconNode.classList.add("red","icon-cross");break;default:this.iconNode.classList.add("grey","icon-blocked")}}_userKey(e){e.target===this.input1Node&&e.ctrlKey&&86===e.keyCode&&(this.taxLimit=parseInt(this.input1Node.getAttribute("maxLength")),this.input1Node.widgets&&this.input1Node.widgets.Number&&this.input1Node.widgets.Number.disable(),this.input1Node.setAttribute("maxLength",15),this.pasting=!0)}_userKeyUp(e){if(this.pasting&&e&&e.target===this.input1Node){var t=this.input1Node.value.trim(),i=t.replace(/[^0-9]/gi,"").trim();this.input1Node.setAttribute("maxLength",this.taxLimit),this.input1Node.value=i.substring(0,this.taxLimit),this.input1Node.widgets&&this.input1Node.widgets.Number&&this.input1Node.widgets.Number.enable(),i.length>7&&this._stringToNodes(t),this.initInputNode.value=this._stringFromNodes()}this.pasting||e.shiftKey||"Tab"===e.key||"Shift"===e.key||(e.target===this.input1Node&&this.input1Node.value.trim().length===parseInt(this.input1Node.getAttribute("maxLength"))&&this.input2Node.focus(),e.target===this.input2Node&&this.input2Node.value.trim().length===parseInt(this.input2Node.getAttribute("maxLength"))&&this.input3Node.focus()),this.pasting=!1,this.initInputNode.value=this._stringFromNodes(),this.lastCodes.hasOwnProperty(this._getCountryCode())&&(this.lastCodes[this._getCountryCode()]=this.initInputNode.value),this._userValidate()}_userValidate(){clearTimeout(this._userValidateDelay),this._userValidateDelay=setTimeout(this._validate,500)}_validate(){this.Valid=!1;var e=null,t=null;if(window.hasOwnProperty("Affinity2018")&&Affinity2018.isPropObject(Affinity2018,"UserProfile")&&Affinity2018.isPropString(Affinity2018.UserProfile,"EmployeeNumber")&&""!==Affinity2018.UserProfile.EmployeeNumber.trim()&&Affinity2018.isPropObject(Affinity2018,"ApiEndpoints")&&Affinity2018.isPropString(Affinity2018.ApiEndpoints,"TaxValidationApi")&&""!==Affinity2018.ApiEndpoints.TaxValidationApi.trim())if(e=Affinity2018.ApiEndpoints.TaxValidationApi+"",t=Affinity2018.UserProfile.EmployeeNumber+"",""!=this._getCountryCode()){var i=new FormData;i.append("EmployeeNo",t),i.append("TaxNumber",this._stringFromNodes().replace(/\-/g,"")),i.append("CountryCode",this._getCountryCode()),axios({method:"POST",url:e,data:i}).then(function(e){"object"==typeof e&&e.hasOwnProperty("data")&&e.data.hasOwnProperty("success")&&"boolean"==typeof e.data.success&&(this.Valid=e.data.success,this._validated(e.data))}.bind(this)).catch(function(e){this._validated()}.bind(this))}else this._setIcon()}_validated(e){this._setIcon(this.Valid),"object"==typeof e&&e.hasOwnProperty("bankName")&&e.hasOwnProperty("branchName")&&(this.bankNameNode.innerHTML="failed"!==e.bankName?e.bankName:"",this.branchNameNode.innerHTML="failed"!==e.branchName?e.branchName:"")}Destroy(){for(var e in clearTimeout(this._userValidateDelay),this.initInputNode.hasOwnProperty("widgets")&&this.initInputNode.widgets.hasOwnProperty("String")&&this.initInputNode.widgets.String.Destroy(),this.initInputNode.hasOwnProperty("widgets")&&this.initInputNode.widgets.hasOwnProperty("Number")&&this.initInputNode.widgets.Number.Destroy(),this.countryNode.removeEventListener("change",this._setupCountry),this.taxnumberNode.querySelectorAll('input[type="text"]').forEach(function(e){e.removeEventListener("keydown",this._userKey),e.removeEventListener("keyup",this._userValidate),e.removeEventListener("blur",this._userValidate),e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("String")&&e.widgets.String.Destroy(),e.hasOwnProperty("widgets")&&e.widgets.hasOwnProperty("Number")&&e.widgets.Number.Destroy()}.bind(this)),this.initInputNode.type="text",this.initInputNode.classList.remove("ui-taxnumber"),this.taxnumberNode.innerHTML="",this.taxnumberNode.parentNode.removeChild(this.taxnumberNode),delete this.initInputNode.widgets.TaxNumber,this)this.hasOwnProperty(e)&&(this[e]=null,delete this[e])}_templates(){this.template='\n    <div class="select hidden">\n      <select class="country">\n        <option value="AU" selected>AU</option>\n        <option value="NZ">NZ</option>\n      </select>\n    </div>\n    <input class="tax1 ui-has-integer" type="text" maxlength="3">\n    <span> - </span>\n    <input class="tax2 ui-has-integer" type="text" maxlength="3">\n    <span> - </span>\n    <input class="tax3 ui-has-integer" type="text" maxlength="3">\n    <span class="tickcross grey icon-blocked"></span>\n    '}};