var doc,File,saveAs;if("Affinity"in window||(window.Affinity={}),"Components"in Affinity||(Affinity.Components={}),Affinity.started=(new Date).getTime(),Affinity.views={},Affinity.Components.Commons={},Affinity.Components.Commons.Version="6.0.34.2",Affinity.Components.Commons.Sequence=30,Affinity.Components.Commons.Name="UI Framework Commons",Affinity.Components.Commons.File="commons.6.0.0.js",Affinity.Components.Commons.Jira="",Affinity.Components.Commons.Notes="Add Affinity.IsElement method",Affinity.Components.MooTools={},Affinity.Components.MooTools.Version="1.6.0",Affinity.Components.MooTools.Sequence=10,Affinity.Components.MooTools.Name="MooTools Core",Affinity.Components.MooTools.File="MooTools-Core-1.6.0.js",Affinity.Components.MooTools.Jira="",Affinity.Components.MooTools.Notes="",Affinity.Components.MoreTools={},Affinity.Components.MoreTools.Version="1.6.0",Affinity.Components.MoreTools.Sequence=20,Affinity.Components.MoreTools.Name="MooTools More",Affinity.Components.MoreTools.File="MooTools-More-1.6.0.js",Affinity.Components.MoreTools.Jira="",Affinity.Components.MoreTools.Notes="",typeof console=="undefined"&&(console={log:function(){}}),typeof MooTools=="undefined")throw new ReferenceError("This site requires MooTools 1.6.0 and MooTools.More 1.6.0");doc=document.documentElement,doc.setAttribute("data-useragent",navigator.userAgent),"events"in Affinity||(Affinity.events={}),Affinity.mobile=!1,Affinity.events={over:"mouseover",out:"mouseout",overAll:"mouseenter",outAll:"mouseleave",start:"mousedown",move:"mousemove",end:"mouseup",click:"click"},Affinity.colors={green:"#7abd2d",blue:"#44b5ec",lightblue:"#e3eef3",orange:"#ff6600",yellow:"#ffbd00",red:"#ff0000",grey:"#888888"},Affinity.icons={AddToList:"&#xe096;",Adobe:"&#xe91c;",Air:"&#xe047;",Alarm:"&#xe855;",AlarmAdd:"&#xe856;",AppAddRow:"&#xe91b;",AppFilter:"&#xe919;",AppGridAdd:"&#xe91a;",AppHelp:"&#xe918;",AppReport:"&#xe917;",AppShare:"&#xe916;",Archive:"&#xe0a2;",ArrowDown:"&#xe0c0;",ArrowDownCircle:"&#xe0c8;",ArrowDownSmall:"&#xe0c4;",ArrowLeft:"&#xe0bf;",ArrowLeftCircle:"&#xe0c7;",ArrowLeftSmall:"&#xe0c3;",ArrowLineBigDown:"&#xe0d8;",ArrowLineBigLeft:"&#xe0d7;",ArrowLineBigRight:"&#xe0da;",ArrowLineBigUp:"&#xe0d9;",ArrowLineDown:"&#xe0d0;",ArrowLineLeft:"&#xe0cf;",ArrowLineRight:"&#xe0d2;",ArrowLineSmallDown:"&#xe0d4;",ArrowLineSmallLeft:"&#xe0d3;",ArrowLineSmallRight:"&#xe0d6;",ArrowLineSmallUp:"&#xe0d5;",ArrowLineUp:"&#xe0d1;",ArrowLongDown:"&#xe0dc;",ArrowLongLeft:"&#xe0db;",ArrowLongRight:"&#xe0de;",ArrowLongUp:"&#xe0dd;",ArrowRight:"&#xe0c2;",ArrowRightCircle:"&#xe0ca;",ArrowRightSmall:"&#xe0c6;",ArrowUp:"&#xe0c1;",ArrowUpCircle:"&#xe0c9;",ArrowUpSmall:"&#xe0c5;",ArrowheadDown:"&#xe0cc;",ArrowheadLeft:"&#xe0cb;",ArrowheadRight:"&#xe0ce;",ArrowheadUp:"&#xe0cd;",ArrowheadUpDown:"&#xe0df;",Back:"&#xe093;",Bag:"&#xe03b;",Barcode:"&#xe0fc;",Battery:"&#xe04d;",Bell:"&#xe029;",Blocked:"&#xe084;",Book:"&#xe039;",Book2:"&#xe0ac;",Bookmark:"&#xe0aa;",Bookmarks:"&#xe0ab;",Box:"&#xe06a;",Braces:"&#xe104;",Break:"&#xe90f;",BreakAdd:"&#xe910;",BreakRemove:"&#xe940;",BreakUp:"&#xe941;",BreakDown:"&#xe942;",Briefcase:"&#xe046;",Brightness:"&#xe060;",BrogressThird:"&#xe05c;",Browser:"&#xe058;",Brush:"&#xe053;",Bucket:"&#xe04e;",BulletList:"&#xe095;",CalView:"&#xe911;",Calendar:"&#xe041;",Camera:"&#xe030;",Cancel:"&#xe083;",Car:"&#xe909;",Cart:"&#xe069;",Cc:"&#xe0e3;",CcBy:"&#xe0e4;",CcNc:"&#xe0e5;",CcNcEu:"&#xe0e6;",CcNcJp:"&#xe0e7;",CcNd:"&#xe0e9;",CcPd:"&#xe0ea;",CcSa:"&#xe0e8;",CcShare:"&#xe0ec;",CcShare3:"&#xe0ed;",CcZero:"&#xe0eb;",Ccw:"&#xe08c;",Cd:"&#xe045;",Chat:"&#xe021;",Cleverforms:"&#xe939;",CleverformsAdmin:"&#xe93a;",CleverformsDesigner:"&#xe93c;",CleverformsFlow:"&#xe93b;",Clipboard:"&#xe068;",Clock:"&#xe03f;",Cloud:"&#xe0a8;",Code:"&#xe061;",CodeA:"&#xe0ee;",CodeD:"&#xe0f0;",CodeH:"&#xe0ef;",CodeM:"&#xe10e;",CodeP:"&#xe10f;",CodeR:"&#xe0f1;",CodeS:"&#xe0f2;",Cog:"&#xe02c;",Comment:"&#xe022;",CommsHangouts:"&#xe933;",CommsMsteams:"&#xe931;",CommsSkype:"&#xe930;",CommsSlack:"&#xe932;",Compare:"&#xe103;",Compass:"&#xe016;",Cone:"&#xe055;",CreditCard:"&#xe065;",Cross:"&#xe07a;",CrossRound:"&#xe080;",CrossSquare:"&#xe07d;",Csharp:"&#xe0ff;",Cup:"&#xe051;",Cw:"&#xe08b;",Cycle:"&#xe08a;",Database:"&#xe066;",DetailView:"&#xe913;",Directions:"&#xe005;",Docs:"&#xe09c;",DollarRound:"&#xe0fe;",Dot:"&#xe0e2;",Dots:"&#xe0e1;",DotsVert:"&#xe000;",Download:"&#xe0a5;",Drive:"&#xe050;",Droplet:"&#xe044;",Droplets:"&#xe06f;",Earth:"&#xe056;",Education:"&#xe038;",Eightball:"&#xe901;",Ellipsis:"&#xe0e0;",EmptyInbox:"&#xe00b;",Export:"&#xe013;",Extension:"&#xe87b;",Eye:"&#xe03e;",Feather:"&#xe009;",FieldEdit:"&#xe001;",File:"&#xe91d;",FileEdit:"&#xe91e;",FileExcel:"&#xe922;",FileExcelOld:"&#xe908;",FilePdf:"&#xe920;",FilePdfOld:"&#xe902;",FilePowerpoint:"&#xe923;",FileUser:"&#xe93f;",FileView:"&#xe91f;",FileWord:"&#xe921;",FileWordOld:"&#xe907;",First:"&#xe0b3;",Flag:"&#xe02b;",Flashlight:"&#xe027;",FlowBranch:"&#xe0bb;",FlowCascade:"&#xe0ba;",FlowLine:"&#xe0bd;",FlowParallel:"&#xe0be;",FlowTree:"&#xe0bc;",Folder:"&#xe0a1;",Forward:"&#xe00e;",Gauge:"&#xe049;",Ghost:"&#xe0fa;",Gift:"&#xe105;",Google:"&#xe926;",GoogleDrive:"&#xe928;",GoogleMaps:"&#xe927;",GoogleTranslate:"&#xe929;",GraphBars:"&#xe073;",GraphLinefill:"&#xe074;",GraphPie:"&#xe072;",GraphStatistics:"&#xe071;",Grid:"&#xe070;",HeartEmpty:"&#xe01c;",HeartFull:"&#xe01b;",HelpRound:"&#xe088;",History:"&#xe092;",Hourglass:"&#xe048;",House:"&#xe024;",Incident:"&#xe548;",Infinity:"&#xe063;",Info:"&#xe085;",InfoRound:"&#xe086;",Install:"&#xe0a7;",Key:"&#xe04c;",Keyboard:"&#xe057;",Kiwi:"&#xe102;",Lab:"&#xe903;",Landscape:"&#xe09d;",Language:"&#xe04a;",Last:"&#xe0b4;",Layout:"&#xe097;",Leaf:"&#xe034;",LifeRing:"&#xe03d;",LightBulb:"&#xe064;",Lightning:"&#xe042;",Link:"&#xe02a;",List:"&#xe098;",Location:"&#xe014;",LocationArrow:"&#xe017;",Lock:"&#xe075;",LockApproved:"&#xe90c;",LockDeclined:"&#xe90d;",LockOpen:"&#xe90a;",LockPaid:"&#xe90e;",LockSubmitted:"&#xe90b;",Login:"&#xe078;",Logout:"&#xe077;",Loop:"&#xe091;",Magnet:"&#xe04f;",Mail:"&#xe006;",MailGmail:"&#xe934;",MailHotmail:"&#xe935;",MailOutlook:"&#xe936;",Map:"&#xe015;",Maps:"&#xe925;",Megaphone:"&#xe031;",Microphone:"&#xe040;",Minus:"&#xe081;",MinusRound:"&#xe07e;",MinusSquare:"&#xe07b;",Mobile:"&#xe003;",Moneybag:"&#xe0fd;",Moon:"&#xe032;",MoreLeft:"&#xe10a;",MoreRight:"&#xe10d;",Mouse:"&#xe004;",Music:"&#xe036;",MusicSemi:"&#xe035;",MusicSquare:"&#xe0a0;",Mute:"&#xe0b9;",Network:"&#xe04b;",New:"&#xe037;",Newspaper:"&#xe03a;",Next:"&#xe0b1;",Page:"&#xe099;",PageEmpty:"&#xe93e;",PageFull:"&#xe93d;",Palette:"&#xe033;",Paperclip:"&#xe00a;",Paperplane:"&#xe007;",Pause:"&#xe0ae;",Pencil:"&#xe008;",PeriodView:"&#xe912;",Phone:"&#xe002;",Pictures:"&#xe09e;",Pin:"&#xe904;",Plane:"&#xe03c;",Play:"&#xe0ad;",Plugin:"&#xe905;",Plus:"&#xe082;",PlusRound:"&#xe07f;",PlusSquare:"&#xe07c;",Poop:"&#xe101;",Popup:"&#xe025;",Previous:"&#xe0b2;",Printer:"&#xe028;",ProgressEmpty:"&#xe05d;",ProgressFull:"&#xe05a;",ProgressHalf:"&#xe05b;",Prompt:"&#xe109;",PromptAlert:"&#xe10c;",PromptInfo:"&#xe10b;",Publish:"&#xe059;",Qrcode:"&#xe0fb;",Question:"&#xe087;",Quote:"&#xe023;",Record:"&#xe0af;",Repeat:"&#xe090;",Reply:"&#xe00c;",ReplyAll:"&#xe00d;",ResizeEnlarge:"&#xe0b5;",ResizeShrink:"&#xe0b6;",Return:"&#xe08f;",ReturnBack:"&#xe08e;",Rocket:"&#xe052;",Rss:"&#xe06c;",Save:"&#xe0a6;",Scaledown:"&#xe107;",Scaleup:"&#xe108;",Schedule:"&#xe900;",Screen:"&#xe062;",Search:"&#xe026;",Sharable:"&#xe01a;",Share:"&#xe019;",Shield:"&#xe906;",Shuffle:"&#xe08d;",SocialFacebook:"&#xe92a;",SocialInstagram:"&#xe92c;",SocialLinkedin:"&#xe92e;",SocialTwitter:"&#xe92b;",SocialYammer:"&#xe92f;",SocialYoutube:"&#xe92d;",Sound:"&#xe0b8;",StarEmpty:"&#xe01e;",StarFull:"&#xe01d;",Stop:"&#xe0b0;",Suitcase:"&#xe054;",Sun:"&#xe05f;",SunSmall:"&#xe05e;",Switch:"&#xe094;",Sync:"&#xe100;",Tag:"&#xe02f;",Target:"&#xe018;",TeamView:"&#xe914;",Thermometer:"&#xe06e;",ThumbsDown:"&#xe020;",ThumbsUp:"&#xe01f;",Thunder:"&#xe043;",Tick:"&#xe079;",Ticket:"&#xe06b;",Tools:"&#xe02d;",Traffic:"&#xe565;",Translate:"&#xe924;",Trash:"&#xe0a3;",Trophy:"&#xe02e;",Upload:"&#xe0a4;",Upload2:"&#xe0a9;",User:"&#xe0f3;",UserAdd:"&#xe0f5;",UserAddOld:"&#xe011;",UserBlock:"&#xe0f7;",UserBoss:"&#xe0f8;",UserCheck:"&#xe18a;",UserCheckOutline:"&#xe18b;",UserDel:"&#xe0f6;",UserOld:"&#xe00f;",Users:"&#xe0f4;",UsersOld:"&#xe010;",Vcard:"&#xe012;",Video:"&#xe09f;",ViewRefresh:"&#xe915;",Voicemail:"&#xe067;",Volume:"&#xe0b7;",Warning:"&#xe089;",Wikipedia:"&#xe938;",Wireless:"&#xe06d;",Wordpress:"&#xe937;",Wrench:"&#xe0f9;",Zzz:"&#xe106;"},Affinity.icons.getIcon=function(n,t){return n&&n in Affinity.icons?Affinity.icons[n]:n&&(n=n.replace("icon","").trim().camelCase(),n in Affinity.icons)?Affinity.icons[n]:t&&t in Affinity.icons?Affinity.icons[t]:""},Affinity.appname="none",Affinity.apiversion=2,Affinity.urlroot="",Affinity.authroot="",Affinity.zelosroot="",Affinity.lookupapi="",Affinity.debug=!(parseInt(Affinity.Components.Commons.Version.split(".")[2])%2==0),Affinity.uisession=String.uniqueID(),Affinity.uiready=!1,Affinity.commonsReady=!0,Affinity.login=null,Affinity.loaders={},Affinity.loaders.dark="data:image/gif;base64,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",Affinity.loaders.light="data:image/gif;base64,R0lGODlhEAAQAPQAAP///zMzM/Ly8qGhoebm5mpqapSUlDMzM3l5eU9PT7y8vMrKykJCQq+vrzY2Nl5eXoaGhgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAACH/C05FVFNDQVBFMi4wAwEAAAAh/hpDcmVhdGVkIHdpdGggYWpheGxvYWQuaW5mbwAh+QQJCgAAACwAAAAAEAAQAAAFdyAgAgIJIeWoAkRCCMdBkKtIHIngyMKsErPBYbADpkSCwhDmQCBethRB6Vj4kFCkQPG4IlWDgrNRIwnO4UKBXDufzQvDMaoSDBgFb886MiQadgNABAokfCwzBA8LCg0Egl8jAggGAA1kBIA1BAYzlyILczULC2UhACH5BAkKAAAALAAAAAAQABAAAAV2ICACAmlAZTmOREEIyUEQjLKKxPHADhEvqxlgcGgkGI1DYSVAIAWMx+lwSKkICJ0QsHi9RgKBwnVTiRQQgwF4I4UFDQQEwi6/3YSGWRRmjhEETAJfIgMFCnAKM0KDV4EEEAQLiF18TAYNXDaSe3x6mjidN1s3IQAh+QQJCgAAACwAAAAAEAAQAAAFeCAgAgLZDGU5jgRECEUiCI+yioSDwDJyLKsXoHFQxBSHAoAAFBhqtMJg8DgQBgfrEsJAEAg4YhZIEiwgKtHiMBgtpg3wbUZXGO7kOb1MUKRFMysCChAoggJCIg0GC2aNe4gqQldfL4l/Ag1AXySJgn5LcoE3QXI3IQAh+QQJCgAAACwAAAAAEAAQAAAFdiAgAgLZNGU5joQhCEjxIssqEo8bC9BRjy9Ag7GILQ4QEoE0gBAEBcOpcBA0DoxSK/e8LRIHn+i1cK0IyKdg0VAoljYIg+GgnRrwVS/8IAkICyosBIQpBAMoKy9dImxPhS+GKkFrkX+TigtLlIyKXUF+NjagNiEAIfkECQoAAAAsAAAAABAAEAAABWwgIAICaRhlOY4EIgjH8R7LKhKHGwsMvb4AAy3WODBIBBKCsYA9TjuhDNDKEVSERezQEL0WrhXucRUQGuik7bFlngzqVW9LMl9XWvLdjFaJtDFqZ1cEZUB0dUgvL3dgP4WJZn4jkomWNpSTIyEAIfkECQoAAAAsAAAAABAAEAAABX4gIAICuSxlOY6CIgiD8RrEKgqGOwxwUrMlAoSwIzAGpJpgoSDAGifDY5kopBYDlEpAQBwevxfBtRIUGi8xwWkDNBCIwmC9Vq0aiQQDQuK+VgQPDXV9hCJjBwcFYU5pLwwHXQcMKSmNLQcIAExlbH8JBwttaX0ABAcNbWVbKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICSRBlOY7CIghN8zbEKsKoIjdFzZaEgUBHKChMJtRwcWpAWoWnifm6ESAMhO8lQK0EEAV3rFopIBCEcGwDKAqPh4HUrY4ICHH1dSoTFgcHUiZjBhAJB2AHDykpKAwHAwdzf19KkASIPl9cDgcnDkdtNwiMJCshACH5BAkKAAAALAAAAAAQABAAAAV3ICACAkkQZTmOAiosiyAoxCq+KPxCNVsSMRgBsiClWrLTSWFoIQZHl6pleBh6suxKMIhlvzbAwkBWfFWrBQTxNLq2RG2yhSUkDs2b63AYDAoJXAcFRwADeAkJDX0AQCsEfAQMDAIPBz0rCgcxky0JRWE1AmwpKyEAIfkECQoAAAAsAAAAABAAEAAABXkgIAICKZzkqJ4nQZxLqZKv4NqNLKK2/Q4Ek4lFXChsg5ypJjs1II3gEDUSRInEGYAw6B6zM4JhrDAtEosVkLUtHA7RHaHAGJQEjsODcEg0FBAFVgkQJQ1pAwcDDw8KcFtSInwJAowCCA6RIwqZAgkPNgVpWndjdyohACH5BAkKAAAALAAAAAAQABAAAAV5ICACAimc5KieLEuUKvm2xAKLqDCfC2GaO9eL0LABWTiBYmA06W6kHgvCqEJiAIJiu3gcvgUsscHUERm+kaCxyxa+zRPk0SgJEgfIvbAdIAQLCAYlCj4DBw0IBQsMCjIqBAcPAooCBg9pKgsJLwUFOhCZKyQDA3YqIQAh+QQJCgAAACwAAAAAEAAQAAAFdSAgAgIpnOSonmxbqiThCrJKEHFbo8JxDDOZYFFb+A41E4H4OhkOipXwBElYITDAckFEOBgMQ3arkMkUBdxIUGZpEb7kaQBRlASPg0FQQHAbEEMGDSVEAA1QBhAED1E0NgwFAooCDWljaQIQCE5qMHcNhCkjIQAh+QQJCgAAACwAAAAAEAAQAAAFeSAgAgIpnOSoLgxxvqgKLEcCC65KEAByKK8cSpA4DAiHQ/DkKhGKh4ZCtCyZGo6F6iYYPAqFgYy02xkSaLEMV34tELyRYNEsCQyHlvWkGCzsPgMCEAY7Cg04Uk48LAsDhRA8MVQPEF0GAgqYYwSRlycNcWskCkApIyEAOwAAAAAAAAAAAA==",Affinity.loaders.blue="data:image/gif;base64,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",Affinity.loaders.large={},Affinity.loaders.large.light="data:image/gif;base64,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",Affinity.loaders.large.dark="data:image/gif;base64,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",Affinity.agent=window.navigator.userAgent,Affinity.oldess=!1,Affinity.oldessLaunched=!1,Affinity.oldessFrame=!1,Affinity.oldessWindow=!1,Affinity.ismac=!1,Affinity.isie=!1,Affinity.isEdge=!1,Affinity.ieversion=!1,Affinity.iedocmode=!1,Affinity.ismobile=!1,Affinity.mobile=!1,Affinity.istablet=!1,Affinity.tablet=!1,Affinity.isloggedin=!1,Affinity.isTeampayoffice=!1,Affinity.isTeampayofficeBranch=!1,Affinity.scrollBarSize=0,Affinity.supportsPassiveEvents=!1,Affinity.supportsDatalist=!1,Affinity.loginsThisSession=0,Affinity.UI={},Affinity.UI.debug={},Affinity.UI.lookups={},Affinity.UI.lookupLoaders=[],Affinity.UI.displaylookups={},Affinity.UI.displaylookupLoaders=[],Affinity.UI.dependancies={},Affinity.UI.dependancyLoaders=[],Affinity.UI.autocomplete={},Affinity.UI.lastAutoKill={},Affinity.UI.delayAutoKill=function(n,t){document.getElement("."+t)&&(document.getElement("."+t).removeEvents(),document.getElement("."+t).destroy()),window.Affinity.UI.lastAutoKill[n]=null,delete window.Affinity.UI.lastAutoKill[n]},Affinity.DarkMode=!1,Affinity.UI.scrolling=!1,Affinity.UI.autoscroll=function(n){var t=window;if(Affinity.oldessFrame)try{t=window.parent.window}catch(f){}try{var i=t.document.documentElement,r=t.document.body,u=i&&i.scrollTop||r&&r.scrollTop||0;n>0&&t.scrollTo(0,u+10),n<0&&t.scrollTo(0,u-10)}catch(f){}},Affinity.EstablishAutosrollOnDragEvents=function(){document.addEventListener(Affinity.events.move,function(n){var t;if(Affinity.UI.drageventFired){var r=n.client.y,i=window.innerHeight||window.document.documentElement.clientHeight,u=50,f=i-50;if(Affinity.oldessFrame)try{t=window.parent,i=t.innerHeight||t.document.documentElement.clientHeight;var e=t.document.documentElement,o=t.document.body,h=e&&e.scrollTop||o&&o.scrollTop||0,c=document.documentMode&&document.documentMode<9?Affinity.oldessFrame.querySelectorAll(".ContentBody")[0].offsetTop:Affinity.oldessFrame.getElementsByClassName("ContentBody")[0].offsetTop;var s=h-c,u=50+s,f=s+i-50}catch(n){}r>f?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[1])):r<u?Affinity.UI.scrolling||(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","none"),Affinity.UI.scrolling=!0,Affinity.UI.scroller=Affinity.UI.autoscroll.periodical(25,window,[-1])):Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}},Affinity.supportsPassiveEvents?{passive:!0}:!1),document.addEventListener(Affinity.events.end,function(){Affinity.UI.drageventFired=!1,Affinity.UI.scrolling&&(document.getElement(".dragger")&&document.getElement(".dragger").setStyle("display","block"),Affinity.UI.scrolling=!1,clearInterval(Affinity.UI.scroller))}),Affinity.EstablishAutosrollOnDragEvents=null,delete Affinity.EstablishAutosrollOnDragEvents},Affinity.Konami=new Class({Implements:[Options],options:{onSuccess:function(){}},input:"",pattern:"38384040373937396665",initialize:function(n){this.setOptions(n),document.addEvent("keydown",function(n){this.input+=n.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input===this.pattern&&this.options.onSuccess()}.bind(this))}}),Affinity.RickRoll=new Class({Binds:["inject","destroy"],options:{},input:"",ytBox:!1,pattern:"8273677582797676",initialize:function(){document.addEvent("keydown",function(n){this.input+=n.code,this.input.length>this.pattern.length&&(this.input=this.input.substr(this.input.length-this.pattern.length)),this.input===this.pattern&&this.inject()}.bind(this))},inject:function(){this.destroy(),this.ytBox=new Element("div").setStyles({position:"fixed",top:0,left:0,width:"100%",height:"100%",background:"rgba(255,255,255,0.8)","text-align":"center","z-index":99999999999}).inject(document.body,"bottom").set("html",'<iframe width="420" height="315" style="position:fixed;top:50%;left:50%;margin:-157px 0 0 -210px;" src="https://www.youtube-nocookie.com/embed/dQw4w9WgXcQ?rel=0&amp;autoplay=1&amp;showinfo=0" frameborder="0" allowfullscreen><\/iframe>').addEvent("click",this.destroy)},destroy:function(){this.ytBox&&(this.ytBox.removeEvents(),this.ytBox.destroy())}}),new Affinity.RickRoll,Affinity.CookieMonster=new new Class({Read:function(n){var t,i;if(Affinity.isie){if(t=document.cookie.indexOf(n+"="),t!==-1)return t+=n.length+1,i=document.cookie.indexOf(";",t),i===-1&&(i=document.cookie.length),unescape(document.cookie.substring(t,i))}else return Cookie.read(n)},Write:function(n,t,i){var r=new URI(window.location.href).parsed.host,u=new Date;if(typeOf(i)!=="null"&&!isNaN(i)&&parseFloat(i)>0){var e=new Date(u.getTime()+i*6e4),o=u.toUTCString(),f=e.toUTCString();if(log("&#169; Cookie Write Expires - name: "+n+", value: "+t),log("  expires: "+f+", now: "+o+", expires value: "+i+", in days: "+parseFloat(i)/1440+", domain: "+r),Affinity.isie)try{return document.cookie=n+"="+escape(t)+"; expires="+f+"; domain:"+r+"; SameSite=None; Secure",t}catch(s){return!1}else try{return Cookie.write(n,t,{duration:parseFloat(i)/1440}),t}catch(s){return!1}}else if(log("&#169; Cookie Write - name: "+n+", value: "+t),Affinity.isie)try{return document.cookie=n+"="+escape(t)+"; SameSite=None; Secure",t}catch(s){return!1}else try{return Cookie.write(n,t),t}catch(s){return!1}},Delete:function(n){if(log("&#169; Cookie Delete - name: "+n),Affinity.isie){document.cookie=n+"=; expires=Thu, 01-Jan-70 00:00:01 GMT; SameSite=None; Secure";try{return Cookie.dispose(n),!0}catch(t){return!1}}else try{return Cookie.dispose(n),!0}catch(t){return!1}}}),Affinity.logger=new new Class({Binds:["build","enable","disable","enableLog","disableLog","log","clear","open","close"],enabled:!1,__prelog:[],initialize:function(){window.log=this.log,window.logClear=this.clear,window.logEnable=this.enableLog,window.logDisable=this.disableLog},build:function(){if(!Affinity.uiready){window.removeEvent("UiReady",this.build),window.addEvent("UiReady",this.build);return}window.removeEvent("UiReady",this.build),document.id("_log")&&document.id("_log").destroy(),document.id("_logbutton")&&document.id("_logbutton").destroy(),this.enabled=!0,this.logBox=new Element("div",{id:"_log"}).inject(document.body,"bottom"),this.logsBox=new Element("div",{html:"","class":"logs"}).inject(this.logBox,"top"),this.closeButton=new Element("div",{html:"close","class":"close"}).inject(this.logBox,"top"),this.clearButton=new Element("div",{html:"clear","class":"clear"}).inject(this.logBox,"top"),this.hiddenButton=new Element("div",{id:"_logbutton"}).inject(this.logBox,"after"),this.hiddenButton.setStyles({position:"absolute",top:5,left:5,width:30,height:30,"z-index":9999999998}),this.logBox.setStyles({position:"absolute",top:40,left:5,width:"80%",height:"80%",border:"1px solid black","background-color":"#fff",color:"000","z-index":9999999999,"-webkit-transform":"translateX(0)",transform:"translateX(0)",display:"none"}),this.logsBox.setStyles({width:"100%",height:"100%",padding:10,overflow:"scroll","-webkit-box-sizing":"border-box","-moz-box-sizing":"border-box","box-sizing":"border-box"}),this.clearButton.setStyles({position:"absolute",top:10,right:80,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.setStyles({position:"absolute",top:10,right:30,padding:5,"background-color":"#fff",cursor:"pointer"}),this.closeButton.addEvent(Affinity.events.click,this.close),this.clearButton.addEvent(Affinity.events.click,this.clear),this.hiddenButton.addEvent(Affinity.events.click,this.open),this.log("// log started "+new Date),this.__prelog.length>0&&Array.each(this.__prelog,function(n){this.log(n[0],n[1])}.bind(this)),this.enabled=!1,window.fireEvent("LogReady")},enable:function(){this.destroy(),this.build(),this.open()},disable:function(){this.destroy()},enableLog:function(){return this.enabled=!0,this.log("// log enabled "+new Date),'Log Enabled. Enter "disableLog()" to stop.'},disableLog:function(){return this.log("// log disabled "+new Date),this.enabled=!1,'Log disabled. Enter "enableLog()" to start.'},log:function(n,t){if(this.enabled){if(typeOf(n)==="string"&&(n==="show"||n==="open")){this.open();return}var i=typeOf(n)==="object"||typeOf(n)==="array"?JSON.stringify(n,null,2):typeOf(n)==="element"?"element type: "+n.get("tag")+"\r\n"+JSON.stringify(n.getProperties("id","class","style","src","title","alt"),null,2):n;typeOf(t)==="object"?new Element("<pre>",{html:i}).inject(this.logsBox,"top").setStyles(t):typeOf(t)==="string"?new Element("<pre>",{html:i}).inject(this.logsBox,"top").set("style",t):new Element("<pre>",{html:i}).inject(this.logsBox,"top")}else this.__prelog.push([n,t])},clear:function(){this.enabled&&(this.logsBox.empty(),this.log("// log cleared "+new Date))},open:function(){this.enabled&&(this.logBox.getStyle("display")==="none"?this.logBox.setStyle("display","block"):this.logBox.setStyle("display","none"))},close:function(){this.enabled&&(this.logBox.getStyle("display")==="block"?this.logBox.setStyle("display","none"):this.logBox.setStyle("display","block"))},destroy:function(){window.removeEvent("UiReady",this.build),this.enabled=!1,this.closeButton&&this.closeButton.remveEvents(),this.clearButton&&this.clearButton.remveEvents(),this.hiddenButton&&this.hiddenButton.remveEvents(),this.logBox&&this.logBox.destroy()}}),Affinity.SmartClose=new Class({Binds:["isActive","checkActive","isOver","setClose","overAll","outAll","windowClick"],over:!1,isOverCheckTimer:!1,initialize:function(n){if(Affinity.mobile)return"is mobile";this.class="smart-close-"+String.uniqueID(),this.element=n,this.element.addClass(this.class),this.element.isOver=this.isOver,this.element.addEvent(Affinity.events.overAll,this.overAll),this.element.addEvent(Affinity.events.outAll,this.outAll),this.element.addEvent("focus",this.setClose)},isActive:function(){if(document.activeElement){if(document.activeElement===this.element||document.activeElement.getParent("."+this.class)===this.element)return!0}else return!1;return!0},checkActive:function(){this.isActive()||(this.over=!1,this.windowClick())},isOver:function(){return this.isActive()||(this.over=!1),this.over},setClose:function(){window.removeEvent(Affinity.events.click,this.windowClick),window.addEvent(Affinity.events.click,this.windowClick)},overAll:function(){clearTimeout(this.isOverCheckTimer),this.setClose(),this.over=!0,this.isOverCheckTimer=this.checkActive.delay(1e3,this)},outAll:function(){clearTimeout(this.isOverCheckTimer),this.over=!1},windowClick:function(){this.over||(this.element.fireEvent("SmartClose"),window.removeEvent(Affinity.events.click,this.windowClick))}}),Affinity.UI.mobileZooming=!1,Affinity.mobile&&window.addEvents({touchmove:function(n){n.touches.length===2&&(Affinity.UI.mobileZooming=!0)},touchend:function(){if(Affinity.UI.mobileZooming){var n=document.createEvent("HTMLEvents");n.initEvent("resize",!0,!1),window.dispatchEvent(n)}Affinity.UI.mobileZooming=!1}}),Affinity.GetCacheSafePath=function(n){if(!Affinity.isie||typeOf(n)!=="string")return n;return n+(n.contains("?")?"&ran=":"?ran=")+String.uniqueID()+"-"+Date.parse(new Date).format("%s")},Affinity.ProcessUrl=function(n){var t,u="/_Api/Zelos",i,o,r,e,f;return i=n.replace("%3F","?"),i=Affinity.isTeampayoffice&&new RegExp("timesheets"+u,"i").test(i)?i.replace(new RegExp("timesheets"+u,"i"),u):i,i=Affinity.isTeampayofficeBranch&&new RegExp("tb"+u,"i").test(i)?i.replace(new RegExp("tb"+u,"i"),u):i,i=i.replace(u+"?",""),o=i.indexOf("&")>-1&&i.indexOf("?")===-1?i.replace("&","?"):i,r=new URI(o),e={},typeOf(r.parsed.query)!=="null"&&(f=r.parsed.query.parseQueryString(),Object.each(f,function(n,t){typeOf(n)==="array"&&(f[t]=n[n.length-1])}),e=Object.toQueryString(f)),r.parsed.query="",t=r.toString(),t=typeOf(r.parsed.scheme)!=="null"?t.replace(r.parsed.scheme+"://",""):t,t=typeOf(r.parsed.host)!=="null"?t.replace(r.parsed.host,""):t,t=typeOf(r.parsed.port)!=="null"?t.replace(":"+r.parsed.port,""):t,t=t.indexOf(u)===-1?u+"?"+t:t,t=(t.charAt(0)==="/"?t.substring(1):t)+"?"+decodeURIComponent(Object.toQueryString(e)),t=Affinity.isTeampayoffice&&!Affinity.isTeampayofficeBranch&&t.indexOf("timesheets")===-1?"/timesheets/"+t:t,t=Affinity.isTeampayofficeBranch&&t.indexOf("tb")===-1?"/tb/"+t:t,t=t.replace(new RegExp("//","g"),"/"),t=t.replace("??","?"),t.replace("?/","?")},Affinity.ProcessUrlObj=function(n,t){var i,r,u="/_Api/Zelos";return t=typeOf(t)!=="null"?t:{},r=t.parseQueryString(),Object.each(r,function(n,t){typeOf(n)==="array"&&(r[t]=n[n.length-1])}),t=Object.toQueryString(r),n.parsed.query="",n.parsed.directory=Affinity.isTeampayoffice&&new RegExp("timesheets/","i").test(n.parsed.directory)?n.parsed.directory.replace(new RegExp("timesheets/","i"),""):n.parsed.directory,n.parsed.directory=Affinity.isTeampayofficeBranch&&new RegExp("tb/","i").test(n.parsed.directory)?n.parsed.directory.replace(new RegExp("tb/","i"),""):n.parsed.directory,n.parsed.directory=n.parsed.directory.replace(new RegExp("//","g"),"/"),i=n.toString(),i=typeOf(n.parsed.scheme)!=="null"?i.replace(n.parsed.scheme+"://",""):i,i=typeOf(n.parsed.host)!=="null"?i.replace(n.parsed.host,""):i,i=typeOf(n.parsed.port)!=="null"?i.replace(":"+n.parsed.port,""):i,i=i.indexOf(u)===-1?u+"?"+i:i,i=(i.charAt(0)==="/"?i.substring(1):i)+"?"+decodeURIComponent(Object.toQueryString(t)),i=Affinity.isTeampayoffice&&!Affinity.isTeampayofficeBranch&&i.indexOf("timesheets")===-1?"/timesheets/"+i:i,i=Affinity.isTeampayofficeBranch&&i.indexOf("tb")===-1?"/tb/"+i:i,i=i.replace(new RegExp("//","g"),"/"),i=i.replace("??","?"),i.replace("?/","?")},Affinity.IsElement=function(n){try{return n instanceof HTMLElement}catch(t){return typeof n=="object"&&n.nodeType===1&&typeof n.style=="object"&&typeof n.ownerDocument=="object"}},Locale.define("en-NZ","Date",{dateOrder:["date","month","year","/"],shortDate:"%D/%M/%Y",shortTime:"%I:%M%p",AM:"am",PM:"pm"}).inherit("en-US","Date"),Locale.define("en-AU").inherit("en-NZ","Date"),Locale.use("en-NZ"),Date.implement({toZelos:function(){return Date.parse(this.format("%d/%m/%Y %H:%M:%S")).format("%Y-%m-%dT%H:%M:%S")},toTime:function(){try{return this.format("%k:%M:%S")}catch(n){return"Invalid Date"}},toTime24:function(){this.toTime()},toTime12:function(){try{return this.format("%l:%M:%S %p").toLowerCase()}catch(n){return"Invalid Date"}},toSimple:function(){try{return this.format("%d-%m-%Y")}catch(n){return"Invalid Date"}},toSimpleDateTime:function(){try{return this.format("%d-%m-%Y %k:%M:%S")}catch(n){return"Invalid Date"}},toServer:function(){try{return this.format("%d.%m.%Y %k:%M:%S %z")}catch(n){return"Invalid Date"}},toFriendly:function(){try{return this.format("%A %B %e%o %Y").replace(/  /gi," ")}catch(n){return"Invalid Date"}},toFriendlyShort:function(){try{return this.format("%a %b %e%o %Y").replace(/  /gi," ")}catch(n){return"Invalid Date"}},toWords:function(){try{return this.timeDiffInWords()}catch(n){return"Invalid Date"}},toWordsShort:function(){try{return this.timeDiffInWords().replace(/year/g,"yr").replace(/month/g,"mnth").replace(/hour/g,"hr").replace(/minute/g,"min").replace(/second/g,"sec").replace(/about/g,"")}catch(n){return"Invalid Date"}},matches:function(n,t,i){if(typeOf(n)!=="null"){var r=Date.parse(this),u=Date.parse(n);if(r&&u&&typeOf(r)=="date"&&typeOf(u)==="date"&&r.isValid()&&u.isValid()&&(typeOf(t)==="boolean"&&t&&(r=r.setSeconds(0),u=u.setSeconds(0)),typeOf(i)==="boolean"&&i&&(r=r.setMilliseconds(0),u=u.setMilliseconds(0)),r=r.getTime(),u=u.getTime(),r===u))return!0}return!1},elapsed:function(){return((new Date).getTime()-this.getTime())/1e3},sameDay:function(n){if(typeOf(n)!=="null"){var t=Date.parse(this),i=Date.parse(n);if(t&&i&&typeOf(t)=="date"&&typeOf(i)==="date"&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t===i))return!0}return!1},lessThan:function(n){if(typeOf(n)!=="null"){var t=Date.parse(this),i=Date.parse(n);if(t&&i&&typeOf(t)=="date"&&typeOf(i)==="date"&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t<i))return!0}return!1},lessThanOrEqualTo:function(n){return typeOf(n)!=="null"&&(this.sameDay(n)||this.lessThan(n))?!0:!1},greaterThan:function(n){if(typeOf(n)!=="null"){var t=Date.parse(this),i=Date.parse(n);if(t&&i&&typeOf(t)=="date"&&typeOf(i)==="date"&&t.isValid()&&i.isValid()&&(t=t.clearTime().getTime(),i=i.clearTime().getTime(),t>i))return!0}return!1},greaterThanOrEqualTo:function(n){return typeOf(n)!=="null"&&(this.sameDay(n)||this.greaterThan(n))?!0:!1}}),Date.defineFormat("zelos",function(n){return n.toZelos()}),Date.CurentYear=(new Date).get("year"),Date.FormatStrings=[["christmas","12.25."+(Date.CurentYear+1)],["xmas","12.25."+(Date.CurentYear+1)],["newyear","1.1."+(Date.CurentYear+1)],["new year","1.1."+(Date.CurentYear+1)]],Date.TimeTravel=[["second",/(\+|\-)\s*[0-9]+( )*(seconds|second|sec|s)/],["minute",/(\+|\-)\s*[0-9]+( )*(minutes|minute|min|m)/],["hour",/(\+|\-)\s*[0-9]+( )*(hours|hour|h)/],["day",/(\+|\-)\s*[0-9]+( )*(days|day|d)/],["week",/(\+|\-)\s*[0-9]+( )*(weeks|week|w)/],["month",/(\+|\-)\s*[0-9]+( )*(months|month)/],["year",/(\+|\-)\s*[0-9]+( )*(years|year|y)/]],String.implement({toDate:function(){Locale.use("en-GB");var n,i,r,t;if(s=this.toLowerCase().trim(),s==="now")return new Date;for(s.contains("now ")&&(s=s.replace(/(now |today )/,(new Date).format("%k:%H:%S "))),/^\d+$/.test(s)&&s.length>=6&&(s=s.length>8?parseInt(s,10)*1e3+"":s.substr(0,2)+"."+s.substr(2,2)+"."+s.substr(4)),n=0;n<Date.FormatStrings.length;n++)if(s.contains(Date.FormatStrings[n][0])){s=s.replace(Date.FormatStrings[n][0],Date.FormatStrings[n][1]);break}for(n=0;n<Date.TimeTravel.length;n++)s.test(Date.TimeTravel[n][1])&&(i=s.match(Date.TimeTravel[n][1])[0],r=i.match(/[0-9]+/)[0],i.indexOf("+")&&(t=Date.parse(s.replace(i,"").trim()).decrement(Date.TimeTravel[n][0],parseFloat(r))),i.indexOf("-")&&(t=Date.parse(s.replace(i,"").trim()).increment(Date.TimeTravel[n][0],parseFloat(r))));t=t==null?Date.parse(s):t;try{return t.format("%s")==0?"Invalid Date":t}catch(u){return"Invalid Date"}}}),String.implement({ToCamelCase:function(){return this.toLowerCase().replace(/(_|-)([a-z])/g,function(n){return n[1].toUpperCase()})}}),String.implement({isNullOrEmpty:function(){return typeof this=="string"&&(this===null||this.trim().toLowerCase()==="null"||this.trim()==="")?!0:!1}}),Affinity.hasOwnProperty("isWindow")||(Affinity.isWindow=function(n){return n!=null&&n===n.window},Affinity.isWindowReturn=function(n){return Affinity.isWindow(n)?n:!1}),Affinity.hasOwnProperty("isObject")||(Affinity.isObject=function(n){return n===null||typeof n!="object"||n.nodeType||Affinity.isWindow(n)?!1:n.constructor&&!hasOwnProperty.call(n.constructor.prototype,"isPrototypeOf")?!1:!0},Affinity.isObjectReturn=function(n){return Affinity.isObject(n)?n:!1}),Affinity.hasOwnProperty("FormatString")||(Affinity.FormatString=function(n,t){if(typeof n=="object"&&(n=Object.keys(n).map(function(t){return n[t]}).join("")),t.length===1&&Affinity.isObject(t[0])){var r=t[0],i;for(i in r)r.hasOwnProperty(i)&&(n=n.replace(new RegExp("{"+i+"}","g"),r[i]));return n}return n.replace(/{(\d+)}/g,function(n,i){return typeof t[i]!="undefined"?t[i]:n})}),String.prototype.format||(String.prototype.format=function(){var n=[].slice.call(arguments);return Affinity.FormatString(this,n)}),Array.implement({FindIn:function(n,t){for(var i=this.length-1;i<-1;i--)if(this[i][n]===t)return this[i];return null}}),Object.valueFromKeyString=function(n,t){var r,i,f,u;try{for(t=t.replace(/\[(\w+)\]/g,".$1"),t=t.replace(/^\./,""),r=t.split("."),i=0,f=r.length;i<f;++i)if(u=r[i],u in n)n=n[u];else return!1;return n}catch(e){return null}},Array.implement({mapFromKey:function(n){if(this.length>0&&n in this[0])return this.reduce(function(t,i){return t[i[n]]=i,t},{})}}),Affinity.DeepMergeObjects=function(n){function r(n){var t=n&&typeof n=="object";return t&&Object.prototype.toString.call(n)!=="[object RegExp]"&&Object.prototype.toString.call(n)!=="[object Date]"}function f(n){return Array.isArray(n)?[]:{}}function i(n,i){var u=i&&i.clone===!0;return u&&r(n)?t(f(n),n,i):n}function u(n,u,f){var e=n.slice();return u.forEach(function(u,o){typeof e[o]=="undefined"?e[o]=i(u,f):r(u)?e[o]=t(n[o],u,f):n.indexOf(u)===-1&&e.push(i(u,f))}),e}function e(n,u,f){var e={};return r(n)&&Object.keys(n).forEach(function(t){e[t]=i(n[t],f)}),Object.keys(u).forEach(function(o){e[o]=r(u[o])&&n[o]?t(n[o],u[o],f):i(u[o],f)}),e}function t(n,t,r){var f=Array.isArray(t),o=r||{arrayMerge:u},s=o.arrayMerge||u;return f?Array.isArray(n)?s(n,t,r):i(t,r):e(n,t,r)}return t.all=function(n,i){if(!Array.isArray(n)||n.length<2)throw new Error("first argument should be an array with at least two elements");return n.reduce(function(n,r){return t(n,r,i)})},t.all(n)},JSON.Unauthorized=function(n,t){var r=!1,i=typeOf(n);return(i==="object"||i==="array")&&(n=JSON.encode(n),i="string"),i==="string"&&n.indexOf('[{"Key":')!==0&&(n.test("unauthorized","gi")||n.test("unauthorised","gi")||n.test("/(401/)","gi")||n.test("/(403/)","gi"))&&(log("&#x270B; json response is unauthorized"+(typeOf(t)!==null?" ("+unescape(t)+")":"")+" &#x270B;"),log(JSON.stringify(n,null,2)),log("&#x270B; END json response is unauthorized log &#x270B;"),window.prompts&&Affinity.prompts.hide(),r=!0),n=null,r},Element.implement({hasWidget:function(n){return this.retrieve(n)?!0:!1},getWidget:function(n){return n&&this.retrieve(n)?this.retrieve(n):this.retrieve("widget")?this.retrieve("widget"):!1},destroyWidget:function(n){var t=this.getWidget(n);return t&&"destroy"in t&&t.destroy(),t=null,null},exists:function(){try{if(document.contains(this))return this}catch(n){}return!1}}),DOMEvent.implement({getTarget:function(n){return this.target.hasClass(n)?this.target:this.target.get("id")===n?this.target:this.target.getParent("."+n)?this.target.getParent("."+n):this.target.getParent("#"+n)?this.target.getParent("#"+n):this.target}}),Element.implement({hasEvent:function(n,t){var i=this.retrieve("events");switch(i&&i[n]&&(t==undefined||i[n].keys.contains(t))){case null:case!1:case undefined:case 0:return!1;default:return!0}}}),Affinity.FormElement=new Class({Implements:[Options,Events],WidgetName:"FormElement",Binds:["clearEvents","setEvents","sanatiseValue","cloneValue","setValue","getValue","getDisplayValue","checkChanged","lookup","lookupComplete","destroy"],options:{},element:!1,dynamicContents:!1,dynamicFirstLoad:!0,defaultValue:"",valueEmpty:!1,changed:!1,initialize:function(n,t){this.setOptions(t),this.element=n,n.retrieve("defaultValue")||(this.element=n,this.setEvents(),this.defaultValue=this.sanatiseValue(n.value),this.element.store("defaultValue",this.defaultValue)),this.element.store("widget",this),this.element.store("elementWidget",this),this.element.addClass("widget"),this.element.value=this.sanatiseValue(this.element.value),this.lastValue=this.element.value},reset:function(){this.changed=!0,this.defaultValue=this.sanatiseValue(this.element.value),this.lastValue=this.element.value,this.element.store("defaultValue",this.defaultValue),this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:null}),this.element.addClass("changed").removeClass("restored")},clearEvents:function(){this.element.removeEvent("input",this.checkChanged),this.element.removeEvent("lookup",this.lookup),this.element.removeEvent("lookupComplete",this.lookupComplete),this.element.removeEvent("change",this.checkChanged),this.element.removeEvent("blur",this.checkChanged)},setEvents:function(){this.clearEvents(),this.element.get("list")?this.element.addEvent("input",this.checkChanged):(this.element.addEvent("lookup",this.lookup),this.element.addEvent("lookupComplete",this.lookupComplete),this.element.addEvent("change",this.checkChanged),this.element.addEvent("blur",this.checkChanged))},sanatiseValue:function(n){try{return n===null||n===undefined||n.trim()===""?"":n}catch(t){return n}},cloneValue:function(n){return(n+"").trim()},getValue:function(){return this.element.value},setValue:function(n){this.element.value=this.sanatiseValue(n),this.defaultValue=this.element.value,this.lastValue=this.element.value,this.element.store("defaultValue",this.defaultValue),this.element.removeClass("changed").removeClass("restored"),this.changed=!1},getDisplayValue:function(){return this.element.value},checkChanged:function(n){var t;return t=typeOf(n)!=="null"&&typeOf(n.target)!=="null"?n.target.value:this.sanatiseValue(this.element.value),this.cloneValue(t)!==this.cloneValue(this.defaultValue)?(this.changed=!0,this.lastValue===this.element.value&&(this.element.fireEvent("changed",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"changed",originalEvent:n}),this.element.addClass("changed").removeClass("restored")),this.lastValue=this.element.value):(this.changed=!1,this.element.fireEvent("restored",{target:this.element,defaultValue:this.defaultValue,value:this.element.value,type:"restored",originalEvent:n}),this.lastValue=this.element.value,this.element.addClass("restored").removeClass("changed")),this.changed},lookup:function(){this.dynamicContents=!0},lookupComplete:function(n){this.dynamicFirstLoad&&(this.defaultValue=n.defaultValue,this.element.store("defaultValue",this.defaultValue),this.dynamicFirstLoad=!1),this.checkChanged({target:this.element})},destroy:function(){this.clearEvents(),this.element.eliminate("defaultValue"),this.element.eliminate("elementWidget")}}),Element.implement({makeFormElement:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.FormElement(this),this}}),Affinity.ElementValueTracker=new Class({Implements:[Options,Events],WidgetName:"ValueTracker",Binds:["__removeEvents","__addEvents","__elementChanged","__elementBlured","__doChangeCheck","__doChangeCheckThrottled","__lookupComplete","addElement","removeElement","setValue","hasChanged","hasRestored","getValue","getDefault","getLast","changeStatus"],options:{},elements:[],values:[],valuesDefault:[],valuesLast:[],id:!1,initialize:function(n){this.id=String.uniqueID(),n&&!n.hasClass("has-change-tracker")&&this.addElement(n)},__removeEvents:function(n){n.removeEvent("change",this.__elementChanged),n.removeEvent("blur",this.__elementBlured)},__addEvents:function(n){n.addEvent("change",this.__elementChanged),n.addEvent("blur",this.__elementBlured)},__cloneValue:function(n){var i=typeOf(n)==="number"?!0:!1,t=(n+"").trim();return i?parseFloat(t):t},__sanatiseValue:function(n){try{return n===null||n===undefined||n.trim()===""?"":n}catch(t){return n}},__isSame:function(n,t){var i=n+"",r=t+"";return i.isNullOrEmpty()&&r.isNullOrEmpty()?!1:i.trim().toLowerCase()===r.trim().toLowerCase()},__doChangeCheck:function(n){clearTimeout(this.__doChangeCheckThrottle),this.__doChangeCheckThrottle=this.__doChangeCheckThrottled.delay(100,this,[n])},__doChangeCheckThrottle:!1,__doChangeCheckThrottled:function(n){if(n&&["object","event","domevent"].contains(typeOf(n))&&"target"in n&&this.elements.indexOf(n.target)>-1){var t,i;Array.each(this.elements,function(n,r){t=i=!1,this.values[r]=this.__sanatiseValue(n.value),this.__isSame(this.values[r],this.valuesDefault[r])?i=!0:t=!0,n.removeClass("cant-select-default"),t&&(n.removeClass("value-restored").addClass("value-changed"),n.fireEvent("ElementChanged",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),this.fireEvent("ElementChanged",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),window.fireEvent("AnElementChanged",{target:this.elements[r],value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),this.values[r]!==this.valuesDefault[r]&&(n.get("class").test(new RegExp("dependencies","gi"))||n.get("class").test(new RegExp("lookup","gi")))&&n.addClass("cant-select-default")),i&&(n.removeClass("value-changed").addClass("value-restored"),n.fireEvent("ElementRestored",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),this.fireEvent("ElementRestored",{value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]}),window.fireEvent("AnElementRestored",{target:this.elements[r],value:this.values[r],last:this.valuesLast[r],"default":this.valuesDefault[r]})),this.valuesLast[r]=this.values[r]}.bind(this))}},__elementChanged:function(n){this.__doChangeCheck(n)},__elementBlured:function(n){this.__doChangeCheck(n)},__lookupComplete:function(n){this.__doChangeCheck.delay(500,this,[n])},addElement:function(n){if(!n.retrieve("changetracker")){var t="value"in n?n.value:"",i=n.get("data-default-value")?n.get("data-default-value"):t;this.elements.indexOf(n)===-1?(this.elements.push(n),this.values.push(t),this.valuesDefault.push(i),this.valuesLast.push(t),this.__removeEvents(n),this.__addEvents(n),n.addEvent("lookupComplete",this.__lookupComplete),n.addClass("has-change-tracker"),n.store("changetracker",this)):this.setValue(n,t)}},removeElement:function(n){if(this.elements.indexOf(n)!==-1){var t=this.elements.indexOf(n);this.elements.splice(t,1),this.values.splice(t,1),this.valuesLast.splice(t,1),this.valuesDefault.splice(t,1),this.__removeEvents(n),n.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),n.eliminate("changetracker")}},setValue:function(n,t){if(this.elements.indexOf(n)!==-1){var i=this.elements.indexOf(n);n.value=t,n.removeClass("value-restored").removeClass("value-changed"),this.values[i]=t,this.valuesDefault[i]=t,this.valuesLast[i]=t,this.__removeEvents(n),this.__addEvents(n)}else this.addElement(n)},hasChanged:function(){var n=!1;return Array.each(this.elements,function(t,i){t.hasClass("value-changed")&&(n=!0),this.__isSame(this.values[i],this.valuesDefault[i])||(n=!0)}.bind(this)),n},hasRestored:function(){var n=!1;return Array.each(this.elements,function(t){t.hasClass("value-restored")&&(n=!0)}.bind(this)),n},getValue:function(n){var i=n||this.elements[0],t=this.elements.indexOf(i);if(t!==-1)return this.values[t];throw new Error("Target element not tracked");},getDefault:function(n){var i=n||this.elements[0],t=this.elements.indexOf(i);if(t!==-1)return this.valuesDefault[t];throw new Error("Target element not tracked");},getLast:function(n){var i=n||this.elements[0],t=this.elements.indexOf(i);if(t!==-1)return this.valuesLast[t];throw new Error("Target element not tracked");},changeStatus:function(){return{changed:this.hasChanged(),restored:this.hasRestored(),values:this.values,last:this.valuesLast,defaults:this.valuesDefault}},destroy:function(){Array.each(this.elements,function(n){this.__removeEvents(n),n.removeClass("value-restored").removeClass("value-changed").removeClass("has-change-tracker"),n.eliminate("changetracker")}.bind(this))}}),Element.implement({addChangeTracker:function(){return this.get("tag").test("select|input|textarea|datalist","gi")&&new Affinity.ElementValueTracker(this),this},hasChanged:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").hasChanged()},getTrackedValue:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getValue(this)},getTrackedDefault:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getDefault(this)},getTrackedLast:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").getLast(this)},fireTrackedChange:function(){if(this.retrieve("changetracker"))return this.retrieve("changetracker").__elementChanged({target:this}),this.retrieve("changetracker").getValue(this)}}),Element.implement({exists:function(){try{if(document.body.contains(this)||this.ownerDocument&&this.ownerDocument.body.contains(this))return this}catch(n){return!1}return!1}}),Element.Events.added={onAdd:function(){this.exists()?this.fireEvent("exists",this):(this.store("_exists_method",function(){this.exists()&&(clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method"),this.fireEvent("exists",this))}),this.store("_exists_timer",this.retrieve("_exists_method").periodical(100,this)))},onRemove:function(){clearInterval(this.retrieve("_exists_timer")),this.eliminate("_exists_timer"),this.eliminate("_exists_method")}},Element.Events.removed={onAdd:function(){this.exists()?(this.store("_not_exists_method",function(){this.exists()||(clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_timer"),this.eliminate("_not_exists_method"),this.fireEvent("notexists",!0))}),this.store("_not_exists_timer",this.retrieve("_not_exists_method").periodical(1e3,this))):this.fireEvent("notexists",!0)},onRemove:function(){clearInterval(this.retrieve("_not_exists_timer")),this.eliminate("_not_exists_method"),this.eliminate("_not_exists_method")}},String.prototype.soundex=function(){var f=this,t,n="",r,e,o,u;for(f=f.toUpperCase(),n=f,n=n.replace(/[^A-Z]/gi," "),n=n.replace(/^\s*/g,""),n=n.replace(/\s*$/g,""),n=n.replace(/^GH/g,"G"),n=n.replace(/DG/g,"G"),n=n.replace(/GH/g,"H"),n=n.replace(/GN/g,"N"),n=n.replace(/KN/g,"N"),n=n.replace(/PH/g,"F"),n=n.replace(/MP([STZ])/g,"M$1"),n=n.replace(/^PS/g,"S"),n=n.replace(/^PF/g,"F"),n=n.replace(/MB/g,"M"),n=n.replace(/TCH/g,"CH"),u=n.substr(0,1),(u==="H"||u==="W")&&(n="-"+n.substr(1)),n=n.replace(/[AEIOUYHW]/g,"0"),n=n.replace(/[BPFV]/g,"1"),n=n.replace(/[CSGJKQXZ]/g,"2"),n=n.replace(/[DT]/g,"3"),n=n.replace(/[L]/g,"4"),n=n.replace(/[MN]/g,"5"),n=n.replace(/[R]/g,"6"),o=n.length,e="",t="",i=0;i<o;i++)r=n.charAt(i),r===e?t+=" ":(t+=r,e=r);return n=t,n=n.substr(1),n=n.replace(/\s/g,""),n=n.replace(/0/g,""),n+="0000000000",n=u+n,n.substr(0,5)},String.prototype.distance=function(n){var u=this.toLowerCase(),f=n.toLowerCase(),r,t,i;if(u.length===0)return f.length;if(f.length===0)return u.length;for(r=[],t=0;t<=f.length;t++)r[t]=[t];for(i=0;i<=u.length;i++)r[0][i]=i;for(t=1;t<=f.length;t++)for(i=1;i<=u.length;i++)r[t][i]=f.charAt(t-1)===u.charAt(i-1)?r[t-1][i-1]:Math.min(r[t-1][i-1]+1,Math.min(r[t][i-1]+1,r[t-1][i]+1));return r[f.length][u.length]},typeOf(File)==="null"&&(File={}),typeOf(Request)==="null"&&(File={}),File.Upload=new Class({Implements:[Options,Events],options:{onComplete:function(){}},initialize:function(n){var t=this;this.setOptions(n),this.uploadReq=new Request.File({onComplete:function(){t.fireEvent("complete",arguments),this.reset()}}),this.options.data&&this.data(this.options.data),this.options.images&&this.addMultiple(this.options.images)},data:function(n){var t=this;this.options.url.indexOf("?")<0&&(this.options.url+="?"),Object.each(n,function(n,i){t.options.url.charAt(t.options.url.length-1)!=="?"&&(t.options.url+="&"),t.options.url+=encodeURIComponent(i)+"="+encodeURIComponent(n)})},addMultiple:function(n){var t=this;n.each(function(n){t.add(n)})},add:function(n){var t=n;typeOf(n)!=="null"&&(n=document.id(n),name=n.get("name"),file=n.files[0],this.uploadReq.append("fileData",file))},addPostData:function(n){this.uploadReq.addPostData(n)},send:function(n){n&&this.add(n),this.uploadReq.send({url:this.options.url})}}),Request.File=new Class({Extends:Request,options:{emulation:!1,urlEncoded:!1},initialize:function(n){this.xhr=new Browser.Request,this.formData=new FormData,this.setOptions(n),this.headers=this.options.headers},append:function(n,t){return this.formData.append(n,t),this.formData},addPostData:function(n){var t=this;Object.each(n,function(n,i){t.formData.append(i,n)})},reset:function(){this.formData=new FormData},send:function(n){var i=n.url||this.options.url,t;return this.options.isSuccess=this.options.isSuccess||this.isSuccess,this.running=!0,t=this.xhr,t.open("POST",i,!0),t.onreadystatechange=this.onStateChange.bind(this),Object.each(this.headers,function(n,i){try{t.setRequestHeader(i,n)}catch(r){this.fireEvent("exception",[i,n])}},this),this.fireEvent("request"),t.send(this.formData),this.options.async||this.onStateChange(),this.options.timeout&&(this.timer=this.timeout.delay(this.options.timeout,this)),this}}),Affinity.Shake=new Class({Implements:Options,options:{distance:4,duration:50,transition:Fx.Transitions.Sine.easeInOut,loops:2},initialize:function(n,t){this.setOptions(t),this.element=n,this.tween=new Fx.Tween(this.element,{link:"chain",duration:this.options.duration,transition:this.options.transition,property:"margin-left"})},shake:function(){var n=this.options.distance;for(this.loops=0;this.loops<this.options.loops;this.loops++)this.tween.start("left",n).start("left",-n),this.tween.start("left",n).start("left",0);n=null},stop:function(){this.loops=this.options.loops,this.tween.cancel(),this.element.setStyle("margin-left",0)}}),Affinity.user=null,AuthRequest=new Class({initialize:function(n){this._req=new Request(n)},send:function(){this._authorize(function(){this._req.send()}.bind(this))},get:function(){this._authorize(function(){this._req.get()}.bind(this))},post:function(){this._authorize(function(){this._req.post()}.bind(this))},_authorize:function(n){var t=this;Affinity.user?Affinity.user.AccessToken?(t._setAuthHeader(),n()):new Request.JSON({url:"/Auth/RefreshAccessToken",onSuccess:function(i){if(i.error)return location.reload();Affinity.user.AccessToken=i.AccessToken,t._setAccessTimeout(i.ExpiryTimeout*1e3),t._setAuthHeader(),n()},onFailure:function(){console.log("Failed to refresh access token.")}}).post():new Request.JSON({url:"/Auth/GetInfo",onSuccess:function(i){if(Affinity.user=i,i.ExpiryTimeout<0)return Affinity.user.AccessToken="",t._authorize(n);t._setAccessTimeout(i.ExpiryTimeout*1e3),t._setAuthHeader(),n()}}).post()},_setAuthHeader:function(){this._req.options.headers.Authorization="Bearer "+Affinity.user.AccessToken},_setAccessTimeout:function(n){clearTimeout(this._accessTimeout),this._accessTimeout=setTimeout(function(){Affinity.user.AccessToken=""},n)}}),AuthRequest.JSON=new Class({Extends:AuthRequest,initialize:function(n){this._req=new Request.JSON(n)}}),Request.AuthJSON=AuthRequest.JSON,Affinity.languages={english:{helpIcon:Affinity.icons.HelpRound,helpTabTooltip:"Help"}},Affinity.Lang=new new Class({Load:function(n){new Request.JSON({url:n||"./lang.json?ran="+(new Date).getTime(),onComplete:this._process,onError:this._loadFailed,onFailure:this._loadFailed}).get()},CheckPath:function(n){for(var i=Affinity.languages.english,r=n.replace("l:","").replace("join:","").split("."),t=0;t<r.length;t++)i.hasOwnProperty(r[t])&&(i=i[r[t]]);return i?!0:!1},ReturnPath:function(n){for(var t=Affinity.languages.english,r=n.replace("l:","").replace("join:","").split("."),i=0;i<r.length;i++)t.hasOwnProperty(r[i])&&(t=t[r[i]]);return t?t:null},_returnIcon:function(n,t){for(var i=window,u=t.replace("i:","").split("."),r=0;r<u.length;r++)i.hasOwnProperty(u[r])&&(i=i[u[r]]);return i&&typeof i=="string"?n.replace("{{"+t+"}}",i):n},_returnLabel:function(n,t){for(var i=Affinity.languages.english,f=t.contains("join:"),u=t.replace("l:","").replace("join:","").split("."),r=0;r<u.length;r++)i.hasOwnProperty(u[r])&&(i=i[u[r]]);if(i||i===""){if(f&&Array.isArray(i))return n.replace("{{"+t+"}}",i.join(" "));if(!f&&(typeof i=="string"||typeof i=="number"))return n.replace("{{"+t+"}}",i)}return n},_retuenMethodRef:function(n,t){for(var i=window,u=t.replace("m:","").split("."),r=0;r<u.length;r++)i.hasOwnProperty(u[r])&&(i=i[u[r]]);return i&&typeof i=="function"?i:function(){}},_processString:function(n){var u,i,r,t,f;if(n.contains("{{")&&n.contains("}}")&&(u=/[^{{\}}]+(?=}})/g,i=n.match(u),i!==null))for(r=0;r<i.length;r++){t=i[r],f=t.substr(0,2);switch(f){case"i:":n=this._returnIcon(n,t);break;case"l:":n=this._returnLabel(n,t);break;case"m:":n=this._retuenMethodRef(n,t)}}return n},_check:function(n){if(typeof n=="object")for(key in n)typeof n[key]=="object"?this._check(n[key]):typeof n[key]=="string"&&(n[key]=this._processString(n[key]));return n},_process:function(n){n.hasOwnProperty("languages")&&n.languages.hasOwnProperty("english")&&typeof n.languages.english=="object"&&(Affinity.languages.english=Affinity.DeepMergeObjects([Affinity.languages.english,n.languages.english]),Affinity.languages.english=this._check(Affinity.languages.english)),window.fireEvent("langComplete")},_loadFailed:function(){window.fireEvent("langComplete")},initialize:function(){},Binds:["Load","CheckPath","ReturnPath","_returnIcon","_returnLabel","_retuenMethodRef","_processString","_check","_process","_loadFailed"]}),Affinity.FavResultSort=function(n,t,i){var e=function(n,t){return n.sort(function(n,i){var r=(n[t]+"").toUpperCase(),u=(i[t]+"").toUpperCase();return r<u?-1:r>u?1:0}),n},r,u,f;if(t=t||"Name",i=i||!1,i){if(n.length>0&&n[0].hasOwnProperty(t)&&n[0].hasOwnProperty(i))return r={},f=[],n.forEach(function(n){u=(n[i]+"").trim().replace(/\s/g,""),r.hasOwnProperty(u)||(r[u]=[]),r[u].push(n)}),Object.keys(r).sort().forEach(function(n){e(r[n],t).forEach(function(n){f.push(n)})}),f}else if(n.length>0&&n[0].hasOwnProperty(t))return e(n,t);return n},Affinity.FavNameValidation=function(n){var t={isValid:!0,error:!1},r;if(Affinity.Lang.CheckPath("features.favourites.validation")&&Affinity.Lang.CheckPath("application.timesheets.features.favourites")){var u=Affinity.languages.english.features.favourites.validation,i=Affinity.languages.english.application.timesheets.features.favourites,f=u.illegalchars,s=u.max,h=u.min,e=i.illegalMessage,c=i.badMessage,l=i.tooLongMessage,o=i.tooShortMessage;if(n.length===0||n===null||n===undefined)return t.isValid=!1,t.error=o,t;if(f&&e)for(r=f.length-1;r>-1;r--)if(n.indexOf(f[r])!==-1)return t.isValid=!1,t.error=e,t;if(new RegExp(/^\d+$/).test(n.trim())||!isNaN(parseInt(n.trim().charAt(0))))return t.isValid=!1,t.error=c,t;if(n.trim().length>s)return t.isValid=!1,t.error=l,t;if(n.trim().length<h)return t.isValid=!1,t.error=o,t}return t},Affinity.CheckFavError=function(n,t){var r=n.hasOwnProperty("error"),u=r?typeof n.error=="string":!1,f=u?n.error!=="":!1,i=f?n.error:typeof n=="string"?n:t;return(isNotUnique=i.toUpperCase().contains("UNIQUE KEY")?!0:!1,isNotUnique=i.toLowerCase().contains("already exists")?!0:isNotUnique,isNotUnique)?Affinity.languages.english.application.timesheets.features.favourites.alreadyExistsError:n.error.contains("Not found")?n.error.replace("Not found","Could not find:<br />"):t},Affinity.ShowMasterLoader=function(n){time=typeof n=="number"?n:!1,time?setTimeout(function(){document.querySelector("body").classList.add("newload-lock")},time):document.querySelector("body").classList.add("newload-lock")},Affinity.HideMasterLoader=function(n){time=typeof n=="number"?n:!1,time?setTimeout(function(){document.querySelector("body").classList.remove("newload-lock")},time):document.querySelector("body").classList.remove("newload-lock")},Affinity.FeatureChecks={ScrollBarWidth:function(){var t,n,r,i;return t=document.createElement("p"),t.style.width="100%",t.style.height="200px",n=document.createElement("div"),n.style.position="absolute",n.style.top="0px",n.style.left="0px",n.style.visibility="hidden",n.style.width="200px",n.style.height="150px",n.style.overflow="hidden",n.appendChild(t),document.body.appendChild(n),r=t.offsetWidth,n.style.overflow="scroll",i=t.offsetWidth,r==i&&(i=n.clientWidth),document.body.removeChild(n),Affinity.scrollBarSize=r-i,Affinity.scrollBarSize},DatalistTest:function(){var n=document.createElement("datalist");n&&"options"in n&&(Affinity.supportsDatalist=!0),n=null},PassiveEvents:function(){var n=!1;try{document.addEventListener("test",null,{get passive(){n=!0}})}catch(t){}Affinity.supportsPassiveEvents=n},TypeDetection:function(){var n=document.body.classList;Affinity.ismac=n.contains("mac")?!0:!1,Affinity.isie=n.contains("ie")?!0:!1,Affinity.isEdge=n.contains("ieedge"),Affinity.isie&&(Affinity.ieversion=Browser.version),Affinity.isie&&(Affinity.iedocmode=document.documentMode?document.documentMode:!1),Affinity.ismobile=n.contains("mobile")?!0:!1,Affinity.mobile&&(Affinity.ismobile=!0),Affinity.isTeampayoffice=window.location.href.toLowerCase().indexOf("teampayoffice")!==-1?!0:!1,Affinity.isTeampayofficeBranch=Affinity.isTeampayoffice?window.location.href.toLowerCase().indexOf("/tb")!==-1?!0:!1:!1,Affinity.isie&&Affinity.iedocmode===8&&document.getElementsByTagName("body")[0].classList.add("ie8"),Affinity.isie&&Affinity.iedocmode===9&&document.getElementsByTagName("body")[0].classList.add("ie9"),Affinity.isie&&Affinity.iedocmode===10&&document.getElementsByTagName("body")[0].classList.add("ie10"),Affinity.isie&&!Affinity.isEdge&&Affinity.iedocmode<11&&document.getElementsByTagName("body")[0].classList.add("not-supported")},DashboardWrapper:function(){for(var r=["Dashboard","dashboard","IsDashboard","isDashboard","isdashboard","HasDashboard","hasDashboard","hasdashboard"],t=!1,i=0,n;i<r.length;i++)n=r[i],Affinity.hasOwnProperty(n)&&(typeOf(Affinity[n])==="boolean"?Affinity[n]!==!1&&(t=!0):typeOf(Affinity[n])!=="null"&&typeOf(Affinity[n])==="string"&&Affinity[n].trim()!==""&&(t=Affinity[n].trim().toLowerCase()==="true"));return"hasDashboardWrapper"in Affinity||(Affinity.hasDashboard=t,Affinity.hasDashboardWrapper=function(){return Affinity.hasDashboard}),t},CheckWebWorkers:function(){Affinity.hasOwnProperty("CheckForWorkers")||(Affinity.CheckForWorkers=!0),Affinity.CheckForWorkers&&(Affinity.CheckForWorkers=Affinity.isie&&Affinity.ieversion<=11?!1:Affinity.CheckForWorkers),Affinity.CheckForWorkers&&(Affinity.supportsWebWorkers=typeof Worker!="undefined"?!0:!1),delete Affinity.CheckForWorkers},CheckElementClosest:function(){Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest||(Element.prototype.closest=function(n){var t=this;if(!document.documentElement.contains(t))return null;do{if(t.matches(n))return t;t=t.parentElement||t.parentNode}while(t!==null&&t.nodeType===1);return null})},CheckForArrayForEach:function(){Array.prototype.forEach||(Array.prototype.forEach=function(n){var r,t,i,u,f;if(this==null)throw new TypeError("this is null or not defined");if(i=Object(this),u=i.length>>>0,typeof n!="function")throw new TypeError(n+" is not a function");for(arguments.length>1&&(r=arguments[1]),t=0;t<u;)t in i&&(f=i[t],n.call(r,f,t,i)),t++}),window.NodeList&&!NodeList.prototype.forEach&&(NodeList.prototype.forEach=Array.prototype.forEach)}},Affinity.TimesheetsReady=function(){return},Affinity.SessionLoginExists=function(){return Affinity.hasOwnProperty("login")&&Affinity.login!==null?!0:!1},Affinity.SessionLoginReady=function(){return Affinity.SessionLoginExists()&&Affinity.login.hasOwnProperty("ready")&&typeof Affinity.login.ready=="boolean"&&Affinity.login.ready===!0?!0:!1},Affinity.PageReady=function(){"onreadystatechange"in document?document.onreadystatechange=null:document.removeEventListener("DOMContentLoaded",Affinity.PageReady,!1),window.removeEventListener("PageReady",Affinity.PageReady,!1),Object.keys(Affinity.FeatureChecks).map(function(n){Affinity.FeatureChecks[n]()}),Affinity.apiversion>1?(Affinity.zelosroot=Affinity.zelosroot,Affinity.lookupapi=Affinity.zelosroot+"?api=Lookup/Get"):Affinity.lookupapi=Affinity.zelosroot+"?api=Lookup/Get",Affinity.EstablishAutosrollOnDragEvents(),Affinity.refreshControll={},Affinity.refreshControll.initialLoad=!0,Affinity.refreshControll.lastRefresh=(new Date).getTime(),window.addEvent("keydown",function(n){if(n.key==="f5"||n.key==="F5"||n.control&&(n.key==="r"||n.key==="R")){var t=(new Date).getTime(),i=Affinity.refreshControll.initialLoad?7e3:5e3;t-Affinity.refreshControll.lastRefresh<i&&(n.stop(),uialert({message:"Refreshing this often can slow things down.<br />If you believe the page is not responding,<br />please contact Affinity Help desk.",showButtons:!0})),Affinity.refreshControll.lastRefresh=(new Date).getTime(),Affinity.refreshControll.initialLoad=!1}}),function(){var n,t=function(){if(clearTimeout(n),document.body){if(Affinity.DarkMode=!1,Affinity.CookieMonster.Read("dark-mode")){var i=Affinity.CookieMonster.Read("dark-mode");typeof i=="string"&&(i=i.toLowerCase().trim()==="true"?!0:!1),Affinity.DarkMode=i}Affinity.DarkMode?document.body.classList.add("dark"):document.body.classList.remove("dark");return}n=setTimeout(t,10)};t(),window.addEventListener("keydown",function(n){n.ctrlKey&&n.altKey&&(n.key==="d"||n.key==="D")&&(Affinity.DarkMode=!Affinity.DarkMode,Affinity.CookieMonster.Write("dark-mode",Affinity.DarkMode),Affinity.DarkMode?document.body.classList.add("dark"):document.body.classList.remove("dark"))})}(),Affinity&&Affinity.isie&&Affinity.ieversion<9&&document.addEvent("keydown",function(n){(n.key===8||n.key==="backspace")&&(n.target.get("tag").test("select","gi")||n.target.disabled||n.target.readOnly)&&n.preventDefault()}),window.addEvent("userComplete",function(n){document.getElements(".displayname").set("html",n.commonName?n.commonName:n.displayName?n.displayName:"")});try{parent&&"parentFrameResize"in parent&&(window.addEvent("ResizeFrame",function(){var i,n,t;document.getElement(".content")&&(i=document.getElement(".content"),n=i.getScrollSize(),parent&&"parentFrameResize"in parent&&window.parent.window!==window&&(t=window.parent.window.innerWidth?window.parent.window.innerWidth-70:window.parent.window.document.body.offsetWidth-70,n.x=t&&t>0?t:1e3,parent.parentFrameResize({x:n.x,y:n.y+100})))}),window.fireEvent("ResizeFrame"),function(){window.fireEvent("ResizeFrame")}.delay(500))}catch(n){}Affinity.oldess&&Affinity.oldessFrame&&Affinity.agent.contains("Chrome")&&Affinity.agent.contains("Windows NT 6.2")&&window.addEvent("click",function(){document.getElement("body").className.contains("redraw")?(document.getElement("body").setStyle("width","100%"),document.getElement("body").classList.remove("redraw")):(document.getElement("body").setStyle("width","99.9%"),document.getElement("body").classList.add("redraw"))}),Affinity.essmessage="",function(){Affinity.oldess=!1;var t=new URI(window.location.href),n=typeOf(t.parsed.query)==="null"?{}:t.parsed.query.parseQueryString();("sessionKey"in n||"isEss"in n)&&(Affinity.oldess=!0,"iframe"in n&&(Affinity.oldessLaunched=!1,Affinity.oldessFrame=!0,Affinity.oldessWindow=window.parent),"external"in n&&(Affinity.oldessLaunched=!0,Affinity.oldessFrame=!1,Affinity.oldessWindow=window.opener),!Affinity.oldess||"external"in n||"iframe"in n||window.addEvent("UiReady",function(){Affinity.appname==="cleverforms"?(Affinity.oldessLaunched=!1,Affinity.oldessFrame=!0,Affinity.oldessWindow=window.parent):(Affinity.oldessLaunched=!0,Affinity.oldessFrame=!1,Affinity.oldessWindow=window.opener)}))}(),Affinity.IeWarning=function(){if(typeof window.masterMessage!="undefined"&&Affinity.isie&&Affinity.ieversion<Affinity.minIEVersion){var t=Affinity.minIEVersion<12?"IE"+Affinity.minIEVersion:"Edge",n="";n+='<strong class="color red large">Warning!<\/strong><br /><br />',n+="We do not support Internet Explorer "+(Affinity.minIEVersion-1)+" and less.<br />",n+="Some functionality may not work.<br /><br />",n+='We recommend <a href="https://www.google.com/chrome/browser/desktop/" target="_blank" class="color green">Chrome<\/a> or updating to at least '+t+".<br /><br />",n+="Continue at your own risk.",masterMessage({message:n,okText:"Accept and Continue"})}window.removeEvent("UiReady",Affinity.IeWarning),Affinity.IeWarning=null,delete Affinity.IeWarning},window.addEvent("UiReady",Affinity.IeWarning),Affinity.debug&&console.info("<< affinity ready >>"),setTimeout(function(){Affinity.Tests=null,delete Affinity.Tests,Affinity.debug&&console.info("\taffinity detections cleaned up"),Affinity.PageReady=null,delete Affinity.PageReady,Affinity.debug&&console.info("\taffinity cleaned up")},1e3),Affinity.hasLangFile?(window.addEvent("langComplete",function(){Affinity.debug&&console.info("\tlang loaded and processed"),Affinity.commonsReady=!0,window.fireEvent("AffinityReady")}),Affinity.Lang.Load(Affinity.langFilePath+"?last="+Affinity.langFileAge)):(Affinity.commonsReady=!0,window.fireEvent("AffinityReady"))},Affinity.MobileDetect={Start:function(){Affinity.Browser={userAgent:navigator.userAgent,platform:"Unknown",renderer:"Unknown",name:"Unknown",version:"?",major:-1,minor:-1,device:!1,isie:!1,isedge:!1,isfirefox:!1,issafari:!1,ischrome:!1,ismobile:!1,isandroid:!1,ismac:!1,isipad:!1,istablet:!1,widemode:!1},document.querySelector("body")?Affinity.MobileDetect.getBrowser():setTimeout(Affinity.MobileDetect.checkBody,10)},checkBody:function(){document.querySelector("body")?Affinity.MobileDetect.getBrowser():setTimeout(Affinity.MobileDetect.checkBody,10)},getBrowser:function(){let t=function(){let t=new UAParser,n=t.getResult();Affinity.Browser.platform=n.os.name+(n.os.version!==undefined?" "+n.os.version:""),Affinity.Browser.renderer=n.engine.name,Affinity.Browser.name=n.browser.name,Affinity.Browser.version=n.browser.version,Affinity.Browser.major=parseInt(n.browser.major),Affinity.Browser.minor=n.browser.version.replace(n.browser.major,""),Affinity.Browser.minor=Affinity.Browser.minor.indexOf(".")===0?Affinity.Browser.minor.substr(1):Affinity.Browser.minor,Affinity.Browser.minor=Affinity.Browser.minor.indexOf("0.")===0?Affinity.Browser.minor.substr(2):Affinity.Browser.minor,Affinity.Browser.minor=parseFloat(Affinity.Browser.minor),Affinity.Browser.name.toLowerCase().contains("ie")&&(Affinity.Browser.isie=!0),Affinity.Browser.name.toLowerCase().contains("edge")&&(Affinity.Browser.isedge=!0),Affinity.Browser.name.toLowerCase().contains("chrome")&&(Affinity.Browser.ischrome=!0),Affinity.Browser.name.toLowerCase().contains("safari")&&(Affinity.Browser.issafari=!0),Affinity.Browser.name.toLowerCase().contains("firefox")&&(Affinity.Browser.isfirefox=!0),Affinity.Browser.platform.toLowerCase().contains("android")&&(Affinity.Browser.isandroid=!0),Affinity.Browser.platform.toLowerCase().contains("mac")&&(Affinity.Browser.ismac=!0),Affinity.Browser.platform.toLowerCase().contains("ios")&&(Affinity.Browser.ismac=!0),n.device.model!==undefined&&n.device.model.toLowerCase().contains("ipad")&&(Affinity.Browser.isipad=!0),Affinity.Browser.isipad&&!Affinity.Browser.ismac&&(Affinity.Browser.ismac=!0),Affinity.MobileDetect.getWurfl()},i=function(n){console.warn("UAParser failed to load"),console.warn(n),Affinity.MobileDetect.getWurfl()},n=document.createElement("script");n.type="text/javascript",n.nonce="a9e3b03a6fd6ba6582578c3ad5393ee54b2b6acb==",n.readyState?n.onreadystatechange=function(){n.readyState==="loaded"||n.readyState==="complete"?(n.onreadystatechange=null,t()):console.log(n.readyState)}:(n.onload=t,n.onerror=i),n.setAttribute("src","https://cdnjs.cloudflare.com/ajax/libs/UAParser.js/0.7.20/ua-parser.min.js"),document.head.appendChild(n)},getWurfl:function(){let n=document.createElement("script"),i=document.querySelector("body");n.type="text/javascript",n.src=document.location.protocol+"//wurfl.io/wurfl.js",n.nonce="a9e3b03a6fd6ba6582578c3ad5393ee54b2b6acb==";var t=function(){var t,n;Affinity.Browser.widemode=window.innerWidth>=1024,Affinity.Browser.ismobile||("ontouchstart"in window||navigator.maxTouchPoints>0||navigator.msMaxTouchPoints>0)&&(Affinity.Browser.ismobile=!0),t=!1,navigator.platform==="MacIntel"&&(Affinity.Browser.ismac=!0),!Affinity.Browser.ismobile&&(Affinity.Browser.platform.toLowerCase().contains("ios")||Affinity.Browser.platform.toLowerCase().contains("android"))&&(Affinity.Browser.ismobile=!0),Affinity.Browser.ismobile&&Affinity.Browser.widemode&&(Affinity.Browser.istablet=!0),Affinity.Browser.istablet&&Affinity.Browser.ismac&&(Affinity.Browser.isipad=!0),Affinity.Browser.istablet&&Affinity.Browser.widemode&&!Affinity.Browser.isipad&&(Affinity.Browser.ismobile=!1),n=document.body,n.classList.remove("mobile","tablet","desktop","edge","ie","firefox","mac","wide-mode"),(!Affinity.Browser.ismobile||Affinity.Browser.istablet&&Affinity.Browser.widemode&&!Affinity.Browser.isipad)&&n.classList.add("desktop"),n.classList.contains("desktop")||(Affinity.Browser.ismobile&&n.classList.add("mobile"),Affinity.Browser.istablet&&n.classList.add("tablet"),Affinity.Browser.istablet&&Affinity.Browser.widemode&&n.classList.add("wide-mode")),Affinity.Browser.ismac&&n.classList.add("mac"),Affinity.Browser.isipad&&n.classList.add("ipad"),Affinity.Browser.isie&&!isNaN(parseInt(Affinity.Browser.major))&&n.classList.add("ie"+parseInt(Affinity.Browser.major)),Affinity.Browser.isedge&&n.classList.add("edge"),Affinity.Browser.isfirefox&&n.classList.add("firefox"),Affinity.mobile=Affinity.ismobile=Affinity.IsMobile=Affinity.isMobile=Affinity.Browser.ismobile,Affinity.mobile&&Affinity.hasOwnProperty("EnableMobile")&&Affinity.EnableMobile(),window.dispatchEvent(new Event("MobileChecked")),Affinity.PageReady()};n.onload=function(){Affinity.MobileChecked=!0,Affinity.Browser.ismobile=WURFL.is_mobile,Affinity.Browser.device=WURFL.form_factor.toLowerCase(),t()},n.onerror=function(){console.error("WURFL failed to load"),Affinity.MobileChecked=!0,Affinity.Browser.ismobile=!1,Affinity.Browser.device="unknown",t()},i.appendChild(n)}},window.addEventListener("PageReady",Affinity.PageReady,!1),"onreadystatechange"in document?document.onreadystatechange=function(){document.readyState=="interactive"&&Affinity.MobileDetect.Start()}:document.addEventListener("DOMContentLoaded",Affinity.PageReady,!1),Affinity.log=!0,Affinity.prettyuploads=!0,Affinity.selectToAutoNum=0,Affinity.selectmax=2e3,Affinity.enableSelectLimit=!0,Affinity.disableAutoPageReady=!1,Affinity.showProdConsole=!1,Affinity.minIEVersion=11,window.config=document.config=Affinity;var UIAutoComplete=new Class({Version:"1.0.20.0",Sequence:1010,File:"ui.autocomplete.js",Name:"Autocomplete",Jira:"",Notes:"Fix position issues",Implements:[Options],Binds:["processNew","doAutoComplete","hideAll"],options:{},widgets:{},initialize:function(n){this.setOptions(n),Affinity.UI.autocomplete||(Affinity.UI.autocomplete={}),Affinity.UI.lastAutoKill={},typeOf(Affinity.UI.ghostFocus)==="null"&&(Affinity.UI.ghostFocus=new Element("input",{type:"text"}),new Element("div",{"class":"subhidden"}).adopt(Affinity.UI.ghostFocus).inject(document.body,"bottom")),window.autocompletes=this,this.processNew()},processNew:function(){Array.each(document.getElements(".ui-autocomplete"),function(n){n.hasClass("has-lookup")||n.hasClass("lookup-loading")||(n.removeClass("ui-autocomplete"),ac=Affinity.mobile&&"UIAutoCompleteMobileWidget"in window?new UIAutoCompleteMobileWidget({selectElement:n}):new UIAutoCompleteWidget({selectElement:n}),this.widgets[ac.uuid]||(this.widgets[ac.uuid]=ac))}.bind(this))},doAutoComplete:function(n){var t=new UIAutoCompleteWidget({selectElement:n});this.widgets[t.uuid]||(this.widgets[t.uuid]=t)},hideAll:function(n){Object.each(this.widgets,function(t){typeOf(n)!=="null"&&n.uuid?t.uuid!==n.uuid&&t.hide("master hide all"):t.hide("master hide all")}.bind(this))}}),UIAutoCompleteWidget=new Class({WidgetName:"AutoComplete",debug:!1,Implements:[Options,Events],Binds:["fuzzyWorkerComplete","cleanDisplay","processOptions","updateOptions","stopEvent","getValue","setValue","getDisplayValue","scrolled","position","doPosition","windowClickStart","windowClickEnd","listOver","listOut","elementOver","elementOut","doFocus","doClick","doKeyUp","doKeyDown","fuzzySearch","continueWithFuzzySearch","itemClicked","escapeRegExp","defaultSelected","isDefaultSelected","forceDefaultSelection","obscure","reveal","hide","show","restoreSelectedList","clearList","revert","destroy","searchMode_fireChangeEvents","searchMode_valueToOption","searchMode_iconClicked","searchMode_displayBlur"],options:{stopInitialChange:!1,selectElement:null,keeplist:!1,elementChangedOnly:!1,debug:!1},webworkerpath:"./scripts/common/ui.autocomplete.web.worker.js",list:[],selectElement:null,listElement:null,displayElement:null,changed:!1,defaultChangeValue:null,center:!1,autowidth:!1,uuid:"",killid:"",type:"autocomplete",enabled:!0,postListWorkerData:!1,waithForListElement:!1,debug:!1,initialize:function(n){var t,i;if(Affinity.mobile&&"UIAutoCompleteMobileWidget"in window)return new UIAutoCompleteMobileWidget(n);this.setOptions(n),this.options.debug&&(this.debug=this.options.debug),this.useWebWorkers=Affinity.supportsWebWorkers,this.useWebWorkers&&(this.fuzzyWorker=new Worker(this.webworkerpath),this.fuzzyWorker.onmessage=this.fuzzyWorkerComplete),this.searchMode=!1,Affinity&&Affinity.mobile&&(this.searchMode=!0),this.icons={},this.icons.search=Affinity.icons.Search,this.selectElement=this.options.selectElement,this.selectElement.parentNode.classList.contains("select")&&(t=this.selectElement.parentNode,t.parentNode.insertBefore(this.selectElement,t),t.parentNode.removeChild(t)),this.selectElement.innerHTML.test(/\<option value=".*"\>\<all\>\<\/all\>\<\/option\>/gi)&&(this.selectElement.innerHTML=this.selectElement.innerHTML.replace(/\<option value="(.*)"\>\<all\>\<\/all\>\<\/option\>/gi,'<option value="$1">All<\/option>')),this.selectElement.hasClass("ui-autocomplete-center")&&(this.center=!0),this.selectElement.hasClass("ui-autocomplete-autowidth")&&(this.autowidth=!0),this.bestguess=null,this.selectElement.set("tabindex",5e3),this.hiddenWrapper=new Element("div",{"class":"subhidden"}).inject(this.selectElement,"after"),this.selectElement.inject(this.hiddenWrapper),this.uuid=this.selectElement.get("id")===null?String.uniqueID():this.selectElement.get("id"),this.killid="ac-destroy-"+String.uniqueID(),this.fieldType=this.selectElement.get("id")?this.selectElement.get("id").substring(this.selectElement.get("id").lastIndexOf("-")+1):"none",window.autocompletes.widgets[this.uuid]||(window.autocompletes.widgets[this.uuid]=this),this.selectElement.set("id",this.uuid),i=this.processOptions.delay(100,this),this.selectElement.store("widget",this),this.valuetracker=this.selectElement.retrieve("changetracker")?this.selectElement.retrieve("changetracker"):new Affinity.ElementValueTracker,this.valuetracker.addElement(this.selectElement),Affinity.supportsPassiveEvents?document.addEvent("scroll",this.scrolled,{passive:!0}):document.addEvent("scroll",this.scrolled,!1),document.addEvent("resize",this.position),this.debug&&(console.log("! START Debug Enabled !"),console.log("! Autocomplete "+this.uuid+" !"),console.log(this.selectElement),console.log(this.listElement),console.log(this.displayElement),console.log("! END Debug Enabled !"))},fuzzyWorkerComplete:function(n){var t=n.data,i,r;this.debug&&(console.log("! Autocomplete fuzzyWorkerComplete: "),console.log("! \t returned data : ",n),console.log("! \t job           : ",t.job));switch(t.job){case"getOptions":this.searchMode&&(this.massiveSelect.innerHTML=t.html,Affinity.prompts.adopt(this.massiveSelect),this.massiveSelect.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:this.massiveSelect,onComplete:function(n){this.massiveLoader.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),n.position()}.bind(this)}));break;case"getList":if(!this.enabled)return!1;i=null,this.listElement&&(this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,this.position(0,"worker getList"),this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),t.data.defaultID&&(i=this.listElement.getElement("#"+n.data.data.defaultID),this.defaultValue=i,this.lastSelected=i,this.defaultChangeValue=i.get("data-value")),this.continueProcessOptions(i));break;case"getSelectedList":this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,this.position(0,"worker getSelectedList"),this.fuzzySearchItemsTotal=t.data.items.length,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked);break;case"resetList":this.listElement.innerHTML=t.html,this.position(0,"worker resetList"),this.iconElement&&this.iconElement.removeClass("working"),t.select&&(this.lastSelected=document.id(t.select),this.defaultValue=document.id(t.select),this.bestguess=document.id(t.select),this.selectElement.value=""),this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.defaultValue.value,this.fuzzySearchItemsTotal=t.data.total,this.fuzzySearchItems=t.data.items,this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked),window.fireEvent("elementChanged",{element:this.selectElement});break;case"doSearch":if(!this.enabled)return!1;r=[],this.listElement.getElements("li")&&this.listElement.getElements("li").removeEvent(Affinity.events.click,this.itemClicked),this.listElement.innerHTML=t.html,this.position(0,"worker doSearch"),t.bestguess&&(this.bestguess=document.id(t.bestguess)),this.iconElement&&this.iconElement.removeClass("working"),this.items=this.listElement.getElements("li"),this.items.addEvent(Affinity.events.click,this.itemClicked);break;case"terminate":this.fuzzyWorker.onmessage=null,this.fuzzyWorker.terminate(),this.fuzzyWorker=!1}},cleanDisplay:function(n){return typeOf(n)==="string"&&n.trim()!==""?n.trim().replace(/&amp;/gi,"&"):n},getValue:function(){return this.selectElement.value},setValue:function(n,t){var r,i;if(!this.enabled)return!1;if(t=t||!0,n=this.cleanDisplay(n),typeOf(this.listElement)!=="null")if(this.searchMode)this.datalistElement.getElement("option[value="+n+"]")&&(this.displayElement.value=n,this.mobileChange());else{if(!n||n===""||typeOf(this.fuzzySearchItems)==="null"||this.fuzzySearchItems===!1){this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t});return}for(r=!1,i=0;i<this.fuzzySearchItems.length;i++)if(this.fuzzySearchItems[i].value+""==n+""){r=document.id(this.fuzzySearchItems[i].id);break}r?this.itemClicked({target:r,fireEvents:t}):this.itemClicked({target:this.listElement.getElement("li"),fireEvents:t})}},getDisplayValue:function(){return this.cleanDisplay(this.displayElement.value)},status:"closed",searchMode_firstPass:!0,searchMode_lastKnownValue:"",searchMode_fireChangeEvents:function(n){this.changed=typeOf(n)==="boolean"&&n===!0?!0:!1,this.defaultChangeValue!==this.selectElement.value&&(this.defaultChangeValue=this.selectElement.value,this.changed=!0),!this.searchMode_firstPass&&this.changed&&this.searchMode_lastKnownValue===this.selectElement.value&&(this.changed=!1),this.changed&&(this.defaultChangeValue=this.selectElement.value,this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete search mode"})),this.searchMode_firstPass=!1},searchMode_valueToOption:function(n,t,i){var u,r;if(i=i||!1,this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key"))this.selectElement.empty(),new Element("option",{value:n,html:t}).inject(this.selectElement),this.selectElement.value=n,this.selectElement.selectedIndex=0;else for(this.selectElement.value=n,u=this.selectElement.getElements("options"),r=0;r<u.length;r++)if(u[r].value===n){this.selectElement.selectedIndex=r;break}this.displayElement.value=n,this.displayElement.store("data-search-value",n),this.searchMode_fireChangeEvents(i)},searchMode_iconClicked:function(){var t=this.cleanDisplay(this.displayElement.value),n,i;!Affinity.mobile&&t.trim()!==""&&t.length>1||Affinity.mobile?(n=new Element("select",{"class":"override ui-autocomplete-center hidden"}),i=new Element("span",{html:'Loading list <img src="'+Affinity.loaders.dark+'" />'}),uialert({message:"Set Value<br /><br />",showButtons:!0,showCancel:!0,canClose:!Affinity.mobile,position:{position:"fixed",top:10},onOk:function(){var n=document.id("UIPromtBox").getElement("select"),i=n.selectedIndex||0,r=n.getElements("option"),t=r[i],u=t.get("value");this.searchMode_valueToOption(t.get("value"),t.get("html"),!0),n.getWidget()&&n.getWidget().destroy(),n.destroy()}.bind(this),onCancel:function(){n.getWidget()&&n.getWidget().destroy(),n.destroy()},onClose:function(){n.getWidget()&&n.getWidget().destroy(),n.destroy()}}),Affinity.prompts.adopt(i),Affinity.prompts.hideButtons(),function(){if(this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")){var e,r=this.selectElement.retrieve("data-store"),u=this.selectElement.retrieve("data-key"),f=Affinity.UI[r][u].api;f=f.contains("limit")?f.substr(0,f.indexOf("limit")-1):f,Affinity.UI[r][u].data.length===0?new Request.JSONP({callbackKey:"jsoncallback",url:f,method:"get",timeout:3e4,onComplete:function(f){JSON.Unauthorized(f,Affinity.UI[r][u].id+", lookup massive loader")||("error"in f?i.set("html","Failed loading list. Please refresh and try again."):typeOf(f)==="array"&&f.length>0&&(Affinity.UI[r][u].data=f,Affinity.UI[r][u].loaded=!0,this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[r][u].data,function(i){(i.Value.toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(e=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(n),i.Value===t&&e.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),n.position()}}))))}.bind(this),onError:function(){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onFailure:function(){i.set("html","Failed loading list. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this),onTimeout:function(){i.set("html","List loader timed out. Please refresh and try again."),Affinity.prompts.showButtons()}.bind(this)}).send():this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(Affinity.UI[r][u].data,function(i){(i.Value.toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(e=new Element("option",{value:i.Key,html:this.cleanDisplay(i.Value)}).inject(n),i.Value===t&&e.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),n.position()}}))}else this.useWebWorkers?(this.massiveSelect=n,this.massiveLoader=i,this.fuzzyWorker.postMessage({job:"getOptions",data:Affinity.UI[r][u].data,searchFor:t,ismobile:Affinity.mobile})):(Array.each(this.selectElement.getElements("option"),function(i){(i.get("html").stripTags().toLowerCase().indexOf(t.toLowerCase())>-1||Affinity.mobile)&&(i=new Element("option",{value:i.get("value")?i.get("value"):i.get("html").stripTags(),html:this.cleanDisplay(i.get("html"))}).inject(n),i.get("html")===t&&i.set("selected","selected"))}.bind(this)),Affinity.prompts.adopt(n),n.removeClass("hidden"),new UIAutoCompleteWidget({selectElement:n,onComplete:function(n){i.destroy(),Affinity.prompts.center(),Affinity.prompts.showButtons(),Affinity.prompts.show(),n.position()}}))}.delay(300,this)):t.trim()!==""&&t.length===1?uialert({message:"You must enter more than 1 character",showButtons:!0}):uialert({message:"You must enter a search term",showButtons:!0})},searchMode_displayBlur:function(){var t=this.cleanDisplay(this.displayElement.value),n=this.displayElement.retrieve("data-search-value");(n===""||t!==n)&&(n=t),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.selectElement.empty(),this.searchMode_valueToOption(n,t))},updateOptions:function(){this.clearList(),this.processOptions()},processCount:0,processOptions:function(){var i,r,u,f,n,o,e,t,s;return typeOf(this.selectElement)==="null"||!this.selectElement||!("getElements"in this.selectElement)?!1:(i=!1,r=this.selectElement.getElements("option"),(r.length>Affinity.selectmax||this.selectElement.hasClass("massive"))&&(this.searchMode=!0),this.searchMode&&this.selectElement.hasClass("override")&&(this.searchMode=!1),u=!0,f=!0,this.searchMode?(n=this.uuid,Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display").inject(this.hiddenWrapper,"before"),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),u=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),u&&(this.displayElement=new Element("input",{type:"text","class":"ui-autocomplete-display",id:n+"-Display"}).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.killid),n=this.uuid+"_icon",Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),f=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),f&&(this.iconElement=new Element("span",{"class":"ui-autocomplete-display-icon searchmode",id:n+"-Display-Icon",html:Affinity.icons.Search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.selectElement.hasClass("massive")&&this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")&&(this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label"))),this.selectElement.hasClass("massive")||(this.selectElement.addClass("massive"),this.displayElement.addEvent("blur",this.searchMode_displayBlur),this.iconElement.addEvent(Affinity.events.click,this.searchMode_iconClicked),this.selectElement.retrieve("data-store")&&this.selectElement.retrieve("data-key")?this.searchMode_valueToOption(this.selectElement.retrieve("data-value"),this.selectElement.retrieve("data-label")):r.length>0&&(o=this.selectElement.selectedIndex&&this.selectElement.selectedIndex>0?this.selectElement.selectedIndex:0,this.searchMode_valueToOption(r[o].get("value")||"",r[o].get("html")))),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.fireEvent("complete",this),i=!0):(this.displayElement?this.listElement.empty():(n=this.uuid,Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.displayElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid),this.displayElement.removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display").cloneEvents(this.selectElement),this.displayElement.destroyWidget("elementWidget"),this.displayElement.removeEvents(),u=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),u&&(this.displayElement=new Element("input",{type:"text","class":"ui-autocomplete-display",id:this.uuid+"-Display"}).cloneEvents(this.selectElement).inject(this.hiddenWrapper,"before")),this.displayElement.addClass(this.selectElement.get("class")),this.displayElement.addClass(this.killid),n=this.uuid+"_icon",Affinity.UI.lastAutoKill[n]&&(document.getElement("."+Affinity.UI.lastAutoKill[n].killid)&&(clearTimeout(Affinity.UI.lastAutoKill[n].destroy),this.iconElement=document.getElement("."+Affinity.UI.lastAutoKill[n].killid).removeClass(Affinity.UI.lastAutoKill[n].killid).set("id",n+"-Display-Icon").inject(this.hiddenWrapper,"before"),this.iconElement.removeEvents(),f=!1),Affinity.UI.lastAutoKill[n]=null,delete Affinity.UI.lastAutoKill[n]),f&&(this.iconElement=new Element("span",{"class":"ui-autocomplete-display-icon",id:n+"-Display-Icon",html:this.icons.search}).inject(this.displayElement,"after")),this.iconElement.addClass(this.killid+"_icon"),this.iconElement.removeClass("loading"),this.displayElement.makeFormElement(),this.displayElement.addClass("widget"),this.displayElement.store("widget",this),navigator.userAgent.toLowerCase().indexOf("firefox")>-1&&this.displayElement.set("autocomplete","off"),this.selectElement.hasClass("has-message-icon")&&this.displayElement.addClass("has-message-icon"),this.selectElement.set("data-display-id",this.uuid+"-Display"),this.listElement=new Element("ul",{"class":"ui-autocomplete-list",id:this.domid}).inject(document.body,"bottom"),this.autowidth&&this.listElement.addClass("auto-width"),Affinity.mobile?window.addEvent("mobileback",function(){this.hide()}.bind(this)):(new Affinity.SmartClose(this.displayElement),new Affinity.SmartClose(this.listElement),this.displayElement.addEvent("SmartClose",function(){this.listElement.isOver()||this.hide()}.bind(this)),this.listElement.addEvent("SmartClose",function(){this.displayElement.isOver()||this.hide()}.bind(this))),(this.displayElement.hasClass("width-auto")||this.displayElement.hasClass("width-full"))&&this.listElement.setStyle("width",this.displayElement.getSize().x),this.listElement.set("tween",{duration:100}),this.listElement.fade("hide"),this.displayElement.addEvent("focus",this.doFocus),this.listElement.set("tween",{duration:100,onComplete:function(n){n.getStyle("opacity")===0?n.addClass("hidden"):n.removeClass("hidden")}}),this.listElement.fade("hide")),this.items=[],this.fuzzySearchItems=[],s=null,this.defaultValue=null,this.useWebWorkers?(this.iconElement&&this.iconElement.addClass("working"),this.fuzzyWorker.postMessage({job:"getList",html:this.selectElement.innerHTML,defaultValue:this.selectElement.get("data-default-value")||!1,uuid:this.uuid}),i=!0):(Array.each(this.selectElement.getElements("option"),function(n,i){e=this.cleanDisplay(n.get("html").replace(/\,/g," - ")),value=n.get("value"),t=new Element("li",{html:e,"data-value":value,"class":"visible",id:this.uuid+"-li-"+i}),t.set("data-index",i),t.set("data-value",value),t.addEvent(Affinity.events.click,this.itemClicked),t.inject(this.listElement),n.selected&&(s=t,this.defaultValue=t,t.addClass("selected"),this.lastSelected=t,this.defaultChangeValue=n.value),this.items.push(t),this.fuzzySearchItems.push({id:this.uuid+"-li-"+i,html:e,klass:"visible",searchstr:e,value:n.value})}.bind(this)),i=this.continueProcessOptions(s))),i)},continueProcessOptions:function(n){return this.searchMode||(this.useWebWorkers||(this.fuzzySearchItemsTotal=this.fuzzySearchItems.length),this.iconElement&&this.iconElement.removeClass("working"),this.fuzzySearchLargeDataDelay=!1,!0&&(this.fuzzySearchLargeDataDelay=100),this.fuzzySearchItemsTotal>=2e3&&this.fuzzySearchItemsTotal<3e3&&(this.fuzzySearchLargeDataDelay=250),this.fuzzySearchItemsTotal>=3e3&&this.fuzzySearchItemsTotal<5e3&&(this.fuzzySearchLargeDataDelay=500),this.fuzzySearchItemsTotal>=5e3&&(this.fuzzySearchLargeDataDelay=1e3),Affinity.isie&&Affinity.ieversion===11&&(this.fuzzySearchLargeDataDelay=1001),this.defaultValue===null&&(this.defaultValue=this.listElement.getElement("li")),this.keyHeldCheck=!1,this.keyHeld=!1,this.keyHeldDelay=null,this.displayElement.addEvent("keyup",this.doKeyUp),this.displayElement.addEvent("keydown",this.doKeyDown),n!==null&&this.defaultSelected({target:n}),this.fireEvent("complete",this),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,this.options.stopInitialChange&&this.selectElement.fireEvent("change",{target:this.selectElement}),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this)),this.displayElement&&this.valuetracker.addElement(this.displayElement),!0},stopEvent:function(n){n.stop()},reset:function(){if(!this.searchMode){var n=!1;typeOf(this.defaultValue)!=="null"&&this.defaultValue&&this.defaultValue.get("tag")==="li"&&(n=this.defaultValue),typeOf(this.lastSelected)!=="null"&&this.lastSelected&&this.lastSelected.get("tag")==="li"&&(n=this.lastSelected),Array.each(this.items,function(t){t.inject(this.listElement),t.removeClass("selected"),t.removeClass("hidden"),t.addClass("visible"),this.fuzzySearchLargeDataDelay||t.set("html",this.cleanDisplay(t.get("html").stripTags())),n&&t===n&&(t.addClass("selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5),this.displayElement.value=this.cleanDisplay(n.get("html").stripTags()))}.bind(this))}},checkExists:function(){document.contains(this.selectElement)||(clearInterval(this.checkExistsPeriodical),this.destroy())},doFocusDelay:!1,doFocus:function(){if(!this.enabled)return!1;clearTimeout(this.doFocusDelay),this.doFocusDelay=function(){this.status=="closed"&&(this.position(0,"displayElement focus"),this.show("displayElement focus"))}.delay(100,this),Affinity.mobile&&(this.displayElement.selectionStart=0,this.displayElement.selectionEnd=999999)},doClick:function(n){if(!this.enabled)return!1;this.stopEvent(n),this.displayElement.select()},doKeyUp:function(n){if(!this.enabled)return!1;n.key=="tab"||n.shift||(n.key=="tab"&&this.hide("on key up tab"),clearTimeout(this.keyHeldDelay),this.keyHeld||this.elementKeyUp(n),this.keyHeld=!1,this.keyHeldCheck=!1)},doKeyDown:function(n){if(!this.enabled)return!1;if(n.key=="tab"&&this.hide("on key down tab"),n.key!="tab"){if(n.key=="enter"){this.stopEvent(n);return}if(n.key=="down"||n.key=="up"){if(this.keyHeldCheck||this.keyHeld){this.stopEvent(n);return}this.keyHeldCheck||this.keyHeld||(this.keyHeldCheck=!0,this.keyHeldDelay=this.elementKeySetHeld.delay(500,this,[n]))}}},elementKeySetHeld:function(n){this.keyHeld=!0,this.elementKeyUp(n)},getTopVisibleElement:function(){for(var i=this.listElement.getElements("li.visible"),t,r,n=0;n<i.length;n++)if(t=i[n],r=t.getPosition(this.listElement),r.y>0)return t},getBottomVisibleElement:function(){for(var u=this.listElement.getSize().y,i=this.listElement.getElements("li.visible"),t,r,n=i.length-1;n>0;n--)if(t=i[n],r=t.getPosition(this.listElement),r.y<u)return t},scrollToTop:function(n){var i=this.listElement.getScroll().y,t=n.getPosition(this.listElement).y,r=n.getSize().y;t<0&&this.listElement.scrollTo(0,i+t-r+10)},scrollToBottom:function(n){var u=this.listElement.getScroll().y,t=this.listElement.getSize().y,i=n.getPosition(this.listElement).y,r=n.getSize().y;i>t-r&&this.listElement.scrollTo(0,u+(i-t)+r+5)},escapeRegExp:function(n){return n.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")},fuzzyRunning:!1,fuzzySearch:function(n,t,i,r){var v,f,o,u,h,e,tt,l,y,k,p,s,w,a,d,g,nt,c,b;return this.enabled?this.fuzzyRunning?void 0:(this.fuzzyRunning=!0,v=[],this.useWebWorkers?(this.fuzzyDoSearchData={searchData:n,target:r},this.iconElement&&this.iconElement.addClass("working"),this.debug&&(console.log("! Autocomplete fuzzySearch: "),console.log("! \t target      : ",r),console.log("! \t search key  : ",t),console.log("! \t search for  : ",i),console.log("! \t search data : ",n)),this.fuzzyWorker.postMessage({job:"doSearch",data:n,searchKey:t,searchFor:i,perfDelay:this.fuzzySearchLargeDataDelay})):(f=[],isNaN(i)?Array.each(n,function(n,r){u=document.id(n.id),h=0,tt=[],i=i.toLowerCase(),l=n[t].toLowerCase().trim(),y=i===l,k=l.indexOf(i)>-1?!0:!1,w=i.split(" "),p=w.length,y?(s=p,e=99999,h=99999,this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c="<strong>"+this.cleanDisplay(u.get("html").stripTags())+"<\/strong>",u.set("html",c).removeClass("hidden").addClass("visible"))):!y&&k?(s=l.split(i).length-1||0,e=s,h=e+100,this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c=this.cleanDisplay(u.get("html").stripTags()).replace(new RegExp("("+this.escapeRegExp(i)+")","gi"),"<strong>$1<\/strong>"),u.set("html",c).removeClass("hidden").addClass("visible"))):this.fuzzySearchLargeDataDelay<1001&&(a=l.split(" "),s=0,Array.each(w,function(n){Array.each(a,function(t){n!=" "&&n!=""&&(d=n.soundex(),g=t.soundex(),nt=d.distance(g),nt==0&&(s+=1))})}),h=s,e=Number.round(s/p,2)||0,h>=0&&(this.fuzzySearchLargeDataDelay?u.removeClass("hidden").addClass("visible"):(c=this.cleanDisplay(u.get("html").stripTags()),u.set("html",c).removeClass("hidden").addClass("visible")))),o={originalIndex:r,score:h,wordScore:e},f.push(o)}.bind(this)):Array.each(n,function(n,r){u=document.id(n.id),n[t].contains(i)?(e=n[t].split(i).length-1||0,a=n[t].split(" "),f.push({originalIndex:r,score:e,wordScore:e/a}),u.removeClass("hidden").addClass("visible")):u.addClass("hidden").removeClass("visible")}),f.sort(function(n,t){return parseFloat(n.score)===parseFloat(t.score)?parseFloat(n.wordScore)<parseFloat(t.wordScore)?1:-1:parseFloat(n.score)<parseFloat(t.score)?1:-1}),b=!1,Array.each(f,function(t){o=n[t.originalIndex],o.score=t.score,o.wordScore=t.wordScore,v.push(o),u=document.id(o.id),t.score>0?(u.inject(r),b=!0):u.addClass("hidden").removeClass("visible")}),!b&&f.length>0&&f[0].originalIndex&&n[f[0].originalIndex]&&n[f[0].originalIndex].id&&(this.bestguess=document.id(n[f[0].originalIndex].id))),this.fuzzyRunning=!1,v):!1},elementKeyUp:function(n){if(!this.enabled)return!1;var i=this.cleanDisplay(this.displayElement.value.toLowerCase()),t=this.listElement.getElement("li.visible.selected")||!1;if(n.key=="enter"&&t){this.stopEvent(n),this.itemClicked({target:t});return}if(n.key=="down"||n.key=="up"){this.status=="closed"&&(this.position(null,"key up / down"),this.show("key up / down")),n.preventDefault(),n.key=="down"&&this.elementDown(n),n.key=="up"&&this.elementUp(n),this.keyHeld&&this.elementKeyUp.delay(50,this,[n]);return}if(n.code===8||n.code===16||n.code===32||n.code===46||n.code>=48&&n.code<=57||n.code>=65&&n.code<=90||n.code>=96&&n.code<=105)this.status=="closed"&&(this.position(null,"typing"),this.show("typing"));else return;if(this.debug&&(console.log("! Autocomplete keyup: "),console.log("! \t key code : ",n.code),console.log("! \t compare  : ",i)),i===""){this.useWebWorkers?this.fuzzyWorker.postMessage({job:"resetList"}):(Array.each(this.items,function(n){n.inject(this.listElement),n.set("html",this.cleanDisplay(n.get("html").stripTags())),n.removeClass("selected").removeClass("hidden").addClass("visible"),n.get("html").trim()===""&&(n.addClass("selected"),t!==n&&(this.changed=!0),this.lastSelected=n,this.defaultValue=n,this.selectElement.value="",this.selectElement.selectedIndex=0,this.listElement.scrollTo(0,0),this.defaultChangeValue=this.selectElement.getElements("option")[0].value)}.bind(this)),this.bestguess=this.defaultValue,window.fireEvent("elementChanged",{element:this.selectElement}));return}this.listElement.getElements("li").removeClass("selected"),this.listElement.scrollTo(0,0),t&&(this.lastSelected=t),this.fuzzySearchLargeDataDelay?(clearTimeout(this.fuzzySearchDelay),this.fuzzySearchDelay=this.continueWithFuzzySearch.delay(this.fuzzySearchLargeDataDelay,this)):this.continueWithFuzzySearch(),this.position(null,"element up")},continueWithFuzzySearch:function(){var n=this.fuzzySearch(this.fuzzySearchItems,"searchstr",this.cleanDisplay(this.displayElement.value.toLowerCase()),this.listElement);this.position(null,"continueWithFuzzySearch")},elementUp:function(){if(!this.enabled)return!1;if(this.listElement.getElements("li.visible").length===0){this.hide("elementUp with empty list");return}var r=this.listElement.getElement("li.visible.selected"),u=this.getTopVisibleElement(),n=this.getBottomVisibleElement(),t=-1,i=this.listElement.getElements("li.visible");r&&(t=i.indexOf(r),r.removeClass("selected")),t>i.indexOf(n)?n&&"addClass"in n&&n.addClass("selected"):t>0?i[t-1]&&"addClass"in i[t-1]&&(i[t-1].addClass("selected"),this.scrollToTop(i[t-1])):this.listElement.scrollHeight==this.listElement.clientHeight?n&&"addClass"in n&&n.addClass("selected"):u&&"addClass"in u&&u.addClass("selected"),window.fireEvent("elementChanged",{element:this.selectElement})},elementDown:function(){if(!this.enabled)return!1;if(this.listElement.getElements("li.visible").length===0){this.hide("elementDown with empty list");return}var r=this.listElement.getElement("li.visible.selected"),n=this.getTopVisibleElement(),u=this.getBottomVisibleElement(),t=-1,i=this.listElement.getElements("li.visible");r&&"addClass"in r&&(t=i.indexOf(r),r.removeClass("selected")),t<i.indexOf(n)?n&&"addClass"in n&&n.addClass("selected"):t<i.length-1?i[t+1]&&"addClass"in i[t+1]&&(i[t+1].addClass("selected"),this.scrollToBottom(i[t+1])):this.listElement.scrollHeight==this.listElement.clientHeight?n&&"addClass"in n&&n.addClass("selected"):u&&"addClass"in u&&u.addClass("selected")},defaultSelected:function(n){if(!this.enabled)return!1;if(n&&"target"in n){var t=this.cleanDisplay(n.target.get("html").stripTags());return this.listElement.getElements("li").removeClass("selected"),n.target.addClass("selected"),this.displayElement.value=t,this.selectElement.selectedIndex=n.target.get("data-index"),this.selectElement.value=n.target.get("data-value"),!0}return!1},isDefaultSelected:function(){return this.defaultValue&&(this.selectElement.value!==this.defaultValue.get("data-value")||this.displayElement&&this.displayElement.value!==this.defaultValue.get("html").stripTags())?!1:!this.defaultValue||!this.displayElement?!1:!0},forceDefaultSelection:function(){if(this.defaultValue&&this.selectElement&&this.displayElement){var n=this.cleanDisplay(this.defaultValue.get("html").stripTags());this.listElement.getElements("li").removeClass("selected"),this.defaultValue.addClass("selected"),this.displayElement.value=n,this.selectElement.selectedIndex=this.defaultValue.get("data-index"),this.selectElement.value=this.defaultValue.get("data-value")}},itemClicked:function(n){if(!this.enabled)return!1;this.hide("item clicked");var t=n.target.get("tag")=="li"?n.target:n.target.getParent("li"),i=n.hasOwnProperty("fireEvents")&&n.fireEvents===!1?!1:!0;this.listElement.getElements("li").removeClass("selected"),t.addClass("selected"),this.lastSelected=t,this.displayElement.value=this.cleanDisplay(t.get("html").stripTags()),this.selectElement.selectedIndex=t.get("data-index"),this.selectElement.value=t.get("data-value"),this.selectElement.value!==this.defaultChangeValue?(this.defaultChangeValue=this.selectElement.value,this.changed=!0):this.changed=!1,this.options.elementChangedOnly?i&&this.fireEvent("elementChanged",this.selectElement.value):i&&(this.selectElement.get("onChange")||this.selectElement.get("onchange")?this.selectElement.onChange():this.selectElement.fireEvent("change",{target:this.selectElement}),window.fireEvent("elementChanged",{element:this.selectElement,callee:"autocomplete itemClicked"}),this.fireEvent("elementChanged",this.selectElement.value)),this.options.keeplist&&this.restoreSelectedList.delay(1e3,this)},scrolled:function(){},position:function(n,t){this.doPosition.delay(!isNaN(parseInt(n)?parseInt(n):100),this,[t])},getNodePosition:function(n,t){if(n instanceof HTMLElement){let i=n.getBoundingClientRect(),u=window.pageXOffset||document.documentElement.scrollLeft,f=window.pageYOffset||document.documentElement.scrollTop,r;return t instanceof HTMLElement?(r=t.getBoundingClientRect(),{top:i.top-r.top+f,left:i.left-r.left+u}):{top:i.top+f,left:i.left+u}}return null},getNodeSize:function(n){var t=n.getBoundingClientRect();return{width:t.width,height:t.height}},getWindowSize:function(n){var t={};return n&&typeof n=="boolean"?(t={x:Math.max(document.body.scrollWidth,document.documentElement.scrollWidth,document.body.offsetWidth,document.documentElement.offsetWidth,document.body.clienWidth,document.documentElement.clientWidth),y:Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)},t.width=t.x,t.height=t.y,t):(t={x:window.innerWidth||document.documentElement.clientWidth||document.body.clientWidth,y:window.innerHeight||document.documentElement.clientHeight||document.body.clientHeight},t.width=t.x,t.height=t.y,t)},doPosition:function(){if(this.displayElement&&this.listElement&&this.status==="open")try{var n=this.getNodePosition(this.displayElement),f=this.getNodeSize(this.displayElement),i=this.getWindowSize(),e=document.documentElement&&document.documentElement.scrollTop?document.documentElement.scrollTop:document.body.scrollTop,o=i.height+e,r=n.top+f.height+5,u=n.left,t=this.getNodeSize(this.listElement);this.center&&(u=n.left+f.width/2-t.width/2),n.left+t.width>i.width&&(u=i.width-t.width-25),r+t.height>o&&(r=n.top-t.height-5),this.listElement.setStyles({position:"absolute",top:r,left:u})}catch(s){}},obscure:function(){this.enabled=!1,this.hide(),this.iconElement&&this.iconElement.addClass("hidden"),this.displayElement&&this.displayElement.addClass("hidden")},reveal:function(){this.enabled=!0,this.iconElement&&this.iconElement.removeClass("hidden"),this.displayElement&&this.displayElement.removeClass("hidden")},hide:function(){if(this.status!=="closed"){clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay);var n=this.listElement;n.fade("out"),this.status="closed",function(){n.addClass("hidden"),this.listElement&&"getElement"in this.listElement&&!this.listElement.getElement("li.visible.selected")&&(this.lastSelected=this.listElement.getElement("li.visible.selected")),this.reset()}.delay(250,this)}},show:function(){var n,t;this.status!=="open"&&this.listElement&&"getElements"in this.listElement&&this.listElement.getElements("li.visible").length>0&&(window.autocompletes.hideAll(this),clearTimeout(this.doFocusDelay),n=this.listElement,n.removeClass("hidden"),n.fade("in"),this.status="open",this.listElement&&"getElement"in this.listElement&&this.listElement.getElement("li.visible.selected")&&(t=this.listElement.getElement("li.visible.selected"),this.listElement.scrollTo(0,t.getPosition(this.listElement).y-5)),this.doPosition("show"))},restoreSelectedList:function(){this.fuzzyWorker.postMessage({job:"getSelectedList",defaultValue:this.selectElement.value,uuid:this.uuid})},clearList:function(){this.listElement&&(Array.each(this.listElement.getElements("li"),function(n){n.removeEvents()}.bind(this)),this.listElement.empty())},revert:function(n){var i=typeOf(n)==="null"?!1:n,t;if(this.useWebWorkers&&this.fuzzyWorker&&this.fuzzyWorker.postMessage({job:"terminate"}),t="moo remove children",clearTimeout(this.doFocusDelay),clearTimeout(this.fuzzySearchDelay),clearInterval(this.checkExistsPeriodical),this.doFocusDelay=null,this.fuzzySearchDelay=null,this.checkExistsPeriodical=null,this.selectElement&&this.selectElement.getParent("td")&&this.selectElement.getParent("td").getElement(".deploader")&&this.selectElement.getParent("td").getElement(".deploader").destroy(),this.displayElement&&(Affinity.UI.lastAutoKill[this.uuid]={},Affinity.UI.lastAutoKill[this.uuid].id=this.uuid+"",Affinity.UI.lastAutoKill[this.uuid].killid=this.killid+"",Affinity.UI.lastAutoKill[this.uuid].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"",this.killid+""]),this.iconElement&&(this.iconElement.addClass("loading"),Affinity.UI.lastAutoKill[this.uuid+"_icon"]={},Affinity.UI.lastAutoKill[this.uuid+"_icon"].id=this.uuid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].killid=this.killid+"_icon",Affinity.UI.lastAutoKill[this.uuid+"_icon"].destroy=Affinity.UI.delayAutoKill.delay(2e3,window,[this.uuid+"_icon",this.killid+"_icon"]))),Affinity.supportsPassiveEvents?document.removeEvent("scroll",this.scrolled,{passive:!0}):document.removeEvent("scroll",this.scrolled,!1),document.removeEvent("resize",this.position),this.listElement){if(this.listElement.set("tween",null),this.listElement.removeEvents(),t==="native remove")try{this.listElement.parentNode.removeChild(this.listElement)}catch(r){}if(t==="native remove children"){while(this.listElement.lastChild)this.listElement.lastChild.removeEventListener(Affinity.events.click,this.itemClicked),this.listElement.removeChild(this.listElement.lastChild);try{this.listElement.parentNode.removeChild(this.listElement)}catch(r){}}t==="moo remove"&&this.listElement.destroy(),t==="moo remove children"&&(this.clearList(),this.listElement.destroy())}return this.displayElement&&(this.displayElement.removeEvents(),this.displayElement.getWidget("elementWidget")&&this.displayElement.getWidget("elementWidget").destroy(),this.searchMode&&this.displayElement.eliminate("value")),this.selectElement&&(this.selectElement.inject(this.hiddenWrapper,"before"),this.selectElement.eliminate("widget"),i&&(this.selectElement.retrieve("changetracker")&&this.selectElement.retrieve("changetracker").destroy(),this.selectElement.destroy())),this.hiddenWrapper&&this.hiddenWrapper.destroy(),window.autocompletes.widgets[this.uuid]&&(window.autocompletes.widgets[this.uuid]=null,delete window.autocompletes.widgets[this.uuid]),Object.each(this,function(n,t){this[t]=null,delete this[t]}.bind(this)),!0},destroy:function(){this.useWebWorkers&&this.fuzzyWorker&&this.fuzzyWorker.postMessage({job:"terminate"}),this.revert(!0)}}),UIDateCalendar=new Class({Version:"1.0.6.0",Sequence:1020,Name:"Date Calendar",File:"ui.date.calendar.js",Jira:"",Notes:"Check if DOM element",Implements:[Options,Events],Binds:["processNew","processDateInput","hideAll"],options:{outputFormat:"%d.%m.%Y",displayFormat:"%a the %e%o of %b %Y"},widgets:{},initialize:function(n){this.setOptions(n),Affinity.UI||(Affinity.UI={}),Affinity.UI.calendars=this,this.processNew()},processNew:function(){Array.each(document.getElements("input.uidate-calendar"),this.processDateInput)},processDateInput:function(n){var t,i;if(!n.hasClass("uidone")&&(n.addClass("uidone"),!n.getElement("input")||!n.getElement("input").disabled)){t={target:n,postName:n.get("name")||"",postId:n.get("id")||"",startDate:n.get("data-start-date")||new Date,validationMethods:n.get("data-validate-method")||"",validationErrorStr:n.get("data-validate-error-str")||"",showInline:n.hasClass("show-inline")?!0:!1,nullable:!1,showCalendarFilterButtonsForMobile:!1};switch(n.get("data-calendar-type")){case"date":t.showCalendar=!0,t.showTime=!1;break;case"time":t.showCalendar=!1,t.showTime=!0;break;case"datetime":t.showCalendar=!0,t.showTime=!0;break;case"hoursmins":t.showCalendar=!0,t.showTime=!0,t.hoursmins=!0;break;default:t.showCalendar=!0,t.showTime=!1}n.get("showCalendarFilterButtonsForMobile")&&(t.showCalendarFilterButtonsForMobile=!0),n.get("data-calendar-display-format")&&(t.displayFormat=n.get("data-calendar-display-format")),n.get("data-calendar-return-format")&&(t.outputFormat=n.get("data-calendar-return-format")),n.get("data-calendar-nullable")&&(t.nullable=n.get("data-calendar-nullable").trim().toLowerCase()==="true"?!0:!1),n.get("data-calendar-hoursmins")&&(t.hoursmins=n.get("data-calendar-hoursmins").trim().toLowerCase()==="true"?!0:!1),n.hasClass("preserve-original-input")&&(t.preserveOriginalInput=!0),t.hoursmins&&!n.get("data-start-date")&&(t.startDate.setMinutes(0),t.startDate.setHours(0),t.startDate.setSeconds(0),t.startDate.setMilliseconds(0)),i=new UIDateTimeWidget(t),this.widgets[i.uuid]||(this.widgets[i.uuid]=i),delete i,delete t}},hideAll:function(n){Object.each(this.widgets,function(t){typeOf(n)!=="null"&&n.uuid?t.uuid!==n.uuid&&t.hide():t.hide()}.bind(this))}}),UIDateTimeWidget=new Class({Implements:[Options,Events],WidgetName:"DateTime",options:{target:null,preserveOriginalInput:!1,outputFormat:"%d.%m.%Y",displayFormat:"%a %e %b %Y",showCalendar:!0,showTime:!1,startDate:null,labelName:"",postId:"",postName:"",validationMethods:"",validationErrorStr:"",cssPosition:"absolute",watchOutput:!1,nullable:!1,hoursmins:!1,showInline:!1,showCalendarFilterButtonsForMobile:!1},Binds:["getDate","getDateObject","getValue","getDisplayValue","documentClick","calendarClick","calendarEnter","calendarLeave","monthElementClicked","yearElementClicked","monthSelectorClicked","yearSelectorClicked","lastMonth","nextMonth","resetCalendar","nextMonthDown","lastMonthDown","dayClicked","timeChanged","setCalendarDate","changeMonth","changeYear","attemptParse","position","setToday","setNone","externalShow","watchOutputChanges","obscure","reveal","show","hide","destroy"],row:null,date:null,__uiDate:null,__selectedDate:null,getValue:function(){return this.date.format(this.options.displayFormat)},getDisplayValue:function(){return this.date.format(this.options.outputFormat)},initialize:function(n){var t,i,r;if(this.setOptions(n),this.showDefault=this.options.startDate=="none"?!1:!0,t=new Date,this.__uiDate=t.clone(),this.__selectedDate=this.date=!1,this.mobile=Affinity.hasOwnProperty("ismobile")?Affinity.ismobile:!1,this.mobile){this.target=this.options.target,this.output=this.target,this.reuse=!0,this.id=this.options.target!=null?this.options.target.get("id")?this.options.target.get("id"):String.uniqueID():String.uniqueID(),this.uuid=this.id,this.showDefault=this.options.startDate=="none"?!1:!0,this.options.startDate=="none"?this.options.target&&"value"in this.options.target&&this.options.target.value.trim()!==""&&Date.parse(this.options.target.value).isValid()&&(this.date=Date.parse(this.options.target.value),this.showDefault=!0):this.options.startDate=="today"?this.date=new Date:this.options.startDate&&this.options.startDate!==null&&Date.parse(this.options.startDate).isValid()&&(this.date=Date.parse(this.options.startDate)),this.options.hoursmins&&t.getTime()===this.__uiDate.getTime()&&(this.date.setMinutes(0),this.date.setHours(0),this.date.setSeconds(0),this.date.setMilliseconds(0)),this.target.type=this.options.showCalendar&&!this.options.showTime?"date":!this.options.showCalendar&&this.options.showTime?"time":"datetime-local",Affinity.UI.calendars.widgets[this.uuid]=this;return}this.options.startDate=="none"?this.options.target&&"value"in this.options.target&&this.options.target.value.trim()!==""?Date.parse(this.options.target.value).isValid()?(this.__uiDate=Date.parse(this.options.target.value),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone(),this.showDefault=!0):this.showDefault=!1:this.showDefault=!1:this.options.startDate=="today"?(this.__uiDate=t.clone(),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()):this.options.startDate&&this.options.startDate!==null&&Date.parse(this.options.startDate).isValid()&&(this.__uiDate=Date.parse(this.options.startDate),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.hoursmins&&t.getTime()===this.__uiDate.getTime()&&(this.__uiDate.setMinutes(0),this.__uiDate.setHours(0),this.__uiDate.setSeconds(0),this.__uiDate.setMilliseconds(0),this.__selectedDate=this.__uiDate.clone(),this.date=this.__uiDate.clone()),this.options.nullable&&(this.showDefault=!1),this.id=this.options.target!=null?this.options.target.get("id")?this.options.target.get("id"):String.uniqueID():String.uniqueID(),this.uuid=this.id,Affinity.UI.calendars.widgets[this.uuid]||(Affinity.UI.calendars.widgets[this.uuid]=this),this.display=new Element("input",{type:"text","class":"ui-calendar-display widget",id:this.id+"-Display"}).store("widget",this),this.output=new Element("input",{type:"hidden",name:this.options.postName,"data-display-id":this.id+"-Display"}),this.options.postId!==""&&this.output.set("id",this.options.postId),Affinity.mobile&&this.display.set("readonly","true"),this.options.validationMethods!=""&&(this.output.addClass("validate"),this.output.set("data-validate-method",this.options.validationMethods),this.options.validationErrorStr&&this.output.set("data-validate-error-str",this.options.validationErrorStr)),this.watch=this.options.watchOutput||!1,typeOf(this.options.target)!=="null"&&this.options.target.hasClass("uidate-watch")&&(this.watch=!0),this.watch&&(this.watchTimer=this.watchOutputChanges.periodical(500,this)),this.reuse=this.options.preserveOriginalInput||!1,typeOf(this.options.target)!=="null"&&this.options.target.hasClass("uidate-preserve")&&(this.reuse=!0),this.reuse?typeOf(this.options.target)==="null"?(this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{"class":"hidden"}).inject(this.label,"after")):(this.row=this.options.target.getParent(".form-row")||!1,this.target=this.options.target,this.output=this.target,i=new Element("div",{"class":"subhidden"}),this.target.store("widget",this),this.row?(i.inject(this.row,"top"),this.display.inject(this.row,"bottom")):(i.inject(this.output,"before"),this.display.inject(this.output,"after")),this.output.inject(i)):(this.options.target==null?(this.row=new Element("div"),this.label=new Element("label",{html:this.options.labelName}).inject(this.row),this.target=new Element("div",{"class":"hidden"}).inject(this.label,"after")):(this.target=new Element("div",{"class":"hidden"}).inject(this.options.target,"after"),this.options.target.value&&(r=Date.parse(this.options.target.value),r.isValid()&&(this.options.startDate=r)),this.row=this.options.target.getParent(".form-row"),this.options.postId=this.options.target.get("id")||"",this.options.postName==""&&(this.options.postName=this.options.target.get("name")||""),this.options.postName!==""&&this.output.set("name",this.options.postName),this.options.postId!==""&&this.output.set("name",this.options.postName),this.display.cloneEvents(this.options.target),this.options.target.get("id")&&this.options.target.get("id")!==""&&this.options.target.set("id","__"+this.options.target.get("id")),this.options.target.set("name",null),this.options.target.removeEvents(),this.options.target.store("widget",this).addClass("hidden")),this.row!==null&&this.row.set("class","form-row ui-calendar-row "+this.id),this.display.inject(this.target,"after"),this.output.inject(this.target,"after"),this.target.destroy()),this.icons={},this.icons.Open=Affinity.icons.Popup||"&#xe012;",this.icons.Today=Affinity.icons.Calendar||"&#xe02e;",this.icons.Clear=Affinity.icons.Cross||"&#xe067;",this.icons.Tick=Affinity.icons.Tick,this.dontClose=!1,this.calendarOver=!1,this.options.showCalendarFilterButtonsForMobile?(this.buttons=new Element("span",{"class":"ui-mobile-calendar-buttons"}).inject(this.display,"after"),this.showbutton=new Element("span",{"class":"ui-mobile-calendar-button button w-icon-only blue ui-has-tooltip",html:"<span>"+this.icons.Open+"<\/span>","data-calendar":this.id,"data-tooltip":"Open","data-tooltip-dir":"top"}).inject(this.buttons),this.todaybutton=new Element("span",{"class":"ui-mobile-calendar-button button w-icon-only green ui-has-tooltip",html:"<span>"+this.icons.Today+"<\/span>","data-calendar":this.id,"data-tooltip":"Set date to today","data-tooltip-dir":"top"}).inject(this.buttons),this.clearbutton=new Element("span",{"class":"ui-mobile-calendar-button button w-icon-only orange ui-has-tooltip",html:"<span>"+this.icons.Clear+"<\/span>","data-calendar":this.id,"data-tooltip":"Clear the date","data-tooltip-dir":"top"}).inject(this.buttons)):(this.buttons=new Element("span",{"class":"ui-calendar-buttons"}).inject(this.display,"after"),this.showbutton=new Element("span",{"class":"ui-calendar-button button w-icon-only blue ui-has-tooltip",html:"<span>"+this.icons.Open+"<\/span>","data-calendar":this.id,"data-tooltip":"Open","data-tooltip-dir":"top"}).inject(this.buttons),this.todaybutton=new Element("span",{"class":"ui-calendar-button button w-icon-only green ui-has-tooltip",html:"<span>"+this.icons.Today+"<\/span>","data-calendar":this.id,"data-tooltip":"Set date to today","data-tooltip-dir":"top"}).inject(this.buttons),this.clearbutton=new Element("span",{"class":"ui-calendar-button button w-icon-only orange ui-has-tooltip",html:"<span>"+this.icons.Clear+"<\/span>","data-calendar":this.id,"data-tooltip":"Clear the date","data-tooltip-dir":"top"}).inject(this.buttons)),this.calendarBox=new Element("div",{"class":"ui-calendar",id:this.domid}).inject(document.body),this.calendarBox.set("reveal",{duration:250}),this.options.showInline||this.calendarBox.addEvent(Affinity.events.click,this.calendarClick),Affinity.mobile&&this.options.showInline||(this.calendarBox.addEvent(Affinity.events.overAll,this.calendarEnter),this.calendarBox.addEvent(Affinity.events.outAll,this.calendarLeave)),this.options.showInline||(this.display.addEvent(Affinity.events.click,this.externalShow),this.showbutton.addEvent(Affinity.events.click,this.externalShow),this.display.addEvent("blur",this.attemptParse),document.addEvent(Affinity.events.click,this.documentClick),this.todaybutton.addEvent(Affinity.events.click,this.setToday),this.clearbutton.addEvent(Affinity.events.click,this.setNone)),this.output&&this.date&&typeOf(this.output)==="element"&&typeOf(this.date)==="date"&&this.options.outputFormat&&this.output.store("defaultValue",this.date.format(this.options.outputFormat)),this.printField=!1,this.display.getParent(".ui-calendar-row")&&this.display.getParent(".ui-calendar-row").getElement(".print-field")&&(this.printField=this.display.getParent(".ui-calendar-row").getElement(".print-field")),this.buildCalendar(),window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this)),Affinity.mobile&&(window.addEvent("mobileback",this.documentClick),"onorientationchange"in window&&window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this))),this.valuetracker=new Affinity.ElementValueTracker,this.display&&this.valuetracker.addElement(this.display),this.output&&this.valuetracker.addElement(this.output),this.checkExistsPeriodical=this.checkExists.periodical(1e3,this),this.options.showInline&&(this.buttons.addClass("hidden"),this.display.addClass("hidden"),this.calendarBox.addClass("inline"),this.calendarBox.inject(this.display.getParent(),"bottom"),this.show())},isElement:function(n){try{return n instanceof HTMLElement}catch(t){return typeof n=="object"&&n.nodeType===1&&typeof n.style=="object"&&typeof n.ownerDocument=="object"}},checkExists:function(){document.contains(this.output)||(clearInterval(this.checkExistsPeriodical),this.destroy())},documentClick:function(){this.mobile||this.status=="open"&&this.hide(null,"doc "+this.id)},calendarClick:function(n){this.mobile||(n.stopPropagation(),n.preventDefault())},calendarEnter:function(){this.mobile||(this.calendarOver=!0)},calendarLeave:function(){this.mobile||(this.calendarOver=!1)},monthElementClicked:function(n){this.mobile||(this.calendarContainer.reveal(),this.monthbox.dissolve(),this.changeMonth(n.target.get("data-value")),this.monthbox.getElements(".active").removeClass("active"),n.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay())},yearElementClicked:function(n){this.mobile||(this.calendarContainer.reveal(),this.yearbox.dissolve(),this.changeYear(n.target.get("data-value")),this.yearbox.getElements(".active").removeClass("active"),n.target.addClass("active"),this.options.showTime&&this.timeWidget&&this.timeWidget.showDisplay())},monthSelectorClicked:function(){this.mobile||(this.monthbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve())},yearSelectorClicked:function(){this.mobile||(this.yearbox.reveal(),this.options.showTime&&this.timeWidget&&(this.timeWidget.hide(),this.timeWidget.hideDisplay()),this.calendarContainer.dissolve(),function(){var n,t;if(this.yearbox&&(n=this.yearbox.getElement(".active"),n&&this.isElement(n)&&"getPosition"in n&&this.yearbox))try{t=n.getPosition(this.yearbox).y,this.yearbox.scrollTo(0,t-5)}catch(i){}}.delay(500,this))},nextMonthDown:function(n){this.mobile||(n.preventDefault(),n.stopPropagation())},lastMonthDown:function(n){this.mobile||(n.preventDefault(),n.stopPropagation())},getHumanHour:function(n){return n==0?"Midnight":n<12?n+" am":n>12?n-12+" pm":"Midday"},buildCalendar:function(){var t,n,f,i,r,u,e;if(!this.mobile){if(t=new Date,this.options.showCalendar){for(this.calendarContainer=new Element("div").inject(this.calendarBox),this.lastButton=new Element("span",{html:"&#9668;","class":"ui-calendar-nextlast"}).inject(this.calendarContainer),i=new Element("span",{html:"","class":"ui-calendar-monthyear"}).inject(this.calendarContainer),this.nextButton=new Element("span",{html:"&#9658;","class":"ui-calendar-nextlast"}).inject(this.calendarContainer),this.monthButton=new Element("span",{"class":"ui-calendar-month"}).inject(i),this.yearButton=new Element("span",{"class":"ui-calendar-year"}).inject(i),this.monthbox=new Element("div",{"class":"ui-calendar-monthbox"}).inject(this.calendarBox),this.monthbox.set("reveal",{duration:250}),this.monthbox.toggle(),this.yearbox=new Element("div",{"class":"ui-calendar-yearbox"}).inject(this.calendarBox),this.yearbox.set("reveal",{duration:250}),this.yearbox.toggle(),n=0;n<12;n++)this.monthbox.adopt(new Element("span",{"class":"m"+n+(n===t.getMonth()?" today":""),html:t.clone().set("month",n).format("%b"),"data-value":n}).addEvent(Affinity.events.click,this.monthElementClicked));for(r=t.clone(),n=r.getFullYear()-100;n<r.getFullYear()+50;n++)new Element("span",{"class":"y"+n+(n===t.getFullYear()?" today":""),html:n,"data-value":n}).addEvent(Affinity.events.click,this.yearElementClicked).inject(this.yearbox,"top");for(n=0;n<7;n++)t.set("day",n),new Element("span",{html:t.format("%a"),"class":"ui-calendar-daylabel"}).inject(this.calendarContainer);for(n=0;n<42;n++)f=new Element("span",{"class":"ui-calendar-day"}).adopt(new Element("span")).inject(this.calendarContainer),this.setupClickable(f);this.nextButton.addEvent(Affinity.events.click,this.nextMonth),this.lastButton.addEvent(Affinity.events.click,this.lastMonth),this.monthButton.addEvent(Affinity.events.click,this.monthSelectorClicked),this.yearButton.addEvent(Affinity.events.click,this.yearSelectorClicked),Affinity.mobile||(this.nextButton.addEvent("mousedown",this.nextMonthDown),this.lastButton.addEvent("mousedown",this.lastMonthDown))}this.options.showTime&&(u=150,this.options.showCalendar&&(this.calendarContainer.set("reveal",{duration:250}),u=this.calendarContainer.measure(function(){return this.getSize()}).x-20),e=this.__selectedDate?this.__selectedDate.clone():!1,this.timeWidget=new UITimePickerWidget({target:this.calendarBox,displayInput:this.display,timeonly:this.options.showCalendar?!1:!0,date:e,hoursmins:this.options.hoursmins,dateWidget:this,onTimeSet:function(n){typeOf(n)==="date"&&n.isValid()&&(this.__selectedDate?n.getTime()!==this.__selectedDate.getTime()&&(this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__selectedDate=this.date.clone(),this.__uiDate=this.date.clone(),this.setCalendarDate()):this.date?n.getTime()!==this.date.getTime()&&(this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):this.options.nullable?this.options.showCalendar||(this.date=n,this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()):(this.date=n,this.date.setHours(n.getHours()),this.date.setMinutes(n.getMinutes()),this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setCalendarDate()))}.bind(this),onOpen:function(){this.options.showCalendar&&this.calendarContainer.dissolve()}.bind(this),onDone:function(n){this.options.showCalendar?this.calendarContainer.reveal():this.hide(n,"timeWidget"),this.output.fireEvent("change",{target:this.output})}.bind(this),width:u}),Affinity.mobile&&!this.options.showCalendar&&(this.mobileCloseButton=new Element("div",{"class":"uimodalclose",html:'<span class="icon-cross"><\/span>'}),this.mobileCloseButton.addEvent(Affinity.events.click,this.hide),this.mobileCloseButton.inject(this.timeWidget.timeTarget,"bottom"))),this.setupCalendar(this.options.startDate==null?!1:!0)}},setupCalendar:function(n){var f,r;if(!this.mobile){if(f=typeOf(n)!=="null"?n:!1,r=new Date,this.options.showCalendar){var t=1,e=this.__uiDate.get("month"),o=this.__uiDate.get("year"),u=this.__uiDate.get("lastdayofmonth"),i=this.__uiDate.clone().set("date",1).get("day"),s;this.calendarBox.getElement(".ui-calendar-month").set("html",this.__uiDate.format("%B")),this.calendarBox.getElement(".ui-calendar-year").set("html",this.__uiDate.getFullYear()),this.calendarBox.getElements(".ui-calendar-day").removeClass("today").removeClass("selected").removeClass("active"),Array.each(this.calendarBox.getElements(".ui-calendar-day"),function(n,f){n.set("class","ui-calendar-day"),n.getElement("span").set("html","&nbsp;"),f>=i&&f<i+u&&t==r.get("date")&&e==r.get("month")&&o==r.get("year")&&n.addClass("today"),f>=i&&f<i+u&&t==this.__uiDate.get("date")&&e==this.__uiDate.get("month")&&o==this.__uiDate.get("year")&&n.addClass("selected"),f>=i&&f<i+u&&(s=this.__uiDate.clone().set("date",t).format("%b%d%Y"),n.getElement("span").set("html",t),n.addClass(s),n.addClass("active"),n.store("date",this.__uiDate.clone().set("date",t)),t++)}.bind(this)),this.monthbox.getElements(".active").removeClass("active"),this.monthbox.getElement(".m"+this.__uiDate.getMonth()).addClass("active"),this.yearbox.getElements(".active").removeClass("active"),this.yearbox.getElement(".y"+this.__uiDate.getFullYear()).addClass("active")}this.options.showTime&&this.timeWidget.setTime(this.__uiDate),f&&this.setCalendarDate()}},setupClickable:function(n){this.mobile||n.addEvent(Affinity.events.click,this.dayClicked)},dayClicked:function(n){var t,i,r;this.mobile||(i=n.target.hasClass("ui-calendar-day")?n.target:n.target.getParent(".ui-calendar-day"),i.hasClass("active")&&(this.calendarBox.getElements(".ui-calendar-day.selected").removeClass("selected"),t=i.retrieve("date"),this.date=t.clone(),this.__uiDate=t.clone(),this.__selectedDate=t.clone(),i.addClass("selected"),r=this.setCalendarDate(),this.fireEvent("dateClicked",this.date),this.options.showTime||this.hide()))},nextMonth:function(){if(!this.mobile){var t=this.__uiDate.get("month"),n=t;n=n+1>11?0:n+1,this.changeMonth(n),n===0&&this.changeYear(this.__uiDate.get("year")+1)}},lastMonth:function(){if(!this.mobile){var t=this.__uiDate.get("month"),n=t;n=n-1<0?11:n-1,this.changeMonth(n),n===11&&this.changeYear(this.__uiDate.get("year")-1)}},changeMonth:function(n){if(!this.mobile){this.doEvent=!1;var r=this.__uiDate.clone().set("date",1).set("month",n),i=r.get("lastdayofmonth"),t=this.__uiDate.get("date");t=t>i?i:t,this.__uiDate.set("date",1).set("month",n).set("date",t),this.setupCalendar(),this.setCalendarDate()}},changeYear:function(n){if(!this.mobile){this.doEvent=!1;var r=this.__uiDate.clone().set("date",1).set("month",n),i=r.get("lastdayofmonth"),t=this.__uiDate.get("date");t=t>i?i:t,this.__uiDate.set("date",1).set("year",n).set("date",t),this.setupCalendar(),this.setCalendarDate()}},doEvent:!0,setCalendarDate:function(){if(!this.mobile){var n=!1;return this.__selectedDate&&(this.__selectedDate.format(this.options.outputFormat)!==this.output.value&&(n=!0),this.display.value=this.__selectedDate.format(this.options.displayFormat),this.output.value=this.__selectedDate.format(this.options.outputFormat),this.printField&&this.printField.set("html",this.display.value)),this.doEvent&&(n&&window.fireEvent("formElementChanged",{element:this.output}),this.fireEvent("dateChanged",this.date),window.fireEvent("elementChanged",{element:this.output}),this.output.fireEvent("change",{target:this.output})),this.doEvent=!0,!0}},getDate:function(){if(this.mobile)return Date.parse(this.options.target.value).format(this.options.outputFormat);var n=this.getDateObject();return n?n.format(this.options.outputFormat):!1},getDateObject:function(){if(this.mobile)return Date.parse(this.options.target.value);if(this.__selectedDate)return this.__selectedDate;if(!this.options.nullable){if(this.date)return this.date;if(this.__uiDate)return this.__uiDate}return!1},getRawDate:function(){if(this.mobile)return Date.parse(this.options.target.value);if(!this.__selectedDate||this.output.value==="")return!1;var n=Date.parse(this.output.value);return n!==null&&typeOf(n)&&n.isValid()?n:!1},setDate:function(n,t){if(n&&typeOf(n)!=="date")try{n=Date.parse(n)}catch(i){return}if(n&&typeOf(n)==="date"&&n.isValid()){if(this.mobile){this.setMobileDate(n);return}typeOf(t)==="boolean"&&t===!1&&(this.doEvent=!1),this.date=n,this.__uiDate=n.clone(),this.__selectedDate=n.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0}else this.options.nullable?(typeOf(t)==="boolean"&&t===!1&&(this.doEvent=!1),this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.output.value="",this.display.value="",this.setupCalendar(),this.doEvent=!0):(this.date=new Date,this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.setupCalendar(),this.setCalendarDate(),this.doEvent=!0)},setToday:function(){if(this.date=new Date,this.mobile){this.setMobileDate(this.date);return}this.__uiDate=this.date.clone(),this.__selectedDate=this.date.clone(),this.dontClose=!1,this.setupCalendar(!0)},setNone:function(){if(this.date=this.__uiDate=new Date,this.mobile){this.setMobileDate(this.date);return}this.__selectedDate=!1,this.output.value="",this.display.value="",this.showDefault=!1,this.dontClose=!1,this.output.fireEvent("change",{target:this.output})},attemptParse:function(n){var i,t,r;if(!this.mobile&&(typeOf(n)==="null"||!n.type||n.type!=="blur"||this.status!=="open"||!this.calendarOver)&&(this.options.showCalendar||!this.options.showTime||!this.timeWidget)){i=this.display.value,t=!1;try{t=Date.parse(i)}catch(n){console.log(n)}t&&typeOf(t)=="date"?t.isValid()?(r=this.__selectedDate?this.__selectedDate.clone():!1,this.date=t,this.__uiDate=t.clone(),this.__selectedDate=t.clone(),typeOf(n)!=="null"?this.setupCalendar(!0):this.setupCalendar(),r&&t.setMilliseconds(0)===this.date.setMilliseconds(0)||(this.setCalendarDate(),this.output.fireEvent("change",{target:this.output}))):(this.__selectedDate=!1,this.display.value="Invalid Date. No date set.",this.output.value="",this.output.fireEvent("change",{target:this.output})):this.options.nullable?(this.output.value="",this.__uiDate=new Date,this.date=this.__selectedDate=!1,this.output.fireEvent("change",{target:this.output})):(this.display.value=this.__selectedDate?this.__selectedDate.format(this.options.displayFormat):this.__uiDate.format(this.options.displayFormat),this.printField&&this.printField.set("html",this.display.value)),this.hide(null,"attemptParse "+this.id)}},setMobileDate:function(n,t){if(this.mobile){this.date=n;var r=this.date.getDate().toString().padStart(2,"0"),u=(1+this.date.getMonth()).toString().padStart(2,"0"),f=this.date.getHours().toString().padStart(2,"0"),e=this.date.getMinutes().toString().padStart(2,"0"),o=this.date.getSeconds().toString().padStart(2,"0"),s=this.date.getMilliseconds().toString().padStart(3,"0"),i="";switch(this.options.target.type.toLowerCase()){case"time":i=f+":"+e+":"+o+"."+s;break;case"datetime":i=this.date.getFullYear()+"-"+u+"-"+r+"T"+f+":"+e+":"+o+"."+s;break;case"date":default:i=this.date.getFullYear()+"-"+u+"-"+r}this.options.target.value=i,this.doEvent=!0,typeOf(t)==="boolean"&&t===!1&&(this.doEvent=!1),this.doEvent&&(window.fireEvent("formElementChanged",{element:this.options.target}),this.fireEvent("dateChanged",this.date),window.fireEvent("elementChanged",{element:this.options.target}),this.output.fireEvent("change",{target:this.options.target}))}},positionOverride:!1,position:function(){var u;if(!this.mobile){var n=!1,r=!1,t=window.getSize(),e,i,o,f,s;if(!n&&this.positionOverride&&this.isElement(this.positionOverride)&&"getPosition"in this.positionOverride&&typeof this.positionOverride.getPosition=="function"&&"getSize"in this.positionOverride&&typeof this.positionOverride.getSize=="function"&&(n=this.positionOverride.getPosition(),r=this.positionOverride.getSize()),!n&&this.display&&this.isElement(this.display)&&"getPosition"in this.display&&typeof this.display.getPosition=="function"&&"getSize"in this.display&&typeof this.display.getSize=="function"&&(n=this.display.getPosition(),r=this.display.getSize()),n){if(e=n.y+r.y+5,i=n.x,s=this.options.cssPosition,u=this.calendarBox.measure(function(){return this.getSize()}),Affinity.mobile){this.calendarBox.hasClass("scaled")||(i=0,r=u,t=parent.getSize(),t.x-=40,t.y-=40,o=1,t.x+40>r.x*o&&(i=(t.x+40-r.x*o)/2),f={position:"fixed",top:i,left:i},this.calendarBox.setStyles(f),this.calendarBox.addClass("scaled"));return}t.y-(n.y-window.getScroll().y)<u.y&&(e=n.y-u.y-5),n.x-window.getScroll().x+u.x>t.x&&(i=t.x-u.x-5),s==="fixed"&&(e-=window.getScroll().y),f={position:s,top:e,left:i},this.calendarBox.setStyles(f),this.delayedRePosition&&clearTimeout(this.delayedRePosition),this.delayedRePosition=setTimeout(function(){this.calendarBox.setStyles(f)}.bind(this),500)}}},watchOutputChanges:function(){var t=this.output.value,n=Date.parse(t);n&&n.hasOwnProperty("isValid")&&n.isValid()&&n!==this.date&&this.setDate(n,!1)},externalShow:function(n){this.mobile||(n.stopPropagation(),Affinity.UI.calendars.hideAll(this),Affinity.mobile&&this.display.blur(),this.show())},obscure:function(){this.mobile||(this.hide(),this.showbutton&&this.showbutton.addClass("hidden"),this.todaybutton&&this.todaybutton.addClass("hidden"),this.clearbutton&&this.clearbutton.addClass("hidden"),this.display&&this.display.addClass("hidden"))},reveal:function(){this.mobile||(this.showbutton&&this.showbutton.removeClass("hidden"),this.todaybutton&&this.todaybutton.removeClass("hidden"),this.clearbutton&&this.clearbutton.removeClass("hidden"),this.display&&this.display.removeClass("hidden"))},show:function(){this.mobile||(this.options.showInline||(Affinity.UI.calendars.hideAll(this),this.position()),this.calendarBox.reveal(),this.status="open")},hide:function(){this.mobile||this.options.showInline||this.dontClose||(this.monthbox&&this.monthbox.dissolve(),this.yearbox&&this.yearbox.dissolve(),this.calendarContainer&&this.calendarContainer.reveal(),this.calendarBox&&this.calendarBox.dissolve(),this.status="closed")},destroy:function(){if(!this.mobile){if(clearInterval(this.checkExistsPeriodical),this.showbutton&&this.showbutton.removeEvents(),this.todaybutton&&this.todaybutton.removeEvents(),this.clearbutton&&this.clearbutton.removeEvents(),this.display&&this.display.removeEvents(),document.removeEvent(Affinity.events.click,this.documentClick),this.options.showCalendar&&(this.calendarContainer&&(Array.each(this.calendarContainer.getElements(".ui-calendar-day"),function(n){n.removeEvents(),n.destroy()}.bind(this)),this.calendarContainer.set("reveal",null),this.calendarContainer.set("tween",null),this.calendarContainer.removeEvents()),this.monthbox&&(Array.each(this.monthbox.getElements("span"),function(n){n.removeEvents(),n.destroy()}.bind(this)),this.monthbox.set("reveal",null),this.monthbox.set("tween",null),this.monthbox.removeEvents()),this.yearbox&&(Array.each(this.yearbox.getElements("span"),function(n){n.removeEvents(),n.destroy()}.bind(this)),this.yearbox.set("reveal",null),this.yearbox.set("tween",null),this.yearbox.removeEvents()),this.nextButton&&this.nextButton.removeEvents(),this.lastButton&&this.lastButton.removeEvents(),this.yearButton&&this.yearButton.removeEvents(),this.monthButton&&this.monthButton.removeEvents()),this.options.showTime&&this.timeWidget.destroy(),Affinity.UI.calendars.widgets[this.uuid]&&(Affinity.UI.calendars.widgets[this.uuid]=null,delete Affinity.UI.calendars.widgets[this.uuid]),this.buttons&&(this.buttons.empty(),this.buttons.destroy()),this.display&&this.display.destroy(),this.output&&this.output.destroy(),this.calendarBox&&(this.calendarBox.set("reveal",null),this.calendarBox.set("tween",null),this.calendarBox.removeEvents(),this.calendarBox.empty(),this.calendarBox.destroy()),this.options.target)try{this.options.target.eliminate("widget"),this.options.target.destroy()}catch(n){}Object.each(this,function(n,t){this[t]=null,delete this[t]}.bind(this))}}}),UIDisplayLookup=new Class({Version:"1.0.4.0",Sequence:1080,Name:"Display Lookup",File:"ui.display.lookup.js",Jira:"",Notes:'Support "Units" return object',WidgetName:"DisplayLookup",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","setValue","refreshQueue","cancelQueue","processQueue"],options:{jsonp:!1},enabled:!1,initialize:function(n){this.setOptions(n),Affinity.UI||(Affinity.UI={}),Affinity.UI.displaylookups||(Affinity.UI.displaylookups={}),Affinity.UI.displaylookupLoaders=[],window.addEvent("refreshQueues",this.refreshQueue),window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this)),this.processNew()},processNew:function(n){typeOf(n)==="object"&&this.setOptions(n);var t=document.getElements(".has-display-lookup");Array.each(t,this.processLookup),this.processQueue(),delete t},processLookup:function(n){var t,i;n.get("data-lookup-api")&&(n.removeClass("has-display-lookup"),n.get("data-lookup-api")!==""&&(t=n.get("data-lookup-api"),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.displaylookups[i]?Affinity.UI.displaylookups[i].elements.contains[n]||Affinity.UI.displaylookups[i].elements.push(n):Affinity.UI.displaylookups[i]={api:t,id:"dis_lookup_"+String.uniqueID(),type:"display",loaded:!1,elements:[n]}))},getApiKey:function(n){var o=new URI(n.toLowerCase()),s=o.get("query").parseQueryString(),i=[],u=[],t=!1,f="",r,e;return Object.each(s,function(n,r){r.toLowerCase()!=="ran"&&(r!=="parameters"?i.push(r+"-"+n):t=JSON.parse(n))}),i=i.sort(),t&&typeOf(t)==="object"&&"parameter"in t&&typeOf(t.parameter)==="array"&&(Array.each(t.parameter,function(n){r=[],Object.each(n,function(n,t){t.toLowerCase()!=="ran"&&r.push(t+"-"+n)}),r.sort(),u.push(r.join("|"))}),u.sort(),f="|parameters|"+u.join("||")),e=i.join("|")+f,"display-"+e.replace(/\//g,".")},refreshQueue:function(){log("&#171; REFRESH ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,function(n){"cancel"in n&&n.cancel(),n.removeEvents(),n=null}),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,function(n,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null}),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){log("&#171; CANCEL AND CLEAR ALL DISPLAY LOOKUPS &#187;"),this.enabled=!1,Array.each(Affinity.UI.displaylookupLoaders,function(n){"cancel"in n&&n.cancel(),"removeEvents"in n&&n.removeEvents(),n=null}),Affinity.UI.displaylookupLoaders=[],Object.each(Affinity.UI.displaylookups,function(n,t){Affinity.UI.displaylookups[t].loaded=!1,Affinity.UI.displaylookups[t].data=null,Affinity.UI.displaylookups[t].elements=[],Affinity.UI.displaylookups[t]=null,delete Affinity.UI.displaylookups[t]}),Affinity.UI.displaylookups={}},processQueue:function(){var t,n;try{Object.each(Affinity.UI.displaylookups,function(i,r){if(!this.enabled){log("! display lookup queue disabled - process stooped !");throw"break Object.each";}Affinity.UI.displaylookups[r].loaded===!0&&this.setElements(r),Affinity.UI.displaylookups[r].loaded===!1&&(n=Affinity.UI.displaylookups[r].api,n.contains("ran=")||(n=n.contains("?")?n+="&ran="+String.uniqueID():n+="?ran="+String.uniqueID()),Affinity.UI.displaylookups[r].loaded="loading...",t=this.options.jsonp?new Request.JSONP({callbackKey:"jsoncallback",url:n,method:"get",noCache:!0,onComplete:function(n){JSON.Unauthorized(n,Affinity.UI.displaylookups[r].id)||(Affinity.UI.displaylookups[r].data=n,typeOf(n.success)!=="null"&&n.success===!1?this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[r].loaded=!0,this.setElements(r)))}.bind(this)}):new Request.JSON({url:n,method:"get",noCache:!0,onSuccess:function(n){JSON.Unauthorized(n,Affinity.UI.displaylookups[r].id)||(Affinity.UI.displaylookups[r].data=n,typeOf(n.success)!=="null"&&n.success===!1?this.setError(r,n.error&&n.error!==""?n.error:"There was an error retrieving this data"):(Affinity.UI.displaylookups[r].loaded=!0,this.setElements(r)))}.bind(this)}),t&&(Affinity.UI.displaylookupLoaders.push(t),t.send()))}.bind(this))}catch(i){}},setError:function(n,t){Array.each(Affinity.UI.displaylookups[n].elements,function(n){n.hasClass("display-lookup-el")?(n.set("html",'<span class="icon-warning ui-has-tooltip" data-tooltip="'+t+'"><span>'),n.fireEvent("lookupError",{error:t,target:n})):(new Element("span",{"class":"errorstr inplace-of-input",html:t}).inject(n,"after"),n.addClass("hidden"))}.bind(this)),Affinity.tooltips.processNew()},setElements:function(n){Array.each(Affinity.UI.displaylookups[n].elements,function(t){typeOf(t)!=="null"&&typeOf(t.get)==="function"&&t.get("data-lookup-api")&&this.setValue(Affinity.UI.displaylookups[n].data,t)}.bind(this))},setValue:function(n,t){if(t.hasClass("display-lookup-el")&&(typeOf(n)==="string"||typeOf(n)==="number")){t.set("html",n),t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t});return}var i;typeOf(n)==="array"&&n.length>0&&typeOf(n[0].Value)!=="null"&&n[0].Value!==""&&(i=n[0].Value.trim(),Affinity.appname!=="cleverforms"&&(i=n[0].Value.split(",").sort(function(n,t){return t.length-n.length})[0].trim()),t.getElement(".display")||t.hasClass("display")?(t.getElement(".display")&&t.getElement(".display").set("html",i),t.hasClass("display")&&t.set("html",i)):"value"in t?t.value=i:t.set("html",i),t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t})),(typeOf(n)==="string"||typeOf(n)==="number")&&(i=n.Value.trim(),"value"in t?t.value=i:t.set("html",i),t.fireEvent("lookupComplete",{defaultValue:i,value:i,target:t})),typeOf(n)==="object"&&(n.hasOwnProperty("success")&&n.success&&n.hasOwnProperty("units")&&t.set("html",n.units),t.fireEvent("lookupComplete",{defaultValue:n.units,value:n.units,target:t})),delete i}}),UIDrawPanels=new Class({Version:"1.0.0.0",Sequence:1190,Name:"Draw Panel",File:"ui.drawpanel.js",Jira:"",Notes:"",Implements:[Options],Binds:["init","processDrawPad"],options:{},initialize:function(n){this.setOptions(n),this.init()},canvasSupported:function(){if(Browser.IE&&Borwser.version<9)return!1;var n=document.createElement("canvas");return typeof n.getContext=="undefined"||typeOf(n.getContext("2d"))=="undefined"?(delete n,!1):(n.destroy(),delete n,!0)},processNew:function(){this.init()},init:function(){this.canvasSupported()&&Array.each(document.getElements(".ui-drawpad"),this.processDrawPad)},processDrawPad:function(n){n.removeClass("ui-drawpad");var t="",i="",r="",u=[];n.get("data-bg-images")!=null&&(bgnames=n.get("data-bg-names").split("||"),t=n.get("data-bg-images").split("||"),i=n.get("data-bg-image-widths").split("||"),r=n.get("data-bg-image-heights").split("||"),Array.each(t,function(n,f){u.push({name:bgnames[f],image:t[f],width:i[f],height:r[f]})})),new UIDrawPanel({element:n,bgImageData:u})}}),UIDrawPanel=new Class({Implements:[Options],Binds:["changeBgImage","canvasDown","canvasUp","setData","clear"],options:{element:null,bgImageData:[]},initialize:function(n){var t,i;if(this.setOptions(n),this.icons={},this.icons.clear=Affinity.icons.CrossRound||"@Html.Raw(Affinity.UIFramework.Icons.CrossRound)",this.options.element==null)throw new Error("element must be set in options.");var r=this.options.element.get("name"),u=this.options.element.get("id"),f=this.options.element.value;this.element=new Element("input",{type:"hidden",value:f}).inject(this.options.element,"after"),this.options.element.destroy(),delete this.options.element,r&&this.element.set("name",r),u&&this.element.set("id",u),t=500,i=Affinity.mobile?250:120,this.options.bgImageData.length>0&&(t=this.options.bgImageData[0].width,i=this.options.bgImageData[0].height),this.canvas=new Element("canvas",{"class":"uidrawpanel",width:t,height:i}).inject(this.element,"after"),this.canvas.width=t,this.canvas.height=i,this.canvas.style.width=t+"px",this.canvas.style.height=i+"px",this.drawPanel=new SignaturePad(this.canvas,{}),this.options.bgImageData.length>0&&(this.options.bgImageData.length>1&&(new Element("br").inject(this.canvas,"before"),new Element("label",{html:"Select Background"}).inject(this.canvas,"before"),this.imageSelect=new Element("select").addEvent("change",this.changeBgImage).inject(this.canvas,"before"),Array.each(this.options.bgImageData,function(n,t){this.imageSelect.adopt(new Element("option",{html:n.name,value:t}))}.bind(this)),this.imageSelect.adopt(new Element("option",{html:"No Image",value:-1}))),this.changeBgImage({target:this.imageSelect})),this.clearButton=new Element("span",{html:"<span>"+this.icons.clear+"<\/span>Clear","class":"button orange w-icon"}).inject(this.canvas,"after"),new Element("br").inject(this.element,"before"),new Element("br").inject(this.canvas,"before"),new Element("br").inject(this.canvas,"after"),this.clearButton.addEvent(Affinity.events.click,this.clear),this.canvas.addEvent(Affinity.events.start,this.canvasDown),this.canvas.addEvent(Affinity.events.end,this.canvasUp),document.addEvent(Affinity.events.end,this.canvasUp)},changeBgImage:function(n){var t=this.options.bgImageData[n.target.value];t==null&&(t={width:500,height:Affinity.mobile?250:120,image:null}),this.drawPanel.clear(),this.element.value="",this.canvas.width=t.width,this.canvas.height=t.height,this.canvas.style.width=t.width+"px",this.canvas.style.height=t.height+"px",t.image!==null&&this.drawPanel.fromDataURL(t.image)},canvasDown:function(){this.eventIsDown=!0},canvasUp:function(){this.eventIsDown&&(this.eventIsDown=!1,this.setData())},setData:function(){this.element.value=this.drawPanel.toDataURL()},clear:function(){this.drawPanel.clear(),this.element.value="",this.options.bgImageData.length>0&&this.changeBgImage({target:this.imageSelect})}}),SignaturePad=function(n){"use strict";var t=function(n,t){var r=this,i=t||{};this.velocityFilterWeight=i.velocityFilterWeight||.7,this.minWidth=i.minWidth||.5,this.maxWidth=i.maxWidth||2.5,this.dotSize=i.dotSize||function(){return(this.minWidth+this.maxWidth)/2},this.penColor=i.penColor||"black",this.backgroundColor=i.backgroundColor||"rgba(0,0,0,0)",this._canvas=n,this._ctx=n.getContext("2d"),this.clear(),this._handleMouseEvents(),this._handleTouchEvents()},i,r;return t.prototype.clear=function(){var t=this._ctx,n=this._canvas;t.fillStyle=this.backgroundColor,t.clearRect(0,0,n.width,n.height),t.fillRect(0,0,n.width,n.height),this._reset()},t.prototype.toDataURL=function(){var n=this._canvas;return n.toDataURL.apply(n,arguments)},t.prototype.fromDataURL=function(n){var t=this,i=new Image;this._reset(),i.src=n,i.onload=function(){t._ctx.drawImage(i,0,0,t._canvas.width,t._canvas.height)},this._isEmpty=!1},t.prototype._strokeUpdate=function(n){var t=this._createPoint(n);this._addPoint(t)},t.prototype._strokeBegin=function(n){this._reset(),this._strokeUpdate(n)},t.prototype._strokeDraw=function(n){var t=this._ctx,i=typeof this.dotSize=="function"?this.dotSize():this.dotSize;t.beginPath(),this._drawPoint(n.x,n.y,i),t.closePath(),t.fill()},t.prototype._strokeEnd=function(){var t=this.points.length>2,n=this.points[0];!t&&n&&this._strokeDraw(n)},t.prototype._handleMouseEvents=function(){var t=this;this._mouseButtonDown=!1,this._canvas.addEventListener("mousedown",function(n){n.which===1&&(t._mouseButtonDown=!0,t._strokeBegin(n))}),this._canvas.addEventListener("mousemove",function(n){t._mouseButtonDown&&t._strokeUpdate(n)}),n.addEventListener("mouseup",function(n){n.which===1&&t._mouseButtonDown&&(t._mouseButtonDown=!1,t._strokeEnd(n))})},t.prototype._handleTouchEvents=function(){var t=this;this._canvas.addEventListener("touchstart",function(n){var i=n.changedTouches[0];t._strokeBegin(i)}),this._canvas.addEventListener("touchmove",function(n){n.preventDefault();var i=n.changedTouches[0];t._strokeUpdate(i)}),n.addEventListener("touchend",function(n){var i=n.target===t._canvas;i&&t._strokeEnd()})},t.prototype.isEmpty=function(){return this._isEmpty},t.prototype._reset=function(){this.points=[],this._lastVelocity=0,this._lastWidth=(this.minWidth+this.maxWidth)/2,this._isEmpty=!0,this._ctx.fillStyle=this.penColor},t.prototype._createPoint=function(n){var t=this._canvas.getBoundingClientRect();return new i(n.clientX-t.left,n.clientY-t.top)},t.prototype._addPoint=function(n){var t=this.points,u,f,e,i;t.push(n),t.length>2&&(t.length===3&&t.unshift(t[0]),i=this._calculateCurveControlPoints(t[0],t[1],t[2]),u=i.c2,i=this._calculateCurveControlPoints(t[1],t[2],t[3]),f=i.c1,e=new r(t[1],u,f,t[2]),this._addCurve(e),t.shift())},t.prototype._calculateCurveControlPoints=function(n,t,r){var e=n.x-t.x,o=n.y-t.y,s=t.x-r.x,h=t.y-r.y,f={x:(n.x+t.x)/2,y:(n.y+t.y)/2},u={x:(t.x+r.x)/2,y:(t.y+r.y)/2},p=Math.sqrt(e*e+o*o),c=Math.sqrt(s*s+h*h),w=f.x-u.x,b=f.y-u.y,l=c/(p+c),a={x:u.x+w*l,y:u.y+b*l},v=t.x-a.x,y=t.y-a.y;return{c1:new i(f.x+v,f.y+y),c2:new i(u.x+v,u.y+y)}},t.prototype._addCurve=function(n){var r=n.startPoint,u=n.endPoint,t,i;t=u.velocityFrom(r),t=this.velocityFilterWeight*t+(1-this.velocityFilterWeight)*this._lastVelocity,i=this._strokeWidth(t),this._drawCurve(n,this._lastWidth,i),this._lastVelocity=t,this._lastWidth=i},t.prototype._drawPoint=function(n,t,i){var r=this._ctx;r.moveTo(n,t),r.arc(n,t,i,0,2*Math.PI,!1),this._isEmpty=!1},t.prototype._drawCurve=function(n,t,i){var l=this._ctx,p=i-t,a,y,o,r,s,h,u,c,v,f,e;for(a=Math.floor(n.length()),l.beginPath(),o=0;o<a;o++)r=o/a,s=r*r,h=s*r,u=1-r,c=u*u,v=c*u,f=v*n.startPoint.x,f+=3*c*r*n.control1.x,f+=3*u*s*n.control2.x,f+=h*n.endPoint.x,e=v*n.startPoint.y,e+=3*c*r*n.control1.y,e+=3*u*s*n.control2.y,e+=h*n.endPoint.y,y=t+h*p,this._drawPoint(f,e,y);l.closePath(),l.fill()},t.prototype._strokeWidth=function(n){return Math.max(this.maxWidth/(n+1),this.minWidth)},i=function(n,t,i){this.x=n,this.y=t,this.time=i||(new Date).getTime()},i.prototype.velocityFrom=function(n){return this.time!==n.time?this.distanceTo(n)/(this.time-n.time):1},i.prototype.distanceTo=function(n){return Math.sqrt(Math.pow(this.x-n.x,2)+Math.pow(this.y-n.y,2))},r=function(n,t,i,r){this.startPoint=n,this.control1=t,this.control2=i,this.endPoint=r},r.prototype.length=function(){for(var e=10,o=0,t,i,r,s,h,u,f,n=0;n<=e;n++)t=n/e,i=this._point(t,this.startPoint.x,this.control1.x,this.control2.x,this.endPoint.x),r=this._point(t,this.startPoint.y,this.control1.y,this.control2.y,this.endPoint.y),n>0&&(u=i-s,f=r-h,o+=Math.sqrt(u*u+f*f)),s=i,h=r;return o},r.prototype._point=function(n,t,i,r,u){return t*(1-n)*(1-n)*(1-n)+3*i*(1-n)*(1-n)*n+3*r*(1-n)*n*n+u*n*n*n},t}(document);
/*! @source http://purl.eligrey.com/github/FileSaver.js/blob/master/FileSaver.js */
"Affinity"in window||(window.Affinity={}),"Components"in Affinity||(Affinity.Components={}),Affinity.Components.UIFileSaver={},Affinity.Components.UIFileSaver.Version="1.0.0.0",Affinity.Components.UIFileSaver.Sequence=1140,Affinity.Components.UIFileSaver.Name="UI File Saver",Affinity.Components.UIFileSaver.File="ui.file.save.js",Affinity.Components.UIFileSaver.Jira="",Affinity.Components.UIFileSaver.Notes="Add fav strings to Config",saveAs=saveAs||typeof navigator!="undefined"&&navigator.msSaveOrOpenBlob&&navigator.msSaveOrOpenBlob.bind(navigator)||function(n){"use strict";if(typeof navigator=="undefined"||!/MSIE [1-9]\./.test(navigator.userAgent)){var s=n.document,h=function(){return n.URL||n.webkitURL||n},r=s.createElementNS("http://www.w3.org/1999/xhtml","a"),y=!n.externalHost&&"download"in r,p=function(t){var i=s.createEvent("MouseEvents");i.initMouseEvent("click",!0,!1,n,0,0,0,0,0,!1,!1,!1,!1,0,null),t.dispatchEvent(i)},u=n.webkitRequestFileSystem,c=n.requestFileSystem||u||n.mozRequestFileSystem,w=function(t){(n.setImmediate||n.setTimeout)(function(){throw t;},0)},f="application/octet-stream",l=0,i=[],e=function(){for(var t=i.length,n;t--;)n=i[t],typeof n=="string"?h().revokeObjectURL(n):n.remove();i.length=0},o=function(n,t,i){var r,u;for(t=[].concat(t),r=t.length;r--;)if(u=n["on"+t[r]],typeof u=="function")try{u.call(n,i||n)}catch(f){w(f)}},a=function(t,e){var s=this,k=t.type,d=!1,v,b,g=function(){var n=h().createObjectURL(t);return i.push(n),n},nt=function(){o(s,"writestart progress write writeend".split(" "))},a=function(){(d||!v)&&(v=g(t)),b?b.location.href=v:window.open(v,"_blank"),s.readyState=s.DONE,nt()},w=function(n){return function(){if(s.readyState!==s.DONE)return n.apply(this,arguments)}},tt={create:!0,exclusive:!1},it;if(s.readyState=s.INIT,e||(e="download"),y){v=g(t),r.href=v,r.download=e,p(r),s.readyState=s.DONE,nt();return}if(n.chrome&&k&&k!==f&&(it=t.slice||t.webkitSlice,t=it.call(t,0,t.size,f),d=!0),u&&e!=="download"&&(e+=".download"),(k===f||u)&&(b=n),!c){a();return}l+=t.size,c(n.TEMPORARY,l,w(function(n){n.root.getDirectory("saved",tt,w(function(n){var r=function(){n.getFile(e,tt,w(function(n){n.createWriter(w(function(r){r.onwriteend=function(t){b.location.href=n.toURL(),i.push(n),s.readyState=s.DONE,o(s,"writeend",t)},r.onerror=function(){var n=r.error;n.code!==n.ABORT_ERR&&a()},"writestart progress write abort".split(" ").forEach(function(n){r["on"+n]=s["on"+n]}),r.write(t),s.abort=function(){r.abort(),s.readyState=s.DONE},s.readyState=s.WRITING}),a)}),a)};n.getFile(e,{create:!1},w(function(n){n.remove(),r()}),w(function(n){n.code===n.NOT_FOUND_ERR?r():a()}))}),a)}),a)},t=a.prototype,v=function(n,t){return new a(n,t)};return t.abort=function(){var n=this;n.readyState=n.DONE,o(n,"abort")},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,n.addEventListener("unload",e,!1),v.unload=function(){e(),n.removeEventListener("unload",e,!1)},v}}(typeof self!="undefined"&&self||typeof window!="undefined"&&window||this.content),typeof module!="undefined"&&module!==null?module.exports=saveAs:typeof define!="undefined"&&define!==null&&define.amd!=null&&define([],function(){return saveAs}),String.prototype.endsWithAny=function(){for(var t=Array.prototype.slice.call(arguments),i=this.toLowerCase().toString(),n=0;n<t.length;n++)if(i.indexOf(t[n],i.length-t[n].length)!==-1)return!0;return!1};var saveTextAs=saveTextAs||function(n,t,i){var f,r,u,e;return t=t||"download.txt",i=i||"utf-8",n=(n||"").replace(/\r?\n/g,"\r\n"),saveAs&&Blob?(f=new Blob([n],{type:"text/plain;charset="+i}),saveAs(f,t),!0):(r=window.frames.saveTxtWindow,!r&&(r=document.createElement("iframe"),r.id="saveTxtWindow",r.style.display="none",document.body.insertBefore(r,null),r=window.frames.saveTxtWindow,!r&&(r=window.open("","_temp","width=100,height=100"),!r)))?(window.alert("Sorry, download file could not be created."),!1):(u=r.document,u.open("text/plain","replace"),u.charset=i,t.endsWithAny(".htm",".html")?(u.close(),u.body.innerHTML="\r\n"+n+"\r\n"):(t.endsWithAny(".txt")||(t+=".txt"),u.write(n),u.close()),e=u.execCommand("SaveAs",null,t),r.close(),e)},UIFormHideables=new Class({Version:"1.0.0.0",Sequence:1100,Name:"Form Hidable",File:"ui.form.hidables.js",Jira:"",Notes:"",Implements:[Options],Binds:["processNew","process","getHideableId","setupSelectSiwtch","doSelectSwitch"],options:{},initialize:function(n){this.setOptions(n),this.processNew()},processNew:function(n){this.setOptions(n),this.hideableTriggerElements=document.getElements(".is-hideable-switch"),Array.each(this.hideableTriggerElements,this.process)},process:function(n){var t=n.get("tag").toLowerCase();n.removeClass("is-hideable-switch").addClass("hideable-switch");switch(t){case"select":this.setupSelectSiwtch(n)}},getHideableId:function(n){return"ui-hideable-id-"+n.trim().toLowerCase().replace(/ /g,"-")},setupSelectSiwtch:function(n){var i=[],t;Array.each(n.getElements("option"),function(n){t=this.getHideableId(n.value),i.push(t),document.getElement("."+t)&&document.getElement("."+t).set("reveal",{duration:250,mode:"vertical"}).toggle()}.bind(this)),n.store("hideable-targets",i),n.addEvent("change",this.doSelectSwitch),this.doSelectSwitch({type:"change",target:n})},doSelectSwitch:function(n){var i,r,u,t;typeOf(n)!=="null"&&n.type==="change"&&(i=n.target,r=i.retrieve("hideable-targets"),u=i.value,t=this.getHideableId(u),document.getElement("."+t)&&(Array.each(r,function(n){n!==t&&document.getElement("."+n)&&document.getElement("."+n).dissolve()}),document.getElement("."+t).reveal()))}}),UIGrid=new Class({Version:"1.0.0.0",Sequence:1150,Name:"Grid Table",File:"ui.grid.js",Jira:"",Notes:"",Implements:[Options],Binds:["processTables","setupTable","zebra"],options:{},tables:{},initialize:function(n){this.setOptions(n),this.processTables(),Affinity.UI.Grids={},Affinity.UI.Grids.Zebra=this.zebra},processTables:function(n,t){var i;n==null?Array.each(document.getElements("table.ui-grid"),function(n){i=n.get("id")==""?String.uniqueID():n.get("id"),typeOf(this.tables[i])=="null"?(this.tables[i]=n,this.setupTable(n,t)):this.zebra(n,t)}.bind(this)):n.hasClass("ui-grid")&&(i=n.get("id")==""?String.uniqueID():n.get("id"),typeOf(this.tables[i])=="null"?(this.tables[i]=n,this.setupTable(n,t)):this.zebra(n,t)),delete i},setupTable:function(n,t){this.zebra(n,t)},zebra:function(n,t){var r="tr",u,i;typeof t!="undefined"&&typeof t=="string"&&(r="tr."+t),u=n==null?document.getElements("table.ui-grid"):[n],i=0,Array.each(u,function(n){i=0,"getElements"in n&&(n.getElements(r).removeClass("odd"),Array.each(n.getElements("tbody "+r),function(n){n.hasClass("hidden")||(n.addClass(i%2==0?"":"odd"),i++)}.bind(this)))}.bind(this)),delete i}}),UISortableGrid=new Class({Version:"1.0.2.0",Sequence:1160,Name:"Grid Sortable",File:"ui.grid.sortable.js",Jira:"",Notes:"Add time sort",Implements:[Options,Events],Binds:["checkTables","processTable","multisort","sortColumn"],options:{},tables:{},initialize:function(n){if(this.setOptions(n),typeOf(UIGrid)!="class"||typeOf(Affinity.uiGrid)=="null")throw new Error({"Missing Component":"UISortableGrid requires UIGrid"});this.icons={},this.icons.unsorted=Affinity.icons.ArrowheadUpDown||"&#xe0cc;",this.icons.sortup=Affinity.icons.ArrowheadUp||"&#xe0ba;",this.icons.sortdn=Affinity.icons.ArrowheadDown||"&#xe0b9;",Array.each(document.getElements("table"),this.checkTables)},checkTables:function(n){n.getElements("thead th.sort-on").length>0&&this.processTable(n)},processTable:function(n,t){var e,i,h,u;this.headers=n.getElements("thead th"),e=n.getElements("tbody tr"),i=n.get("id")?n.get("id"):String.uniqueID(),n.get("data-icon")&&(this.icons.unsorted=n.get("data-icon")),n.get("data-up-icon")&&(this.icons.sortup=n.get("data-up-icon")),n.get("data-down-icon")&&(this.icons.sortdn=n.get("data-down-icon")),n.set("id",i),this.tables[i]={},this.tables[i].table=n,this.tables[i].columns={},h=0,u=0,Array.each(this.headers,function(n,t){n.hasClass("sort-on")&&(n.getElement("div.icon")||(n.adopt(new Element("div",{"class":"icon",html:this.icons.unsorted})),n.addEvent("mousedown",function(n){n.preventDefault()}),n.addEvent("click",this.sortColumn)),this.tables[i].columns["h"+t]={method:n.get("data-sort-method"),direction:-1,sortables:[]})}.bind(this)),Array.each(e,function(n){Array.each(n.getElements("td"),function(n,t){if(this.tables[i].columns["h"+t]&&(this.tables[i].columns["h"+t].method==="string"&&this.tables[i].columns["h"+t].sortables.push([n.get("html"),n]),this.tables[i].columns["h"+t].method==="date"&&(n.get("html")==""?this.tables[i].columns["h"+t].sortables.push([Date.parse(0).format("%s"),n]):this.tables[i].columns["h"+t].sortables.push([Date.parse(n.get("html")).format("%s"),n])),(this.tables[i].columns["h"+t].method==="float"||this.tables[i].columns["h"+t].method==="integer")&&(n.get("html")==""?this.tables[i].columns["h"+t].sortables.push(0,n):this.tables[i].columns["h"+t].sortables.push([Number.from(n.get("html").replace(/[\s,$]/g,"")),n])),this.tables[i].columns["h"+t].method==="time"))if(n.get("html")=="")this.tables[i].columns["h"+t].sortables.push([Date.parse(0).format("%s"),n]);else{var r=(new Date).clearTime(),e=n.get("html"),f=e.split(":"),o=parseInt(f[0]),s=parseInt(f[1]);r.setHours(o),r.setMinutes(s),this.tables[i].columns["h"+t].sortables.push([r.format("%s"),n])}u++}.bind(this))}.bind(this)),this.tables[i].total=u,n.set("tween",{duration:250}),Affinity.uiGrid.zebra(n,t);var o="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber,r=Affinity.CookieMonster.Read(o),c=document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href,s=1,f;r&&(r=JSON.parse(r),f=Date.parse(r.date),r.href===c&&(new Date).getTime()-f.getTime()<s*18e5&&(this.tables[n.get("id")].columns["h"+r.columnIndex].direction=r.direction*-1,this.sortColumn({target:n.getElements("th")[r.columnIndex]})),(new Date).getTime()-f.getTime()>s*18e5&&Affinity.CookieMonster.Delete(o))},multisort:function(n,t){return n[0]==t[0]?0:n[0]<t[0]?-1:1},sortColumn:function(n){this.tables[n.target.getParent("table").get("id")].total>5e3?(n.target.getParent("table").fade(.25),this.continueSort.delay(500,this,[n])):this.continueSort(n)},continueSort:function(n){var u=n.target.get("tag")==="th"?n.target:n.target.getParent("th"),t=u.getParent("table"),f=t.getElement("tbody"),i=this.tables[t.get("id")].columns["h"+t.getElements("th").indexOf(u)],r,e,o;Array.each(t.getElements("thead th"),function(n){n.getElement(".icon")&&n.getElement(".icon").set("html",this.icons.unsorted)}.bind(this)),i.direction*=-1,i.sortables.sort(this.multisort),i.direction<0&&i.sortables.reverse(),u.getElement(".icon").set("html",i.direction>0?this.icons.sortup:this.icons.sortdn),Array.each(i.sortables,function(n){n[1].getParent("tr").inject(f,"top")}.bind(this)),Affinity.uiGrid.zebra(t),t.fade(1),r={},r.date=new Date,r.href=document.location.href.contains("?")?document.location.href.split("?")[0]:document.location.href,r.direction=i.direction,r.columnIndex=t.getElements("th").indexOf(u),e=JSON.stringify(r),o="AffinityLastSortGridData-"+Affinity.login.companyNumber+"-"+Affinity.login.profile.employeeNumber,Affinity.CookieMonster.Write(o,e),delete u,delete t,delete f,delete i},returnData:function(n,t){t=typeof t!="undefined"?t:!1;var i,r=[],u=n.getElements("tr th");return(Array.each(n.getElements("tr"),function(n){i={},Array.each(n.getElements("td"),function(n,t){i[u[t].get("data-name")]=n.get("html")}.bind(this)),Object.getLength(i)>0&&r.push(i)}.bind(this)),t)?JSON.stringify(r):r}}),UIHelpBubble=new Class({Version:"1.0.0.0",Sequence:1110,Name:"Help Bubble",File:"ui.help.bubble.js",Jira:"",Notes:"",Implements:[Options],Binds:["populate","alignTo","position","hide","show"],options:{fadeTime:100},initialize:function(n){this.setOptions(n),document.getElement(".helpBubble.float")||(this.helpBubble=new Element("div",{"class":"helpBubble right float"}).inject(document.body,"bottom"),this.helpBubble.set("tween",{duration:this.options.fadeTime}),this.helpBubble.fade("hide"))},populate:function(n){this.helpBubble&&(this.helpBubble.empty(),typeOf(n)=="element"&&this.helpBubble.adopt(n),typeOf(n)=="string"&&this.helpBubble.set("html",n),this.addClass("right"),this.setDirection("left"))},alignTo:function(n){var t=n.getPosition(),i=n.getSize();this.position({x:t.x+i.x+5,y:t.y+i.y/2-15})},setDirection:function(n){if(this.helpBubble){n=n.toLowerCase().trim()||"left";var t=["top","left","right","bottom","bottom-right","top-right"];t.contains(n)&&(Array.each(t,function(n){this.helpBubble.removeClass(n)}.bind(this)),this.addClass(n))}},addClass:function(n){this.helpBubble&&this.helpBubble.addClass(n)},position:function(n){this.helpBubble&&this.helpBubble.setStyles({top:n.y,left:n.x})},show:function(n){this.helpBubble&&(n&&n===!0&&(this.helpBubble.addEvent(Affinity.events.outAll,this.hide),this.helpBubble.addEvent(Affinity.events.overAll,this.show)),this.helpBubble.fade("in"))},hide:function(){this.helpBubble&&(this.helpBubble.removeEvents(),this.helpBubble.fade("out"))},getSize:function(){if(this.helpBubble)return this.helpBubble.measure(function(){return this.getSize()})}}),UIHelpIcon=new Class({Version:"1.0.0.0",Sequence:1120,Name:"Help Icon",File:"ui.help.icon.js",Jira:"",Notes:"",Implements:[Options],Binds:[],options:{},initialize:function(n){if(this.setOptions(n),Affinity.tooltips)Array.each(document.getElements(".indicator.help"),function(n){n.get("data-help")&&(n.set("data-tooltip",n.get("data-help")),n.addClass("ui-has-tooltip"),n.erase("data-help"))}.bind(this)),Affinity.tooltips.init();else throw"UI Help Icon requires UI Tooltips";}}),UIHidables=new Class({Version:"1.0.0.0",Sequence:1090,Name:"Hidable",File:"ui.hidables.js",Jira:"",Notes:"",Implements:[Options],Binds:["processNew","process","processTriggers","processEachTrigger","triggerClicked"],options:{},initialize:function(n){this.setOptions(n),this.hidableFxs={},this.processTriggers()},processNew:function(){this.processTriggers()},processTriggers:function(){var n=document.getElements(".has-hidable");n.length>0&&Array.each(n,this.processEachTrigger)},process:function(n){this.processEachTrigger(n)},processEachTrigger:function(n){var t,i=n.get("data-hidable-trigger-id");document.id(i)&&(t=document.id(n.get("data-hidable-trigger-id")),t.store("hidableFx",new Fx.Reveal(t,{duration:250,mode:"vertical"})),n.addEvent("click",this.triggerClicked),t.setStyle("display","none"),t.removeClass("hidden"),t.hasClass("auto-hide")||t.retrieve("hidableFx").reveal())},triggerClicked:function(n){var t=!0,r=n.target,i=document.id(n.target.get("data-hidable-trigger-id"));n.target.get("type")!="checkbox"||n.target.checked||(t=!1),t?(i.retrieve("hidableFx").reveal(),n.target.get("name")&&Array.each(document.getElements("input[name="+n.target.get("name")+"]"),function(t){t!=n.target&&document.id(t.get("data-hidable-trigger-id")).retrieve("hidableFx").dissolve()}.bind(this))):i.retrieve("hidableFx").dissolve()}});"Affinity"in window||(window.Affinity={}),"Components"in Affinity||(Affinity.Components={}),Affinity.Components.UIInit={},Affinity.Components.UIInit.Version="1.0.2.0",Affinity.Components.UIInit.Sequence=40,Affinity.Components.UIInit.Name="UI Init",Affinity.Components.UIInit.File="ui.init.js",Affinity.Components.UIInit.Jira="",Affinity.Components.UIInit.Notes="Add cleanup",Locale.define("en-NZ","Date",{months:["January","February","March","April","May","June","July","August","September","October","November","December"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],dateOrder:["date","month","year","/"],ordinal:function(n){return n>3&&n<21?"th":["th","st","nd","rd","th"][Math.min(n%10,4)]},AM:"am",PM:"pm"}),Locale.use("en-NZ"),window.components=[["UIHelpBubble","helpbubble"],["UIGrid"],["UISortableGrid"],["UIDynamicGrid"],["UIScrollableGrid"],["UITabs"],["UIInbox"],["UIHidables"],["UIFormHideables","formhideables"],["UISectionHideables","sectionHidables"],["UIHideToggle","hidetoggle"],["UIUplaoders"],["UIUplaodersMulti","uploaders"],["UIReplaceArrows","arrows"],["UIValidation"],["UISanitise"],["UIDateDropDowns"],["UISelectLookup","lookups"],["UIDisplayLookup","displaylookups"],["UIDateCalendar"],["UIListBuilder"],["UIDateCleverInput"],["UIAutoComplete"],["UIQuickSearch"],["UIModal","modal"],["UIDrawPanels"],["UITooltips","tooltips"],["UIHelpIcon","helpicon"],["UIPompts","prompts"],["UIFormatDate"],["UIBankNumber","banknumber"],["UITaxNumber","taxnumber"],["UIMasterMessage","masterMessage"],["UIAddress","address"],["UIPager"],["UITextareaAutoSize","textAutoSize"]],Affinity.PrimaryInit=function(){var t,r,i,n,u;if(!Affinity.uiready){for(window.removeEvent("PageReady",Affinity.PrimaryInit),Affinity.basepath=window.basepath||"",window.basepath=null,delete window.basepath,r=0;r<window.components.length;r++)if(t=window.components[r],typeof window[t[0]]!="undefined"&&typeOf(window[t[0]])==="class")if(n=t[0].replace("UI","ui"),n in Affinity)console.log('name collision in Affinity for "'+n+'"');else if(Affinity[n]=new window[t[0]],Affinity.Components[n]={},Affinity.Components[n].Version=Affinity[n].Version||"",Affinity.Components[n].Sequence=typeOf(Affinity[n].Sequence)!==null?Affinity[n].Sequence:-1,Affinity.Components[n].Name=Affinity[n].Name||t[0].replace(new RegExp("UI","gi"),"").split(/(?=[A-Z])/).join(" "),Affinity.Components[n].File=Affinity[n].File||"",Affinity.Components[n].Description=Affinity[n].Description||"",Affinity.Components[n].Jira=Affinity[n].Jira||"",Affinity.Components[n].Notes=Affinity[n].Notes||"",t.length>1)for(u=1;u<t.length;u++)i=t[u],i in Affinity?console.log('name collision in Affinity for "'+i+'"'):Affinity[i]=Affinity[n];n=null,i=null,t=null,Affinity.uiready=!0,window.fireEvent("UiReady"),Affinity.hasDashboard&&!Affinity.modernUIEndabled&&(Affinity.dashboardWrapper=new DashboardWrapper),Affinity.debug&&console.info("<< ui ready (UiReady event fired by ui.init.js) >>"),setTimeout(function(){Affinity.PrimaryInit=null,delete Affinity.PrimaryInit},1e3)}},window.addEvent("AffinityReady",Affinity.PrimaryInit),Affinity.Components=Affinity.Components||{},Affinity.Components.UILogin={Version:"1.0.12.0",Sequence:50,Name:"Login",File:"ui.login.js",Jira:"",Notes:"Update root basepath"};var UILogin=new Class({Implements:[Options,Events],Binds:["clearActivityMonitor","startActivityMonitor","activity","sessionTimeoutReset","inactivity","cont","show","hide","getAdminDates","returnAdminDate","getUser","check","login","logout","logged","setSession","clearSession","htmlTemplateLoadError","htmlTemplateLoadSuccess","requestSessionFailed","requestSessionFailedException","requestSessionFailedTimeout","getUserInformation"],options:{title:!1,auto:!0,showCancel:!1,target:null,targetbg:null,targetbgpartial:null,logoutButton:null,htmlTemplateUrl:null,underlay:!1},publicHolidays:[],user:{},access:{},keepSession:!1,rememberMe:!1,isPartial:!1,logstatus:"loggedout",profile_stub:{employeeNumber:null,firstName:null,lastName:null,commonName:null,currentPayPeriodBegins:null,currentPaydate:null,employeePeriodStart:null,employeePeriodEnd:null,previousPaydate:null,nextPaydate:null,newestTimesheetDate:null,oldestTimesheetDate:null,showTimesheetFrom:null,startDayOfTheWeek:null,publicHolidays:[],admin:!1},area_stub:{IsManager:!1,IsEmployee:!1,DefaultView:!1,WeeklyDays:!1},area_timesheets_stub:{IsManager:!1,IsEmployee:!1,ShowPeriodView:!1,ShowWeeklyView:!1,ShowDetailView:!1,ShowOverviewView:!1,ShowDualDetailView:!1,ShowBulkView:!1,ShowMileageView:!1,ReadonlyWeeklyView:!1,ReadonlyDetailView:!1,ReadonlyDualdetailView:!1,DefaultView:!1,WeeklyDays:!1,AddUnit:!1,EnableFavourite:!1},hoiday_stub:{DateTime:null,Description:""},screenFilter_stub:{FieldName:"",ModelName:"",Label:""},initialize:function(n){this.setOptions(n),!1 in window&&(window.Affinity={}),Affinity.login={},Affinity.login.companyNumber=!1,Affinity.login.profile={},Affinity.login.userProfiles={},Affinity.login.areas={},Affinity.login.ready=!1,Affinity.login.controller=this,Affinity.resetSessionTimer=this.sessionTimeoutReset,Affinity.testSessionTimeout=this.inactivity,window.addEvent("unauthorized",this.logout),window.addEvent("logout",this.logout),this.activityMonitorPinger=new Request.JSON({url:Affinity.urlroot+"Api/TouchSession",onSuccess:this.sessionTimeoutReset}),this.options.htmlTemplateUrl!==null?new Request.HTML({url:this.options.htmlTemplateUrl,evalScripts:!1,onFailure:this.htmlTemplateLoadError,onError:this.htmlTemplateLoadError,onSuccess:this.htmlTemplateLoadSuccess}).get():this.setup()},htmlTemplateLoadSuccess:function(n){Array.each(n,function(n){n.inject(document.body,"bottom")}),this.options.title&&document.getElement(".login-underlay-header .heading").set("html",this.options.title),this.options.target=document.id("login-box"),this.options.targetbg=document.id("login-box-bg"),this.options.targetbgpartial=document.id("login-box-bg-partial"),this.options.underlay?(this.options.targetbg=document.id("login-underlay"),document.id("login-box-bg")&&document.id("login-box-bg").destroy()):(this.options.targetbg=document.id("login-box-bg"),document.id("login-underlay")&&document.id("login-underlay").destroy()),Affinity.mobile||this.options.target.removeClass("invisible"),this.options.target.getElement(".font-icons").set("html",Affinity.icons.Key),Affinity.modernUIEndabled&&(this.options.target.querySelector("input#username").setAttribute("placeholder","Username"),this.options.target.querySelector("input#password").setAttribute("placeholder","Password")),this.setup()},htmlTemplateLoadError:function(){Affinity.prompts.hide(),this.fireEvent("error",'"'+this.options.htmlTemplateUrl+'" must exist in your project.')},setup:function(){var t,n,i;if(this.user.firstName="",this.user.lastname="",this.user.displayname="",this.user.employeeNumber="",this.user.companyNumber="",this.sessionTimeout=parseFloat(Affinity.sessionDurationMins),this.options.underlay?this.options.targetbg.addClass("hidden"):(this.options.targetbg.set("tween",{duration:250}),this.options.targetbg.fade("hide")),this.options.targetbgpartial!==null&&(this.options.targetbgpartial.set("tween",{duration:250}),this.options.targetbgpartial.fade("hide")),this.options.target.set("tween",{duration:250}),this.options.target.fade("hide"),this.options.showCancel&&(this.options.target.getElement(".button.grey").removeClass("hidden"),this.options.target.getElement(".button.grey").addEvent(Affinity.events.click,this.cancel.bind(this))),this.userInput=this.options.target.getElement("input#username"),this.passInput=this.options.target.getElement("input#password"),this.rememberMeInput=this.options.target.getElement("input#rememberme"),this.keepSeesionInput=this.options.target.getElement("input#keeplogged"),this.errormesg=this.options.target.getElement(".errormsg"),this.username="",this.button=this.options.target.getElement(".button.green"),this.loader=new Element("img",{src:Affinity.loaders.light}).inject(this.button,"after"),this.loader.addClass("hidden"),this.button.addEvent(Affinity.events.click,this.processlogin.bind(this)),this.options.logoutButton!=null&&this.options.logoutButton.addEvent(Affinity.events.click,this.logout.bind(this)),window.addEvent("keyup",function(n){n.key=="enter"&&this.status=="open"&&this.processlogin()}.bind(this)),t="",t=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.authroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession=new Request.JSON({url:t,method:"get",timeout:6e4,onSuccess:this.setSession,onError:this.requestSessionFailed,onFailure:this.requestSessionFailed,onException:this.requestSessionFailedException,onTimeout:this.requestSessionFailedTimeout}),Affinity.mobile&&("onorientationchange"in window?window.addEvent("orientationchange",function(){(this.status="open")&&this.position()}.bind(this)):window.addEvent("resize",function(){(this.status="open")&&this.position()}.bind(this))),Affinity.login.ready=!0,this.fireEvent("ready"),window.fireEvent("LoginReady"),document.querySelector(".pagewrapper.hidden")&&document.querySelector(".pagewrapper.hidden").classList.remove("hidden"),n=new URI(window.location.href),typeOf(n.parsed.query)!=="null"&&(i=n.parsed.query.parseQueryString(),typeOf(i.sessionKey)!=="null")){this.checkSessionKey.delay(1e3,this,i.sessionKey),delete n;return}this.options.auto&&this.check.delay(1e3,this)},monitoringActivity:!1,activityMonitorTimeout:!1,setActivityThrottle:!1,sessionTimeout:20,clearActivityMonitor:function(){clearTimeout(this.setActivityThrottle),clearTimeout(this.activityMonitorTimeout),window.removeEvent("keydown",this.activity),window.removeEvent("mousedown",this.activity),window.removeEvent("click",this.activity),window.removeEvent("mousemove",this.activity)},startActivityMonitor:function(){this.clearActivityMonitor(),window.addEvent("keydown",this.activity),window.addEvent("mousedown",this.activity),window.addEvent("click",this.activity),window.addEvent("mousemove",this.activity),this.activity(),this.monitoringActivity=!0,this.activityMonitorTimeout=this.inactivity.delay(6e4*this.sessionTimeout,this)},activity:function(){clearTimeout(this.setActivityThrottle),this.setActivityThrottle=function(){this.activityMonitorPinger.isRunning()&&this.activityMonitorPinger.cancel(),this.activityMonitorPinger.get()}.delay(5e3,this)},sessionTimeoutReset:function(){clearTimeout(this.activityMonitorTimeout),this.activityMonitorTimeout=this.inactivity.delay(6e4*this.sessionTimeout,this)},inactivity:function(){this.isPartial=!0,this.partialEmp=this.user.employeeNumber+"",this.clearActivityMonitor(),this.logout({message:"Your session has timed out.<br />Please login to carry on where you left off."})},getUserRequest:null,getUser:function(n){if(log("&#x2794; attempting getUser profile ("+n+") ..."),isNaN(n)||(n=n+""),Affinity.login.userProfiles.hasOwnProperty(n))return window.fireEvent("gotUser",Affinity.login.userProfiles[n]),log("&#x2714; attempted getUser profile ("+n+") succeeded - already exists in local",{color:"green"}),Affinity.login.userProfiles[n];if(typeOf(n)!=="string"||typeOf(n)==="string"&&n.trim()==="")return window.fireEvent("gotUser",!1),!1;this.getUserRequest&&"isRunning"in this.getUserRequest&&this.getUserRequest.isRunning()&&this.getUserRequest.cancel();var t=Affinity.GetCacheSafePath(Affinity.authroot+"/GetEmployeeProfile?EmployeeNo="+n);this.getUserRequest=new Request.JSON({url:t,onRequest:function(){log("&#x2794; attempting getUser profile request ("+n+") ...",{color:"blue"})},onSuccess:function(t){if(JSON.Unauthorized(t,"login getUser profile ("+n+")")){log("&#x2714; attempted getUser profile ("+n+") failed - unauthorized",{color:"red"}),window.fireEvent("gotUser",!1);return}if(t.hasOwnProperty("error")&&typeOf(t.error)!=="null"){if(typeOf(t.error)==="object"){log("&#x2714; attempted getUser profile ("+n+") failed with errors - "+JSON.stringify(t.error),{color:"red"}),window.fireEvent("gotUser",!1);return}log("&#x2714; attempted getUser profile ("+n+") failed with errors - "+t.error.split("\r\n").join(", "),{color:"red"}),window.fireEvent("gotUser",!1);return}log("&#x2714; attempted getUser profile ("+n+") succeeded from zelos",{color:"green","font-weight":"bold"});var i=Object.clone(this.profile_stub);i.firstName=t.FirstName,i.lastName=t.LastName,i.commonName=t.CommonName,i.employeeNumber=t.EmployeeNumber,i.companyNumber=Affinity.login.profile.companyNumber,i.payPoints=typeOf(t.PayPoints)!=="null"?t.PayPoints:!1,i.employeeGroups=typeOf(t.EmployeeGroups)!=="null"?t.EmployeeGroups:[],i.screenFilters=typeOf(t.ScreenFilters)!=="null"?t.ScreenFilters:[],i.publicHolidays=typeOf(t.PublicHolidays)!=="null"?t.PublicHolidays:[],i.currentPayPeriodBegins=typeOf(t.CurrentPayPeriodBegins)!=="null"?Date.parse(t.CurrentPayPeriodBegins):!1,i.currentPaydate=typeOf(t.CurrentPaydate)!=="null"?Date.parse(t.CurrentPaydate):!1,i.previousPaydate=typeOf(t.PreviousPaydate)!=="null"?Date.parse(t.PreviousPaydate):!1,i.nextPaydate=typeOf(t.NextPaydate)!=="null"?Date.parse(t.NextPaydate):!1,i.oldestTimesheetDate=typeOf(t.OldestTimesheetDate)!=="null"?Date.parse(t.OldestTimesheetDate):!1,i.newestTimesheetDate=typeOf(t.NewestTimesheetDate)!=="null"?Date.parse(t.NewestTimesheetDate):!1,i.startDayOfTheWeek=typeOf(t.StartDayOfTheWeek)!=="null"?parseInt(t.StartDayOfTheWeek):0,i.rowsPerPage=typeOf(t.RowsPerPage)!=="null"?parseInt(t.RowsPerPage):20,t.EmployeeNumber>5e6&&(i=this.getAdminDates(i)),Affinity.login.userProfiles[i.employeeNumber]=Object.clone(i),window.fireEvent("gotUser",i)},onError:function(t){log("&#x2714; attempted getUser profile ("+n+") failed with errors - "+t,{color:"red"}),window.fireEvent("gotUser",!1)},onException:function(t,i){log("&#x2714; attempted getUser profile ("+n+") failed with errors - "+t+": "+i,{color:"red"})}.bind(this),onFailure:function(t){var i="",r;switch(t.status){case 401:i="unauthorized.";break;case 404:i="path not found.";break;case 500:try{r=JSON.decode(t.responseText)}catch(u){r=!1,i=t.responseText}r&&(i=r.error?r.error:t.responseText);break;default:i=t.statusText}i.contains(401)||i.toLowerCase().contains("unauthorized")?log("&#x2714; attempted getUser profile ("+n+") failed - unauthorized",{color:"red"}):log("&#x2714; attempted getUser profile ("+n+") failed with errors - "+i,{color:"red"}),window.fireEvent("gotUser",!1)},onTimeout:function(){log("&#x2714; attempted getUser profile ("+n+") timeout",{color:"red"}),window.fireEvent("gotUser",!1)}}).get()},checkRequest:!1,check:function(){var r,t,n,i,u;if(Affinity.apiversion>1)r=Affinity.GetCacheSafePath(Affinity.authroot+"/GetUser"),this.checkRequest=new Request.JSON({url:r,onSuccess:function(n){if(typeof n=="object"&&"success"in n&&!n.success){var t="error"in n&&typeof u=="string"?n.error:"unknown error";log("** login check failed - "+t+" **"),this.logout()}else log("** login check succeeded **"),this.setSession(n)}.bind(this)}).get();else{if(t=Affinity.appname+"Session",n=Affinity.CookieMonster.Read(t),Affinity.session=!1,typeOf(n)==="string"&&typeOf(n)!==""&&typeOf(n)!=="undefined"&&(Affinity.session=n),i=t+": "+Affinity.seesion,Affinity.session||(typeOf(n)==="boolean"?i="no session key - cookie "+t+" is false":typeOf(n)==="string"&&n===""?i="no session key - cookie "+t+" is empty":typeOf(n)==="string"&&n==="undefined"?i="no session key - cookie "+t+" is undefined":typeOf(n)==="null"&&(i="no session key - cookie "+t+" is null or undefined")),log("** check login status ("+i+") **"),!Affinity.session){log("** login check failed **"),this.clearSession(),this.logout({}),this.login();return}if(u="",this.user=!1,Affinity.CookieMonster.Read(Affinity.appname+"User")&&(user=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"User")),typeOf(user.firstName)==="null"&&typeOf(user.lastname)==="null"||user.firstName==="null"&&user.lastname==="null"||(user.firstName+"").trim()+(user.lastname+"").trim()+(user.displayName+"").trim()==""||user.employeeNumber===""||typeOf(user.employeeNumber)==="null"||user.employeeNumber=="null"||user.companyNumber===""||typeOf(user.companyNumber)==="null"||user.companyNumber=="null"||(this.user=user,window.fireEvent("userComplete",user))),!this.user){log("** login check failed - minimum data requirement not met **"),this.clearSession(),this.logout({message:"Minimum login details are not set."}),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.login();return}log("** login check succeeded **"),this.companyNumber=Affinity.CookieMonster.Read(Affinity.appname+"CompanyNumber"),this.keepSession=Affinity.CookieMonster.Read(Affinity.appname+"KeepSession")==="false"?!1:!0,this.rememberMe=Affinity.CookieMonster.Read(Affinity.appname+"RememberMe")==="false"?!1:Affinity.CookieMonster.Read(Affinity.appname+"RememberMe"),this.rememberMe!==null&&this.rememberMe!==!1?(this.username=this.rememberMe,this.rememberMe=!0):(this.username="",this.rememberMe=!1),this.keepSession=this.keepSession!==null&&this.keepSession!==!1?!0:!1,Affinity.session?(Affinity.CookieMonster.Read(Affinity.appname+"Areas")&&(this.areas=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"Areas"))),Affinity.CookieMonster.Read(Affinity.appname+"PayPoints")&&(this.payPoints=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"PayPoints"))),Affinity.CookieMonster.Read(Affinity.appname+"EmployeeGroups")&&(this.employeeGroups=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"EmployeeGroups"))),Affinity.CookieMonster.Read(Affinity.appname+"ScreenFilters")&&(this.screenFilters=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"ScreenFilters"))),Affinity.CookieMonster.Read(Affinity.appname+"PublicHolidays")&&(this.publicHolidays=JSON.decode(Affinity.CookieMonster.Read(Affinity.appname+"PublicHolidays"))),this.logged()):this.logout()}},returnAdminDate:function(n){var t=parseFloat(n.replace("-","").replace("+","")),r=365.2422/12,u=t%1==0,f=n.contains("-"),i=(new Date).clearTime();return f?u?i.decrement("month",t):i.decrement("day",r*t):u?i.increment("month",t):i.increment("day",r*t)},getAdminDates:function(n){var t=(new Date).clearTime(),f="-0.25",e="+0.25",o="-3",s="+1",i,r,u;return n.admin=!0,"Affinity"in window&&typeOf(Affinity)==="object"&&"AdminPayPeriodBegins"in Affinity&&Affinity.AdminPayPeriodBegins&&(f=Affinity.AdminPayPeriodBegins,e=Affinity.AdminPayPeriodEnds,o=Affinity.AdminOldestTimesheet,s=Affinity.AdminNewestTimesheet),n.currentPayPeriodBegins=this.returnAdminDate(f),n.currentPayPeriodEnds=this.returnAdminDate(e),n.oldestTimesheetDate=this.returnAdminDate(o),n.newestTimesheetDate=this.returnAdminDate(s),i=t.clone().decrement("month",1),r=t.clone(),u=t.clone().increment("month",1),n.currentPaydate=r.set("date",r.get("lastdayofmonth")),n.previousPaydate=i.set("date",i.get("lastdayofmonth")),n.nextPaydate=u.set("date",u.get("lastdayofmonth")),n},setSession:function(n){var f,i,t,u,r;if(this.isPartial&&(n.EmployeeNumber+"").trim()!==this.partialEmp.trim()){this.isPartial=!1,window.location.href=window.location.href;return}if(typeOf(n)==="object"&&"success"in n&&!n.success){this.clearSession(),this.logout({message:"Invalid username or password."+("error"in n?"<!--"+n.error+"-->":"")});return}if("isEss"in n&&typeOf(n.isEss)==="boolean"&&n.isEss===!0&&(Affinity.oldess=!0,Affinity.oldessLaunched=!0,Affinity.oldessFrame=!1,Affinity.oldessWindow=window.opener),(typeOf(n.Commonname)==="null"||n.Commonname==="")&&(n.Commonname=(n.Firstname+" "+n.Lastname).replace("  "," ").trim()),f=!1,Affinity.session=!1,Affinity.apiversion<2&&(Affinity.session=!1,typeOf(n.SessionKey)==="string"&&typeOf(n.SessionKey)!==""&&typeOf(n.SessionKey)!=="undefined"?Affinity.session=n.SessionKey:f=!0),i="",f&&(i+="No session key (required for old API method)\r\n"),(typeOf(n.Firstname)==="null"||typeOf(n.Firstname)==="string"&&n.Firstname.trim()==="")&&(i+="No first name\r\n"),(typeOf(n.Lastname)==="null"||typeOf(n.Lastname)==="string"&&n.Lastname.trim()==="")&&(i+="No last name\r\n"),(typeOf(n.EmployeeNumber)==="null"||typeOf(n.EmployeeNumber)==="string"&&n.EmployeeNumber.trim()==="")&&(i+="No employee number\r\n"),(typeOf(n.CompanyNumber)==="null"||typeOf(n.CompanyNumber)==="string"&&n.CompanyNumber.trim()==="")&&(i+="No company number\r\n"),i!==""){log("&#x2718; attempted login succeeded with errors - Minimum login details are not set"),this.clearSession(),this.logout({message:"Minimum login details are not set.<!--\r\n"+i+"\r\n-->"});return}if(log("&#x2714; attempted login succeeded"),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.employeeNumber=n.EmployeeNumber,this.companyNumber=n.CompanyNumber,this.values={},Object.each(n,function(n,t){(typeOf(n)==="string"||typeOf(n)==="number")&&(this.values[t]=n),this[t]=n}.bind(this)),typeOf(this.values.ShowTimesheetFrom)==="null"&&(this.values.ShowTimesheetFrom=Date.parse(new Date).decrement("day",14),this.ShowTimesheetFrom=this.values.ShowTimesheetFrom),typeOf(this.values.NewestTimesheetDate)==="null"&&typeOf(this.values.ShowTimesheetFrom)!=="null"&&(typeOf(this.values.ShowTimesheetFrom)==="string"?this.values.NewestTimesheetDate=Date.parse(this.values.ShowTimesheetFrom).increment("month",1):typeOf(this.values.ShowTimesheetFrom)==="date"&&(this.values.NewestTimesheetDate=this.values.ShowTimesheetFrom.clone().increment("month",1)),this.NewestTimesheetDate=this.values.NewestTimesheetDate),this.areas=this.Areas,this.payPoints=n.PayPoints,this.employeeGroups=n.EmployeeGroups,this.screenFilters=n.ScreenFilters,n.PublicHolidays&&(this.publicHolidays=n.PublicHolidays),this.user={},this.user.firstName=this.values.Firstname,this.user.lastname=this.values.Lastname,this.user.displayName=this.values.Commonname,this.user.employeeNumber=this.employeeNumber,this.user.companyNumber=this.companyNumber,t=Object.clone(this.profile_stub),t.firstName=n.Firstname,t.lastName=n.Lastname,t.commonName=n.Commonname,t.employeeNumber=n.EmployeeNumber,t.companyNumber=n.CompanyNumber,t.payPoints=typeOf(n.PayPoints)!=="null"?n.PayPoints:!1,t.employeeGroups=typeOf(n.EmployeeGroups)!=="null"?n.EmployeeGroups:[],t.screenFilters=typeOf(n.ScreenFilters)!=="null"?n.ScreenFilters:[],t.publicHolidays=typeOf(n.PublicHolidays)!=="null"?n.PublicHolidays:[],t.currentPayPeriodBegins=typeOf(n.CurrentPayPeriodBegins)!=="null"?Date.parse(n.CurrentPayPeriodBegins):!1,t.currentPaydate=typeOf(n.CurrentPaydate)!=="null"?Date.parse(n.CurrentPaydate):!1,t.employeePeriodStart=typeOf(n.EmployeePeriodStart)!=="null"?Date.parse(n.EmployeePeriodStart):!1,t.employeePeriodEnd=typeOf(n.EmployeePeriodEnd)!=="null"?Date.parse(n.EmployeePeriodEnd):!1,t.previousPaydate=typeOf(n.PreviousPaydate)!=="null"?Date.parse(n.PreviousPaydate):!1,t.nextPaydate=typeOf(n.NextPaydate)!=="null"?Date.parse(n.NextPaydate):!1,t.oldestTimesheetDate=typeOf(n.OldestTimesheetDate)!=="null"?Date.parse(n.OldestTimesheetDate):!1,t.newestTimesheetDate=typeOf(n.NewestTimesheetDate)!=="null"?Date.parse(n.NewestTimesheetDate):!1,t.startDayOfTheWeek=typeOf(n.StartDayOfTheWeek)!=="null"?parseInt(n.StartDayOfTheWeek):0,t.rowsPerPage=typeOf(n.RowsPerPage)!=="null"?parseInt(n.RowsPerPage):20,n.EmployeeNumber>5e6&&(t=this.getAdminDates(t)),Affinity.login.profile=Object.clone(t),Affinity.login.hasOwnProperty("userProfiles")||(Affinity.login.userProfiles={}),Affinity.login.userProfiles[t.employeeNumber]=Object.clone(t),Affinity.login.areas={},"Areas"in n&&typeOf(n.Areas)==="object"&&Object.each(n.Areas,function(n,t){Affinity.login.areas[t]={},u={},u=t==="Timesheet"?Object.clone(this.area_timesheets_stub):Object.clone(this.area_stub),Object.each(u,function(i,r){r in n&&(Affinity.login.areas[t][r]=n[r])}.bind(this))}.bind(this)),this.companyNumber=this.CompanyNumber,this.employeeNumber=this.EmployeeNumber,this.errormesg.addClass("hidden"),this.keepSeesionInput.checked?(Affinity.CookieMonster.Write(Affinity.appname+"KeepSession",!0),this.keepSession=!0):(Affinity.CookieMonster.Write(Affinity.appname+"KeepSession",!1),this.keepSession=!1),this.rememberMeInput.checked?(Affinity.CookieMonster.Write(Affinity.appname+"RememberMe",this.userInput.value),this.rememberMe=!0,this.username=this.userInput.value):(Affinity.CookieMonster.Write(Affinity.appname+"RememberMe",!1),this.rememberMe=!1,this.username=""),!(Affinity.apiversion>1)&&(Affinity.CookieMonster.Write(Affinity.appname+"Values",JSON.stringify(this.values)),Affinity.CookieMonster.Write(Affinity.appname+"Values",JSON.stringify(this.values)),Affinity.CookieMonster.Write(Affinity.appname+"Areas",JSON.stringify(this.areas)),Affinity.CookieMonster.Write(Affinity.appname+"PayPoints",JSON.stringify(this.payPoints)),Affinity.CookieMonster.Write(Affinity.appname+"EmployeeGroups",JSON.stringify(this.employeeGroups)),Affinity.CookieMonster.Write(Affinity.appname+"ScreenFilters",JSON.stringify(this.screenFilters)),n.PublicHolidays&&Affinity.CookieMonster.Write(Affinity.appname+"PublicHolidays",JSON.stringify(this.publicHolidays)),Affinity.CookieMonster.Write(Affinity.appname+"User",JSON.stringify(this.user)),Affinity.CookieMonster.Write(Affinity.appname+"CompanyNumber",this.companyNumber,720),Affinity.CookieMonster.Write(Affinity.appname+"EmployeeNumber",this.employeeNumber,720),this.keepSession?Affinity.CookieMonster.Write(Affinity.appname+"Session",Affinity.session):Affinity.CookieMonster.Write(Affinity.appname+"Session",Affinity.session,720),typeOf(n.success)!=="null"&&!n.success||typeOf(n.Error)!=="null"||typeOf(n.error)!=="null")){r=!1,this.errormesg.set("html","We could not log you in"),this.errormesg.addClass("hidden"),typeOf(n.error)!=="null"&&n.error!==""?r=this.sanatiseError(n.error):typeOf(n.Error)!=="null"&&n.Error!==""&&(r=this.sanatiseError(n.error)),r&&(this.errormesg.set("html",r),this.errormesg.removeClass("hidden")),log("&#x2718; attempted login succeeded with errors - "+r),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.clearSession(),this.show(),this.requestSessionFailed();return}this.logstatus==="loggedout"&&(this.logstatus="loggedin",this.isPartial||window.fireEvent("userComplete",Affinity.login.profile),this.startActivityMonitor(),this.logged())},clearSession:function(){Affinity.apiversion>1||(Affinity.CookieMonster.Delete(Affinity.appname+"User"),Affinity.CookieMonster.Delete(Affinity.appname+"Areas"),Affinity.CookieMonster.Delete(Affinity.appname+"PayPoints"),Affinity.CookieMonster.Delete(Affinity.appname+"PublicHolidays"),Affinity.CookieMonster.Delete(Affinity.appname+"EmployeeGroups"),Affinity.CookieMonster.Delete(Affinity.appname+"ScreenFilters"),Affinity.CookieMonster.Delete(Affinity.appname+"Values"),Affinity.CookieMonster.Delete(Affinity.appname+"CompanyNumber"),Affinity.CookieMonster.Delete(Affinity.appname+"EmployeeNumber"),Affinity.CookieMonster.Delete(Affinity.appname+"Session"),Affinity.session=!1),typeOf(this.values)==="object"&&Object.each(this.values,function(n,t){this[t]=null,delete this[t]}.bind(this)),this.values={},this.user.firstName="",this.user.lastname="",this.user.displayname="",this.user.employeeNumber="",this.user.companyNumber="",this.user={},this.areas={Timesheet:{},Employee:{}},this.payPoints=[],this.employeeGroups=[],this.screenFilters=[],this.companyNumber=null,this.employeeNumber=null,this.publicHolidays=[],this.show(),this.logstatus="loggedout",this.isPartial||(window.scrollTo(0,0),window.fireEvent("loggedout"))},requestSessionFailed:function(n){typeOf(n)!=="null"&&(n.statusText?log("&#x2718; attempted login failed - "+n.statustext):log("&#x2718; attempted login failed with errors - "+JSON.stringify(n))),this.errormesg.removeClass("hidden"),this.button.removeClass("hidden"),this.loader.addClass("hidden")},requestSessionFailedException:function(){log("&#x2718; attempted login failed with exception(s)"),this.errormesg.set("html","There was an exception. Please try again."),this.errormesg.removeClass("hidden"),this.requestSessionFailed()},requestSessionFailedTimeout:function(){log("&#x2718; attempted login timed out"),this.errormesg.set("html","Attempt timed out. Please check your connection and try again."),this.errormesg.removeClass("hidden"),this.requestSessionFailed()},checkSessionKeyRequest:!1,checkSessionKey:function(n){var t,i;Affinity.apiversion>1?(t=Affinity.GetCacheSafePath(Affinity.authroot+"/CheckSession"),this.checkSessionKeyRequest=new Request.JSON({url:t,onSuccess:this.setSession,onError:this.show,onFailure:this.show}),this.checkSessionKeyRequest.setHeader("sessionkey",n),this.checkSessionKeyRequest.get()):(t=Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),log("&#x2794; attempting login ..."),i=new Request.JSON({url:t,method:"get",onSuccess:this.setSession,onError:this.show,onFailure:this.show}),i.setHeader("sessionkey",n),i.get(),delete url)},logged:function(){Affinity.isloggedin=!0,this.isPartial?Affinity.hasOwnProperty("timesheets")&&Affinity.timesheets.hasOwnProperty("init")&&(Affinity.timesheets.init.loggedin(null,!0),Affinity.loginsThisSession++):(Affinity.apiversion>1?window.fireEvent("loggedin",!0):window.fireEvent("loggedin",Affinity.session),Affinity.loginsThisSession++),this.hide(),this.isPartial=!1,window.dispatchEvent(new CustomEvent("GAReady",{bubbles:!0,detail:{companyNumber:Affinity.login.profile.companyNumber,employeeNumber:Affinity.login.profile.employeeNumber}}))},login:function(){this.show()},processlogin:function(){this.button.addClass("hidden"),this.loader.removeClass("hidden"),log("&#x2794; attempting login ...");var n="";n=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.authroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession.url=this.requestSession.options.url=n,this.requestSession.setHeader("username",this.userInput.value),this.requestSession.setHeader("password",this.passInput.value),this.requestSession.get()},logout:function(n){var r,t,i;if(log("** log out **"),clearTimeout(this.hiddenTimer),this.clearActivityMonitor(),this.button.removeClass("hidden"),this.loader.addClass("hidden"),this.logstatus="loggingout...",typeOf(n)!=="null"){if(typeOf(n.closewindow)!=="null"&&n.closewindow){this.clearSession(),window.close();return}typeOf(n.message)==="string"&&(log("** log out message: \r\n"+n.message.replace("<!--","").replace("-->","")+"\r\n"),this.errormesg.set("html",n.message),this.errormesg.removeClass("hidden"))}Affinity.apiversion>1?(t=Affinity.GetCacheSafePath(Affinity.authroot+"/Logout"),r=new Request.JSON({url:t,method:"get",onRequest:function(){log("&#x2794; attempting logout ...",{color:"blue"})},onSuccess:function(){log("&#x2714; attempted logout succeeded from zelos",{color:"green"}),this.isPartial&&(this.clearSession(),this.show())}.bind(this),onError:function(n){log("&#x2714; attempted logout failed with errors - "+n,{color:"red"})},onException:function(n,t){log("&#x2714; attempted logout failed with errors - "+n+": "+t,{color:"red"})}.bind(this),onFailure:function(n){var t="",i;switch(n.status){case 401:t="unauthorized.";break;case 404:t="path not found.";break;case 500:try{i=JSON.decode(n.responseText)}catch(r){i=!1,t=n.responseText}i&&(t=i.error?i.error:n.responseText);break;default:t=n.statusText}t.contains(401)||t.toLowerCase().contains("unauthorized")?log("&#x2714; attempted logout failed - unauthorized",{color:"red"}):log("&#x2714; attempted logout failed with errors - "+t,{color:"red"})},onTimeout:function(){log("&#x2714; attempted logout timeout",{color:"red"})}}).get(),t=null):(i=Affinity.session+"",i&&i!==""&&(t=Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Logout")),typeOf(t)!=="null"&&(r=new Request.JSON({url:t,method:"get"}),r.setHeader("sessionkey",i),r.get(),t=i=null)),this.isPartial||(this.show(),function(){this.clearSession()}.delay(250,this)),Affinity.isloggedin=!1},sanatiseError:function(n){return typeOf(n)!=="null"&&n.toLowerCase().contains("failed to authenticate")?"Your Username or Password were incorrect":typeOf(n)==="null"?"We could not log you in":n.contains(" - ")?n.substring(n.indexOf(" - ")+3):n},position:function(){this.options.target.removeClass("invisible");return},hiddenTimer:null,setAsHidden:function(){this.options.target.addClass("hidden"),this.options.targetbg.addClass("hidden")},set:function(n){if(n.username&&(this.userInput.value=n.username),n.password&&(this.passInput.value=n.password),n.zelosServer||n.zelosroot){n.zelosServer&&(Affinity.zelosroot=n.zelosServer),n.zelosroot&&(Affinity.zelosroot=n.zelosroot),n.apiroot&&(Affinity.zelosroot=n.apiroot);var t="";t=Affinity.apiversion>1?Affinity.GetCacheSafePath(Affinity.zelosroot):Affinity.GetCacheSafePath(Affinity.zelosroot+"?api=Authentication/Get"),this.requestSession.options.url=this.requestSession.url=t}},show:function(){this.status="open",this.userInput.value="",this.passInput.value="",this.rememberMeInput.checked=!1,this.keepSeesionInput.checked=!1,this.rememberMe&&(this.rememberMeInput.checked="checked",this.userInput.value=this.username),this.keepSession&&(this.keepSeesionInput.checked="checked"),clearTimeout(this.hiddenTimer),this.options.target.removeClass("hidden"),this.options.underlay&&!this.isPartial?(this.options.targetbgpartial.addClass("hidden"),this.options.targetbg.removeClass("hidden"),this.options.targetbg.fade("in")):this.isPartial&&(this.options.targetbg.addClass("hidden"),this.options.targetbgpartial.removeClass("hidden"),this.options.targetbgpartial.fade("in")),this.options.target.fade("in"),this.position()},hide:function(){this.status="closed",clearTimeout(this.hiddenTimer),this.options.underlay?this.options.targetbg.addClass("hidden"):this.options.targetbg.fade("out"),this.options.targetbgpartial&&this.options.targetbgpartial.getStyle("opacity")!=="0"&&this.options.targetbgpartial.fade("out"),this.options.target.fade("out"),this.hiddenTimer=this.setAsHidden.delay(260,this)},cancel:function(){this.requestSession&&this.requestSession.isRunning()&&this.requestSession.cancel(),this.hide()}}),UIMasterMessageObject=new Class({message:"Message!",okText:"Ok",okIcon:"",onOk:function(){}}),UIMasterMessage=new Class({Version:"1.0.0.0",Sequence:1200,Name:"Master Message",Description:"Master message prompt overlay",File:"ui.master.message.js",Jira:"",Notes:"",Implements:[Options],Binds:["message","center","show","hide"],options:{},status:"closed",message:"",initialize:function(n){this.setOptions(n),this.messageBoxBG=new Element("div",{id:"UIMasterBoxBG","class":"UIPromtBoxBG master"}).inject(document.body,"bottom"),this.messageBoxBG.set("tween",{duration:250}),this.messageBoxBG.fade("hide"),this.messageBox=new Element("div",{id:"UIMasterBox","class":"UIPromtBox master"}).inject(document.body,"bottom"),this.messageBox.set("tween",{duration:250}),this.messageBox.fade("hide"),this.trueButton=new Element("span",{"class":"button green w-icon",tabindex:99999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{"class":"label",html:""})),window.masterMessage=this.message},message:function(n){var t=new UIMasterMessageObject;typeOf(n)==="string"?t.message=n:(t.message=n.message?n.message:t.message,t.onOk=n.onOk?n.onOk:t.onOk,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick),this.messageBox.empty(),this.messageBox.adopt(new Element("span",{html:t.message,"class":"content alignleft"})),this.onEnterMethod=function(){this.hide(),t.onOk()}.bind(this),this.messageBox.adopt(new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().addEvent("click",this.onEnterMethod))),this.messageBox.getElement(".green span").set("html",t.okIcon),this.messageBox.getElement(".green .label").set("html",t.okText),this.center(),this.show(),delete t},getCalculatedTop:function(){var s=this.messageBox.getSize(),i=s.y/2,t,e,o;if(Affinity.oldess&&Affinity.oldessFrame){var n=window.parent,r=n.document.documentElement,u=n.document.body,h=r&&r.scrollTop||u&&u.scrollTop||0,c=n.innerHeight||n.document.documentElement.clientHeight,f;return f=document.documentMode&&document.documentMode<9?window.parent.document.getElementById("ctl00_MainPanel").querySelectorAll(".ContentBody")[0].offsetTop:window.parent.document.getElementById("ctl00_MainPanel").getElementsByClassName("ContentBody")[0].offsetTop,t=h+c/2-f,t<i+10&&(t=i+10),t}return e=document.getSize(),o=document.getScroll(),e.y/2+o.y},center:function(){var n=this.messageBox.getSize();this.messageBox.setStyles({margin:0-n.y/2+"px 0 0 "+(0-n.x/2)+"px",top:this.getCalculatedTop()}),delete n},show:function(){this.messageBoxBG.fade("in"),this.messageBox.fade("in"),this.status="open"},hide:function(){this.messageBoxBG.fade("out"),this.messageBox.fade("out"),this.status="closed",this.message="",window.removeEvent("keyup",this.okKeyUp);try{this.messageBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(n){}}}),UIModal=new Class({Version:"1.0.4.0",Sequence:1060,Name:"Modal",File:"ui.modal.js",Jira:"",Notes:"Add optional afterClose event",Implements:[Options],Binds:["setElement","setString","adopt","position","clear","closeButtonCloser","backgroundCloser","show","hide"],Options:{},backgroundCloses:!0,initialize:function(n){this.setOptions(n),this.icons={},this.icons.del=Affinity.icons.CrossRound,document.id("uimodalbg")||(this.modalbg=new Element("div",{id:"uimodalbg","class":"white hidden"}).inject(document.body,"bottom")),document.id("uimodal")||(this.modal=new Element("div",{id:"uimodal","class":"shadow hidden"}).inject(document.body,"bottom"),this.modalclose=new Element("div",{"class":"uimodalclose"}).inject(this.modal),new Element("span",{"class":"icon-cross"}).inject(this.modalclose),this.modalbody=new Element("div",{"class":"uimodalbody"}).inject(this.modal)),this.modalbg=document.id("uimodalbg"),this.modal=document.id("uimodal"),this.modalbg.set("tween",{duration:250}),this.modal.set("tween",{duration:250}),this.modalclose=this.modal.getElement(".uimodalclose"),this.modalbody=this.modal.getElement(".uimodalbody"),this.modalbg.addEvent("click",this.backgroundCloser),this.modalclose.addEvent("click",this.closeButtonCloser),this.modalbg.removeClass("hidden").fade("hide"),this.modal.removeClass("hidden").fade("hide"),window.addEvent("resize",function(){this.position()}.bind(this)),this.position(),this.scroll={},this.scroll.enable=function(){this.modal.addClass("scroll")}.bind(this),this.scroll.disable=function(){this.modal.removeClass("scroll")}.bind(this),this.close={},this.close.enable=function(){this.modalclose.removeClass("hidden")}.bind(this),this.close.disable=function(){this.modalclose.addClass("hidden")}.bind(this)},getCalculatedTop:function(){var n;if(Affinity.oldess&&Affinity.oldessFrame){var i=window.parent.window,r=i.document.documentElement,u=i.document.body,e=r&&r.scrollTop||u&&u.scrollTop||0,f=0,t=window.parent.document.getElementById("ctl00_MainPanel");return t&&(f=document.documentMode&&document.documentMode<9?t.querySelectorAll(".ContentBody")[0].offsetTop:t.getElementsByClassName("ContentBody")[0].offsetTop),n=e-f,n<10&&(n=10),n+10}return 10},position:function(){var t=this.modal.classList.contains("hidden"),n;this.modal.classList.remove("hidden"),n=window.getSize(),this.modalbg.setStyles({width:n.x,height:n.y}),this.modal.setStyles({left:n.x/2-this.modal.getDimensions().width/2,top:this.getCalculatedTop()}),this.modalbody.setStyles({"max-height":n.y-60}),t&&this.modal.classList.add("hidden")},setElement:function(n){this.modalbody.empty(),n.inject(this.modalbody),this.position(),this.close.enable(),this.scroll.enable()},adopt:function(n){this.setElement(n)},setString:function(n){this.modalbody.empty(),this.modalbody.set("html",n),this.position(),this.close.enable(),this.scroll.enable()},customClass:!1,setClass:function(n){this.customClass=n,this.modal.classList.add(this.customClass),this.modalbg.classList.add(this.customClass)},backgroundCloser:function(){this.backgroundCloses&&this.hide()},closeButtonCloser:function(){this.backgroundCloses&&this.hide()},hide:function(){clearTimeout(this.hideDelay),"beforeClose"in this&&typeOf(this.beforeClose)==="function"&&(this.beforeClose(),this.beforeClose=null,delete this.beforeClose),this.modalbg.fade("out"),this.modal.fade("out"),this.clear.delay(500,this),this.hideDelay=setTimeout(function(){this.modal.classList.add("hidden")}.bind(this),500)},show:function(n){clearTimeout(this.hideDelay),this.modal.classList.remove("hidden"),n==null?(n=!0,this.modalclose.fade("show")):this.modalclose.fade("hide"),this.backgroundCloses=n,this.modalbg.fade("in"),this.modal.fade("in"),this.position()},clear:function(){this.customClass&&(this.modal.classList.remove(this.customClass),this.modalbg.classList.remove(this.customClass),this.customClass=!1),this.modalbody.empty(),"afterClose"in this&&typeOf(this.afterClose)==="function"&&(this.afterClose(),this.afterClose=null,delete this.afterClose)}}),UIPromptPositionObject={position:"absolute",top:!1,left:!1},UILoaderObject={message:"Loading",onClose:function(){},disableEnterClose:!1,timeout:null,position:{},showButtons:!1,showLoader:!0,noClose:!0,cssSelector:""},UIMessageObject={message:"Message!",onClose:function(){},disableEnterClose:!1,timeout:null,position:{},cssSelector:""},UIAlertObject={message:"Alert!",messageAlign:"center",okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},disableEnterClose:!1,showButtons:!0,showCancel:!1,noClose:!1,showLoader:!1,append:!1,position:{},cssSelector:""},UIConfirmObject={message:"Yes or No?",messageAlign:"center",okText:"Yes",okIcon:"",okColor:"green",cancelText:"No",cancelIcon:"",cancelColor:"grey",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,disableEnterClose:!1,position:{},cssSelector:""},UIPromptObject={message:"Enter text",messageAlign:"center",lines:1,okText:"Ok",okIcon:"",okColor:"green",cancelText:"Cancel",cancelIcon:"",cancelColor:"grey",value:"",onOk:function(){},onCancel:function(){},onClose:function(){},noClose:!0,disableEnterClose:!1,position:{},cssSelector:""},UIPompts=new Class({Version:"1.0.6.0",Sequence:1050,Name:"Prompts",File:"ui.prompts.js",Jira:"",Notes:"Add Loader + optional type check",Implements:[Options],Binds:["returnOptionsObject","message","alert","prompt","confirm","loader","center","show","escape","hide","hideDelay","clearHideDelay","okKeyUp"],options:{},status:"closed",message:"",currentObj:!1,container:!1,currentType:"",initialize:function(n){this.setOptions(n),this.promptBoxBG=document.id("UIPromtBoxBG")?document.id("UIPromtBoxBG"):new Element("div",{id:"UIPromtBoxBG","class":"UIPromtBoxBG"}).inject(document.body,"bottom"),this.promptBoxBG.set("tween",{duration:250}),this.promptBoxBG.fade("hide"),this.promptBox=document.id("UIPromtBox")?document.id("UIPromtBox"):new Element("div",{id:"UIPromtBox","class":"UIPromtBox"}).inject(document.body,"bottom"),this.promptBox.set("tween",{duration:250}),this.promptBox.fade("hide"),this.container=this.promptBox,this.trueButton=new Element("span",{"class":"button true-button w-icon",tabindex:9999998}).adopt(new Element("span",{html:Affinity.icons.Tick||"&#xe066;"}),new Element("span",{"class":"label",html:""})),this.falseButton=new Element("span",{"class":"button false-button w-icon",tabindex:9999999}).adopt(new Element("span",{html:Affinity.icons.Cancel||"&#xe070;"}),new Element("span",{"class":"label",html:""})),this.promptBoxBG.removeEvents(),this.promptBoxBG.addEvent("keyup",function(n){if(n.stop(),!this.obj.noClose&&n.key=="esc"){this.hide();return}this.obj.disableEnterClose||n.key!="enter"||this.obj.onOk()}.bind(this)),Affinity.mobile&&(window.removeEvent("mobileback",this.escape),window.addEvent("mobileback",this.escape)),window.prompts=this,window.uimessage=this.message,window.uialert=this.alert,window.uiconfirm=this.confirm,window.uiprompt=this.prompt,window.uiloader=this.loader},returnOptionsObject:function(n){var t=Object.clone(n);return Object.merge({},t)},message:function(n){var t=this.returnOptionsObject(UIMessageObject);t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.timeout=n.timeout?n.timeout:t.timeout,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,t.disableEnterClose=typeOf(n.disableEnterClose)==="boolean"?n.disableEnterClose:t.disableEnterClose,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign})),this.center(),this.show(),t.timeout!==null&&this.hide.delay(t.timeout,this)},addLargeMessage:function(n){var t=new Element("div",{html:n,styles:{width:"100%","max-height":150,overflow:"auto","text-align":"left",margin:"10px 0"}});this.promptBox.getElement(".promptButtons")?t.inject(this.promptBox.getElement(".promptButtons"),"before"):t.inject(this.promptBox),this.center(),t=null},adopt:function(){for(var t=this.promptBox.getElement(".content"),n=0;n<arguments.length;n++)t.adopt(arguments[n]);n=t=null,this.center()},alert:function(n){var t,i,r;return this.currentType=n.type||"",t=this.returnOptionsObject(UIAlertObject),t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onOk=n.onOk?n.onOk:t.onOk,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.showButtons=typeOf(n.showButtons)==="boolean"?n.showButtons:t.showButtons,t.showCancel=typeOf(n.showCancel)==="boolean"?n.showCancel:t.showCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.disableEnterClose=typeOf(n.disableEnterClose)==="boolean"?n.disableEnterClose:t.disableEnterClose,t.disableEnterClose=typeOf(n.disableEnterClose)==="boolean"?n.disableEnterClose:t.disableEnterClose,t.showLoader=typeOf(n.showLoader)==="boolean"?n.showLoader:t.showLoader,t.append=n.append?n.append:t.append,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,n.isCloseOnClick!==undefined&&(t.isCloseOnClick=n.isCloseOnClick),t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){t.onOk(),this.hide()}.bind(this),this.onCancelMethod=function(){t.onCancel(),this.hide()}.bind(this),i=this.falseButton.clone().removeEvents().addClass(t.cancelColor).addClass("hidden").addEvent("click",this.onCancelMethod),i.getElement("span").set("html",t.cancelIcon),i.getElement(".label").set("html",t.cancelText),r=new Element("span",{html:"&nbsp;","class":"hidden"}),this.message=t.append?this.message+(this.message!==""?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,"class":"content align"+t.messageAlign})),t.showLoader?(this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader")):this.promptBox.removeClass("loader"),t.noClose?this.promptBox.getElement("promptButtons")&&this.promptBox.getElement("promptButtons").destroy():t.showButtons&&(this.promptBox.adopt(new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),r,i)),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText)),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.showButtons||t.noClose?t.showCancel&&(r.removeClass("hidden"),i.removeClass("hidden")):this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.center(),this.show(),this},prompt:function(n){var t,i;return this.currentType=n.type||"",t=this.returnOptionsObject(UIPromptObject),t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.value=n.value?n.value:t.value,t.lines=n.lines?n.lines:t.lines,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.onOk=n.onOk?n.onOk:t.onOk,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.disableEnterClose=typeOf(n.disableEnterClose)==="boolean"?n.disableEnterClose:t.disableEnterClose,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){var n=document.id("UIPromtBox").getElement(".promptinput").value;this.hide();t.onOk(n)}.bind(this),this.onCancelMethod=function(){var n=document.id("UIPromtBox").getElement(".promptinput").value;this.hide();t.onCancel(n)}.bind(this),i=t.lines<2?new Element("input",{type:"text","class":"promptinput",tabindex:9999997}):new Element("textarea",{rows:t.lines,"class":"promptinput",tabindex:9999997}),i.value=t.value,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign}),new Element("div",{"class":"promptButtons"}).adopt(i),new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this.promptBox.getElement(".promptinput").focus(),this},confirm:function(n){this.currentType=n.type||"";var t=this.returnOptionsObject(UIConfirmObject);return t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.okText=n.okText?n.okText:t.okText,t.okIcon=n.okIcon?n.okIcon:Affinity.icons.Tick,t.okColor=n.okColor?n.okColor:t.okColor,t.onOk=n.onOk?n.onOk:t.onOk,t.cancelText=n.cancelText?n.cancelText:t.cancelText,t.cancelIcon=n.cancelIcon?n.cancelIcon:Affinity.icons.Cancel,t.cancelColor=n.cancelColor?n.cancelColor:t.cancelColor,t.onCancel=n.onCancel?n.onCancel:t.onCancel,t.noClose=typeOf(n.noClose)==="boolean"?n.noClose:t.noClose,t.disableEnterClose=typeOf(n.disableEnterClose)==="boolean"?n.disableEnterClose:t.disableEnterClose,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.onEnterMethod=function(){this.hide();t.onOk(!0)}.bind(this),this.onCancelMethod=function(){this.hide();t.onCancel(!1)}.bind(this),this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:t.message,"class":"content align"+t.messageAlign}),new Element("div",{"class":"promptButtons"}).adopt(this.trueButton.clone().removeEvents().addClass(t.okColor).addEvent("click",this.onEnterMethod),new Element("span",{html:"&nbsp;"}),this.falseButton.clone().removeEvents().addClass(t.cancelColor).addEvent("click",this.onCancelMethod))),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),t.noClose||this.promptBoxBG.addEvent(Affinity.events.click,this.hide),this.currentObj=t,window.removeEvent("keyup",this.okKeyUp),window.addEvent("keyup",this.okKeyUp),this.promptBox.getElement(".true-button span").set("html",t.okIcon),this.promptBox.getElement(".true-button .label").set("html",t.okText),this.promptBox.getElement(".false-button span").set("html",t.cancelIcon),this.promptBox.getElement(".false-button .label").set("html",t.cancelText),this.center(),this.show(),this},loader:function(n){this.currentType=n.type||"";var t=this.returnOptionsObject(UILoaderObject);t.message=n.message?n.message:t.message,t.messageAlign=n.messageAlign?n.messageAlign:t.messageAlign,t.cssSelector=n.cssSelector?n.cssSelector:t.cssSelector,window.onPromptClose=n.onClose?n.onClose:t.onClose,t.position=this.returnOptionsObject(UIPromptPositionObject),n.position&&(t.position.position=n.position.position?n.position.position:t.position.position,t.position.top=n.position.top?n.position.top:t.position.top,t.position.left=n.position.left?n.position.left:t.position.left),this.currentObj=t,this.promptBox.className=t.cssSelector!==""?"UIPromtBox "+t.cssSelector:"UIPromtBox",this.message=t.append?this.message+(this.message!==""?"<br />":"")+t.message:t.message,this.promptBox.empty(),this.promptBox.adopt(new Element("span",{html:this.message,"class":"content align"+t.messageAlign})),this.promptBox.adopt(new Element("img",{src:Affinity.loaders.dark})),this.promptBox.addClass("loader"),window.removeEvent("keyup",this.okKeyUp),this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.center(),this.show()},getCalculatedTop:function(){var t,u,h;if(Affinity.oldess&&Affinity.oldessFrame){var c=this.promptBox.getSize(),f=c.y/2,n=window.parent.window,e=n.document.documentElement,o=n.document.body,l=e&&e.scrollTop||o&&o.scrollTop||0,s=n.innerHeight||n.document.documentElement.clientHeight,i=0,r=window.parent.document.getElementById("ctl00_MainPanel");return r&&(i=document.documentMode&&document.documentMode<9?r.querySelectorAll(".ContentBody")[0].offsetTop:r.getElementsByClassName("ContentBody")[0].offsetTop),this.promptBox.getStyle("position")==="fixed"?s/2-i:(t=l+s/2-i,t<f+10&&(t=f+10),t+10)}return u=document.getSize(),this.promptBox.getStyle("position")==="fixed"?u.y/2:(h=document.getScroll(),u.y/2+h.y)},center:function(){var n;if(!Affinity.mobile){var f=this.promptBox.getSize(),t=this.getCalculatedTop(),i="50%",r=0-f.y/2,u=0-f.x/2,e="absolute";typeOf(this.currentObj)!=="null"&&typeOf(this.currentObj.position)!=="null"&&(n=this.currentObj.position,e=n.position?n.position:"absolute",t=n.top?n.top:t,i=n.left?n.left:i,r=n.top?0:r,u=n.left?0:u),this.promptBox.setStyles({position:e,top:t,left:i,margin:r+"px 0 0 "+u+"px"})}},okKeyUp:function(n){n.key=="enter"&&this.status=="open"&&(this.promptBox.getElement(".promptinput")?this.promptBox.getElement(".promptinput")!=document.activeElement&&this.onEnterMethod():this.onEnterMethod())},showButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").removeClass("hidden"),this.promptBoxBG&&(this.promptBoxBG.removeEvent(Affinity.events.click,this.hide),this.promptBoxBG.addEvent(Affinity.events.click,this.hide)))},hideButtons:function(){this.promptBox.getElement(".promptButtons")&&(this.promptBox.getElement(".promptButtons").addClass("hidden"),this.promptBoxBG&&this.promptBoxBG.removeEvent(Affinity.events.click,this.hide))},show:function(){this.promptBoxBG.fade("in"),this.promptBox.fade("in"),this.status="open"},escape:function(){this.currentOb&&!this.currentOb.noClose&&this.hide()},clearOnClose:function(){window.onPromptClose=function(){}},hide:function(n){if(typeof n=="string"&&n!==""&&n!==this.currentType)return!1;"onPromptClose"in window&&window.onPromptClose(),this.clearOnClose(),this.promptBoxBG.fade("out"),this.promptBox.fade("out"),this.status="closed",this.message="",window.removeEvent("keyup",this.okKeyUp);try{this.promptBoxBG.removeEvent(Affinity.events.click,this.hide)}catch(t){}return this.currentObj=!1,this.currentType="",!0},hideDelayTimer:!1,hideDelay:function(n){this.clearHideDelay(),this.hideDelayTimer=this.hide.delay(n)},clearHideDelay:function(){clearTimeout(this.hideDelayTimer)}}),UISectionHideables=new Class({Version:"1.0.0.0",Sequence:1101,Name:"Section Hidable",File:"ui.section.hidables.js",Jira:"",Notes:"",Implements:[Options],Binds:["processNew","process","switchClicked"],options:{},initialize:function(n){this.setOptions(n),this.processNew()},processNew:function(n){this.setOptions(n),this.hideableTriggerElements=document.getElements(".is-section-switch"),this.hideableTriggerElements.length>1&&Array.each(this.hideableTriggerElements,this.process)},process:function(n){if(n){n.removeClass("is-section-switch").addClass("section-switch");var t,i,r;t=n,i=n.getParent("form").getElements(".section"),i.shift(),Array.each(n.getParent("form").getElement(".section").getElements(".section-body"),function(n){i.push(n)}),r=[],Array.each(i,function(n){n.hasClass("-hidable-attached")||(r.push(new Fx.Reveal(n,{duration:250,mode:"vertical"})),n.addClass("-hidable-attached"))}),t.set("html",Affinity.icons.ArrowLineUp),t.store("sectionSwitchers",r),t.addEvent(Affinity.events.click,this.switchClicked),t.store("switchStatus","open"),t.removeClass("hidden"),this.setTooltip(t)}else console.error("section hidable: no eleemnt set")},setTooltip:function(n){Affinity.tooltips.removeTooltip(n),n.addClass("ui-has-tooltip"),n.retrieve("switchStatus")==="closed"?n.set("data-tooltip","Show Section"):n.set("data-tooltip","Hide Section"),n.set("data-tooltip-dir","top,left"),Affinity.tooltips.processTooltip(n)},switchClicked:function(n){var t=n.target.hasClass("section-switch")?n.target:n.target.getParent(".section-switch"),i=[],r=[],u=0;t.retrieve("switchStatus")==="open"?(t.set("html",Affinity.icons.ArrowLineDown),t.store("switchStatus","closed"),Array.each(t.retrieve("sectionSwitchers"),function(n){i.contains(n.subject)||(n.dissolve(),i.push(n.subject))}),this.setTooltip(t)):(Array.each(document.getElements(".section-switch"),function(n){n!==t&&n.retrieve("switchStatus")==="open"&&(u=250,i.push(n),n.set("html",Affinity.icons.ArrowLineDown),n.store("switchStatus","closed"),Array.each(n.retrieve("sectionSwitchers"),function(n){i.contains(n.subject)||(n.dissolve(),i.push(n.subject))}),this.setTooltip(n))}.bind(this)),function(){t.set("html",Affinity.icons.ArrowLineUp),Array.each(t.retrieve("sectionSwitchers"),function(n){r.contains(n.subject)||(n.reveal(),r.push(n.subject))}),t.store("switchStatus","open"),this.setTooltip(t)}.delay(u,this))},showSectionBySwitcher:function(n){var t=n,r=[],i=[],u=0;t&&(Array.each(document.getElements(".section-switch"),function(n){n!==t&&n.retrieve("switchStatus")==="open"&&(u=250,i.push(n),n.set("html",Affinity.icons.ArrowLineDown),n.store("switchStatus","closed"),Array.each(n.retrieve("sectionSwitchers"),function(n){i.contains(n.subject)||(n.dissolve(),i.push(n.subject))}),this.setTooltip(n))}.bind(this)),t.retrieve("switchStatus")==="closed"&&function(){t.set("html",Affinity.icons.ArrowLineUp),Array.each(t.retrieve("sectionSwitchers"),function(n){r.contains(n.subject)||(n.reveal(),r.push(n.subject))}),t.store("switchStatus","open"),this.setTooltip(t)}.delay(u,this))}}),UISelectLookup=new Class({Version:"1.0.12.0",Sequence:1070,Name:"Select Lookup",File:"ui.select.lookups.js",Jira:"CT-884",Notes:'Add "is node in queue", and "is node\'s request complete"',WidgetName:"SelectLookup",Implements:[Options],Binds:["processLookup","requestLookup","populateSelect","processNew","refreshQueue","cancelQueue","processQueue","removeFromQueue","addToQueue",],options:{jsonp:!1,operationType:""},enabled:!1,initialize:function(n){this.setOptions(n),Affinity.UI||(Affinity.UI={}),Affinity.UI.lookups||(Affinity.UI.lookups={}),Affinity.UI.lookups.processLookup=this.processLookup,Affinity.UI.lookupLoaders=[],Affinity.UI.isElementInQueue=this.isElementInQueue,Affinity.UI.hasElementRequestCompleted=this.hasElementRequestCompleted,window.addEvent("refreshQueues",this.refreshQueue),Affinity.login?(window.addEvent("loggedout",this.cancelQueue),window.addEvent("loggedin",function(){this.enabled=!0,this.processNew()}.bind(this))):(this.enabled=!0,this.processNew())},processNew:function(n){this.setOptions(n);var t=document.getElements("select.has-lookup");Array.each(t,this.processLookup),this.processQueue(n)},processLookup:function(n){var t,i,r,u;(n.removeClass("has-lookup").addClass("was-lookup"),n.hasClass("has-dependencies"))||(n.addClass("lookup-loading"),n.get("data-lookup-api")&&(n.get("data-lookup-api")&&(n.removeClass("has-display-lookup"),n.get("data-lookup-api")!==""&&(t=n.get("data-lookup-api"),n.retrieve("original-lookup-url")||n.store("original-lookup-url",t),t=Affinity.GetCacheSafePath(t),i=this.getApiKey(t),Affinity.UI.lookups[i]?Affinity.UI.lookups[i].elements.contains[n]||Affinity.UI.lookups[i].elements.push(n):Affinity.UI.lookups[i]={api:t,id:"lookup_"+String.uniqueID(),type:"select",loaded:!1,massive:!1,elements:[n]})),n.addClass("hidden"),n.getParent().getElement(".lookup-spinner")||(r=new Element("span",{html:'<img src="'+(Affinity.DarkMode?Affinity.loaders.dark:Affinity.loaders.light)+'" />',"class":"lookup-spinner hidden"}).inject(n,"after"),n.store("spinner",r),n.getParent().getElement(".ui-autocomplete-display")||r.removeClass("hidden")),n.getParent().getElement(".errorstr")||(u=new Element("span",{"class":"errorstr inplace-of-input hidden"}).inject(n,"after"),n.store("error",u)),window.fireEvent("lookupComplete",n),n.addChangeTracker(),n.fireEvent("lookup")))},getApiKey:function(n){var o=new URI(n.toLowerCase()),s=o.get("query").parseQueryString(),i=[],u=[],t=!1,f="",r,e;return Object.each(s,function(n,r){r.toLowerCase()!=="ran"&&(r!=="parameters"?i.push(r+"-"+n):t=JSON.parse(n))}),i=i.sort(),t&&typeOf(t)==="object"&&"parameter"in t&&typeOf(t.parameter)==="array"&&(Array.each(t.parameter,function(n){r=[],Object.each(n,function(n,t){t.toLowerCase()!=="ran"&&r.push(t+"-"+n)}),r.sort(),u.push(r.join("|"))}),u.sort(),f="|parameters|"+u.join("||")),e=i.join("|")+f,"display-"+e.replace(/\//g,".")},refreshQueue:function(){this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,function(n){"cancel"in n&&n.cancel(),n.removeEvents(),n=null}),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,function(n,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null}),this.enabled=!0,window.fireEvent("lookupCacheClear")},cancelQueue:function(){return this.enabled=!1,Array.each(Affinity.UI.lookupLoaders,function(n){"cancel"in n&&n.cancel(),"removeEvents"in n&&n.removeEvents(),n=null}),Affinity.UI.lookupLoaders=[],Object.each(Affinity.UI.lookups,function(n,t){Affinity.UI.lookups[t].loaded=!1,Affinity.UI.lookups[t].data=null,Affinity.UI.lookups[t].elements=[],Affinity.UI.lookups[t]=null,delete Affinity.UI.lookups[t]}),Affinity.UI.lookups={},!0},processQueue:function(n){var t,i;try{Object.each(Affinity.UI.lookups,function(r,u){this.enabled&&(Affinity.UI.lookups[u].loaded===!0&&this.setElements(u,n),Affinity.UI.lookups[u].loaded===!1&&Affinity.UI.lookups[u].hasOwnProperty("api")&&Affinity.UI.lookups[u].hasOwnProperty("loaded")&&(i=Affinity.UI.lookups[u].api,Affinity.UI.lookups[u].loaded="loading...",i&&this.options.jsonp?t=new Request.JSONP({callbackKey:"jsoncallback",url:i,method:"get",timeout:3e4,onComplete:function(t){JSON.Unauthorized(t,Affinity.UI.lookups[u].id)||(Affinity.UI.lookups[u].data=t,"error"in t?t.error.test("limit","gi")?(Affinity.UI.lookups[u].data=[],Affinity.UI.lookups[u].massive=!0,Affinity.UI.lookups[u].loaded=!0,this.setElements(u,n)):(this.setError(u,t.error&&t.error!==""?t.error:"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1):typeOf(t)==="array"&&t.length>0?(Affinity.UI.lookups[u].loaded=!0,this.setElements(u,n)):(Affinity.UI.lookups[u].loaded=!1,this.hideLoader(u),this.setError(u,"Data returned as empty array"),Array.each(Affinity.UI.lookups[u].elements,function(n){n.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(){this.setError(u,"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1}.bind(this),onFailure:function(){this.setError(u,"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1}.bind(this),onTimeout:function(){this.setError(u,"lookup timed out"),Affinity.UI.lookups[u].loaded=!1}.bind(this)}):i&&(t=new Request.JSON({url:i,method:"get",timeout:3e4,onSuccess:function(t){JSON.Unauthorized(t,Affinity.UI.lookups[u].id)||(Affinity.UI.lookups[u].data=t,"error"in t?t.error.test("limit","gi")?(Affinity.UI.lookups[u].data=[],Affinity.UI.lookups[u].massive=!0,Affinity.UI.lookups[u].loaded=!0,this.setElements(u,n)):(this.setError(u,t.error&&t.error!==""?t.error:"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1):typeOf(t)==="array"&&t.length>0?(Affinity.UI.lookups[u].loaded=!0,this.setElements(u,n)):(Affinity.UI.lookups[u].loaded=!1,this.hideLoader(u),this.setError(u,"Data returned as empty array"),Array.each(Affinity.UI.lookups[u].elements,function(n){n.fireEvent("emptyData")}.bind(this))))}.bind(this),onError:function(){this.setError(u,"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1}.bind(this),onFailure:function(){this.setError(u,"There was an error retrieving this data"),Affinity.UI.lookups[u].loaded=!1}.bind(this),onTimeout:function(){this.setError(u,"lookup timed out"),Affinity.UI.lookups[u].loaded=!1}.bind(this)})),t&&(Affinity.UI.lookupLoaders.push(t),t.send())))}.bind(this))}catch(r){}},isElementInQueue:function(n){return n.hasClass("has-dependencies")?Object.each(Affinity.UI.dependancies,function(t){Array.each(t.elements,function(t){if(t===n)return!0})}):Object.each(Affinity.UI.lookups,function(t){Array.each(t.elements,function(t){if(t===n)return!0})}),!1},hasElementRequestCompleted:function(n){return n.hasClass("has-dependencies")?Object.each(Affinity.UI.dependancies,function(t){Array.each(t.elements,function(i){if(i===n&&t.loaded)return!0})}):Object.each(Affinity.UI.lookups,function(t){Array.each(t.elements,function(i){if(i===n&&t.loaded)return!0})}),!1},removeFromQueue:function(n,t,i){var r,f,u;return t&&t.getWidget()&&(r=t.getWidget(),r.hasOwnProperty("revert")&&(f=r.revert(),typeOf(i)==="boolean"&&i===!0&&("empty"in t&&t.empty(),"value"in t&&(t.value="")))),t.retrieve("spinner")&&(spinner=t.retrieve("spinner"),spinner&&"destroy"in spinner&&spinner.destroy()),t.retrieve("error")&&(error=t.retrieve("error"),error&&"destroy"in error&&error.destroy()),Array.each(Affinity.UI.lookups,function(n){n.elements.contains(t)&&(u=n.elements.indexOf(t),array.splice(u,1))}),!0},addToQueue:function(n,t){return t.set("data-lookup-api",n),this.processLookup(t),!0},hideLoader:function(n){Array.each(Affinity.UI.lookups[n].elements,function(n){n.retrieve("spinner")&&n.retrieve("spinner").addClass("hidden")}.bind(this))},setError:function(n,t){Array.each(Affinity.UI.lookups[n].elements,function(n){n.retrieve("spinner")&&n.retrieve("spinner").addClass("hidden"),n.retrieve("error")&&n.retrieve("error").set("html",t).removeClass("hidden")}.bind(this))},setElements:function(n,t){Array.each(Affinity.UI.lookups[n].elements,function(i){var r,u,f;typeOf(i)!=="null"&&typeOf(i.get)==="function"&&i.get("data-lookup-api")&&(Affinity.mobile&&(r=JSON.parse(JSON.stringify(Affinity.UI.lookups[n].data)),u=!1,r.length>0&&r[0].Value<r[r.length-1].Value&&(u=!0),t!==undefined&&t.operationType!==undefined?!u&&n.indexOf("tscode")>-1&&t.operationType==="edit"?r=r.sort(function(n,t){var i=n.Value.toLowerCase(),r=t.Value.toLowerCase();return i<r?-1:i>r?1:0}):u&&t.operationType!=="edit"&&r.reverse():u&&(r=r.sort(function(n,t){var i=n.Value.toLowerCase(),r=t.Value.toLowerCase();return i<r?-1:i>r?1:0})),Affinity.UI.lookups[n].data=r),f=JSON.parse(JSON.stringify(Affinity.UI.lookups[n].data)),this.populateSelect(i,f,n),i.erase("data-lookup-api"))}.bind(this))},populateSelect:function(n,t,i){var u,h,f=!1,r=n.get("data-default-value")||"",c=n.get("data-lookup-rules")?n.get("data-lookup-rules").split(","):[],y=n.getElements("option").length>0&&n.getElements("option")[0].get("html").trim()!=="",p=n.get("data-insert-empty")&&n.get("data-insert-empty").toLowerCase().trim()==="true",l=!1,o,s,e,a,v;typeOf(t)==="array"&&(o=typeOf(t[0])!=="null"?t[0].Value:"",n.removeClass("lookup-loading"),Affinity.UI.lookups[i].massive||t.length>Affinity.selectmax?n.addClass("massive").store("data-store","lookups").store("data-key",i).store("data-value",r).store("data-label",r):(s={},e=n.getElements("option"),e&&e.length>0&&Array.each(e,function(n){s[n.get("value")]=n}),e=null,Array.each(t,function(t,i){u=!1,t.Value!==undefined&&t.Value!==null&&(t.Value=t.Value.replace(","," - ")),h=t.Value,s[t.Key]?u=s[t.Key]:c.contains("hasValue")?t.Value.trim()!==""&&(u=new Element("option",{value:t.Key,html:h})):u=new Element("option",{value:t.Key,html:h}),u&&(t.Key==r?(u.set("selected","selected"),o=r,f=!0):c.contains("hasValue")&&r===""&&i===0&&(r=t.Key,u.set("selected","selected"),n.set("data-default-value",r),o=r,f=!0),t.Key+t.Value.trim()===""&&(l=!0),!0&&n.adopt(u))})),p&&!l&&n.querySelectorAll("option").length>1&&(t.unshift({Key:"",Value:""}),n.insertBefore(document.createElement("option"),n.querySelector("option"))),a="UIAutoComplete"in window&&typeOf(window.UIAutoComplete)=="class"?!0:!1,v="UIAutoCompleteWidget"in window&&typeOf(window.UIAutoCompleteWidget)=="class"?!0:!1,!f&&r==""&&typeOf(t)=="array"&&t.length>0&&(f=!0),n.retrieve("spinner")&&n.retrieve("spinner").destroy(),n.removeClass("hidden"),t.length>=Affinity.selectToAutoNum&&a&&n.addClass("ui-autocomplete"),n.hasClass("ui-autocomplete")&&v&&(n.removeClass("ui-autocomplete"),new UIAutoCompleteWidget({selectElement:n})),!y&&n.retrieve("changetracker")&&n.retrieve("changetracker").setValue(n,r),f&&(n.get("onChange")||n.get("onchange")?n.onChange():n.fireEvent("change",{target:n})),n.fireEvent("lookupComplete",{defaultValue:r,value:o,target:n}))}}),UITabs=new Class({Version:"1.0.0.0",Sequence:1170,Name:"Section Tabs",File:"ui.tabs.js",Jira:"",Notes:"",Implements:[Options],Binds:["init","processNew"],options:{},initialize:function(n){this.setOptions(n),this.init()},processNew:function(){this.init()},init:function(){Array.each(document.getElements(".ui-tab-container"),function(n){if(!n.hasClass("ui-done")){n.addClass("ui-done");var t=n.getElements(".ui-tab");t.addClass("hidden"),Array.each(n.getElements(".ui-tab-title"),function(n,i){n.store("tab",t[i]),n.addEvents({click:function(n){var t=n.target.hasClass("ui-tab-title")?n.target:n.target.getParent(".ui-tab-title");t.getParent(".ui-tab-container").getElements(".ui-tab-title").removeClass("selected"),t.getParent(".ui-tab-container").getElements(".ui-tab").addClass("hidden"),t.retrieve("tab").removeClass("hidden"),t.addClass("selected")}})}.bind(this)),n.getElement(".ui-tab-title").addClass("selected"),n.getElement(".ui-tab").removeClass("hidden")}}.bind(this))}}),UITimePickerWidget=new Class({Version:"1.0.2.0",Sequence:1030,Name:"Time Picker",File:"ui.time.picker.js",Jira:"",Notes:"Remove line draw for mobile",WidgetName:"TimePicker",Implements:[Options,Events],options:{target:null,displayInput:!1,timeonly:!0,date:null,dateWidget:null,width:150,hoursmins:!1},Binds:["swapHours","swapMinutes","setAMPM","setAM","setPM","done","tileOver","tileOut","setMinute","swapHours","setHour","swapMinutes","setLastValue","attemptParse"],row:null,initialize:function(n){var t,i;this.setOptions(n),this.options.width<150&&(this.options.width=150),this.icons={},this.icons.done=Affinity.icons.Tick,this.target=this.options.target,this.timeTarget=new Element("div",{"class":"ui-calendar-time"}).setStyles({width:this.options.width}).inject(this.target),this.displayTarget=new Element("div",{"class":"ui-calendar-time-display",html:"<span><\/span>:<span><\/span> <span><\/span>"}).inject(this.timeTarget),this.displayTarget.set("reveal",{duration:250}),this.containerBox=new Element("div",{"class":"ui-calendar-time-container"}).setStyles({width:this.options.width}).inject(this.timeTarget),this.containerBox.set("reveal",{duration:250}),this.hoursTarget=new Element("div",{"class":"ui-calendar-time-circle hours"}).inject(this.containerBox),this.minutesTarget=new Element("div",{"class":"ui-calendar-time-circle minutes"}).inject(this.containerBox),this.hoursTarget.set("reveal",{duration:250}),this.minutesTarget.set("reveal",{duration:250}),this.minutesTarget.toggle(),t=this.displayTarget.getElements("span"),this.hourDisplay=t[0],this.minDisplay=t[1],this.ampmDisplay=t[2],delete t,this.doneButton=new Element("div",{"class":"button green w-icon done",html:"<span>"+this.icons.done+"<\/span> Done"}).inject(this.containerBox),this.amButton=new Element("div",{"class":"am",html:"am"}).inject(this.containerBox),this.pmButton=new Element("div",{"class":"pm",html:"pm"}).inject(this.containerBox),this.hourDisplay.addEvent(Affinity.events.click,this.swapHours),this.minDisplay.addEvent(Affinity.events.click,this.swapMinutes),this.options.hoursmins?(this.amButton.addClass("hidden"),this.pmButton.addClass("hidden"),this.ampmDisplay.addClass("hidden")):(this.ampmDisplay.addEvent(Affinity.events.click,this.setAMPM),this.amButton.addEvent(Affinity.events.click,this.setAM),this.pmButton.addEvent(Affinity.events.click,this.setPM)),this.doneButton.addEvent(Affinity.events.click,this.done),this.size={x:170,y:170},this.width=this.size.x-50,this.height=this.width,this.radius=this.width/2,this.center=new Element("div",{"class":"circle-center"}).setStyles({top:this.size.x/2-15,left:this.options.width>150?this.size.x/2-15+(this.options.width-150)/2:this.size.x/2-15}).inject(this.containerBox,"top"),this.marker=new Element("div",{"class":"circle-hover-marker"}).inject(this.containerBox,"top"),this.marker.set("tween",{duration:250}),this.marker.fade("hide"),this.canvasOK=!0,this.canvas=new Element("canvas",{width:150,height:150}).setStyles({position:"absolute",top:0,left:this.options.width>150?(this.options.width-150)/2:0,width:150,height:150}).inject(this.containerBox,"top");try{this.canvasContext=this.canvas.getContext("2d")}catch(r){this.canvasOK=!1}this.canvasOK?(this.canvasContext.lineWidth=2,this.canvasContext.strokeStyle=this.center.getStyle("background-color")):this.canvas.destroy(),i=new Element("div",{"class":"ui-calendar-time-circle-bg"}).inject(this.containerBox,"top"),this.options.width>150&&i.setStyle("left",(this.options.width-150)/2),this.fireSet=!0,this.options.date===null||this.options.date===!1?(this.fireSet=!1,this.date=new Date,this.date.setSeconds(0),this.date.setMilliseconds(0)):this.date=this.options.date.clone(),this.hour=this.date.getHours(),this.minunte=this.date.getMinutes(),this.ampm=this.hour>=12?"pm":"am",this.hoursTargetStatus="closed",this.minutesTargetStatus="closed",this.buildTimeElements(),this.hide(),this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.addEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.addEvent("focus",this.setLastValue),this.options.displayInput.addEvent("blur",this.attemptParse))},buildTimeElements:function(){var t=0,r,n,u=this.hoursTarget;for(n=3,i=0;i<12;i++)new Element("div",{html:n,"class":"time-circle-tile h-"+n}).inject(u),n++,n>=13&&(n=1),this.options.hoursmins&&n===12&&(n=0);for(r=this.hoursTarget.getElements("div"),t=0,step=2*Math.PI/r.length,Array.each(r,function(n){var u=n.getSize(),i=Math.round(this.width/2+this.radius*Math.cos(t)-10)+15,r=Math.round(this.height/2+this.radius*Math.sin(t)-10)+15;n.setStyles({left:i+"px",top:r+"px"}),t+=step,n.addEvent(Affinity.events.overAll,this.tileOver),n.addEvent(Affinity.events.outAll,this.tileOut),n.addEvent(Affinity.events.click,this.setHour),n.addEvent(Affinity.events.click,this.swapMinutes)}.bind(this)),u=this.minutesTarget,n=15,i=0;i<60;i++)new Element("div",{html:n,"class":"time-circle-tile m-"+n}).inject(u),i+=4,n+=5,n>=60&&(n=0);r=this.minutesTarget.getElements("div"),t=0,step=2*Math.PI/r.length,Array.each(r,function(n){var i=Math.round(this.width/2+this.radius*Math.cos(t)-10)+15,r=Math.round(this.height/2+this.radius*Math.sin(t)-10)+15;n.setStyles({left:i+"px",top:r+"px"}),t+=step,n.addEvent(Affinity.events.overAll,this.tileOver),n.addEvent(Affinity.events.outAll,this.tileOut),n.addEvent(Affinity.events.click,this.setMinute),n.addEvent(Affinity.events.click,this.swapHours)}.bind(this))},setDisplayTime:function(){this.options.hoursmins?(this.hourDisplay.set("html",this.date.format("%H")),this.minDisplay.set("html",this.date.format("%M"))):(this.hourDisplay.set("html",this.date.format("%l")),this.minDisplay.set("html",this.date.format("%M")),this.ampmDisplay.set("html",this.date.format("%p").toLowerCase())),this.fireSet&&this.fireEvent("timeSet",this.date),this.fireSet=!0,this.options.timeonly&&this.displayTarget},setHour:function(n){this.hour=parseInt(n.target.get("html")),this.date.setHours(this.hour),this.setDisplayTime(),this.hoursTarget.getElements(".active").removeClass("active"),n.target.addClass("active")},setMinute:function(n){this.minunte=parseInt(n.target.get("html")),this.date.setMinutes(this.minunte),this.setDisplayTime(),this.minutesTarget.getElements(".active").removeClass("active"),n.target.addClass("active")},setAMPM:function(){this.containerBox.reveal(),this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm=="am"?this.setPM():this.setAM()},setAM:function(){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="am",this.date.getHours()>=12&&this.date.setHours(this.date.getHours()-12),this.setDisplayTime()},setPM:function(){this.hourDisplay.removeClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.addClass("active"),this.ampm="pm",this.date.getHours()<12&&this.date.setHours(this.date.getHours()+12),this.setDisplayTime()},swapMinutes:function(){this.show(),this.hourDisplay.removeClass("active"),this.minDisplay.addClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="closed",this.minutesTargetStatus="open",this.hoursTarget.dissolve(),this.minutesTarget.reveal(),this.marker.fade("out"),function(){this.minutesTarget!==undefined&&this.minutesTarget!==null&&this.minutesTarget.getElement!=undefined&&this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))}.delay(300,this)},swapHours:function(){this.show(),this.hourDisplay.addClass("active"),this.minDisplay.removeClass("active"),this.ampmDisplay.removeClass("active"),this.hoursTargetStatus="open",this.minutesTargetStatus="closed",this.hoursTarget.reveal(),this.minutesTarget.dissolve(),this.marker.fade("out"),function(){this.hoursTarget!==undefined&&this.hoursTarget!==null&&this.hoursTarget.getElement!=undefined&&this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active"))}.delay(300,this)},positionMarker:function(n){var t=n.getPosition(this.containerBox);this.marker.setPosition({x:t.x-4,y:t.y-4}),this.marker.fade("in"),delete t},tileOver:function(n){if(this.canvasOK){var t=this.center.getPosition(this.canvas),i=n.target.getPosition(this.canvas);this.canvasContext.clearRect(0,0,150,150),Affinity.mobile||(this.canvasContext.beginPath(),this.canvasContext.moveTo(t.x+5,t.y+5),this.canvasContext.lineTo(i.x+10,i.y+10),this.canvasContext.stroke()),delete t,delete i}},tileOut:function(){this.canvasOK&&this.canvasContext.clearRect(0,0,150,150),this.marker.fade("out"),this.hoursTargetStatus=="open"&&this.hoursTarget.getElement(".active")&&this.positionMarker(this.hoursTarget.getElement(".active")),this.minutesTargetStatus=="open"&&this.minutesTarget.getElement(".active")&&this.positionMarker(this.minutesTarget.getElement(".active"))},show:function(){clearTimeout(this.autoHideDelay),this.options.hoursmins||(this.containerBox.reveal(),this.showDisplay(),this.fireEvent("open",this.date))},hide:function(){if(this.hourDisplay&&this.hourDisplay.removeClass("active"),this.minDisplay&&this.minDisplay.removeClass("active"),this.ampmDisplay&&this.ampmDisplay.removeClass("active"),this.options.timeonly){if(this.options.dateWidget)try{this.options.dateWidget.hide()}catch(n){}}else this.containerBox.dissolve()},showDisplay:function(){this.displayTarget.reveal()},hideDisplay:function(){this.displayTarget.dissolve()},done:function(){this.hide(),this.fireEvent("timeSet",this.date),this.fireEvent("done",this.date)},setTime:function(n){this.date=n.clone(),this.setDisplayTime()},getTime:function(){return this.date},lastValue:!1,setLastValue:function(){this.options.displayInput&&this.options.displayInput.get("tag")==="input"&&(this.lastValue=this.options.displayInput.value)},autoHideDelay:null,attemptParse:function(n){var s,h;if(clearTimeout(this.autoHideDelay),this.options.displayInput&&this.options.displayInput.get("tag")==="input"){var t=this.options.displayInput.value,f=!1,e=!1,u=!1,i,r,o;if(t=t.trim(),this.options.timeonly&&this.options.hoursmins){i=t.toLowerCase().replace(/m/," m ").replace(/h/," h ").split(/[^0-9mh]/i),i=i.filter(function(n){return n==="h"||n==="m"?n:!isNaN(parseFloat(n,10))}),i.contains("m")&&!isNaN(i[i.indexOf("m")-1])&&(u=parseFloat(i[i.indexOf("m")-1],10),i.splice(i.indexOf("m"),1)),i.contains("h")&&!isNaN(i[i.indexOf("h")-1])&&(e=parseFloat(i[i.indexOf("h")-1],10),i.splice(i.indexOf("h"),1)),u||e?(i=[],e?i.push(e):i.push(0),u?i.push(u):i.push(0)):((t.charAt(0)===":"||t.charAt(0)===".")&&i.unshift(0),i.length===1&&(i[1]="0")),e=parseInt(i[0],10),u=parseInt(i[1],10),parseInt(e,10)>11&&(e="11"),t.contains(".")&&(u=Math.round(parseFloat("0."+u)*60)),parseInt(u,10)>59&&(e="59"),t=(e+"").pad(2,"0","left")+":"+(u+"").pad(2,"0","left");try{f=Date.parse(t)}catch(c){f=!1}f&&typeOf(f)==="date"&&f.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=t),this.setTime(f))}else if(this.options.timeonly&&(t=t.replace(new RegExp(/[^0-9.\:]/gi),"")),t!==""){t.contains(":")?(i=t.split(":"),r=i[0],parseInt(r,10)>24&&(r="24"),parseInt(r,10)<0&&(r="00"),r=r.pad(2,"0","left"),o=i[1].pad(2,"0","right"),parseInt(o,10)>60&&(r="00"),parseInt(r,10)<0&&(r="00"),t=r+":"+o):t.contains(".")?(i=t.split("."),r=i[0],parseInt(r,10)>24&&(r="24"),parseInt(r,10)<0&&(r="00"),r=r.pad(2,"0","left"),o=i[1].pad(2,"0","right"),u=parseInt(o,10),u>99&&(u=0),u<0&&(u=0),o=(Math.round(60/100*u)+"").pad(2,"0","left"),t=r+":"+o):t.length===4?t=t.substring(0,2)+":"+t.substring(2):t.length>4?t=t.substring(0,2)+":"+t.substring(2,2):t.length<4&&(t.length===1&&(t="0"+t+"00"),t.length===2&&(t=t+"00"),t.length===3&&(t="0"+t),t=t.substring(0,2)+":"+t.substring(2)),this.options.timeonly&&(s=parseInt(t.split(":")[0],10),h=parseInt(t.split(":")[1],10),s=s>24?0:s,h=h>59?0:h,t=(s+"").pad(2,"0","left")+":"+(h+"").pad(2,"0","left"));try{f=Date.parse(t)}catch(c){f=!1}f&&typeOf(f)==="date"&&f.isValid()&&(this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.value=t),this.setTime(f))}else this.lastValue&&(this.options.displayInput.value=this.lastValue)}n&&(typeOf(n)==="object"||typeOf(n)==="domevent")&&"type"in n&&n.type==="blur"&&(this.autoHideDelay=this.hide.delay(250,this))},destroy:function(){this.options.timeonly&&this.options.displayInput&&(this.options.displayInput.removeEvent(Affinity.events.click,this.setLastValue),this.options.displayInput.removeEvent("focus",this.setLastValue),this.options.displayInput.removeEvent("blur",this.attemptParse)),this.hourDisplay.removeEvents(),this.minDisplay.removeEvents(),this.ampmDisplay.removeEvents(),this.amButton.removeEvents(),this.pmButton.removeEvents(),this.doneButton.removeEvents(),this.displayTarget.set("reveal",null),this.displayTarget.set("tween",null),this.containerBox.set("reveal",null),this.containerBox.set("tween",null),this.hoursTarget.set("reveal",null),this.hoursTarget.set("tween",null),this.minutesTarget.set("reveal",null),this.minutesTarget.set("tween",null),this.hourDisplay.destroy(),this.minDisplay.destroy(),this.ampmDisplay.destroy(),this.amButton.destroy(),this.pmButton.destroy(),this.doneButton.destroy(),this.canvasOK&&(this.canvas.destroy(),this.canvasContext=null),Array.each(this.hoursTarget.getElements("div"),function(n){n.removeEvents()}.bind(this)),this.hoursTarget.empty(),this.hoursTarget.destroy(),Array.each(this.minutesTarget.getElements("div"),function(n){n.removeEvents()}.bind(this)),this.minutesTarget.empty(),this.minutesTarget.destroy(),this.displayTarget.empty(),this.displayTarget.destroy(),Object.each(this,function(n,t){this[t]=null,delete this[t]}.bind(this))}}),UITooltips=new Class({Version:"1.0.2.0",Sequence:1040,Name:"Tooltips",File:"ui.tooltip.js",Jira:"",Notes:"",Implements:[Options],Binds:["processNew","init","processTooltip","removeTooltip","itemOver","itemOut"],options:{},initialize:function(n){this.setOptions(n),Affinity.UI.Tooltips={},Affinity.UI.Tooltips.Process=this.processNew,Affinity.UI.Tooltips.Remove=this.removeTooltip,Affinity.UI.Tooltips.Hide=this.hideAll,this.init()},processNew:function(){this.init()},init:function(){if(Affinity.helpbubble)Array.each(document.getElements(".ui-has-tooltip"),this.processTooltip.bind(this));else throw"UI Tooltips requires UI Help Bubble";},processTooltip:function(n,t){n.get("data-tooltip")&&(n.hasEvent(Affinity.events.overAll,this.itemOver)||(n.addEvent(Affinity.events.overAll,this.itemOver),n.addEvent(Affinity.events.outAll,this.itemOut),n.get("tag")==="input"&&n.addEvent("blur",this.itemOut)),typeOf(t)==="boolean"&&t&&this.itemOver({target:n}))},removeTooltip:function(n){n.removeClass("ui-has-tooltip"),n.erase("data-tooltip"),n.erase("data-tooltip-dir"),n.removeEvent(Affinity.events.overAll,this.itemOver),n.removeEvent(Affinity.events.outAll,this.itemOut),n.get("tag")==="input"&&n.removeEvent("blur",this.itemOut)},itemOver:function(n){var f=n.target.hasClass("ui-has-tooltip")?n.target:n.target.getParent("ui-has-tooltip"),r;if(f&&(Affinity.helpbubble.populate(f.get("data-tooltip")),r=Affinity.helpbubble.getSize(),typeOf(r)==="object"&&"y"in r)){var s=f.get("data-tooltip-dir")?f.get("data-tooltip-dir").toLowerCase().trim():"right",o=document.getScrollSize(),i=f.getPosition(),e=f.getSize(),h=document.getScroll(),u,t={x:0,y:0};switch(s){case"top":u="bottom",t.x=i.x,t.y=i.y-r.y-10;break;case"bottom":u="top",t.x=i.x,t.y=i.y+r.y-5;break;case"right":u="left",t.x=i.x+e.x+5,t.y=i.y+e.y/2-20;break;case"left":u="right",t.x=i.x-r.x-5,t.y=i.y+e.y/2-20;break;case"top,left":u="bottom-right",t.x=i.x+e.x-r.x,t.y=i.y-r.y-10;break;case"top,right":u="bottom",t.x=i.x,t.y=i.y-r.y-10;break;case"bottom,left":u="top-right",t.x=i.x+e.x-r.x,t.y=i.y+r.y;break;case"bottom,right":u="top",t.x=i.x,t.y=i.y+r.y;break;case"top,center":u="bottom",t.x=i.x,t.y=i.y-r.y-10;break;case"bottom,center":u="top",t.x=i.x,t.y=i.y+r.y-5}Affinity.helpbubble.setDirection(u),t.x+r.x>o.x&&(t.x=o.x-r.x-5),t.y+r.y>o.y&&(t.y=o.y-r.y-5),Affinity.helpbubble.position(t),Affinity.helpbubble.show(f.hasClass("ui-tooltip-selectable")?!0:!1)}},itemOut:function(){Affinity.helpbubble.hide()},hideAll:function(){Affinity.helpbubble.hide()}}),UIUplaodersMulti=new Class({Version:"1.0.0.0",Sequence:1130,Name:"Multi Uploader",File:"ui.upload.multi.js",Jira:"",Notes:"Add optional max size",Implements:[Options,Events],Binds:["processNew","processUploader","addFile","addFileCont","addFileRow","deleteFile"],options:{auto:!0,maxsize:20971520,samenames:!0},uploaders:{},initialize:function(n){(this.setOptions(n),this.icons={},this.icons.del=Affinity.icons.CrossRound||"&#xe06d;",Affinity.prettyuploads)&&this.options.auto&&Array.each(document.getElements(".uploadmulti"),this.processUploader)},processNew:function(){Array.each(document.getElements(".uploadmulti"),this.processUploader)},processUploader:function(n){var t,e,f,i,o;if(Affinity.prettyuploads&&!n.hasClass("uidone")){n.store("count",1),t=new HtmlTable({properties:{"class":"ui-grid"},headers:["File",""],rows:[]}),new Element("div",{"class":"upload-table hidden"}).adopt(t.element).inject(n),n.addClass("uidone");var s=n.hasClass("isrequired")?!0:!1,r=new Element("label").inject(n),u=n.get("data-question-name")+"_file0";n.getElement("input").set("name",u).set("id",u).addEvent("change",this.addFile).inject(r).fade("hide"),e=new Element("span",{"class":"button green",html:"Add File"}).inject(r),new Element("span",{html:"","class":"uploadlabel"}).inject(r),f=n.getElement(".initialValues"),f&&(i=f.value.trim(),i!==""&&(o=i.split(","),Array.each(o,function(n){this.addFileRow(t.element,n,n)}.bind(this)),window.fireEvent("multiFileDefaults",{initialValues:i,table:t.element}))),delete t,delete r,delete u,delete e,delete i,Affinity.uiGrid.processTables(t.element)}},addFile:function(n){var t,i,r;if(n.stop(),t={},t.uploadInput=n.target,t.uploader=t.uploadInput.getParent(".uploadmulti"),t.table=t.uploader.getElement("table"),t.questionName=t.uploader.get("data-question-name"),t.filePath=t.uploadInput.value,t.fileName=t.filePath,t.count=t.uploader.retrieve("count")+1,t.inputId=t.questionName+"_file"+t.count,t.fileEventData={fileElement:t.uploadInput,questionName:t.questionName,table:t.table},t.filePath===""||typeOf(t.filePath)=="null"){delete t;return}if(t.uploadInput.files&&(i=this.options.maxsize,t.uploadInput.get("data-maxsize")&&(i=parseFloat(t.uploadInput.get("data-maxsize")),(isNaN(i)||i<10)&&(i=this.options.maxsize)),t.uploadInput.files[0].size>i)){window.fireEvent("multiFileTooLarge",{fileElement:t.uploadInput,maxsize:this.options.maxsize,size:t.uploadInput.files[0].size,table:t.table}),delete t;return}if(t.fileName.contains("fakepath")&&(t.fileName=t.fileName.substring(t.uploadInput.value.indexOf("fakepath")+9)),t.fileName.contains("/")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("/")+1)),t.fileName.contains("\\")&&(t.fileName=t.fileName.substring(t.uploadInput.value.lastIndexOf("\\")+1)),r=!1,Array.each(t.table.getElements("tr"),function(n){n.retrieve("fileName")&&n.retrieve("fileName").trim()===t.fileName.trim()&&(r=!0)}),r)if(this.options.samenames)uiconfirm({message:"You already have a file named '"+t.fileName+"'.<br />Would you like to continue anyway?",onOk:function(){this.addFileCont(n,t)}.bind(this),onCancel:function(){t.uploadInput.value="";try{delete t.uploadInput.files}catch(n){}delete t}.bind(this)});else{uialert({message:"Filenames must be different.<br />You already have a file with name '"+t.fileName+"'."}),t.uploadInput.value="";try{delete t.uploadInput.files}catch(n){}delete t;return}else this.addFileCont(n,t)},addFileCont:function(n,t){n.stop(),this.addFileRow(t.table,t.fileName,null,t.inputId);var i=t.table.getParent(".uploadmulti");t.uploadInput.set("class","").addClass("subhidden").set("name",t.inputId).set("id",t.inputId).removeEvents(),function(){t.uploadInput=t.uploadInput.clone().set("name",t.questionName+"_file0").set("id",t.questionName+"_file0").set("class","").addClass("new-master").inject(t.uploadInput,"before").fade("hide"),t.uploadInput.removeEvents(),t.uploadInput.addEvent("change",this.addFile),t.uploadInput.value="",t.uploader.store("count",t.count),window.fireEvent("multiFileAdded",t.fileEventData),i.fireEvent("multiFileAdded",t.fileEventData)}.delay(50,this),delete t},addFileRow:function(n,t,i,r,u){var e,f;e=i!==null?'<span class="button orange delete w-icon-only"><span>'+this.icons.del+"<\/span><\/span>":'<span class="button orange delete new w-icon-only"><span>'+this.icons.del+"<\/span><\/span>",n.retrieve("HtmlTable").push([t,e]),f=n.getElements("tbody tr").getLast(),f.store("fileName",t),i!==null&&(f.store("fileId",i),f.addEvent("click",this.downloadFile.bind(this)),f.addClass("saved")),u&&(f.removeEvents(),f.getElement("td").empty(),new Element("a",{href:u,target:"_blank",html:t}).inject(f.getElement("td"))),r!==null&&f.store("inputId",r),f.getElements(".delete").addEvent("click",this.deleteFile),Affinity.uiGrid.zebra(n),n.getParent().removeClass("hidden"),delete e,delete f},deleteFile:function(n){var o,u,f;n.stop();var s=n.target.hasClass("button")?n.target:n.target.getParent(".button"),r=n.target.getParent(".uploadmulti"),t=n.target.getParent("tr"),i=t.getParent("table"),e=r.get("data-question-name");s.hasClass("new")?(o=t.retrieve("inputId"),r.getElement("#"+o)&&r.getElement("#"+o).destroy()):(u=!1,t.retrieve("fileId")&&(u=t.retrieve("fileId")),f=t.getElement("td").get("html"),window.fireEvent("multiFileDeleted",{deleteName:f,deletedId:u,questionName:e,table:i}),r.fireEvent("multiFileDeleted",{deleteName:f,deletedId:u,questionName:e,table:i}),delete u,delete f),t.destroy(),Affinity.uiGrid.zebra(i),i.getElements("tbody tr").length==0&&i.getParent().addClass("hidden"),delete s,delete r,delete t,delete i,delete e},downloadFile:function(n){n.stop();var t=n.target.get("tag")=="td"?n.target:n.target.getParent("td"),i=t.getParent("tr").retrieve("fileId"),r=t.get("html"),u=t.getParent("tr").retrieve("dowloadUrl");i&&r&&u&&window.open(u+"?documentId="+i+"&documentName="+r,"_blank")},reset:function(n){var t=!1,i=!1,r,u;if(typeOf(n)==="element"&&(n.hasClass("uploadmulti")&&(t=n),typeOf(n)==="element"&&n.get("type")&&(n.get("type")==="input"||n.get("type")==="file")&&(t=n.getParent(".uploadmulti"))),t&&t.getElement("label input")&&(i=t.getElement("label input")),t){if(r=t.getElement("table"),u=t.get("data-question-name"),Array.each(t.getElements("label input"),function(n){n!==i&&n.destroy()}),t.store("count",1),i&&(i.set("name",u+"_file0").set("id",u+"_file0").set("class",null).set("type","file").removeEvents().addEvent("change",this.addFile.bind(this)).fade("hide"),i.value="","files"in i))try{i.files=[]}catch(f){}r.getElement("tbody").empty(),r.getParent().addClass("hidden")}}}),UIValidation=new Class({Version:"1.0.2.0",Sequence:1180,Name:"Validation",File:"ui.validation.js",Jira:"",Notes:"API Structure change",initialize:function(n){if(typeOf(n)==="object"&&(typeOf(n.target)=="element"||typeOf(n.target)=="form"))return new UIFormValidation(n);this.processNew()},processNew:function(){Array.each(document.getElements("form.validate-form"),function(n){n.retrieve("validation")||new UIFormValidation({target:n})}.bind(this))}}),UIFormValidation=new Class({Implements:[Options],Binds:["disable","enable","ignoreRequired","doRequired","submitButtonMouseDown","validateForm","validate","processForm","validateForm","processErrors","validateElement","processError","validateHasvalue","validateSentence","validateString","validateNumber","validateInt","validateFloat","validateCurrency","validateEmail","validateChecked","validateMultiChecked","validateRadioSelected","validateLength","validateRange","validateDate","validateLinked","validateNomatch","validateUrl","validateFile","checkNum","validateBankNumber","validateTaxCode","validateTaxNumber","validateTaxNumberCountry","validateBankNumberCountry","validateFormname"],options:{target:null,onPost:null,onValidateCallback:null,onValidateFailCallback:null},approvedElements:["input","textarea","select"],approvedValidations:["file","banknumber","taxcode","taxnumber"],initialize:function(n){this.setOptions(n),this.options.target.retrieve("validation")&&this.options.target.retrieve("validation").destroy(),this.options.target.store("validation",this),this.options.target.addEvent("submit",this.validateForm),Array.each(this.options.target.getElements('*[type="submit"]'),function(n){n.addEvent(Affinity.events.click,this.submitButtonMouseDown)}.bind(this)),this.taxValidationRequest=!1,this.banknumValidationRequests={}},ignoreHasValue:!1,disaabled:!1,disable:function(){this.disaabled=!0},enable:function(){this.disaabled=!1},ignoreRequired:function(){this.ignoreHasValue=!0},doRequired:function(){this.ignoreHasValue=!1},destroy:function(){this.options.target.removeEvent("submit",this.validateForm),this.options.target.eliminate("validation"),this.options=null},submitButtonMouseDown:function(n){var t=n.target.hasClass(".button")?n.target:n.target.get("tag")==="button"?n.target:n.target.getParent(".button")?n.target.getParent(".button"):n.target.getParent("button")?n.target.getParent("button"):!1;this.ignoreHasValue=!1,t&&t.hasClass("ignore-required")&&(this.ignoreHasValue=!0)},validateForm:function(n){this.disaabled||(n.preventDefault(),n.stopPropagation(),n.stop(),this.validate())},validate:function(n){if(this.options.target===null)throw"Can not validate on no form";document.getElements(".error").removeClass("error"),document.getElements(".errorstr").destroy(),this.options.onPost&&typeOf(this.options.onPost)==="function"&&this.options.onPost(),this.errors=[],n?Array.each(this.options.target.getElements("tr.timesheet-row"),function(n){n&&n.getElement("td.active.check")&&n.getElement("td.active.check").getElement("input")&&n.getElement("td.active.check").getElement("input").checked&&(n.getElements(".errors").destroy(),Array.each(n.getElements(".validate"),this.validateElement))}.bind(this)):Array.each(this.options.target.getElements(".validate"),this.validateElement),document.getElements(".validated").removeClass("validated"),this.errors.length>0?this.processErrors():(Array.each(document.getElements(".isnullable.isnull"),function(n){n.value&&(n.value="NULL")}.bind(this)),this.options.onValidateCallback&&typeOf(this.options.onValidateCallback)=="function"?this.options.onValidateCallback():this.options.target.submit())},processErrors:function(){var n;if(Array.each(this.errors,function(t){n=t[0],this.approvedElements.contains(n.get("tag"))&&n.addClass("error"),t[0].getPrevious("label")&&(n=t[0].getPrevious("label")),t[0].getParent().hasClass("currencybox")&&(n=t[0].getParent().getPrevious("label")),t[0].getParent().hasClass("countryselector")&&(n=t[0].getParent().getPrevious("label")),new Element("div",{"class":"errors",html:t[1]}).inject(n,"before"),t[0].getParent(".form-row")&&t[0].getParent(".form-row").removeClass("valid").addClass("invalid")}.bind(this)),this.options.onValidateFailCallback&&typeOf(this.options.onValidateFailCallback)=="function")this.options.onValidateFailCallback(this.errors)},processError:function(n,t){var i,r,u;t.getAttribute("data-validate-error-str")&&(n=n+"<br />"+t.getAttribute("data-validate-error-str")),i=n,t.get("data-display-id")&&(t=document.id(t.get("data-display-id"))),t.getParent().getElement("label")&&(u=t.getParent().getElement("label").get("html").stripTags().trim().replace("*","")+" ",t.getParent("tr.timesheet-row")&&(r="Row "+(t.getParent("tbody").getElements("tr.timesheet-row").indexOf(t.getParent("tr.timesheet-row"))+1)+" "),i=r+u+n.replace("This ","")),this.errors.contains([t,n,i])||this.errors.push([t,n,i])},validateElement:function(n){if(n.getAttribute("data-validate-method")&&(this.approvedElements.contains(n.get("tag"))||this.approvedValidations.contains(n.get("data-validate-method")))){var t,i,r=n.getAttribute("data-validate-method").split(",");Array.each(r,function(r){t="validate"+r.capitalize(),i=typeOf(this[t])=="function"?!0:!1,i&&(n.getParent(".form-row")&&n.getParent(".form-row").removeClass("invalid").addClass("valid"),this[t](n))}.bind(this))}},validateHasvalue:function(n){if(!this.ignoreHasValue&&typeOf(n)=="element"){if(n.hasClass("hidden"))return;if(typeOf(n.value)!=="null"){if(n.value!=""&&n.value.trim()!=="")return;this.processError("This must have a value",n)}}},validateSentence:function(n){var i=/^[a-zA-Z0-9_\-.,:;'\"!?@#$%\*\/\\|()\s]*$/g,r=new RegExp(i),t;n.value.length>0&&(r.test(n.value)||(t=255,t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):t,t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):t,t=parseInt(t)||255,n.value.length>t?this.processError("The text is too large. The maximum length allowed is 255 characters.",n):this.processError("Some of the symbols used are invalid (ok symbols: . , _ - ; : ( ) ? $ * % @ # ! \\ ' \" )",n)))},validateString:function(n){var t=/^[A-Za-z0-9_\-.]+$/g,i=new RegExp(t);n.value.length>0&&(i.test(n.value)||this.processError("This may not have spaces and can only have numbers, letters and some symbols (ok symbols: _ - . )",n))},validateNumber:function(n){var t=2147483647,i=/^[-+]?[0-9,.]+$/g,r=new RegExp(i);if(n.value.length>0){if(parseInt(n.value.replace(/[^0-9.]/g,""))>t){this.processError("Number values can be no greater than "+t,n);return}r.test(n.value)||this.processError("This must only be numbers and may have commas and points",n)}},validateInt:function(n){var t=2147483647,i=-2147483647,r=/^[-+]?[0-9]+$/g,u=new RegExp(r);if(n.value.length>0){if(parseInt(n.value)>t){this.processError("Int values can be no greater than "+t,n);return}if(parseInt(n.value)<i){this.processError("Int values can be no smaller than "+i,n);return}u.test(n.value)||this.processError("This must be an integer value",n)}},validateFloat:function(n){var t=2147483647,i=-2147483647,r=/^[-+]?[0-9]*\.?[0-9]+$/g,u=new RegExp(r);if(n.value.length>0){if(parseFloat(n.value)>t){this.processError("Float values can be no greater than "+t,n);return}if(parseFloat(n.value)<i){this.processError("Float values can be no smaller than "+i,n);return}u.test(n.value)||this.processError("This must be a float value with maximum 5 decimal places",n)}},validateAlphanumeric:function(n){var t=/^[a-zA-Z0-9_\-.,:'!?$%\*\/\\|\s]+$/g,i=new RegExp(t);if(n.value.length>0){if(n.value.replace(/[^a-zA-Z]+/g,"")===""){this.processError("This must have letters",n);return}i.test(n.value)||this.processError("This must have letters and can have numbers, spaces and some symbols . , _ - : ? $ * % ! \\ / ' |",n)}},validateCurrency:function(n){var t=2147483647,i=-2147483647,r=/^\-?[0-9]{1,3}(?:[0-9]*(?:[.,][0-9]{1,5})?|(?:,[0-9]{3})*(?:\.[0-9]{1,5})?|(?:\.[0-9]{3})*(?:,[0-9]{1,5})?)$/g,u=new RegExp(r);if(n.value=n.value.replace(/\$|\s/gi,""),n.value.length>0){if(parseFloat(n.value.replace(/[^0-9.]/g,""))>t){this.processError("Currency values can be no greater than "+t,n);return}if(parseFloat(n.value.replace(/[^0-9.-]/g,""))<i){this.processError("Currency values can be no smaller than "+i,n);return}u.test(n.value)||this.processError("This must be a valid currency value (without the currency symbol). Eg:<br />123,456,789.12<br />OR<br />123456789.12<br />Mind your commas and decimals!<br />Up to 5 decimal places is permitted.",n)}},validateEmail:function(n){var t=new RegExp(/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/);n.value.length>0&&(t.test(n.value)||this.processError("This must be a valid email address",n))},validateChecked:function(n){this.ignoreHasValue||n.get("type")!="checkbox"||n.checked||this.processError("This must be checked",n)},validateMultiChecked:function(n){this.ignoreHasValue||!n.hasClass("validated")&&n.get("type")=="checkbox"&&n.get("data-validation-multicheck-id")&&(n.checked||(checked=!1,Array.each(n.getParents("form")[0].getElements("input[type=checkbox]"),function(t){t.get("data-validation-multicheck-id")==n.get("data-validation-multicheck-id")&&t.checked&&(checked=!0),t.addClass("validated")}.bind(this)),checked==!1&&this.processError("One of these must be checked",n)))},validateRadioSelected:function(n){this.ignoreHasValue||!n.hasClass("validated")&&n.get("type")=="radio"&&n.get("name")&&(n.checked||(checked=!1,Array.each(n.getParents("form")[0].getElements("input[name="+n.get("name")+"]"),function(n){n.checked&&(checked=!0),n.addClass("validated")}.bind(this)),checked==!1&&this.processError("One of these must be selected",n)))},validateLength:function(n){if(n.value.length>0){var t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):!1,i=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):!1,r=n.getAttribute("data-validate-min")?n.getAttribute("data-validate-min"):!1;r&&n.value.length<parseInt(r)&&this.processError("This must be longer than "+r+"character(s)",n),i&&n.value.length>parseInt(i)&&this.processError("This must be shorter than "+i+" character(s)",n),t&&n.value.length<parseInt(t)&&this.processError("This must be at least "+t+" character(s)",n)}},validateRange:function(n){if(n.value.length>0){var t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):!1,i=n.getAttribute("data-validate-min")?n.getAttribute("data-validate-min"):!1;if(isNaN(n.value)){this.processError("This must be a number",n);return}t&&parseFloat(n.value)>parseFloat(t)&&this.processError("This must be less than or equal to "+t,n),i&&parseFloat(n.value)<parseFloat(i)&&this.processError("This must be greater than or equal to "+i,n)}},validateDate:function(n){n.value.length>0&&(Date.parse(n.value).isValid()||this.processError("This must be a valid date",n))},validateLinked:function(){},validateNomatch:function(n){var i,r,u,t=n.getParent(".default-form");n.get("data-validate-match")&&t.getElement("."+n.get("data-validate-match"))&&(i=n.value,r=t.getElement("."+n.get("data-validate-match")).value,u=t.getElement("."+n.get("data-validate-match")).getParent(".form-row").getElement("label"),i===r&&this.processError("This must not match "+u.get("html").stripTags(),n))},validateUrl:function(n){var t=new RegExp(/(http|ftp|https|ftps):\/\/+([\w.,@?^=%&:\/~+#-]*[\w@?^=%&\/~+#-])?/);n.value.length>0&&(t.test(n.value)||this.processError("This must be a valid URL (try adding http:// to the start of the url)",n))},validateFile:function(n){var r=!1,t,u,i;if(typeOf(n)=="element"){if(u=n.getElements("input[type=file]"),u.length>0)for(t=0;t<u.length;t++)if(u[t].value!==""){r=!0;break}i=n.getElements("input.initialValues");try{if(i)if(typeOf(i)==="string")i.trim()!==""&&(r=!0);else if(i.length>0)for(t=0;t<i.length;t++)if(i[t].value!==null&&i[t].value!==""){r=!0;break}}catch(f){}}r||this.processError("You must upload a file",n)},checkNum:function(n){if(isNaN(n))return!1},validateBankNumber:function(n,t,i){var u=!1,f=typeof Affinity.login.profile.employeeNumber!="undefined"?Affinity.login.profile.employeeNumber:!1,e=n.value,r;if(i||(i="_default"),f&&e&&!isNaN(f)&&e.trim()!=""&&(u=Affinity.zelosroot+"/ValidateBankNumber"),u)r=this.banknumValidationRequests[i],r&&r.isRunning()&&r.cancel(),this.banknumValidationRequests[i]=new Request.JSON({url:u,method:"post",onSuccess:function(t){window.fireEvent("bankValidationReturned",{el:n,data:t}),"success"in t&&t.success?window.fireEvent("bankValidationSuccess"):window.fireEvent("bankValidationError")},onError:function(){window.fireEvent("bankValidationError")},onFailure:function(){window.fireEvent("bankValidationError")}}).post({EmployeeNo:f,BankNumber:e,CountryCode:t});else return!1},validateTaxNumberCountry:function(n){if(n.value.trim()==="")return this.processError("You must select a country",n),!1},validateBankNumberCountry:function(n){if(n.value.trim()==="")return this.processError("You must select a country",n),!1},validateTaxNumber:function(n,t){var u=!1,i=typeof Affinity.login.profile.employeeNumber!="undefined"?Affinity.login.profile.employeeNumber:!1,r=n.value;if(i&&r&&!isNaN(i)&&r.trim()!=""&&Affinity.zelosroot+"?api=/ValidateTaxNumber",u)this.taxValidationRequest&&this.taxValidationRequest.isRunning()&&this.taxValidationRequest.cancel(),this.taxValidationRequest=new Request.JSON({url:u,method:"post",onSuccess:function(t){window.fireEvent("taxValidationReturned",{el:n,data:t}),"success"in t&&t.success?window.fireEvent("taxValidationSuccess"):window.fireEvent("taxValidationError")},onError:function(){window.fireEvent("taxValidationError")},onFailure:function(){window.fireEvent("taxValidationError")}}).post({EmployeeNo:i,TaxNumber:r,CountryCode:t});else return!1},validateAddress:function(){return},validateFormname:function(n){var i=/^[a-zA-Z0-9_\-.,;'\"!?@#$\/\\|()\s]*$/g,r=new RegExp(i),t;n.value.length>0&&(r.test(n.value)||(t=255,t=n.getAttribute("data-validate-length")?n.getAttribute("data-validate-length"):t,t=n.getAttribute("data-validate-max")?n.getAttribute("data-validate-max"):t,t=parseInt(t)||255,n.value.length>t?this.processError("The text is too large. The maximum length allowed is 255 characters.",n):this.processError("Some of the symbols used are invalid (ok symbols: . , _ - ; ( ) ? $ @ # ! \\ ' \" )",n)))}})