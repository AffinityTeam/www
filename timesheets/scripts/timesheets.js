var Favourites,FavouriteRow,Settings,Statistics,nodes,i,node,parent,nextNode,tabElement,currentTab,target,tab,w,propa,refreshed;for(Affinity.Components=Affinity.Components||{},Affinity.Components.Favourites={Version:"1.0.10.0",Sequence:10030,Name:"Favourites",File:"ts.favourites.js",Jira:"",Notes:"Add hide new master laoder"},Favourites=new Class({Implements:[Options,Events],Binds:["init","dashboardLoginDelayHack","getFavs","getEmployeeFavs","gotFavs","insertRow","processError","reset","checkMobileMenuSwipeOpen","mobileMenuOpen","mobileMenuClose","loggedin","loggedout"],options:{target:null},emptyRowTemplate:"",rowTemplate:"",initialize:function(n){this.setOptions(n),this.table=this.options.target,this.tbody=this.table.getElement("tbody"),this.emptyRowTemplate=this.tbody.getElement("tr").innerHTML,this.rowTemplate=this.tbody.getElement("tr.fav-row-template").innerHTML,this.reset(this.emptyRowTemplate)},employeeProfile:!1,init:function(){var n,t;if(this.baseLang=Affinity.languages.english.features,this.baseAppLang=Affinity.languages.english.application.timesheets.features,this.table.querySelectorAll("thead th")[0].innerHTML=this.baseAppLang.favourites.views.manage.columnName,this.table.querySelectorAll("thead th")[1].innerHTML=this.baseAppLang.favourites.views.manage.columnType,this.table.querySelectorAll("thead th")[2].innerHTML=this.baseAppLang.favourites.views.manage.columnFields,this.isManager=!1,this.employeNumer=!1,this.hasDates=!1,this.favs=[],this.tabBox=document.getElement(".section-nav ul").removeClass("hidden"),document.getElement("li#logout")&&(this.logoutButton=document.getElement("#logout"),Affinity.hasDashboardWrapper()?this.logoutButton.addClass("hidden"):(this.logoutButtonLabel=this.logoutButton.getElement("span.text"),Affinity.oldess?(this.logoutButtonLabel.set("html","Close"),this.logoutButton.addClass("ui-has-tooltip").set("data-tooltip","Will not log out of ESS").set("data-tooltip-dir","bottom")):this.logoutButtonLabel.set("html","Logout"))),Affinity.mobile){this.tabBoxContainer=document.getElement(".section-nav"),this.tabBoxButton=document.getElement(".section-nav-icon"),this.tabBoxButton.addEvent(Affinity.events.click,this.mobileMenuOpen),n=new Hammer(window,{domEvents:!0});n.on("panleft",this.checkMobileMenuSwipeOpen);n.on("panright",this.mobileMenuClose);window.addEvent("mobileback",this.mobileMenuClose),t=this.tabBox.getElement("li.link a"),t.removeEvents(),t.addEvent(Affinity.events.start,function(n){n.stopPropagation()}.bind(this))}return Affinity.isLoggedIn?(this.loggedin(),setTimeout(function(){window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)}.bind(this),1e3)):(window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)),Affinity.AwardModels={Widgets:[],closeAll:function(){Affinity.AwardModels.Widgets.forEach(function(n){n&&n.hasOwnProperty("close")&&typeof n.close=="function"&&n.close()})}},Affinity.HideMasterLoader(1e3),!0},dashboardLoginDelayHackPasses:0,dashboardLoginDelayHackTimer:!1,dashboardLoginDelayHack:function(){this.dashboardLoginDelayHackTimer=setTimeout(function(){clearTimeout(this.dashboardLoginDelayHackTimer),this.dashboardLoginDelayHackPasses++,Affinity.SessionLoginReady()&&Affinity.isloggedin?this.loggedin():this.dashboardLoginDelayHack()}.bind(this),1e3)},getFavsLoader:!1,getFavs:function(){window.scrollTo(0,0),Affinity.prompts.clearOnClose(),Affinity.prompts.hide(),this.reset('<span class="spinner small light"><\/span>'),this.isManager?this.getEmployeeFavs():this.getEmployeeFavs(this.employeNumer)},getEmployeeFavs:function(n){var t,i;t=Affinity.zelosroot+"?api=Favourite/GetFavouriteNamesExt",n&&(t+="&employeeNo="+n),i=new Request.JSON({method:"get",noCache:!0,url:t,onSuccess:function(n){if(JSON.Unauthorized(n))this.processError("Unauthorised");else{var t;n.hasOwnProperty("error")&&typeOf(n.error)==="string"?(t=n.error.trim()!==""?n.error.trim():Affinity.languages.english.generic.error,t=Affinity.CheckFavError(n,t),console.log(errorStr)):n.hasOwnProperty("errorMsg")&&typeOf(n.errorMsg)==="string"?(t=n.errorMsg.trim()!==""?n.errorMsg.trim():Affinity.languages.english.generic.error,t=Affinity.CheckFavError(n,t),console.log(errorStr)):typeOf(n)==="array"&&n.length>0?this.gotFavs(n):this.reset()}}.bind(this)}).get()},returnHash:function(n){var t=[];return Object.each(JSON.decode(n.Fields),function(n,i){t.push(i+":"+n)}),t.push("Type:"+n.Type),t.push("EmployeeNo:"+n.EmployeeNo),t.push("Name:"+n.Name),t.sort(),t=t.join(",")},gotFavs:function(n){if(this.favs=[],n.length===0){this.reset(this.emptyRowTemplate);return}this.favs=this.options.isManager?Affinity.FavResultSort(n,"Name","EmployeeName"):Affinity.FavResultSort(n,"Name"),this.tbody.empty();var i=[],t;Array.each(this.favs,function(n){t=this.returnHash(n),i.indexOf(t)===-1&&(i.push(t),n.Type=n.hasOwnProperty("Type")?n.Type:this.defaultType,n.EmployeeNo=n.hasOwnProperty("EmployeeNo")?parseInt(n.EmployeeNo):n.hasOwnProperty("Item1")?parseInt(n.Item1):"?",n.EmployeeName=n.hasOwnProperty("EmployeeName")?n.EmployeeName:n.hasOwnProperty("Item2")?n.Item2:"?",n.Name=n.hasOwnProperty("Name")?n.Name:n.hasOwnProperty("Item3")?n.Item3:"?",n.Fields=n.hasOwnProperty("Fields")?JSON.decode(n.Fields):n.hasOwnProperty("Item4")?JSON.decode(n.Item4):{},n.Created=n.hasOwnProperty("Created")?Date.parse(n.Created):new Date,this.insertRow(n))}.bind(this)),Affinity.uiGrid&&Affinity.uiGrid.zebra(this.table,"fav-row")},insertRow:function(n){var t=new FavouriteRow(n,this.rowTemplate,this);t.element.inject(this.tbody)},processError:function(n){this.reset(n)},reset:function(n){this.tbody.empty(),new Element("tr").adopt(new Element("td",{colspan:this.hasDates?5:4,html:n?n:this.baseAppLang.favourites.views.manage.none})).inject(this.tbody)},mobileCloseDelay:!1,checkMobileMenuSwipeOpen:function(n){Affinity.stopHammerEvent(n);var t=window.getSize().x,i=n.center.x+n.distance,r=t-i;r<30&&this.mobileMenuOpen()},mobileMenuOpen:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.addClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose),this.mobileCloseDelay=function(){window.addEvent(Affinity.events.start,this.mobileMenuClose),window.addEvent("mobileback",this.mobileMenuClose)}.delay(250,this)},mobileMenuClose:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.removeClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose)},loggedin:function(){document.getElement("li#logout")&&(Affinity.oldess&&Affinity.oldessLaunched?document.getElement("li#logout span.text").set("html","Close"):document.getElement("li#logout span.text").set("html","Logout")),Affinity.enableFavourites=!1,!Affinity.mobile&&Affinity.enableFavouritesGlobal&&Affinity.login.areas.Timesheet.hasOwnProperty("EnableFavourite")&&(Affinity.enableFavourites=Affinity.login.areas.Timesheet.EnableFavourite),this.isManager=Affinity.login&&Affinity.login.hasOwnProperty("areas")?Affinity.login.areas.Timesheet.IsManager:!1,this.employeNumer=Affinity.login&&Affinity.login.hasOwnProperty("profile")?Affinity.login.profile.employeeNumber:!1,this.getFavs()},loggedout:function(){window.onbeforeunload=function(){},this.reset(),this.isManager=!1,this.employeNumer=!1,this.hasDates=!1,this.favs=[],window.location.href="./"}}),FavouriteRow=new Class({Implements:[Events],Binds:["edit","del","destroy"],element:null,data:{},initialize:function(n,t,i){this.baseLang=Affinity.languages.english.features,this.baseAppLang=Affinity.languages.english.application.timesheets.features,this.data=n,this.parent=i,this.element=new Element("tr",{"class":"fav-row",html:t}),this.nameRow=this.element.getElement("td.fav-name"),this.typeRow=this.element.getElement("td.fav-type"),this.fieldsRow=this.element.getElement("td.fav-fields"),this.parent.hasDates&&(this.dateRow=this.element.getElement("td.fav-date")),this.buttonsRow=this.element.getElement("td.fav-buttons"),this.editButton=this.buttonsRow.getElement(".fav-edit-button"),this.delButton=this.buttonsRow.getElement(".fav-del-button"),this.nameRow.innerHTML=this.returnNameString(this.data),this.typeRow.innerHTML=this.returnTypeString(this.data),this.fieldsRow.innerHTML=this.returnFieldsString(this.data),this.parent.hasDates&&(this.dateRow.innerHTML=this.returnDateString(this.data)),this.editButton.addEvent("click",this.edit),this.delButton.addEvent("click",this.del)},returnNameString:function(n){var t=Affinity.login.profile.commonName;return n.hasOwnProperty("Name")&&(t=n.hasOwnProperty("EmployeeName")?n.EmployeeName+" - "+n.Name.replace("_"," "):n.Name.replace("_"," ")),t},returnTypeString:function(n){var t=parseInt(n.Type);switch(t){case 1:return"Timesheet ";case 2:return"Allowance ";case 3:return"Leave";case 4:return"Mileage";default:return""}},returnFieldsString:function(n){var t="",i=[];return n.hasOwnProperty("Fields")&&(t="Template contains '",typeOf(this.data.Fields)!=="object"?t+="no data":Object.each(this.data.Fields,function(n,t){(n+"").trim()!==""&&i.push(t+": "+n)}),t=i.join(", ")),t},returnDateString:function(n){var t=new Date;return n.hasOwnProperty("Created")&&(t=Date.parse(n.Created)),t.toWords()+" ("+t.toSimple()+" "+t.toTime12()+")"},edit:function(n,t){if(Affinity.enableFavourites){var i=Affinity.zelosroot+"?api=Favourite/RenameFavourite&timesheetType="+this.data.Type+"&employeeNo="+this.data.EmployeeNo+"&OldName="+this.data.Name+"&NewName=",r=this.baseAppLang.favourites.renameMessage;n&&typeof n=="string"&&(n=n.trim()!==""?n.trim():Affinity.languages.english.generic.error,n=Affinity.CheckFavError(result,errormsg),r=n+"<br />Please try again."),uiprompt({message:r,showButtons:!0,noClose:!1,value:typeOf(t)==="string"?t:this.data.Name,onOk:function(n){var t=this.baseLang.favourites.validation.validateName(n),r;if(!t.isValid){this.edit.delay(50,this,[t.error,n]);return}uialert({message:this.baseAppLang.favourites.renamingMessage+'<img src="'+Affinity.loaders.dark+'" />',noClose:!0}),i+=n.trim(),r=new Request.JSON({url:i,onComplete:function(n){if(n.hasOwnProperty("success")&&n.success===!1&&n.hasOwnProperty("error")&&typeOf(n.error)==="string"){var t=n.error.trim()!==""?n.error.trim():Affinity.languages.english.generic.error,t=Affinity.CheckFavError(n,t);uialert({message:"Oops! "+t+"<br />Please try again.",showButtons:!0,onClose:this.parent.getFavs});return}Affinity.uiPompts.hide(),this.parent.getFavs()}.bind(this),onFailure:function(){uialert({message:Affinity.languages.english.generic.error+"<br />Please try again.",showButtons:!0,onClose:this.parent.getFavs})}.bind(this),onError:function(n){var t=Affinity.CheckFavError(n,Affinity.languages.english.generic.error+"<br />Please try again.");uialert({message:t,showButtons:!0,onClose:this.parent.getFavs})}.bind(this)}).post()}.bind(this)})}},del:function(){if(Affinity.enableFavourites){var n=Affinity.zelosroot+"?api=Favourite/RemoveFavourite?employeeNo="+this.data.EmployeeNo+"&timesheetType="+this.data.Type+"&Name="+this.data.Name,t=this.baseAppLang.favourites.deleteMessage;Affinity,uiconfirm({message:t,showButtons:!0,noClose:!1,onOk:function(){uialert({message:this.baseAppLang.favourites.deletingMessage+' <img src="'+Affinity.loaders.dark+'" />',noClose:!0});var t=new Request.JSON({url:n,onComplete:function(n){if(n.hasOwnProperty("OK")&&n.OK===!1){var t=Affinity.languages.english.generic.error;n.hasOwnProperty("error")&&typeOf(n.error)==="string"&&(t=n.error.trim()!==""?n.error.trim():t),t=Affinity.CheckFavError(n,t),uialert({message:"Oops! "+t+"<br />Please try again.",showButtons:!0,onClose:this.parent.getFavs});return}Affinity.uiPompts.hide(),this.parent.getFavs()}.bind(this),onFailure:function(){uialert({message:Affinity.languages.english.generic.error+"<br />Please try again.",showButtons:!0,onClose:this.parent.getFavs})}.bind(this),onError:function(n){var t=Affinity.CheckFavError(n,Affinity.languages.english.generic.error+"<br />Please try again.");uialert({message:t,showButtons:!0,onClose:this.parent.getFavs})}}).post()}.bind(this)})}},destroy:function(){}}),Affinity.Components=Affinity.Components||{},Affinity.Components.Settings={Version:"1.0.4.0",Sequence:10020,Name:"Settings",File:"ts.settings.js",Jira:"",Notes:"Add hide new master laoder"},Settings=new Class({Implements:[Options,Events],Binds:["init","dashboardLoginDelayHack","checkMobileMenuSwipeOpen","mobileMenuOpen","mobileMenuClose","addShare","loadExistingShares","deleteShare","loggedin","loggedout"],options:{existingSharesTarget:null,newSharesTarget:null,managerLookupTarget:null},initialize:function(n){this.setOptions(n)},init:function(){var t,n;if(this.options.newSharesTarget.getElement(".addNewShare").addEvent(Affinity.events.click,this.addShare),this.tabBox=document.getElement(".section-nav ul").removeClass("hidden"),document.getElement("li#logout")&&(this.logoutButton=document.getElement("#logout"),Affinity.hasDashboardWrapper()?this.logoutButton.addClass("hidden"):(this.logoutButtonLabel=this.logoutButton.getElement("span.text"),Affinity.oldess?(this.logoutButtonLabel.set("html","Close"),this.logoutButton.addClass("ui-has-tooltip").set("data-tooltip","Will not log out of ESS").set("data-tooltip-dir","bottom")):this.logoutButtonLabel.set("html","Logout"))),Affinity.mobile){this.tabBoxContainer=document.getElement(".section-nav"),this.tabBoxButton=document.getElement(".section-nav-icon"),this.tabBoxButton.addEvent(Affinity.events.click,this.mobileMenuOpen),t=new Hammer(window,{domEvents:!0});t.on("panright",this.mobileMenuClose);window.addEvent("mobileback",this.mobileMenuClose),n=this.tabBox.getElement("li.link a"),n.removeEvents(),n.addEvent(Affinity.events.start,function(n){n.stopPropagation()}.bind(this))}else Array.each(document.getElements(".ui-mobile-calendar-buttons"),function(n){n.removeClass("ui-mobile-calendar-buttons"),n.addClass("ui-calendar-buttons")}),Array.each(document.getElements(".ui-mobile-calendar-button"),function(n){n.removeClass("ui-mobile-calendar-button"),n.addClass("ui-calendar-button")}),document.getElement(".ts-new-share").addClass("w-border");return Affinity.isLoggedIn?(this.loggedin(),setTimeout(function(){window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)}.bind(this),1e3)):(window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)),Affinity.AwardModels={Widgets:[],closeAll:function(){Affinity.AwardModels.Widgets.forEach(function(n){n&&n.hasOwnProperty("close")&&typeof n.close=="function"&&n.close()})}},Affinity.HideMasterLoader(1e3),!0},dashboardLoginDelayHackPasses:0,dashboardLoginDelayHackTimer:!1,dashboardLoginDelayHack:function(){this.dashboardLoginDelayHackTimer=setTimeout(function(){clearTimeout(this.dashboardLoginDelayHackTimer),this.dashboardLoginDelayHackPasses++,Affinity.SessionLoginReady()&&Affinity.isloggedin?this.loggedin():this.dashboardLoginDelayHack()}.bind(this),1e3)},mobileCloseDelay:!1,checkMobileMenuSwipeOpen:function(n){Affinity.stopHammerEvent(n);var t=window.getSize().x,i=n.center.x+n.distance,r=t-i;r<30&&this.mobileMenuOpen()},mobileMenuOpen:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.addClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose),this.mobileCloseDelay=function(){window.addEvent(Affinity.events.start,this.mobileMenuClose),window.addEvent("mobileback",this.mobileMenuClose)}.delay(250,this)},mobileMenuClose:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.removeClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose)},asSelect:!1,insertManagercomponents:function(){if(!this.asSelect){if(Affinity.login.profile.employeeNumber>=5e6){var t=this.options.newSharesTarget,n=new Element("div",{"class":"form-row"}).inject(t,"top");new Element("label",{html:"Share / Delegate as"}).inject(n),this.asSelect=new Element("select",{"class":"has-lookup","data-lookup-api":Affinity.zelosroot+"?api=timesheetAsManager/GetManagers","data-default-value":Affinity.login.profile.employeeNumber,"data-lookup-rules":"hasValue","data-insert-empty":"true"}).inject(n),this.asSelect.addEvent("change",this.loadExistingShares)}Affinity.lookups.processNew()}},loadExistingShares:function(){var i=this.options.existingSharesTarget,n=i.getElement("tbody"),t,r;n.empty(),this.insertManagercomponents(),new Element("tr").adopt(new Element("td",{colspan:5,html:"Loading..."})).inject(n),t=Affinity.zelosroot+"?api=Employee/GetNotifyApproval?",t+="notifyArea=Timesheet",this.asSelect&&(t+="&approver="+this.asSelect.value,t=t.replace(/GetNotifyApproval/,"GetNotifyApproval2")),r=new Request.JSON({url:Affinity.GetCacheSafePath(t),method:"get",onComplete:function(t){if(n.empty(),typeOf(t)=="array"&&t.length>0){Array.each(t,function(t){new Element("tr",{"data-share-id":t.Id}).adopt(new Element("td",{html:Date.parse(t.DateFrom).format("%a %b %e%o %Y")}),new Element("td",{html:Date.parse(t.DateTo).format("%a %b %e%o %Y")}),new Element("td",{html:t.ShareDelegate}),new Element("td",{html:t.AlternateApproverName,"data-employee-number":t.AlternateApprover}),new Element("td",{"class":"buttons"}).adopt(new Element("span",{"class":"button red w-icon"}).adopt(new Element("span",{html:Affinity.icons.Cross}),new Element("span",{html:"Delete"})).addEvent(Affinity.events.click,this.deleteShare))).store("data",t).inject(n)}.bind(this));try{Affinity.uiGrid.zebra(i)}catch(r){}}else new Element("tr").adopt(new Element("td",{colspan:5,html:"Nothing to view"})).inject(n)}.bind(this),onError:function(){n.empty(),new Element("tr").adopt(new Element("td",{colspan:5,html:"Nothing to view"})).inject(n)}.bind(this),onFailure:function(){n.empty(),new Element("tr").adopt(new Element("td",{colspan:5,html:"Nothing to view"})).inject(n)}.bind(this)}).send(),delete n,delete thead},addShare:function(){var i=this.options.newSharesTarget,r=Date.parse(i.getElement("#date-from").value),n=Date.parse(i.getElement("#date-to").value),u=!1,f,e,o,t,s;typeOf(r)==="date"&&"isValid"in r&&r.isValid()&&typeOf(n)==="date"&&"isValid"in n&&n.isValid()&&(u=!0),u&&((r>n||n<r)&&(f=new Date(r),r=n,n=f,e=Affinity.UI.calendars.widgets[i.getElement("#date-from").id],o=Affinity.UI.calendars.widgets[i.getElement("#date-to").id],e.setDate(r,!1),o.setDate(n,!1)),n<(new Date).clearTime()?uialert({message:"You can not share or delegate in the past",showButtons:!0}):(t=Affinity.zelosroot+"?api=Employee/PostNotifyApproval?",t+="dateFromInclusive="+i.getElement("#date-from").value+"&",t+="dateToInclusive="+i.getElement("#date-to").value+"&",t+="shareDelegate="+i.getElement("#method").value+"&",t+="alternateApprover="+i.getElement("#to").value+"&",t+="notifyArea=Timesheet",this.asSelect&&(t+="&approver="+this.asSelect.value,t=t.replace(/PostNotifyApproval/,"PostNotifyApproval2")),s=new Request.JSON({url:Affinity.GetCacheSafePath(t),method:"post",onComplete:function(n){if(typeOf(n)==="object"){if("success"in n&&typeOf(n.success)==="boolean"&&!n.success){var t=Affinity.languages.english.generic.error;"error"in n&&typeOf(n.error)==="string"&&n.error.trim()!==""?(t+="<br /><br />"+n.error.trim(),log("error: share / delegate failed with message: "+n.error.trim())):log("error: share / delegate failed with no error. Please check console."),uialert({message:t,showButtons:!0,noClose:!1});return}this.loadExistingShares(n)}else s.status===200?this.loadExistingShares(n):(log("error: share / delegate failed with no error. Please check console."),uialert({message:Affinity.languages.english.generic.error,showButtons:!0,noClose:!1}))}.bind(this),onError:function(){}.bind(this),onFailure:function(){}.bind(this)}).post())),delete i,delete r,delete n,delete u},deleteShare:function(n){var t=n.target.getParent("tr"),r=t.retrieve("data"),i="",u;i=Affinity.apiversion>1?Affinity.zelosroot+"?api=Employee/DeleteNotifyApproval?":Affinity.zelosroot.replace("ZelosProxy","ZelosProxyDelete")+"?api=Employee/DeleteNotifyApproval?",i+="id="+r.Id,t.getElement(".button.red").addClass("hidden"),t.getElement(".button.red").getParent().adopt(new Element("img",{"class":"loader",src:Affinity.loaders.light})),u=new Request.JSON({url:Affinity.GetCacheSafePath(i),method:"get",emulation:!1,onComplete:function(n){if(n&&n.success&&!n.success){var i=Affinity.languages.english.generic.error;n.Error&&(i+="<br />"+n.Error),uialert({message:i}),t.getElement(".button.red").removeClass("hidden"),t.getElement(".loader").destroy(),delete i}else this.loadExistingShares()}.bind(this),onError:function(n){uialert({message:Affinity.languages.english.generic.error+'<pre class="hidden">'+JSON.stringify(n,undefined,2)+"<\/pre>"})}.bind(this),onFailure:function(n){uialert({message:Affinity.languages.english.generic.error+'<pre class="hidden">'+JSON.stringify(n,undefined,2)+"<\/pre>"})}.bind(this)}).send(),delete t,delete r},loggedin:function(){document.getElement("li#logout")&&(Affinity.oldess&&Affinity.oldessLaunched?document.getElement("li#logout span.text").set("html","Close"):document.getElement("li#logout span.text").set("html","Logout"));var n=Affinity.zelosroot+"?api=Employee/GetNotifyManager";this.options.managerLookupTarget.addClass("has-lookup").set("data-lookup-api",Affinity.GetCacheSafePath(n)),Affinity.lookups.processNew(),this.loadExistingShares()},loggedout:function(){window.onbeforeunload=function(){};var n=this.options.managerLookupTarget.retrieve("widget"),i=this.options.existingSharesTarget,t=i.getElement("tbody");t.empty(),new Element("tr").adopt(new Element("td",{colspan:5,html:"Nothing to view"})).inject(t),n&&"revert"in n&&n.revert(),this.options.managerLookupTarget&&this.options.managerLookupTarget.empty(),delete i,delete t,window.location.href="./"}}),Affinity.Components=Affinity.Components||{},Affinity.Components.Statistics={Version:"1.0.4.0",Sequence:10010,Name:"Statistics",File:"ts.statistics.js",Jira:"",Notes:"Add hide new master laoder"},Statistics=new Class({Implements:[Options,Events],Binds:["init","dashboardLoginDelayHack","checkMobileMenuSwipeOpen","mobileMenuOpen","mobileMenuClose","mobileMenuCloseAndRedirectToHome","loadForm","getReport","loadReport","reportLoaded","doDownloadRequest","loggedin","loggedout"],options:{filterFormTarget:null,reportTarget:null,getReportSection:null,getReportButton:null,zelosHtmlTemplate:""},initialize:function(n){this.setOptions(n)},init:function(){var t,n;if(this.options.getReportButton.addEvent("click",this.getReport),this.downloadButton=!1,this.tabBox=document.getElement(".section-nav ul").removeClass("hidden"),document.getElement("li#logout")&&(this.logoutButton=document.getElement("#logout"),Affinity.hasDashboardWrapper()?this.logoutButton.addClass("hidden"):(this.logoutButtonLabel=this.logoutButton.getElement("span.text"),Affinity.oldess?(this.logoutButtonLabel.set("html","Close"),this.logoutButton.addClass("ui-has-tooltip").set("data-tooltip","Will not log out of ESS").set("data-tooltip-dir","bottom")):this.logoutButtonLabel.set("html","Logout"))),Affinity.mobile){this.tabBoxContainer=document.getElement(".section-nav"),this.tabBoxButton=document.getElement(".section-nav-icon"),this.tabBoxButton.addEvent(Affinity.events.click,this.mobileMenuOpen),t=new Hammer(window,{domEvents:!0});t.on("panright",this.mobileMenuClose);window.addEvent("mobileback",this.mobileMenuClose),n=this.tabBox.getElement("li.link a"),n.removeEvents(),n.addEvent(Affinity.events.start,function(n){n.stopPropagation()}.bind(this))}return Affinity.isLoggedIn?(this.loggedin(),setTimeout(function(){window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)}.bind(this),1e3)):(window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)),Affinity.AwardModels={Widgets:[],closeAll:function(){Affinity.AwardModels.Widgets.forEach(function(n){n&&n.hasOwnProperty("close")&&typeof n.close=="function"&&n.close()})}},Affinity.HideMasterLoader(1e3),!0},dashboardLoginDelayHackPasses:0,dashboardLoginDelayHackTimer:!1,dashboardLoginDelayHack:function(){this.dashboardLoginDelayHackTimer=setTimeout(function(){clearTimeout(this.dashboardLoginDelayHackTimer),this.dashboardLoginDelayHackPasses++,Affinity.SessionLoginReady()&&Affinity.isloggedin?this.loggedin():this.dashboardLoginDelayHack()}.bind(this),1e3)},mobileCloseDelay:!1,checkMobileMenuSwipeOpen:function(n){Affinity.stopHammerEvent(n);var i=window.getSize().x,r=n.center.x+n.distance,t=i-r;t<30&&t>0&&this.mobileMenuOpen()},mobileMenuOpen:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.addClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose),this.mobileCloseDelay=function(){window.addEvent(Affinity.events.start,this.mobileMenuClose),window.addEvent("mobileback",this.mobileMenuClose)}.delay(250,this)},mobileMenuClose:function(n){Affinity.stopHammerEvent(n),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.removeClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose)},mobileMenuCloseAndRedirectToHome:function(){this.mobileMenuClose(),window.location.href="Home"},loadForm:function(){var n,t,i;log("&#172; load form"),this.reportOptions={target:this.options.reportTarget,getApi:"",putApi:"none",onSaveError:function(){}.bind(this),beforSave:function(){}.bind(this),onSave:function(){}.bind(this),onComplete:function(){this.reportLoaded()}.bind(this),allowHorizontalScrollingForMobile:!1},this.reportLoader=new ZelosTemplateLoad({onRequest:function(){}.bind(this),onError:function(n){log("reportLoader failed: "+n),uialert({message:"Oops! Report failed to load.",noClose:!1,showLoader:!1,showButtons:!0})}.bind(this),onComplete:function(n){if(log("reportLoader completed: "+n),n&&typeOf(n.success)==="boolean"&&n.success===!1)uialert({message:"Oops! Something went wrong processing your report.",noClose:!1,showLoader:!1,showButtons:!0});else{Affinity.mobile&&(this.reportOptions.allowHorizontalScrollingForMobile=!0),this.options.reportTarget.empty();var t=new ZelosTemplateProcess(this.reportOptions);t.processTemplate(n)}}.bind(this)}),uialert({message:"Getting report filters",noClose:!0,showLoader:!0}),n=Affinity.zelosroot+"?api=timesheetInfo/GetTimesheetFormForStatsReport",log("form get Api: "+n),t={target:this.options.filterFormTarget,getApi:n,putApi:"none",onSaveError:function(){}.bind(this),beforSave:function(){}.bind(this),onSave:function(){}.bind(this),onComplete:function(){Affinity.prompts.hide(),this.reportTypeSelect=this.options.filterFormTarget.getElement("select"),this.options.getReportSection.removeClass("hidden")}.bind(this)},this.formProcessor=new ZelosTemplateProcess(t),i=new ZelosTemplateLoad({onRequest:function(){}.bind(this),onError:function(){uialert({message:"Oops! Could net get report filters.",noClose:!1,showLoader:!1,showButtons:!0})}.bind(this),onComplete:function(n){if(n&&typeOf(n.success)==="boolean"&&n.success===!1)uialert({message:"Oops! Something went wrong processing the report filters.",noClose:!1,showLoader:!1,showButtons:!0});else{var i=[],r=0,t=Object.clone(n);Array.each(n.Children[0].Children[0].Value,function(n,t){new RegExp("dashboard","gi").test(n.value)&&i.push(t)}),i.sort(),Array.each(i,function(n){t.Children[0].Children[0].Value.splice(n-r,1),t.Children.splice(n+1-r,1),r++}),t.Children[0].Children[0].ValueAsString=JSON.stringify(t.Children[0].Children[0].Value),this.formProcessor.processTemplate(t)}}.bind(this)}),i.loadTemplate(t.getApi)},getReport:function(){var r=this.reportTypeSelect.value,f=r.toLowerCase().replace(/ /g,"-").trim(),e=this.options.filterFormTarget.getElements(".section"),o=this.options.filterFormTarget.getElement(".ui-hideable-id-"+f),s=e.indexOf(o),h=this.formProcessor.template.Children[s].Children,n,i,u,t={};t.reportType=r,Array.each(h,function(r){n=this.formProcessor.fieldProcessor.readField(r,document.id(r.Name));switch(typeOf(n.Value)){case"array":switch(r.ElementType){case"MultiCheckBox":i=[],Array.each(n.Value,function(n){n.selected&&i.push(n.value)}),t[r.Source.PropertyName]=i.join(",");break;default:Array.each(n.Value,function(n){n.selected&&(t[r.Source.PropertyName]=n.value)})}break;case"boolean":case"string":t[r.Source.PropertyName]=n.Value}}.bind(this)),u=Affinity.zelosroot+"?api=timesheetInfo/GetTimesheetTableForStatsReport/?"+Object.toQueryString(t),this.loadReport(u)},loadReport:function(n){uialert({message:"Getting report",noClose:!0,showLoader:!0}),this.reportOptions.getApi=n,this.reportLoader.loadTemplate(this.reportOptions.getApi)},reportLoaded:function(){var t,n;for(Affinity.prompts.hide(),this.downloadButton&&this.downloadButton.removeEvents(),this.options.reportTarget.getElement(".custom-button")?(this.downloadButton=this.options.reportTarget.getElement(".custom-button"),this.downloadButton.addEvent(Affinity.events.click,this.doDownloadRequest)):this.downloadButton=!1,t=this.options.reportTarget.querySelectorAll(".zelos-table th"),n=0;n<t.length;n++)if(t[n].dataset.name.test(/Employee/gi)){t[n].click();return}},doDownloadRequest:function(){var n=this.reportOptions.getApi.replace("GetTimesheetTableForStatsReport","GetTimesheetTableForStatsReportCSV");window.open(n)},loggedin:function(){document.getElement("li#logout")&&(Affinity.oldess&&Affinity.oldessLaunched?document.getElement("li#logout span.text").set("html","Close"):document.getElement("li#logout span.text").set("html","Logout")),this.zelosEngine=new ZelosInit({htmlTemplateUrl:this.options.zelosHtmlTemplate,onRequest:function(){},onError:function(){},onComplete:function(){log("zelos engine initiated and ready"),this.loadForm()}.bind(this)})},loggedout:function(){this.options.reportTarget.empty(),this.options.filterFormTarget.empty(),window.onbeforeunload=function(){}}}),Affinity.Components=Affinity.Components||{},Affinity.Components.Timesheets={Version:"1.0.12.4",Sequence:1e4,Name:"Timesheets Master Controller",File:"ui.timesheets.js",Jira:"CT-1397",Notes:"Break Management"},Timesheets=new Class({Implements:[Options,Events],Binds:["init","checkMobileMenuSwipeOpen","mobileMenuOpen","mobileMenuClose","resetPanels","destroyTabs","buildTabs","enableTab","disableTab","selectTab","tabClcked","checkDependancyCacheClear","checkLookupCacheClear","continueRefresh","refresh","mobileMenuCloseAndEventPrevention","hasWidgetChanged","getWidget","refreshWidget","doSwitchToPeriodView","doSwitchToOverviewView","doSwitchToDualdetailView","doSwitchToEmployeeView","doSwitchToEmployeeDetailedView","doSwitchToManagerView","doSwitchToBulkView","doSwitchToMileageView","switchToPeriodView","switchToOverviewView","switchToDualdetailView","switchToEmployeeView","switchToEmployeeDetailedView","switchToManagerView","switchToBulkView","switchToMileageView","getperiodviewData","getOverviewDetails","getDualdetailTimesheet","getEmployeeTimesheet","getEmployeeDetailsTimesheet","getManagerTimesheet","getBulkTimesheet","sanatisePostDocument","sanatiseTimesheetDoc","toggleFilter","toggleAdd","destroy","cancelRequests","loggedin","loggedout","logout"],options:{periodTarget:null,overviewTarget:null,dualdetailTarget:null,managerTarget:null,employeeTarget:null,employeeDetailedTarget:null,bulkTarget:null,employeeMileageTarget:null,zelosHtmlTemplate:"",gotoTimesheet:"none",gotoEmployee:-1},overrideMileage:!1,overrideFavourites:!1,source:"internal",switchData:!1,affinityData:!1,isManager:!1,isEmployee:!1,managerLoader:!1,employeeLoader:!1,currentView:"employee",currentWidget:!1,periodWidget:!1,overviewWidget:!1,dualdetailWidget:!1,employeeWidget:!1,employeeDetailedWidget:!1,managerWidget:!1,bulkWidget:!1,employeeMileageWidget:!1,publicHolidays:[],lastButtonClicked:!1,initialize:function(n){this.setOptions(n),Affinity.timesheets||(Affinity.timesheets={}),Affinity.timesheets.methods||(Affinity.timesheets.methods={}),Affinity.timesheets.ready=!1,Affinity.acValues.maxDefault=parseInt(Affinity.acValues.maxDefault),Affinity.acValues.maxSlow=parseInt(Affinity.acValues.maxSlow),Affinity.acValues.maxFast=parseInt(Affinity.acValues.maxFast),Affinity.acValues.maxVeryFast=parseInt(Affinity.acValues.maxVeryFast),Affinity.acValues.defaultComps=Affinity.acValues.defaultComps.replace(new RegExp(" ","gi"),"").split(","),Affinity.acValues.slowComps=Affinity.acValues.slowComps!=="*"?Affinity.acValues.slowComps.replace(new RegExp(" ","gi"),"").split(","):Affinity.acValues.slowComps,Affinity.acValues.fastComps=Affinity.acValues.fastComps!=="*"?Affinity.acValues.fastComps.replace(new RegExp(" ","gi"),"").split(","):Affinity.acValues.fastComps,Affinity.acValues.veryFastComps=Affinity.acValues.veryFastComps!=="*"?Affinity.acValues.veryFastComps.replace(new RegExp(" ","gi"),"").split(","):Affinity.acValues.veryFastComps,Affinity.timesheets.init=this,Affinity.timesheets.methods.sanatisePostDocument=this.sanatisePostDocument,Affinity.timesheets.zelosHtmlTemplate=this.options.zelosHtmlTemplate,Affinity.viewSettings=new ZelosViewSettings,Affinity.AwardModels={Widgets:[],closeAll:function(){Affinity.AwardModels.Widgets.forEach(function(n){n&&n.hasOwnProperty("close")&&typeof n.close=="function"&&n.close()})}}},init:function(){var n,t;if(!Affinity.timesheets.ready){if(Affinity.timesheets.ready=!0,window.removeEvent("UiReady",this.init),this.tabBox=document.getElement(".section-nav ul").addClass("hidden"),this.tabBox.empty(),Affinity.mobile){this.tabBoxContainer=document.getElement(".section-nav"),this.tabBoxButton=document.getElement(".section-nav-icon"),this.tabBoxButton.addEvent(Affinity.events.click,this.mobileMenuOpen),n=new Hammer(window,{domEvents:!0});n.on("panright",this.mobileMenuClose);window.addEvent("mobileback",this.mobileMenuClose),window.addEvent(Affinity.events.start,function(n){this.tochStartX=n.client.x}.bind(this))}return this.tabs=["periodTab","overviewTab","dualdetailTab","weeklyTab","detailedTab","mileageTab","teamTab","teamMilesTab","bulkTab","refreshTab","filterTab","addTab","statsTab","settingsTab","favTab","helpTab","logoutTab"],Affinity.hasDashboard||this.tabs.splice(this.tabs.indexOf("helpTab"),1),t=-1,this.resetPanels(),this.zelosEngine=new ZelosInit({htmlTemplateUrl:this.options.zelosHtmlTemplate,onRequest:function(){uimessage({message:Affinity.languages.english.application.zelos.starting})},onError:function(n){uimessage({message:Affinity.languages.english.application.zelos.startfail+n})},onComplete:function(){Affinity.prompts.hide(),window.fireEvent("ZelosReady"),this.isZelosReady=!0,this.isLoggedIn&&!this.timesheetsStarted&&this.startTimesheets()}.bind(this)}),window.addEvent("gotUser",function(n){var t;if(Affinity.login.currentProfile=n,Affinity.login.userProfiles.hasOwnProperty(n.employeeNumber)){if(Affinity.login.userProfiles[n.employeeNumber].hasOwnProperty("payPeriods")){window.fireEvent("gotUserWithPeriods",Affinity.login.userProfiles[n.employeeNumber]);return}t=this.getPayPeriods(Affinity.login.userProfiles[n.employeeNumber],log.enabled),Affinity.login.userProfiles[n.employeeNumber].payPeriods=Object.clone(t),window.fireEvent("gotUserWithPeriods",Affinity.login.userProfiles[n.employeeNumber]);return}}.bind(this)),window.addEvent("TSSwitchView",function(n){switch(n.view){case"period":this.switchToOverviewView(n);break;case"overview":this.switchToOverviewView(n);break;case"dualdetail":this.switchToDualdetailView(n);break;case"employee":this.switchToEmployeeView(n);break;case"detailed":this.switchToEmployeeDetailedView(n);break;case"manager":this.switchToManagerView(n);break;case"managerMileage":this.switchToManagerMileageView(n);break;case"bulk":this.switchToBulkView(n);break;case"employeeMilaege":this.switchToMileageView(n)}}.bind(this)),Affinity.isLoggedIn?(this.loggedin(),setTimeout(function(){window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)}.bind(this),1e3)):(window.addEvent("loggedin",this.loggedin),window.addEvent("loggedout",this.loggedout)),Affinity.HideMasterLoader(1e3),!0}},stopEvents:function(n){n.preventDefault(),n.stopPropagation()},mobileMenuCloseAndEventPrevention:function(n){var t=typeOf(n)!=="null"?n:!1;return Affinity.mobile&&this.mobileMenuClose(),t&&"stopPropagation"in n&&n.stopPropagation(),t},setLinkCloseEvent:function(n){n.removeEvents(),n.addEvent(Affinity.events.start,function(n){n.stopPropagation()}.bind(this))},dependancyCacheClear:!1,lookupCacheClear:!1,checkDependancyCacheClear:function(){this.dependancyCacheClear=!0,this.dependancyCacheClear&&this.lookupCacheClear&&this.continueRefresh()},checkLookupCacheClear:function(){this.lookupCacheClear=!0,this.dependancyCacheClear&&this.lookupCacheClear&&this.continueRefresh()},refresh:function(){uialert({message:"Refreshing",showLoader:!0,bgClose:!1,showButtons:!1}),this.dependancyCacheClear=!1,this.lookupCacheClear=!1,window.removeEvent("dependancyCacheClear",this.checkDependancyCacheClear),window.removeEvent("lookupCacheClear",this.checkLookupCacheClear),window.addEvent("dependancyCacheClear",this.checkDependancyCacheClear),window.addEvent("lookupCacheClear",this.checkLookupCacheClear),window.fireEvent("refreshQueues")},continueRefresh:function(){window.removeEvent("dependancyCacheClear",this.checkDependancyCacheClear),window.removeEvent("lookupCacheClear",this.checkLookupCacheClear);var n=this.getWidget(this.currentView);n&&n.refresh()},toggleFilter:function(n){n!==undefined&&n.preventDefault();var t=this.getWidget(this.currentView);t&&t.hasOwnProperty("toggleSearchForm")?t.toggleSearchForm():uialert({message:Affinity.languages.english.application.timesheets.globals.filterToggleFail,showButtons:!0})},toggleAdd:function(n){n.preventDefault();var t=this.getWidget(this.currentView);t?t.toggleAddRowsForm():uialert({message:Affinity.languages.english.application.timesheets.globals.addToggleFail,showButtons:!0})},inlineForwardSelect:}),nodes=document.querySelectorAll(".green.zelos-button"),i=0;i<nodes.length;i++)if(nodes[i].textContent.contains("Forward Selected")&&(node=nodes[i],parent=node.parentNode.parentNode.parentNode,parent.querySelector(".form-row.buttons")))for(parent.querySelector(".form-row.buttons").classList.add("inline"),nextNode=parent.querySelector(".form-row.buttons").nextSibling;nextNode;)if(nextNode=nextNode.nextSibling,nextNode&&nextNode.nodeName.toLowerCase()==="div"&&nextNode.classList.contains("form-row")&&nextNode.querySelector(".select")){nextNode.classList.add("inline"),nextNode.querySelector(".select").classList.add("inline");break}if(e,Affinity.stopHammerEvent(e),e.changedPointers[0].target.hasClass("timesheet-row")||e.changedPointers[0].target.getParent("tr.timesheet-row"))return;this.tochStartX>window.getSize().x-50&&this.mobileMenuOpen(),e,Affinity.stopHammerEvent(e),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.addClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose),window.removeEvent("mobileback",this.mobileMenuClose),this.mobileCloseDelay=function(){window.addEvent(Affinity.events.start,this.mobileMenuClose),window.addEvent("mobileback",this.mobileMenuClose)}.delay(250,this),e,e!==undefined&&Affinity.stopHammerEvent(e),clearTimeout(this.mobileCloseDelay),this.tabBoxContainer.removeClass("open"),window.removeEvent(Affinity.events.start,this.mobileMenuClose,{passive:!1}),window.removeEvent("mobileback",this.mobileMenuClose,{passive:!1}),tab,tabElement=this[tab],typeof tabElement!="undefined"&&typeOf(tabElement)==="element"&&"removeEvent"in tabElement&&(this.disableTab(tab),this[tab].destroy(),this[tab]=null,delete this[tab]),tab,this.removeTab(tab);var element=new Element("li"),tabLang=Affinity.languages.english.application.timesheets.tabs,featLang=Affinity.languages.english.features,revealer=new Fx.Reveal(element,{duration:250,mode:"horizontal",display:"inline-block"});element.store("revealer",revealer);switch(tab){case"periodTab":element.addClass("mine isview u-blue"),element.set("html","<span>"+Affinity.icons.Calendar+"<\/span><span>"+tabLang.periodView+"<\/span>");break;case"overviewTab":element.addClass("mine isview u-blue"),element.set("html","<span>"+Affinity.icons.GraphPie+"<\/span><span>"+tabLang.dayOverview+"<\/span>");break;case"dualdetailTab":element.addClass("mine isview u-blue"),element.set("html","<span>"+Affinity.icons.User+"<\/span><span>"+tabLang.dayDetail+"<\/span>");break;case"weeklyTab":element.addClass("mine isview u-blue"),element.set("html","<span>"+Affinity.icons.User+"<\/span><span>"+tabLang.calendar+"<\/span>");break;case"detailedTab":element.addClass("detailed isview u-blue"),element.set("html","<span>"+Affinity.icons.User+"<\/span><span>"+tabLang.detailed+"<\/span>");break;case"teamTab":element.addClass("team isview u-orange"),element.set("html","<span>"+Affinity.icons.Users+"<\/span><span>"+tabLang.team+"<\/span>");break;case"bulkTab":element.addClass("bulk isview u-orange"),element.set("html","<span>"+Affinity.icons.Archive+"<\/span><span>"+tabLang.bulkEntry+"<\/span>");break;case"mileageTab":element.addClass("mileage isview u-blue"),element.set("html","<span>"+Affinity.icons.Car+"<\/span><span>"+tabLang.mileage+"<\/span>");break;case"teamMilesTab":element.addClass("team isview u-orange"),element.set("html","<span>"+Affinity.icons.Car+"<\/span><span>"+tabLang.teamMiles+"<\/span>");break;case"refreshTab":element.addClass("refresh u-green ui-has-tooltip"),element.set("data-tooltip","Refresh Timesheets"),element.set("data-tooltip-dir","bottom,left"),Affinity.mobile?element.set("html","<span>"+Affinity.icons.Cycle+"<\/span><span>"+tabLang.refresh+"<\/span>"):element.set("html","<span>"+Affinity.icons.Cycle+"<\/span>");break;case"filterTab":element.addClass("filter u-yellow"),element.set("html","<span>"+Affinity.icons.Search+"<\/span><span>"+tabLang.filter+"<\/span>");break;case"addTab":element.addClass("add u-yellow"),element.set("html","<span>"+Affinity.icons.AddToList+"<\/span><span>"+tabLang.add+"<\/span>");break;case"statsTab":element.addClass("stats isview link u-yellow ui-has-tooltip"),element.set("data-tooltip","Timesheets Statistics"),element.set("data-tooltip-dir","bottom,left"),Affinity.mobile?(element.set("html",'<a href="'+Affinity.urlroot+'Statistics" target="_self"><span>'+Affinity.icons.GraphStatistics+"<\/span><span>"+tabLang.statistics+"<\/span><\/a>"),this.setLinkCloseEvent(element.getElement("a"))):element.set("html",'<a href="'+Affinity.urlroot+'Statistics" target="_self"><span>'+Affinity.icons.GraphStatistics+"<\/span><\/a>");break;case"settingsTab":element.addClass("settings isview link u-yellow"),Affinity.mobile?(element.set("html",'<a href="'+Affinity.urlroot+'UserSettings" target="_self"><span>'+Affinity.icons.Return+"<\/span>"+tabLang.shareDelegate+"<\/a>"),this.setLinkCloseEvent(element.getElement("a"))):(element.addClass("ui-has-tooltip"),element.set("data-tooltip","Forward or Delegate Timesheets"),element.set("data-tooltip-dir","bottom,left"),element.set("html",'<a href="'+Affinity.urlroot+'UserSettings" target="_self"><span>'+Affinity.icons.Return+"<\/span><\/a>"));break;case"favTab":element.addClass("favs isview link u-yellow"),Affinity.mobile?(element.set("html",'<a href="'+Affinity.urlroot+'Favourites" target="_self"><span>'+featLang.favourites.icon+"<\/span>"+tabLang.help+"<\/a>"),this.setLinkCloseEvent(element.getElement("a"))):(element.addClass("ui-has-tooltip"),element.set("data-tooltip",featLang.favourites.tabTooltip),element.set("data-tooltip-dir","bottom,left"),element.set("html",'<a href="'+Affinity.urlroot+'Favourites" target="_self"><span>'+featLang.favourites.icon+"<\/span><\/a>"));break;case"helpTab":element.addClass("help isview link u-blue"),Affinity.mobile?(element.set("html",'<a href="'+Affinity.urlroot+'Help" target="afhelp"><span>'+featLang.help.icon+"<\/span>"+tabLang.help+"<\/a>"),this.setLinkCloseEvent(element.getElement("a"))):(element.addClass("ui-has-tooltip"),element.set("data-tooltip",featLang.help.tabTooltip),element.set("data-tooltip-dir","bottom,left"),element.set("html",'<a href="'+Affinity.urlroot+'Help" target="afhelp"><span>'+featLang.help.icon+"<\/span><\/a>"));break;case"logoutTab":element.addClass("logout isview orange u-orange"),element.set("id","logout"),Affinity.oldess?element.set("html","<span>"+Affinity.icons.Logout+"<\/span><span>"+tabLang.close+"<\/span>"):element.set("html","<span>"+Affinity.icons.Logout+"<\/span><span>"+tabLang.logout+"<\/span>")}return element.set("data-tab",tab),this[tab]=element,this.enableTab(tab),this[tab];var m,r,w;var lastSelectedView